<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>ActiveRecord::Fixtures</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../css/main.css" type="text/css" media="screen" />
    <script src="../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Class</span> 
            ActiveRecord::Fixtures 
            
                <span class="parent">&lt; 
                    
                    <a href="../Object.html">Object</a>
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../files/activerecord-3_2_1/lib/active_record/fixtures/file_rb.html">activerecord-3.2.1/lib/active_record/fixtures/file.rb</a></li>
            
            <li><a href="../../files/activerecord-3_2_1/lib/active_record/fixtures_rb.html">activerecord-3.2.1/lib/active_record/fixtures.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    
    <div class="description">
        <p>
Fixtures are a way of organizing data that you want to test against; in
short, sample data.
</p>
<p>
They are stored in YAML files, one file per model, which are placed in the
directory appointed by <tt>ActiveSupport::TestCase.fixture_path=(path)</tt>
(this is automatically configured for <a href="../Rails.html">Rails</a>, so
you can just put your files in
<tt>&lt;your-rails-app&gt;/test/fixtures/</tt>). The fixture file ends with
the <tt>.yml</tt> file extension (<a href="../Rails.html">Rails</a>
example: <tt>&lt;your-rails-app&gt;/test/fixtures/web_sites.yml</tt>). The
format of a fixture file looks like this:
</p>
<pre>
  rubyonrails:
    id: 1
    name: Ruby on Rails
    url: http://www.rubyonrails.org

  google:
    id: 2
    name: Google
    url: http://www.google.com
</pre>
<p>
This fixture file includes two fixtures. Each YAML fixture (ie. record) is
given a name and is followed by an indented list of key/value pairs in the
&#8220;key: value&#8221; format. Records are separated by a blank line for
your viewing pleasure.
</p>
<p>
Note that fixtures are unordered. If you want ordered fixtures, use the
omap YAML type. See <a
href="http://yaml.org/type/omap.html">yaml.org/type/omap.html</a> for the
specification. You will need ordered fixtures when you have foreign key
constraints on keys in the same table. This is commonly needed for tree
structures. Example:
</p>
<pre>
   --- !omap
   - parent:
       id:         1
       parent_id:  NULL
       title:      Parent
   - child:
       id:         2
       parent_id:  1
       title:      Child
</pre>
<h1>Using <a href="Fixtures.html">Fixtures</a> in <a href="../Test.html">Test</a> Cases</h1>
<p>
Since fixtures are a testing construct, we use them in our unit and
functional tests. There are two ways to use the fixtures, but first
let&#8217;s take a look at a sample unit test:
</p>
<pre>
  require 'test_helper'

  class WebSiteTest &lt; ActiveSupport::TestCase
    test &quot;web_site_count&quot; do
      assert_equal 2, WebSite.count
    end
  end
</pre>
<p>
By default, <tt>test_helper.rb</tt> will load all of your fixtures into
your test database, so this test will succeed.
</p>
<p>
The testing environment will automatically load the all fixtures into the
database before each test. To ensure consistent data, the environment
deletes the fixtures before running the load.
</p>
<p>
In addition to being available in the database, the fixture&#8217;s data
may also be accessed by using a special dynamic method, which has the same
name as the model, and accepts the name of the fixture to instantiate:
</p>
<pre>
  test &quot;find&quot; do
    assert_equal &quot;Ruby on Rails&quot;, web_sites(:rubyonrails).name
  end
</pre>
<p>
Alternatively, you may enable auto-instantiation of the fixture data. For
instance, take the following tests:
</p>
<pre>
  test &quot;find_alt_method_1&quot; do
    assert_equal &quot;Ruby on Rails&quot;, @web_sites['rubyonrails']['name']
  end

  test &quot;find_alt_method_2&quot; do
    assert_equal &quot;Ruby on Rails&quot;, @rubyonrails.news
  end
</pre>
<p>
In order to use these methods to access fixtured data within your
testcases, you must specify one of the following in your
<tt>ActiveSupport::TestCase</tt>-derived class:
</p>
<ul>
<li>to fully enable instantiated fixtures (enable alternate methods 1 and 2
above)

<pre>
  self.use_instantiated_fixtures = true
</pre>
</li>
<li>create only the hash for the fixtures, do not &#8216;find&#8217; each
instance (enable alternate method 1 only)

<pre>
  self.use_instantiated_fixtures = :no_instances
</pre>
</li>
</ul>
<p>
Using either of these alternate methods incurs a performance hit, as the
fixtured data must be fully traversed in the database to create the fixture
hash and/or instance variables. This is expensive for large sets of
fixtured data.
</p>
<h1>Dynamic fixtures with <a href="../ERB.html">ERB</a></h1>
<p>
Some times you don&#8217;t care about the content of the fixtures as much
as you care about the volume. In these cases, you can mix <a
href="../ERB.html">ERB</a> in with your YAML fixtures to create a bunch of
fixtures for load testing, like:
</p>
<pre>
  &lt;% 1.upto(1000) do |i| %&gt;
  fix_&lt;%= i %&gt;:
    id: &lt;%= i %&gt;
    name: guy_&lt;%= 1 %&gt;
  &lt;% end %&gt;
</pre>
<p>
This will create 1000 very simple fixtures.
</p>
<p>
Using <a href="../ERB.html">ERB</a>, you can also inject dynamic values
into your fixtures with inserts like <tt>&lt;%=
Date.today.strftime(&quot;%Y-%m-%d&quot;) %&gt;</tt>. This is however a
feature to be used with some caution. The point of fixtures are that
they&#8217;re stable units of predictable sample data. If you feel that you
need to inject dynamic values, then perhaps you should reexamine whether
your application is properly testable. Hence, dynamic values in fixtures
are to be considered a code smell.
</p>
<h1>Transactional <a href="Fixtures.html">Fixtures</a></h1>
<p>
<a href="../Test.html">Test</a> cases can use begin+rollback to isolate
their changes to the database instead of having to delete+insert for every
test case.
</p>
<pre>
  class FooTest &lt; ActiveSupport::TestCase
    self.use_transactional_fixtures = true

    test &quot;godzilla&quot; do
      assert !Foo.all.empty?
      Foo.destroy_all
      assert Foo.all.empty?
    end

    test &quot;godzilla aftermath&quot; do
      assert !Foo.all.empty?
    end
  end
</pre>
<p>
If you preload your test database with all fixture data (probably in the
rake task) and use transactional fixtures, then you may omit all fixtures
declarations in your test cases since all the data&#8217;s already there
and every case rolls back its changes.
</p>
<p>
In order to use instantiated fixtures with preloaded data, set
<tt>self.pre_loaded_fixtures</tt> to true. This will provide access to
fixture data for every table that has been loaded through fixtures
(depending on the value of <tt>use_instantiated_fixtures</tt>).
</p>
<p>
When <b>not</b> to use transactional fixtures:
</p>
<ol>
<li>You&#8217;re testing whether a transaction works correctly. Nested
transactions don&#8217;t commit until all parent transactions commit,
particularly, the fixtures transaction which is begun in setup and rolled
back in teardown. Thus, you won&#8217;t be able to verify the results of
your transaction until Active Record supports nested transactions or
savepoints (in progress).

</li>
<li>Your database does not support transactions. Every Active Record database
supports transactions except MySQL MyISAM. Use InnoDB, MaxDB, or NDB
instead.

</li>
</ol>
<h1>Advanced <a href="Fixtures.html">Fixtures</a></h1>
<p>
<a href="Fixtures.html">Fixtures</a> that don&#8217;t specify an ID get
some extra features:
</p>
<ul>
<li>Stable, autogenerated IDs

</li>
<li>Label references for associations (belongs_to, has_one, has_many)

</li>
<li>HABTM associations as inline lists

</li>
<li>Autofilled timestamp columns

</li>
<li>Fixture label interpolation

</li>
<li>Support for YAML defaults

</li>
</ul>
<h2>Stable, Autogenerated IDs</h2>
<p>
Here, have a monkey fixture:
</p>
<pre>
  george:
    id: 1
    name: George the Monkey

  reginald:
    id: 2
    name: Reginald the Pirate
</pre>
<p>
Each of these fixtures has two unique identifiers: one for the database and
one for the humans. Why don&#8217;t we generate the primary key instead?
Hashing each fixture&#8217;s label yields a consistent ID:
</p>
<pre>
  george: # generated id: 503576764
    name: George the Monkey

  reginald: # generated id: 324201669
    name: Reginald the Pirate
</pre>
<p>
Active Record looks at the fixture&#8217;s model class, discovers the
correct primary key, and generates it right before inserting the fixture
into the database.
</p>
<p>
The generated ID for a given label is constant, so we can discover any
fixture&#8217;s ID without loading anything, as long as we know the label.
</p>
<h2>Label references for associations (belongs_to, has_one, has_many)</h2>
<p>
Specifying foreign keys in fixtures can be very fragile, not to mention
difficult to read. Since Active Record can figure out the ID of any fixture
from its label, you can specify FK&#8217;s by label instead of ID.
</p>
<h3>belongs_to</h3>
<p>
Let&#8217;s break out some more monkeys and pirates.
</p>
<pre>
  ### in pirates.yml

  reginald:
    id: 1
    name: Reginald the Pirate
    monkey_id: 1

  ### in monkeys.yml

  george:
    id: 1
    name: George the Monkey
    pirate_id: 1
</pre>
<p>
Add a few more monkeys and pirates and break this into multiple files, and
it gets pretty hard to keep track of what&#8217;s going on. Let&#8217;s use
labels instead of IDs:
</p>
<pre>
  ### in pirates.yml

  reginald:
    name: Reginald the Pirate
    monkey: george

  ### in monkeys.yml

  george:
    name: George the Monkey
    pirate: reginald
</pre>
<p>
Pow! All is made clear. Active Record reflects on the fixture&#8217;s model
class, finds all the <tt>belongs_to</tt> associations, and allows you to
specify a target <b>label</b> for the <b>association</b> (monkey: george)
rather than a target <b>id</b> for the <b>FK</b> (<tt>monkey_id: 1</tt>).
</p>
<h4>Polymorphic belongs_to</h4>
<p>
Supporting polymorphic relationships is a little bit more complicated,
since Active Record needs to know what type your association is pointing
at. Something like this should look familiar:
</p>
<pre>
  ### in fruit.rb

  belongs_to :eater, :polymorphic =&gt; true

  ### in fruits.yml

  apple:
    id: 1
    name: apple
    eater_id: 1
    eater_type: Monkey
</pre>
<p>
Can we do better? You bet!
</p>
<pre>
  apple:
    eater: george (Monkey)
</pre>
<p>
Just provide the polymorphic target type and Active Record will take care
of the rest.
</p>
<h3>has_and_belongs_to_many</h3>
<p>
<a href="../Time.html">Time</a> to give our monkey some fruit.
</p>
<pre>
  ### in monkeys.yml

  george:
    id: 1
    name: George the Monkey

  ### in fruits.yml

  apple:
    id: 1
    name: apple

  orange:
    id: 2
    name: orange

  grape:
    id: 3
    name: grape

  ### in fruits_monkeys.yml

  apple_george:
    fruit_id: 1
    monkey_id: 1

  orange_george:
    fruit_id: 2
    monkey_id: 1

  grape_george:
    fruit_id: 3
    monkey_id: 1
</pre>
<p>
Let&#8217;s make the HABTM fixture go away.
</p>
<pre>
  ### in monkeys.yml

  george:
    id: 1
    name: George the Monkey
    fruits: apple, orange, grape

  ### in fruits.yml

  apple:
    name: apple

  orange:
    name: orange

  grape:
    name: grape
</pre>
<p>
Zap! No more fruits_monkeys.yml file. We&#8217;ve specified the list of
fruits on George&#8217;s fixture, but we could&#8217;ve just as easily
specified a list of monkeys on each fruit. As with <tt>belongs_to</tt>,
Active Record reflects on the fixture&#8217;s model class and discovers the
<tt>has_and_belongs_to_many</tt> associations.
</p>
<h2>Autofilled <a href="Timestamp.html">Timestamp</a> Columns</h2>
<p>
If your table/model specifies any of Active Record&#8217;s standard
timestamp columns (<tt>created_at</tt>, <tt>created_on</tt>,
<tt>updated_at</tt>, <tt>updated_on</tt>), they will automatically be set
to <tt>Time.now</tt>.
</p>
<p>
If you&#8217;ve set specific values, they&#8217;ll be left alone.
</p>
<h2>Fixture label interpolation</h2>
<p>
The label of the current fixture is always available as a column value:
</p>
<pre>
  geeksomnia:
    name: Geeksomnia's Account
    subdomain: $LABEL
</pre>
<p>
Also, sometimes (like when porting older join table fixtures) you&#8217;ll
need to be able to get a hold of the identifier for a given label. <a
href="../ERB.html">ERB</a> to the rescue:
</p>
<pre>
  george_reginald:
    monkey_id: &lt;%= ActiveRecord::Fixtures.identify(:reginald) %&gt;
    pirate_id: &lt;%= ActiveRecord::Fixtures.identify(:george) %&gt;
</pre>
<h2>Support for YAML defaults</h2>
<p>
You probably already know how to use YAML to set and reuse defaults in your
<tt>database.yml</tt> file. You can use the same technique in your
fixtures:
</p>
<pre>
  DEFAULTS: &amp;DEFAULTS
    created_on: &lt;%= 3.weeks.ago.to_s(:db) %&gt;

  first:
    name: Smurf
    *DEFAULTS

  second:
    name: Fraggle
    *DEFAULTS
</pre>
<p>
Any fixture labeled &#8220;DEFAULTS&#8221; is safely ignored.
</p>

    </div>
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>#</dt>
        <dd>
            <ul>
                
                <li><a href="#M001408">[]</a>,</li>
                
                <li><a href="#M001409">[]=</a></li>
                
            </ul>
        </dd>
    
        <dt>C</dt>
        <dd>
            <ul>
                
                <li><a href="#M001398">cache_fixtures</a>,</li>
                
                <li><a href="#M001395">cache_for_connection</a>,</li>
                
                <li><a href="#M001397">cached_fixtures</a>,</li>
                
                <li><a href="#M001419">column_names</a>,</li>
                
                <li><a href="#M001403">create_fixtures</a></li>
                
            </ul>
        </dd>
    
        <dt>E</dt>
        <dd>
            <ul>
                
                <li><a href="#M001410">each</a></li>
                
            </ul>
        </dd>
    
        <dt>F</dt>
        <dd>
            <ul>
                
                <li><a href="#M001396">fixture_is_cached?</a></li>
                
            </ul>
        </dd>
    
        <dt>H</dt>
        <dd>
            <ul>
                
                <li><a href="#M001416">has_primary_key_column?</a></li>
                
            </ul>
        </dd>
    
        <dt>I</dt>
        <dd>
            <ul>
                
                <li><a href="#M001406">identify</a>,</li>
                
                <li><a href="#M001418">inheritance_column_name</a>,</li>
                
                <li><a href="#M001401">instantiate_all_loaded_fixtures</a>,</li>
                
                <li><a href="#M001400">instantiate_fixtures</a></li>
                
            </ul>
        </dd>
    
        <dt>N</dt>
        <dd>
            <ul>
                
                <li><a href="#M001407">new</a></li>
                
            </ul>
        </dd>
    
        <dt>P</dt>
        <dd>
            <ul>
                
                <li><a href="#M001415">primary_key_name</a></li>
                
            </ul>
        </dd>
    
        <dt>R</dt>
        <dd>
            <ul>
                
                <li><a href="#M001420">read_fixture_files</a>,</li>
                
                <li><a href="#M001394">reset_cache</a></li>
                
            </ul>
        </dd>
    
        <dt>S</dt>
        <dd>
            <ul>
                
                <li><a href="#M001411">size</a></li>
                
            </ul>
        </dd>
    
        <dt>T</dt>
        <dd>
            <ul>
                
                <li><a href="#M001412">table_rows</a>,</li>
                
                <li><a href="#M001417">timestamp_column_names</a></li>
                
            </ul>
        </dd>
    
        <dt>Y</dt>
        <dd>
            <ul>
                
                <li><a href="#M001421">yaml_file_path</a>,</li>
                
                <li><a href="#M001422">yaml_fixtures_key</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    

    

    
    <div class="sectiontitle">Classes and Modules</div>
    <ul>
        
        <li><span class="type">CLASS</span> <a href="Fixtures/File.html">ActiveRecord::Fixtures::File</a></li>
        
    </ul>
    

    
    <div class="sectiontitle">Constants</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class="attr-name">MAX_ID</td>
            <td>=</td>
            <td class="attr-value">2 ** 30 - 1</td>
        </tr>
        
        
    </table>
    

    
    <div class="sectiontitle">Attributes</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>table_name</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>name</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>fixtures</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>model_class</td>
            <td class='attr-desc'></td>
        </tr>
        
    </table>
    

    
            <div class="sectiontitle">Class Public methods</div>
            
            <div class="method">
                <div class="title" id="M001398">
                    
                    <a name="M001398"></a><b>cache_fixtures</b>(connection, fixtures_map)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001398_source')" id="l_M001398_source">show</a>
                        
                    </p>
                    <div id="M001398_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activerecord-3.2.1/lib/active_record/fixtures.rb, line 418</span>
418:     <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">cache_fixtures</span>(<span class="ruby-identifier">connection</span>, <span class="ruby-identifier">fixtures_map</span>)
419:       <span class="ruby-identifier">cache_for_connection</span>(<span class="ruby-identifier">connection</span>).<span class="ruby-identifier">update</span>(<span class="ruby-identifier">fixtures_map</span>)
420:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001395">
                    
                    <a name="M001395"></a><b>cache_for_connection</b>(connection)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001395_source')" id="l_M001395_source">show</a>
                        
                    </p>
                    <div id="M001395_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activerecord-3.2.1/lib/active_record/fixtures.rb, line 402</span>
402:     <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">cache_for_connection</span>(<span class="ruby-identifier">connection</span>)
403:       <span class="ruby-ivar">@@all_cached_fixtures</span>[<span class="ruby-identifier">connection</span>]
404:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001397">
                    
                    <a name="M001397"></a><b>cached_fixtures</b>(connection, keys_to_fetch = nil)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001397_source')" id="l_M001397_source">show</a>
                        
                    </p>
                    <div id="M001397_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activerecord-3.2.1/lib/active_record/fixtures.rb, line 410</span>
410:     <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">cached_fixtures</span>(<span class="ruby-identifier">connection</span>, <span class="ruby-identifier">keys_to_fetch</span> = <span class="ruby-keyword kw">nil</span>)
411:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">keys_to_fetch</span>
412:         <span class="ruby-identifier">cache_for_connection</span>(<span class="ruby-identifier">connection</span>).<span class="ruby-identifier">values_at</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">keys_to_fetch</span>)
413:       <span class="ruby-keyword kw">else</span>
414:         <span class="ruby-identifier">cache_for_connection</span>(<span class="ruby-identifier">connection</span>).<span class="ruby-identifier">values</span>
415:       <span class="ruby-keyword kw">end</span>
416:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001403">
                    
                    <a name="M001403"></a><b>create_fixtures</b>(fixtures_directory, table_names, class_names = {})
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001403_source')" id="l_M001403_source">show</a>
                        
                    </p>
                    <div id="M001403_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activerecord-3.2.1/lib/active_record/fixtures.rb, line 443</span>
443:     <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">create_fixtures</span>(<span class="ruby-identifier">fixtures_directory</span>, <span class="ruby-identifier">table_names</span>, <span class="ruby-identifier">class_names</span> = {})
444:       <span class="ruby-identifier">table_names</span> = [<span class="ruby-identifier">table_names</span>].<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">n</span><span class="ruby-operator">|</span> <span class="ruby-identifier">n</span>.<span class="ruby-identifier">to_s</span> }
445:       <span class="ruby-identifier">table_names</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">n</span><span class="ruby-operator">|</span>
446:         <span class="ruby-identifier">class_names</span>[<span class="ruby-identifier">n</span>.<span class="ruby-identifier">tr</span>(<span class="ruby-value str">'/'</span>, <span class="ruby-value str">'_'</span>).<span class="ruby-identifier">to_sym</span>] = <span class="ruby-identifier">n</span>.<span class="ruby-identifier">classify</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">n</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-value str">'/'</span>)
447:       }
448: 
449:       <span class="ruby-comment cmt"># FIXME: Apparently JK uses this.</span>
450:       <span class="ruby-identifier">connection</span> = <span class="ruby-identifier">block_given?</span> <span class="ruby-value">? </span><span class="ruby-keyword kw">yield</span> <span class="ruby-operator">:</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>
451: 
452:       <span class="ruby-identifier">files_to_read</span> = <span class="ruby-identifier">table_names</span>.<span class="ruby-identifier">reject</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">table_name</span><span class="ruby-operator">|</span>
453:         <span class="ruby-identifier">fixture_is_cached?</span>(<span class="ruby-identifier">connection</span>, <span class="ruby-identifier">table_name</span>)
454:       }
455: 
456:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">files_to_read</span>.<span class="ruby-identifier">empty?</span>
457:         <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">disable_referential_integrity</span> <span class="ruby-keyword kw">do</span>
458:           <span class="ruby-identifier">fixtures_map</span> = {}
459: 
460:           <span class="ruby-identifier">fixture_files</span> = <span class="ruby-identifier">files_to_read</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">path</span><span class="ruby-operator">|</span>
461:             <span class="ruby-identifier">table_name</span> = <span class="ruby-identifier">path</span>.<span class="ruby-identifier">tr</span> <span class="ruby-value str">'/'</span>, <span class="ruby-value str">'_'</span>
462: 
463:             <span class="ruby-identifier">fixtures_map</span>[<span class="ruby-identifier">path</span>] = <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Fixtures</span>.<span class="ruby-identifier">new</span>(
464:               <span class="ruby-identifier">connection</span>,
465:               <span class="ruby-identifier">table_name</span>,
466:               <span class="ruby-identifier">class_names</span>[<span class="ruby-identifier">table_name</span>.<span class="ruby-identifier">to_sym</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">table_name</span>.<span class="ruby-identifier">classify</span>,
467:               <span class="ruby-operator">::</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">fixtures_directory</span>, <span class="ruby-identifier">path</span>))
468:           <span class="ruby-keyword kw">end</span>
469: 
470:           <span class="ruby-identifier">all_loaded_fixtures</span>.<span class="ruby-identifier">update</span>(<span class="ruby-identifier">fixtures_map</span>)
471: 
472:           <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">transaction</span>(<span class="ruby-identifier">:requires_new</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>) <span class="ruby-keyword kw">do</span>
473:             <span class="ruby-identifier">fixture_files</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">ff</span><span class="ruby-operator">|</span>
474:               <span class="ruby-identifier">conn</span> = <span class="ruby-identifier">ff</span>.<span class="ruby-identifier">model_class</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:connection</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">ff</span>.<span class="ruby-identifier">model_class</span>.<span class="ruby-identifier">connection</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">connection</span>
475:               <span class="ruby-identifier">table_rows</span> = <span class="ruby-identifier">ff</span>.<span class="ruby-identifier">table_rows</span>
476: 
477:               <span class="ruby-identifier">table_rows</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">table</span><span class="ruby-operator">|</span>
478:                 <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">delete</span> <span class="ruby-node">&quot;DELETE FROM #{conn.quote_table_name(table)}&quot;</span>, <span class="ruby-value str">'Fixture Delete'</span>
479:               <span class="ruby-keyword kw">end</span>
480: 
481:               <span class="ruby-identifier">table_rows</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">table_name</span>,<span class="ruby-identifier">rows</span><span class="ruby-operator">|</span>
482:                 <span class="ruby-identifier">rows</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">row</span><span class="ruby-operator">|</span>
483:                   <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">insert_fixture</span>(<span class="ruby-identifier">row</span>, <span class="ruby-identifier">table_name</span>)
484:                 <span class="ruby-keyword kw">end</span>
485:               <span class="ruby-keyword kw">end</span>
486:             <span class="ruby-keyword kw">end</span>
487: 
488:             <span class="ruby-comment cmt"># Cap primary key sequences to max(pk).</span>
489:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:reset_pk_sequence!</span>)
490:               <span class="ruby-identifier">table_names</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">table_name</span><span class="ruby-operator">|</span>
491:                 <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">reset_pk_sequence!</span>(<span class="ruby-identifier">table_name</span>.<span class="ruby-identifier">tr</span>(<span class="ruby-value str">'/'</span>, <span class="ruby-value str">'_'</span>))
492:               <span class="ruby-keyword kw">end</span>
493:             <span class="ruby-keyword kw">end</span>
494:           <span class="ruby-keyword kw">end</span>
495: 
496:           <span class="ruby-identifier">cache_fixtures</span>(<span class="ruby-identifier">connection</span>, <span class="ruby-identifier">fixtures_map</span>)
497:         <span class="ruby-keyword kw">end</span>
498:       <span class="ruby-keyword kw">end</span>
499:       <span class="ruby-identifier">cached_fixtures</span>(<span class="ruby-identifier">connection</span>, <span class="ruby-identifier">table_names</span>)
500:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001396">
                    
                    <a name="M001396"></a><b>fixture_is_cached?</b>(connection, table_name)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001396_source')" id="l_M001396_source">show</a>
                        
                    </p>
                    <div id="M001396_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activerecord-3.2.1/lib/active_record/fixtures.rb, line 406</span>
406:     <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">fixture_is_cached?</span>(<span class="ruby-identifier">connection</span>, <span class="ruby-identifier">table_name</span>)
407:       <span class="ruby-identifier">cache_for_connection</span>(<span class="ruby-identifier">connection</span>)[<span class="ruby-identifier">table_name</span>]
408:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001406">
                    
                    <a name="M001406"></a><b>identify</b>(label)
                    
                </div>
                
                <div class="description">
                  <p>
Returns a consistent, platform-independent identifier for <tt>label</tt>.
Identifiers are positive integers less than 2^32.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001406_source')" id="l_M001406_source">show</a>
                        
                    </p>
                    <div id="M001406_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activerecord-3.2.1/lib/active_record/fixtures.rb, line 504</span>
504:     <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">identify</span>(<span class="ruby-identifier">label</span>)
505:       <span class="ruby-constant">Zlib</span>.<span class="ruby-identifier">crc32</span>(<span class="ruby-identifier">label</span>.<span class="ruby-identifier">to_s</span>) <span class="ruby-operator">%</span> <span class="ruby-constant">MAX_ID</span>
506:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001401">
                    
                    <a name="M001401"></a><b>instantiate_all_loaded_fixtures</b>(object, load_instances = true)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001401_source')" id="l_M001401_source">show</a>
                        
                    </p>
                    <div id="M001401_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activerecord-3.2.1/lib/active_record/fixtures.rb, line 434</span>
434:     <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">instantiate_all_loaded_fixtures</span>(<span class="ruby-identifier">object</span>, <span class="ruby-identifier">load_instances</span> = <span class="ruby-keyword kw">true</span>)
435:       <span class="ruby-identifier">all_loaded_fixtures</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">table_name</span>, <span class="ruby-identifier">fixtures</span><span class="ruby-operator">|</span>
436:         <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Fixtures</span>.<span class="ruby-identifier">instantiate_fixtures</span>(<span class="ruby-identifier">object</span>, <span class="ruby-identifier">table_name</span>, <span class="ruby-identifier">fixtures</span>, <span class="ruby-identifier">load_instances</span>)
437:       <span class="ruby-keyword kw">end</span>
438:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001400">
                    
                    <a name="M001400"></a><b>instantiate_fixtures</b>(object, fixture_name, fixtures, load_instances = true)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001400_source')" id="l_M001400_source">show</a>
                        
                    </p>
                    <div id="M001400_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activerecord-3.2.1/lib/active_record/fixtures.rb, line 422</span>
422:     <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">instantiate_fixtures</span>(<span class="ruby-identifier">object</span>, <span class="ruby-identifier">fixture_name</span>, <span class="ruby-identifier">fixtures</span>, <span class="ruby-identifier">load_instances</span> = <span class="ruby-keyword kw">true</span>)
423:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">load_instances</span>
424:         <span class="ruby-identifier">fixtures</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">name</span>, <span class="ruby-identifier">fixture</span><span class="ruby-operator">|</span>
425:           <span class="ruby-keyword kw">begin</span>
426:             <span class="ruby-identifier">object</span>.<span class="ruby-identifier">instance_variable_set</span> <span class="ruby-node">&quot;@#{name}&quot;</span>, <span class="ruby-identifier">fixture</span>.<span class="ruby-identifier">find</span>
427:           <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">FixtureClassNotFound</span>
428:             <span class="ruby-keyword kw">nil</span>
429:           <span class="ruby-keyword kw">end</span>
430:         <span class="ruby-keyword kw">end</span>
431:       <span class="ruby-keyword kw">end</span>
432:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001407">
                    
                    <a name="M001407"></a><b>new</b>(connection, table_name, class_name, fixture_path)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001407_source')" id="l_M001407_source">show</a>
                        
                    </p>
                    <div id="M001407_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activerecord-3.2.1/lib/active_record/fixtures.rb, line 510</span>
510:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">connection</span>, <span class="ruby-identifier">table_name</span>, <span class="ruby-identifier">class_name</span>, <span class="ruby-identifier">fixture_path</span>)
511:       <span class="ruby-ivar">@connection</span>   = <span class="ruby-identifier">connection</span>
512:       <span class="ruby-ivar">@table_name</span>   = <span class="ruby-identifier">table_name</span>
513:       <span class="ruby-ivar">@fixture_path</span> = <span class="ruby-identifier">fixture_path</span>
514:       <span class="ruby-ivar">@name</span>         = <span class="ruby-identifier">table_name</span> <span class="ruby-comment cmt"># preserve fixture base name</span>
515:       <span class="ruby-ivar">@class_name</span>   = <span class="ruby-identifier">class_name</span>
516: 
517:       <span class="ruby-ivar">@fixtures</span>     = <span class="ruby-constant">ActiveSupport</span><span class="ruby-operator">::</span><span class="ruby-constant">OrderedHash</span>.<span class="ruby-identifier">new</span>
518:       <span class="ruby-ivar">@table_name</span>   = <span class="ruby-node">&quot;#{ActiveRecord::Base.table_name_prefix}#{@table_name}#{ActiveRecord::Base.table_name_suffix}&quot;</span>
519: 
520:       <span class="ruby-comment cmt"># Should be an AR::Base type class</span>
521:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">class_name</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Class</span>)
522:         <span class="ruby-ivar">@table_name</span>   = <span class="ruby-identifier">class_name</span>.<span class="ruby-identifier">table_name</span>
523:         <span class="ruby-ivar">@connection</span>   = <span class="ruby-identifier">class_name</span>.<span class="ruby-identifier">connection</span>
524:         <span class="ruby-ivar">@model_class</span>  = <span class="ruby-identifier">class_name</span>
525:       <span class="ruby-keyword kw">else</span>
526:         <span class="ruby-ivar">@model_class</span>  = <span class="ruby-identifier">class_name</span>.<span class="ruby-identifier">constantize</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
527:       <span class="ruby-keyword kw">end</span>
528: 
529:       <span class="ruby-identifier">read_fixture_files</span>
530:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001394">
                    
                    <a name="M001394"></a><b>reset_cache</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001394_source')" id="l_M001394_source">show</a>
                        
                    </p>
                    <div id="M001394_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activerecord-3.2.1/lib/active_record/fixtures.rb, line 398</span>
398:     <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">reset_cache</span>
399:       <span class="ruby-ivar">@@all_cached_fixtures</span>.<span class="ruby-identifier">clear</span>
400:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M001408">
                    
                    <a name="M001408"></a><b>[]</b>(x)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001408_source')" id="l_M001408_source">show</a>
                        
                    </p>
                    <div id="M001408_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activerecord-3.2.1/lib/active_record/fixtures.rb, line 532</span>
532:     <span class="ruby-keyword kw">def</span> <span class="ruby-operator">[]</span>(<span class="ruby-identifier">x</span>)
533:       <span class="ruby-identifier">fixtures</span>[<span class="ruby-identifier">x</span>]
534:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001409">
                    
                    <a name="M001409"></a><b>[]=</b>(k,v)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001409_source')" id="l_M001409_source">show</a>
                        
                    </p>
                    <div id="M001409_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activerecord-3.2.1/lib/active_record/fixtures.rb, line 536</span>
536:     <span class="ruby-keyword kw">def</span> <span class="ruby-operator">[]=</span>(<span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span>)
537:       <span class="ruby-identifier">fixtures</span>[<span class="ruby-identifier">k</span>] = <span class="ruby-identifier">v</span>
538:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001410">
                    
                    <a name="M001410"></a><b>each</b>(&amp;block)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001410_source')" id="l_M001410_source">show</a>
                        
                    </p>
                    <div id="M001410_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activerecord-3.2.1/lib/active_record/fixtures.rb, line 540</span>
540:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">each</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
541:       <span class="ruby-identifier">fixtures</span>.<span class="ruby-identifier">each</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
542:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001411">
                    
                    <a name="M001411"></a><b>size</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001411_source')" id="l_M001411_source">show</a>
                        
                    </p>
                    <div id="M001411_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activerecord-3.2.1/lib/active_record/fixtures.rb, line 544</span>
544:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">size</span>
545:       <span class="ruby-identifier">fixtures</span>.<span class="ruby-identifier">size</span>
546:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001412">
                    
                    <a name="M001412"></a><b>table_rows</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Return a hash of rows to be inserted. The key is the table, the value is a
list of rows to insert to that table.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001412_source')" id="l_M001412_source">show</a>
                        
                    </p>
                    <div id="M001412_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activerecord-3.2.1/lib/active_record/fixtures.rb, line 550</span>
550:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">table_rows</span>
551:       <span class="ruby-identifier">now</span> = <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">default_timezone</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:utc</span> <span class="ruby-operator">?</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">utc</span> <span class="ruby-operator">:</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
552:       <span class="ruby-identifier">now</span> = <span class="ruby-identifier">now</span>.<span class="ruby-identifier">to_s</span>(<span class="ruby-identifier">:db</span>)
553: 
554:       <span class="ruby-comment cmt"># allow a standard key to be used for doing defaults in YAML</span>
555:       <span class="ruby-identifier">fixtures</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value str">'DEFAULTS'</span>)
556: 
557:       <span class="ruby-comment cmt"># track any join tables we need to insert later</span>
558:       <span class="ruby-identifier">rows</span> = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">h</span>,<span class="ruby-identifier">table</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">table</span>] = [] }
559: 
560:       <span class="ruby-identifier">rows</span>[<span class="ruby-identifier">table_name</span>] = <span class="ruby-identifier">fixtures</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">label</span>, <span class="ruby-identifier">fixture</span><span class="ruby-operator">|</span>
561:         <span class="ruby-identifier">row</span> = <span class="ruby-identifier">fixture</span>.<span class="ruby-identifier">to_hash</span>
562: 
563:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">model_class</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">model_class</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>
564:           <span class="ruby-comment cmt"># fill in timestamp columns if they aren't specified and the model is set to record_timestamps</span>
565:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">model_class</span>.<span class="ruby-identifier">record_timestamps</span>
566:             <span class="ruby-identifier">timestamp_column_names</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">name</span><span class="ruby-operator">|</span>
567:               <span class="ruby-identifier">row</span>[<span class="ruby-identifier">name</span>] = <span class="ruby-identifier">now</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">row</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-identifier">name</span>)
568:             <span class="ruby-keyword kw">end</span>
569:           <span class="ruby-keyword kw">end</span>
570: 
571:           <span class="ruby-comment cmt"># interpolate the fixture label</span>
572:           <span class="ruby-identifier">row</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
573:             <span class="ruby-identifier">row</span>[<span class="ruby-identifier">key</span>] = <span class="ruby-identifier">label</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">value</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;$LABEL&quot;</span>
574:           <span class="ruby-keyword kw">end</span>
575: 
576:           <span class="ruby-comment cmt"># generate a primary key if necessary</span>
577:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">has_primary_key_column?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">row</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">primary_key_name</span>)
578:             <span class="ruby-identifier">row</span>[<span class="ruby-identifier">primary_key_name</span>] = <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Fixtures</span>.<span class="ruby-identifier">identify</span>(<span class="ruby-identifier">label</span>)
579:           <span class="ruby-keyword kw">end</span>
580: 
581:           <span class="ruby-comment cmt"># If STI is used, find the correct subclass for association reflection</span>
582:           <span class="ruby-identifier">reflection_class</span> =
583:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">row</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">inheritance_column_name</span>)
584:               <span class="ruby-identifier">row</span>[<span class="ruby-identifier">inheritance_column_name</span>].<span class="ruby-identifier">constantize</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-identifier">model_class</span>
585:             <span class="ruby-keyword kw">else</span>
586:               <span class="ruby-identifier">model_class</span>
587:             <span class="ruby-keyword kw">end</span>
588: 
589:           <span class="ruby-identifier">reflection_class</span>.<span class="ruby-identifier">reflect_on_all_associations</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">association</span><span class="ruby-operator">|</span>
590:             <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">association</span>.<span class="ruby-identifier">macro</span>
591:             <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:belongs_to</span>
592:               <span class="ruby-comment cmt"># Do not replace association name with association foreign key if they are named the same</span>
593:               <span class="ruby-identifier">fk_name</span> = (<span class="ruby-identifier">association</span>.<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:foreign_key</span>] <span class="ruby-operator">||</span> <span class="ruby-node">&quot;#{association.name}_id&quot;</span>).<span class="ruby-identifier">to_s</span>
594: 
595:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">association</span>.<span class="ruby-identifier">name</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">fk_name</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">value</span> = <span class="ruby-identifier">row</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">association</span>.<span class="ruby-identifier">name</span>.<span class="ruby-identifier">to_s</span>)
596:                 <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">association</span>.<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:polymorphic</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">sub!</span>(<span class="ruby-regexp re">/\s*\(([^\)]*)\)\s*$/</span>, <span class="ruby-value str">&quot;&quot;</span>)
597:                   <span class="ruby-comment cmt"># support polymorphic belongs_to as &quot;label (Type)&quot;</span>
598:                   <span class="ruby-identifier">row</span>[<span class="ruby-identifier">association</span>.<span class="ruby-identifier">foreign_type</span>] = <span class="ruby-identifier">$1</span>
599:                 <span class="ruby-keyword kw">end</span>
600: 
601:                 <span class="ruby-identifier">row</span>[<span class="ruby-identifier">fk_name</span>] = <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Fixtures</span>.<span class="ruby-identifier">identify</span>(<span class="ruby-identifier">value</span>)
602:               <span class="ruby-keyword kw">end</span>
603:             <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:has_and_belongs_to_many</span>
604:               <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">targets</span> = <span class="ruby-identifier">row</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">association</span>.<span class="ruby-identifier">name</span>.<span class="ruby-identifier">to_s</span>))
605:                 <span class="ruby-identifier">targets</span> = <span class="ruby-identifier">targets</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">targets</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">targets</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp re">/\s*,\s*/</span>)
606:                 <span class="ruby-identifier">table_name</span> = <span class="ruby-identifier">association</span>.<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:join_table</span>]
607:                 <span class="ruby-identifier">rows</span>[<span class="ruby-identifier">table_name</span>].<span class="ruby-identifier">concat</span> <span class="ruby-identifier">targets</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">target</span><span class="ruby-operator">|</span>
608:                   { <span class="ruby-identifier">association</span>.<span class="ruby-identifier">foreign_key</span>             =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">row</span>[<span class="ruby-identifier">primary_key_name</span>],
609:                     <span class="ruby-identifier">association</span>.<span class="ruby-identifier">association_foreign_key</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Fixtures</span>.<span class="ruby-identifier">identify</span>(<span class="ruby-identifier">target</span>) }
610:                 }
611:               <span class="ruby-keyword kw">end</span>
612:             <span class="ruby-keyword kw">end</span>
613:           <span class="ruby-keyword kw">end</span>
614:         <span class="ruby-keyword kw">end</span>
615: 
616:         <span class="ruby-identifier">row</span>
617:       <span class="ruby-keyword kw">end</span>
618:       <span class="ruby-identifier">rows</span>
619:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Private methods</div>
            
            <div class="method">
                <div class="title" id="M001419">
                    
                    <a name="M001419"></a><b>column_names</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001419_source')" id="l_M001419_source">show</a>
                        
                    </p>
                    <div id="M001419_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activerecord-3.2.1/lib/active_record/fixtures.rb, line 640</span>
640:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">column_names</span>
641:         <span class="ruby-ivar">@column_names</span> <span class="ruby-operator">||=</span> <span class="ruby-ivar">@connection</span>.<span class="ruby-identifier">columns</span>(<span class="ruby-ivar">@table_name</span>).<span class="ruby-identifier">collect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> }
642:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001416">
                    
                    <a name="M001416"></a><b>has_primary_key_column?</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001416_source')" id="l_M001416_source">show</a>
                        
                    </p>
                    <div id="M001416_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activerecord-3.2.1/lib/active_record/fixtures.rb, line 626</span>
626:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">has_primary_key_column?</span>
627:         <span class="ruby-ivar">@has_primary_key_column</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">primary_key_name</span> <span class="ruby-operator">&amp;&amp;</span>
628:           <span class="ruby-identifier">model_class</span>.<span class="ruby-identifier">columns</span>.<span class="ruby-identifier">any?</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">primary_key_name</span> }
629:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001418">
                    
                    <a name="M001418"></a><b>inheritance_column_name</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001418_source')" id="l_M001418_source">show</a>
                        
                    </p>
                    <div id="M001418_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activerecord-3.2.1/lib/active_record/fixtures.rb, line 636</span>
636:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">inheritance_column_name</span>
637:         <span class="ruby-ivar">@inheritance_column_name</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">model_class</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">model_class</span>.<span class="ruby-identifier">inheritance_column</span>
638:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001415">
                    
                    <a name="M001415"></a><b>primary_key_name</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001415_source')" id="l_M001415_source">show</a>
                        
                    </p>
                    <div id="M001415_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activerecord-3.2.1/lib/active_record/fixtures.rb, line 622</span>
622:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">primary_key_name</span>
623:         <span class="ruby-ivar">@primary_key_name</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">model_class</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">model_class</span>.<span class="ruby-identifier">primary_key</span>
624:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001420">
                    
                    <a name="M001420"></a><b>read_fixture_files</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001420_source')" id="l_M001420_source">show</a>
                        
                    </p>
                    <div id="M001420_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activerecord-3.2.1/lib/active_record/fixtures.rb, line 644</span>
644:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">read_fixture_files</span>
645:         <span class="ruby-identifier">yaml_files</span> = <span class="ruby-constant">Dir</span>[<span class="ruby-node">&quot;#{@fixture_path}/**/*.yml&quot;</span>].<span class="ruby-identifier">select</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span>
646:           <span class="ruby-operator">::</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">file?</span>(<span class="ruby-identifier">f</span>)
647:         } <span class="ruby-operator">+</span> [<span class="ruby-identifier">yaml_file_path</span>]
648: 
649:         <span class="ruby-identifier">yaml_files</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span>
650:           <span class="ruby-constant">Fixtures</span><span class="ruby-operator">::</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">file</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">fh</span><span class="ruby-operator">|</span>
651:             <span class="ruby-identifier">fh</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">name</span>, <span class="ruby-identifier">row</span><span class="ruby-operator">|</span>
652:               <span class="ruby-identifier">fixtures</span>[<span class="ruby-identifier">name</span>] = <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Fixture</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">row</span>, <span class="ruby-identifier">model_class</span>)
653:             <span class="ruby-keyword kw">end</span>
654:           <span class="ruby-keyword kw">end</span>
655:         <span class="ruby-keyword kw">end</span>
656:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001417">
                    
                    <a name="M001417"></a><b>timestamp_column_names</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001417_source')" id="l_M001417_source">show</a>
                        
                    </p>
                    <div id="M001417_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activerecord-3.2.1/lib/active_record/fixtures.rb, line 631</span>
631:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">timestamp_column_names</span>
632:         <span class="ruby-ivar">@timestamp_column_names</span> <span class="ruby-operator">||=</span>
633:           <span class="ruby-node">%w(created_at created_on updated_at updated_on)</span> <span class="ruby-operator">&amp;</span> <span class="ruby-identifier">column_names</span>
634:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001421">
                    
                    <a name="M001421"></a><b>yaml_file_path</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001421_source')" id="l_M001421_source">show</a>
                        
                    </p>
                    <div id="M001421_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activerecord-3.2.1/lib/active_record/fixtures.rb, line 658</span>
658:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">yaml_file_path</span>
659:         <span class="ruby-node">&quot;#{@fixture_path}.yml&quot;</span>
660:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001422">
                    
                    <a name="M001422"></a><b>yaml_fixtures_key</b>(path)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001422_source')" id="l_M001422_source">show</a>
                        
                    </p>
                    <div id="M001422_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activerecord-3.2.1/lib/active_record/fixtures.rb, line 662</span>
662:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">yaml_fixtures_key</span>(<span class="ruby-identifier">path</span>)
663:         <span class="ruby-operator">::</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">basename</span>(<span class="ruby-ivar">@fixture_path</span>).<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;.&quot;</span>).<span class="ruby-identifier">first</span>
664:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    