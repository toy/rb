<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>compile</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../../../css/main.css" type="text/css" media="screen" />
    <script src="../../../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            compile
        </h1>
        <ul class="files">
            <li>ext/ffi_c/libffi/compile</li>
            <li>Last modified: Sun Nov 27 22:44:59 +0100 2011</li>
        </ul>
    </div>

    <div id="bodyContent">
        <div id="content">
    
    <div class="description">
        <p>
#! /bin/sh # Wrapper for compilers which do not understand `-c -o&#8217;.
</p>
<p>
scriptversion=2005-05-14.22
</p>
<p>
# Copyright (C) 1999, 2000, 2003, 2004, 2005 Free Software Foundation, Inc.
# Written by Tom Tromey <tromey@cygnus.com>. # # This program is free
software; you can redistribute it and/or modify # it under the terms of the
GNU General Public License as published by # the Free Software Foundation;
either version 2, or (at your option) # any later version. # # This program
is distributed in the hope that it will be useful, # but WITHOUT ANY
WARRANTY; without even the implied warranty of # MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE. See the # GNU General Public License for more
details. # # You should have received a copy of the GNU General Public
License # along with this program; if not, write to the Free Software #
Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301,
USA.
</p>
<p>
# As a special exception to the GNU General Public License, if you #
distribute this file as part of a program that contains a # configuration
script generated by Autoconf, you may include it under # the same
distribution terms that you use for the rest of that program.
</p>
<p>
# This file is maintained in Automake, please report # bugs to
<bug-automake@gnu.org> or send patches to # <automake-patches@gnu.org>.
</p>
<p>
case $1 in
</p>
<pre>
  '')
     echo &quot;$0: No command.  Try \`$0 --help' for more information.&quot; 1&gt;&amp;2
     exit 1;
     ;;
  -h | --h*)
    cat &lt;&lt;\EOF
</pre>
<p>
Usage: compile [&#8212;help] [&#8212;version] PROGRAM [ARGS]
</p>
<p>
Wrapper for compilers which do not understand `-c -o&#8217;. Remove `-o
dest.o&#8217; from ARGS, run PROGRAM with the remaining arguments, and
rename the output as expected.
</p>
<p>
If you are trying to build a whole package this is not the right script to
run: please start by reading the file `INSTALL&#8217;.
</p>
<p>
Report bugs to <bug-automake@gnu.org>. EOF
</p>
<pre>
    exit $?
    ;;
  -v | --v*)
    echo &quot;compile $scriptversion&quot;
    exit $?
    ;;
</pre>
<p>
esac
</p>
<p>
ofile= cfile= eat=
</p>
<p>
for arg do
</p>
<pre>
  if test -n &quot;$eat&quot;; then
    eat=
  else
    case $1 in
      -o)
        # configure might choose to run compile as `compile cc -o foo foo.c'.
        # So we strip `-o arg' only if arg is an object.
        eat=1
        case $2 in
          *.o | *.obj)
            ofile=$2
            ;;
          *)
            set x &quot;$@&quot; -o &quot;$2&quot;
            shift
            ;;
        esac
        ;;
      *.c)
        cfile=$1
        set x &quot;$@&quot; &quot;$1&quot;
        shift
        ;;
      *)
        set x &quot;$@&quot; &quot;$1&quot;
        shift
        ;;
    esac
  fi
  shift
</pre>
<p>
done
</p>
<p>
if test -z &#8220;$ofile&#8221; || test -z &#8220;$cfile&#8221;; then
</p>
<pre>
  # If no `-o' option was seen then we might have been invoked from a
  # pattern rule where we don't need one.  That is ok -- this is a
  # normal compilation that the losing compiler can handle.  If no
  # `.c' file was seen then we are probably linking.  That is also
  # ok.
  exec &quot;$@&quot;
</pre>
<p>
fi
</p>
<p>
# Name of file we expect compiler to create. cofile=`echo
&#8220;$cfile&#8221; | sed -e &#8217;s|^.*/||&#8217; -e
&#8217;s/.c$/.o/&#8217;`
</p>
<p>
# Create the lock directory. # Note: use `[/.-]&#8217; here to ensure that
we don&#8217;t use the same name # that we are using for the .o file. Also,
base the name on the expected # object file name, since that is what
matters with a parallel build. lockdir=`echo &#8220;$cofile&#8221; | sed -e
&#8216;<a href="http:///.-">s|</a>|_|g&#8217;`.d while true; do
</p>
<pre>
  if mkdir &quot;$lockdir&quot; &gt;/dev/null 2&gt;&amp;1; then
    break
  fi
  sleep 1
</pre>
<p>
done # FIXME: race condition here if user kills between mkdir and trap.
trap &#8220;rmdir &#8217;$lockdir&#8217;; exit 1&#8221; 1 2 15
</p>
<p>
# Run the compile. &#8220;$@&#8221; ret=$?
</p>
<p>
if test -f &#8220;$cofile&#8221;; then
</p>
<pre>
  mv &quot;$cofile&quot; &quot;$ofile&quot;
</pre>
<p>
elif test -f &#8220;${cofile}bj&#8221;; then
</p>
<pre>
  mv &quot;${cofile}bj&quot; &quot;$ofile&quot;
</pre>
<p>
fi
</p>
<p>
rmdir &#8220;$lockdir&#8221; exit $ret
</p>
<p>
# Local Variables: # mode: shell-script # sh-indentation: 2 # eval:
(add-hook &#8216;write-file-hooks &#8216;time-stamp) # time-stamp-start:
&#8220;scriptversion=&#8221; # time-stamp-format:
&#8220;%:y-%02m-%02d.%02H&#8221; # time-stamp-end: &#8220;$&#8221; # End:
</p>

    </div>
    

    

    
    

    
    

    

    

    

    

    

    
</div>
    </div>
  </body>
</html>