<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>configure.ac</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../../../css/main.css" type="text/css" media="screen" />
    <script src="../../../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            configure.ac
        </h1>
        <ul class="files">
            <li>ext/ffi_c/libffi/configure.ac</li>
            <li>Last modified: Sun Nov 27 22:44:59 +0100 2011</li>
        </ul>
    </div>

    <div id="bodyContent">
        <div id="content">
    
    <div class="description">
        <p>
dnl Process this with autoconf to create configure
</p>
<p>
AC_PREREQ(2.63)
</p>
<p>
AC_INIT([libffi], [3.0.9], [<a
href="http://gcc.gnu.org/bugs.html">gcc.gnu.org/bugs.html</a>]) <a
href="http://fficonfig.h">AC_CONFIG_HEADERS(</a>)
</p>
<p>
AC_CANONICAL_SYSTEM target_alias=${target_alias-$host_alias}
</p>
<p>
. ${srcdir}/configure.host
</p>
<p>
AM_INIT_AUTOMAKE
</p>
<p>
# The same as in boehm-gc and libstdc++. Have to borrow it from there. # We
must force CC to /not/ be precious variables; otherwise # the wrong,
non-multilib-adjusted value will be used in multilibs. # As a side effect,
we have to subst CFLAGS ourselves.
</p>
<p>
m4_rename([_AC_ARG_VAR_PRECIOUS],[real_PRECIOUS])
m4_define([_AC_ARG_VAR_PRECIOUS],[]) AC_PROG_CC
m4_undefine([_AC_ARG_VAR_PRECIOUS])
m4_rename([real_PRECIOUS],[_AC_ARG_VAR_PRECIOUS])
</p>
<p>
AC_SUBST(CFLAGS)
</p>
<p>
AM_PROG_AS AM_PROG_CC_C_O AC_PROG_LIBTOOL AC_CONFIG_MACRO_DIR([m4])
</p>
<p>
AM_MAINTAINER_MODE
</p>
<p>
AC_CHECK_HEADERS(sys/mman.h) AC_CHECK_FUNCS(mmap) AC_FUNC_MMAP_BLACKLIST
</p>
<p>
dnl The -no-testsuite modules omit the test subdir.
AM_CONDITIONAL(TESTSUBDIR, test -d $srcdir/testsuite)
</p>
<p>
TARGETDIR=&#8220;unknown&#8221; case &#8220;$host&#8221; in
</p>
<pre>
  alpha*-*-*)
        TARGET=ALPHA; TARGETDIR=alpha;
        # Support 128-bit long double, changable via command-line switch.
        HAVE_LONG_DOUBLE='defined(__LONG_DOUBLE_128__)'
        ;;

  arm*-*-*)
        TARGET=ARM; TARGETDIR=arm
        ;;

  amd64-*-freebsd* | amd64-*-openbsd*)
        TARGET=X86_64; TARGETDIR=x86
        ;;

  avr32*-*-*)
        TARGET=AVR32; TARGETDIR=avr32
        ;;

  cris-*-*)
        TARGET=LIBFFI_CRIS; TARGETDIR=cris
        ;;

  frv-*-*)
        TARGET=FRV; TARGETDIR=frv
        ;;

  hppa*-*-linux* | parisc*-*-linux*)
        TARGET=PA_LINUX; TARGETDIR=pa
        ;;
  hppa*64-*-hpux*)
        TARGET=PA64_HPUX; TARGETDIR=pa
        ;;
  hppa*-*-hpux*)
        TARGET=PA_HPUX; TARGETDIR=pa
        ;;

  i?86-*-freebsd* | i?86-*-openbsd*)
        TARGET=X86_FREEBSD; TARGETDIR=x86
        ;;
  i?86-win32* | i?86-*-cygwin* | i?86-*-mingw*)
        TARGET=X86_WIN32; TARGETDIR=x86
        # All mingw/cygwin/win32 builds require this for sharedlib
        AM_LTLDFLAGS=&quot;-no-undefined&quot;
        ;;
  i?86-*-darwin*)
        TARGET=X86_DARWIN; TARGETDIR=x86
        ;;
  i?86-*-solaris2.1[[0-9]]*)
        TARGET=X86_64; TARGETDIR=x86
        ;;
  i?86-*-*)
        TARGET=X86; TARGETDIR=x86
        ;;

  ia64*-*-*)
        TARGET=IA64; TARGETDIR=ia64
        ;;

  m32r*-*-*)
        TARGET=M32R; TARGETDIR=m32r
        ;;

  m68k-*-*)
        TARGET=M68K; TARGETDIR=m68k
        ;;

  mips-sgi-irix5.* | mips-sgi-irix6.*)
        TARGET=MIPS; TARGETDIR=mips
        ;;
  mips*-*-linux*)
        # Support 128-bit long double for NewABI.
        HAVE_LONG_DOUBLE='defined(__mips64)'
        TARGET=MIPS; TARGETDIR=mips
        ;;

  powerpc*-*-linux* | powerpc-*-sysv*)
        TARGET=POWERPC; TARGETDIR=powerpc
        ;;
  powerpc-*-beos*)
        TARGET=POWERPC; TARGETDIR=powerpc
        ;;
  powerpc-*-darwin*)
        TARGET=POWERPC_DARWIN; TARGETDIR=powerpc
        ;;
  powerpc-*-aix* | rs6000-*-aix*)
        TARGET=POWERPC_AIX; TARGETDIR=powerpc
        ;;
  powerpc-*-freebsd*)
        TARGET=POWERPC_FREEBSD; TARGETDIR=powerpc
        ;;
  powerpc*-*-rtems*)
        TARGET=POWERPC; TARGETDIR=powerpc
        ;;

  s390-*-* | s390x-*-*)
        TARGET=S390; TARGETDIR=s390
        ;;

  sh-*-* | sh[[34]]*-*-*)
        TARGET=SH; TARGETDIR=sh
        ;;
  sh64-*-* | sh5*-*-*)
        TARGET=SH64; TARGETDIR=sh64
        ;;

  sparc*-*-*)
        TARGET=SPARC; TARGETDIR=sparc
        ;;

  x86_64-*-darwin*)
        TARGET=X86_DARWIN; TARGETDIR=x86
        ;;

  x86_64-*-cygwin* | x86_64-*-mingw*)
        TARGET=X86_WIN64; TARGETDIR=x86
        ;;

  x86_64-*-*)
        TARGET=X86_64; TARGETDIR=x86
        ;;
</pre>
<p>
esac
</p>
<p>
AC_SUBST(AM_RUNTESTFLAGS) AC_SUBST(AM_LTLDFLAGS)
</p>
<p>
if test $TARGETDIR = unknown; then
</p>
<pre>
  AC_MSG_ERROR([&quot;libffi has not been ported to $host.&quot;])
</pre>
<p>
fi
</p>
<p>
AM_CONDITIONAL(MIPS, test x$TARGET = xMIPS) AM_CONDITIONAL(SPARC, test
x$TARGET = xSPARC) AM_CONDITIONAL(X86, test x$TARGET = xX86)
AM_CONDITIONAL(X86_FREEBSD, test x$TARGET = xX86_FREEBSD)
AM_CONDITIONAL(X86_WIN32, test x$TARGET = xX86_WIN32)
AM_CONDITIONAL(X86_WIN64, test x$TARGET = xX86_WIN64)
AM_CONDITIONAL(X86_DARWIN, test x$TARGET = xX86_DARWIN)
AM_CONDITIONAL(ALPHA, test x$TARGET = xALPHA) AM_CONDITIONAL(IA64, test
x$TARGET = xIA64) AM_CONDITIONAL(M32R, test x$TARGET = xM32R)
AM_CONDITIONAL(M68K, test x$TARGET = xM68K) AM_CONDITIONAL(POWERPC, test
x$TARGET = xPOWERPC) AM_CONDITIONAL(POWERPC_AIX, test x$TARGET =
xPOWERPC_AIX) AM_CONDITIONAL(POWERPC_DARWIN, test x$TARGET =
xPOWERPC_DARWIN) AM_CONDITIONAL(POWERPC_FREEBSD, test x$TARGET =
xPOWERPC_FREEBSD) AM_CONDITIONAL(ARM, test x$TARGET = xARM)
AM_CONDITIONAL(AVR32, test x$TARGET = xAVR32) AM_CONDITIONAL(LIBFFI_CRIS,
test x$TARGET = xLIBFFI_CRIS) AM_CONDITIONAL(FRV, test x$TARGET = xFRV)
AM_CONDITIONAL(S390, test x$TARGET = xS390) AM_CONDITIONAL(X86_64, test
x$TARGET = xX86_64) AM_CONDITIONAL(SH, test x$TARGET = xSH)
AM_CONDITIONAL(SH64, test x$TARGET = xSH64) AM_CONDITIONAL(PA_LINUX, test
x$TARGET = xPA_LINUX) AM_CONDITIONAL(PA_HPUX, test x$TARGET = xPA_HPUX)
AM_CONDITIONAL(PA64_HPUX, test x$TARGET = xPA64_HPUX)
</p>
<p>
AC_HEADER_STDC AC_CHECK_FUNCS(memcpy) AC_FUNC_ALLOCA
</p>
<p>
AC_CHECK_SIZEOF(double) AC_CHECK_SIZEOF(long double)
</p>
<p>
# Also AC_SUBST this variable for ffi.h. if test -z
&#8220;$HAVE_LONG_DOUBLE&#8220;; then
</p>
<pre>
  HAVE_LONG_DOUBLE=0
  if test $ac_cv_sizeof_double != $ac_cv_sizeof_long_double; then
    if test $ac_cv_sizeof_long_double != 0; then
      HAVE_LONG_DOUBLE=1
      AC_DEFINE(HAVE_LONG_DOUBLE, 1, [Define if you have the long double type and it is bigger than a double])
    fi
  fi
</pre>
<p>
fi AC_SUBST(HAVE_LONG_DOUBLE)
</p>
<p>
AC_C_BIGENDIAN
</p>
<p>
AC_CACHE_CHECK([assembler .cfi pseudo-op support],
</p>
<pre>
    libffi_cv_as_cfi_pseudo_op, [
    libffi_cv_as_cfi_pseudo_op=unknown
    AC_TRY_COMPILE([asm (&quot;.cfi_startproc\n\t.cfi_endproc&quot;);],,
                   [libffi_cv_as_cfi_pseudo_op=yes],
                   [libffi_cv_as_cfi_pseudo_op=no])
</pre>
<p>
]) if test &#8220;x$libffi_cv_as_cfi_pseudo_op&#8220; = xyes; then
</p>
<pre>
    AC_DEFINE(HAVE_AS_CFI_PSEUDO_OP, 1,
              [Define if your assembler supports .cfi_* directives.])
</pre>
<p>
fi
</p>
<p>
if test x$TARGET = xSPARC; then
</p>
<pre>
    AC_CACHE_CHECK([assembler and linker support unaligned pc related relocs],
        libffi_cv_as_sparc_ua_pcrel, [
        save_CFLAGS=&quot;$CFLAGS&quot;
        save_LDFLAGS=&quot;$LDFLAGS&quot;
        CFLAGS=&quot;$CFLAGS -fpic&quot;
        LDFLAGS=&quot;$LDFLAGS -shared&quot;
        AC_TRY_LINK([asm (&quot;.text; foo: nop; .data; .align 4; .byte 0; .uaword %r_disp32(foo); .text&quot;);],,
                    [libffi_cv_as_sparc_ua_pcrel=yes],
                    [libffi_cv_as_sparc_ua_pcrel=no])
        CFLAGS=&quot;$save_CFLAGS&quot;
        LDFLAGS=&quot;$save_LDFLAGS&quot;])
    if test &quot;x$libffi_cv_as_sparc_ua_pcrel&quot; = xyes; then
        AC_DEFINE(HAVE_AS_SPARC_UA_PCREL, 1,
                  [Define if your assembler and linker support unaligned PC relative relocs.])
    fi

    AC_CACHE_CHECK([assembler .register pseudo-op support],
       libffi_cv_as_register_pseudo_op, [
       libffi_cv_as_register_pseudo_op=unknown
       # Check if we have .register
       AC_TRY_COMPILE([asm (&quot;.register %g2, #scratch&quot;);],,
                       [libffi_cv_as_register_pseudo_op=yes],
                       [libffi_cv_as_register_pseudo_op=no])
    ])
    if test &quot;x$libffi_cv_as_register_pseudo_op&quot; = xyes; then
       AC_DEFINE(HAVE_AS_REGISTER_PSEUDO_OP, 1,
               [Define if your assembler supports .register.])
    fi
</pre>
<p>
fi
</p>
<p>
if test x$TARGET = xX86 || test x$TARGET = xX86_WIN32 || test x$TARGET =
xX86_64; then
</p>
<pre>
    AC_CACHE_CHECK([assembler supports pc related relocs],
        libffi_cv_as_x86_pcrel, [
        libffi_cv_as_x86_pcrel=yes
        echo '.text; foo: nop; .data; .long foo-.; .text' &gt; conftest.s
        if $CC $CFLAGS -c conftest.s 2&gt;&amp;1 | grep -i warning &gt; /dev/null; then
            libffi_cv_as_x86_pcrel=no
        fi
        ])
    if test &quot;x$libffi_cv_as_x86_pcrel&quot; = xyes; then
        AC_DEFINE(HAVE_AS_X86_PCREL, 1,
                  [Define if your assembler supports PC relative relocs.])
    fi
</pre>
<p>
fi
</p>
<p>
case &#8220;$target&#8221; in
</p>
<pre>
     *-apple-darwin10* | *-*-freebsd* | *-*-openbsd* | *-pc-solaris*)
       AC_DEFINE(FFI_MMAP_EXEC_WRIT, 1,
                 [Cannot use malloc on this target, so, we revert to
                   alternative means])
     ;;
</pre>
<p>
esac
</p>
<p>
AC_CACHE_CHECK([whether .eh_frame section should be read-only],
</p>
<pre>
    libffi_cv_ro_eh_frame, [
        libffi_cv_ro_eh_frame=no
        echo 'extern void foo (void); void bar (void) { foo (); foo (); }' &gt; conftest.c
        if $CC $CFLAGS -S -fpic -fexceptions -o conftest.s conftest.c &gt; /dev/null 2&gt;&amp;1; then
            if grep '.section.*eh_frame.*&quot;a&quot;' conftest.s &gt; /dev/null; then
                libffi_cv_ro_eh_frame=yes
            elif grep '.section.*eh_frame.*#alloc' conftest.c \
                 | grep -v '#write' &gt; /dev/null; then
                libffi_cv_ro_eh_frame=yes
            fi
        fi
        rm -f conftest.*
    ])
</pre>
<p>
if test &#8220;x$libffi_cv_ro_eh_frame&#8220; = xyes; then
</p>
<pre>
    AC_DEFINE(HAVE_RO_EH_FRAME, 1,
              [Define if .eh_frame sections should be read-only.])
    AC_DEFINE(EH_FRAME_FLAGS, &quot;a&quot;,
              [Define to the flags needed for the .section .eh_frame directive.])
</pre>
<p>
else
</p>
<pre>
    AC_DEFINE(EH_FRAME_FLAGS, &quot;aw&quot;,
              [Define to the flags needed for the .section .eh_frame directive.])
</pre>
<p>
fi
</p>
<p>
AC_CACHE_CHECK([for
<em>attribute</em>((visibility(&#8220;hidden&#8221;)))],
</p>
<pre>
    libffi_cv_hidden_visibility_attribute, [
        echo 'int __attribute__ ((visibility (&quot;hidden&quot;))) foo (void) { return 1; }' &gt; conftest.c
        libffi_cv_hidden_visibility_attribute=no
        if AC_TRY_COMMAND(${CC-cc} -Werror -S conftest.c -o conftest.s 1&gt;&amp;AS_MESSAGE_LOG_FD); then
            if grep '\.hidden.*foo' conftest.s &gt;/dev/null; then
                libffi_cv_hidden_visibility_attribute=yes
            fi
        fi
        rm -f conftest.*
    ])
</pre>
<p>
if test $libffi_cv_hidden_visibility_attribute = yes; then
</p>
<pre>
    AC_DEFINE(HAVE_HIDDEN_VISIBILITY_ATTRIBUTE, 1,
              [Define if __attribute__((visibility(&quot;hidden&quot;))) is supported.])
</pre>
<p>
fi
</p>
<p>
AH_BOTTOM([ ifdef HAVE_HIDDEN_VISIBILITY_ATTRIBUTE ifdef LIBFFI_ASM define
FFI_HIDDEN(name) .hidden name else define FFI_HIDDEN <em>attribute</em>
((visibility (&#8220;hidden&#8221;))) endif else ifdef LIBFFI_ASM define
FFI_HIDDEN(name) else define FFI_HIDDEN endif endif ])
</p>
<p>
AC_SUBST(TARGET) AC_SUBST(TARGETDIR)
</p>
<p>
AC_SUBST(SHELL)
</p>
<p>
AC_ARG_ENABLE(debug, [ &#8212;enable-debug debugging mode],
</p>
<pre>
  if test &quot;$enable_debug&quot; = &quot;yes&quot;; then
    AC_DEFINE(FFI_DEBUG, 1, [Define this if you want extra debugging.])
  fi)
</pre>
<p>
AC_ARG_ENABLE(structs, [ &#8212;disable-structs omit code for struct
support],
</p>
<pre>
  if test &quot;$enable_structs&quot; = &quot;no&quot;; then
    AC_DEFINE(FFI_NO_STRUCTS, 1, [Define this is you do not want support for aggregate types.])
  fi)
</pre>
<p>
AC_ARG_ENABLE(raw-api, [ &#8212;disable-raw-api make the raw api
unavailable],
</p>
<pre>
  if test &quot;$enable_raw_api&quot; = &quot;no&quot;; then
    AC_DEFINE(FFI_NO_RAW_API, 1, [Define this is you do not want support for the raw API.])
  fi)
</pre>
<p>
AC_ARG_ENABLE(purify-safety, [ &#8212;enable-purify-safety purify-safe
mode],
</p>
<pre>
  if test &quot;$enable_purify_safety&quot; = &quot;yes&quot;; then
    AC_DEFINE(USING_PURIFY, 1, [Define this if you are using Purify and want to suppress spurious messages.])
  fi)
</pre>
<p>
if test -n &#8220;$with_cross_host&#8220; &amp;&amp;
</p>
<pre>
   test x&quot;$with_cross_host&quot; != x&quot;no&quot;; then
  toolexecdir='$(exec_prefix)/$(target_alias)'
  toolexeclibdir='$(toolexecdir)/lib'
</pre>
<p>
else
</p>
<pre>
  toolexecdir='$(libdir)/gcc-lib/$(target_alias)'
  toolexeclibdir='$(libdir)'
</pre>
<p>
fi multi_os_directory=`$CC -print-multi-os-directory` case
$multi_os_directory in
</p>
<pre>
  .) ;; # Avoid trailing /.
  *) toolexeclibdir=$toolexeclibdir/$multi_os_directory ;;
</pre>
<p>
esac AC_SUBST(toolexecdir) AC_SUBST(toolexeclibdir)
</p>
<p>
if test &#8220;${multilib}&#8221; = &#8220;yes&#8221;; then
</p>
<pre>
  multilib_arg=&quot;--enable-multilib&quot;
</pre>
<p>
else
</p>
<pre>
  multilib_arg=
</pre>
<p>
fi
</p>
<p>
AC_CONFIG_COMMANDS(include, [test -d include || mkdir include])
AC_CONFIG_COMMANDS(src, [ test -d src || mkdir src test -d src/$TARGETDIR
|| mkdir src/$TARGETDIR ], [TARGETDIR=&#8221;$TARGETDIR&#8221;])
</p>
<p>
AC_CONFIG_LINKS(include/ffitarget.h:src/$TARGETDIR/ffitarget.h)
</p>
<p>
AC_CONFIG_FILES(include/Makefile include/ffi.h Makefile testsuite/Makefile
man/Makefile libffi.pc)
</p>
<p>
AC_OUTPUT
</p>

    </div>
    

    

    
    

    
    

    

    

    

    

    

    
</div>
    </div>
  </body>
</html>