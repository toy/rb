<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>ActiveRecord::Associations::ClassMethods</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../../css/main.css" type="text/css" media="screen" />
    <script src="../../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Module</span> 
            ActiveRecord::Associations::ClassMethods 
            
        </h1>
        <ul class="files">
            
            <li><a href="../../../files/activerecord-2_3_14/lib/active_record/associations_rb.html">activerecord-2.3.14/lib/active_record/associations.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    
    <div class="description">
        <p>
Associations are a set of macro-like class methods for tying objects
together through foreign keys. They express relationships like
&#8220;Project has one Project Manager&#8221; or &#8220;Project belongs to
a Portfolio&#8221;. Each macro adds a number of methods to the class which
are specialized according to the collection or association symbol and the
options hash. It works much the same way as Ruby&#8217;s own <tt>attr*</tt>
methods. Example:
</p>
<pre>
  class Project &lt; ActiveRecord::Base
    belongs_to              :portfolio
    has_one                 :project_manager
    has_many                :milestones
    has_and_belongs_to_many :categories
  end
</pre>
<p>
The project class now has the following methods (and more) to ease the
traversal and manipulation of its relationships:
</p>
<ul>
<li><tt>Project#portfolio, Project#portfolio=(portfolio),
Project#portfolio.nil?</tt>

</li>
<li><tt>Project#project_manager, Project#project_manager=(project_manager),
Project#project_manager.nil?,</tt>

</li>
<li><tt>Project#milestones.empty?, Project#milestones.size, Project#milestones,
Project#milestones&lt;&lt;(milestone),</tt>
<tt>Project#milestones.delete(milestone),
Project#milestones.find(milestone_id), Project#milestones.find(:all,
options),</tt> <tt>Project#milestones.build, Project#milestones.create</tt>

</li>
<li><tt>Project#categories.empty?, Project#categories.size, Project#categories,
Project#categories&lt;&lt;(category1),</tt>
<tt>Project#categories.delete(category1)</tt>

</li>
</ul>
<h3>A word of warning</h3>
<p>
Don&#8217;t create associations that have the same name as instance methods
of <a href="../Base.html">ActiveRecord::Base</a>. Since the association
adds a method with that name to its model, it will override the inherited
method and break things. For instance, <tt>attributes</tt> and
<tt>connection</tt> would be bad choices for association names.
</p>
<h2>Auto-generated methods</h2>
<h3>Singular associations (one-to-one)</h3>
<pre>
                                    |            |  belongs_to  |
  generated methods                 | belongs_to | :polymorphic | has_one
  ----------------------------------+------------+--------------+---------
  other                             |     X      |      X       |    X
  other=(other)                     |     X      |      X       |    X
  build_other(attributes={})        |     X      |              |    X
  create_other(attributes={})       |     X      |              |    X
  other.create!(attributes={})      |            |              |    X
</pre>
<h3>Collection associations (one-to-many / many-to-many)</h3>
<pre>
                                    |       |          | has_many
  generated methods                 | habtm | has_many | :through
  ----------------------------------+-------+----------+----------
  others                            |   X   |    X     |    X
  others=(other,other,...)          |   X   |    X     |    X
  other_ids                         |   X   |    X     |    X
  other_ids=(id,id,...)             |   X   |    X     |    X
  others&lt;&lt;                          |   X   |    X     |    X
  others.push                       |   X   |    X     |    X
  others.concat                     |   X   |    X     |    X
  others.build(attributes={})       |   X   |    X     |    X
  others.create(attributes={})      |   X   |    X     |    X
  others.create!(attributes={})     |   X   |    X     |    X
  others.size                       |   X   |    X     |    X
  others.length                     |   X   |    X     |    X
  others.count                      |   X   |    X     |    X
  others.sum(args*,&amp;block)          |   X   |    X     |    X
  others.empty?                     |   X   |    X     |    X
  others.clear                      |   X   |    X     |    X
  others.delete(other,other,...)    |   X   |    X     |    X
  others.delete_all                 |   X   |    X     |
  others.destroy_all                |   X   |    X     |    X
  others.find(*args)                |   X   |    X     |    X
  others.find_first                 |   X   |          |
  others.exists?                    |   X   |    X     |    X
  others.uniq                       |   X   |    X     |    X
  others.reset                      |   X   |    X     |    X
</pre>
<h2>Cardinality and associations</h2>
<p>
Active Record associations can be used to describe one-to-one, one-to-many
and many-to-many relationships between models. Each model uses an
association to describe its role in the relation. The <tt><a
href="ClassMethods.html#M000411">belongs_to</a></tt> association is always
used in the model that has the foreign key.
</p>
<h3>One-to-one</h3>
<p>
Use <tt><a href="ClassMethods.html#M000410">has_one</a></tt> in the base,
and <tt><a href="ClassMethods.html#M000411">belongs_to</a></tt> in the
associated model.
</p>
<pre>
  class Employee &lt; ActiveRecord::Base
    has_one :office
  end
  class Office &lt; ActiveRecord::Base
    belongs_to :employee    # foreign key - employee_id
  end
</pre>
<h3>One-to-many</h3>
<p>
Use <tt><a href="ClassMethods.html#M000409">has_many</a></tt> in the base,
and <tt><a href="ClassMethods.html#M000411">belongs_to</a></tt> in the
associated model.
</p>
<pre>
  class Manager &lt; ActiveRecord::Base
    has_many :employees
  end
  class Employee &lt; ActiveRecord::Base
    belongs_to :manager     # foreign key - manager_id
  end
</pre>
<h3>Many-to-many</h3>
<p>
There are two ways to build a many-to-many relationship.
</p>
<p>
The first way uses a <tt><a
href="ClassMethods.html#M000409">has_many</a></tt> association with the
<tt>:through</tt> option and a join model, so there are two stages of
associations.
</p>
<pre>
  class Assignment &lt; ActiveRecord::Base
    belongs_to :programmer  # foreign key - programmer_id
    belongs_to :project     # foreign key - project_id
  end
  class Programmer &lt; ActiveRecord::Base
    has_many :assignments
    has_many :projects, :through =&gt; :assignments
  end
  class Project &lt; ActiveRecord::Base
    has_many :assignments
    has_many :programmers, :through =&gt; :assignments
  end
</pre>
<p>
For the second way, use <tt><a
href="ClassMethods.html#M000412">has_and_belongs_to_many</a></tt> in both
models. This requires a join table that has no corresponding model or
primary key.
</p>
<pre>
  class Programmer &lt; ActiveRecord::Base
    has_and_belongs_to_many :projects       # foreign keys in the join table
  end
  class Project &lt; ActiveRecord::Base
    has_and_belongs_to_many :programmers    # foreign keys in the join table
  end
</pre>
<p>
Choosing which way to build a many-to-many relationship is not always
simple. If you need to work with the relationship model as its own entity,
use <tt><a href="ClassMethods.html#M000409">has_many</a> :through</tt>. Use
<tt><a href="ClassMethods.html#M000412">has_and_belongs_to_many</a></tt>
when working with legacy schemas or when you never work directly with the
relationship itself.
</p>
<h2>Is it a <tt><a href="ClassMethods.html#M000411">belongs_to</a></tt> or <tt><a href="ClassMethods.html#M000410">has_one</a></tt> association?</h2>
<p>
Both express a 1-1 relationship. The difference is mostly where to place
the foreign key, which goes on the table for the class declaring the <tt><a
href="ClassMethods.html#M000411">belongs_to</a></tt> relationship. Example:
</p>
<pre>
  class User &lt; ActiveRecord::Base
    # I reference an account.
    belongs_to :account
  end

  class Account &lt; ActiveRecord::Base
    # One user references me.
    has_one :user
  end
</pre>
<p>
The tables for these classes could look something like:
</p>
<pre>
  CREATE TABLE users (
    id int(11) NOT NULL auto_increment,
    account_id int(11) default NULL,
    name varchar default NULL,
    PRIMARY KEY  (id)
  )

  CREATE TABLE accounts (
    id int(11) NOT NULL auto_increment,
    name varchar default NULL,
    PRIMARY KEY  (id)
  )
</pre>
<h2>Unsaved objects and associations</h2>
<p>
You can manipulate objects and associations before they are saved to the
database, but there is some special behavior you should be aware of, mostly
involving the saving of associated objects.
</p>
<p>
Unless you set the :autosave option on a <tt><a
href="ClassMethods.html#M000410">has_one</a></tt>, <tt><a
href="ClassMethods.html#M000411">belongs_to</a></tt>, <tt><a
href="ClassMethods.html#M000409">has_many</a></tt>, or <tt><a
href="ClassMethods.html#M000412">has_and_belongs_to_many</a></tt>
association. Setting it to <tt>true</tt> will <em>always</em> save the
members, whereas setting it to <tt>false</tt> will <em>never</em> save the
members.
</p>
<h3>One-to-one associations</h3>
<ul>
<li>Assigning an object to a <tt><a
href="ClassMethods.html#M000410">has_one</a></tt> association automatically
saves that object and the object being replaced (if there is one), in order
to update their primary keys - except if the parent object is unsaved
(<tt>new_record? == true</tt>).

</li>
<li>If either of these saves fail (due to one of the objects being invalid) the
assignment statement returns <tt>false</tt> and the assignment is
cancelled.

</li>
<li>If you wish to assign an object to a <tt><a
href="ClassMethods.html#M000410">has_one</a></tt> association without
saving it, use the <tt>association.build</tt> method (documented below).

</li>
<li>Assigning an object to a <tt><a
href="ClassMethods.html#M000411">belongs_to</a></tt> association does not
save the object, since the foreign key field belongs on the parent. It does
not save the parent either.

</li>
</ul>
<h3>Collections</h3>
<ul>
<li>Adding an object to a collection (<tt><a
href="ClassMethods.html#M000409">has_many</a></tt> or <tt><a
href="ClassMethods.html#M000412">has_and_belongs_to_many</a></tt>)
automatically saves that object, except if the parent object (the owner of
the collection) is not yet stored in the database.

</li>
<li>If saving any of the objects being added to a collection (via <tt>push</tt>
or similar) fails, then <tt>push</tt> returns <tt>false</tt>.

</li>
<li>You can add an object to a collection without automatically saving it by
using the <tt>collection.build</tt> method (documented below).

</li>
<li>All unsaved (<tt>new_record? == true</tt>) members of the collection are
automatically saved when the parent is saved.

</li>
</ul>
<h3>Association callbacks</h3>
<p>
Similar to the normal callbacks that hook into the lifecycle of an Active
Record object, you can also define callbacks that get triggered when you
add an object to or remove an object from an association collection.
Example:
</p>
<pre>
  class Project
    has_and_belongs_to_many :developers, :after_add =&gt; :evaluate_velocity

    def evaluate_velocity(developer)
      ...
    end
  end
</pre>
<p>
It&#8217;s possible to stack callbacks by passing them as an array.
Example:
</p>
<pre>
  class Project
    has_and_belongs_to_many :developers, :after_add =&gt; [:evaluate_velocity, Proc.new { |p, d| p.shipping_date = Time.now}]
  end
</pre>
<p>
Possible callbacks are: <tt>before_add</tt>, <tt>after_add</tt>,
<tt>before_remove</tt> and <tt>after_remove</tt>.
</p>
<p>
Should any of the <tt>before_add</tt> callbacks throw an exception, the
object does not get added to the collection. Same with the
<tt>before_remove</tt> callbacks; if an exception is thrown the object
doesn&#8217;t get removed.
</p>
<h3>Association extensions</h3>
<p>
The proxy objects that control the access to associations can be extended
through anonymous modules. This is especially beneficial for adding new
finders, creators, and other factory-type methods that are only used as
part of this association. Example:
</p>
<pre>
  class Account &lt; ActiveRecord::Base
    has_many :people do
      def find_or_create_by_name(name)
        first_name, last_name = name.split(&quot; &quot;, 2)
        find_or_create_by_first_name_and_last_name(first_name, last_name)
      end
    end
  end

  person = Account.find(:first).people.find_or_create_by_name(&quot;David Heinemeier Hansson&quot;)
  person.first_name # =&gt; &quot;David&quot;
  person.last_name  # =&gt; &quot;Heinemeier Hansson&quot;
</pre>
<p>
If you need to share the same extensions between many associations, you can
use a named extension module. Example:
</p>
<pre>
  module FindOrCreateByNameExtension
    def find_or_create_by_name(name)
      first_name, last_name = name.split(&quot; &quot;, 2)
      find_or_create_by_first_name_and_last_name(first_name, last_name)
    end
  end

  class Account &lt; ActiveRecord::Base
    has_many :people, :extend =&gt; FindOrCreateByNameExtension
  end

  class Company &lt; ActiveRecord::Base
    has_many :people, :extend =&gt; FindOrCreateByNameExtension
  end
</pre>
<p>
If you need to use multiple named extension modules, you can specify an
array of modules with the <tt>:extend</tt> option. In the case of name
conflicts between methods in the modules, methods in modules later in the
array supercede those earlier in the array. Example:
</p>
<pre>
  class Account &lt; ActiveRecord::Base
    has_many :people, :extend =&gt; [FindOrCreateByNameExtension, FindRecentExtension]
  end
</pre>
<p>
Some extensions can only be made to work with knowledge of the association
proxy&#8217;s internals. Extensions can access relevant state using
accessors on the association proxy:
</p>
<ul>
<li><tt>proxy_owner</tt> - Returns the object the association is part of.

</li>
<li><tt>proxy_reflection</tt> - Returns the reflection object that describes
the association.

</li>
<li><tt>proxy_target</tt> - Returns the associated object for <tt><a
href="ClassMethods.html#M000411">belongs_to</a></tt> and <tt><a
href="ClassMethods.html#M000410">has_one</a></tt>, or the collection of
associated objects for <tt><a
href="ClassMethods.html#M000409">has_many</a></tt> and <tt><a
href="ClassMethods.html#M000412">has_and_belongs_to_many</a></tt>.

</li>
</ul>
<h3>Association Join Models</h3>
<p>
Has Many associations can be configured with the <tt>:through</tt> option
to use an explicit join model to retrieve the data. This operates similarly
to a <tt><a
href="ClassMethods.html#M000412">has_and_belongs_to_many</a></tt>
association. The advantage is that you&#8217;re able to add validations,
callbacks, and extra attributes on the join model. Consider the following
schema:
</p>
<pre>
  class Author &lt; ActiveRecord::Base
    has_many :authorships
    has_many :books, :through =&gt; :authorships
  end

  class Authorship &lt; ActiveRecord::Base
    belongs_to :author
    belongs_to :book
  end

  @author = Author.find :first
  @author.authorships.collect { |a| a.book } # selects all books that the author's authorships belong to.
  @author.books                              # selects all books by using the Authorship join model
</pre>
<p>
You can also go through a <tt><a
href="ClassMethods.html#M000409">has_many</a></tt> association on the join
model:
</p>
<pre>
  class Firm &lt; ActiveRecord::Base
    has_many   :clients
    has_many   :invoices, :through =&gt; :clients
  end

  class Client &lt; ActiveRecord::Base
    belongs_to :firm
    has_many   :invoices
  end

  class Invoice &lt; ActiveRecord::Base
    belongs_to :client
  end

  @firm = Firm.find :first
  @firm.clients.collect { |c| c.invoices }.flatten # select all invoices for all clients of the firm
  @firm.invoices                                   # selects all invoices by going through the Client join model.
</pre>
<p>
Similarly you can go through a <tt><a
href="ClassMethods.html#M000410">has_one</a></tt> association on the join
model:
</p>
<pre>
  class Group &lt; ActiveRecord::Base
    has_many   :users
    has_many   :avatars, :through =&gt; :users
  end

  class User &lt; ActiveRecord::Base
    belongs_to :group
    has_one    :avatar
  end

  class Avatar &lt; ActiveRecord::Base
    belongs_to :user
  end

  @group = Group.first
  @group.users.collect { |u| u.avatar }.flatten # select all avatars for all users in the group
  @group.avatars                                # selects all avatars by going through the User join model.
</pre>
<p>
An important caveat with going through <tt><a
href="ClassMethods.html#M000410">has_one</a></tt> or <tt><a
href="ClassMethods.html#M000409">has_many</a></tt> associations on the join
model is that these associations are <b>read-only</b>. For example, the
following would not work following the previous example:
</p>
<pre>
  @group.avatars &lt;&lt; Avatar.new                # this would work if User belonged_to Avatar rather than the other way around.
  @group.avatars.delete(@group.avatars.last)  # so would this
</pre>
<h3>Polymorphic Associations</h3>
<p>
Polymorphic associations on models are not restricted on what types of
models they can be associated with. Rather, they specify an interface that
a <tt><a href="ClassMethods.html#M000409">has_many</a></tt> association
must adhere to.
</p>
<pre>
  class Asset &lt; ActiveRecord::Base
    belongs_to :attachable, :polymorphic =&gt; true
  end

  class Post &lt; ActiveRecord::Base
    has_many :assets, :as =&gt; :attachable         # The :as option specifies the polymorphic interface to use.
  end

  @asset.attachable = @post
</pre>
<p>
This works by using a type column in addition to a foreign key to specify
the associated record. In the Asset example, you&#8217;d need an
<tt>attachable_id</tt> integer column and an <tt>attachable_type</tt>
string column.
</p>
<p>
Using polymorphic associations in combination with single table inheritance
(STI) is a little tricky. In order for the associations to work as
expected, ensure that you store the base model for the STI models in the
type column of the polymorphic association. To continue with the asset
example above, suppose there are guest posts and member posts that use the
posts table for STI. In this case, there must be a <tt>type</tt> column in
the posts table.
</p>
<pre>
  class Asset &lt; ActiveRecord::Base
    belongs_to :attachable, :polymorphic =&gt; true

    def attachable_type=(sType)
       super(sType.to_s.classify.constantize.base_class.to_s)
    end
  end

  class Post &lt; ActiveRecord::Base
    # because we store &quot;Post&quot; in attachable_type now :dependent =&gt; :destroy will work
    has_many :assets, :as =&gt; :attachable, :dependent =&gt; :destroy
  end

  class GuestPost &lt; Post
  end

  class MemberPost &lt; Post
  end
</pre>
<h2>Caching</h2>
<p>
All of the methods are built on a simple caching principle that will keep
the result of the last query around unless specifically instructed not to.
The cache is even shared across methods to make it even cheaper to use the
macro-added methods without worrying too much about performance at the
first go. Example:
</p>
<pre>
  project.milestones             # fetches milestones from the database
  project.milestones.size        # uses the milestone cache
  project.milestones.empty?      # uses the milestone cache
  project.milestones(true).size  # fetches milestones from the database
  project.milestones             # uses the milestone cache
</pre>
<h2>Eager loading of associations</h2>
<p>
Eager loading is a way to find objects of a certain class and a number of
named associations. This is one of the easiest ways of to prevent the
dreaded 1+N problem in which fetching 100 posts that each need to display
their author triggers 101 database queries. Through the use of eager
loading, the 101 queries can be reduced to 2. Example:
</p>
<pre>
  class Post &lt; ActiveRecord::Base
    belongs_to :author
    has_many   :comments
  end
</pre>
<p>
Consider the following loop using the class above:
</p>
<pre>
  for post in Post.all
    puts &quot;Post:            &quot; + post.title
    puts &quot;Written by:      &quot; + post.author.name
    puts &quot;Last comment on: &quot; + post.comments.first.created_on
  end
</pre>
<p>
To iterate over these one hundred posts, we&#8217;ll generate 201 database
queries. Let&#8217;s first just optimize it for retrieving the author:
</p>
<pre>
  for post in Post.find(:all, :include =&gt; :author)
</pre>
<p>
This references the name of the <tt><a
href="ClassMethods.html#M000411">belongs_to</a></tt> association that also
used the <tt>:author</tt> symbol. After loading the posts, find will
collect the <tt>author_id</tt> from each one and load all the referenced
authors with one query. Doing so will cut down the number of queries from
201 to 102.
</p>
<p>
We can improve upon the situation further by referencing both associations
in the finder with:
</p>
<pre>
  for post in Post.find(:all, :include =&gt; [ :author, :comments ])
</pre>
<p>
This will load all comments with a single query. This reduces the total
number of queries to 3. More generally the number of queries will be 1 plus
the number of associations named (except if some of the associations are
polymorphic <tt><a href="ClassMethods.html#M000411">belongs_to</a></tt> -
see below).
</p>
<p>
To include a deep hierarchy of associations, use a hash:
</p>
<pre>
  for post in Post.find(:all, :include =&gt; [ :author, { :comments =&gt; { :author =&gt; :gravatar } } ])
</pre>
<p>
That&#8217;ll grab not only all the comments but all their authors and
gravatar pictures. You can mix and match symbols, arrays and hashes in any
combination to describe the associations you want to load.
</p>
<p>
All of this power shouldn&#8217;t fool you into thinking that you can pull
out huge amounts of data with no performance penalty just because
you&#8217;ve reduced the number of queries. The database still needs to
send all the data to Active Record and it still needs to be processed. So
it&#8217;s no catch-all for performance problems, but it&#8217;s a great
way to cut down on the number of queries in a situation as the one
described above.
</p>
<p>
Since only one table is loaded at a time, conditions or orders cannot
reference tables other than the main one. If this is the case Active Record
falls back to the previously used LEFT OUTER JOIN based strategy. For
example
</p>
<pre>
  Post.find(:all, :include =&gt; [ :author, :comments ], :conditions =&gt; ['comments.approved = ?', true])
</pre>
<p>
will result in a single SQL query with joins along the lines of: <tt>LEFT
OUTER JOIN comments ON comments.post_id = posts.id</tt> and <tt>LEFT OUTER
JOIN authors ON authors.id = posts.author_id</tt>. Note that using
conditions like this can have unintended consequences. In the above example
posts with no approved comments are not returned at all, because the
conditions apply to the SQL statement as a whole and not just to the
association. You must disambiguate column references for this fallback to
happen, for example <tt>:order =&gt; &quot;author.name DESC&quot;</tt> will
work but <tt>:order =&gt; &quot;name DESC&quot;</tt> will not.
</p>
<p>
If you do want eagerload only some members of an association it is usually
more natural to <tt>:include</tt> an association which has conditions
defined on it:
</p>
<pre>
  class Post &lt; ActiveRecord::Base
    has_many :approved_comments, :class_name =&gt; 'Comment', :conditions =&gt; ['approved = ?', true]
  end

  Post.find(:all, :include =&gt; :approved_comments)
</pre>
<p>
will load posts and eager load the <tt>approved_comments</tt> association,
which contains only those comments that have been approved.
</p>
<p>
If you eager load an association with a specified <tt>:limit</tt> option,
it will be ignored, returning all the associated objects:
</p>
<pre>
  class Picture &lt; ActiveRecord::Base
    has_many :most_recent_comments, :class_name =&gt; 'Comment', :order =&gt; 'id DESC', :limit =&gt; 10
  end

  Picture.find(:first, :include =&gt; :most_recent_comments).most_recent_comments # =&gt; returns all associated comments.
</pre>
<p>
When eager loaded, conditions are interpolated in the context of the model
class, not the model instance. Conditions are lazily interpolated before
the actual model exists.
</p>
<p>
Eager loading is supported with polymorphic associations.
</p>
<pre>
  class Address &lt; ActiveRecord::Base
    belongs_to :addressable, :polymorphic =&gt; true
  end
</pre>
<p>
A call that tries to eager load the addressable model
</p>
<pre>
  Address.find(:all, :include =&gt; :addressable)
</pre>
<p>
will execute one query to load the addresses and load the addressables with
one query per addressable type. For example if all the addressables are
either of class Person or Company then a total of 3 queries will be
executed. The list of addressable types to load is determined on the back
of the addresses loaded. This is not supported if Active Record has to
fallback to the previous implementation of eager loading and will raise
ActiveRecord::EagerLoadPolymorphicError. The reason is that the parent
model&#8217;s type is a column value so its corresponding table name cannot
be put in the <tt>FROM</tt>/<tt>JOIN</tt> clauses of that query.
</p>
<h2>Table Aliasing</h2>
<p>
Active Record uses table aliasing in the case that a table is referenced
multiple times in a join. If a table is referenced only once, the standard
table name is used. The second time, the table is aliased as
<tt>#{reflection_name}_#{parent_table_name}</tt>. Indexes are appended for
any more successive uses of the table name.
</p>
<pre>
  Post.find :all, :joins =&gt; :comments
  # =&gt; SELECT ... FROM posts INNER JOIN comments ON ...
  Post.find :all, :joins =&gt; :special_comments # STI
  # =&gt; SELECT ... FROM posts INNER JOIN comments ON ... AND comments.type = 'SpecialComment'
  Post.find :all, :joins =&gt; [:comments, :special_comments] # special_comments is the reflection name, posts is the parent table name
  # =&gt; SELECT ... FROM posts INNER JOIN comments ON ... INNER JOIN comments special_comments_posts
</pre>
<p>
Acts as tree example:
</p>
<pre>
  TreeMixin.find :all, :joins =&gt; :children
  # =&gt; SELECT ... FROM mixins INNER JOIN mixins childrens_mixins ...
  TreeMixin.find :all, :joins =&gt; {:children =&gt; :parent}
  # =&gt; SELECT ... FROM mixins INNER JOIN mixins childrens_mixins ...
                              INNER JOIN parents_mixins ...
  TreeMixin.find :all, :joins =&gt; {:children =&gt; {:parent =&gt; :children}}
  # =&gt; SELECT ... FROM mixins INNER JOIN mixins childrens_mixins ...
                              INNER JOIN parents_mixins ...
                              INNER JOIN mixins childrens_mixins_2
</pre>
<p>
Has and Belongs to Many join tables use the same idea, but add a
<tt>_join</tt> suffix:
</p>
<pre>
  Post.find :all, :joins =&gt; :categories
  # =&gt; SELECT ... FROM posts INNER JOIN categories_posts ... INNER JOIN categories ...
  Post.find :all, :joins =&gt; {:categories =&gt; :posts}
  # =&gt; SELECT ... FROM posts INNER JOIN categories_posts ... INNER JOIN categories ...
                             INNER JOIN categories_posts posts_categories_join INNER JOIN posts posts_categories
  Post.find :all, :joins =&gt; {:categories =&gt; {:posts =&gt; :categories}}
  # =&gt; SELECT ... FROM posts INNER JOIN categories_posts ... INNER JOIN categories ...
                             INNER JOIN categories_posts posts_categories_join INNER JOIN posts posts_categories
                             INNER JOIN categories_posts categories_posts_join INNER JOIN categories categories_posts_2
</pre>
<p>
If you wish to specify your own custom joins using a <tt>:joins</tt>
option, those table names will take precedence over the eager associations:
</p>
<pre>
  Post.find :all, :joins =&gt; :comments, :joins =&gt; &quot;inner join comments ...&quot;
  # =&gt; SELECT ... FROM posts INNER JOIN comments_posts ON ... INNER JOIN comments ...
  Post.find :all, :joins =&gt; [:comments, :special_comments], :joins =&gt; &quot;inner join comments ...&quot;
  # =&gt; SELECT ... FROM posts INNER JOIN comments comments_posts ON ...
                             INNER JOIN comments special_comments_posts ...
                             INNER JOIN comments ...
</pre>
<p>
Table aliases are automatically truncated according to the maximum length
of table identifiers according to the specific database.
</p>
<h2>Modules</h2>
<p>
By default, associations will look for objects within the current module
scope. Consider:
</p>
<pre>
  module MyApplication
    module Business
      class Firm &lt; ActiveRecord::Base
         has_many :clients
       end

      class Client &lt; ActiveRecord::Base; end
    end
  end
</pre>
<p>
When <tt>Firm#clients</tt> is called, it will in turn call
<tt>MyApplication::Business::Client.find_all_by_firm_id(firm.id)</tt>. If
you want to associate with a class in another module scope, this can be
done by specifying the complete class name. Example:
</p>
<pre>
  module MyApplication
    module Business
      class Firm &lt; ActiveRecord::Base; end
    end

    module Billing
      class Account &lt; ActiveRecord::Base
        belongs_to :firm, :class_name =&gt; &quot;MyApplication::Business::Firm&quot;
      end
    end
  end
</pre>
<h2>Type safety with <tt>ActiveRecord::AssociationTypeMismatch</tt></h2>
<p>
If you attempt to assign an object to an association that doesn&#8217;t
match the inferred or specified <tt>:class_name</tt>, you&#8217;ll get an
<tt>ActiveRecord::AssociationTypeMismatch</tt>.
</p>
<h2>Options</h2>
<p>
All of the association macros can be specialized through options. This
makes cases more complex than the simple and guessable ones possible.
</p>

    </div>
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>A</dt>
        <dd>
            <ul>
                
                <li><a href="#M000463">add_association_callbacks</a>,</li>
                
                <li><a href="#M000418">add_counter_cache_callbacks</a>,</li>
                
                <li><a href="#M000437">add_limited_ids_condition!</a>,</li>
                
                <li><a href="#M000419">add_touch_callbacks</a>,</li>
                
                <li><a href="#M000414">association_accessor_methods</a>,</li>
                
                <li><a href="#M000417">association_constructor_method</a></li>
                
            </ul>
        </dd>
    
        <dt>B</dt>
        <dd>
            <ul>
                
                <li><a href="#M000411">belongs_to</a></li>
                
            </ul>
        </dd>
    
        <dt>C</dt>
        <dd>
            <ul>
                
                <li><a href="#M000416">collection_accessor_methods</a>,</li>
                
                <li><a href="#M000415">collection_reader_method</a>,</li>
                
                <li><a href="#M000462">column_aliases</a>,</li>
                
                <li><a href="#M000464">condition_word</a>,</li>
                
                <li><a href="#M000446">conditions_tables</a>,</li>
                
                <li><a href="#M000423">configure_dependency_for_belongs_to</a>,</li>
                
                <li><a href="#M000421">configure_dependency_for_has_many</a>,</li>
                
                <li><a href="#M000422">configure_dependency_for_has_one</a>,</li>
                
                <li><a href="#M000439">construct_finder_sql_for_association_limiting</a>,</li>
                
                <li><a href="#M000436">construct_finder_sql_with_included_associations</a>,</li>
                
                <li><a href="#M000429">create_belongs_to_reflection</a>,</li>
                
                <li><a href="#M000465">create_extension_modules</a>,</li>
                
                <li><a href="#M000431">create_has_and_belongs_to_many_reflection</a>,</li>
                
                <li><a href="#M000426">create_has_many_reflection</a>,</li>
                
                <li><a href="#M000427">create_has_one_reflection</a>,</li>
                
                <li><a href="#M000428">create_has_one_through_reflection</a></li>
                
            </ul>
        </dd>
    
        <dt>D</dt>
        <dd>
            <ul>
                
                <li><a href="#M000424">delete_all_has_many_dependencies</a></li>
                
            </ul>
        </dd>
    
        <dt>F</dt>
        <dd>
            <ul>
                
                <li><a href="#M000420">find_with_associations</a></li>
                
            </ul>
        </dd>
    
        <dt>G</dt>
        <dd>
            <ul>
                
                <li><a href="#M000434">guard_against_unlimitable_reflections</a></li>
                
            </ul>
        </dd>
    
        <dt>H</dt>
        <dd>
            <ul>
                
                <li><a href="#M000412">has_and_belongs_to_many</a>,</li>
                
                <li><a href="#M000409">has_many</a>,</li>
                
                <li><a href="#M000410">has_one</a></li>
                
            </ul>
        </dd>
    
        <dt>I</dt>
        <dd>
            <ul>
                
                <li><a href="#M000456">include_eager_conditions?</a>,</li>
                
                <li><a href="#M000458">include_eager_order?</a>,</li>
                
                <li><a href="#M000459">include_eager_select?</a></li>
                
            </ul>
        </dd>
    
        <dt>J</dt>
        <dd>
            <ul>
                
                <li><a href="#M000413">join_table_name</a>,</li>
                
                <li><a href="#M000452">joined_tables</a></li>
                
            </ul>
        </dd>
    
        <dt>N</dt>
        <dd>
            <ul>
                
                <li><a href="#M000425">nullify_has_many_dependencies</a></li>
                
            </ul>
        </dd>
    
        <dt>O</dt>
        <dd>
            <ul>
                
                <li><a href="#M000447">order_tables</a></li>
                
            </ul>
        </dd>
    
        <dt>R</dt>
        <dd>
            <ul>
                
                <li><a href="#M000460">references_eager_loaded_tables?</a>,</li>
                
                <li><a href="#M000433">reflect_on_included_associations</a></li>
                
            </ul>
        </dd>
    
        <dt>S</dt>
        <dd>
            <ul>
                
                <li><a href="#M000435">select_all_rows</a>,</li>
                
                <li><a href="#M000438">select_limited_ids_list</a>,</li>
                
                <li><a href="#M000448">selects_tables</a></li>
                
            </ul>
        </dd>
    
        <dt>T</dt>
        <dd>
            <ul>
                
                <li><a href="#M000443">tables_in_hash</a>,</li>
                
                <li><a href="#M000442">tables_in_string</a></li>
                
            </ul>
        </dd>
    
        <dt>U</dt>
        <dd>
            <ul>
                
                <li><a href="#M000461">using_limitable_reflections?</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    

    

    
    <div class="sectiontitle">Classes and Modules</div>
    <ul>
        
        <li><span class="type">CLASS</span> <a href="ClassMethods/InnerJoinDependency.html">ActiveRecord::Associations::ClassMethods::InnerJoinDependency</a></li>
        
        <li><span class="type">CLASS</span> <a href="ClassMethods/JoinDependency.html">ActiveRecord::Associations::ClassMethods::JoinDependency</a></li>
        
    </ul>
    

    

    

    
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M000411">
                    
                    <a name="M000411"></a><b>belongs_to</b>(association_id, options = {})
                    
                </div>
                
                <div class="description">
                  <p>
Specifies a one-to-one association with another class. This method should
only be used if this class contains the foreign key. If the other class
contains the foreign key, then you should use <tt><a
href="ClassMethods.html#M000410">has_one</a></tt> instead. See also
ActiveRecord::Associations::ClassMethods&#8217;s overview on when to use
<tt><a href="ClassMethods.html#M000410">has_one</a></tt> and when to use
<tt><a href="ClassMethods.html#M000411">belongs_to</a></tt>.
</p>
<p>
Methods will be added for retrieval and query for a single associated
object, for which this object holds an id:
</p>
<dl>
<dt>association(force_reload = false)</dt><dd>Returns the associated object. <tt>nil</tt> is returned if none is found.

</dd>
<dt>association=(associate)</dt><dd>Assigns the associate object, extracts the primary key, and sets it as the
foreign key.

</dd>
<dt>build_association(attributes = {})</dt><dd>Returns a new object of the associated type that has been instantiated with
<tt>attributes</tt> and linked to this object through a foreign key, but
has not yet been saved.

</dd>
<dt>create_association(attributes = {})</dt><dd>Returns a new object of the associated type that has been instantiated with
<tt>attributes</tt>, linked to this object through a foreign key, and that
has already been saved (if it passed the validation).

</dd>
</dl>
<p>
(<tt>association</tt> is replaced with the symbol passed as the first
argument, so <tt><a href="ClassMethods.html#M000411">belongs_to</a>
:author</tt> would add among others <tt>author.nil?</tt>.)
</p>
<h3>Example</h3>
<p>
A Post class declares <tt><a
href="ClassMethods.html#M000411">belongs_to</a> :author</tt>, which will
add:
</p>
<ul>
<li><tt>Post#author</tt> (similar to <tt>Author.find(author_id)</tt>)

</li>
<li><tt>Post#author=(author)</tt> (similar to <tt>post.author_id =
author.id</tt>)

</li>
<li><tt>Post#author?</tt> (similar to <tt>post.author == some_author</tt>)

</li>
<li><tt>Post#build_author</tt> (similar to <tt>post.author = Author.new</tt>)

</li>
<li><tt>Post#create_author</tt> (similar to <tt>post.author = Author.new;
post.author.save; post.author</tt>)

</li>
</ul>
<p>
The declaration can also include an options hash to specialize the behavior
of the association.
</p>
<h3>Options</h3>
<dl>
<dt>:class_name</dt><dd>Specify the class name of the association. Use it only if that name
can&#8217;t be inferred from the association name. So <tt><a
href="ClassMethods.html#M000410">has_one</a> :author</tt> will by default
be linked to the Author class, but if the real class name is Person,
you&#8217;ll have to specify it with this option.

</dd>
<dt>:conditions</dt><dd>Specify the conditions that the associated object must meet in order to be
included as a <tt>WHERE</tt> SQL fragment, such as <tt>authorized = 1</tt>.

</dd>
<dt>:select</dt><dd>By default, this is <tt>*</tt> as in <tt>SELECT * FROM</tt>, but can be
changed if, for example, you want to do a join but not include the joined
columns. Do not forget to include the primary and foreign keys, otherwise
it will raise an error.

</dd>
<dt>:foreign_key</dt><dd>Specify the foreign key used for the association. By default this is
guessed to be the name of the association with an &#8220;_id&#8221; suffix.
So a class that defines a <tt><a
href="ClassMethods.html#M000411">belongs_to</a> :person</tt> association
will use &#8220;person_id&#8220; as the default <tt>:foreign_key</tt>.
Similarly, <tt><a href="ClassMethods.html#M000411">belongs_to</a>
:favorite_person, :class_name =&gt; &quot;Person&quot;</tt> will use a
foreign key of &#8220;favorite_person_id&#8220;.

</dd>
<dt>:primary_key</dt><dd>Specify the method that returns the primary key of associated object used
for the association. By default this is id.

</dd>
<dt>:dependent</dt><dd>If set to <tt>:destroy</tt>, the associated object is destroyed when this
object is. If set to <tt>:delete</tt>, the associated object is deleted
<b>without</b> calling its destroy method. This option should not be
specified when <tt><a href="ClassMethods.html#M000411">belongs_to</a></tt>
is used in conjunction with a <tt><a
href="ClassMethods.html#M000409">has_many</a></tt> relationship on another
class because of the potential to leave orphaned records behind.

</dd>
<dt>:counter_cache</dt><dd>Caches the number of belonging objects on the associate class through the
use of <tt>increment_counter</tt> and <tt>decrement_counter</tt>. The
counter cache is incremented when an object of this class is created and
decremented when it&#8217;s destroyed. This requires that a column named
<tt>#{table_name}_count</tt> (such as <tt>comments_count</tt> for a
belonging Comment class) is used on the associate class (such as a Post
class). You can also specify a custom counter cache column by providing a
column name instead of a <tt>true</tt>/<tt>false</tt> value to this option
(e.g., <tt>:counter_cache =&gt; :my_custom_counter</tt>.) Note: Specifying
a counter cache will add it to that model&#8217;s list of readonly
attributes using <tt>attr_readonly</tt>.

</dd>
<dt>:include</dt><dd>Specify second-order associations that should be eager loaded when this
object is loaded.

</dd>
<dt>:polymorphic</dt><dd>Specify this association is a polymorphic association by passing
<tt>true</tt>. Note: If you&#8217;ve enabled the counter cache, then you
may want to add the counter cache attribute to the <tt>attr_readonly</tt>
list in the associated classes (e.g. <tt>class Post; attr_readonly
:comments_count; end</tt>).

</dd>
<dt>:readonly</dt><dd>If true, the associated object is readonly through the association.

</dd>
<dt>:validate</dt><dd>If false, don&#8217;t validate the associated objects when saving the
parent object. <tt>false</tt> by default.

</dd>
<dt>:autosave</dt><dd>If true, always save the associated object or destroy it if marked for
destruction, when saving the parent object. Off by default.

</dd>
<dt>:touch</dt><dd>If true, the associated object will be touched (the updated_at/on
attributes set to now) when this record is either saved or destroyed. If
you specify a symbol, that attribute will be updated with the current time
instead of the updated_at/on attribute.

</dd>
</dl>
<p>
Option examples:
</p>
<pre>
  belongs_to :firm, :foreign_key =&gt; &quot;client_of&quot;
  belongs_to :person, :primary_key =&gt; &quot;name&quot;, :foreign_key =&gt; &quot;person_name&quot;
  belongs_to :author, :class_name =&gt; &quot;Person&quot;, :foreign_key =&gt; &quot;author_id&quot;
  belongs_to :valid_coupon, :class_name =&gt; &quot;Coupon&quot;, :foreign_key =&gt; &quot;coupon_id&quot;,
             :conditions =&gt; 'discounts &gt; #{payments_count}'
  belongs_to :attachable, :polymorphic =&gt; true
  belongs_to :project, :readonly =&gt; true
  belongs_to :post, :counter_cache =&gt; true
  belongs_to :company, :touch =&gt; true
  belongs_to :company, :touch =&gt; :employees_last_updated_at
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000411_source')" id="l_M000411_source">show</a>
                        
                    </p>
                    <div id="M000411_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File activerecord-2.3.14/lib/active_record/associations.rb, line 1038</span>
1038:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">belongs_to</span>(<span class="ruby-identifier">association_id</span>, <span class="ruby-identifier">options</span> = {})
1039:         <span class="ruby-identifier">reflection</span> = <span class="ruby-identifier">create_belongs_to_reflection</span>(<span class="ruby-identifier">association_id</span>, <span class="ruby-identifier">options</span>)
1040: 
1041:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">reflection</span>.<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:polymorphic</span>]
1042:           <span class="ruby-identifier">association_accessor_methods</span>(<span class="ruby-identifier">reflection</span>, <span class="ruby-constant">BelongsToPolymorphicAssociation</span>)
1043:         <span class="ruby-keyword kw">else</span>
1044:           <span class="ruby-identifier">association_accessor_methods</span>(<span class="ruby-identifier">reflection</span>, <span class="ruby-constant">BelongsToAssociation</span>)
1045:           <span class="ruby-identifier">association_constructor_method</span>(<span class="ruby-identifier">:build</span>,  <span class="ruby-identifier">reflection</span>, <span class="ruby-constant">BelongsToAssociation</span>)
1046:           <span class="ruby-identifier">association_constructor_method</span>(<span class="ruby-identifier">:create</span>, <span class="ruby-identifier">reflection</span>, <span class="ruby-constant">BelongsToAssociation</span>)
1047:         <span class="ruby-keyword kw">end</span>
1048: 
1049:         <span class="ruby-identifier">add_counter_cache_callbacks</span>(<span class="ruby-identifier">reflection</span>)          <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:counter_cache</span>]
1050:         <span class="ruby-identifier">add_touch_callbacks</span>(<span class="ruby-identifier">reflection</span>, <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:touch</span>]) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:touch</span>]
1051: 
1052:         <span class="ruby-identifier">configure_dependency_for_belongs_to</span>(<span class="ruby-identifier">reflection</span>)
1053:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000412">
                    
                    <a name="M000412"></a><b>has_and_belongs_to_many</b>(association_id, options = {}, &amp;extension)
                    
                </div>
                
                <div class="description">
                  <p>
Specifies a many-to-many relationship with another class. This associates
two classes via an intermediate join table. Unless the join table is
explicitly specified as an option, it is guessed using the lexical order of
the class names. So a join between Developer and Project will give the
default join table name of &#8220;developers_projects&#8220; because
&#8220;D&#8221; outranks &#8220;P&#8221;. Note that this precedence is
calculated using the <tt>&lt;</tt> operator for String. This means that if
the strings are of different lengths, and the strings are equal when
compared up to the shortest length, then the longer string is considered of
higher lexical precedence than the shorter one. For example, one would
expect the tables &#8220;paper_boxes&#8220; and &#8220;papers&#8221; to
generate a join table name of &#8220;papers_paper_boxes&#8220; because of
the length of the name &#8220;paper_boxes&#8220;, but it in fact generates
a join table name of &#8220;paper_boxes_papers&#8220;. Be aware of this
caveat, and use the custom <tt>:join_table</tt> option if you need to.
</p>
<p>
The join table should not have a primary key or a model associated with it.
You must manually generate the join table with a migration such as this:
</p>
<pre>
  class CreateDevelopersProjectsJoinTable &lt; ActiveRecord::Migration
    def self.up
      create_table :developers_projects, :id =&gt; false do |t|
        t.integer :developer_id
        t.integer :project_id
      end
    end

    def self.down
      drop_table :developers_projects
    end
  end
</pre>
<p>
Deprecated: Any additional fields added to the join table will be placed as
attributes when pulling records out through <tt><a
href="ClassMethods.html#M000412">has_and_belongs_to_many</a></tt>
associations. Records returned from join tables with additional attributes
will be marked as readonly (because we can&#8217;t save changes to the
additional attributes). It&#8217;s strongly recommended that you upgrade
any associations with attributes to a real join model (see introduction).
</p>
<p>
Adds the following methods for retrieval and query:
</p>
<dl>
<dt>collection(force_reload = false)</dt><dd>Returns an array of all the associated objects. An empty array is returned
if none are found.

</dd>
<dt>collection<<(object, &#8230;)</dt><dd>Adds one or more objects to the collection by creating associations in the
join table (<tt>collection.push</tt> and <tt>collection.concat</tt> are
aliases to this method).

</dd>
<dt>collection.delete(object, &#8230;)</dt><dd>Removes one or more objects from the collection by removing their
associations from the join table. This does not destroy the objects.

</dd>
<dt>collection=objects</dt><dd>Replaces the collection&#8217;s content by deleting and adding objects as
appropriate.

</dd>
<dt>collection_singular_ids</dt><dd>Returns an array of the associated objects&#8217; ids.

</dd>
<dt>collection_singular_ids=ids</dt><dd>Replace the collection by the objects identified by the primary keys in
<tt>ids</tt>.

</dd>
<dt>collection.clear</dt><dd>Removes every object from the collection. This does not destroy the
objects.

</dd>
<dt>collection.empty?</dt><dd>Returns <tt>true</tt> if there are no associated objects.

</dd>
<dt>collection.size</dt><dd>Returns the number of associated objects.

</dd>
<dt>collection.find(id)</dt><dd>Finds an associated object responding to the <tt>id</tt> and that meets the
condition that it has to be associated with this object. Uses the same
rules as <a href="../Base.html#M000466">ActiveRecord::Base.find</a>.

</dd>
<dt>collection.exists?(&#8230;)</dt><dd>Checks whether an associated object with the given conditions exists. Uses
the same rules as <a
href="../Base.html#M000471">ActiveRecord::Base.exists?</a>.

</dd>
<dt>collection.build(attributes = {})</dt><dd>Returns a new object of the collection type that has been instantiated with
<tt>attributes</tt> and linked to this object through the join table, but
has not yet been saved.

</dd>
<dt>collection.create(attributes = {})</dt><dd>Returns a new object of the collection type that has been instantiated with
<tt>attributes</tt>, linked to this object through the join table, and that
has already been saved (if it passed the validation).

</dd>
</dl>
<p>
(<tt>collection</tt> is replaced with the symbol passed as the first
argument, so <tt><a
href="ClassMethods.html#M000412">has_and_belongs_to_many</a>
:categories</tt> would add among others <tt>categories.empty?</tt>.)
</p>
<h3>Example</h3>
<p>
A Developer class declares <tt><a
href="ClassMethods.html#M000412">has_and_belongs_to_many</a>
:projects</tt>, which will add:
</p>
<ul>
<li><tt>Developer#projects</tt>

</li>
<li><tt>Developer#projects&lt;&lt;</tt>

</li>
<li><tt>Developer#projects.delete</tt>

</li>
<li><tt>Developer#projects=</tt>

</li>
<li><tt>Developer#project_ids</tt>

</li>
<li><tt>Developer#project_ids=</tt>

</li>
<li><tt>Developer#projects.clear</tt>

</li>
<li><tt>Developer#projects.empty?</tt>

</li>
<li><tt>Developer#projects.size</tt>

</li>
<li><tt>Developer#projects.find(id)</tt>

</li>
<li><tt>Developer#clients.exists?(...)</tt>

</li>
<li><tt>Developer#projects.build</tt> (similar to
<tt>Project.new(&quot;project_id&quot; =&gt; id)</tt>)

</li>
<li><tt>Developer#projects.create</tt> (similar to <tt>c =
Project.new(&quot;project_id&quot; =&gt; id); c.save; c</tt>)

</li>
</ul>
<p>
The declaration may include an options hash to specialize the behavior of
the association.
</p>
<h3>Options</h3>
<dl>
<dt>:class_name</dt><dd>Specify the class name of the association. Use it only if that name
can&#8217;t be inferred from the association name. So <tt><a
href="ClassMethods.html#M000412">has_and_belongs_to_many</a> :projects</tt>
will by default be linked to the Project class, but if the real class name
is SuperProject, you&#8217;ll have to specify it with this option.

</dd>
<dt>:join_table</dt><dd>Specify the name of the join table if the default based on lexical order
isn&#8217;t what you want. <b>WARNING:</b> If you&#8217;re overwriting the
table name of either class, the <tt>table_name</tt> method MUST be declared
underneath any <tt><a
href="ClassMethods.html#M000412">has_and_belongs_to_many</a></tt>
declaration in order to work.

</dd>
<dt>:foreign_key</dt><dd>Specify the foreign key used for the association. By default this is
guessed to be the name of this class in lower-case and &#8220;_id&#8221;
suffixed. So a Person class that makes a <tt><a
href="ClassMethods.html#M000412">has_and_belongs_to_many</a></tt>
association to Project will use &#8220;person_id&#8220; as the default
<tt>:foreign_key</tt>.

</dd>
<dt>:association_foreign_key</dt><dd>Specify the foreign key used for the association on the receiving side of
the association. By default this is guessed to be the name of the
associated class in lower-case and &#8220;_id&#8221; suffixed. So if a
Person class makes a <tt><a
href="ClassMethods.html#M000412">has_and_belongs_to_many</a></tt>
association to Project, the association will use &#8220;project_id&#8220;
as the default <tt>:association_foreign_key</tt>.

</dd>
<dt>:conditions</dt><dd>Specify the conditions that the associated object must meet in order to be
included as a <tt>WHERE</tt> SQL fragment, such as <tt>authorized = 1</tt>.
Record creations from the association are scoped if a hash is used. <tt><a
href="ClassMethods.html#M000409">has_many</a> :posts, :conditions =&gt;
{:published =&gt; true}</tt> will create published posts with
<tt>@blog.posts.create</tt> or <tt>@blog.posts.build</tt>.

</dd>
<dt>:order</dt><dd>Specify the order in which the associated objects are returned as an
<tt>ORDER BY</tt> SQL fragment, such as <tt>last_name, first_name DESC</tt>

</dd>
<dt>:uniq</dt><dd>If true, duplicate associated objects will be ignored by accessors and
query methods.

</dd>
<dt>:finder_sql</dt><dd>Overwrite the default generated SQL statement used to fetch the association
with a manual statement

</dd>
<dt>:counter_sql</dt><dd>Specify a complete SQL statement to fetch the size of the association. If
<tt>:finder_sql</tt> is specified but not <tt>:counter_sql</tt>,
<tt>:counter_sql</tt> will be generated by replacing <tt>SELECT ...
FROM</tt> with <tt>SELECT COUNT(*) FROM</tt>.

</dd>
<dt>:delete_sql</dt><dd>Overwrite the default generated SQL statement used to remove links between
the associated classes with a manual statement.

</dd>
<dt>:insert_sql</dt><dd>Overwrite the default generated SQL statement used to add links between the
associated classes with a manual statement.

</dd>
<dt>:extend</dt><dd>Anonymous module for extending the proxy, see &#8220;Association
extensions&#8221;.

</dd>
<dt>:include</dt><dd>Specify second-order associations that should be eager loaded when the
collection is loaded.

</dd>
<dt>:group</dt><dd>An attribute name by which the result should be grouped. Uses the <tt>GROUP
BY</tt> SQL-clause.

</dd>
<dt>:having</dt><dd>Combined with <tt>:group</tt> this can be used to filter the records that a
<tt>GROUP BY</tt> returns. Uses the <tt>HAVING</tt> SQL-clause.

</dd>
<dt>:limit</dt><dd>An integer determining the limit on the number of rows that should be
returned.

</dd>
<dt>:offset</dt><dd>An integer determining the offset from where the rows should be fetched. So
at 5, it would skip the first 4 rows.

</dd>
<dt>:select</dt><dd>By default, this is <tt>*</tt> as in <tt>SELECT * FROM</tt>, but can be
changed if, for example, you want to do a join but not include the joined
columns. Do not forget to include the primary and foreign keys, otherwise
it will raise an error.

</dd>
<dt>:readonly</dt><dd>If true, all the associated objects are readonly through the association.

</dd>
<dt>:validate</dt><dd>If false, don&#8217;t validate the associated objects when saving the
parent object. <tt>true</tt> by default.

</dd>
<dt>:autosave</dt><dd>If true, always save any loaded members and destroy members marked for
destruction, when saving the parent object. Off by default.

</dd>
</dl>
<p>
Option examples:
</p>
<pre>
  has_and_belongs_to_many :projects
  has_and_belongs_to_many :projects, :include =&gt; [ :milestones, :manager ]
  has_and_belongs_to_many :nations, :class_name =&gt; &quot;Country&quot;
  has_and_belongs_to_many :categories, :join_table =&gt; &quot;prods_cats&quot;
  has_and_belongs_to_many :categories, :readonly =&gt; true
  has_and_belongs_to_many :active_projects, :join_table =&gt; 'developers_projects', :delete_sql =&gt;
  'DELETE FROM developers_projects WHERE active=1 AND developer_id = #{id} AND project_id = #{record.id}'
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000412_source')" id="l_M000412_source">show</a>
                        
                    </p>
                    <div id="M000412_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File activerecord-2.3.14/lib/active_record/associations.rb, line 1215</span>
1215:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">has_and_belongs_to_many</span>(<span class="ruby-identifier">association_id</span>, <span class="ruby-identifier">options</span> = {}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">extension</span>)
1216:         <span class="ruby-identifier">reflection</span> = <span class="ruby-identifier">create_has_and_belongs_to_many_reflection</span>(<span class="ruby-identifier">association_id</span>, <span class="ruby-identifier">options</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">extension</span>)
1217:         <span class="ruby-identifier">collection_accessor_methods</span>(<span class="ruby-identifier">reflection</span>, <span class="ruby-constant">HasAndBelongsToManyAssociation</span>)
1218: 
1219:         <span class="ruby-comment cmt"># Don't use a before_destroy callback since users' before_destroy</span>
1220:         <span class="ruby-comment cmt"># callbacks will be executed after the association is wiped out.</span>
1221:         <span class="ruby-identifier">old_method</span> = <span class="ruby-node">&quot;destroy_without_habtm_shim_for_#{reflection.name}&quot;</span>
1222:         <span class="ruby-identifier">class_eval</span> <span class="ruby-value str">&quot;alias_method :\#{old_method}, :destroy_without_callbacks  # alias_method :destroy_without_habtm_shim_for_posts, :destroy_without_callbacks\ndef destroy_without_callbacks                            # def destroy_without_callbacks\n\#{reflection.name}.clear                               #   posts.clear\n\#{old_method}                                          #   destroy_without_habtm_shim_for_posts\nend                                                      # end\n&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">method_defined?</span>(<span class="ruby-identifier">old_method</span>)
1223: 
1224:         <span class="ruby-identifier">add_association_callbacks</span>(<span class="ruby-identifier">reflection</span>.<span class="ruby-identifier">name</span>, <span class="ruby-identifier">options</span>)
1225:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000409">
                    
                    <a name="M000409"></a><b>has_many</b>(association_id, options = {}, &amp;extension)
                    
                </div>
                
                <div class="description">
                  <p>
Specifies a one-to-many association. The following methods for retrieval
and query of collections of associated objects will be added:
</p>
<dl>
<dt>collection(force_reload = false)</dt><dd>Returns an array of all the associated objects. An empty array is returned
if none are found.

</dd>
<dt>collection<<(object, &#8230;)</dt><dd>Adds one or more objects to the collection by setting their foreign keys to
the collection&#8217;s primary key.

</dd>
<dt>collection.delete(object, &#8230;)</dt><dd>Removes one or more objects from the collection by setting their foreign
keys to <tt>NULL</tt>. Objects will be in addition destroyed if
they&#8217;re associated with <tt>:dependent =&gt; :destroy</tt>, and
deleted if they&#8217;re associated with <tt>:dependent =&gt;
:delete_all</tt>.

</dd>
<dt>collection=objects</dt><dd>Replaces the collections content by deleting and adding objects as
appropriate.

</dd>
<dt>collection_singular_ids</dt><dd>Returns an array of the associated objects&#8217; ids

</dd>
<dt>collection_singular_ids=ids</dt><dd>Replace the collection with the objects identified by the primary keys in
<tt>ids</tt>

</dd>
<dt>collection.clear</dt><dd>Removes every object from the collection. This destroys the associated
objects if they are associated with <tt>:dependent =&gt; :destroy</tt>,
deletes them directly from the database if <tt>:dependent =&gt;
:delete_all</tt>, otherwise sets their foreign keys to <tt>NULL</tt>.

</dd>
<dt>collection.empty?</dt><dd>Returns <tt>true</tt> if there are no associated objects.

</dd>
<dt>collection.size</dt><dd>Returns the number of associated objects.

</dd>
<dt>collection.find(&#8230;)</dt><dd>Finds an associated object according to the same rules as <a
href="../Base.html#M000466">ActiveRecord::Base.find</a>.

</dd>
<dt>collection.exists?(&#8230;)</dt><dd>Checks whether an associated object with the given conditions exists. Uses
the same rules as <a
href="../Base.html#M000471">ActiveRecord::Base.exists?</a>.

</dd>
<dt>collection.build(attributes = {}, &#8230;)</dt><dd>Returns one or more new objects of the collection type that have been
instantiated with <tt>attributes</tt> and linked to this object through a
foreign key, but have not yet been saved. <b>Note:</b> This only works if
an associated object already exists, not if it&#8217;s <tt>nil</tt>!

</dd>
<dt>collection.create(attributes = {})</dt><dd>Returns a new object of the collection type that has been instantiated with
<tt>attributes</tt>, linked to this object through a foreign key, and that
has already been saved (if it passed the validation). <b>Note:</b> This
only works if an associated object already exists, not if it&#8217;s
<tt>nil</tt>!

</dd>
</dl>
<p>
(<b>Note</b>: <tt>collection</tt> is replaced with the symbol passed as the
first argument, so <tt><a href="ClassMethods.html#M000409">has_many</a>
:clients</tt> would add among others <tt>clients.empty?</tt>.)
</p>
<h3>Example</h3>
<p>
Example: A Firm class declares <tt><a
href="ClassMethods.html#M000409">has_many</a> :clients</tt>, which will
add:
</p>
<ul>
<li><tt>Firm#clients</tt> (similar to <tt>Clients.find :all, :conditions =&gt;
[&quot;firm_id = ?&quot;, id]</tt>)

</li>
<li><tt>Firm#clients&lt;&lt;</tt>

</li>
<li><tt>Firm#clients.delete</tt>

</li>
<li><tt>Firm#clients=</tt>

</li>
<li><tt>Firm#client_ids</tt>

</li>
<li><tt>Firm#client_ids=</tt>

</li>
<li><tt>Firm#clients.clear</tt>

</li>
<li><tt>Firm#clients.empty?</tt> (similar to <tt>firm.clients.size == 0</tt>)

</li>
<li><tt>Firm#clients.size</tt> (similar to <tt>Client.count &quot;firm_id =
#{id}&quot;</tt>)

</li>
<li><tt>Firm#clients.find</tt> (similar to <tt>Client.find(id, :conditions
=&gt; &quot;firm_id = #{id}&quot;)</tt>)

</li>
<li><tt>Firm#clients.exists?(:name =&gt; 'ACME')</tt> (similar to
<tt>Client.exists?(:name =&gt; 'ACME', :firm_id =&gt; firm.id)</tt>)

</li>
<li><tt>Firm#clients.build</tt> (similar to <tt>Client.new(&quot;firm_id&quot;
=&gt; id)</tt>)

</li>
<li><tt>Firm#clients.create</tt> (similar to <tt>c =
Client.new(&quot;firm_id&quot; =&gt; id); c.save; c</tt>)

</li>
</ul>
<p>
The declaration can also include an options hash to specialize the behavior
of the association.
</p>
<h3>Supported options</h3>
<dl>
<dt>:class_name</dt><dd>Specify the class name of the association. Use it only if that name
can&#8217;t be inferred from the association name. So <tt><a
href="ClassMethods.html#M000409">has_many</a> :products</tt> will by
default be linked to the Product class, but if the real class name is
SpecialProduct, you&#8217;ll have to specify it with this option.

</dd>
<dt>:conditions</dt><dd>Specify the conditions that the associated objects must meet in order to be
included as a <tt>WHERE</tt> SQL fragment, such as <tt>price &gt; 5 AND
name LIKE 'B%'</tt>. Record creations from the association are scoped if a
hash is used. <tt><a href="ClassMethods.html#M000409">has_many</a> :posts,
:conditions =&gt; {:published =&gt; true}</tt> will create published posts
with <tt>@blog.posts.create</tt> or <tt>@blog.posts.build</tt>.

</dd>
<dt>:order</dt><dd>Specify the order in which the associated objects are returned as an
<tt>ORDER BY</tt> SQL fragment, such as <tt>last_name, first_name
DESC</tt>.

</dd>
<dt>:foreign_key</dt><dd>Specify the foreign key used for the association. By default this is
guessed to be the name of this class in lower-case and &#8220;_id&#8221;
suffixed. So a Person class that makes a <tt><a
href="ClassMethods.html#M000409">has_many</a></tt> association will use
&#8220;person_id&#8220; as the default <tt>:foreign_key</tt>.

</dd>
<dt>:primary_key</dt><dd>Specify the method that returns the primary key used for the association.
By default this is <tt>id</tt>.

</dd>
<dt>:dependent</dt><dd>If set to <tt>:destroy</tt> all the associated objects are destroyed
alongside this object by calling their <tt>destroy</tt> method. If set to
<tt>:delete_all</tt> all associated objects are deleted <b>without</b>
calling their <tt>destroy</tt> method. If set to <tt>:nullify</tt> all
associated objects&#8217; foreign keys are set to <tt>NULL</tt>
<b>without</b> calling their <tt>save</tt> callbacks. <b>Warning:</b> This
option is ignored when also using the <tt>:through</tt> option.

</dd>
<dt>:finder_sql</dt><dd>Specify a complete SQL statement to fetch the association. This is a good
way to go for complex associations that depend on multiple tables. Note:
When this option is used, <tt>find_in_collection</tt> is <em>not</em>
added.

</dd>
<dt>:counter_sql</dt><dd>Specify a complete SQL statement to fetch the size of the association. If
<tt>:finder_sql</tt> is specified but not <tt>:counter_sql</tt>,
<tt>:counter_sql</tt> will be generated by replacing <tt>SELECT ...
FROM</tt> with <tt>SELECT COUNT(*) FROM</tt>.

</dd>
<dt>:extend</dt><dd>Specify a named module for extending the proxy. See &#8220;Association
extensions&#8221;.

</dd>
<dt>:include</dt><dd>Specify second-order associations that should be eager loaded when the
collection is loaded.

</dd>
<dt>:group</dt><dd>An attribute name by which the result should be grouped. Uses the <tt>GROUP
BY</tt> SQL-clause.

</dd>
<dt>:having</dt><dd>Combined with <tt>:group</tt> this can be used to filter the records that a
<tt>GROUP BY</tt> returns. Uses the <tt>HAVING</tt> SQL-clause.

</dd>
<dt>:limit</dt><dd>An integer determining the limit on the number of rows that should be
returned.

</dd>
<dt>:offset</dt><dd>An integer determining the offset from where the rows should be fetched. So
at 5, it would skip the first 4 rows.

</dd>
<dt>:select</dt><dd>By default, this is <tt>*</tt> as in <tt>SELECT * FROM</tt>, but can be
changed if you, for example, want to do a join but not include the joined
columns. Do not forget to include the primary and foreign keys, otherwise
it will raise an error.

</dd>
<dt>:as</dt><dd>Specifies a polymorphic interface (See <tt><a
href="ClassMethods.html#M000411">belongs_to</a></tt>).

</dd>
<dt>:through</dt><dd>Specifies a Join Model through which to perform the query. Options for
<tt>:class_name</tt> and <tt>:foreign_key</tt> are ignored, as the
association uses the source reflection. You can only use a
<tt>:through</tt> query through a <tt><a
href="ClassMethods.html#M000411">belongs_to</a></tt> <tt><a
href="ClassMethods.html#M000410">has_one</a></tt> or <tt><a
href="ClassMethods.html#M000409">has_many</a></tt> association on the join
model.

</dd>
<dt>:source</dt><dd>Specifies the source association name used by <tt><a
href="ClassMethods.html#M000409">has_many</a> :through</tt> queries. Only
use it if the name cannot be inferred from the association. <tt><a
href="ClassMethods.html#M000409">has_many</a> :subscribers, :through =&gt;
:subscriptions</tt> will look for either <tt>:subscribers</tt> or
<tt>:subscriber</tt> on Subscription, unless a <tt>:source</tt> is given.

</dd>
<dt>:source_type</dt><dd>Specifies type of the source association used by <tt><a
href="ClassMethods.html#M000409">has_many</a> :through</tt> queries where
the source association is a polymorphic <tt><a
href="ClassMethods.html#M000411">belongs_to</a></tt>.

</dd>
<dt>:uniq</dt><dd>If true, duplicates will be omitted from the collection. Useful in
conjunction with <tt>:through</tt>.

</dd>
<dt>:readonly</dt><dd>If true, all the associated objects are readonly through the association.

</dd>
<dt>:validate</dt><dd>If false, don&#8217;t validate the associated objects when saving the
parent object. true by default.

</dd>
<dt>:autosave</dt><dd>If true, always save any loaded members and destroy members marked for
destruction, when saving the parent object. Off by default.

</dd>
</dl>
<p>
Option examples:
</p>
<pre>
  has_many :comments, :order =&gt; &quot;posted_on&quot;
  has_many :comments, :include =&gt; :author
  has_many :people, :class_name =&gt; &quot;Person&quot;, :conditions =&gt; &quot;deleted = 0&quot;, :order =&gt; &quot;name&quot;
  has_many :tracks, :order =&gt; &quot;position&quot;, :dependent =&gt; :destroy
  has_many :comments, :dependent =&gt; :nullify
  has_many :tags, :as =&gt; :taggable
  has_many :reports, :readonly =&gt; true
  has_many :subscribers, :through =&gt; :subscriptions, :source =&gt; :user
  has_many :subscribers, :class_name =&gt; &quot;Person&quot;, :finder_sql =&gt;
      'SELECT DISTINCT people.* ' +
      'FROM people p, post_subscriptions ps ' +
      'WHERE ps.post_id = #{id} AND ps.person_id = p.id ' +
      'ORDER BY p.first_name'
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000409_source')" id="l_M000409_source">show</a>
                        
                    </p>
                    <div id="M000409_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activerecord-2.3.14/lib/active_record/associations.rb, line 828</span>
828:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">has_many</span>(<span class="ruby-identifier">association_id</span>, <span class="ruby-identifier">options</span> = {}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">extension</span>)
829:         <span class="ruby-identifier">reflection</span> = <span class="ruby-identifier">create_has_many_reflection</span>(<span class="ruby-identifier">association_id</span>, <span class="ruby-identifier">options</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">extension</span>)
830:         <span class="ruby-identifier">configure_dependency_for_has_many</span>(<span class="ruby-identifier">reflection</span>)
831:         <span class="ruby-identifier">add_association_callbacks</span>(<span class="ruby-identifier">reflection</span>.<span class="ruby-identifier">name</span>, <span class="ruby-identifier">reflection</span>.<span class="ruby-identifier">options</span>)
832: 
833:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:through</span>]
834:           <span class="ruby-identifier">collection_accessor_methods</span>(<span class="ruby-identifier">reflection</span>, <span class="ruby-constant">HasManyThroughAssociation</span>)
835:         <span class="ruby-keyword kw">else</span>
836:           <span class="ruby-identifier">collection_accessor_methods</span>(<span class="ruby-identifier">reflection</span>, <span class="ruby-constant">HasManyAssociation</span>)
837:         <span class="ruby-keyword kw">end</span>
838:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000410">
                    
                    <a name="M000410"></a><b>has_one</b>(association_id, options = {})
                    
                </div>
                
                <div class="description">
                  <p>
Specifies a one-to-one association with another class. This method should
only be used if the other class contains the foreign key. If the current
class contains the foreign key, then you should use <tt><a
href="ClassMethods.html#M000411">belongs_to</a></tt> instead. See also
ActiveRecord::Associations::ClassMethods&#8217;s overview on when to use <a
href="ClassMethods.html#M000410">has_one</a> and when to use belongs_to.
</p>
<p>
The following methods for retrieval and query of a single associated object
will be added:
</p>
<dl>
<dt>association(force_reload = false)</dt><dd>Returns the associated object. <tt>nil</tt> is returned if none is found.

</dd>
<dt>association=(associate)</dt><dd>Assigns the associate object, extracts the primary key, sets it as the
foreign key, and saves the associate object.

</dd>
<dt>build_association(attributes = {})</dt><dd>Returns a new object of the associated type that has been instantiated with
<tt>attributes</tt> and linked to this object through a foreign key, but
has not yet been saved. <b>Note:</b> This ONLY works if an association
already exists. It will NOT work if the association is <tt>nil</tt>.

</dd>
<dt>create_association(attributes = {})</dt><dd>Returns a new object of the associated type that has been instantiated with
<tt>attributes</tt>, linked to this object through a foreign key, and that
has already been saved (if it passed the validation).

</dd>
</dl>
<p>
(<tt>association</tt> is replaced with the symbol passed as the first
argument, so <tt><a href="ClassMethods.html#M000410">has_one</a>
:manager</tt> would add among others <tt>manager.nil?</tt>.)
</p>
<h3>Example</h3>
<p>
An Account class declares <tt><a
href="ClassMethods.html#M000410">has_one</a> :beneficiary</tt>, which will
add:
</p>
<ul>
<li><tt>Account#beneficiary</tt> (similar to <tt>Beneficiary.find(:first,
:conditions =&gt; &quot;account_id = #{id}&quot;)</tt>)

</li>
<li><tt>Account#beneficiary=(beneficiary)</tt> (similar to
<tt>beneficiary.account_id = account.id; beneficiary.save</tt>)

</li>
<li><tt>Account#build_beneficiary</tt> (similar to
<tt>Beneficiary.new(&quot;account_id&quot; =&gt; id)</tt>)

</li>
<li><tt>Account#create_beneficiary</tt> (similar to <tt>b =
Beneficiary.new(&quot;account_id&quot; =&gt; id); b.save; b</tt>)

</li>
</ul>
<h3>Options</h3>
<p>
The declaration can also include an options hash to specialize the behavior
of the association.
</p>
<p>
Options are:
</p>
<dl>
<dt>:class_name</dt><dd>Specify the class name of the association. Use it only if that name
can&#8217;t be inferred from the association name. So <tt><a
href="ClassMethods.html#M000410">has_one</a> :manager</tt> will by default
be linked to the Manager class, but if the real class name is Person,
you&#8217;ll have to specify it with this option.

</dd>
<dt>:conditions</dt><dd>Specify the conditions that the associated object must meet in order to be
included as a <tt>WHERE</tt> SQL fragment, such as <tt>rank = 5</tt>.
Record creation from the association is scoped if a hash is used. <tt><a
href="ClassMethods.html#M000410">has_one</a> :account, :conditions =&gt;
{:enabled =&gt; true}</tt> will create an enabled account with
<tt>@company.create_account</tt> or <tt>@company.build_account</tt>.

</dd>
<dt>:order</dt><dd>Specify the order in which the associated objects are returned as an
<tt>ORDER BY</tt> SQL fragment, such as <tt>last_name, first_name
DESC</tt>.

</dd>
<dt>:dependent</dt><dd>If set to <tt>:destroy</tt>, the associated object is destroyed when this
object is. If set to <tt>:delete</tt>, the associated object is deleted
<b>without</b> calling its destroy method. If set to <tt>:nullify</tt>, the
associated object&#8217;s foreign key is set to <tt>NULL</tt>. Also,
association is assigned.

</dd>
<dt>:foreign_key</dt><dd>Specify the foreign key used for the association. By default this is
guessed to be the name of this class in lower-case and &#8220;_id&#8221;
suffixed. So a Person class that makes a <tt><a
href="ClassMethods.html#M000410">has_one</a></tt> association will use
&#8220;person_id&#8220; as the default <tt>:foreign_key</tt>.

</dd>
<dt>:primary_key</dt><dd>Specify the method that returns the primary key used for the association.
By default this is <tt>id</tt>.

</dd>
<dt>:include</dt><dd>Specify second-order associations that should be eager loaded when this
object is loaded.

</dd>
<dt>:as</dt><dd>Specifies a polymorphic interface (See <tt><a
href="ClassMethods.html#M000411">belongs_to</a></tt>).

</dd>
<dt>:select</dt><dd>By default, this is <tt>*</tt> as in <tt>SELECT * FROM</tt>, but can be
changed if, for example, you want to do a join but not include the joined
columns. Do not forget to include the primary and foreign keys, otherwise
it will raise an error.

</dd>
<dt>:through</dt><dd>Specifies a Join Model through which to perform the query. Options for
<tt>:class_name</tt> and <tt>:foreign_key</tt> are ignored, as the
association uses the source reflection. You can only use a
<tt>:through</tt> query through a <tt><a
href="ClassMethods.html#M000410">has_one</a></tt> or <tt><a
href="ClassMethods.html#M000411">belongs_to</a></tt> association on the
join model.

</dd>
<dt>:source</dt><dd>Specifies the source association name used by <tt><a
href="ClassMethods.html#M000410">has_one</a> :through</tt> queries. Only
use it if the name cannot be inferred from the association. <tt><a
href="ClassMethods.html#M000410">has_one</a> :favorite, :through =&gt;
:favorites</tt> will look for a <tt>:favorite</tt> on Favorite, unless a
<tt>:source</tt> is given.

</dd>
<dt>:source_type</dt><dd>Specifies type of the source association used by <tt><a
href="ClassMethods.html#M000410">has_one</a> :through</tt> queries where
the source association is a polymorphic <tt><a
href="ClassMethods.html#M000411">belongs_to</a></tt>.

</dd>
<dt>:readonly</dt><dd>If true, the associated object is readonly through the association.

</dd>
<dt>:validate</dt><dd>If false, don&#8217;t validate the associated object when saving the parent
object. <tt>false</tt> by default.

</dd>
<dt>:autosave</dt><dd>If true, always save the associated object or destroy it if marked for
destruction, when saving the parent object. Off by default.

</dd>
</dl>
<p>
Option examples:
</p>
<pre>
  has_one :credit_card, :dependent =&gt; :destroy  # destroys the associated credit card
  has_one :credit_card, :dependent =&gt; :nullify  # updates the associated records foreign key value to NULL rather than destroying it
  has_one :last_comment, :class_name =&gt; &quot;Comment&quot;, :order =&gt; &quot;posted_on&quot;
  has_one :project_manager, :class_name =&gt; &quot;Person&quot;, :conditions =&gt; &quot;role = 'project_manager'&quot;
  has_one :attachment, :as =&gt; :attachable
  has_one :boss, :readonly =&gt; :true
  has_one :club, :through =&gt; :membership
  has_one :primary_address, :through =&gt; :addressables, :conditions =&gt; [&quot;addressable.primary = ?&quot;, true], :source =&gt; :addressable
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000410_source')" id="l_M000410_source">show</a>
                        
                    </p>
                    <div id="M000410_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activerecord-2.3.14/lib/active_record/associations.rb, line 934</span>
934:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">has_one</span>(<span class="ruby-identifier">association_id</span>, <span class="ruby-identifier">options</span> = {})
935:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:through</span>]
936:           <span class="ruby-identifier">reflection</span> = <span class="ruby-identifier">create_has_one_through_reflection</span>(<span class="ruby-identifier">association_id</span>, <span class="ruby-identifier">options</span>)
937:           <span class="ruby-identifier">association_accessor_methods</span>(<span class="ruby-identifier">reflection</span>, <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Associations</span><span class="ruby-operator">::</span><span class="ruby-constant">HasOneThroughAssociation</span>)
938:         <span class="ruby-keyword kw">else</span>
939:           <span class="ruby-identifier">reflection</span> = <span class="ruby-identifier">create_has_one_reflection</span>(<span class="ruby-identifier">association_id</span>, <span class="ruby-identifier">options</span>)
940:           <span class="ruby-identifier">association_accessor_methods</span>(<span class="ruby-identifier">reflection</span>, <span class="ruby-constant">HasOneAssociation</span>)
941:           <span class="ruby-identifier">association_constructor_method</span>(<span class="ruby-identifier">:build</span>,  <span class="ruby-identifier">reflection</span>, <span class="ruby-constant">HasOneAssociation</span>)
942:           <span class="ruby-identifier">association_constructor_method</span>(<span class="ruby-identifier">:create</span>, <span class="ruby-identifier">reflection</span>, <span class="ruby-constant">HasOneAssociation</span>)
943:           <span class="ruby-identifier">configure_dependency_for_has_one</span>(<span class="ruby-identifier">reflection</span>)
944:         <span class="ruby-keyword kw">end</span>
945:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Private methods</div>
            
            <div class="method">
                <div class="title" id="M000463">
                    
                    <a name="M000463"></a><b>add_association_callbacks</b>(association_name, options)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000463_source')" id="l_M000463_source">show</a>
                        
                    </p>
                    <div id="M000463_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File activerecord-2.3.14/lib/active_record/associations.rb, line 1794</span>
1794:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_association_callbacks</span>(<span class="ruby-identifier">association_name</span>, <span class="ruby-identifier">options</span>)
1795:           <span class="ruby-identifier">callbacks</span> = <span class="ruby-node">%w(before_add after_add before_remove after_remove)</span>
1796:           <span class="ruby-identifier">callbacks</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">callback_name</span><span class="ruby-operator">|</span>
1797:             <span class="ruby-identifier">full_callback_name</span> = <span class="ruby-node">&quot;#{callback_name}_for_#{association_name}&quot;</span>
1798:             <span class="ruby-identifier">defined_callbacks</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">callback_name</span>.<span class="ruby-identifier">to_sym</span>]
1799:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">callback_name</span>.<span class="ruby-identifier">to_sym</span>)
1800:               <span class="ruby-identifier">class_inheritable_reader</span> <span class="ruby-identifier">full_callback_name</span>.<span class="ruby-identifier">to_sym</span>
1801:               <span class="ruby-identifier">write_inheritable_attribute</span>(<span class="ruby-identifier">full_callback_name</span>.<span class="ruby-identifier">to_sym</span>, [<span class="ruby-identifier">defined_callbacks</span>].<span class="ruby-identifier">flatten</span>)
1802:             <span class="ruby-keyword kw">else</span>
1803:               <span class="ruby-identifier">write_inheritable_attribute</span>(<span class="ruby-identifier">full_callback_name</span>.<span class="ruby-identifier">to_sym</span>, [])
1804:             <span class="ruby-keyword kw">end</span>
1805:           <span class="ruby-keyword kw">end</span>
1806:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000418">
                    
                    <a name="M000418"></a><b>add_counter_cache_callbacks</b>(reflection)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000418_source')" id="l_M000418_source">show</a>
                        
                    </p>
                    <div id="M000418_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File activerecord-2.3.14/lib/active_record/associations.rb, line 1362</span>
1362:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_counter_cache_callbacks</span>(<span class="ruby-identifier">reflection</span>)
1363:           <span class="ruby-identifier">cache_column</span> = <span class="ruby-identifier">reflection</span>.<span class="ruby-identifier">counter_cache_column</span>
1364: 
1365:           <span class="ruby-identifier">method_name</span> = <span class="ruby-node">&quot;belongs_to_counter_cache_after_create_for_#{reflection.name}&quot;</span>.<span class="ruby-identifier">to_sym</span>
1366:           <span class="ruby-identifier">define_method</span>(<span class="ruby-identifier">method_name</span>) <span class="ruby-keyword kw">do</span>
1367:             <span class="ruby-identifier">association</span> = <span class="ruby-identifier">send</span>(<span class="ruby-identifier">reflection</span>.<span class="ruby-identifier">name</span>)
1368:             <span class="ruby-identifier">association</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">increment_counter</span>(<span class="ruby-identifier">cache_column</span>, <span class="ruby-identifier">association</span>.<span class="ruby-identifier">id</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">association</span>.<span class="ruby-identifier">nil?</span>
1369:           <span class="ruby-keyword kw">end</span>
1370:           <span class="ruby-identifier">after_create</span>(<span class="ruby-identifier">method_name</span>)
1371: 
1372:           <span class="ruby-identifier">method_name</span> = <span class="ruby-node">&quot;belongs_to_counter_cache_before_destroy_for_#{reflection.name}&quot;</span>.<span class="ruby-identifier">to_sym</span>
1373:           <span class="ruby-identifier">define_method</span>(<span class="ruby-identifier">method_name</span>) <span class="ruby-keyword kw">do</span>
1374:             <span class="ruby-identifier">association</span> = <span class="ruby-identifier">send</span>(<span class="ruby-identifier">reflection</span>.<span class="ruby-identifier">name</span>)
1375:             <span class="ruby-identifier">association</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">decrement_counter</span>(<span class="ruby-identifier">cache_column</span>, <span class="ruby-identifier">association</span>.<span class="ruby-identifier">id</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">association</span>.<span class="ruby-identifier">nil?</span>
1376:           <span class="ruby-keyword kw">end</span>
1377:           <span class="ruby-identifier">before_destroy</span>(<span class="ruby-identifier">method_name</span>)
1378: 
1379:           <span class="ruby-identifier">module_eval</span>(
1380:             <span class="ruby-node">&quot;#{reflection.class_name}.send(:attr_readonly,\&quot;#{cache_column}\&quot;.intern) if defined?(#{reflection.class_name}) &amp;&amp; #{reflection.class_name}.respond_to?(:attr_readonly)&quot;</span>
1381:           )
1382:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000437">
                    
                    <a name="M000437"></a><b>add_limited_ids_condition!</b>(sql, options, join_dependency)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000437_source')" id="l_M000437_source">show</a>
                        
                    </p>
                    <div id="M000437_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File activerecord-2.3.14/lib/active_record/associations.rb, line 1646</span>
1646:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_limited_ids_condition!</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">options</span>, <span class="ruby-identifier">join_dependency</span>)
1647:           <span class="ruby-keyword kw">unless</span> (<span class="ruby-identifier">id_list</span> = <span class="ruby-identifier">select_limited_ids_list</span>(<span class="ruby-identifier">options</span>, <span class="ruby-identifier">join_dependency</span>)).<span class="ruby-identifier">empty?</span>
1648:             <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;#{condition_word(sql)} #{connection.quote_table_name table_name}.#{primary_key} IN (#{id_list}) &quot;</span>
1649:           <span class="ruby-keyword kw">else</span>
1650:             <span class="ruby-identifier">throw</span> <span class="ruby-identifier">:invalid_query</span>
1651:           <span class="ruby-keyword kw">end</span>
1652:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000419">
                    
                    <a name="M000419"></a><b>add_touch_callbacks</b>(reflection, touch_attribute)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000419_source')" id="l_M000419_source">show</a>
                        
                    </p>
                    <div id="M000419_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File activerecord-2.3.14/lib/active_record/associations.rb, line 1384</span>
1384:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_touch_callbacks</span>(<span class="ruby-identifier">reflection</span>, <span class="ruby-identifier">touch_attribute</span>)
1385:           <span class="ruby-identifier">method_name</span> = <span class="ruby-node">&quot;belongs_to_touch_after_save_or_destroy_for_#{reflection.name}&quot;</span>.<span class="ruby-identifier">to_sym</span>
1386:           <span class="ruby-identifier">define_method</span>(<span class="ruby-identifier">method_name</span>) <span class="ruby-keyword kw">do</span>
1387:             <span class="ruby-identifier">association</span> = <span class="ruby-identifier">send</span>(<span class="ruby-identifier">reflection</span>.<span class="ruby-identifier">name</span>)
1388:             
1389:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">touch_attribute</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">true</span>
1390:               <span class="ruby-identifier">association</span>.<span class="ruby-identifier">touch</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">association</span>.<span class="ruby-identifier">nil?</span>
1391:             <span class="ruby-keyword kw">else</span>
1392:               <span class="ruby-identifier">association</span>.<span class="ruby-identifier">touch</span>(<span class="ruby-identifier">touch_attribute</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">association</span>.<span class="ruby-identifier">nil?</span>
1393:             <span class="ruby-keyword kw">end</span>
1394:           <span class="ruby-keyword kw">end</span>
1395:           <span class="ruby-identifier">after_save</span>(<span class="ruby-identifier">method_name</span>)
1396:           <span class="ruby-identifier">after_destroy</span>(<span class="ruby-identifier">method_name</span>)
1397:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000414">
                    
                    <a name="M000414"></a><b>association_accessor_methods</b>(reflection, association_proxy_class)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000414_source')" id="l_M000414_source">show</a>
                        
                    </p>
                    <div id="M000414_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File activerecord-2.3.14/lib/active_record/associations.rb, line 1250</span>
1250:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">association_accessor_methods</span>(<span class="ruby-identifier">reflection</span>, <span class="ruby-identifier">association_proxy_class</span>)
1251:           <span class="ruby-identifier">define_method</span>(<span class="ruby-identifier">reflection</span>.<span class="ruby-identifier">name</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-operator">*</span><span class="ruby-identifier">params</span><span class="ruby-operator">|</span>
1252:             <span class="ruby-identifier">force_reload</span> = <span class="ruby-identifier">params</span>.<span class="ruby-identifier">first</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">params</span>.<span class="ruby-identifier">empty?</span>
1253:             <span class="ruby-identifier">association</span> = <span class="ruby-identifier">association_instance_get</span>(<span class="ruby-identifier">reflection</span>.<span class="ruby-identifier">name</span>)
1254: 
1255:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">association</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">force_reload</span>
1256:               <span class="ruby-identifier">association</span> = <span class="ruby-identifier">association_proxy_class</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword kw">self</span>, <span class="ruby-identifier">reflection</span>)
1257:               <span class="ruby-identifier">retval</span> = <span class="ruby-identifier">force_reload</span> <span class="ruby-value">? </span><span class="ruby-identifier">reflection</span>.<span class="ruby-identifier">klass</span>.<span class="ruby-identifier">uncached</span> { <span class="ruby-identifier">association</span>.<span class="ruby-identifier">reload</span> } <span class="ruby-operator">:</span> <span class="ruby-identifier">association</span>.<span class="ruby-identifier">reload</span>
1258:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">retval</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">association_proxy_class</span> <span class="ruby-operator">==</span> <span class="ruby-constant">BelongsToAssociation</span>
1259:                 <span class="ruby-identifier">association_instance_set</span>(<span class="ruby-identifier">reflection</span>.<span class="ruby-identifier">name</span>, <span class="ruby-keyword kw">nil</span>)
1260:                 <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span>
1261:               <span class="ruby-keyword kw">end</span>
1262:               <span class="ruby-identifier">association_instance_set</span>(<span class="ruby-identifier">reflection</span>.<span class="ruby-identifier">name</span>, <span class="ruby-identifier">association</span>)
1263:             <span class="ruby-keyword kw">end</span>
1264: 
1265:             <span class="ruby-identifier">association</span>.<span class="ruby-identifier">target</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-value">? </span><span class="ruby-keyword kw">nil</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">association</span>
1266:           <span class="ruby-keyword kw">end</span>
1267: 
1268:           <span class="ruby-identifier">define_method</span>(<span class="ruby-node">&quot;loaded_#{reflection.name}?&quot;</span>) <span class="ruby-keyword kw">do</span>
1269:             <span class="ruby-identifier">association</span> = <span class="ruby-identifier">association_instance_get</span>(<span class="ruby-identifier">reflection</span>.<span class="ruby-identifier">name</span>)
1270:             <span class="ruby-identifier">association</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">association</span>.<span class="ruby-identifier">loaded?</span>
1271:           <span class="ruby-keyword kw">end</span>
1272: 
1273:           <span class="ruby-identifier">define_method</span>(<span class="ruby-node">&quot;#{reflection.name}=&quot;</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">new_value</span><span class="ruby-operator">|</span>
1274:             <span class="ruby-identifier">association</span> = <span class="ruby-identifier">association_instance_get</span>(<span class="ruby-identifier">reflection</span>.<span class="ruby-identifier">name</span>)
1275: 
1276:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">association</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">association</span>.<span class="ruby-identifier">target</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">new_value</span>
1277:               <span class="ruby-identifier">association</span> = <span class="ruby-identifier">association_proxy_class</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword kw">self</span>, <span class="ruby-identifier">reflection</span>)
1278:             <span class="ruby-keyword kw">end</span>
1279: 
1280:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">association_proxy_class</span> <span class="ruby-operator">==</span> <span class="ruby-constant">HasOneThroughAssociation</span>
1281:               <span class="ruby-identifier">association</span>.<span class="ruby-identifier">create_through_record</span>(<span class="ruby-identifier">new_value</span>)
1282:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">new_record?</span>
1283:                 <span class="ruby-identifier">association_instance_set</span>(<span class="ruby-identifier">reflection</span>.<span class="ruby-identifier">name</span>, <span class="ruby-identifier">new_value</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-value">? </span><span class="ruby-keyword kw">nil</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">association</span>)
1284:               <span class="ruby-keyword kw">else</span>
1285:                 <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">reflection</span>.<span class="ruby-identifier">name</span>, <span class="ruby-identifier">new_value</span>)
1286:               <span class="ruby-keyword kw">end</span>
1287:             <span class="ruby-keyword kw">else</span>
1288:               <span class="ruby-identifier">association</span>.<span class="ruby-identifier">replace</span>(<span class="ruby-identifier">new_value</span>)
1289:               <span class="ruby-identifier">association_instance_set</span>(<span class="ruby-identifier">reflection</span>.<span class="ruby-identifier">name</span>, <span class="ruby-identifier">new_value</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-value">? </span><span class="ruby-keyword kw">nil</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">association</span>)
1290:             <span class="ruby-keyword kw">end</span>
1291:           <span class="ruby-keyword kw">end</span>
1292: 
1293:           <span class="ruby-identifier">define_method</span>(<span class="ruby-node">&quot;set_#{reflection.name}_target&quot;</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">target</span><span class="ruby-operator">|</span>
1294:             <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">target</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">association_proxy_class</span> <span class="ruby-operator">==</span> <span class="ruby-constant">BelongsToAssociation</span>
1295:             <span class="ruby-identifier">association</span> = <span class="ruby-identifier">association_proxy_class</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword kw">self</span>, <span class="ruby-identifier">reflection</span>)
1296:             <span class="ruby-identifier">association</span>.<span class="ruby-identifier">target</span> = <span class="ruby-identifier">target</span>
1297:             <span class="ruby-identifier">association_instance_set</span>(<span class="ruby-identifier">reflection</span>.<span class="ruby-identifier">name</span>, <span class="ruby-identifier">association</span>)
1298:           <span class="ruby-keyword kw">end</span>
1299:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000417">
                    
                    <a name="M000417"></a><b>association_constructor_method</b>(constructor, reflection, association_proxy_class)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000417_source')" id="l_M000417_source">show</a>
                        
                    </p>
                    <div id="M000417_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File activerecord-2.3.14/lib/active_record/associations.rb, line 1343</span>
1343:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">association_constructor_method</span>(<span class="ruby-identifier">constructor</span>, <span class="ruby-identifier">reflection</span>, <span class="ruby-identifier">association_proxy_class</span>)
1344:           <span class="ruby-identifier">define_method</span>(<span class="ruby-node">&quot;#{constructor}_#{reflection.name}&quot;</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-operator">*</span><span class="ruby-identifier">params</span><span class="ruby-operator">|</span>
1345:             <span class="ruby-identifier">attributees</span>      = <span class="ruby-identifier">params</span>.<span class="ruby-identifier">first</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">params</span>.<span class="ruby-identifier">empty?</span>
1346:             <span class="ruby-identifier">replace_existing</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-value">? </span><span class="ruby-keyword kw">true</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">1</span>]
1347:             <span class="ruby-identifier">association</span>      = <span class="ruby-identifier">association_instance_get</span>(<span class="ruby-identifier">reflection</span>.<span class="ruby-identifier">name</span>)
1348: 
1349:             <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">association</span>
1350:               <span class="ruby-identifier">association</span> = <span class="ruby-identifier">association_proxy_class</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword kw">self</span>, <span class="ruby-identifier">reflection</span>)
1351:               <span class="ruby-identifier">association_instance_set</span>(<span class="ruby-identifier">reflection</span>.<span class="ruby-identifier">name</span>, <span class="ruby-identifier">association</span>)
1352:             <span class="ruby-keyword kw">end</span>
1353: 
1354:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">association_proxy_class</span> <span class="ruby-operator">==</span> <span class="ruby-constant">HasOneAssociation</span>
1355:               <span class="ruby-identifier">association</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">constructor</span>, <span class="ruby-identifier">attributees</span>, <span class="ruby-identifier">replace_existing</span>)
1356:             <span class="ruby-keyword kw">else</span>
1357:               <span class="ruby-identifier">association</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">constructor</span>, <span class="ruby-identifier">attributees</span>)
1358:             <span class="ruby-keyword kw">end</span>
1359:           <span class="ruby-keyword kw">end</span>
1360:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000416">
                    
                    <a name="M000416"></a><b>collection_accessor_methods</b>(reflection, association_proxy_class, writer = true)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000416_source')" id="l_M000416_source">show</a>
                        
                    </p>
                    <div id="M000416_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File activerecord-2.3.14/lib/active_record/associations.rb, line 1325</span>
1325:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">collection_accessor_methods</span>(<span class="ruby-identifier">reflection</span>, <span class="ruby-identifier">association_proxy_class</span>, <span class="ruby-identifier">writer</span> = <span class="ruby-keyword kw">true</span>)
1326:           <span class="ruby-identifier">collection_reader_method</span>(<span class="ruby-identifier">reflection</span>, <span class="ruby-identifier">association_proxy_class</span>)
1327: 
1328:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">writer</span>
1329:             <span class="ruby-identifier">define_method</span>(<span class="ruby-node">&quot;#{reflection.name}=&quot;</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">new_value</span><span class="ruby-operator">|</span>
1330:               <span class="ruby-comment cmt"># Loads proxy class instance (defined in collection_reader_method) if not already loaded</span>
1331:               <span class="ruby-identifier">association</span> = <span class="ruby-identifier">send</span>(<span class="ruby-identifier">reflection</span>.<span class="ruby-identifier">name</span>)
1332:               <span class="ruby-identifier">association</span>.<span class="ruby-identifier">replace</span>(<span class="ruby-identifier">new_value</span>)
1333:               <span class="ruby-identifier">association</span>
1334:             <span class="ruby-keyword kw">end</span>
1335: 
1336:             <span class="ruby-identifier">define_method</span>(<span class="ruby-node">&quot;#{reflection.name.to_s.singularize}_ids=&quot;</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">new_value</span><span class="ruby-operator">|</span>
1337:               <span class="ruby-identifier">ids</span> = (<span class="ruby-identifier">new_value</span> <span class="ruby-operator">||</span> []).<span class="ruby-identifier">reject</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">nid</span><span class="ruby-operator">|</span> <span class="ruby-identifier">nid</span>.<span class="ruby-identifier">blank?</span> }.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">:to_i</span>)
1338:               <span class="ruby-identifier">send</span>(<span class="ruby-node">&quot;#{reflection.name}=&quot;</span>, <span class="ruby-identifier">reflection</span>.<span class="ruby-identifier">klass</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">ids</span>).<span class="ruby-identifier">index_by</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">:id</span>).<span class="ruby-identifier">values_at</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">ids</span>))
1339:             <span class="ruby-keyword kw">end</span>
1340:           <span class="ruby-keyword kw">end</span>
1341:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000415">
                    
                    <a name="M000415"></a><b>collection_reader_method</b>(reflection, association_proxy_class)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000415_source')" id="l_M000415_source">show</a>
                        
                    </p>
                    <div id="M000415_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File activerecord-2.3.14/lib/active_record/associations.rb, line 1301</span>
1301:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">collection_reader_method</span>(<span class="ruby-identifier">reflection</span>, <span class="ruby-identifier">association_proxy_class</span>)
1302:           <span class="ruby-identifier">define_method</span>(<span class="ruby-identifier">reflection</span>.<span class="ruby-identifier">name</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-operator">*</span><span class="ruby-identifier">params</span><span class="ruby-operator">|</span>
1303:             <span class="ruby-identifier">force_reload</span> = <span class="ruby-identifier">params</span>.<span class="ruby-identifier">first</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">params</span>.<span class="ruby-identifier">empty?</span>
1304:             <span class="ruby-identifier">association</span> = <span class="ruby-identifier">association_instance_get</span>(<span class="ruby-identifier">reflection</span>.<span class="ruby-identifier">name</span>)
1305: 
1306:             <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">association</span>
1307:               <span class="ruby-identifier">association</span> = <span class="ruby-identifier">association_proxy_class</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword kw">self</span>, <span class="ruby-identifier">reflection</span>)
1308:               <span class="ruby-identifier">association_instance_set</span>(<span class="ruby-identifier">reflection</span>.<span class="ruby-identifier">name</span>, <span class="ruby-identifier">association</span>)
1309:             <span class="ruby-keyword kw">end</span>
1310: 
1311:             <span class="ruby-identifier">reflection</span>.<span class="ruby-identifier">klass</span>.<span class="ruby-identifier">uncached</span> { <span class="ruby-identifier">association</span>.<span class="ruby-identifier">reload</span> } <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">force_reload</span>
1312: 
1313:             <span class="ruby-identifier">association</span>
1314:           <span class="ruby-keyword kw">end</span>
1315: 
1316:           <span class="ruby-identifier">define_method</span>(<span class="ruby-node">&quot;#{reflection.name.to_s.singularize}_ids&quot;</span>) <span class="ruby-keyword kw">do</span>
1317:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">send</span>(<span class="ruby-identifier">reflection</span>.<span class="ruby-identifier">name</span>).<span class="ruby-identifier">loaded?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">reflection</span>.<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:finder_sql</span>]
1318:               <span class="ruby-identifier">send</span>(<span class="ruby-identifier">reflection</span>.<span class="ruby-identifier">name</span>).<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">:id</span>)
1319:             <span class="ruby-keyword kw">else</span>
1320:               <span class="ruby-identifier">send</span>(<span class="ruby-identifier">reflection</span>.<span class="ruby-identifier">name</span>).<span class="ruby-identifier">all</span>(<span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{reflection.quoted_table_name}.#{reflection.klass.primary_key}&quot;</span>).<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">:id</span>)
1321:             <span class="ruby-keyword kw">end</span>
1322:           <span class="ruby-keyword kw">end</span>
1323:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000462">
                    
                    <a name="M000462"></a><b>column_aliases</b>(join_dependency)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000462_source')" id="l_M000462_source">show</a>
                        
                    </p>
                    <div id="M000462_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File activerecord-2.3.14/lib/active_record/associations.rb, line 1789</span>
1789:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">column_aliases</span>(<span class="ruby-identifier">join_dependency</span>)
1790:           <span class="ruby-identifier">join_dependency</span>.<span class="ruby-identifier">joins</span>.<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">join</span><span class="ruby-operator">|</span> <span class="ruby-identifier">join</span>.<span class="ruby-identifier">column_names_with_alias</span>.<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">column_name</span>, <span class="ruby-identifier">aliased_name</span><span class="ruby-operator">|</span>
1791:               <span class="ruby-node">&quot;#{connection.quote_table_name join.aliased_table_name}.#{connection.quote_column_name column_name} AS #{aliased_name}&quot;</span>}}.<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;, &quot;</span>)
1792:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000464">
                    
                    <a name="M000464"></a><b>condition_word</b>(sql)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000464_source')" id="l_M000464_source">show</a>
                        
                    </p>
                    <div id="M000464_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File activerecord-2.3.14/lib/active_record/associations.rb, line 1808</span>
1808:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">condition_word</span>(<span class="ruby-identifier">sql</span>)
1809:           <span class="ruby-identifier">sql</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/where/i</span> <span class="ruby-operator">?</span> <span class="ruby-value str">&quot; AND &quot;</span> <span class="ruby-operator">:</span> <span class="ruby-value str">&quot;WHERE &quot;</span>
1810:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000446">
                    
                    <a name="M000446"></a><b>conditions_tables</b>(options)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000446_source')" id="l_M000446_source">show</a>
                        
                    </p>
                    <div id="M000446_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File activerecord-2.3.14/lib/active_record/associations.rb, line 1724</span>
1724:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">conditions_tables</span>(<span class="ruby-identifier">options</span>)
1725:           <span class="ruby-comment cmt"># look in both sets of conditions</span>
1726:           <span class="ruby-identifier">conditions</span> = [<span class="ruby-identifier">scope</span>(<span class="ruby-identifier">:find</span>, <span class="ruby-identifier">:conditions</span>), <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:conditions</span>]].<span class="ruby-identifier">inject</span>([]) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">all</span>, <span class="ruby-identifier">cond</span><span class="ruby-operator">|</span>
1727:             <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">cond</span>
1728:               <span class="ruby-keyword kw">when</span> <span class="ruby-keyword kw">nil</span>   <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">all</span>
1729:               <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Array</span> <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">all</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">tables_in_string</span>(<span class="ruby-identifier">cond</span>.<span class="ruby-identifier">first</span>)
1730:               <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Hash</span>  <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">all</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">tables_in_hash</span>(<span class="ruby-identifier">cond</span>)
1731:               <span class="ruby-keyword kw">else</span>            <span class="ruby-identifier">all</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">tables_in_string</span>(<span class="ruby-identifier">cond</span>)
1732:             <span class="ruby-keyword kw">end</span>
1733:           <span class="ruby-keyword kw">end</span>
1734:           <span class="ruby-identifier">conditions</span>.<span class="ruby-identifier">flatten</span>
1735:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000423">
                    
                    <a name="M000423"></a><b>configure_dependency_for_belongs_to</b>(reflection)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000423_source')" id="l_M000423_source">show</a>
                        
                    </p>
                    <div id="M000423_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File activerecord-2.3.14/lib/active_record/associations.rb, line 1494</span>
1494:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">configure_dependency_for_belongs_to</span>(<span class="ruby-identifier">reflection</span>)
1495:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">reflection</span>.<span class="ruby-identifier">options</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">:dependent</span>)
1496:             <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">reflection</span>.<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:dependent</span>]
1497:               <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:destroy</span>
1498:                 <span class="ruby-identifier">method_name</span> = <span class="ruby-node">&quot;belongs_to_dependent_destroy_for_#{reflection.name}&quot;</span>.<span class="ruby-identifier">to_sym</span>
1499:                 <span class="ruby-identifier">define_method</span>(<span class="ruby-identifier">method_name</span>) <span class="ruby-keyword kw">do</span>
1500:                   <span class="ruby-identifier">association</span> = <span class="ruby-identifier">send</span>(<span class="ruby-identifier">reflection</span>.<span class="ruby-identifier">name</span>)
1501:                   <span class="ruby-identifier">association</span>.<span class="ruby-identifier">destroy</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">association</span>.<span class="ruby-identifier">nil?</span>
1502:                 <span class="ruby-keyword kw">end</span>
1503:                 <span class="ruby-identifier">after_destroy</span> <span class="ruby-identifier">method_name</span>
1504:               <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:delete</span>
1505:                 <span class="ruby-identifier">method_name</span> = <span class="ruby-node">&quot;belongs_to_dependent_delete_for_#{reflection.name}&quot;</span>.<span class="ruby-identifier">to_sym</span>
1506:                 <span class="ruby-identifier">define_method</span>(<span class="ruby-identifier">method_name</span>) <span class="ruby-keyword kw">do</span>
1507:                   <span class="ruby-identifier">association</span> = <span class="ruby-identifier">send</span>(<span class="ruby-identifier">reflection</span>.<span class="ruby-identifier">name</span>)
1508:                   <span class="ruby-identifier">association</span>.<span class="ruby-identifier">delete</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">association</span>.<span class="ruby-identifier">nil?</span>
1509:                 <span class="ruby-keyword kw">end</span>
1510:                 <span class="ruby-identifier">after_destroy</span> <span class="ruby-identifier">method_name</span>
1511:               <span class="ruby-keyword kw">else</span>
1512:                 <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-node">&quot;The :dependent option expects either :destroy or :delete (#{reflection.options[:dependent].inspect})&quot;</span>
1513:             <span class="ruby-keyword kw">end</span>
1514:           <span class="ruby-keyword kw">end</span>
1515:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000421">
                    
                    <a name="M000421"></a><b>configure_dependency_for_has_many</b>(reflection, extra_conditions = nil)
                    
                </div>
                
                <div class="description">
                  <p>
Creates before_destroy callback methods that nullify, delete or destroy <a
href="ClassMethods.html#M000409">has_many</a> associated objects, according
to the defined :dependent rule.
</p>
<p>
See HasManyAssociation#delete_records. Dependent associations delete
children, otherwise foreign key is set to NULL.
</p>
<p>
The <tt>extra_conditions</tt> parameter, which is not used within the main
Active Record codebase, is meant to allow plugins to define extra finder
conditions.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000421_source')" id="l_M000421_source">show</a>
                        
                    </p>
                    <div id="M000421_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File activerecord-2.3.14/lib/active_record/associations.rb, line 1417</span>
1417:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">configure_dependency_for_has_many</span>(<span class="ruby-identifier">reflection</span>, <span class="ruby-identifier">extra_conditions</span> = <span class="ruby-keyword kw">nil</span>)
1418:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">reflection</span>.<span class="ruby-identifier">options</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">:dependent</span>)
1419:             <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">reflection</span>.<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:dependent</span>]
1420:               <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:destroy</span>
1421:                 <span class="ruby-identifier">method_name</span> = <span class="ruby-node">&quot;has_many_dependent_destroy_for_#{reflection.name}&quot;</span>.<span class="ruby-identifier">to_sym</span>
1422:                 <span class="ruby-identifier">define_method</span>(<span class="ruby-identifier">method_name</span>) <span class="ruby-keyword kw">do</span>
1423:                   <span class="ruby-identifier">send</span>(<span class="ruby-identifier">reflection</span>.<span class="ruby-identifier">name</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">o</span><span class="ruby-operator">|</span>
1424:                     <span class="ruby-comment cmt"># No point in executing the counter update since we're going to destroy the parent anyway</span>
1425:                     <span class="ruby-identifier">counter_method</span> = (<span class="ruby-value str">'belongs_to_counter_cache_before_destroy_for_'</span> <span class="ruby-operator">+</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">name</span>.<span class="ruby-identifier">downcase</span>).<span class="ruby-identifier">to_sym</span>
1426:                     <span class="ruby-keyword kw">if</span>(<span class="ruby-identifier">o</span>.<span class="ruby-identifier">respond_to?</span> <span class="ruby-identifier">counter_method</span>) <span class="ruby-keyword kw">then</span>
1427:                       <span class="ruby-keyword kw">class</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">o</span>
1428:                         <span class="ruby-keyword kw">self</span>
1429:                       <span class="ruby-keyword kw">end</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">:define_method</span>, <span class="ruby-identifier">counter_method</span>, <span class="ruby-constant">Proc</span>.<span class="ruby-identifier">new</span> {})
1430:                     <span class="ruby-keyword kw">end</span>
1431:                     <span class="ruby-identifier">o</span>.<span class="ruby-identifier">destroy</span>
1432:                   <span class="ruby-keyword kw">end</span>
1433:                 <span class="ruby-keyword kw">end</span>
1434:                 <span class="ruby-identifier">before_destroy</span> <span class="ruby-identifier">method_name</span>
1435:               <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:delete_all</span>
1436:                 <span class="ruby-identifier">before_destroy</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">record</span><span class="ruby-operator">|</span>
1437:                   <span class="ruby-identifier">record</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">:delete_all_has_many_dependencies</span>,
1438:                   <span class="ruby-identifier">record</span>,
1439:                   <span class="ruby-identifier">reflection</span>.<span class="ruby-identifier">name</span>,
1440:                   <span class="ruby-identifier">reflection</span>.<span class="ruby-identifier">klass</span>,
1441:                   <span class="ruby-identifier">reflection</span>.<span class="ruby-identifier">dependent_conditions</span>(<span class="ruby-identifier">record</span>, <span class="ruby-identifier">record</span>.<span class="ruby-identifier">class</span>, <span class="ruby-identifier">extra_conditions</span>))
1442:                 <span class="ruby-keyword kw">end</span>
1443:               <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:nullify</span>
1444:                 <span class="ruby-identifier">before_destroy</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">record</span><span class="ruby-operator">|</span>
1445:                   <span class="ruby-identifier">record</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">:nullify_has_many_dependencies</span>,
1446:                   <span class="ruby-identifier">record</span>,
1447:                   <span class="ruby-identifier">reflection</span>.<span class="ruby-identifier">name</span>,
1448:                   <span class="ruby-identifier">reflection</span>.<span class="ruby-identifier">klass</span>,
1449:                   <span class="ruby-identifier">reflection</span>.<span class="ruby-identifier">primary_key_name</span>,
1450:                   <span class="ruby-identifier">reflection</span>.<span class="ruby-identifier">dependent_conditions</span>(<span class="ruby-identifier">record</span>, <span class="ruby-identifier">record</span>.<span class="ruby-identifier">class</span>, <span class="ruby-identifier">extra_conditions</span>))
1451:                 <span class="ruby-keyword kw">end</span>
1452:               <span class="ruby-keyword kw">else</span>
1453:                 <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-node">&quot;The :dependent option expects either :destroy, :delete_all, or :nullify (#{reflection.options[:dependent].inspect})&quot;</span>
1454:             <span class="ruby-keyword kw">end</span>
1455:           <span class="ruby-keyword kw">end</span>
1456:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000422">
                    
                    <a name="M000422"></a><b>configure_dependency_for_has_one</b>(reflection)
                    
                </div>
                
                <div class="description">
                  <p>
Creates before_destroy callback methods that nullify, delete or destroy <a
href="ClassMethods.html#M000410">has_one</a> associated objects, according
to the defined :dependent rule.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000422_source')" id="l_M000422_source">show</a>
                        
                    </p>
                    <div id="M000422_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File activerecord-2.3.14/lib/active_record/associations.rb, line 1460</span>
1460:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">configure_dependency_for_has_one</span>(<span class="ruby-identifier">reflection</span>)
1461:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">reflection</span>.<span class="ruby-identifier">options</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">:dependent</span>)
1462:             <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">reflection</span>.<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:dependent</span>]
1463:               <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:destroy</span>
1464:                 <span class="ruby-identifier">method_name</span> = <span class="ruby-node">&quot;has_one_dependent_destroy_for_#{reflection.name}&quot;</span>.<span class="ruby-identifier">to_sym</span>
1465:                 <span class="ruby-identifier">define_method</span>(<span class="ruby-identifier">method_name</span>) <span class="ruby-keyword kw">do</span>
1466:                   <span class="ruby-identifier">association</span> = <span class="ruby-identifier">send</span>(<span class="ruby-identifier">reflection</span>.<span class="ruby-identifier">name</span>)
1467:                   <span class="ruby-identifier">association</span>.<span class="ruby-identifier">destroy</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">association</span>.<span class="ruby-identifier">nil?</span>
1468:                 <span class="ruby-keyword kw">end</span>
1469:                 <span class="ruby-identifier">before_destroy</span> <span class="ruby-identifier">method_name</span>
1470:               <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:delete</span>
1471:                 <span class="ruby-identifier">method_name</span> = <span class="ruby-node">&quot;has_one_dependent_delete_for_#{reflection.name}&quot;</span>.<span class="ruby-identifier">to_sym</span>
1472:                 <span class="ruby-identifier">define_method</span>(<span class="ruby-identifier">method_name</span>) <span class="ruby-keyword kw">do</span>
1473:                   <span class="ruby-comment cmt"># Retrieve the associated object and delete it. The retrieval</span>
1474:                   <span class="ruby-comment cmt"># is necessary because there may be multiple associated objects</span>
1475:                   <span class="ruby-comment cmt"># with foreign keys pointing to this object, and we only want</span>
1476:                   <span class="ruby-comment cmt"># to delete the correct one, not all of them.</span>
1477:                   <span class="ruby-identifier">association</span> = <span class="ruby-identifier">send</span>(<span class="ruby-identifier">reflection</span>.<span class="ruby-identifier">name</span>)
1478:                   <span class="ruby-identifier">association</span>.<span class="ruby-identifier">delete</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">association</span>.<span class="ruby-identifier">nil?</span>
1479:                 <span class="ruby-keyword kw">end</span>
1480:                 <span class="ruby-identifier">before_destroy</span> <span class="ruby-identifier">method_name</span>
1481:               <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:nullify</span>
1482:                 <span class="ruby-identifier">method_name</span> = <span class="ruby-node">&quot;has_one_dependent_nullify_for_#{reflection.name}&quot;</span>.<span class="ruby-identifier">to_sym</span>
1483:                 <span class="ruby-identifier">define_method</span>(<span class="ruby-identifier">method_name</span>) <span class="ruby-keyword kw">do</span>
1484:                   <span class="ruby-identifier">association</span> = <span class="ruby-identifier">send</span>(<span class="ruby-identifier">reflection</span>.<span class="ruby-identifier">name</span>)
1485:                   <span class="ruby-identifier">association</span>.<span class="ruby-identifier">update_attribute</span>(<span class="ruby-identifier">reflection</span>.<span class="ruby-identifier">primary_key_name</span>, <span class="ruby-keyword kw">nil</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">association</span>.<span class="ruby-identifier">nil?</span>
1486:                 <span class="ruby-keyword kw">end</span>
1487:                 <span class="ruby-identifier">before_destroy</span> <span class="ruby-identifier">method_name</span>
1488:               <span class="ruby-keyword kw">else</span>
1489:                 <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-node">&quot;The :dependent option expects either :destroy, :delete or :nullify (#{reflection.options[:dependent].inspect})&quot;</span>
1490:             <span class="ruby-keyword kw">end</span>
1491:           <span class="ruby-keyword kw">end</span>
1492:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000439">
                    
                    <a name="M000439"></a><b>construct_finder_sql_for_association_limiting</b>(options, join_dependency)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000439_source')" id="l_M000439_source">show</a>
                        
                    </p>
                    <div id="M000439_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File activerecord-2.3.14/lib/active_record/associations.rb, line 1663</span>
1663:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">construct_finder_sql_for_association_limiting</span>(<span class="ruby-identifier">options</span>, <span class="ruby-identifier">join_dependency</span>)
1664:           <span class="ruby-identifier">scope</span>       = <span class="ruby-identifier">scope</span>(<span class="ruby-identifier">:find</span>)
1665: 
1666:           <span class="ruby-comment cmt"># Only join tables referenced in order or conditions since this is particularly slow on the pre-query.</span>
1667:           <span class="ruby-identifier">tables_from_conditions</span> = <span class="ruby-identifier">conditions_tables</span>(<span class="ruby-identifier">options</span>)
1668:           <span class="ruby-identifier">tables_from_order</span>      = <span class="ruby-identifier">order_tables</span>(<span class="ruby-identifier">options</span>)
1669:           <span class="ruby-identifier">all_tables</span>             = <span class="ruby-identifier">tables_from_conditions</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">tables_from_order</span>
1670:           <span class="ruby-identifier">distinct_join_associations</span> = <span class="ruby-identifier">all_tables</span>.<span class="ruby-identifier">uniq</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">table</span><span class="ruby-operator">|</span>
1671:             <span class="ruby-identifier">join_dependency</span>.<span class="ruby-identifier">joins_for_table_name</span>(<span class="ruby-identifier">table</span>)
1672:           }.<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">uniq</span>
1673: 
1674:           <span class="ruby-identifier">order</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:order</span>]
1675:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">scoped_order</span> = (<span class="ruby-identifier">scope</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">scope</span>[<span class="ruby-identifier">:order</span>])
1676:             <span class="ruby-identifier">order</span> = <span class="ruby-identifier">order</span> <span class="ruby-value">? </span><span class="ruby-node">&quot;#{order}, #{scoped_order}&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">scoped_order</span>
1677:           <span class="ruby-keyword kw">end</span>
1678: 
1679:           <span class="ruby-identifier">is_distinct</span> = <span class="ruby-operator">!</span><span class="ruby-identifier">options</span>[<span class="ruby-identifier">:joins</span>].<span class="ruby-identifier">blank?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">include_eager_conditions?</span>(<span class="ruby-identifier">options</span>, <span class="ruby-identifier">tables_from_conditions</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">include_eager_order?</span>(<span class="ruby-identifier">options</span>, <span class="ruby-identifier">tables_from_order</span>)
1680:           <span class="ruby-identifier">sql</span> = <span class="ruby-value str">&quot;SELECT &quot;</span>
1681:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">is_distinct</span>
1682:             <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">distinct</span>(<span class="ruby-node">&quot;#{connection.quote_table_name table_name}.#{primary_key}&quot;</span>, <span class="ruby-identifier">order</span>)
1683:           <span class="ruby-keyword kw">else</span>
1684:             <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">primary_key</span>
1685:           <span class="ruby-keyword kw">end</span>
1686:           <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot; FROM #{connection.quote_table_name table_name} &quot;</span>
1687: 
1688:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">is_distinct</span>
1689:             <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">distinct_join_associations</span>.<span class="ruby-identifier">collect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">assoc</span><span class="ruby-operator">|</span> <span class="ruby-identifier">assoc</span>.<span class="ruby-identifier">association_join</span> }.<span class="ruby-identifier">join</span>
1690:             <span class="ruby-identifier">add_joins!</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:joins</span>], <span class="ruby-identifier">scope</span>)
1691:           <span class="ruby-keyword kw">end</span>
1692: 
1693:           <span class="ruby-identifier">add_conditions!</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:conditions</span>], <span class="ruby-identifier">scope</span>)
1694:           <span class="ruby-identifier">add_group!</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:group</span>], <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:having</span>], <span class="ruby-identifier">scope</span>)
1695: 
1696:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">order</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">is_distinct</span>
1697:             <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_order_by_for_association_limiting!</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">order</span>)
1698:           <span class="ruby-keyword kw">else</span>
1699:             <span class="ruby-identifier">add_order!</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:order</span>], <span class="ruby-identifier">scope</span>)
1700:           <span class="ruby-keyword kw">end</span>
1701: 
1702:           <span class="ruby-identifier">add_limit!</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">options</span>, <span class="ruby-identifier">scope</span>)
1703: 
1704:           <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">sanitize_sql</span>(<span class="ruby-identifier">sql</span>)
1705:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000436">
                    
                    <a name="M000436"></a><b>construct_finder_sql_with_included_associations</b>(options, join_dependency)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000436_source')" id="l_M000436_source">show</a>
                        
                    </p>
                    <div id="M000436_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File activerecord-2.3.14/lib/active_record/associations.rb, line 1629</span>
1629:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">construct_finder_sql_with_included_associations</span>(<span class="ruby-identifier">options</span>, <span class="ruby-identifier">join_dependency</span>)
1630:           <span class="ruby-identifier">scope</span> = <span class="ruby-identifier">scope</span>(<span class="ruby-identifier">:find</span>)
1631:           <span class="ruby-identifier">sql</span> = <span class="ruby-node">&quot;SELECT #{column_aliases(join_dependency)} FROM #{(scope &amp;&amp; scope[:from]) || options[:from] || quoted_table_name} &quot;</span>
1632:           <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">join_dependency</span>.<span class="ruby-identifier">join_associations</span>.<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">join</span><span class="ruby-operator">|</span> <span class="ruby-identifier">join</span>.<span class="ruby-identifier">association_join</span> }.<span class="ruby-identifier">join</span>
1633: 
1634:           <span class="ruby-identifier">add_joins!</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:joins</span>], <span class="ruby-identifier">scope</span>)
1635:           <span class="ruby-identifier">add_conditions!</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:conditions</span>], <span class="ruby-identifier">scope</span>)
1636:           <span class="ruby-identifier">add_limited_ids_condition!</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">options</span>, <span class="ruby-identifier">join_dependency</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">using_limitable_reflections?</span>(<span class="ruby-identifier">join_dependency</span>.<span class="ruby-identifier">reflections</span>) <span class="ruby-operator">&amp;&amp;</span> ((<span class="ruby-identifier">scope</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">scope</span>[<span class="ruby-identifier">:limit</span>]) <span class="ruby-operator">||</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:limit</span>])
1637: 
1638:           <span class="ruby-identifier">add_group!</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:group</span>], <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:having</span>], <span class="ruby-identifier">scope</span>)
1639:           <span class="ruby-identifier">add_order!</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:order</span>], <span class="ruby-identifier">scope</span>)
1640:           <span class="ruby-identifier">add_limit!</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">options</span>, <span class="ruby-identifier">scope</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">using_limitable_reflections?</span>(<span class="ruby-identifier">join_dependency</span>.<span class="ruby-identifier">reflections</span>)
1641:           <span class="ruby-identifier">add_lock!</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">options</span>, <span class="ruby-identifier">scope</span>)
1642: 
1643:           <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">sanitize_sql</span>(<span class="ruby-identifier">sql</span>)
1644:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000429">
                    
                    <a name="M000429"></a><b>create_belongs_to_reflection</b>(association_id, options)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000429_source')" id="l_M000429_source">show</a>
                        
                    </p>
                    <div id="M000429_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File activerecord-2.3.14/lib/active_record/associations.rb, line 1571</span>
1571:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create_belongs_to_reflection</span>(<span class="ruby-identifier">association_id</span>, <span class="ruby-identifier">options</span>)
1572:           <span class="ruby-identifier">options</span>.<span class="ruby-identifier">assert_valid_keys</span>(<span class="ruby-identifier">valid_keys_for_belongs_to_association</span>)
1573:           <span class="ruby-identifier">reflection</span> = <span class="ruby-identifier">create_reflection</span>(<span class="ruby-identifier">:belongs_to</span>, <span class="ruby-identifier">association_id</span>, <span class="ruby-identifier">options</span>, <span class="ruby-keyword kw">self</span>)
1574: 
1575:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:polymorphic</span>]
1576:             <span class="ruby-identifier">reflection</span>.<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:foreign_type</span>] <span class="ruby-operator">||=</span> <span class="ruby-identifier">reflection</span>.<span class="ruby-identifier">class_name</span>.<span class="ruby-identifier">underscore</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;_type&quot;</span>
1577:           <span class="ruby-keyword kw">end</span>
1578: 
1579:           <span class="ruby-identifier">reflection</span>
1580:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000465">
                    
                    <a name="M000465"></a><b>create_extension_modules</b>(association_id, block_extension, extensions)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000465_source')" id="l_M000465_source">show</a>
                        
                    </p>
                    <div id="M000465_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File activerecord-2.3.14/lib/active_record/associations.rb, line 1812</span>
1812:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create_extension_modules</span>(<span class="ruby-identifier">association_id</span>, <span class="ruby-identifier">block_extension</span>, <span class="ruby-identifier">extensions</span>)
1813:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block_extension</span>
1814:             <span class="ruby-identifier">extension_module_name</span> = <span class="ruby-node">&quot;#{self.to_s.demodulize}#{association_id.to_s.camelize}AssociationExtension&quot;</span>
1815: 
1816:             <span class="ruby-identifier">silence_warnings</span> <span class="ruby-keyword kw">do</span>
1817:               <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">parent</span>.<span class="ruby-identifier">const_set</span>(<span class="ruby-identifier">extension_module_name</span>, <span class="ruby-constant">Module</span>.<span class="ruby-identifier">new</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block_extension</span>))
1818:             <span class="ruby-keyword kw">end</span>
1819:             <span class="ruby-constant">Array</span>(<span class="ruby-identifier">extensions</span>).<span class="ruby-identifier">push</span>(<span class="ruby-node">&quot;#{self.parent}::#{extension_module_name}&quot;</span>.<span class="ruby-identifier">constantize</span>)
1820:           <span class="ruby-keyword kw">else</span>
1821:             <span class="ruby-constant">Array</span>(<span class="ruby-identifier">extensions</span>)
1822:           <span class="ruby-keyword kw">end</span>
1823:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000431">
                    
                    <a name="M000431"></a><b>create_has_and_belongs_to_many_reflection</b>(association_id, options, &amp;extension)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000431_source')" id="l_M000431_source">show</a>
                        
                    </p>
                    <div id="M000431_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File activerecord-2.3.14/lib/active_record/associations.rb, line 1593</span>
1593:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create_has_and_belongs_to_many_reflection</span>(<span class="ruby-identifier">association_id</span>, <span class="ruby-identifier">options</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">extension</span>)
1594:           <span class="ruby-identifier">options</span>.<span class="ruby-identifier">assert_valid_keys</span>(<span class="ruby-identifier">valid_keys_for_has_and_belongs_to_many_association</span>)
1595: 
1596:           <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:extend</span>] = <span class="ruby-identifier">create_extension_modules</span>(<span class="ruby-identifier">association_id</span>, <span class="ruby-identifier">extension</span>, <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:extend</span>])
1597: 
1598:           <span class="ruby-identifier">reflection</span> = <span class="ruby-identifier">create_reflection</span>(<span class="ruby-identifier">:has_and_belongs_to_many</span>, <span class="ruby-identifier">association_id</span>, <span class="ruby-identifier">options</span>, <span class="ruby-keyword kw">self</span>)
1599:           
1600:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">reflection</span>.<span class="ruby-identifier">association_foreign_key</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">reflection</span>.<span class="ruby-identifier">primary_key_name</span>
1601:             <span class="ruby-identifier">raise</span> <span class="ruby-constant">HasAndBelongsToManyAssociationForeignKeyNeeded</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">reflection</span>)
1602:           <span class="ruby-keyword kw">end</span>
1603: 
1604:           <span class="ruby-identifier">reflection</span>.<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:join_table</span>] <span class="ruby-operator">||=</span> <span class="ruby-identifier">join_table_name</span>(<span class="ruby-identifier">undecorated_table_name</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">to_s</span>), <span class="ruby-identifier">undecorated_table_name</span>(<span class="ruby-identifier">reflection</span>.<span class="ruby-identifier">class_name</span>))
1605: 
1606:           <span class="ruby-identifier">reflection</span>
1607:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000426">
                    
                    <a name="M000426"></a><b>create_has_many_reflection</b>(association_id, options, &amp;extension)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000426_source')" id="l_M000426_source">show</a>
                        
                    </p>
                    <div id="M000426_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File activerecord-2.3.14/lib/active_record/associations.rb, line 1538</span>
1538:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create_has_many_reflection</span>(<span class="ruby-identifier">association_id</span>, <span class="ruby-identifier">options</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">extension</span>)
1539:           <span class="ruby-identifier">options</span>.<span class="ruby-identifier">assert_valid_keys</span>(<span class="ruby-identifier">valid_keys_for_has_many_association</span>)
1540:           <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:extend</span>] = <span class="ruby-identifier">create_extension_modules</span>(<span class="ruby-identifier">association_id</span>, <span class="ruby-identifier">extension</span>, <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:extend</span>])
1541: 
1542:           <span class="ruby-identifier">create_reflection</span>(<span class="ruby-identifier">:has_many</span>, <span class="ruby-identifier">association_id</span>, <span class="ruby-identifier">options</span>, <span class="ruby-keyword kw">self</span>)
1543:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000427">
                    
                    <a name="M000427"></a><b>create_has_one_reflection</b>(association_id, options)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000427_source')" id="l_M000427_source">show</a>
                        
                    </p>
                    <div id="M000427_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File activerecord-2.3.14/lib/active_record/associations.rb, line 1552</span>
1552:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create_has_one_reflection</span>(<span class="ruby-identifier">association_id</span>, <span class="ruby-identifier">options</span>)
1553:           <span class="ruby-identifier">options</span>.<span class="ruby-identifier">assert_valid_keys</span>(<span class="ruby-identifier">valid_keys_for_has_one_association</span>)
1554:           <span class="ruby-identifier">create_reflection</span>(<span class="ruby-identifier">:has_one</span>, <span class="ruby-identifier">association_id</span>, <span class="ruby-identifier">options</span>, <span class="ruby-keyword kw">self</span>)
1555:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000428">
                    
                    <a name="M000428"></a><b>create_has_one_through_reflection</b>(association_id, options)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000428_source')" id="l_M000428_source">show</a>
                        
                    </p>
                    <div id="M000428_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File activerecord-2.3.14/lib/active_record/associations.rb, line 1557</span>
1557:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create_has_one_through_reflection</span>(<span class="ruby-identifier">association_id</span>, <span class="ruby-identifier">options</span>)
1558:           <span class="ruby-identifier">options</span>.<span class="ruby-identifier">assert_valid_keys</span>(
1559:             <span class="ruby-identifier">:class_name</span>, <span class="ruby-identifier">:foreign_key</span>, <span class="ruby-identifier">:remote</span>, <span class="ruby-identifier">:select</span>, <span class="ruby-identifier">:conditions</span>, <span class="ruby-identifier">:order</span>, <span class="ruby-identifier">:include</span>, <span class="ruby-identifier">:dependent</span>, <span class="ruby-identifier">:counter_cache</span>, <span class="ruby-identifier">:extend</span>, <span class="ruby-identifier">:as</span>, <span class="ruby-identifier">:through</span>, <span class="ruby-identifier">:source</span>, <span class="ruby-identifier">:source_type</span>, <span class="ruby-identifier">:validate</span>
1560:           )
1561:           <span class="ruby-identifier">create_reflection</span>(<span class="ruby-identifier">:has_one</span>, <span class="ruby-identifier">association_id</span>, <span class="ruby-identifier">options</span>, <span class="ruby-keyword kw">self</span>)
1562:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000424">
                    
                    <a name="M000424"></a><b>delete_all_has_many_dependencies</b>(record, reflection_name, association_class, dependent_conditions)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000424_source')" id="l_M000424_source">show</a>
                        
                    </p>
                    <div id="M000424_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File activerecord-2.3.14/lib/active_record/associations.rb, line 1517</span>
1517:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">delete_all_has_many_dependencies</span>(<span class="ruby-identifier">record</span>, <span class="ruby-identifier">reflection_name</span>, <span class="ruby-identifier">association_class</span>, <span class="ruby-identifier">dependent_conditions</span>)
1518:           <span class="ruby-identifier">association_class</span>.<span class="ruby-identifier">delete_all</span>(<span class="ruby-identifier">dependent_conditions</span>)
1519:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000420">
                    
                    <a name="M000420"></a><b>find_with_associations</b>(options = {})
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000420_source')" id="l_M000420_source">show</a>
                        
                    </p>
                    <div id="M000420_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File activerecord-2.3.14/lib/active_record/associations.rb, line 1399</span>
1399:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">find_with_associations</span>(<span class="ruby-identifier">options</span> = {})
1400:           <span class="ruby-identifier">catch</span> <span class="ruby-identifier">:invalid_query</span> <span class="ruby-keyword kw">do</span>
1401:             <span class="ruby-identifier">join_dependency</span> = <span class="ruby-constant">JoinDependency</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword kw">self</span>, <span class="ruby-identifier">merge_includes</span>(<span class="ruby-identifier">scope</span>(<span class="ruby-identifier">:find</span>, <span class="ruby-identifier">:include</span>), <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:include</span>]), <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:joins</span>])
1402:             <span class="ruby-identifier">rows</span> = <span class="ruby-identifier">select_all_rows</span>(<span class="ruby-identifier">options</span>, <span class="ruby-identifier">join_dependency</span>)
1403:             <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">join_dependency</span>.<span class="ruby-identifier">instantiate</span>(<span class="ruby-identifier">rows</span>)
1404:           <span class="ruby-keyword kw">end</span>
1405:           []
1406:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000434">
                    
                    <a name="M000434"></a><b>guard_against_unlimitable_reflections</b>(reflections, options)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000434_source')" id="l_M000434_source">show</a>
                        
                    </p>
                    <div id="M000434_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File activerecord-2.3.14/lib/active_record/associations.rb, line 1613</span>
1613:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">guard_against_unlimitable_reflections</span>(<span class="ruby-identifier">reflections</span>, <span class="ruby-identifier">options</span>)
1614:           <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:offset</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:limit</span>]) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">using_limitable_reflections?</span>(<span class="ruby-identifier">reflections</span>)
1615:             <span class="ruby-identifier">raise</span>(
1616:               <span class="ruby-constant">ConfigurationError</span>,
1617:               <span class="ruby-value str">&quot;You can not use offset and limit together with has_many or has_and_belongs_to_many associations&quot;</span>
1618:             )
1619:           <span class="ruby-keyword kw">end</span>
1620:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000456">
                    
                    <a name="M000456"></a><b>include_eager_conditions?</b>(options, tables = nil, joined_tables = nil)
                    
                </div>
                
                <div class="description">
                  <p>
Checks if the conditions reference a table other than the current model
table
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000456_source')" id="l_M000456_source">show</a>
                        
                    </p>
                    <div id="M000456_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File activerecord-2.3.14/lib/active_record/associations.rb, line 1767</span>
1767:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">include_eager_conditions?</span>(<span class="ruby-identifier">options</span>, <span class="ruby-identifier">tables</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">joined_tables</span> = <span class="ruby-keyword kw">nil</span>)
1768:           ((<span class="ruby-identifier">tables</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">conditions_tables</span>(<span class="ruby-identifier">options</span>)) <span class="ruby-operator">-</span> (<span class="ruby-identifier">joined_tables</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">joined_tables</span>(<span class="ruby-identifier">options</span>))).<span class="ruby-identifier">any?</span>
1769:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000458">
                    
                    <a name="M000458"></a><b>include_eager_order?</b>(options, tables = nil, joined_tables = nil)
                    
                </div>
                
                <div class="description">
                  <p>
Checks if the query order references a table other than the current
model&#8217;s table.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000458_source')" id="l_M000458_source">show</a>
                        
                    </p>
                    <div id="M000458_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File activerecord-2.3.14/lib/active_record/associations.rb, line 1772</span>
1772:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">include_eager_order?</span>(<span class="ruby-identifier">options</span>, <span class="ruby-identifier">tables</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">joined_tables</span> = <span class="ruby-keyword kw">nil</span>)
1773:           ((<span class="ruby-identifier">tables</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">order_tables</span>(<span class="ruby-identifier">options</span>)) <span class="ruby-operator">-</span> (<span class="ruby-identifier">joined_tables</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">joined_tables</span>(<span class="ruby-identifier">options</span>))).<span class="ruby-identifier">any?</span>
1774:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000459">
                    
                    <a name="M000459"></a><b>include_eager_select?</b>(options, joined_tables = nil)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000459_source')" id="l_M000459_source">show</a>
                        
                    </p>
                    <div id="M000459_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File activerecord-2.3.14/lib/active_record/associations.rb, line 1776</span>
1776:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">include_eager_select?</span>(<span class="ruby-identifier">options</span>, <span class="ruby-identifier">joined_tables</span> = <span class="ruby-keyword kw">nil</span>)
1777:           (<span class="ruby-identifier">selects_tables</span>(<span class="ruby-identifier">options</span>) <span class="ruby-operator">-</span> (<span class="ruby-identifier">joined_tables</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">joined_tables</span>(<span class="ruby-identifier">options</span>))).<span class="ruby-identifier">any?</span>
1778:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000413">
                    
                    <a name="M000413"></a><b>join_table_name</b>(first_table_name, second_table_name)
                    
                </div>
                
                <div class="description">
                  <p>
Generates a join table name from two provided table names. The names in the
join table namesme end up in lexicographic order.
</p>
<pre>
  join_table_name(&quot;members&quot;, &quot;clubs&quot;)         # =&gt; &quot;clubs_members&quot;
  join_table_name(&quot;members&quot;, &quot;special_clubs&quot;) # =&gt; &quot;members_special_clubs&quot;
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000413_source')" id="l_M000413_source">show</a>
                        
                    </p>
                    <div id="M000413_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File activerecord-2.3.14/lib/active_record/associations.rb, line 1240</span>
1240:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">join_table_name</span>(<span class="ruby-identifier">first_table_name</span>, <span class="ruby-identifier">second_table_name</span>)
1241:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">first_table_name</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">second_table_name</span>
1242:             <span class="ruby-identifier">join_table</span> = <span class="ruby-node">&quot;#{first_table_name}_#{second_table_name}&quot;</span>
1243:           <span class="ruby-keyword kw">else</span>
1244:             <span class="ruby-identifier">join_table</span> = <span class="ruby-node">&quot;#{second_table_name}_#{first_table_name}&quot;</span>
1245:           <span class="ruby-keyword kw">end</span>
1246: 
1247:           <span class="ruby-identifier">table_name_prefix</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">join_table</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">table_name_suffix</span>
1248:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000452">
                    
                    <a name="M000452"></a><b>joined_tables</b>(options)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000452_source')" id="l_M000452_source">show</a>
                        
                    </p>
                    <div id="M000452_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File activerecord-2.3.14/lib/active_record/associations.rb, line 1749</span>
1749:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">joined_tables</span>(<span class="ruby-identifier">options</span>)
1750:           <span class="ruby-identifier">scope</span> = <span class="ruby-identifier">scope</span>(<span class="ruby-identifier">:find</span>)
1751:           <span class="ruby-identifier">joins</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:joins</span>]
1752:           <span class="ruby-identifier">merged_joins</span> = <span class="ruby-identifier">scope</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">scope</span>[<span class="ruby-identifier">:joins</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">joins</span> <span class="ruby-value">? </span><span class="ruby-identifier">merge_joins</span>(<span class="ruby-identifier">scope</span>[<span class="ruby-identifier">:joins</span>], <span class="ruby-identifier">joins</span>) <span class="ruby-operator">:</span> (<span class="ruby-identifier">joins</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">scope</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">scope</span>[<span class="ruby-identifier">:joins</span>])
1753:           [<span class="ruby-identifier">table_name</span>] <span class="ruby-operator">+</span> <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">merged_joins</span>
1754:           <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Symbol</span>, <span class="ruby-constant">Hash</span>, <span class="ruby-constant">Array</span>
1755:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">array_of_strings?</span>(<span class="ruby-identifier">merged_joins</span>)
1756:               <span class="ruby-identifier">tables_in_string</span>(<span class="ruby-identifier">merged_joins</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">' '</span>))
1757:             <span class="ruby-keyword kw">else</span>
1758:               <span class="ruby-identifier">join_dependency</span> = <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Associations</span><span class="ruby-operator">::</span><span class="ruby-constant">ClassMethods</span><span class="ruby-operator">::</span><span class="ruby-constant">InnerJoinDependency</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword kw">self</span>, <span class="ruby-identifier">merged_joins</span>, <span class="ruby-keyword kw">nil</span>)
1759:               <span class="ruby-identifier">join_dependency</span>.<span class="ruby-identifier">join_associations</span>.<span class="ruby-identifier">collect</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">join_association</span><span class="ruby-operator">|</span> [<span class="ruby-identifier">join_association</span>.<span class="ruby-identifier">aliased_join_table_name</span>, <span class="ruby-identifier">join_association</span>.<span class="ruby-identifier">aliased_table_name</span>]}.<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">compact</span>
1760:             <span class="ruby-keyword kw">end</span>
1761:           <span class="ruby-keyword kw">else</span>
1762:             <span class="ruby-identifier">tables_in_string</span>(<span class="ruby-identifier">merged_joins</span>)
1763:           <span class="ruby-keyword kw">end</span>
1764:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000425">
                    
                    <a name="M000425"></a><b>nullify_has_many_dependencies</b>(record, reflection_name, association_class, primary_key_name, dependent_conditions)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000425_source')" id="l_M000425_source">show</a>
                        
                    </p>
                    <div id="M000425_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File activerecord-2.3.14/lib/active_record/associations.rb, line 1521</span>
1521:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">nullify_has_many_dependencies</span>(<span class="ruby-identifier">record</span>, <span class="ruby-identifier">reflection_name</span>, <span class="ruby-identifier">association_class</span>, <span class="ruby-identifier">primary_key_name</span>, <span class="ruby-identifier">dependent_conditions</span>)
1522:           <span class="ruby-identifier">association_class</span>.<span class="ruby-identifier">update_all</span>(<span class="ruby-node">&quot;#{primary_key_name} = NULL&quot;</span>, <span class="ruby-identifier">dependent_conditions</span>)
1523:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000447">
                    
                    <a name="M000447"></a><b>order_tables</b>(options)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000447_source')" id="l_M000447_source">show</a>
                        
                    </p>
                    <div id="M000447_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File activerecord-2.3.14/lib/active_record/associations.rb, line 1737</span>
1737:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">order_tables</span>(<span class="ruby-identifier">options</span>)
1738:           <span class="ruby-identifier">order</span> = [<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:order</span>], <span class="ruby-identifier">scope</span>(<span class="ruby-identifier">:find</span>, <span class="ruby-identifier">:order</span>) ].<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;, &quot;</span>)
1739:           <span class="ruby-keyword kw">return</span> [] <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">order</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">order</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>)
1740:           <span class="ruby-identifier">tables_in_string</span>(<span class="ruby-identifier">order</span>)
1741:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000460">
                    
                    <a name="M000460"></a><b>references_eager_loaded_tables?</b>(options)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000460_source')" id="l_M000460_source">show</a>
                        
                    </p>
                    <div id="M000460_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File activerecord-2.3.14/lib/active_record/associations.rb, line 1780</span>
1780:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">references_eager_loaded_tables?</span>(<span class="ruby-identifier">options</span>)
1781:           <span class="ruby-identifier">joined_tables</span> = <span class="ruby-identifier">joined_tables</span>(<span class="ruby-identifier">options</span>)
1782:           <span class="ruby-identifier">include_eager_order?</span>(<span class="ruby-identifier">options</span>, <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">joined_tables</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">include_eager_conditions?</span>(<span class="ruby-identifier">options</span>, <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">joined_tables</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">include_eager_select?</span>(<span class="ruby-identifier">options</span>, <span class="ruby-identifier">joined_tables</span>)
1783:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000433">
                    
                    <a name="M000433"></a><b>reflect_on_included_associations</b>(associations)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000433_source')" id="l_M000433_source">show</a>
                        
                    </p>
                    <div id="M000433_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File activerecord-2.3.14/lib/active_record/associations.rb, line 1609</span>
1609:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">reflect_on_included_associations</span>(<span class="ruby-identifier">associations</span>)
1610:           [ <span class="ruby-identifier">associations</span> ].<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">collect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">association</span><span class="ruby-operator">|</span> <span class="ruby-identifier">reflect_on_association</span>(<span class="ruby-identifier">association</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">intern</span>) }
1611:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000435">
                    
                    <a name="M000435"></a><b>select_all_rows</b>(options, join_dependency)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000435_source')" id="l_M000435_source">show</a>
                        
                    </p>
                    <div id="M000435_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File activerecord-2.3.14/lib/active_record/associations.rb, line 1622</span>
1622:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">select_all_rows</span>(<span class="ruby-identifier">options</span>, <span class="ruby-identifier">join_dependency</span>)
1623:           <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">select_all</span>(
1624:             <span class="ruby-identifier">construct_finder_sql_with_included_associations</span>(<span class="ruby-identifier">options</span>, <span class="ruby-identifier">join_dependency</span>),
1625:             <span class="ruby-node">&quot;#{name} Load Including Associations&quot;</span>
1626:           )
1627:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000438">
                    
                    <a name="M000438"></a><b>select_limited_ids_list</b>(options, join_dependency)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000438_source')" id="l_M000438_source">show</a>
                        
                    </p>
                    <div id="M000438_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File activerecord-2.3.14/lib/active_record/associations.rb, line 1654</span>
1654:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">select_limited_ids_list</span>(<span class="ruby-identifier">options</span>, <span class="ruby-identifier">join_dependency</span>)
1655:           <span class="ruby-identifier">pk</span> = <span class="ruby-identifier">columns_hash</span>[<span class="ruby-identifier">primary_key</span>]
1656: 
1657:           <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">select_all</span>(
1658:             <span class="ruby-identifier">construct_finder_sql_for_association_limiting</span>(<span class="ruby-identifier">options</span>, <span class="ruby-identifier">join_dependency</span>),
1659:             <span class="ruby-node">&quot;#{name} Load IDs For Limited Eager Loading&quot;</span>
1660:           ).<span class="ruby-identifier">collect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">row</span><span class="ruby-operator">|</span> <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">quote</span>(<span class="ruby-identifier">row</span>[<span class="ruby-identifier">primary_key</span>], <span class="ruby-identifier">pk</span>) }.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;, &quot;</span>)
1661:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000448">
                    
                    <a name="M000448"></a><b>selects_tables</b>(options)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000448_source')" id="l_M000448_source">show</a>
                        
                    </p>
                    <div id="M000448_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File activerecord-2.3.14/lib/active_record/associations.rb, line 1743</span>
1743:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">selects_tables</span>(<span class="ruby-identifier">options</span>)
1744:           <span class="ruby-identifier">select</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:select</span>]
1745:           <span class="ruby-keyword kw">return</span> [] <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">select</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">select</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>)
1746:           <span class="ruby-identifier">tables_in_string</span>(<span class="ruby-identifier">select</span>)
1747:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000443">
                    
                    <a name="M000443"></a><b>tables_in_hash</b>(hash)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000443_source')" id="l_M000443_source">show</a>
                        
                    </p>
                    <div id="M000443_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File activerecord-2.3.14/lib/active_record/associations.rb, line 1712</span>
1712:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">tables_in_hash</span>(<span class="ruby-identifier">hash</span>)
1713:           <span class="ruby-keyword kw">return</span> [] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">hash</span>.<span class="ruby-identifier">blank?</span>
1714:           <span class="ruby-identifier">tables</span> = <span class="ruby-identifier">hash</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
1715:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Hash</span>)
1716:               <span class="ruby-identifier">key</span>.<span class="ruby-identifier">to_s</span>
1717:             <span class="ruby-keyword kw">else</span>
1718:               <span class="ruby-identifier">tables_in_string</span>(<span class="ruby-identifier">key</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">key</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>)
1719:             <span class="ruby-keyword kw">end</span>
1720:           <span class="ruby-keyword kw">end</span>
1721:           <span class="ruby-identifier">tables</span>.<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">compact</span>
1722:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000442">
                    
                    <a name="M000442"></a><b>tables_in_string</b>(string)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000442_source')" id="l_M000442_source">show</a>
                        
                    </p>
                    <div id="M000442_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File activerecord-2.3.14/lib/active_record/associations.rb, line 1707</span>
1707:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">tables_in_string</span>(<span class="ruby-identifier">string</span>)
1708:           <span class="ruby-keyword kw">return</span> [] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">string</span>.<span class="ruby-identifier">blank?</span>
1709:           <span class="ruby-identifier">string</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/([\.a-zA-Z_]+).?\./</span>).<span class="ruby-identifier">flatten</span>
1710:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000461">
                    
                    <a name="M000461"></a><b>using_limitable_reflections?</b>(reflections)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000461_source')" id="l_M000461_source">show</a>
                        
                    </p>
                    <div id="M000461_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File activerecord-2.3.14/lib/active_record/associations.rb, line 1785</span>
1785:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">using_limitable_reflections?</span>(<span class="ruby-identifier">reflections</span>)
1786:           <span class="ruby-identifier">reflections</span>.<span class="ruby-identifier">none?</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">:collection?</span>)
1787:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    