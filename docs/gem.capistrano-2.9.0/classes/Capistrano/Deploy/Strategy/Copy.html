<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>Capistrano::Deploy::Strategy::Copy</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../../../css/main.css" type="text/css" media="screen" />
    <script src="../../../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Class</span> 
            Capistrano::Deploy::Strategy::Copy 
            
                <span class="parent">&lt; 
                    
                    Base
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../../../files/lib/capistrano/recipes/deploy/strategy/copy_rb.html">lib/capistrano/recipes/deploy/strategy/copy.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    
    <div class="description">
        <p>
This class implements the strategy for deployments which work by preparing
the source code locally, compressing it, copying the file to each target
host, and uncompressing it to the deployment directory.
</p>
<p>
By default, the <a href="../SCM.html">SCM</a> checkout command is used to
obtain the local copy of the source code. If you would rather use the
export operation, you can set the :<a
href="Copy.html#M000350">copy_strategy</a> variable to :export.
</p>
<pre>
  set :copy_strategy, :export
</pre>
<p>
For even faster deployments, you can set the :<a
href="Copy.html#M000347">copy_cache</a> variable to true. This will cause
deployments to do a new checkout of your repository to a new directory, and
then copy that checkout. Subsequent deploys will just resync that copy,
rather than doing an entirely new checkout. Additionally, you can specify
file patterns to exclude from the copy when using :<a
href="Copy.html#M000347">copy_cache</a>; just set the :<a
href="Copy.html#M000348">copy_exclude</a> variable to a file glob (or an
array of globs).
</p>
<pre>
  set :copy_cache, true
  set :copy_exclude, &quot;.git/*&quot;
</pre>
<p>
Note that :<a href="Copy.html#M000350">copy_strategy</a> is ignored when
:<a href="Copy.html#M000347">copy_cache</a> is set. Also, if you want the
copy cache put somewhere specific, you can set the variable to the path you
want, instead of merely &#8216;true&#8217;:
</p>
<pre>
  set :copy_cache, &quot;/tmp/caches/myapp&quot;
</pre>
<p>
This deployment strategy also supports a special variable,
:copy_compression, which must be one of :gzip, :bz2, or :zip, and which
specifies how the source should be compressed for transmission to each
host.
</p>

    </div>
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>C</dt>
        <dd>
            <ul>
                
                <li><a href="#M000346">check!</a>,</li>
                
                <li><a href="#M000351">command</a>,</li>
                
                <li><a href="#M000362">compress</a>,</li>
                
                <li><a href="#M000358">compression</a>,</li>
                
                <li><a href="#M000347">copy_cache</a>,</li>
                
                <li><a href="#M000353">copy_dir</a>,</li>
                
                <li><a href="#M000348">copy_exclude</a>,</li>
                
                <li><a href="#M000350">copy_strategy</a></li>
                
            </ul>
        </dd>
    
        <dt>D</dt>
        <dd>
            <ul>
                
                <li><a href="#M000363">decompress</a>,</li>
                
                <li><a href="#M000340">deploy!</a>,</li>
                
                <li><a href="#M000349">destination</a>,</li>
                
                <li><a href="#M000365">distribute!</a></li>
                
            </ul>
        </dd>
    
        <dt>F</dt>
        <dd>
            <ul>
                
                <li><a href="#M000352">filename</a></li>
                
            </ul>
        </dd>
    
        <dt>R</dt>
        <dd>
            <ul>
                
                <li><a href="#M000354">remote_dir</a>,</li>
                
                <li><a href="#M000355">remote_filename</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    

    

    

    
    <div class="sectiontitle">Constants</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class="attr-name">Compression</td>
            <td>=</td>
            <td class="attr-value">Struct.new(:extension, :compress_command, :decompress_command)</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
A struct for representing the specifics of a compression type. Commands are
arrays, where the first element is the utility to be used to perform the
compression or decompression.
</p>
</td>
        </tr>
        
        
    </table>
    

    

    
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M000346">
                    
                    <a name="M000346"></a><b>check!</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000346_source')" id="l_M000346_source">show</a>
                        
                    </p>
                    <div id="M000346_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/capistrano/recipes/deploy/strategy/copy.rb, line 110</span>
110:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">check!</span>
111:           <span class="ruby-keyword kw">super</span>.<span class="ruby-identifier">check</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">d</span><span class="ruby-operator">|</span>
112:             <span class="ruby-identifier">d</span>.<span class="ruby-identifier">local</span>.<span class="ruby-identifier">command</span>(<span class="ruby-identifier">source</span>.<span class="ruby-identifier">local</span>.<span class="ruby-identifier">command</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">source</span>.<span class="ruby-identifier">local</span>.<span class="ruby-identifier">command</span>
113:             <span class="ruby-identifier">d</span>.<span class="ruby-identifier">local</span>.<span class="ruby-identifier">command</span>(<span class="ruby-identifier">compress</span>(<span class="ruby-keyword kw">nil</span>, <span class="ruby-keyword kw">nil</span>).<span class="ruby-identifier">first</span>)
114:             <span class="ruby-identifier">d</span>.<span class="ruby-identifier">remote</span>.<span class="ruby-identifier">command</span>(<span class="ruby-identifier">decompress</span>(<span class="ruby-keyword kw">nil</span>).<span class="ruby-identifier">first</span>)
115:           <span class="ruby-keyword kw">end</span>
116:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000347">
                    
                    <a name="M000347"></a><b>copy_cache</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Returns the location of the local copy cache, if the strategy should use a
local cache + copy instead of a new checkout/export every time. Returns
<tt>nil</tt> unless :<a href="Copy.html#M000347">copy_cache</a> has been
set. If :<a href="Copy.html#M000347">copy_cache</a> is <tt>true</tt>, a
default cache location will be returned.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000347_source')" id="l_M000347_source">show</a>
                        
                    </p>
                    <div id="M000347_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/capistrano/recipes/deploy/strategy/copy.rb, line 122</span>
122:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">copy_cache</span>
123:           <span class="ruby-ivar">@copy_cache</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">configuration</span>[<span class="ruby-identifier">:copy_cache</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">true</span> <span class="ruby-operator">?</span>
124:             <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">configuration</span>[<span class="ruby-identifier">:application</span>], <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">tmpdir</span>) <span class="ruby-operator">:</span>
125:             <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">configuration</span>[<span class="ruby-identifier">:copy_cache</span>], <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">pwd</span>) <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
126:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000340">
                    
                    <a name="M000340"></a><b>deploy!</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Obtains a copy of the source code locally (via the <a
href="Copy.html#M000351">command</a> method), compresses it to a single
file, copies that file to all target servers, and uncompresses it on each
of them into the deployment directory.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000340_source')" id="l_M000340_source">show</a>
                        
                    </p>
                    <div id="M000340_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/capistrano/recipes/deploy/strategy/copy.rb, line 46</span>
 46:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">deploy!</span>
 47:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">copy_cache</span>
 48:             <span class="ruby-keyword kw">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-identifier">copy_cache</span>)
 49:               <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">debug</span> <span class="ruby-node">&quot;refreshing local cache to revision #{revision} at #{copy_cache}&quot;</span>
 50:               <span class="ruby-identifier">system</span>(<span class="ruby-identifier">source</span>.<span class="ruby-identifier">sync</span>(<span class="ruby-identifier">revision</span>, <span class="ruby-identifier">copy_cache</span>))
 51:             <span class="ruby-keyword kw">else</span>
 52:               <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">debug</span> <span class="ruby-node">&quot;preparing local cache at #{copy_cache}&quot;</span>
 53:               <span class="ruby-identifier">system</span>(<span class="ruby-identifier">source</span>.<span class="ruby-identifier">checkout</span>(<span class="ruby-identifier">revision</span>, <span class="ruby-identifier">copy_cache</span>))
 54:             <span class="ruby-keyword kw">end</span>
 55: 
 56:             <span class="ruby-comment cmt"># Check the return code of last system command and rollback if not 0</span>
 57:             <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">$?</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
 58:               <span class="ruby-identifier">raise</span> <span class="ruby-constant">Capistrano</span><span class="ruby-operator">::</span><span class="ruby-constant">Error</span>, <span class="ruby-node">&quot;shell command failed with return code #{$?}&quot;</span>
 59:             <span class="ruby-keyword kw">end</span>
 60: 
 61:             <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span>(<span class="ruby-identifier">destination</span>)
 62: 
 63:             <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">debug</span> <span class="ruby-node">&quot;copying cache to deployment staging area #{destination}&quot;</span>
 64:             <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">chdir</span>(<span class="ruby-identifier">copy_cache</span>) <span class="ruby-keyword kw">do</span>
 65:               <span class="ruby-identifier">queue</span> = <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">glob</span>(<span class="ruby-value str">&quot;*&quot;</span>, <span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">FNM_DOTMATCH</span>)
 66:               <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">queue</span>.<span class="ruby-identifier">any?</span>
 67:                 <span class="ruby-identifier">item</span> = <span class="ruby-identifier">queue</span>.<span class="ruby-identifier">shift</span>
 68:                 <span class="ruby-identifier">name</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">basename</span>(<span class="ruby-identifier">item</span>)
 69: 
 70:                 <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;.&quot;</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;..&quot;</span>
 71:                 <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">copy_exclude</span>.<span class="ruby-identifier">any?</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">pattern</span><span class="ruby-operator">|</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">fnmatch</span>(<span class="ruby-identifier">pattern</span>, <span class="ruby-identifier">item</span>) }
 72: 
 73:                 <span class="ruby-keyword kw">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">symlink?</span>(<span class="ruby-identifier">item</span>)
 74:                   <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">ln_s</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">readlink</span>(<span class="ruby-identifier">item</span>), <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">destination</span>, <span class="ruby-identifier">item</span>))
 75:                 <span class="ruby-keyword kw">elsif</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">directory?</span>(<span class="ruby-identifier">item</span>)
 76:                   <span class="ruby-identifier">queue</span> <span class="ruby-operator">+=</span> <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">glob</span>(<span class="ruby-node">&quot;#{item}/*&quot;</span>, <span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">FNM_DOTMATCH</span>)
 77:                   <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">destination</span>, <span class="ruby-identifier">item</span>))
 78:                 <span class="ruby-keyword kw">else</span>
 79:                   <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">ln</span>(<span class="ruby-identifier">item</span>, <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">destination</span>, <span class="ruby-identifier">item</span>))
 80:                 <span class="ruby-keyword kw">end</span>
 81:               <span class="ruby-keyword kw">end</span>
 82:             <span class="ruby-keyword kw">end</span>
 83:           <span class="ruby-keyword kw">else</span>
 84:             <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">debug</span> <span class="ruby-node">&quot;getting (via #{copy_strategy}) revision #{revision} to #{destination}&quot;</span>
 85:             <span class="ruby-identifier">system</span>(<span class="ruby-identifier">command</span>)
 86: 
 87:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">copy_exclude</span>.<span class="ruby-identifier">any?</span>
 88:               <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot;processing exclusions...&quot;</span>
 89: 
 90:               <span class="ruby-identifier">copy_exclude</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">pattern</span><span class="ruby-operator">|</span>
 91:                 <span class="ruby-identifier">delete_list</span> = <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">glob</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">destination</span>, <span class="ruby-identifier">pattern</span>), <span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">FNM_DOTMATCH</span>)
 92:                 <span class="ruby-comment cmt"># avoid the /.. trap that deletes the parent directories</span>
 93:                 <span class="ruby-identifier">delete_list</span>.<span class="ruby-identifier">delete_if</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">dir</span><span class="ruby-operator">|</span> <span class="ruby-identifier">dir</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/\/\.\.$/</span> }
 94:                 <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm_rf</span>(<span class="ruby-identifier">delete_list</span>.<span class="ruby-identifier">compact</span>)
 95:               <span class="ruby-keyword kw">end</span>
 96:             <span class="ruby-keyword kw">end</span>
 97:           <span class="ruby-keyword kw">end</span>
 98: 
 99:           <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">destination</span>, <span class="ruby-value str">&quot;REVISION&quot;</span>), <span class="ruby-value str">&quot;w&quot;</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span> <span class="ruby-identifier">f</span>.<span class="ruby-identifier">puts</span>(<span class="ruby-identifier">revision</span>) }
100: 
101:           <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">trace</span> <span class="ruby-node">&quot;compressing #{destination} to #{filename}&quot;</span>
102:           <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">chdir</span>(<span class="ruby-identifier">copy_dir</span>) { <span class="ruby-identifier">system</span>(<span class="ruby-identifier">compress</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">basename</span>(<span class="ruby-identifier">destination</span>), <span class="ruby-constant">File</span>.<span class="ruby-identifier">basename</span>(<span class="ruby-identifier">filename</span>)).<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot; &quot;</span>)) }
103: 
104:           <span class="ruby-identifier">distribute!</span>
105:         <span class="ruby-keyword kw">ensure</span>
106:           <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm</span> <span class="ruby-identifier">filename</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
107:           <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm_rf</span> <span class="ruby-identifier">destination</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
108:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Private methods</div>
            
            <div class="method">
                <div class="title" id="M000351">
                    
                    <a name="M000351"></a><b>command</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Should return the command(s) necessary to obtain the source code locally.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000351_source')" id="l_M000351_source">show</a>
                        
                    </p>
                    <div id="M000351_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/capistrano/recipes/deploy/strategy/copy.rb, line 150</span>
150:           <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">command</span>
151:             <span class="ruby-ivar">@command</span> <span class="ruby-operator">||=</span> <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">copy_strategy</span>
152:             <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:checkout</span>
153:               <span class="ruby-identifier">source</span>.<span class="ruby-identifier">checkout</span>(<span class="ruby-identifier">revision</span>, <span class="ruby-identifier">destination</span>)
154:             <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:export</span>
155:               <span class="ruby-identifier">source</span>.<span class="ruby-identifier">export</span>(<span class="ruby-identifier">revision</span>, <span class="ruby-identifier">destination</span>)
156:             <span class="ruby-keyword kw">end</span>
157:           <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000362">
                    
                    <a name="M000362"></a><b>compress</b>(directory, file)
                    
                </div>
                
                <div class="description">
                  <p>
Returns the command necessary to compress the given directory into the
given file.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000362_source')" id="l_M000362_source">show</a>
                        
                    </p>
                    <div id="M000362_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/capistrano/recipes/deploy/strategy/copy.rb, line 203</span>
203:           <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">compress</span>(<span class="ruby-identifier">directory</span>, <span class="ruby-identifier">file</span>)
204:             <span class="ruby-identifier">compression</span>.<span class="ruby-identifier">compress_command</span> <span class="ruby-operator">+</span> [<span class="ruby-identifier">file</span>, <span class="ruby-identifier">directory</span>]
205:           <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000358">
                    
                    <a name="M000358"></a><b>compression</b>()
                    
                </div>
                
                <div class="description">
                  <p>
The compression method to use, defaults to :gzip.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000358_source')" id="l_M000358_source">show</a>
                        
                    </p>
                    <div id="M000358_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/capistrano/recipes/deploy/strategy/copy.rb, line 188</span>
188:           <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">compression</span>
189:             <span class="ruby-identifier">remote_tar</span> = <span class="ruby-identifier">configuration</span>[<span class="ruby-identifier">:copy_remote_tar</span>] <span class="ruby-operator">||</span> <span class="ruby-value str">'tar'</span>
190:             <span class="ruby-identifier">local_tar</span> = <span class="ruby-identifier">configuration</span>[<span class="ruby-identifier">:copy_local_tar</span>] <span class="ruby-operator">||</span> <span class="ruby-value str">'tar'</span>
191: 
192:             <span class="ruby-identifier">type</span> = <span class="ruby-identifier">configuration</span>[<span class="ruby-identifier">:copy_compression</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">:gzip</span>
193:             <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">type</span>
194:             <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:gzip</span>, <span class="ruby-identifier">:gz</span>   <span class="ruby-keyword kw">then</span> <span class="ruby-constant">Compression</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;tar.gz&quot;</span>,  [<span class="ruby-identifier">local_tar</span>, <span class="ruby-value str">'chzf'</span>], [<span class="ruby-identifier">remote_tar</span>, <span class="ruby-value str">'xzf'</span>])
195:             <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:bzip2</span>, <span class="ruby-identifier">:bz2</span> <span class="ruby-keyword kw">then</span> <span class="ruby-constant">Compression</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;tar.bz2&quot;</span>, [<span class="ruby-identifier">local_tar</span>, <span class="ruby-value str">'chjf'</span>], [<span class="ruby-identifier">remote_tar</span>, <span class="ruby-value str">'xjf'</span>])
196:             <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:zip</span>         <span class="ruby-keyword kw">then</span> <span class="ruby-constant">Compression</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;zip&quot;</span>,     <span class="ruby-node">%w(zip -qr)</span>, <span class="ruby-node">%w(unzip -q)</span>)
197:             <span class="ruby-keyword kw">else</span> <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-node">&quot;invalid compression type #{type.inspect}&quot;</span>
198:             <span class="ruby-keyword kw">end</span>
199:           <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000353">
                    
                    <a name="M000353"></a><b>copy_dir</b>()
                    
                </div>
                
                <div class="description">
                  <p>
The directory to which the copy should be checked out
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000353_source')" id="l_M000353_source">show</a>
                        
                    </p>
                    <div id="M000353_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/capistrano/recipes/deploy/strategy/copy.rb, line 166</span>
166:           <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">copy_dir</span>
167:             <span class="ruby-ivar">@copy_dir</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">configuration</span>[<span class="ruby-identifier">:copy_dir</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">tmpdir</span>, <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">pwd</span>)
168:           <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000348">
                    
                    <a name="M000348"></a><b>copy_exclude</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Specify patterns to exclude from the copy. This is only valid when using a
local cache.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000348_source')" id="l_M000348_source">show</a>
                        
                    </p>
                    <div id="M000348_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/capistrano/recipes/deploy/strategy/copy.rb, line 132</span>
132:           <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">copy_exclude</span>
133:             <span class="ruby-ivar">@copy_exclude</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">Array</span>(<span class="ruby-identifier">configuration</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-identifier">:copy_exclude</span>, []))
134:           <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000350">
                    
                    <a name="M000350"></a><b>copy_strategy</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Returns the value of the :<a href="Copy.html#M000350">copy_strategy</a>
variable, defaulting to :checkout if it has not been set.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000350_source')" id="l_M000350_source">show</a>
                        
                    </p>
                    <div id="M000350_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/capistrano/recipes/deploy/strategy/copy.rb, line 144</span>
144:           <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">copy_strategy</span>
145:             <span class="ruby-ivar">@copy_strategy</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">configuration</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-identifier">:copy_strategy</span>, <span class="ruby-identifier">:checkout</span>)
146:           <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000363">
                    
                    <a name="M000363"></a><b>decompress</b>(file)
                    
                </div>
                
                <div class="description">
                  <p>
Returns the command necessary to decompress the given file, relative to the
current working directory. It must also preserve the directory structure in
the file.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000363_source')" id="l_M000363_source">show</a>
                        
                    </p>
                    <div id="M000363_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/capistrano/recipes/deploy/strategy/copy.rb, line 210</span>
210:           <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">decompress</span>(<span class="ruby-identifier">file</span>)
211:             <span class="ruby-identifier">compression</span>.<span class="ruby-identifier">decompress_command</span> <span class="ruby-operator">+</span> [<span class="ruby-identifier">file</span>]
212:           <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000349">
                    
                    <a name="M000349"></a><b>destination</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Returns the basename of the release_path, which will be used to name the
local copy and archive file.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000349_source')" id="l_M000349_source">show</a>
                        
                    </p>
                    <div id="M000349_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/capistrano/recipes/deploy/strategy/copy.rb, line 138</span>
138:           <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">destination</span>
139:             <span class="ruby-ivar">@destination</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">copy_dir</span>, <span class="ruby-constant">File</span>.<span class="ruby-identifier">basename</span>(<span class="ruby-identifier">configuration</span>[<span class="ruby-identifier">:release_path</span>]))
140:           <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000365">
                    
                    <a name="M000365"></a><b>distribute!</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Distributes the file to the remote servers
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000365_source')" id="l_M000365_source">show</a>
                        
                    </p>
                    <div id="M000365_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/capistrano/recipes/deploy/strategy/copy.rb, line 215</span>
215:           <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">distribute!</span>
216:             <span class="ruby-identifier">upload</span>(<span class="ruby-identifier">filename</span>, <span class="ruby-identifier">remote_filename</span>)
217:             <span class="ruby-identifier">run</span> <span class="ruby-node">&quot;cd #{configuration[:releases_path]} &amp;&amp; #{decompress(remote_filename).join(&quot; &quot;)} &amp;&amp; rm #{remote_filename}&quot;</span>
218:           <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000352">
                    
                    <a name="M000352"></a><b>filename</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Returns the name of the file that the source code will be compressed to.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000352_source')" id="l_M000352_source">show</a>
                        
                    </p>
                    <div id="M000352_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/capistrano/recipes/deploy/strategy/copy.rb, line 161</span>
161:           <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">filename</span>
162:             <span class="ruby-ivar">@filename</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">copy_dir</span>, <span class="ruby-node">&quot;#{File.basename(destination)}.#{compression.extension}&quot;</span>)
163:           <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000354">
                    
                    <a name="M000354"></a><b>remote_dir</b>()
                    
                </div>
                
                <div class="description">
                  <p>
The directory on the remote server to which the archive should be copied
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000354_source')" id="l_M000354_source">show</a>
                        
                    </p>
                    <div id="M000354_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/capistrano/recipes/deploy/strategy/copy.rb, line 172</span>
172:           <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">remote_dir</span>
173:             <span class="ruby-ivar">@remote_dir</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">configuration</span>[<span class="ruby-identifier">:copy_remote_dir</span>] <span class="ruby-operator">||</span> <span class="ruby-value str">&quot;/tmp&quot;</span>
174:           <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000355">
                    
                    <a name="M000355"></a><b>remote_filename</b>()
                    
                </div>
                
                <div class="description">
                  <p>
The location on the remote server where the file should be temporarily
stored.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000355_source')" id="l_M000355_source">show</a>
                        
                    </p>
                    <div id="M000355_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/capistrano/recipes/deploy/strategy/copy.rb, line 178</span>
178:           <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">remote_filename</span>
179:             <span class="ruby-ivar">@remote_filename</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">remote_dir</span>, <span class="ruby-constant">File</span>.<span class="ruby-identifier">basename</span>(<span class="ruby-identifier">filename</span>))
180:           <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    