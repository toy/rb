<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>Capistrano::Transfer</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../css/main.css" type="text/css" media="screen" />
    <script src="../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Class</span> 
            Capistrano::Transfer 
            
                <span class="parent">&lt; 
                    
                    <a href="../Object.html">Object</a>
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../files/lib/capistrano/transfer_rb.html">lib/capistrano/transfer.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>A</dt>
        <dd>
            <ul>
                
                <li><a href="#M000420">active?</a></li>
                
            </ul>
        </dd>
    
        <dt>H</dt>
        <dd>
            <ul>
                
                <li><a href="#M000435">handle_error</a></li>
                
            </ul>
        </dd>
    
        <dt>N</dt>
        <dd>
            <ul>
                
                <li><a href="#M000417">new</a>,</li>
                
                <li><a href="#M000434">normalize</a></li>
                
            </ul>
        </dd>
    
        <dt>O</dt>
        <dd>
            <ul>
                
                <li><a href="#M000421">operation</a></li>
                
            </ul>
        </dd>
    
        <dt>P</dt>
        <dd>
            <ul>
                
                <li><a href="#M000427">prepare_scp_transfer</a>,</li>
                
                <li><a href="#M000433">prepare_sftp_transfer</a>,</li>
                
                <li><a href="#M000425">prepare_transfers</a>,</li>
                
                <li><a href="#M000415">process</a>,</li>
                
                <li><a href="#M000418">process!</a></li>
                
            </ul>
        </dd>
    
        <dt>S</dt>
        <dd>
            <ul>
                
                <li><a href="#M000422">sanitized_from</a>,</li>
                
                <li><a href="#M000423">sanitized_to</a>,</li>
                
                <li><a href="#M000424">session_map</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    
    <div class="sectiontitle">Included Modules</div>
    <ul>
        
        <li>
            
            <a href="Configuration/Variables.html">Capistrano::Configuration::Variables</a>
            
            START:includes
        </li>
        
    </ul>
    

    

    
    <div class="sectiontitle">Classes and Modules</div>
    <ul>
        
        <li><span class="type">CLASS</span> <a href="Transfer/SFTPTransferWrapper.html">Capistrano::Transfer::SFTPTransferWrapper</a></li>
        
    </ul>
    

    

    
    <div class="sectiontitle">Attributes</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>sessions</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>options</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>callback</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>transport</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>direction</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>from</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>to</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>logger</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>transfers</td>
            <td class='attr-desc'></td>
        </tr>
        
    </table>
    

    
            <div class="sectiontitle">Class Public methods</div>
            
            <div class="method">
                <div class="title" id="M000417">
                    
                    <a name="M000417"></a><b>new</b>(direction, from, to, sessions, options={}, &amp;block)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000417_source')" id="l_M000417_source">show</a>
                        
                    </p>
                    <div id="M000417_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/capistrano/transfer.rb, line 26</span>
26:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">direction</span>, <span class="ruby-identifier">from</span>, <span class="ruby-identifier">to</span>, <span class="ruby-identifier">sessions</span>, <span class="ruby-identifier">options</span>={}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
27:       <span class="ruby-ivar">@direction</span> = <span class="ruby-identifier">direction</span>
28:       <span class="ruby-ivar">@from</span>      = <span class="ruby-identifier">from</span>
29:       <span class="ruby-ivar">@to</span>        = <span class="ruby-identifier">to</span>
30:       <span class="ruby-ivar">@sessions</span>  = <span class="ruby-identifier">sessions</span>
31:       <span class="ruby-ivar">@options</span>   = <span class="ruby-identifier">options</span>
32:       <span class="ruby-ivar">@callback</span>  = <span class="ruby-identifier">block</span>
33: 
34:       <span class="ruby-ivar">@transport</span> = <span class="ruby-identifier">options</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-identifier">:via</span>, <span class="ruby-identifier">:sftp</span>)
35:       <span class="ruby-ivar">@logger</span>    = <span class="ruby-identifier">options</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:logger</span>)
36: 
37:       <span class="ruby-ivar">@session_map</span> = {}
38: 
39:       <span class="ruby-identifier">prepare_transfers</span>
40:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000415">
                    
                    <a name="M000415"></a><b>process</b>(direction, from, to, sessions, options={}, &amp;block)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000415_source')" id="l_M000415_source">show</a>
                        
                    </p>
                    <div id="M000415_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/capistrano/transfer.rb, line 10</span>
10:     <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">process</span>(<span class="ruby-identifier">direction</span>, <span class="ruby-identifier">from</span>, <span class="ruby-identifier">to</span>, <span class="ruby-identifier">sessions</span>, <span class="ruby-identifier">options</span>={}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
11:       <span class="ruby-identifier">new</span>(<span class="ruby-identifier">direction</span>, <span class="ruby-identifier">from</span>, <span class="ruby-identifier">to</span>, <span class="ruby-identifier">sessions</span>, <span class="ruby-identifier">options</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>).<span class="ruby-identifier">process!</span>
12:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M000420">
                    
                    <a name="M000420"></a><b>active?</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000420_source')" id="l_M000420_source">show</a>
                        
                    </p>
                    <div id="M000420_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/capistrano/transfer.rb, line 70</span>
70:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">active?</span>
71:       <span class="ruby-identifier">transfers</span>.<span class="ruby-identifier">any?</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">transfer</span><span class="ruby-operator">|</span> <span class="ruby-identifier">transfer</span>.<span class="ruby-identifier">active?</span> }
72:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000421">
                    
                    <a name="M000421"></a><b>operation</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000421_source')" id="l_M000421_source">show</a>
                        
                    </p>
                    <div id="M000421_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/capistrano/transfer.rb, line 74</span>
74:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">operation</span>
75:       <span class="ruby-node">&quot;#{direction}load&quot;</span>
76:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000418">
                    
                    <a name="M000418"></a><b>process!</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000418_source')" id="l_M000418_source">show</a>
                        
                    </p>
                    <div id="M000418_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/capistrano/transfer.rb, line 42</span>
42:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">process!</span>
43:       <span class="ruby-identifier">loop</span> <span class="ruby-keyword kw">do</span>
44:         <span class="ruby-keyword kw">begin</span>
45:           <span class="ruby-keyword kw">break</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">process_iteration</span> { <span class="ruby-identifier">active?</span> }
46:         <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">error</span>
47:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">error</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:session</span>)
48:             <span class="ruby-identifier">handle_error</span>(<span class="ruby-identifier">error</span>)
49:           <span class="ruby-keyword kw">else</span>
50:             <span class="ruby-identifier">raise</span>
51:           <span class="ruby-keyword kw">end</span>
52:         <span class="ruby-keyword kw">end</span>
53:       <span class="ruby-keyword kw">end</span>
54: 
55:       <span class="ruby-identifier">failed</span> = <span class="ruby-identifier">transfers</span>.<span class="ruby-identifier">select</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">txfr</span><span class="ruby-operator">|</span> <span class="ruby-identifier">txfr</span>[<span class="ruby-identifier">:failed</span>] }
56:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">failed</span>.<span class="ruby-identifier">any?</span>
57:         <span class="ruby-identifier">hosts</span> = <span class="ruby-identifier">failed</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">txfr</span><span class="ruby-operator">|</span> <span class="ruby-identifier">txfr</span>[<span class="ruby-identifier">:server</span>] }
58:         <span class="ruby-identifier">errors</span> = <span class="ruby-identifier">failed</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">txfr</span><span class="ruby-operator">|</span> <span class="ruby-node">&quot;#{txfr[:error]} (#{txfr[:error].message})&quot;</span> }.<span class="ruby-identifier">uniq</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;, &quot;</span>)
59:         <span class="ruby-identifier">error</span> = <span class="ruby-constant">TransferError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;#{operation} via #{transport} failed on #{hosts.join(',')}: #{errors}&quot;</span>)
60:         <span class="ruby-identifier">error</span>.<span class="ruby-identifier">hosts</span> = <span class="ruby-identifier">hosts</span>
61: 
62:         <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">important</span>(<span class="ruby-identifier">error</span>.<span class="ruby-identifier">message</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">logger</span>
63:         <span class="ruby-identifier">raise</span> <span class="ruby-identifier">error</span>
64:       <span class="ruby-keyword kw">end</span>
65: 
66:       <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">debug</span> <span class="ruby-node">&quot;#{transport} #{operation} complete&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">logger</span>
67:       <span class="ruby-keyword kw">self</span>
68:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000422">
                    
                    <a name="M000422"></a><b>sanitized_from</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000422_source')" id="l_M000422_source">show</a>
                        
                    </p>
                    <div id="M000422_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/capistrano/transfer.rb, line 78</span>
78:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sanitized_from</span>
79:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">from</span>.<span class="ruby-identifier">responds_to?</span>(<span class="ruby-identifier">:read</span>)
80:         <span class="ruby-node">&quot;#&lt;#{from.class}&gt;&quot;</span>
81:       <span class="ruby-keyword kw">else</span>
82:         <span class="ruby-identifier">from</span>
83:       <span class="ruby-keyword kw">end</span>
84:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000423">
                    
                    <a name="M000423"></a><b>sanitized_to</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000423_source')" id="l_M000423_source">show</a>
                        
                    </p>
                    <div id="M000423_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/capistrano/transfer.rb, line 86</span>
86:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sanitized_to</span>
87:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">to</span>.<span class="ruby-identifier">responds_to?</span>(<span class="ruby-identifier">:read</span>)
88:         <span class="ruby-node">&quot;#&lt;#{to.class}&gt;&quot;</span>
89:       <span class="ruby-keyword kw">else</span>
90:         <span class="ruby-identifier">to</span>
91:       <span class="ruby-keyword kw">end</span>
92:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Private methods</div>
            
            <div class="method">
                <div class="title" id="M000435">
                    
                    <a name="M000435"></a><b>handle_error</b>(error)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000435_source')" id="l_M000435_source">show</a>
                        
                    </p>
                    <div id="M000435_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/capistrano/transfer.rb, line 205</span>
205:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">handle_error</span>(<span class="ruby-identifier">error</span>)
206:         <span class="ruby-identifier">transfer</span> = <span class="ruby-identifier">session_map</span>[<span class="ruby-identifier">error</span>.<span class="ruby-identifier">session</span>]
207:         <span class="ruby-identifier">transfer</span>[<span class="ruby-identifier">:error</span>] = <span class="ruby-identifier">error</span>
208:         <span class="ruby-identifier">transfer</span>[<span class="ruby-identifier">:failed</span>] = <span class="ruby-keyword kw">true</span>
209: 
210:         <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">transport</span>
211:         <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:sftp</span> <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">transfer</span>.<span class="ruby-identifier">abort!</span>
212:         <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:scp</span>  <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">transfer</span>.<span class="ruby-identifier">close</span>
213:         <span class="ruby-keyword kw">end</span>
214:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000434">
                    
                    <a name="M000434"></a><b>normalize</b>(argument, session)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000434_source')" id="l_M000434_source">show</a>
                        
                    </p>
                    <div id="M000434_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/capistrano/transfer.rb, line 192</span>
192:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">normalize</span>(<span class="ruby-identifier">argument</span>, <span class="ruby-identifier">session</span>)
193:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">argument</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>)
194:           <span class="ruby-identifier">argument</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/\$CAPISTRANO:HOST\$/</span>, <span class="ruby-identifier">session</span>.<span class="ruby-identifier">xserver</span>.<span class="ruby-identifier">host</span>)
195:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">argument</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:read</span>)
196:           <span class="ruby-identifier">pos</span> = <span class="ruby-identifier">argument</span>.<span class="ruby-identifier">pos</span>
197:           <span class="ruby-identifier">clone</span> = <span class="ruby-constant">StringIO</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">argument</span>.<span class="ruby-identifier">read</span>)
198:           <span class="ruby-identifier">clone</span>.<span class="ruby-identifier">pos</span> = <span class="ruby-identifier">argument</span>.<span class="ruby-identifier">pos</span> = <span class="ruby-identifier">pos</span>
199:           <span class="ruby-identifier">clone</span>
200:         <span class="ruby-keyword kw">else</span>
201:           <span class="ruby-identifier">argument</span>
202:         <span class="ruby-keyword kw">end</span>
203:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000427">
                    
                    <a name="M000427"></a><b>prepare_scp_transfer</b>(from, to, session)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000427_source')" id="l_M000427_source">show</a>
                        
                    </p>
                    <div id="M000427_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/capistrano/transfer.rb, line 118</span>
118:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">prepare_scp_transfer</span>(<span class="ruby-identifier">from</span>, <span class="ruby-identifier">to</span>, <span class="ruby-identifier">session</span>)
119:         <span class="ruby-identifier">real_callback</span> = <span class="ruby-identifier">callback</span> <span class="ruby-operator">||</span> <span class="ruby-constant">Proc</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">channel</span>, <span class="ruby-identifier">name</span>, <span class="ruby-identifier">sent</span>, <span class="ruby-identifier">total</span><span class="ruby-operator">|</span>
120:           <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">trace</span> <span class="ruby-node">&quot;[#{channel[:host]}] #{name}&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">logger</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">sent</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
121:         <span class="ruby-keyword kw">end</span>
122: 
123:         <span class="ruby-identifier">channel</span> = <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">direction</span>
124:           <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:up</span>
125:             <span class="ruby-identifier">session</span>.<span class="ruby-identifier">scp</span>.<span class="ruby-identifier">upload</span>(<span class="ruby-identifier">from</span>, <span class="ruby-identifier">to</span>, <span class="ruby-identifier">options</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">real_callback</span>)
126:           <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:down</span>
127:             <span class="ruby-identifier">session</span>.<span class="ruby-identifier">scp</span>.<span class="ruby-identifier">download</span>(<span class="ruby-identifier">from</span>, <span class="ruby-identifier">to</span>, <span class="ruby-identifier">options</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">real_callback</span>)
128:           <span class="ruby-keyword kw">else</span>
129:             <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-node">&quot;unsupported transfer direction: #{direction.inspect}&quot;</span>
130:           <span class="ruby-keyword kw">end</span>
131: 
132:         <span class="ruby-identifier">channel</span>[<span class="ruby-identifier">:server</span>] = <span class="ruby-identifier">session</span>.<span class="ruby-identifier">xserver</span>
133:         <span class="ruby-identifier">channel</span>[<span class="ruby-identifier">:host</span>]   = <span class="ruby-identifier">session</span>.<span class="ruby-identifier">xserver</span>.<span class="ruby-identifier">host</span>
134: 
135:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">channel</span>
136:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000433">
                    
                    <a name="M000433"></a><b>prepare_sftp_transfer</b>(from, to, session)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000433_source')" id="l_M000433_source">show</a>
                        
                    </p>
                    <div id="M000433_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/capistrano/transfer.rb, line 164</span>
164:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">prepare_sftp_transfer</span>(<span class="ruby-identifier">from</span>, <span class="ruby-identifier">to</span>, <span class="ruby-identifier">session</span>)
165:         <span class="ruby-constant">SFTPTransferWrapper</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">session</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">sftp</span><span class="ruby-operator">|</span>
166:           <span class="ruby-identifier">real_callback</span> = <span class="ruby-constant">Proc</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">event</span>, <span class="ruby-identifier">op</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span><span class="ruby-operator">|</span>
167:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">callback</span>
168:               <span class="ruby-identifier">callback</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">op</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
169:             <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">event</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:open</span>
170:               <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">trace</span> <span class="ruby-node">&quot;[#{op[:host]}] #{args[0].remote}&quot;</span>
171:             <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">event</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:finish</span>
172:               <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">trace</span> <span class="ruby-node">&quot;[#{op[:host]}] done&quot;</span>
173:             <span class="ruby-keyword kw">end</span>
174:           <span class="ruby-keyword kw">end</span>
175: 
176:           <span class="ruby-identifier">opts</span> = <span class="ruby-identifier">options</span>.<span class="ruby-identifier">dup</span>
177:           <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:properties</span>] = (<span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:properties</span>] <span class="ruby-operator">||</span> {}).<span class="ruby-identifier">merge</span>(
178:             <span class="ruby-identifier">:server</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">session</span>.<span class="ruby-identifier">xserver</span>,
179:             <span class="ruby-identifier">:host</span>    =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">session</span>.<span class="ruby-identifier">xserver</span>.<span class="ruby-identifier">host</span>)
180: 
181:           <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">direction</span>
182:           <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:up</span>
183:             <span class="ruby-identifier">sftp</span>.<span class="ruby-identifier">upload</span>(<span class="ruby-identifier">from</span>, <span class="ruby-identifier">to</span>, <span class="ruby-identifier">opts</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">real_callback</span>)
184:           <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:down</span>
185:             <span class="ruby-identifier">sftp</span>.<span class="ruby-identifier">download</span>(<span class="ruby-identifier">from</span>, <span class="ruby-identifier">to</span>, <span class="ruby-identifier">opts</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">real_callback</span>)
186:           <span class="ruby-keyword kw">else</span>
187:             <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-node">&quot;unsupported transfer direction: #{direction.inspect}&quot;</span>
188:           <span class="ruby-keyword kw">end</span>
189:         <span class="ruby-keyword kw">end</span>
190:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000425">
                    
                    <a name="M000425"></a><b>prepare_transfers</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000425_source')" id="l_M000425_source">show</a>
                        
                    </p>
                    <div id="M000425_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/capistrano/transfer.rb, line 100</span>
100:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">prepare_transfers</span>
101:         <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span> <span class="ruby-node">&quot;#{transport} #{operation} #{from} -&gt; #{to}&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">logger</span>
102: 
103:         <span class="ruby-ivar">@transfers</span> = <span class="ruby-identifier">sessions</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">session</span><span class="ruby-operator">|</span>
104:           <span class="ruby-identifier">session_from</span> = <span class="ruby-identifier">normalize</span>(<span class="ruby-identifier">from</span>, <span class="ruby-identifier">session</span>)
105:           <span class="ruby-identifier">session_to</span>   = <span class="ruby-identifier">normalize</span>(<span class="ruby-identifier">to</span>, <span class="ruby-identifier">session</span>)
106: 
107:           <span class="ruby-identifier">session_map</span>[<span class="ruby-identifier">session</span>] = <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">transport</span>
108:             <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:sftp</span>
109:               <span class="ruby-identifier">prepare_sftp_transfer</span>(<span class="ruby-identifier">session_from</span>, <span class="ruby-identifier">session_to</span>, <span class="ruby-identifier">session</span>)
110:             <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:scp</span>
111:               <span class="ruby-identifier">prepare_scp_transfer</span>(<span class="ruby-identifier">session_from</span>, <span class="ruby-identifier">session_to</span>, <span class="ruby-identifier">session</span>)
112:             <span class="ruby-keyword kw">else</span>
113:               <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-node">&quot;unsupported transport type: #{transport.inspect}&quot;</span>
114:             <span class="ruby-keyword kw">end</span>
115:         <span class="ruby-keyword kw">end</span>
116:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000424">
                    
                    <a name="M000424"></a><b>session_map</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000424_source')" id="l_M000424_source">show</a>
                        
                    </p>
                    <div id="M000424_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/capistrano/transfer.rb, line 96</span>
96:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">session_map</span>
97:         <span class="ruby-ivar">@session_map</span>
98:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    