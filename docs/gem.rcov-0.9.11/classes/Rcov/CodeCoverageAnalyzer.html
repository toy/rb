<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>Rcov::CodeCoverageAnalyzer</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../css/main.css" type="text/css" media="screen" />
    <script src="../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Class</span> 
            Rcov::CodeCoverageAnalyzer 
            
                <span class="parent">&lt; 
                    
                    DifferentialAnalyzer
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../files/lib/rcov/code_coverage_analyzer_rb.html">lib/rcov/code_coverage_analyzer.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    
    <div class="description">
        <p>
A <a href="CodeCoverageAnalyzer.html">CodeCoverageAnalyzer</a> is
responsible for tracing code execution and returning code coverage and
execution count information.
</p>
<p>
Note that you must <tt>require 'rcov'</tt> before the code you want to
analyze is parsed (i.e. before it gets loaded or required). You can do that
by either invoking ruby with the <tt>-rrcov</tt> command-line option or
just:
</p>
<pre>
 require 'rcov'
 require 'mycode'
 # ....
</pre>
<h2>Example</h2>
<pre>
 analyzer = Rcov::CodeCoverageAnalyzer.new
 analyzer.run_hooked do
   do_foo
   # all the code executed as a result of this method call is traced
 end
 # ....

 analyzer.run_hooked do
   do_bar
   # the code coverage information generated in this run is aggregated
   # to the previously recorded one
 end

 analyzer.analyzed_files   # =&gt; [&quot;foo.rb&quot;, &quot;bar.rb&quot;, ... ]
 lines, marked_info, count_info = analyzer.data(&quot;foo.rb&quot;)
</pre>
<p>
In this example, two pieces of code are monitored, and the data generated
in both runs are aggregated. <tt>lines</tt> is an array of strings
representing the source code of <tt>foo.rb</tt>. <tt>marked_info</tt> is an
array holding false, true values indicating whether the corresponding lines
of code were reported as executed by Ruby. <tt>count_info</tt> is an array
of integers representing how many times each line of code has been executed
(more precisely, how many events where reported by Ruby &#8212; a single
line might correspond to several events, e.g. many method calls).
</p>
<p>
You can have several <a
href="CodeCoverageAnalyzer.html">CodeCoverageAnalyzer</a> objects at a
time, and it is possible to nest the <a
href="CodeCoverageAnalyzer.html#M000024">run_hooked</a> / <a
href="CodeCoverageAnalyzer.html#M000025">install_hook</a>/<a
href="CodeCoverageAnalyzer.html#M000026">remove_hook</a> blocks: each
analyzer will manage its data separately. Note however that no special
provision is taken to ignore code executed &#8220;inside&#8221; the <a
href="CodeCoverageAnalyzer.html">CodeCoverageAnalyzer</a> class. At any
rate this will not pose a problem since it&#8217;s easy to ignore it
manually: just don&#8217;t do
</p>
<pre>
  lines, coverage, counts = analyzer.data(&quot;/path/to/lib/rcov.rb&quot;)
</pre>
<p>
if you&#8217;re not interested in that information.
</p>

    </div>
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>A</dt>
        <dd>
            <ul>
                
                <li><a href="#M000031">aggregate_data</a>,</li>
                
                <li><a href="#M000020">analyzed_files</a></li>
                
            </ul>
        </dd>
    
        <dt>B</dt>
        <dd>
            <ul>
                
                <li><a href="#M000040">braindead_factorize</a></li>
                
            </ul>
        </dd>
    
        <dt>C</dt>
        <dd>
            <ul>
                
                <li><a href="#M000032">compute_raw_data_difference</a>,</li>
                
                <li><a href="#M000042">correct_script_lines__</a></li>
                
            </ul>
        </dd>
    
        <dt>D</dt>
        <dd>
            <ul>
                
                <li><a href="#M000022">data</a>,</li>
                
                <li><a href="#M000029">data_default</a>,</li>
                
                <li><a href="#M000023">data_matching</a></li>
                
            </ul>
        </dd>
    
        <dt>I</dt>
        <dd>
            <ul>
                
                <li><a href="#M000025">install_hook</a></li>
                
            </ul>
        </dd>
    
        <dt>N</dt>
        <dd>
            <ul>
                
                <li><a href="#M000019">new</a></li>
                
            </ul>
        </dd>
    
        <dt>R</dt>
        <dd>
            <ul>
                
                <li><a href="#M000030">raw_data_absolute</a>,</li>
                
                <li><a href="#M000036">refine_coverage_info</a>,</li>
                
                <li><a href="#M000026">remove_hook</a>,</li>
                
                <li><a href="#M000027">reset</a>,</li>
                
                <li><a href="#M000024">run_hooked</a></li>
                
            </ul>
        </dd>
    
        <dt>S</dt>
        <dd>
            <ul>
                
                <li><a href="#M000039">script_lines_workaround</a></li>
                
            </ul>
        </dd>
    
        <dt>U</dt>
        <dd>
            <ul>
                
                <li><a href="#M000041">update_script_lines__</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    

    

    

    

    

    
            <div class="sectiontitle">Class Public methods</div>
            
            <div class="method">
                <div class="title" id="M000019">
                    
                    <a name="M000019"></a><b>new</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000019_source')" id="l_M000019_source">show</a>
                        
                    </p>
                    <div id="M000019_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/rcov/code_coverage_analyzer.rb, line 59</span>
59:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>
60:       <span class="ruby-ivar">@script_lines__</span> = <span class="ruby-constant">SCRIPT_LINES__</span>
61:       <span class="ruby-keyword kw">super</span>(<span class="ruby-identifier">:install_coverage_hook</span>, <span class="ruby-identifier">:remove_coverage_hook</span>,
62:             <span class="ruby-identifier">:reset_coverage</span>)
63:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M000020">
                    
                    <a name="M000020"></a><b>analyzed_files</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Return an array with the names of the files whose code was executed inside
the block given to <a
href="CodeCoverageAnalyzer.html#M000024">run_hooked</a> or between <a
href="CodeCoverageAnalyzer.html#M000025">install_hook</a> and <a
href="CodeCoverageAnalyzer.html#M000026">remove_hook</a>.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000020_source')" id="l_M000020_source">show</a>
                        
                    </p>
                    <div id="M000020_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/rcov/code_coverage_analyzer.rb, line 67</span>
67:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">analyzed_files</span>
68:       <span class="ruby-identifier">update_script_lines__</span>
69:       <span class="ruby-identifier">raw_data_relative</span>.<span class="ruby-identifier">select</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">file</span>, <span class="ruby-identifier">lines</span><span class="ruby-operator">|</span>
70:         <span class="ruby-ivar">@script_lines__</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">file</span>)
71:       <span class="ruby-keyword kw">end</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">fname</span>,<span class="ruby-operator">|</span> <span class="ruby-identifier">fname</span>}
72:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000022">
                    
                    <a name="M000022"></a><b>data</b>(filename)
                    
                </div>
                
                <div class="description">
                  <p>
Return the available data about the requested file, or nil if none of its
code was executed or it cannot be found. The return value is an array with
three elements:
</p>
<pre>
 lines, marked_info, count_info = analyzer.data(&quot;foo.rb&quot;)
</pre>
<p>
<tt>lines</tt> is an array of strings representing the source code of
<tt>foo.rb</tt>. <tt>marked_info</tt> is an array holding false, true
values indicating whether the corresponding lines of code were reported as
executed by Ruby. <tt>count_info</tt> is an array of integers representing
how many times each line of code has been executed (more precisely, how
many events where reported by Ruby &#8212; a single line might correspond
to several events, e.g. many method calls).
</p>
<p>
The returned data corresponds to the aggregation of all the statistics
collected in each <a
href="CodeCoverageAnalyzer.html#M000024">run_hooked</a> or <a
href="CodeCoverageAnalyzer.html#M000025">install_hook</a>/<a
href="CodeCoverageAnalyzer.html#M000026">remove_hook</a> runs. You can
reset the data at any time with <a
href="CodeCoverageAnalyzer.html#M000027">reset</a> to start from scratch.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000022_source')" id="l_M000022_source">show</a>
                        
                    </p>
                    <div id="M000022_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/rcov/code_coverage_analyzer.rb, line 89</span>
89:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">data</span>(<span class="ruby-identifier">filename</span>)
90:       <span class="ruby-identifier">raw_data</span> = <span class="ruby-identifier">raw_data_relative</span>
91:       <span class="ruby-identifier">update_script_lines__</span>
92:       <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@script_lines__</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">filename</span>) <span class="ruby-operator">&amp;&amp;</span> 
93:              <span class="ruby-identifier">raw_data</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">filename</span>)
94:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span> 
95:       <span class="ruby-keyword kw">end</span>
96:       <span class="ruby-identifier">refine_coverage_info</span>(<span class="ruby-ivar">@script_lines__</span>[<span class="ruby-identifier">filename</span>], <span class="ruby-identifier">raw_data</span>[<span class="ruby-identifier">filename</span>])
97:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000023">
                    
                    <a name="M000023"></a><b>data_matching</b>(filename_re)
                    
                </div>
                
                <div class="description">
                  <p>
Data for the first file matching the given regexp. See <a
href="CodeCoverageAnalyzer.html#M000022">data</a>.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000023_source')" id="l_M000023_source">show</a>
                        
                    </p>
                    <div id="M000023_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rcov/code_coverage_analyzer.rb, line 101</span>
101:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">data_matching</span>(<span class="ruby-identifier">filename_re</span>)
102:       <span class="ruby-identifier">raw_data</span> = <span class="ruby-identifier">raw_data_relative</span>
103:       <span class="ruby-identifier">update_script_lines__</span>
104: 
105:       <span class="ruby-identifier">match</span> = <span class="ruby-identifier">raw_data</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">sort</span>.<span class="ruby-identifier">grep</span>(<span class="ruby-identifier">filename_re</span>).<span class="ruby-identifier">first</span>
106:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">match</span>
107: 
108:       <span class="ruby-identifier">refine_coverage_info</span>(<span class="ruby-ivar">@script_lines__</span>[<span class="ruby-identifier">match</span>], <span class="ruby-identifier">raw_data</span>[<span class="ruby-identifier">match</span>])
109:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000025">
                    
                    <a name="M000025"></a><b>install_hook</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Start monitoring execution to gather code coverage and execution count
information. Such data will be collected until <a
href="CodeCoverageAnalyzer.html#M000026">remove_hook</a> is called.
</p>
<p>
Use <a href="CodeCoverageAnalyzer.html#M000024">run_hooked</a> instead if
possible.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000025_source')" id="l_M000025_source">show</a>
                        
                    </p>
                    <div id="M000025_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rcov/code_coverage_analyzer.rb, line 119</span>
119:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">install_hook</span>; <span class="ruby-keyword kw">super</span> <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000026">
                    
                    <a name="M000026"></a><b>remove_hook</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Stop collecting code coverage and execution count information. <a
href="CodeCoverageAnalyzer.html#M000026">remove_hook</a> will also stop
collecting info if it is run inside a <a
href="CodeCoverageAnalyzer.html#M000024">run_hooked</a> block.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000026_source')" id="l_M000026_source">show</a>
                        
                    </p>
                    <div id="M000026_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rcov/code_coverage_analyzer.rb, line 124</span>
124:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">remove_hook</span>; <span class="ruby-keyword kw">super</span> <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000027">
                    
                    <a name="M000027"></a><b>reset</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Remove the data collected so far. The coverage and execution count
&#8220;history&#8221; will be erased, and further collection will start
from scratch: no code is considered executed, and therefore all execution
counts are 0. Right after <a
href="CodeCoverageAnalyzer.html#M000027">reset</a>, <a
href="CodeCoverageAnalyzer.html#M000020">analyzed_files</a> will return an
empty array, and data(filename) will return nil.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000027_source')" id="l_M000027_source">show</a>
                        
                    </p>
                    <div id="M000027_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rcov/code_coverage_analyzer.rb, line 131</span>
131:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">reset</span>; <span class="ruby-keyword kw">super</span> <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000024">
                    
                    <a name="M000024"></a><b>run_hooked</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Execute the code in the given block, monitoring it in order to gather
information about which code was executed.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000024_source')" id="l_M000024_source">show</a>
                        
                    </p>
                    <div id="M000024_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rcov/code_coverage_analyzer.rb, line 113</span>
113:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">run_hooked</span>; <span class="ruby-keyword kw">super</span> <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Private methods</div>
            
            <div class="method">
                <div class="title" id="M000031">
                    
                    <a name="M000031"></a><b>aggregate_data</b>(aggregated_data, delta)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000031_source')" id="l_M000031_source">show</a>
                        
                    </p>
                    <div id="M000031_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rcov/code_coverage_analyzer.rb, line 158</span>
158:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">aggregate_data</span>(<span class="ruby-identifier">aggregated_data</span>, <span class="ruby-identifier">delta</span>)
159:       <span class="ruby-identifier">delta</span>.<span class="ruby-identifier">each_pair</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">file</span>, <span class="ruby-identifier">cov_arr</span><span class="ruby-operator">|</span>
160:         <span class="ruby-identifier">dest</span> = (<span class="ruby-identifier">aggregated_data</span>[<span class="ruby-identifier">file</span>] <span class="ruby-operator">||=</span> <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">cov_arr</span>.<span class="ruby-identifier">size</span>, <span class="ruby-value">0</span>))
161:         <span class="ruby-identifier">cov_arr</span>.<span class="ruby-identifier">each_with_index</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">x</span>,<span class="ruby-identifier">i</span><span class="ruby-operator">|</span> 
162:           <span class="ruby-identifier">dest</span>[<span class="ruby-identifier">i</span>] <span class="ruby-operator">||=</span> <span class="ruby-value">0</span>
163:           <span class="ruby-identifier">dest</span>[<span class="ruby-identifier">i</span>] <span class="ruby-operator">+=</span> <span class="ruby-identifier">x</span>.<span class="ruby-identifier">to_i</span>
164:         <span class="ruby-keyword kw">end</span>
165:       <span class="ruby-keyword kw">end</span>
166:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000040">
                    
                    <a name="M000040"></a><b>braindead_factorize</b>(num)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000040_source')" id="l_M000040_source">show</a>
                        
                    </p>
                    <div id="M000040_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rcov/code_coverage_analyzer.rb, line 231</span>
231:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">braindead_factorize</span>(<span class="ruby-identifier">num</span>)
232:       <span class="ruby-keyword kw">return</span> [<span class="ruby-value">0</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">num</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
233:       <span class="ruby-keyword kw">return</span> [<span class="ruby-value">-1</span>] <span class="ruby-operator">+</span> <span class="ruby-identifier">braindead_factorize</span>(<span class="ruby-operator">-</span><span class="ruby-identifier">num</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">num</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">0</span>
234:       <span class="ruby-identifier">factors</span> = []
235:       <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">num</span> <span class="ruby-operator">%</span> <span class="ruby-value">2</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
236:         <span class="ruby-identifier">factors</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value">2</span>
237:         <span class="ruby-identifier">num</span> <span class="ruby-operator">/=</span> <span class="ruby-value">2</span>
238:       <span class="ruby-keyword kw">end</span>
239:       <span class="ruby-identifier">size</span> = <span class="ruby-identifier">num</span>
240:       <span class="ruby-identifier">n</span> = <span class="ruby-value">3</span>
241:       <span class="ruby-identifier">max</span> = <span class="ruby-constant">Math</span>.<span class="ruby-identifier">sqrt</span>(<span class="ruby-identifier">num</span>)
242:       <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">n</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">max</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">n</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">size</span>
243:         <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">size</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">n</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
244:           <span class="ruby-identifier">size</span> <span class="ruby-operator">/=</span> <span class="ruby-identifier">n</span>
245:           <span class="ruby-identifier">factors</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">n</span>
246:         <span class="ruby-keyword kw">end</span>
247:         <span class="ruby-identifier">n</span> <span class="ruby-operator">+=</span> <span class="ruby-value">2</span>
248:       <span class="ruby-keyword kw">end</span>
249:       <span class="ruby-identifier">factors</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">size</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">size</span> <span class="ruby-operator">!=</span> <span class="ruby-value">1</span>
250:       <span class="ruby-identifier">factors</span>
251:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000032">
                    
                    <a name="M000032"></a><b>compute_raw_data_difference</b>(first, last)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000032_source')" id="l_M000032_source">show</a>
                        
                    </p>
                    <div id="M000032_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rcov/code_coverage_analyzer.rb, line 168</span>
168:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">compute_raw_data_difference</span>(<span class="ruby-identifier">first</span>, <span class="ruby-identifier">last</span>)
169:       <span class="ruby-identifier">difference</span> = {}
170:       <span class="ruby-identifier">last</span>.<span class="ruby-identifier">each_pair</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">fname</span>, <span class="ruby-identifier">cov_arr</span><span class="ruby-operator">|</span>
171:         <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">first</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">fname</span>)
172:           <span class="ruby-identifier">difference</span>[<span class="ruby-identifier">fname</span>] = <span class="ruby-identifier">cov_arr</span>.<span class="ruby-identifier">clone</span>
173:         <span class="ruby-keyword kw">else</span>
174:           <span class="ruby-identifier">orig_arr</span> = <span class="ruby-identifier">first</span>[<span class="ruby-identifier">fname</span>]
175:           <span class="ruby-identifier">diff_arr</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">cov_arr</span>.<span class="ruby-identifier">size</span>, <span class="ruby-value">0</span>)
176:           <span class="ruby-identifier">changed</span> = <span class="ruby-keyword kw">false</span>
177:           <span class="ruby-identifier">cov_arr</span>.<span class="ruby-identifier">each_with_index</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">x</span>, <span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
178:             <span class="ruby-identifier">diff_arr</span>[<span class="ruby-identifier">i</span>] = <span class="ruby-identifier">diff</span> = (<span class="ruby-identifier">x</span> <span class="ruby-operator">||</span> <span class="ruby-value">0</span>) <span class="ruby-operator">-</span> (<span class="ruby-identifier">orig_arr</span>[<span class="ruby-identifier">i</span>] <span class="ruby-operator">||</span> <span class="ruby-value">0</span>)
179:             <span class="ruby-identifier">changed</span> = <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">diff</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
180:           <span class="ruby-keyword kw">end</span>
181:           <span class="ruby-identifier">difference</span>[<span class="ruby-identifier">fname</span>] = <span class="ruby-identifier">diff_arr</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">changed</span>
182:         <span class="ruby-keyword kw">end</span>
183:       <span class="ruby-keyword kw">end</span>
184:       <span class="ruby-identifier">difference</span>
185:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000042">
                    
                    <a name="M000042"></a><b>correct_script_lines__</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000042_source')" id="l_M000042_source">show</a>
                        
                    </p>
                    <div id="M000042_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rcov/code_coverage_analyzer.rb, line 257</span>
257:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">correct_script_lines__</span>
258:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">Object</span>.<span class="ruby-identifier">const_defined?</span>(<span class="ruby-value str">&quot;JRUBY_VERSION&quot;</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-constant">JRUBY_VERSION</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value str">&quot;1.5.3&quot;</span>
259:       <span class="ruby-constant">SCRIPT_LINES__</span>.<span class="ruby-identifier">each_key</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span>
260:         <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span> <span class="ruby-identifier">file</span>
261:         <span class="ruby-identifier">lines</span> = []
262:         <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">file</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">line</span><span class="ruby-operator">|</span>
263:           <span class="ruby-identifier">lines</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">line</span>
264:         <span class="ruby-keyword kw">end</span>
265:         <span class="ruby-constant">SCRIPT_LINES__</span>[<span class="ruby-identifier">file</span>] = <span class="ruby-identifier">lines</span>
266:       <span class="ruby-keyword kw">end</span>
267:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000029">
                    
                    <a name="M000029"></a><b>data_default</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000029_source')" id="l_M000029_source">show</a>
                        
                    </p>
                    <div id="M000029_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rcov/code_coverage_analyzer.rb, line 152</span>
152:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">data_default</span>; {} <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000030">
                    
                    <a name="M000030"></a><b>raw_data_absolute</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000030_source')" id="l_M000030_source">show</a>
                        
                    </p>
                    <div id="M000030_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rcov/code_coverage_analyzer.rb, line 154</span>
154:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">raw_data_absolute</span>
155:       <span class="ruby-constant">Rcov</span><span class="ruby-operator">::</span><span class="ruby-constant">RCOV__</span>.<span class="ruby-identifier">generate_coverage_info</span>
156:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000036">
                    
                    <a name="M000036"></a><b>refine_coverage_info</b>(lines, covers)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000036_source')" id="l_M000036_source">show</a>
                        
                    </p>
                    <div id="M000036_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rcov/code_coverage_analyzer.rb, line 187</span>
187:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">refine_coverage_info</span>(<span class="ruby-identifier">lines</span>, <span class="ruby-identifier">covers</span>)
188:       <span class="ruby-identifier">marked_info</span> = []
189:       <span class="ruby-identifier">count_info</span> = []
190:       <span class="ruby-identifier">lines</span>.<span class="ruby-identifier">size</span>.<span class="ruby-identifier">times</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
191:         <span class="ruby-identifier">c</span> = <span class="ruby-identifier">covers</span>[<span class="ruby-identifier">i</span>]
192:         <span class="ruby-identifier">marked_info</span> <span class="ruby-operator">&lt;&lt;</span> ((<span class="ruby-identifier">c</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">c</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>) <span class="ruby-operator">?</span> <span class="ruby-keyword kw">true</span> <span class="ruby-operator">:</span> <span class="ruby-keyword kw">false</span>)
193:         <span class="ruby-identifier">count_info</span> <span class="ruby-operator">&lt;&lt;</span> (<span class="ruby-identifier">c</span> <span class="ruby-operator">||</span> <span class="ruby-value">0</span>)
194:       <span class="ruby-keyword kw">end</span>
195: 
196:       <span class="ruby-identifier">script_lines_workaround</span>(<span class="ruby-identifier">lines</span>, <span class="ruby-identifier">marked_info</span>, <span class="ruby-identifier">count_info</span>)
197:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000039">
                    
                    <a name="M000039"></a><b>script_lines_workaround</b>(line_info, coverage_info, count_info)
                    
                </div>
                
                <div class="description">
                  <p>
Try to detect repeated data, based on observed repetitions in line_info:
this is a workaround for SCRIPT_LINES__[filename] including as many copies
of the file as the number of times it was parsed.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000039_source')" id="l_M000039_source">show</a>
                        
                    </p>
                    <div id="M000039_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rcov/code_coverage_analyzer.rb, line 202</span>
202:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">script_lines_workaround</span>(<span class="ruby-identifier">line_info</span>, <span class="ruby-identifier">coverage_info</span>, <span class="ruby-identifier">count_info</span>)
203:       <span class="ruby-identifier">is_repeated</span> = <span class="ruby-identifier">lambda</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">div</span><span class="ruby-operator">|</span>
204:         <span class="ruby-identifier">n</span> = <span class="ruby-identifier">line_info</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">/</span> <span class="ruby-identifier">div</span>
205:         <span class="ruby-keyword kw">break</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">line_info</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">div</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">n</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>
206:         <span class="ruby-identifier">different</span> = <span class="ruby-keyword kw">false</span>
207:         <span class="ruby-identifier">n</span>.<span class="ruby-identifier">times</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
208:         
209:           <span class="ruby-identifier">things</span> = (<span class="ruby-value">0</span><span class="ruby-operator">...</span><span class="ruby-identifier">div</span>).<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">j</span><span class="ruby-operator">|</span> <span class="ruby-identifier">line_info</span>[<span class="ruby-identifier">i</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">j</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">n</span>] }
210:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">things</span>.<span class="ruby-identifier">uniq</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">!=</span> <span class="ruby-value">1</span>
211:             <span class="ruby-identifier">different</span> = <span class="ruby-keyword kw">true</span>
212:             <span class="ruby-keyword kw">break</span>
213:           <span class="ruby-keyword kw">end</span>
214:         <span class="ruby-keyword kw">end</span>
215: 
216:         <span class="ruby-operator">!</span> <span class="ruby-identifier">different</span>
217:       <span class="ruby-keyword kw">end</span>
218: 
219:       <span class="ruby-identifier">factors</span> = <span class="ruby-identifier">braindead_factorize</span>(<span class="ruby-identifier">line_info</span>.<span class="ruby-identifier">size</span>)
220:       <span class="ruby-identifier">factors</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">n</span><span class="ruby-operator">|</span>
221:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">is_repeated</span>[<span class="ruby-identifier">n</span>]
222:           <span class="ruby-identifier">line_info</span> = <span class="ruby-identifier">line_info</span>[<span class="ruby-value">0</span>, <span class="ruby-identifier">line_info</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">/</span> <span class="ruby-identifier">n</span>]
223:           <span class="ruby-identifier">coverage_info</span> = <span class="ruby-identifier">coverage_info</span>[<span class="ruby-value">0</span>, <span class="ruby-identifier">coverage_info</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">/</span> <span class="ruby-identifier">n</span>]
224:           <span class="ruby-identifier">count_info</span> = <span class="ruby-identifier">count_info</span>[<span class="ruby-value">0</span>, <span class="ruby-identifier">count_info</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">/</span> <span class="ruby-identifier">n</span>]
225:         <span class="ruby-keyword kw">end</span>
226:       <span class="ruby-keyword kw">end</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">factors</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>   <span class="ruby-comment cmt"># don't even try if it's prime</span>
227: 
228:       [<span class="ruby-identifier">line_info</span>, <span class="ruby-identifier">coverage_info</span>, <span class="ruby-identifier">count_info</span>]
229:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000041">
                    
                    <a name="M000041"></a><b>update_script_lines__</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000041_source')" id="l_M000041_source">show</a>
                        
                    </p>
                    <div id="M000041_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rcov/code_coverage_analyzer.rb, line 253</span>
253:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update_script_lines__</span>
254:       <span class="ruby-ivar">@script_lines__</span> = <span class="ruby-ivar">@script_lines__</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-constant">SCRIPT_LINES__</span>)
255:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    