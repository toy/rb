<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>EmailSpec::Helpers</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../css/main.css" type="text/css" media="screen" />
    <script src="../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Module</span> 
            EmailSpec::Helpers 
            
        </h1>
        <ul class="files">
            
            <li><a href="../../files/lib/email_spec/helpers_rb.html">lib/email_spec/helpers.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>C</dt>
        <dd>
            <ul>
                
                <li><a href="#M000030">click_email_link_matching</a>,</li>
                
                <li><a href="#M000031">click_first_link_in_email</a>,</li>
                
                <li><a href="#M000063">convert_address</a>,</li>
                
                <li><a href="#M000038">current_email</a>,</li>
                
                <li><a href="#M000064">current_email_address</a>,</li>
                
                <li><a href="#M000039">current_email_attachments</a></li>
                
            </ul>
        </dd>
    
        <dt>E</dt>
        <dd>
            <ul>
                
                <li><a href="#M000066">email_spec_deprecate</a>,</li>
                
                <li><a href="#M000044">email_spec_hash</a></li>
                
            </ul>
        </dd>
    
        <dt>F</dt>
        <dd>
            <ul>
                
                <li><a href="#M000042">find_email</a>,</li>
                
                <li><a href="#M000045">find_email!</a></li>
                
            </ul>
        </dd>
    
        <dt>L</dt>
        <dd>
            <ul>
                
                <li><a href="#M000043">links_in_email</a></li>
                
            </ul>
        </dd>
    
        <dt>M</dt>
        <dd>
            <ul>
                
                <li><a href="#M000065">mailbox_for</a></li>
                
            </ul>
        </dd>
    
        <dt>O</dt>
        <dd>
            <ul>
                
                <li><a href="#M000034">open_email</a>,</li>
                
                <li><a href="#M000035">open_email_for</a>,</li>
                
                <li><a href="#M000036">open_last_email</a>,</li>
                
                <li><a href="#M000037">open_last_email_for</a></li>
                
            </ul>
        </dd>
    
        <dt>P</dt>
        <dd>
            <ul>
                
                <li><a href="#M000055">parse_email_count</a>,</li>
                
                <li><a href="#M000050">parse_email_for_anchor_text_link</a>,</li>
                
                <li><a href="#M000049">parse_email_for_explicit_link</a>,</li>
                
                <li><a href="#M000047">parse_email_for_link</a></li>
                
            </ul>
        </dd>
    
        <dt>R</dt>
        <dd>
            <ul>
                
                <li><a href="#M000041">read_emails_for</a>,</li>
                
                <li><a href="#M000048">request_uri</a></li>
                
            </ul>
        </dd>
    
        <dt>S</dt>
        <dd>
            <ul>
                
                <li><a href="#M000046">set_current_email</a></li>
                
            </ul>
        </dd>
    
        <dt>T</dt>
        <dd>
            <ul>
                
                <li><a href="#M000054">textify_images</a></li>
                
            </ul>
        </dd>
    
        <dt>U</dt>
        <dd>
            <ul>
                
                <li><a href="#M000040">unread_emails_for</a></li>
                
            </ul>
        </dd>
    
        <dt>V</dt>
        <dd>
            <ul>
                
                <li><a href="#M000029">visit_in_email</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    
    <div class="sectiontitle">Included Modules</div>
    <ul>
        
        <li>
            
            <a href="Helpers.html">EmailSpec::Helpers</a>
            
            START:includes
        </li>
        
    </ul>
    

    

    

    

    
    <div class="sectiontitle">Attributes</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>last_email_address</td>
            <td class='attr-desc'></td>
        </tr>
        
    </table>
    

    
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M000030">
                    
                    <a name="M000030"></a><b>click_email_link_matching</b>(regex, email = current_email)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000030_source')" id="l_M000030_source">show</a>
                        
                    </p>
                    <div id="M000030_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/email_spec/helpers.rb, line 13</span>
13:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">click_email_link_matching</span>(<span class="ruby-identifier">regex</span>, <span class="ruby-identifier">email</span> = <span class="ruby-identifier">current_email</span>)
14:       <span class="ruby-identifier">url</span> = <span class="ruby-identifier">links_in_email</span>(<span class="ruby-identifier">email</span>).<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">link</span><span class="ruby-operator">|</span> <span class="ruby-identifier">link</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">regex</span> }
15:       <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;No link found matching #{regex.inspect} in #{email.default_part_body}&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">url</span>
16:       <span class="ruby-identifier">visit</span> <span class="ruby-identifier">request_uri</span>(<span class="ruby-identifier">url</span>)
17:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000031">
                    
                    <a name="M000031"></a><b>click_first_link_in_email</b>(email = current_email)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000031_source')" id="l_M000031_source">show</a>
                        
                    </p>
                    <div id="M000031_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/email_spec/helpers.rb, line 19</span>
19:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">click_first_link_in_email</span>(<span class="ruby-identifier">email</span> = <span class="ruby-identifier">current_email</span>)
20:       <span class="ruby-identifier">link</span> = <span class="ruby-identifier">links_in_email</span>(<span class="ruby-identifier">email</span>).<span class="ruby-identifier">first</span>
21:       <span class="ruby-identifier">visit</span> <span class="ruby-identifier">request_uri</span>(<span class="ruby-identifier">link</span>)
22:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000038">
                    
                    <a name="M000038"></a><b>current_email</b>(address=nil)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000038_source')" id="l_M000038_source">show</a>
                        
                    </p>
                    <div id="M000038_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/email_spec/helpers.rb, line 38</span>
38:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">current_email</span>(<span class="ruby-identifier">address</span>=<span class="ruby-keyword kw">nil</span>)
39:       <span class="ruby-identifier">address</span> = <span class="ruby-identifier">convert_address</span>(<span class="ruby-identifier">address</span>)
40:       <span class="ruby-identifier">email</span> = <span class="ruby-identifier">address</span> <span class="ruby-value">? </span><span class="ruby-identifier">email_spec_hash</span>[<span class="ruby-identifier">:current_emails</span>][<span class="ruby-identifier">address</span>] <span class="ruby-operator">:</span> <span class="ruby-identifier">email_spec_hash</span>[<span class="ruby-identifier">:current_email</span>]
41:       <span class="ruby-identifier">raise</span>   <span class="ruby-constant">RSpec</span><span class="ruby-operator">::</span><span class="ruby-constant">Expectations</span><span class="ruby-operator">::</span><span class="ruby-constant">ExpectationNotMetError</span>, <span class="ruby-value str">&quot;Expected an open email but none was found. Did you forget to call open_email?&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">email</span>
42:       <span class="ruby-identifier">email</span>
43:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000039">
                    
                    <a name="M000039"></a><b>current_email_attachments</b>(address=nil)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000039_source')" id="l_M000039_source">show</a>
                        
                    </p>
                    <div id="M000039_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/email_spec/helpers.rb, line 45</span>
45:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">current_email_attachments</span>(<span class="ruby-identifier">address</span>=<span class="ruby-keyword kw">nil</span>)
46:       <span class="ruby-identifier">current_email</span>(<span class="ruby-identifier">address</span>).<span class="ruby-identifier">attachments</span> <span class="ruby-operator">||</span> <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
47:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000042">
                    
                    <a name="M000042"></a><b>find_email</b>(address, opts={})
                    
                </div>
                
                <div class="description">
                  <p>
Should be able to accept String or Regexp options.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000042_source')" id="l_M000042_source">show</a>
                        
                    </p>
                    <div id="M000042_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/email_spec/helpers.rb, line 58</span>
58:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">find_email</span>(<span class="ruby-identifier">address</span>, <span class="ruby-identifier">opts</span>={})
59:       <span class="ruby-identifier">address</span> = <span class="ruby-identifier">convert_address</span>(<span class="ruby-identifier">address</span>)
60:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:with_subject</span>]
61:         <span class="ruby-identifier">expected_subject</span> = (<span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:with_subject</span>].<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>) <span class="ruby-operator">?</span> <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">escape</span>(<span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:with_subject</span>]) <span class="ruby-operator">:</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:with_subject</span>])
62:         <span class="ruby-identifier">mailbox_for</span>(<span class="ruby-identifier">address</span>).<span class="ruby-identifier">find</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">m</span><span class="ruby-operator">|</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">subject</span> <span class="ruby-operator">=~</span> <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">expected_subject</span>) }
63:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:with_text</span>]
64:         <span class="ruby-identifier">expected_text</span> = (<span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:with_text</span>].<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>) <span class="ruby-operator">?</span> <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">escape</span>(<span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:with_text</span>]) <span class="ruby-operator">:</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:with_text</span>])
65:         <span class="ruby-identifier">mailbox_for</span>(<span class="ruby-identifier">address</span>).<span class="ruby-identifier">find</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">m</span><span class="ruby-operator">|</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">default_part_body</span> <span class="ruby-operator">=~</span> <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">expected_text</span>) }
66:       <span class="ruby-keyword kw">else</span>
67:         <span class="ruby-identifier">mailbox_for</span>(<span class="ruby-identifier">address</span>).<span class="ruby-identifier">first</span>
68:       <span class="ruby-keyword kw">end</span>
69:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000043">
                    
                    <a name="M000043"></a><b>links_in_email</b>(email)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000043_source')" id="l_M000043_source">show</a>
                        
                    </p>
                    <div id="M000043_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/email_spec/helpers.rb, line 71</span>
71:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">links_in_email</span>(<span class="ruby-identifier">email</span>)
72:       <span class="ruby-constant">URI</span>.<span class="ruby-identifier">extract</span>(<span class="ruby-identifier">email</span>.<span class="ruby-identifier">default_part_body</span>.<span class="ruby-identifier">to_s</span>, [<span class="ruby-value str">'http'</span>, <span class="ruby-value str">'https'</span>])
73:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000034">
                    
                    <a name="M000034"></a><b>open_email</b>(address, opts={})
                    
                </div>
                
                
                <div class="aka">
                    This method is also aliased as
                    
                    <a href="Helpers.html#M000035">open_email_for</a>
                    
                </div>
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000034_source')" id="l_M000034_source">show</a>
                        
                    </p>
                    <div id="M000034_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/email_spec/helpers.rb, line 24</span>
24:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">open_email</span>(<span class="ruby-identifier">address</span>, <span class="ruby-identifier">opts</span>={})
25:       <span class="ruby-identifier">set_current_email</span>(<span class="ruby-identifier">find_email!</span>(<span class="ruby-identifier">address</span>, <span class="ruby-identifier">opts</span>))
26:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000035">
                    
                    <a name="M000035"></a><b>open_email_for</b>(address, opts={})
                    
                </div>
                
                <div class="description">
                  <p>
Alias for <a href="Helpers.html#M000034">open_email</a>
</p>

                </div>
                
                
                
            </div>
            
            <div class="method">
                <div class="title" id="M000036">
                    
                    <a name="M000036"></a><b>open_last_email</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000036_source')" id="l_M000036_source">show</a>
                        
                    </p>
                    <div id="M000036_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/email_spec/helpers.rb, line 30</span>
30:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">open_last_email</span>
31:       <span class="ruby-identifier">set_current_email</span>(<span class="ruby-identifier">last_email_sent</span>)
32:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000037">
                    
                    <a name="M000037"></a><b>open_last_email_for</b>(address)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000037_source')" id="l_M000037_source">show</a>
                        
                    </p>
                    <div id="M000037_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/email_spec/helpers.rb, line 34</span>
34:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">open_last_email_for</span>(<span class="ruby-identifier">address</span>)
35:       <span class="ruby-identifier">set_current_email</span>(<span class="ruby-identifier">mailbox_for</span>(<span class="ruby-identifier">address</span>).<span class="ruby-identifier">last</span>)
36:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000041">
                    
                    <a name="M000041"></a><b>read_emails_for</b>(address)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000041_source')" id="l_M000041_source">show</a>
                        
                    </p>
                    <div id="M000041_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/email_spec/helpers.rb, line 53</span>
53:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">read_emails_for</span>(<span class="ruby-identifier">address</span>)
54:       <span class="ruby-identifier">email_spec_hash</span>[<span class="ruby-identifier">:read_emails</span>][<span class="ruby-identifier">convert_address</span>(<span class="ruby-identifier">address</span>)] <span class="ruby-operator">||=</span> []
55:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000040">
                    
                    <a name="M000040"></a><b>unread_emails_for</b>(address)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000040_source')" id="l_M000040_source">show</a>
                        
                    </p>
                    <div id="M000040_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/email_spec/helpers.rb, line 49</span>
49:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">unread_emails_for</span>(<span class="ruby-identifier">address</span>)
50:       <span class="ruby-identifier">mailbox_for</span>(<span class="ruby-identifier">address</span>) <span class="ruby-operator">-</span> <span class="ruby-identifier">read_emails_for</span>(<span class="ruby-identifier">address</span>)
51:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000029">
                    
                    <a name="M000029"></a><b>visit_in_email</b>(link_text)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000029_source')" id="l_M000029_source">show</a>
                        
                    </p>
                    <div id="M000029_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/email_spec/helpers.rb, line 9</span>
 9:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">visit_in_email</span>(<span class="ruby-identifier">link_text</span>)
10:       <span class="ruby-identifier">visit</span>(<span class="ruby-identifier">parse_email_for_link</span>(<span class="ruby-identifier">current_email</span>, <span class="ruby-identifier">link_text</span>))
11:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Private methods</div>
            
            <div class="method">
                <div class="title" id="M000063">
                    
                    <a name="M000063"></a><b>convert_address</b>(address)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000063_source')" id="l_M000063_source">show</a>
                        
                    </p>
                    <div id="M000063_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/email_spec/helpers.rb, line 149</span>
149:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">convert_address</span>(<span class="ruby-identifier">address</span>)
150:       <span class="ruby-ivar">@last_email_address</span> = (<span class="ruby-identifier">address</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">current_email_address</span>)
151:       <span class="ruby-constant">AddressConverter</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">convert</span>(<span class="ruby-ivar">@last_email_address</span>)
152:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000064">
                    
                    <a name="M000064"></a><b>current_email_address</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Overwrite this method to set default email address, for example: <a
href="Helpers.html#last_email_address">last_email_address</a> ||
@current_user.email
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000064_source')" id="l_M000064_source">show</a>
                        
                    </p>
                    <div id="M000064_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/email_spec/helpers.rb, line 156</span>
156:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">current_email_address</span>
157:       <span class="ruby-identifier">last_email_address</span>
158:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000066">
                    
                    <a name="M000066"></a><b>email_spec_deprecate</b>(text)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000066_source')" id="l_M000066_source">show</a>
                        
                    </p>
                    <div id="M000066_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/email_spec/helpers.rb, line 165</span>
165:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">email_spec_deprecate</span>(<span class="ruby-identifier">text</span>)
166:       <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;&quot;</span>
167:       <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;DEPRECATION: #{text.split.join(' ')}&quot;</span>
168:       <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;&quot;</span>
169:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000044">
                    
                    <a name="M000044"></a><b>email_spec_hash</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000044_source')" id="l_M000044_source">show</a>
                        
                    </p>
                    <div id="M000044_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/email_spec/helpers.rb, line 77</span>
77:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">email_spec_hash</span>
78:       <span class="ruby-ivar">@email_spec_hash</span> <span class="ruby-operator">||=</span> {<span class="ruby-identifier">:read_emails</span> =<span class="ruby-operator">&gt;</span> {}, <span class="ruby-identifier">:unread_emails</span> =<span class="ruby-operator">&gt;</span> {}, <span class="ruby-identifier">:current_emails</span> =<span class="ruby-operator">&gt;</span> {}, <span class="ruby-identifier">:current_email</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">nil</span>}
79:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000045">
                    
                    <a name="M000045"></a><b>find_email!</b>(address, opts={})
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000045_source')" id="l_M000045_source">show</a>
                        
                    </p>
                    <div id="M000045_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/email_spec/helpers.rb, line 81</span>
81:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">find_email!</span>(<span class="ruby-identifier">address</span>, <span class="ruby-identifier">opts</span>={})
82:       <span class="ruby-identifier">email</span> = <span class="ruby-identifier">find_email</span>(<span class="ruby-identifier">address</span>, <span class="ruby-identifier">opts</span>)
83:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">email</span>.<span class="ruby-identifier">nil?</span>
84:         <span class="ruby-identifier">error</span> = <span class="ruby-node">&quot;#{opts.keys.first.to_s.humanize unless opts.empty?} #{('&quot;' + opts.values.first.to_s.humanize + '&quot;') unless opts.empty?}&quot;</span>
85:         <span class="ruby-identifier">raise</span>   <span class="ruby-constant">RSpec</span><span class="ruby-operator">::</span><span class="ruby-constant">Expectations</span><span class="ruby-operator">::</span><span class="ruby-constant">ExpectationNotMetError</span>, <span class="ruby-node">&quot;Could not find email #{error}. \n Found the following emails:\n\n #{all_emails.to_s}&quot;</span>
86:        <span class="ruby-keyword kw">end</span>
87:       <span class="ruby-identifier">email</span>
88:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000065">
                    
                    <a name="M000065"></a><b>mailbox_for</b>(address)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000065_source')" id="l_M000065_source">show</a>
                        
                    </p>
                    <div id="M000065_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/email_spec/helpers.rb, line 161</span>
161:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">mailbox_for</span>(<span class="ruby-identifier">address</span>)
162:       <span class="ruby-keyword kw">super</span>(<span class="ruby-identifier">convert_address</span>(<span class="ruby-identifier">address</span>)) <span class="ruby-comment cmt"># super resides in Deliveries</span>
163:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000055">
                    
                    <a name="M000055"></a><b>parse_email_count</b>(amount)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000055_source')" id="l_M000055_source">show</a>
                        
                    </p>
                    <div id="M000055_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/email_spec/helpers.rb, line 136</span>
136:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">parse_email_count</span>(<span class="ruby-identifier">amount</span>)
137:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">amount</span>
138:       <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;no&quot;</span>
139:         <span class="ruby-value">0</span>
140:       <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;an&quot;</span>
141:         <span class="ruby-value">1</span>
142:       <span class="ruby-keyword kw">else</span>
143:         <span class="ruby-identifier">amount</span>.<span class="ruby-identifier">to_i</span>
144:       <span class="ruby-keyword kw">end</span>
145:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000050">
                    
                    <a name="M000050"></a><b>parse_email_for_anchor_text_link</b>(email, link_text)
                    
                </div>
                
                <div class="description">
                  <p>
e.g. Click here in <a href=&#8220;<a
href="http://confirm">Click">confirm">Click</a> here</a>
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000050_source')" id="l_M000050_source">show</a>
                        
                    </p>
                    <div id="M000050_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/email_spec/helpers.rb, line 123</span>
123:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">parse_email_for_anchor_text_link</span>(<span class="ruby-identifier">email</span>, <span class="ruby-identifier">link_text</span>)
124:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">textify_images</span>(<span class="ruby-identifier">email</span>.<span class="ruby-identifier">default_part_body</span>) <span class="ruby-operator">=~</span> <span class="ruby-node">%r{&lt;a[^&gt;]*href=['&quot;]?([^'&quot;]*)['&quot;]?[^&gt;]*?&gt;[^&lt;]*?#{link_text}[^&lt;]*?&lt;/a&gt;}</span>
125:         <span class="ruby-constant">URI</span>.<span class="ruby-identifier">split</span>(<span class="ruby-identifier">$1</span>)[<span class="ruby-value">5</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>].<span class="ruby-identifier">compact!</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;?&quot;</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-value str">&quot;&amp;amp;&quot;</span>, <span class="ruby-value str">&quot;&amp;&quot;</span>)
126:         <span class="ruby-comment cmt"># sub correct ampersand after rails switches it (http://dev.rubyonrails.org/ticket/4002)</span>
127:       <span class="ruby-keyword kw">else</span>
128:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span>
129:       <span class="ruby-keyword kw">end</span>
130:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000049">
                    
                    <a name="M000049"></a><b>parse_email_for_explicit_link</b>(email, regex)
                    
                </div>
                
                <div class="description">
                  <p>
e.g. confirm in <a href="http://confirm">confirm</a>
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000049_source')" id="l_M000049_source">show</a>
                        
                    </p>
                    <div id="M000049_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/email_spec/helpers.rb, line 116</span>
116:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">parse_email_for_explicit_link</span>(<span class="ruby-identifier">email</span>, <span class="ruby-identifier">regex</span>)
117:       <span class="ruby-identifier">regex</span> = <span class="ruby-node">/#{Regexp.escape(regex)}/</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">regex</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Regexp</span>)
118:       <span class="ruby-identifier">url</span> = <span class="ruby-identifier">links_in_email</span>(<span class="ruby-identifier">email</span>).<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">link</span><span class="ruby-operator">|</span> <span class="ruby-identifier">link</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">regex</span> }
119:       <span class="ruby-identifier">request_uri</span>(<span class="ruby-identifier">url</span>)
120:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000047">
                    
                    <a name="M000047"></a><b>parse_email_for_link</b>(email, text_or_regex)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000047_source')" id="l_M000047_source">show</a>
                        
                    </p>
                    <div id="M000047_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/email_spec/helpers.rb, line 99</span>
 99:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">parse_email_for_link</span>(<span class="ruby-identifier">email</span>, <span class="ruby-identifier">text_or_regex</span>)
100:       <span class="ruby-identifier">email</span>.<span class="ruby-identifier">should</span> <span class="ruby-identifier">have_body_text</span>(<span class="ruby-identifier">text_or_regex</span>)
101: 
102:       <span class="ruby-identifier">url</span> = <span class="ruby-identifier">parse_email_for_explicit_link</span>(<span class="ruby-identifier">email</span>, <span class="ruby-identifier">text_or_regex</span>)
103:       <span class="ruby-identifier">url</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">parse_email_for_anchor_text_link</span>(<span class="ruby-identifier">email</span>, <span class="ruby-identifier">text_or_regex</span>)
104: 
105:       <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;No link found matching #{text_or_regex.inspect} in #{email}&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">url</span>
106:       <span class="ruby-identifier">url</span>
107:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000048">
                    
                    <a name="M000048"></a><b>request_uri</b>(link)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000048_source')" id="l_M000048_source">show</a>
                        
                    </p>
                    <div id="M000048_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/email_spec/helpers.rb, line 109</span>
109:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">request_uri</span>(<span class="ruby-identifier">link</span>)
110:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">link</span>
111:       <span class="ruby-identifier">url</span> = <span class="ruby-constant">URI</span><span class="ruby-operator">::</span><span class="ruby-identifier">parse</span>(<span class="ruby-identifier">link</span>)
112:       <span class="ruby-identifier">url</span>.<span class="ruby-identifier">fragment</span> <span class="ruby-value">? </span>(<span class="ruby-identifier">url</span>.<span class="ruby-identifier">request_uri</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;#&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">url</span>.<span class="ruby-identifier">fragment</span>) <span class="ruby-operator">:</span> <span class="ruby-identifier">url</span>.<span class="ruby-identifier">request_uri</span>
113:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000046">
                    
                    <a name="M000046"></a><b>set_current_email</b>(email)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000046_source')" id="l_M000046_source">show</a>
                        
                    </p>
                    <div id="M000046_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/email_spec/helpers.rb, line 90</span>
90:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set_current_email</span>(<span class="ruby-identifier">email</span>)
91:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">email</span>
92:       [<span class="ruby-identifier">email</span>.<span class="ruby-identifier">to</span>, <span class="ruby-identifier">email</span>.<span class="ruby-identifier">cc</span>, <span class="ruby-identifier">email</span>.<span class="ruby-identifier">bcc</span>].<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">to</span><span class="ruby-operator">|</span>
93:         <span class="ruby-identifier">read_emails_for</span>(<span class="ruby-identifier">to</span>) <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">email</span>
94:         <span class="ruby-identifier">email_spec_hash</span>[<span class="ruby-identifier">:current_emails</span>][<span class="ruby-identifier">to</span>] = <span class="ruby-identifier">email</span>
95:       <span class="ruby-keyword kw">end</span>
96:       <span class="ruby-identifier">email_spec_hash</span>[<span class="ruby-identifier">:current_email</span>] = <span class="ruby-identifier">email</span>
97:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000054">
                    
                    <a name="M000054"></a><b>textify_images</b>(email_body)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000054_source')" id="l_M000054_source">show</a>
                        
                    </p>
                    <div id="M000054_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/email_spec/helpers.rb, line 132</span>
132:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">textify_images</span>(<span class="ruby-identifier">email_body</span>)
133:       <span class="ruby-identifier">email_body</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">%r{&lt;img[^&gt;]*alt=['&quot;]?([^'&quot;]*)['&quot;]?[^&gt;]*?/&gt;}</span>) { <span class="ruby-identifier">$1</span> }
134:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    