<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>CSV</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen" />
    <script src="../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Class</span> 
            CSV 
            
                <span class="parent">&lt; 
                    
                    <a href="Object.html">Object</a>
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../files/lib/csv_rb.html">lib/csv.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    
    <div class="description">
        <p>
This class provides a complete interface to <a href="CSV.html">CSV</a>
files and data. It offers tools to enable you to read and write to and from
Strings or <a href="IO.html">IO</a> objects, as needed.
</p>
<h2>Reading</h2>
<h3>From a <a href="File.html">File</a></h3>
<h4>A Line at a <a href="Time.html">Time</a></h4>
<pre>
  CSV.foreach(&quot;path/to/file.csv&quot;) do |row|
    # use row here...
  end
</pre>
<h4>All at Once</h4>
<pre>
  arr_of_arrs = CSV.read(&quot;path/to/file.csv&quot;)
</pre>
<h3>From a <a href="String.html">String</a></h3>
<h4>A Line at a <a href="Time.html">Time</a></h4>
<pre>
  CSV.parse(&quot;CSV,data,String&quot;) do |row|
    # use row here...
  end
</pre>
<h4>All at Once</h4>
<pre>
  arr_of_arrs = CSV.parse(&quot;CSV,data,String&quot;)
</pre>
<h2>Writing</h2>
<h3>To a <a href="File.html">File</a></h3>
<pre>
  CSV.open(&quot;path/to/file.csv&quot;, &quot;wb&quot;) do |csv|
    csv &lt;&lt; [&quot;row&quot;, &quot;of&quot;, &quot;CSV&quot;, &quot;data&quot;]
    csv &lt;&lt; [&quot;another&quot;, &quot;row&quot;]
    # ...
  end
</pre>
<h3>To a <a href="String.html">String</a></h3>
<pre>
  csv_string = CSV.generate do |csv|
    csv &lt;&lt; [&quot;row&quot;, &quot;of&quot;, &quot;CSV&quot;, &quot;data&quot;]
    csv &lt;&lt; [&quot;another&quot;, &quot;row&quot;]
    # ...
  end
</pre>
<h2>Convert a Single Line</h2>
<pre>
  csv_string = [&quot;CSV&quot;, &quot;data&quot;].to_csv   # to CSV
  csv_array  = &quot;CSV,String&quot;.parse_csv   # from CSV
</pre>
<h2>Shortcut Interface</h2>
<pre>
  CSV             { |csv_out| csv_out &lt;&lt; %w{my data here} }  # to $stdout
  CSV(csv = &quot;&quot;)   { |csv_str| csv_str &lt;&lt; %w{my data here} }  # to a String
  CSV($stderr)    { |csv_err| csv_err &lt;&lt; %w{my data here} }  # to $stderr
  CSV($stdin)     { |csv_in|  csv_in.each { |row| p row } }  # from $stdin
</pre>
<h2>Advanced Usage</h2>
<h3>Wrap an <a href="IO.html">IO</a> <a href="Object.html">Object</a></h3>
<pre>
  csv = CSV.new(io, options)
  # ... read (with gets() or each()) from and write (with &lt;&lt;) to csv here ...
</pre>
<h2><a href="CSV.html">CSV</a> and Character Encodings (M17n or Multilingualization)</h2>
<p>
This new <a href="CSV.html">CSV</a> parser is m17n savvy. The parser works
in the <a href="Encoding.html">Encoding</a> of the <a href="IO.html">IO</a>
or <a href="String.html">String</a> object being read from or written to.
Your data is never transcoded (unless you ask Ruby to transcode it for you)
and will literally be parsed in the <a href="Encoding.html">Encoding</a> it
is in. Thus <a href="CSV.html">CSV</a> will return Arrays or Rows of
Strings in the <a href="Encoding.html">Encoding</a> of your data. This is
accomplished by transcoding the parser itself into your <a
href="Encoding.html">Encoding</a>.
</p>
<p>
Some transcoding must take place, of course, to accomplish this
multiencoding support. For example, <tt>:<a
href="CSV.html#col_sep">col_sep</a></tt>, <tt>:<a
href="CSV.html#row_sep">row_sep</a></tt>, and <tt>:<a
href="CSV.html#quote_char">quote_char</a></tt> must be transcoded to match
your data. Hopefully this makes the entire process feel transparent, since
CSV&#8217;s defaults should just magically work for you data. However, you
can set these values manually in the target <a
href="Encoding.html">Encoding</a> to avoid the translation.
</p>
<p>
It&#8217;s also important to note that while all of CSV&#8217;s core parser
is now <a href="Encoding.html">Encoding</a> agnostic, some features are
not. For example, the built-in converters will try to transcode data to
UTF-8 before making conversions. Again, you can provide custom converters
that are aware of your Encodings to avoid this translation. It&#8217;s just
too hard for me to support native conversions in all of Ruby&#8217;s
Encodings.
</p>
<p>
Anyway, the practical side of this is simple: make sure <a
href="IO.html">IO</a> and <a href="String.html">String</a> objects passed
into <a href="CSV.html">CSV</a> have the proper <a
href="Encoding.html">Encoding</a> set and everything should just work. <a
href="CSV.html">CSV</a> methods that allow you to open <a
href="IO.html">IO</a> objects (CSV::foreach(), CSV::open(), CSV::read(),
and CSV::readlines()) do allow you to specify the <a
href="Encoding.html">Encoding</a>.
</p>
<p>
One minor exception comes when generating <a href="CSV.html">CSV</a> into a
<a href="String.html">String</a> with an <a
href="Encoding.html">Encoding</a> that is not ASCII compatible.
There&#8217;s no existing data for <a href="CSV.html">CSV</a> to use to
prepare itself and thus you will probably need to manually specify the
desired <a href="Encoding.html">Encoding</a> for most of those cases. It
will try to guess using the fields in a row of output though, when using
CSV::<a href="CSV.html#M001903">generate_line</a>() or <a
href="Array.html#M001981">Array#to_csv()</a>.
</p>
<p>
I try to point out any other <a href="Encoding.html">Encoding</a> issues in
the documentation of methods as they come up.
</p>
<p>
This has been tested to the best of my ability with all
non-&#8220;dummy&#8221; Encodings Ruby ships with. However, it is brave new
code and may have some bugs. Please feel free to <a
href="mailto:james@grayproductions.net">report</a> any issues you find with
it.
</p>

    </div>
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>#</dt>
        <dd>
            <ul>
                
                <li><a href="#M001948"><<</a></li>
                
            </ul>
        </dd>
    
        <dt>A</dt>
        <dd>
            <ul>
                
                <li><a href="#M001971">add_converter</a>,</li>
                
                <li><a href="#M001954">add_row</a>,</li>
                
                <li><a href="#M001974">add_unconverted_fields</a></li>
                
            </ul>
        </dd>
    
        <dt>C</dt>
        <dd>
            <ul>
                
                <li><a href="#M001956">convert</a>,</li>
                
                <li><a href="#M001972">convert_fields</a>,</li>
                
                <li><a href="#M001934">converters</a></li>
                
            </ul>
        </dd>
    
        <dt>D</dt>
        <dd>
            <ul>
                
                <li><a href="#M001896">dump</a></li>
                
            </ul>
        </dd>
    
        <dt>E</dt>
        <dd>
            <ul>
                
                <li><a href="#M001959">each</a>,</li>
                
                <li><a href="#M001976">encode_re</a>,</li>
                
                <li><a href="#M001977">encode_str</a>,</li>
                
                <li><a href="#M001975">escape_re</a></li>
                
            </ul>
        </dd>
    
        <dt>F</dt>
        <dd>
            <ul>
                
                <li><a href="#M001898">filter</a>,</li>
                
                <li><a href="#M001943">force_quotes?</a>,</li>
                
                <li><a href="#M001899">foreach</a></li>
                
            </ul>
        </dd>
    
        <dt>G</dt>
        <dd>
            <ul>
                
                <li><a href="#M001900">generate</a>,</li>
                
                <li><a href="#M001903">generate_line</a>,</li>
                
                <li><a href="#M001964">gets</a></li>
                
            </ul>
        </dd>
    
        <dt>H</dt>
        <dd>
            <ul>
                
                <li><a href="#M001958">header_convert</a>,</li>
                
                <li><a href="#M001941">header_converters</a>,</li>
                
                <li><a href="#M001962">header_row?</a>,</li>
                
                <li><a href="#M001937">headers</a></li>
                
            </ul>
        </dd>
    
        <dt>I</dt>
        <dd>
            <ul>
                
                <li><a href="#M001969">init_converters</a>,</li>
                
                <li><a href="#M001970">init_headers</a>,</li>
                
                <li><a href="#M001968">init_parsers</a>,</li>
                
                <li><a href="#M001967">init_separators</a>,</li>
                
                <li><a href="#M001966">inspect</a>,</li>
                
                <li><a href="#M001891">instance</a></li>
                
            </ul>
        </dd>
    
        <dt>L</dt>
        <dd>
            <ul>
                
                <li><a href="#M001897">load</a></li>
                
            </ul>
        </dd>
    
        <dt>N</dt>
        <dd>
            <ul>
                
                <li><a href="#M001933">new</a></li>
                
            </ul>
        </dd>
    
        <dt>O</dt>
        <dd>
            <ul>
                
                <li><a href="#M001913">open</a></li>
                
            </ul>
        </dd>
    
        <dt>P</dt>
        <dd>
            <ul>
                
                <li><a href="#M001916">parse</a>,</li>
                
                <li><a href="#M001973">parse_headers</a>,</li>
                
                <li><a href="#M001922">parse_line</a>,</li>
                
                <li><a href="#M001955">puts</a></li>
                
            </ul>
        </dd>
    
        <dt>R</dt>
        <dd>
            <ul>
                
                <li><a href="#M001978">raw_encoding</a>,</li>
                
                <li><a href="#M001960">read</a>,</li>
                
                <li><a href="#M001925">read</a>,</li>
                
                <li><a href="#M001965">readline</a>,</li>
                
                <li><a href="#M001961">readlines</a>,</li>
                
                <li><a href="#M001926">readlines</a>,</li>
                
                <li><a href="#M001938">return_headers?</a>,</li>
                
                <li><a href="#M001947">rewind</a></li>
                
            </ul>
        </dd>
    
        <dt>S</dt>
        <dd>
            <ul>
                
                <li><a href="#M001963">shift</a>,</li>
                
                <li><a href="#M001942">skip_blanks?</a></li>
                
            </ul>
        </dd>
    
        <dt>T</dt>
        <dd>
            <ul>
                
                <li><a href="#M001927">table</a></li>
                
            </ul>
        </dd>
    
        <dt>U</dt>
        <dd>
            <ul>
                
                <li><a href="#M001936">unconverted_fields?</a></li>
                
            </ul>
        </dd>
    
        <dt>W</dt>
        <dd>
            <ul>
                
                <li><a href="#M001939">write_headers?</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    
    <div class="sectiontitle">Included Modules</div>
    <ul>
        
        <li>
            
            <a href="JSON.html">JSON</a>
            
            START:includes
        </li>
        
    </ul>
    

    

    
    <div class="sectiontitle">Classes and Modules</div>
    <ul>
        
        <li><span class="type">CLASS</span> <a href="CSV/MalformedCSVError.html">CSV::MalformedCSVError</a></li>
        
        <li><span class="type">CLASS</span> <a href="CSV/Row.html">CSV::Row</a></li>
        
        <li><span class="type">CLASS</span> <a href="CSV/Table.html">CSV::Table</a></li>
        
    </ul>
    

    
    <div class="sectiontitle">Constants</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class="attr-name">VERSION</td>
            <td>=</td>
            <td class="attr-value">&quot;2.4.8&quot;.freeze</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
The version of the installed library.
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">FieldInfo</td>
            <td>=</td>
            <td class="attr-value">Struct.new(:index, :line, :header)</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
A <a href="CSV.html#FieldInfo">FieldInfo</a> <a
href="Struct.html">Struct</a> contains details about a field&#8217;s
position in the data source it was read from. <a href="CSV.html">CSV</a>
will pass this <a href="Struct.html">Struct</a> to some blocks that make
decisions based on field structure. See <a
href="CSV.html#M001972">CSV.convert_fields()</a> for an example.
</p>
<table>
<tr><td valign="top"><b><tt>index</tt></b>:</td><td>The zero-based index of the field in its row.

</td></tr>
<tr><td valign="top"><b><tt>line</tt></b>:</td><td>The line of the data source this row is from.

</td></tr>
<tr><td valign="top"><b><tt>header</tt></b>:</td><td>The header for the column, when available.

</td></tr>
</table>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">DateMatcher</td>
            <td>=</td>
            <td class="attr-value">/ \A(?: (\w+,?\s+)?\w+\s+\d{1,2},?\s+\d{2,4} |                             \d{4}-\d{2}-\d{2} )\z /x</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
A <a href="Regexp.html">Regexp</a> used to find and convert some common <a
href="Date.html">Date</a> formats.
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">DateTimeMatcher</td>
            <td>=</td>
            <td class="attr-value">/ \A(?: (\w+,?\s+)?\w+\s+\d{1,2}\s+\d{1,2}:\d{1,2}:\d{1,2},?\s+\d{2,4} |             \d{4}-\d{2}-\d{2}\s\d{2}:\d{2}:\d{2} )\z /x</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
A <a href="Regexp.html">Regexp</a> used to find and convert some common <a
href="DateTime.html">DateTime</a> formats.
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">ConverterEncoding</td>
            <td>=</td>
            <td class="attr-value">Encoding.find(&quot;UTF-8&quot;)</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
The encoding used by all converters.
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">Converters</td>
            <td>=</td>
            <td class="attr-value">{ integer:   lambda { |f|                     Integer(f.encode(ConverterEncoding)) rescue f                   },                   float:     lambda { |f|                     Float(f.encode(ConverterEncoding)) rescue f</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
This <a href="Hash.html">Hash</a> holds the built-in converters of <a
href="CSV.html">CSV</a> that can be accessed by name. You can select <a
href="CSV.html#Converters">Converters</a> with <a
href="CSV.html#M001956">CSV.convert()</a> or through the <tt>options</tt>
<a href="Hash.html">Hash</a> passed to CSV::new().
</p>
<table>
<tr><td valign="top"><b><tt>:integer</tt></b>:</td><td>Converts any field Integer() accepts.

</td></tr>
<tr><td valign="top"><b><tt>:float</tt></b>:</td><td>Converts any field Float() accepts.

</td></tr>
<tr><td valign="top"><b><tt>:numeric</tt></b>:</td><td>A combination of <tt>:integer</tt> and <tt>:float</tt>.

</td></tr>
<tr><td valign="top"><b><tt>:date</tt></b>:</td><td>Converts any field Date::parse() accepts.

</td></tr>
<tr><td valign="top"><b><tt>:date_time</tt></b>:</td><td>Converts any field DateTime::parse() accepts.

</td></tr>
<tr><td valign="top"><b><tt>:all</tt></b>:</td><td>All built-in converters. A combination of <tt>:date_time</tt> and
<tt>:numeric</tt>.

</td></tr>
</table>
<p>
All built-in converters transcode field data to UTF-8 before attempting a
conversion. If your data cannot be transcoded to UTF-8 the conversion will
fail and the field will remain unchanged.
</p>
<p>
This <a href="Hash.html">Hash</a> is intentionally left unfrozen and users
should feel free to add values to it that can be accessed by all <a
href="CSV.html">CSV</a> objects.
</p>
<p>
To add a combo field, the value should be an <a href="Array.html">Array</a>
of names. Combo fields can be nested with other combo fields.
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">HeaderConverters</td>
            <td>=</td>
            <td class="attr-value">{     downcase: lambda { |h| h.encode(ConverterEncoding).downcase },     symbol:   lambda { |h|       h.encode(ConverterEncoding).downcase.gsub(/\s+/, &quot;_&quot;).                                            gsub(/\W+/, &quot;&quot;).to_sym</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
This <a href="Hash.html">Hash</a> holds the built-in header converters of
<a href="CSV.html">CSV</a> that can be accessed by name. You can select <a
href="CSV.html#HeaderConverters">HeaderConverters</a> with <a
href="CSV.html#M001958">CSV.header_convert()</a> or through the
<tt>options</tt> <a href="Hash.html">Hash</a> passed to CSV::new().
</p>
<table>
<tr><td valign="top"><b><tt>:downcase</tt></b>:</td><td>Calls downcase() on the header <a href="String.html">String</a>.

</td></tr>
<tr><td valign="top"><b><tt>:symbol</tt></b>:</td><td>The header <a href="String.html">String</a> is downcased, spaces are
replaced with underscores, non-word characters are dropped, and finally
to_sym() is called.

</td></tr>
</table>
<p>
All built-in header converters transcode header data to UTF-8 before
attempting a conversion. If your data cannot be transcoded to UTF-8 the
conversion will fail and the header will remain unchanged.
</p>
<p>
This <a href="Hash.html">Hash</a> is intetionally left unfrozen and users
should feel free to add values to it that can be accessed by all <a
href="CSV.html">CSV</a> objects.
</p>
<p>
To add a combo field, the value should be an <a href="Array.html">Array</a>
of names. Combo fields can be nested with other combo fields.
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">DEFAULT_OPTIONS</td>
            <td>=</td>
            <td class="attr-value">{ col_sep:            &quot;,&quot;,                       row_sep:            :auto,                       quote_char:         '&quot;',                       field_size_limit:   nil,                       converters:         nil,                       unconverted_fields: nil,                       headers:            false,                       return_headers:     false,                       header_converters:  nil,                       skip_blanks:        false,                       force_quotes:       false }.freeze</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
The options used when no overrides are given by calling code. They are:
</p>
<table>
<tr><td valign="top"><b><tt>:<a href="CSV.html#col_sep">col_sep</a></tt></b>:</td><td><tt>&quot;,&quot;</tt>

</td></tr>
<tr><td valign="top"><b><tt>:<a href="CSV.html#row_sep">row_sep</a></tt></b>:</td><td><tt>:auto</tt>

</td></tr>
<tr><td valign="top"><b><tt>:<a href="CSV.html#quote_char">quote_char</a></tt></b>:</td><td><tt>'&quot;'</tt>

</td></tr>
<tr><td valign="top"><b><tt>:<a href="CSV.html#field_size_limit">field_size_limit</a></tt></b>:</td><td><tt>nil</tt>

</td></tr>
<tr><td valign="top"><b><tt>:converters</tt></b>:</td><td><tt>nil</tt>

</td></tr>
<tr><td valign="top"><b><tt>:unconverted_fields</tt></b>:</td><td><tt>nil</tt>

</td></tr>
<tr><td valign="top"><b><tt>:headers</tt></b>:</td><td><tt>false</tt>

</td></tr>
<tr><td valign="top"><b><tt>:return_headers</tt></b>:</td><td><tt>false</tt>

</td></tr>
<tr><td valign="top"><b><tt>:<a href="CSV.html#M001941">header_converters</a></tt></b>:</td><td><tt>nil</tt>

</td></tr>
<tr><td valign="top"><b><tt>:skip_blanks</tt></b>:</td><td><tt>false</tt>

</td></tr>
<tr><td valign="top"><b><tt>:force_quotes</tt></b>:</td><td><tt>false</tt>

</td></tr>
</table>
</td>
        </tr>
        
        
    </table>
    

    
    <div class="sectiontitle">Attributes</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>col_sep</td>
            <td class='attr-desc'><p>
The encoded <tt>:<a href="CSV.html#col_sep">col_sep</a></tt> used in
parsing and writing. See CSV::new for details.
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>row_sep</td>
            <td class='attr-desc'><p>
The encoded <tt>:<a href="CSV.html#row_sep">row_sep</a></tt> used in
parsing and writing. See CSV::new for details.
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>quote_char</td>
            <td class='attr-desc'><p>
The encoded <tt>:<a href="CSV.html#quote_char">quote_char</a></tt> used in
parsing and writing. See CSV::new for details.
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>field_size_limit</td>
            <td class='attr-desc'><p>
The limit for field size, if any. See CSV::new for details.
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>encoding</td>
            <td class='attr-desc'><p>
The <a href="Encoding.html">Encoding</a> <a href="CSV.html">CSV</a> is
parsing or writing in. This will be the <a
href="Encoding.html">Encoding</a> you receive parsed data in and/or the <a
href="Encoding.html">Encoding</a> data will be written in.
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>lineno</td>
            <td class='attr-desc'><p>
The line number of the last row read from this file. Fields with nested
line-end characters will not affect this count.
</p></td>
        </tr>
        
    </table>
    

    
            <div class="sectiontitle">Class Public methods</div>
            
            <div class="method">
                <div class="title" id="M001896">
                    
                    <a name="M001896"></a><b>dump</b>(ary_of_objs, io = &quot;&quot;, options = Hash.new)
                    
                </div>
                
                <div class="description">
                  <p>
This method allows you to serialize an <a href="Array.html">Array</a> of
Ruby objects to a <a href="String.html">String</a> or <a
href="File.html">File</a> of <a href="CSV.html">CSV</a> data. This is not
as powerful as <a href="Marshal.html">Marshal</a> or <a
href="YAML.html">YAML</a>, but perhaps useful for spreadsheet and database
interaction.
</p>
<p>
Out of the box, this method is intended to work with simple data objects or
Structs. It will serialize a list of instance variables and/or <a
href="Struct.html#M001325">Struct.members()</a>.
</p>
<p>
If you need need more complicated serialization, you can control the
process by adding methods to the class to be serialized.
</p>
<p>
A class method csv_meta() is responsible for returning the first row of the
document (as an <a href="Array.html">Array</a>). This row is considered to
be a <a href="Hash.html">Hash</a> of the form
key_1,value_1,key_2,value_2,&#8230; CSV::load() expects to find a class key
with a value of the stringified class name and CSV::dump() will create
this, if you do not define this method. This method is only called on the
first object of the <a href="Array.html">Array</a>.
</p>
<p>
The next method you can provide is an instance method called csv_headers().
This method is expected to return the second line of the document (again as
an <a href="Array.html">Array</a>), which is to be used to give each column
a header. By default, CSV::load() will set an instance variable if the
field header starts with an @ character or call send() passing the header
as the method name and the field value as an argument. This method is only
called on the first object of the <a href="Array.html">Array</a>.
</p>
<p>
Finally, you can provide an instance method called csv_dump(), which will
be passed the headers. This should return an <a href="Array.html">Array</a>
of fields that can be serialized for this object. This method is called
once for every object in the <a href="Array.html">Array</a>.
</p>
<p>
The <tt>io</tt> parameter can be used to serialize to a <a
href="File.html">File</a>, and <tt>options</tt> can be anything CSV::new()
accepts.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001896_source')" id="l_M001896_source">show</a>
                        
                    </p>
                    <div id="M001896_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/csv.rb, line 1049</span>
1049:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">dump</span>(<span class="ruby-identifier">ary_of_objs</span>, <span class="ruby-identifier">io</span> = <span class="ruby-value str">&quot;&quot;</span>, <span class="ruby-identifier">options</span> = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>)
1050:     <span class="ruby-identifier">obj_template</span> = <span class="ruby-identifier">ary_of_objs</span>.<span class="ruby-identifier">first</span>
1051: 
1052:     <span class="ruby-identifier">csv</span> = <span class="ruby-identifier">new</span>(<span class="ruby-identifier">io</span>, <span class="ruby-identifier">options</span>)
1053: 
1054:     <span class="ruby-comment cmt"># write meta information</span>
1055:     <span class="ruby-keyword kw">begin</span>
1056:       <span class="ruby-identifier">csv</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">obj_template</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">csv_meta</span>
1057:     <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">NoMethodError</span>
1058:       <span class="ruby-identifier">csv</span> <span class="ruby-operator">&lt;&lt;</span> [<span class="ruby-identifier">:class</span>, <span class="ruby-identifier">obj_template</span>.<span class="ruby-identifier">class</span>]
1059:     <span class="ruby-keyword kw">end</span>
1060: 
1061:     <span class="ruby-comment cmt"># write headers</span>
1062:     <span class="ruby-keyword kw">begin</span>
1063:       <span class="ruby-identifier">headers</span> = <span class="ruby-identifier">obj_template</span>.<span class="ruby-identifier">csv_headers</span>
1064:     <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">NoMethodError</span>
1065:       <span class="ruby-identifier">headers</span> = <span class="ruby-identifier">obj_template</span>.<span class="ruby-identifier">instance_variables</span>.<span class="ruby-identifier">sort</span>
1066:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">obj_template</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">ancestors</span>.<span class="ruby-identifier">find</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">cls</span><span class="ruby-operator">|</span> <span class="ruby-identifier">cls</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/\AStruct\b/</span> }
1067:         <span class="ruby-identifier">headers</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">obj_template</span>.<span class="ruby-identifier">members</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">mem</span><span class="ruby-operator">|</span> <span class="ruby-node">&quot;#{mem}=&quot;</span> }.<span class="ruby-identifier">sort</span>
1068:       <span class="ruby-keyword kw">end</span>
1069:     <span class="ruby-keyword kw">end</span>
1070:     <span class="ruby-identifier">csv</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">headers</span>
1071: 
1072:     <span class="ruby-comment cmt"># serialize each object</span>
1073:     <span class="ruby-identifier">ary_of_objs</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">obj</span><span class="ruby-operator">|</span>
1074:       <span class="ruby-keyword kw">begin</span>
1075:         <span class="ruby-identifier">csv</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">csv_dump</span>(<span class="ruby-identifier">headers</span>)
1076:       <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">NoMethodError</span>
1077:         <span class="ruby-identifier">csv</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">headers</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">var</span><span class="ruby-operator">|</span>
1078:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">var</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-value">?@</span>
1079:             <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">instance_variable_get</span>(<span class="ruby-identifier">var</span>)
1080:           <span class="ruby-keyword kw">else</span>
1081:             <span class="ruby-identifier">obj</span>[<span class="ruby-identifier">var</span>[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">-2</span>]]
1082:           <span class="ruby-keyword kw">end</span>
1083:         <span class="ruby-keyword kw">end</span>
1084:       <span class="ruby-keyword kw">end</span>
1085:     <span class="ruby-keyword kw">end</span>
1086: 
1087:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">io</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">String</span>
1088:       <span class="ruby-identifier">csv</span>.<span class="ruby-identifier">string</span>
1089:     <span class="ruby-keyword kw">else</span>
1090:       <span class="ruby-identifier">csv</span>.<span class="ruby-identifier">close</span>
1091:     <span class="ruby-keyword kw">end</span>
1092:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001898">
                    
                    <a name="M001898"></a><b>filter( options = Hash.new ) { |row| ... }
filter( input, options = Hash.new ) { |row| ... }
filter( input, output, options = Hash.new ) { |row| ... }
</b>
                    
                </div>
                
                <div class="description">
                  <p>
This method is a convenience for building Unix-like filters for <a
href="CSV.html">CSV</a> data. Each row is yielded to the provided block
which can alter it as needed. After the block returns, the row is appended
to <tt>output</tt> altered or not.
</p>
<p>
The <tt>input</tt> and <tt>output</tt> arguments can be anything CSV::new()
accepts (generally <a href="String.html">String</a> or <a
href="IO.html">IO</a> objects). If not given, they default to <tt>ARGF</tt>
and <tt>$stdout</tt>.
</p>
<p>
The <tt>options</tt> parameter is also filtered down to CSV::new() after
some clever key parsing. Any key beginning with <tt>:in_</tt> or
<tt>:input_</tt> will have that leading identifier stripped and will only
be used in the <tt>options</tt> <a href="Hash.html">Hash</a> for the
<tt>input</tt> object. Keys starting with <tt>:out_</tt> or
<tt>:output_</tt> affect only <tt>output</tt>. All other keys are assigned
to both objects.
</p>
<p>
The <tt>:output_row_sep</tt> <tt>option</tt> defaults to
<tt>$INPUT_RECORD_SEPARATOR</tt> (<tt>$/</tt>).
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001898_source')" id="l_M001898_source">show</a>
                        
                    </p>
                    <div id="M001898_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/csv.rb, line 1165</span>
1165:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">filter</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
1166:     <span class="ruby-comment cmt"># parse options for input, output, or both</span>
1167:     <span class="ruby-identifier">in_options</span>, <span class="ruby-identifier">out_options</span> = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>, {<span class="ruby-identifier">row_sep</span><span class="ruby-operator">:</span> <span class="ruby-identifier">$INPUT_RECORD_SEPARATOR</span>}
1168:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">Hash</span>
1169:       <span class="ruby-identifier">args</span>.<span class="ruby-identifier">pop</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
1170:         <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">key</span>.<span class="ruby-identifier">to_s</span>
1171:         <span class="ruby-keyword kw">when</span> <span class="ruby-regexp re">/\Ain(?:put)?_(.+)\Z/</span>
1172:           <span class="ruby-identifier">in_options</span>[<span class="ruby-identifier">$1</span>.<span class="ruby-identifier">to_sym</span>] = <span class="ruby-identifier">value</span>
1173:         <span class="ruby-keyword kw">when</span> <span class="ruby-regexp re">/\Aout(?:put)?_(.+)\Z/</span>
1174:           <span class="ruby-identifier">out_options</span>[<span class="ruby-identifier">$1</span>.<span class="ruby-identifier">to_sym</span>] = <span class="ruby-identifier">value</span>
1175:         <span class="ruby-keyword kw">else</span>
1176:           <span class="ruby-identifier">in_options</span>[<span class="ruby-identifier">key</span>]  = <span class="ruby-identifier">value</span>
1177:           <span class="ruby-identifier">out_options</span>[<span class="ruby-identifier">key</span>] = <span class="ruby-identifier">value</span>
1178:         <span class="ruby-keyword kw">end</span>
1179:       <span class="ruby-keyword kw">end</span>
1180:     <span class="ruby-keyword kw">end</span>
1181:     <span class="ruby-comment cmt"># build input and output wrappers</span>
1182:     <span class="ruby-identifier">input</span>  = <span class="ruby-identifier">new</span>(<span class="ruby-identifier">args</span>.<span class="ruby-identifier">shift</span> <span class="ruby-operator">||</span> <span class="ruby-constant">ARGF</span>,    <span class="ruby-identifier">in_options</span>)
1183:     <span class="ruby-identifier">output</span> = <span class="ruby-identifier">new</span>(<span class="ruby-identifier">args</span>.<span class="ruby-identifier">shift</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">$stdout</span>, <span class="ruby-identifier">out_options</span>)
1184: 
1185:     <span class="ruby-comment cmt"># read, yield, write</span>
1186:     <span class="ruby-identifier">input</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">row</span><span class="ruby-operator">|</span>
1187:       <span class="ruby-keyword kw">yield</span> <span class="ruby-identifier">row</span>
1188:       <span class="ruby-identifier">output</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">row</span>
1189:     <span class="ruby-keyword kw">end</span>
1190:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001899">
                    
                    <a name="M001899"></a><b>foreach</b>(path, options = Hash.new, &amp;block)
                    
                </div>
                
                <div class="description">
                  <p>
This method is intended as the primary interface for reading <a
href="CSV.html">CSV</a> files. You pass a <tt>path</tt> and any
<tt>options</tt> you wish to set for the read. Each row of file will be
passed to the provided <tt>block</tt> in turn.
</p>
<p>
The <tt>options</tt> parameter can be anything CSV::new() understands. This
method also understands an additional <tt>:encoding</tt> parameter that you
can use to specify the <a href="Encoding.html">Encoding</a> of the data in
the file to be read. You must provide this unless your data is in
Encoding::default_external(). <a href="CSV.html">CSV</a> will use this to
determine how to parse the data. You may provide a second <a
href="Encoding.html">Encoding</a> to have the data transcoded as it is
read. For example, <tt>encoding: &quot;UTF-32BE:UTF-8&quot;</tt> would read
UTF-32BE data from the file but transcode it to UTF-8 before <a
href="CSV.html">CSV</a> parses it.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001899_source')" id="l_M001899_source">show</a>
                        
                    </p>
                    <div id="M001899_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/csv.rb, line 1206</span>
1206:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">foreach</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">options</span> = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
1207:     <span class="ruby-identifier">open</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">options</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">csv</span><span class="ruby-operator">|</span>
1208:       <span class="ruby-identifier">csv</span>.<span class="ruby-identifier">each</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
1209:     <span class="ruby-keyword kw">end</span>
1210:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001900">
                    
                    <a name="M001900"></a><b>generate( str, options = Hash.new ) { |csv| ... }
generate( options = Hash.new ) { |csv| ... }
</b>
                    
                </div>
                
                <div class="description">
                  <p>
This method wraps a <a href="String.html">String</a> you provide, or an
empty default <a href="String.html">String</a>, in a <a
href="CSV.html">CSV</a> object which is passed to the provided block. You
can use the block to append <a href="CSV.html">CSV</a> rows to the <a
href="String.html">String</a> and when the block exits, the final <a
href="String.html">String</a> will be returned.
</p>
<p>
Note that a passed <a href="String.html">String</a> <b>is</b> modfied by
this method. Call dup() before passing if you need a new <a
href="String.html">String</a>.
</p>
<p>
The <tt>options</tt> parameter can be anything CSV::new() understands. This
method understands an additional <tt>:encoding</tt> parameter when not
passed a <a href="String.html">String</a> to set the base <a
href="Encoding.html">Encoding</a> for the output. <a
href="CSV.html">CSV</a> needs this hint if you plan to output non-ASCII
compatible data.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001900_source')" id="l_M001900_source">show</a>
                        
                    </p>
                    <div id="M001900_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/csv.rb, line 1230</span>
1230:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">generate</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
1231:     <span class="ruby-comment cmt"># add a default empty String, if none was given</span>
1232:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">String</span>
1233:       <span class="ruby-identifier">io</span> = <span class="ruby-constant">StringIO</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">args</span>.<span class="ruby-identifier">shift</span>)
1234:       <span class="ruby-identifier">io</span>.<span class="ruby-identifier">seek</span>(<span class="ruby-value">0</span>, <span class="ruby-constant">IO</span><span class="ruby-operator">::</span><span class="ruby-constant">SEEK_END</span>)
1235:       <span class="ruby-identifier">args</span>.<span class="ruby-identifier">unshift</span>(<span class="ruby-identifier">io</span>)
1236:     <span class="ruby-keyword kw">else</span>
1237:       <span class="ruby-identifier">encoding</span> = (<span class="ruby-identifier">args</span>[<span class="ruby-value">-1</span>] = <span class="ruby-identifier">args</span>[<span class="ruby-value">-1</span>].<span class="ruby-identifier">dup</span>).<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:encoding</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Hash</span>)
1238:       <span class="ruby-identifier">str</span>      = <span class="ruby-value str">&quot;&quot;</span>
1239:       <span class="ruby-identifier">str</span>.<span class="ruby-identifier">encode!</span>(<span class="ruby-identifier">encoding</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">encoding</span>
1240:       <span class="ruby-identifier">args</span>.<span class="ruby-identifier">unshift</span>(<span class="ruby-identifier">str</span>)
1241:     <span class="ruby-keyword kw">end</span>
1242:     <span class="ruby-identifier">csv</span> = <span class="ruby-identifier">new</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)  <span class="ruby-comment cmt"># wrap</span>
1243:     <span class="ruby-keyword kw">yield</span> <span class="ruby-identifier">csv</span>         <span class="ruby-comment cmt"># yield for appending</span>
1244:     <span class="ruby-identifier">csv</span>.<span class="ruby-identifier">string</span>        <span class="ruby-comment cmt"># return final String</span>
1245:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001903">
                    
                    <a name="M001903"></a><b>generate_line</b>(row, options = Hash.new)
                    
                </div>
                
                <div class="description">
                  <p>
This method is a shortcut for converting a single row (<a
href="Array.html">Array</a>) into a <a href="CSV.html">CSV</a> <a
href="String.html">String</a>.
</p>
<p>
The <tt>options</tt> parameter can be anything CSV::new() understands. This
method understands an additional <tt>:encoding</tt> parameter to set the
base <a href="Encoding.html">Encoding</a> for the output. This method will
try to guess your <a href="Encoding.html">Encoding</a> from the first
non-<tt>nil</tt> field in <tt>row</tt>, if possible, but you may need to
use this parameter as a backup plan.
</p>
<p>
The <tt>:<a href="CSV.html#row_sep">row_sep</a></tt> <tt>option</tt>
defaults to <tt>$INPUT_RECORD_SEPARATOR</tt> (<tt>$/</tt>) when calling
this method.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001903_source')" id="l_M001903_source">show</a>
                        
                    </p>
                    <div id="M001903_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/csv.rb, line 1260</span>
1260:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">generate_line</span>(<span class="ruby-identifier">row</span>, <span class="ruby-identifier">options</span> = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>)
1261:     <span class="ruby-identifier">options</span>  = {<span class="ruby-identifier">row_sep</span><span class="ruby-operator">:</span> <span class="ruby-identifier">$INPUT_RECORD_SEPARATOR</span>}.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">options</span>)
1262:     <span class="ruby-identifier">encoding</span> = <span class="ruby-identifier">options</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:encoding</span>)
1263:     <span class="ruby-identifier">str</span>      = <span class="ruby-value str">&quot;&quot;</span>
1264:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">encoding</span>
1265:       <span class="ruby-identifier">str</span>.<span class="ruby-identifier">force_encoding</span>(<span class="ruby-identifier">encoding</span>)
1266:     <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">field</span> = <span class="ruby-identifier">row</span>.<span class="ruby-identifier">find</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span> <span class="ruby-keyword kw">not</span> <span class="ruby-identifier">f</span>.<span class="ruby-identifier">nil?</span> }
1267:       <span class="ruby-identifier">str</span>.<span class="ruby-identifier">force_encoding</span>(<span class="ruby-constant">String</span>(<span class="ruby-identifier">field</span>).<span class="ruby-identifier">encoding</span>)
1268:     <span class="ruby-keyword kw">end</span>
1269:     (<span class="ruby-identifier">new</span>(<span class="ruby-identifier">str</span>, <span class="ruby-identifier">options</span>) <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">row</span>).<span class="ruby-identifier">string</span>
1270:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001891">
                    
                    <a name="M001891"></a><b>instance</b>(data = $stdout, options = Hash.new)
                    
                </div>
                
                <div class="description">
                  <p>
This method will return a <a href="CSV.html">CSV</a> instance, just like
CSV::new(), but the instance will be cached and returned for all future
calls to this method for the same <tt>data</tt> object (tested by <a
href="Object.html#M000384">Object#object_id()</a>) with the same
<tt>options</tt>.
</p>
<p>
If a block is given, the instance is passed to the block and the return
value becomes the return value of the block.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001891_source')" id="l_M001891_source">show</a>
                        
                    </p>
                    <div id="M001891_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/csv.rb, line 998</span>
 998:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">instance</span>(<span class="ruby-identifier">data</span> = <span class="ruby-identifier">$stdout</span>, <span class="ruby-identifier">options</span> = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>)
 999:     <span class="ruby-comment cmt"># create a _signature_ for this method call, data object and options</span>
1000:     <span class="ruby-identifier">sig</span> = [<span class="ruby-identifier">data</span>.<span class="ruby-identifier">object_id</span>] <span class="ruby-operator">+</span>
1001:           <span class="ruby-identifier">options</span>.<span class="ruby-identifier">values_at</span>(<span class="ruby-operator">*</span><span class="ruby-constant">DEFAULT_OPTIONS</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">sort_by</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">sym</span><span class="ruby-operator">|</span> <span class="ruby-identifier">sym</span>.<span class="ruby-identifier">to_s</span> })
1002: 
1003:     <span class="ruby-comment cmt"># fetch or create the instance for this signature</span>
1004:     <span class="ruby-ivar">@@instances</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>
1005:     <span class="ruby-identifier">instance</span>    =   (<span class="ruby-ivar">@@instances</span>[<span class="ruby-identifier">sig</span>] <span class="ruby-operator">||=</span> <span class="ruby-identifier">new</span>(<span class="ruby-identifier">data</span>, <span class="ruby-identifier">options</span>))
1006: 
1007:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block_given?</span>
1008:       <span class="ruby-keyword kw">yield</span> <span class="ruby-identifier">instance</span>  <span class="ruby-comment cmt"># run block, if given, returning result</span>
1009:     <span class="ruby-keyword kw">else</span>
1010:       <span class="ruby-identifier">instance</span>        <span class="ruby-comment cmt"># or return the instance</span>
1011:     <span class="ruby-keyword kw">end</span>
1012:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001897">
                    
                    <a name="M001897"></a><b>load</b>(io_or_str, options = Hash.new)
                    
                </div>
                
                <div class="description">
                  <p>
This method is the reading counterpart to CSV::dump(). See that method for
a detailed description of the process.
</p>
<p>
You can customize loading by adding a class method called csv_load() which
will be passed a <a href="Hash.html">Hash</a> of meta information, an <a
href="Array.html">Array</a> of headers, and an <a
href="Array.html">Array</a> of fields for the object the method is expected
to return.
</p>
<p>
Remember that all fields will be Strings after this load. If you need
something else, use <tt>options</tt> to setup converters or provide a
custom csv_load() implementation.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001897_source')" id="l_M001897_source">show</a>
                        
                    </p>
                    <div id="M001897_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/csv.rb, line 1106</span>
1106:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">load</span>(<span class="ruby-identifier">io_or_str</span>, <span class="ruby-identifier">options</span> = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>)
1107:     <span class="ruby-identifier">csv</span> = <span class="ruby-identifier">new</span>(<span class="ruby-identifier">io_or_str</span>, <span class="ruby-identifier">options</span>)
1108: 
1109:     <span class="ruby-comment cmt"># load meta information</span>
1110:     <span class="ruby-identifier">meta</span> = <span class="ruby-constant">Hash</span>[<span class="ruby-operator">*</span><span class="ruby-identifier">csv</span>.<span class="ruby-identifier">shift</span>]
1111:     <span class="ruby-identifier">cls</span>  = <span class="ruby-identifier">meta</span>[<span class="ruby-value str">&quot;class&quot;</span>.<span class="ruby-identifier">encode</span>(<span class="ruby-identifier">csv</span>.<span class="ruby-identifier">encoding</span>)].<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;::&quot;</span>.<span class="ruby-identifier">encode</span>(<span class="ruby-identifier">csv</span>.<span class="ruby-identifier">encoding</span>)).
1112:                                               <span class="ruby-identifier">inject</span>(<span class="ruby-constant">Object</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">c</span>, <span class="ruby-identifier">const</span><span class="ruby-operator">|</span>
1113:       <span class="ruby-identifier">c</span>.<span class="ruby-identifier">const_get</span>(<span class="ruby-identifier">const</span>)
1114:     <span class="ruby-keyword kw">end</span>
1115: 
1116:     <span class="ruby-comment cmt"># load headers</span>
1117:     <span class="ruby-identifier">headers</span> = <span class="ruby-identifier">csv</span>.<span class="ruby-identifier">shift</span>
1118: 
1119:     <span class="ruby-comment cmt"># unserialize each object stored in the file</span>
1120:     <span class="ruby-identifier">results</span> = <span class="ruby-identifier">csv</span>.<span class="ruby-identifier">inject</span>(<span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">all</span>, <span class="ruby-identifier">row</span><span class="ruby-operator">|</span>
1121:       <span class="ruby-keyword kw">begin</span>
1122:         <span class="ruby-identifier">obj</span> = <span class="ruby-identifier">cls</span>.<span class="ruby-identifier">csv_load</span>(<span class="ruby-identifier">meta</span>, <span class="ruby-identifier">headers</span>, <span class="ruby-identifier">row</span>)
1123:       <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">NoMethodError</span>
1124:         <span class="ruby-identifier">obj</span> = <span class="ruby-identifier">cls</span>.<span class="ruby-identifier">allocate</span>
1125:         <span class="ruby-identifier">headers</span>.<span class="ruby-identifier">zip</span>(<span class="ruby-identifier">row</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">name</span>, <span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
1126:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">name</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-value">?@</span>
1127:             <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">instance_variable_set</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">value</span>)
1128:           <span class="ruby-keyword kw">else</span>
1129:             <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">value</span>)
1130:           <span class="ruby-keyword kw">end</span>
1131:         <span class="ruby-keyword kw">end</span>
1132:       <span class="ruby-keyword kw">end</span>
1133:       <span class="ruby-identifier">all</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">obj</span>
1134:     <span class="ruby-keyword kw">end</span>
1135: 
1136:     <span class="ruby-identifier">csv</span>.<span class="ruby-identifier">close</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">io_or_str</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">String</span>
1137: 
1138:     <span class="ruby-identifier">results</span>
1139:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001933">
                    
                    <a name="M001933"></a><b>new</b>(data, options = Hash.new)
                    
                </div>
                
                <div class="description">
                  <p>
This constructor will wrap either a <a href="String.html">String</a> or <a
href="IO.html">IO</a> object passed in <tt>data</tt> for reading and/or
writing. In addition to the <a href="CSV.html">CSV</a> instance methods,
several <a href="IO.html">IO</a> methods are delegated. (See CSV::open()
for a complete list.) If you pass a <a href="String.html">String</a> for
<tt>data</tt>, you can later retrieve it (after writing to it, for example)
with CSV.string().
</p>
<p>
Note that a wrapped <a href="String.html">String</a> will be positioned at
at the beginning (for reading). If you want it at the end (for writing),
use CSV::generate(). If you want any other positioning, pass a preset <a
href="StringIO.html">StringIO</a> object instead.
</p>
<p>
You may set any reading and/or writing preferences in the <tt>options</tt>
<a href="Hash.html">Hash</a>. Available options are:
</p>
<table>
<tr><td valign="top"><b><tt>:<a href="CSV.html#col_sep">col_sep</a></tt></b>:</td><td>The <a href="String.html">String</a> placed between each field. This <a
href="String.html">String</a> will be transcoded into the data&#8217;s <a
href="Encoding.html">Encoding</a> before parsing.

</td></tr>
<tr><td valign="top"><b><tt>:<a href="CSV.html#row_sep">row_sep</a></tt></b>:</td><td>The <a href="String.html">String</a> appended to the end of each row. This
can be set to the special <tt>:auto</tt> setting, which requests that <a
href="CSV.html">CSV</a> automatically discover this from the data.
Auto-discovery reads ahead in the data looking for the next
<tt>&quot;r\n&quot;</tt>, <tt>&quot;n&quot;</tt>, or <tt>&quot;r&quot;</tt>
sequence. A sequence will be selected even if it occurs in a quoted field,
assuming that you would have the same line endings there. If none of those
sequences is found, <tt>data</tt> is <tt>ARGF</tt>, <tt>STDIN</tt>,
<tt>STDOUT</tt>, or <tt>STDERR</tt>, or the stream is only available for
output, the default <tt>$INPUT_RECORD_SEPARATOR</tt> (<tt>$/</tt>) is used.
Obviously, discovery takes a little time. <a href="Set.html">Set</a>
manually if speed is important. Also note that <a href="IO.html">IO</a>
objects should be opened in binary mode on Windows if this feature will be
used as the line-ending translation can cause problems with resetting the
document position to where it was before the read ahead. This <a
href="String.html">String</a> will be transcoded into the data&#8217;s <a
href="Encoding.html">Encoding</a> before parsing.

</td></tr>
<tr><td valign="top"><b><tt>:<a href="CSV.html#quote_char">quote_char</a></tt></b>:</td><td>The character used to quote fields. This has to be a single character <a
href="String.html">String</a>. This is useful for application that
incorrectly use <tt>'</tt> as the quote character instead of the correct
<tt>&quot;</tt>. <a href="CSV.html">CSV</a> will always consider a double
sequence this character to be an escaped quote. This <a
href="String.html">String</a> will be transcoded into the data&#8217;s <a
href="Encoding.html">Encoding</a> before parsing.

</td></tr>
<tr><td valign="top"><b><tt>:<a href="CSV.html#field_size_limit">field_size_limit</a></tt></b>:</td><td>This is a maximum size <a href="CSV.html">CSV</a> will read ahead looking
for the closing quote for a field. (In truth, it reads to the first line
ending beyond this size.) If a quote cannot be found within the limit <a
href="CSV.html">CSV</a> will raise a <a
href="CSV/MalformedCSVError.html">MalformedCSVError</a>, assuming the data
is faulty. You can use this limit to prevent what are effectively DoS
attacks on the parser. However, this limit can cause a legitimate parse to
fail and thus is set to <tt>nil</tt>, or off, by default.

</td></tr>
<tr><td valign="top"><b><tt>:converters</tt></b>:</td><td>An <a href="Array.html">Array</a> of names from the <a
href="CSV.html#Converters">Converters</a> <a href="Hash.html">Hash</a>
and/or lambdas that handle custom conversion. A single converter
doesn&#8217;t have to be in an <a href="Array.html">Array</a>. All built-in
converters try to transcode fields to UTF-8 before converting. The
conversion will fail if the data cannot be transcoded, leaving the field
unchanged.

</td></tr>
<tr><td valign="top"><b><tt>:unconverted_fields</tt></b>:</td><td>If set to <tt>true</tt>, an unconverted_fields() method will be added to
all returned rows (<a href="Array.html">Array</a> or <a
href="CSV/Row.html">CSV::Row</a>) that will return the fields as they were
before conversion. Note that <tt>:headers</tt> supplied by <a
href="Array.html">Array</a> or <a href="String.html">String</a> were not
fields of the document and thus will have an empty <a
href="Array.html">Array</a> attached.

</td></tr>
<tr><td valign="top"><b><tt>:headers</tt></b>:</td><td>If set to <tt>:first_row</tt> or <tt>true</tt>, the initial row of the <a
href="CSV.html">CSV</a> file will be treated as a row of headers. If set to
an <a href="Array.html">Array</a>, the contents will be used as the
headers. If set to a <a href="String.html">String</a>, the <a
href="String.html">String</a> is run through a call of CSV::<a
href="CSV.html#M001922">parse_line</a>() with the same <tt>:<a
href="CSV.html#col_sep">col_sep</a></tt>, <tt>:<a
href="CSV.html#row_sep">row_sep</a></tt>, and <tt>:<a
href="CSV.html#quote_char">quote_char</a></tt> as this instance to produce
an <a href="Array.html">Array</a> of headers. This setting causes <a
href="CSV.html#M001963">CSV#shift()</a> to return rows as <a
href="CSV/Row.html">CSV::Row</a> objects instead of Arrays and <a
href="CSV.html#M001925">CSV#read()</a> to return <a
href="CSV/Table.html">CSV::Table</a> objects instead of an <a
href="Array.html">Array</a> of Arrays.

</td></tr>
<tr><td valign="top"><b><tt>:return_headers</tt></b>:</td><td>When <tt>false</tt>, header rows are silently swallowed. If set to
<tt>true</tt>, header rows are returned in a <a
href="CSV/Row.html">CSV::Row</a> object with identical headers and fields
(save that the fields do not go through the converters).

</td></tr>
<tr><td valign="top"><b><tt>:write_headers</tt></b>:</td><td>When <tt>true</tt> and <tt>:headers</tt> is set, a header row will be added
to the output.

</td></tr>
<tr><td valign="top"><b><tt>:<a href="CSV.html#M001941">header_converters</a></tt></b>:</td><td>Identical in functionality to <tt>:converters</tt> save that the
conversions are only made to header rows. All built-in converters try to
transcode headers to UTF-8 before converting. The conversion will fail if
the data cannot be transcoded, leaving the header unchanged.

</td></tr>
<tr><td valign="top"><b><tt>:skip_blanks</tt></b>:</td><td>When set to a <tt>true</tt> value, <a href="CSV.html">CSV</a> will skip
over any rows with no content.

</td></tr>
<tr><td valign="top"><b><tt>:force_quotes</tt></b>:</td><td>When set to a <tt>true</tt> value, <a href="CSV.html">CSV</a> will quote
all <a href="CSV.html">CSV</a> fields it creates.

</td></tr>
</table>
<p>
See CSV::DEFAULT_OPTIONS for the default settings.
</p>
<p>
Options cannot be overridden in the instance methods for performance
reasons, so be sure to set what you want here.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001933_source')" id="l_M001933_source">show</a>
                        
                    </p>
                    <div id="M001933_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/csv.rb, line 1563</span>
1563:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">data</span>, <span class="ruby-identifier">options</span> = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>)
1564:     <span class="ruby-comment cmt"># build the options for this read/write</span>
1565:     <span class="ruby-identifier">options</span> = <span class="ruby-constant">DEFAULT_OPTIONS</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">options</span>)
1566: 
1567:     <span class="ruby-comment cmt"># create the IO object we will read from</span>
1568:     <span class="ruby-ivar">@io</span>       = <span class="ruby-identifier">data</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>) <span class="ruby-operator">?</span> <span class="ruby-constant">StringIO</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">data</span>) <span class="ruby-operator">:</span> <span class="ruby-identifier">data</span>
1569:     <span class="ruby-comment cmt"># honor the IO encoding if we can, otherwise default to ASCII-8BIT</span>
1570:     <span class="ruby-ivar">@encoding</span> = <span class="ruby-identifier">raw_encoding</span>(<span class="ruby-keyword kw">nil</span>) <span class="ruby-operator">||</span>
1571:                 ( <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">encoding</span> = <span class="ruby-identifier">options</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:internal_encoding</span>)
1572:                     <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">encoding</span>
1573:                     <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Encoding</span>; <span class="ruby-identifier">encoding</span>
1574:                     <span class="ruby-keyword kw">else</span> <span class="ruby-constant">Encoding</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">encoding</span>)
1575:                     <span class="ruby-keyword kw">end</span>
1576:                   <span class="ruby-keyword kw">end</span> ) <span class="ruby-operator">||</span>
1577:                 ( <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">encoding</span> = <span class="ruby-identifier">options</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:encoding</span>)
1578:                   <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Encoding</span>; <span class="ruby-identifier">encoding</span>
1579:                   <span class="ruby-keyword kw">when</span> <span class="ruby-regexp re">/\A[^:]+/</span>; <span class="ruby-constant">Encoding</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">$&amp;</span>)
1580:                   <span class="ruby-keyword kw">end</span> ) <span class="ruby-operator">||</span>
1581:                 <span class="ruby-constant">Encoding</span>.<span class="ruby-identifier">default_internal</span> <span class="ruby-operator">||</span> <span class="ruby-constant">Encoding</span>.<span class="ruby-identifier">default_external</span>
1582:     <span class="ruby-comment cmt">#</span>
1583:     <span class="ruby-comment cmt"># prepare for building safe regular expressions in the target encoding,</span>
1584:     <span class="ruby-comment cmt"># if we can transcode the needed characters</span>
1585:     <span class="ruby-comment cmt">#</span>
1586:     <span class="ruby-ivar">@re_esc</span>   =   <span class="ruby-value str">&quot;\\&quot;</span>.<span class="ruby-identifier">encode</span>(<span class="ruby-ivar">@encoding</span>) <span class="ruby-keyword kw">rescue</span> <span class="ruby-value str">&quot;&quot;</span>
1587:     <span class="ruby-ivar">@re_chars</span> =   <span class="ruby-node">/#{%&quot;[-][\\.^$?*+{}()|# \r\n\t\f\v]&quot;.encode(@encoding)}/</span>
1588:     <span class="ruby-comment cmt"># @re_chars =   /#{%&quot;[-][\\.^$?*+{}()|# \r\n\t\f\v]&quot;.encode(@encoding, fallback: proc{&quot;&quot;})}/</span>
1589: 
1590:     <span class="ruby-identifier">init_separators</span>(<span class="ruby-identifier">options</span>)
1591:     <span class="ruby-identifier">init_parsers</span>(<span class="ruby-identifier">options</span>)
1592:     <span class="ruby-identifier">init_converters</span>(<span class="ruby-identifier">options</span>)
1593:     <span class="ruby-identifier">init_headers</span>(<span class="ruby-identifier">options</span>)
1594: 
1595:     <span class="ruby-identifier">options</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:encoding</span>)
1596:     <span class="ruby-identifier">options</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:internal_encoding</span>)
1597:     <span class="ruby-identifier">options</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:external_encoding</span>)
1598:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">options</span>.<span class="ruby-identifier">empty?</span>
1599:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-node">&quot;Unknown options:  #{options.keys.join(', ')}.&quot;</span>
1600:     <span class="ruby-keyword kw">end</span>
1601: 
1602:     <span class="ruby-comment cmt"># track our own lineno since IO gets confused about line-ends is CSV fields</span>
1603:     <span class="ruby-ivar">@lineno</span> = <span class="ruby-value">0</span>
1604:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001913">
                    
                    <a name="M001913"></a><b>open( filename, mode = "rb", options = Hash.new ) { |faster_csv| ... }
open( filename, options = Hash.new ) { |faster_csv| ... }
open( filename, mode = "rb", options = Hash.new )
open( filename, options = Hash.new )
</b>
                    
                </div>
                
                <div class="description">
                  <p>
This method opens an <a href="IO.html">IO</a> object, and wraps that with
<a href="CSV.html">CSV</a>. This is intended as the primary interface for
writing a <a href="CSV.html">CSV</a> file.
</p>
<p>
You must pass a <tt>filename</tt> and may optionally add a <tt>mode</tt>
for Ruby&#8217;s open(). You may also pass an optional <a
href="Hash.html">Hash</a> containing any <tt>options</tt> CSV::new()
understands as the final argument.
</p>
<p>
This method works like Ruby&#8217;s open() call, in that it will pass a <a
href="CSV.html">CSV</a> object to a provided block and close it when the
block terminates, or it will return the <a href="CSV.html">CSV</a> object
when no block is provided. (<b>Note</b>: This is different from the Ruby
1.8 <a href="CSV.html">CSV</a> library which passed rows to the block. Use
CSV::foreach() for that behavior.)
</p>
<p>
You must provide a <tt>mode</tt> with an embedded <a
href="Encoding.html">Encoding</a> designator unless your data is in
Encoding::default_external(). <a href="CSV.html">CSV</a> will check the <a
href="Encoding.html">Encoding</a> of the underlying <a
href="IO.html">IO</a> object (set by the <tt>mode</tt> you pass) to
determine how to parse the data. You may provide a second <a
href="Encoding.html">Encoding</a> to have the data transcoded as it is read
just as you can with a normal call to IO::open(). For example,
<tt>&quot;rb:UTF-32BE:UTF-8&quot;</tt> would read UTF-32BE data from the
file but transcode it to UTF-8 before <a href="CSV.html">CSV</a> parses it.
</p>
<p>
An opened <a href="CSV.html">CSV</a> object will delegate to many <a
href="IO.html">IO</a> methods for convenience. You may call:
</p>
<ul>
<li>binmode()

</li>
<li>binmode?()

</li>
<li>close()

</li>
<li>close_read()

</li>
<li>close_write()

</li>
<li>closed?()

</li>
<li>eof()

</li>
<li>eof?()

</li>
<li>external_encoding()

</li>
<li>fcntl()

</li>
<li>fileno()

</li>
<li>flock()

</li>
<li>flush()

</li>
<li>fsync()

</li>
<li>internal_encoding()

</li>
<li>ioctl()

</li>
<li>isatty()

</li>
<li>path()

</li>
<li>pid()

</li>
<li>pos()

</li>
<li>pos=()

</li>
<li>reopen()

</li>
<li>seek()

</li>
<li>stat()

</li>
<li>sync()

</li>
<li>sync=()

</li>
<li>tell()

</li>
<li>to_i()

</li>
<li>to_io()

</li>
<li>truncate()

</li>
<li>tty?()

</li>
</ul>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001913_source')" id="l_M001913_source">show</a>
                        
                    </p>
                    <div id="M001913_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/csv.rb, line 1335</span>
1335:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">open</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
1336:     <span class="ruby-comment cmt"># find the +options+ Hash</span>
1337:     <span class="ruby-identifier">options</span> = <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">Hash</span> <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">pop</span> <span class="ruby-keyword kw">else</span> <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword kw">end</span>
1338:     <span class="ruby-comment cmt"># wrap a File opened with the remaining +args+ with no newline</span>
1339:     <span class="ruby-comment cmt"># decorator</span>
1340:     <span class="ruby-identifier">file_opts</span> = {<span class="ruby-identifier">universal_newline</span><span class="ruby-operator">:</span> <span class="ruby-keyword kw">false</span>}.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">options</span>)
1341:     <span class="ruby-keyword kw">begin</span>
1342:       <span class="ruby-identifier">f</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-identifier">file_opts</span>)
1343:     <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">ArgumentError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
1344:       <span class="ruby-identifier">raise</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-regexp re">/needs binmode/</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">e</span>.<span class="ruby-identifier">message</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span>
1345:       <span class="ruby-identifier">args</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;rb&quot;</span>
1346:       <span class="ruby-identifier">file_opts</span> = {<span class="ruby-identifier">encoding</span><span class="ruby-operator">:</span> <span class="ruby-constant">Encoding</span>.<span class="ruby-identifier">default_external</span>}.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">file_opts</span>)
1347:       <span class="ruby-keyword kw">retry</span>
1348:     <span class="ruby-keyword kw">end</span>
1349:     <span class="ruby-identifier">csv</span> = <span class="ruby-identifier">new</span>(<span class="ruby-identifier">f</span>, <span class="ruby-identifier">options</span>)
1350: 
1351:     <span class="ruby-comment cmt"># handle blocks like Ruby's open(), not like the CSV library</span>
1352:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block_given?</span>
1353:       <span class="ruby-keyword kw">begin</span>
1354:         <span class="ruby-keyword kw">yield</span> <span class="ruby-identifier">csv</span>
1355:       <span class="ruby-keyword kw">ensure</span>
1356:         <span class="ruby-identifier">csv</span>.<span class="ruby-identifier">close</span>
1357:       <span class="ruby-keyword kw">end</span>
1358:     <span class="ruby-keyword kw">else</span>
1359:       <span class="ruby-identifier">csv</span>
1360:     <span class="ruby-keyword kw">end</span>
1361:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001916">
                    
                    <a name="M001916"></a><b>parse( str, options = Hash.new ) { |row| ... }
parse( str, options = Hash.new )
</b>
                    
                </div>
                
                <div class="description">
                  <p>
This method can be used to easily parse <a href="CSV.html">CSV</a> out of a
<a href="String.html">String</a>. You may either provide a <tt>block</tt>
which will be called with each row of the <a href="String.html">String</a>
in turn, or just use the returned <a href="Array.html">Array</a> of Arrays
(when no <tt>block</tt> is given).
</p>
<p>
You pass your <tt>str</tt> to read from, and an optional <tt>options</tt>
<a href="Hash.html">Hash</a> containing anything CSV::new() understands.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001916_source')" id="l_M001916_source">show</a>
                        
                    </p>
                    <div id="M001916_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/csv.rb, line 1375</span>
1375:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
1376:     <span class="ruby-identifier">csv</span> = <span class="ruby-identifier">new</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
1377:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block</span>.<span class="ruby-identifier">nil?</span>  <span class="ruby-comment cmt"># slurp contents, if no block is given</span>
1378:       <span class="ruby-keyword kw">begin</span>
1379:         <span class="ruby-identifier">csv</span>.<span class="ruby-identifier">read</span>
1380:       <span class="ruby-keyword kw">ensure</span>
1381:         <span class="ruby-identifier">csv</span>.<span class="ruby-identifier">close</span>
1382:       <span class="ruby-keyword kw">end</span>
1383:     <span class="ruby-keyword kw">else</span>           <span class="ruby-comment cmt"># or pass each row to a provided block</span>
1384:       <span class="ruby-identifier">csv</span>.<span class="ruby-identifier">each</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
1385:     <span class="ruby-keyword kw">end</span>
1386:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001922">
                    
                    <a name="M001922"></a><b>parse_line</b>(line, options = Hash.new)
                    
                </div>
                
                <div class="description">
                  <p>
This method is a shortcut for converting a single line of a <a
href="CSV.html">CSV</a> <a href="String.html">String</a> into a into an <a
href="Array.html">Array</a>. Note that if <tt>line</tt> contains multiple
rows, anything beyond the first row is ignored.
</p>
<p>
The <tt>options</tt> parameter can be anything CSV::new() understands.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001922_source')" id="l_M001922_source">show</a>
                        
                    </p>
                    <div id="M001922_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/csv.rb, line 1395</span>
1395:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">parse_line</span>(<span class="ruby-identifier">line</span>, <span class="ruby-identifier">options</span> = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>)
1396:     <span class="ruby-identifier">new</span>(<span class="ruby-identifier">line</span>, <span class="ruby-identifier">options</span>).<span class="ruby-identifier">shift</span>
1397:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001925">
                    
                    <a name="M001925"></a><b>read</b>(path, *options)
                    
                </div>
                
                <div class="description">
                  <p>
Use to slurp a <a href="CSV.html">CSV</a> file into an <a
href="Array.html">Array</a> of Arrays. Pass the <tt>path</tt> to the file
and any <tt>options</tt> CSV::new() understands. This method also
understands an additional <tt>:encoding</tt> parameter that you can use to
specify the <a href="Encoding.html">Encoding</a> of the data in the file to
be read. You must provide this unless your data is in
Encoding::default_external(). <a href="CSV.html">CSV</a> will use this to
determine how to parse the data. You may provide a second <a
href="Encoding.html">Encoding</a> to have the data transcoded as it is
read. For example, <tt>encoding: &quot;UTF-32BE:UTF-8&quot;</tt> would read
UTF-32BE data from the file but transcode it to UTF-8 before <a
href="CSV.html">CSV</a> parses it.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001925_source')" id="l_M001925_source">show</a>
                        
                    </p>
                    <div id="M001925_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/csv.rb, line 1410</span>
1410:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">read</span>(<span class="ruby-identifier">path</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">options</span>)
1411:     <span class="ruby-identifier">open</span>(<span class="ruby-identifier">path</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">options</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">csv</span><span class="ruby-operator">|</span> <span class="ruby-identifier">csv</span>.<span class="ruby-identifier">read</span> }
1412:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001926">
                    
                    <a name="M001926"></a><b>readlines</b>(*args)
                    
                </div>
                
                <div class="description">
                  <p>
Alias for CSV::read().
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001926_source')" id="l_M001926_source">show</a>
                        
                    </p>
                    <div id="M001926_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/csv.rb, line 1415</span>
1415:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">readlines</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
1416:     <span class="ruby-identifier">read</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
1417:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001927">
                    
                    <a name="M001927"></a><b>table</b>(path, options = Hash.new)
                    
                </div>
                
                <div class="description">
                  <p>
A shortcut for:
</p>
<pre>
  CSV.read( path, { headers:           true,
                    converters:        :numeric,
                    header_converters: :symbol }.merge(options) )
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001927_source')" id="l_M001927_source">show</a>
                        
                    </p>
                    <div id="M001927_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/csv.rb, line 1426</span>
1426:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">table</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">options</span> = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>)
1427:     <span class="ruby-identifier">read</span>( <span class="ruby-identifier">path</span>, { <span class="ruby-identifier">headers</span><span class="ruby-operator">:</span>           <span class="ruby-keyword kw">true</span>,
1428:                   <span class="ruby-identifier">converters</span><span class="ruby-operator">:</span>        <span class="ruby-identifier">:numeric</span>,
1429:                   <span class="ruby-identifier">header_converters</span><span class="ruby-operator">:</span> <span class="ruby-identifier">:symbol</span> }.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">options</span>) )
1430:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M001948">
                    
                    <a name="M001948"></a><b>&lt;&lt;</b>(row)
                    
                </div>
                
                <div class="description">
                  <p>
The primary write method for wrapped Strings and IOs, <tt>row</tt> (an <a
href="Array.html">Array</a> or <a href="CSV/Row.html">CSV::Row</a>) is
converted to <a href="CSV.html">CSV</a> and appended to the data source.
When a <a href="CSV/Row.html">CSV::Row</a> is passed, only the row&#8217;s
fields() are appended to the output.
</p>
<p>
The data source must be open for writing.
</p>

                </div>
                
                
                <div class="aka">
                    This method is also aliased as
                    
                    <a href="CSV.html#M001954">add_row</a>
                    
                    <a href="CSV.html#M001955">puts</a>
                    
                </div>
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001948_source')" id="l_M001948_source">show</a>
                        
                    </p>
                    <div id="M001948_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/csv.rb, line 1712</span>
1712:   <span class="ruby-keyword kw">def</span> <span class="ruby-operator">&lt;&lt;</span>(<span class="ruby-identifier">row</span>)
1713:     <span class="ruby-comment cmt"># make sure headers have been assigned</span>
1714:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">header_row?</span> <span class="ruby-keyword kw">and</span> [<span class="ruby-constant">Array</span>, <span class="ruby-constant">String</span>].<span class="ruby-identifier">include?</span> <span class="ruby-ivar">@use_headers</span>.<span class="ruby-identifier">class</span>
1715:       <span class="ruby-identifier">parse_headers</span>  <span class="ruby-comment cmt"># won't read data for Array or String</span>
1716:       <span class="ruby-keyword kw">self</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-ivar">@headers</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@write_headers</span>
1717:     <span class="ruby-keyword kw">end</span>
1718: 
1719:     <span class="ruby-comment cmt"># handle CSV::Row objects and Hashes</span>
1720:     <span class="ruby-identifier">row</span> = <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">row</span>
1721:           <span class="ruby-keyword kw">when</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span><span class="ruby-operator">::</span><span class="ruby-constant">Row</span> <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">row</span>.<span class="ruby-identifier">fields</span>
1722:           <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Hash</span>            <span class="ruby-keyword kw">then</span> <span class="ruby-ivar">@headers</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">header</span><span class="ruby-operator">|</span> <span class="ruby-identifier">row</span>[<span class="ruby-identifier">header</span>] }
1723:           <span class="ruby-keyword kw">else</span>                      <span class="ruby-identifier">row</span>
1724:           <span class="ruby-keyword kw">end</span>
1725: 
1726:     <span class="ruby-ivar">@headers</span> =  <span class="ruby-identifier">row</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">header_row?</span>
1727:     <span class="ruby-ivar">@lineno</span>  <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
1728: 
1729:     <span class="ruby-identifier">output</span> = <span class="ruby-identifier">row</span>.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-ivar">@quote</span>).<span class="ruby-identifier">join</span>(<span class="ruby-ivar">@col_sep</span>) <span class="ruby-operator">+</span> <span class="ruby-ivar">@row_sep</span>  <span class="ruby-comment cmt"># quote and separate</span>
1730:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">StringIO</span>)             <span class="ruby-keyword kw">and</span>
1731:        <span class="ruby-identifier">output</span>.<span class="ruby-identifier">encoding</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">raw_encoding</span> <span class="ruby-keyword kw">and</span>
1732:        (<span class="ruby-identifier">compatible_encoding</span> = <span class="ruby-constant">Encoding</span>.<span class="ruby-identifier">compatible?</span>(<span class="ruby-ivar">@io</span>.<span class="ruby-identifier">string</span>, <span class="ruby-identifier">output</span>))
1733:       <span class="ruby-ivar">@io</span> = <span class="ruby-constant">StringIO</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@io</span>.<span class="ruby-identifier">string</span>.<span class="ruby-identifier">force_encoding</span>(<span class="ruby-identifier">compatible_encoding</span>))
1734:       <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">seek</span>(<span class="ruby-value">0</span>, <span class="ruby-constant">IO</span><span class="ruby-operator">::</span><span class="ruby-constant">SEEK_END</span>)
1735:     <span class="ruby-keyword kw">end</span>
1736:     <span class="ruby-ivar">@io</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">output</span>
1737: 
1738:     <span class="ruby-keyword kw">self</span>  <span class="ruby-comment cmt"># for chaining</span>
1739:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001954">
                    
                    <a name="M001954"></a><b>add_row</b>(row)
                    
                </div>
                
                <div class="description">
                  <p>
Alias for #<<
</p>

                </div>
                
                
                
            </div>
            
            <div class="method">
                <div class="title" id="M001956">
                    
                    <a name="M001956"></a><b>convert( name )
convert { |field| ... }
convert { |field, field_info| ... }
</b>
                    
                </div>
                
                <div class="description">
                  <p>
You can use this method to install a CSV::Converters built-in, or provide a
block that handles a custom conversion.
</p>
<p>
If you provide a block that takes one argument, it will be passed the field
and is expected to return the converted value or the field itself. If your
block takes two arguments, it will also be passed a CSV::FieldInfo <a
href="Struct.html">Struct</a>, containing details about the field. Again,
the block should return a converted field or the field itself.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001956_source')" id="l_M001956_source">show</a>
                        
                    </p>
                    <div id="M001956_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/csv.rb, line 1758</span>
1758:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">convert</span>(<span class="ruby-identifier">name</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">converter</span>)
1759:     <span class="ruby-identifier">add_converter</span>(<span class="ruby-identifier">:converters</span>, <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span><span class="ruby-operator">::</span><span class="ruby-constant">Converters</span>, <span class="ruby-identifier">name</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">converter</span>)
1760:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001934">
                    
                    <a name="M001934"></a><b>converters</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Returns the current list of converters in effect. See CSV::new for details.
Built-in converters will be returned by name, while others will be returned
as is.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001934_source')" id="l_M001934_source">show</a>
                        
                    </p>
                    <div id="M001934_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/csv.rb, line 1628</span>
1628:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">converters</span>
1629:     <span class="ruby-ivar">@converters</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">converter</span><span class="ruby-operator">|</span>
1630:       <span class="ruby-identifier">name</span> = <span class="ruby-constant">Converters</span>.<span class="ruby-identifier">rassoc</span>(<span class="ruby-identifier">converter</span>)
1631:       <span class="ruby-identifier">name</span> <span class="ruby-value">? </span><span class="ruby-identifier">name</span>.<span class="ruby-identifier">first</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">converter</span>
1632:     <span class="ruby-keyword kw">end</span>
1633:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001959">
                    
                    <a name="M001959"></a><b>each</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Yields each row of the data source in turn.
</p>
<p>
Support for <a href="Enumerable.html">Enumerable</a>.
</p>
<p>
The data source must be open for reading.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001959_source')" id="l_M001959_source">show</a>
                        
                    </p>
                    <div id="M001959_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/csv.rb, line 1789</span>
1789:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">each</span>
1790:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block_given?</span>
1791:       <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">row</span> = <span class="ruby-identifier">shift</span>
1792:         <span class="ruby-keyword kw">yield</span> <span class="ruby-identifier">row</span>
1793:       <span class="ruby-keyword kw">end</span>
1794:     <span class="ruby-keyword kw">else</span>
1795:       <span class="ruby-identifier">to_enum</span>
1796:     <span class="ruby-keyword kw">end</span>
1797:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001943">
                    
                    <a name="M001943"></a><b>force_quotes?</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Returns <tt>true</tt> if all output fields are quoted. See CSV::new for
details.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001943_source')" id="l_M001943_source">show</a>
                        
                    </p>
                    <div id="M001943_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/csv.rb, line 1671</span>
1671:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">force_quotes?</span>()       <span class="ruby-ivar">@force_quotes</span>       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001964">
                    
                    <a name="M001964"></a><b>gets</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Alias for <a href="CSV.html#M001963">shift</a>
</p>

                </div>
                
                
                
            </div>
            
            <div class="method">
                <div class="title" id="M001958">
                    
                    <a name="M001958"></a><b>header_convert( name )
header_convert { |field| ... }
header_convert { |field, field_info| ... }
</b>
                    
                </div>
                
                <div class="description">
                  <p>
Identical to <a href="CSV.html#M001956">CSV#convert()</a>, but for header
rows.
</p>
<p>
Note that this method must be called before header rows are read to have
any effect.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001958_source')" id="l_M001958_source">show</a>
                        
                    </p>
                    <div id="M001958_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/csv.rb, line 1773</span>
1773:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">header_convert</span>(<span class="ruby-identifier">name</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">converter</span>)
1774:     <span class="ruby-identifier">add_converter</span>( <span class="ruby-identifier">:header_converters</span>,
1775:                    <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span><span class="ruby-operator">::</span><span class="ruby-constant">HeaderConverters</span>,
1776:                    <span class="ruby-identifier">name</span>,
1777:                    <span class="ruby-operator">&amp;</span><span class="ruby-identifier">converter</span> )
1778:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001941">
                    
                    <a name="M001941"></a><b>header_converters</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Returns the current list of converters in effect for headers. See CSV::new
for details. Built-in converters will be returned by name, while others
will be returned as is.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001941_source')" id="l_M001941_source">show</a>
                        
                    </p>
                    <div id="M001941_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/csv.rb, line 1659</span>
1659:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">header_converters</span>
1660:     <span class="ruby-ivar">@header_converters</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">converter</span><span class="ruby-operator">|</span>
1661:       <span class="ruby-identifier">name</span> = <span class="ruby-constant">HeaderConverters</span>.<span class="ruby-identifier">rassoc</span>(<span class="ruby-identifier">converter</span>)
1662:       <span class="ruby-identifier">name</span> <span class="ruby-value">? </span><span class="ruby-identifier">name</span>.<span class="ruby-identifier">first</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">converter</span>
1663:     <span class="ruby-keyword kw">end</span>
1664:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001962">
                    
                    <a name="M001962"></a><b>header_row?</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Returns <tt>true</tt> if the next row read will be a header row.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001962_source')" id="l_M001962_source">show</a>
                        
                    </p>
                    <div id="M001962_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/csv.rb, line 1815</span>
1815:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">header_row?</span>
1816:     <span class="ruby-ivar">@use_headers</span> <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@headers</span>.<span class="ruby-identifier">nil?</span>
1817:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001937">
                    
                    <a name="M001937"></a><b>headers</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Returns <tt>nil</tt> if headers will not be used, <tt>true</tt> if they
will but have not yet been read, or the actual headers after they have been
read. See CSV::new for details.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001937_source')" id="l_M001937_source">show</a>
                        
                    </p>
                    <div id="M001937_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/csv.rb, line 1644</span>
1644:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">headers</span>
1645:     <span class="ruby-ivar">@headers</span> <span class="ruby-operator">||</span> <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@use_headers</span>
1646:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001966">
                    
                    <a name="M001966"></a><b>inspect</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Returns a simplified description of the key <a href="CSV.html">CSV</a>
attributes in an ASCII compatible <a href="String.html">String</a>.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001966_source')" id="l_M001966_source">show</a>
                        
                    </p>
                    <div id="M001966_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/csv.rb, line 1974</span>
1974:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">inspect</span>
1975:     <span class="ruby-identifier">str</span> = [<span class="ruby-value str">&quot;&lt;#&quot;</span>, <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">to_s</span>, <span class="ruby-value str">&quot; io_type:&quot;</span>]
1976:     <span class="ruby-comment cmt"># show type of wrapped IO</span>
1977:     <span class="ruby-keyword kw">if</span>    <span class="ruby-ivar">@io</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">$stdout</span> <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">str</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;$stdout&quot;</span>
1978:     <span class="ruby-keyword kw">elsif</span> <span class="ruby-ivar">@io</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">$stdin</span>  <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">str</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;$stdin&quot;</span>
1979:     <span class="ruby-keyword kw">elsif</span> <span class="ruby-ivar">@io</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">$stderr</span> <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">str</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;$stderr&quot;</span>
1980:     <span class="ruby-keyword kw">else</span>                      <span class="ruby-identifier">str</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">to_s</span>
1981:     <span class="ruby-keyword kw">end</span>
1982:     <span class="ruby-comment cmt"># show IO.path(), if available</span>
1983:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:path</span>) <span class="ruby-keyword kw">and</span> (<span class="ruby-identifier">p</span> = <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">path</span>)
1984:       <span class="ruby-identifier">str</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot; io_path:&quot;</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">inspect</span>
1985:     <span class="ruby-keyword kw">end</span>
1986:     <span class="ruby-comment cmt"># show encoding</span>
1987:     <span class="ruby-identifier">str</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot; encoding:&quot;</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-ivar">@encoding</span>.<span class="ruby-identifier">name</span>
1988:     <span class="ruby-comment cmt"># show other attributes</span>
1989:     <span class="ruby-node">%w[ lineno     col_sep     row_sep
1990:         quote_char skip_blanks ]</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">attr_name</span><span class="ruby-operator">|</span>
1991:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">a</span> = <span class="ruby-identifier">instance_variable_get</span>(<span class="ruby-node">&quot;@#{attr_name}&quot;</span>)
1992:         <span class="ruby-identifier">str</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot; &quot;</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">attr_name</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;:&quot;</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">inspect</span>
1993:       <span class="ruby-keyword kw">end</span>
1994:     <span class="ruby-keyword kw">end</span>
1995:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@use_headers</span>
1996:       <span class="ruby-identifier">str</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot; headers:&quot;</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">headers</span>.<span class="ruby-identifier">inspect</span>
1997:     <span class="ruby-keyword kw">end</span>
1998:     <span class="ruby-identifier">str</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;&gt;&quot;</span>
1999:     <span class="ruby-keyword kw">begin</span>
2000:       <span class="ruby-identifier">str</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">''</span>)
2001:     <span class="ruby-keyword kw">rescue</span>  <span class="ruby-comment cmt"># any encoding error</span>
2002:       <span class="ruby-identifier">str</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
2003:         <span class="ruby-identifier">e</span> = <span class="ruby-constant">Encoding</span><span class="ruby-operator">::</span><span class="ruby-constant">Converter</span>.<span class="ruby-identifier">asciicompat_encoding</span>(<span class="ruby-identifier">s</span>.<span class="ruby-identifier">encoding</span>)
2004:         <span class="ruby-identifier">e</span> <span class="ruby-value">? </span><span class="ruby-identifier">s</span>.<span class="ruby-identifier">encode</span>(<span class="ruby-identifier">e</span>) <span class="ruby-operator">:</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">force_encoding</span>(<span class="ruby-value str">&quot;ASCII-8BIT&quot;</span>)
2005:       <span class="ruby-keyword kw">end</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">''</span>)
2006:     <span class="ruby-keyword kw">end</span>
2007:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001955">
                    
                    <a name="M001955"></a><b>puts</b>(row)
                    
                </div>
                
                <div class="description">
                  <p>
Alias for #<<
</p>

                </div>
                
                
                
            </div>
            
            <div class="method">
                <div class="title" id="M001960">
                    
                    <a name="M001960"></a><b>read</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Slurps the remaining rows and returns an <a href="Array.html">Array</a> of
Arrays.
</p>
<p>
The data source must be open for reading.
</p>

                </div>
                
                
                <div class="aka">
                    This method is also aliased as
                    
                    <a href="CSV.html#M001961">readlines</a>
                    
                </div>
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001960_source')" id="l_M001960_source">show</a>
                        
                    </p>
                    <div id="M001960_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/csv.rb, line 1804</span>
1804:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">read</span>
1805:     <span class="ruby-identifier">rows</span> = <span class="ruby-identifier">to_a</span>
1806:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@use_headers</span>
1807:       <span class="ruby-constant">Table</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">rows</span>)
1808:     <span class="ruby-keyword kw">else</span>
1809:       <span class="ruby-identifier">rows</span>
1810:     <span class="ruby-keyword kw">end</span>
1811:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001965">
                    
                    <a name="M001965"></a><b>readline</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Alias for <a href="CSV.html#M001963">shift</a>
</p>

                </div>
                
                
                
            </div>
            
            <div class="method">
                <div class="title" id="M001961">
                    
                    <a name="M001961"></a><b>readlines</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Alias for <a href="CSV.html#M001925">read</a>
</p>

                </div>
                
                
                
            </div>
            
            <div class="method">
                <div class="title" id="M001938">
                    
                    <a name="M001938"></a><b>return_headers?</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Returns <tt>true</tt> if headers will be returned as a row of results. See
CSV::new for details.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001938_source')" id="l_M001938_source">show</a>
                        
                    </p>
                    <div id="M001938_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/csv.rb, line 1651</span>
1651:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">return_headers?</span>()     <span class="ruby-ivar">@return_headers</span>     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001947">
                    
                    <a name="M001947"></a><b>rewind</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Rewinds the underlying <a href="IO.html">IO</a> object and resets
CSV&#8217;s lineno() counter.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001947_source')" id="l_M001947_source">show</a>
                        
                    </p>
                    <div id="M001947_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/csv.rb, line 1696</span>
1696:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">rewind</span>
1697:     <span class="ruby-ivar">@headers</span> = <span class="ruby-keyword kw">nil</span>
1698:     <span class="ruby-ivar">@lineno</span>  = <span class="ruby-value">0</span>
1699: 
1700:     <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">rewind</span>
1701:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001963">
                    
                    <a name="M001963"></a><b>shift</b>()
                    
                </div>
                
                <div class="description">
                  <p>
The primary read method for wrapped Strings and IOs, a single row is pulled
from the data source, parsed and returned as an <a
href="Array.html">Array</a> of fields (if header rows are not used) or a <a
href="CSV/Row.html">CSV::Row</a> (when header rows are used).
</p>
<p>
The data source must be open for reading.
</p>

                </div>
                
                
                <div class="aka">
                    This method is also aliased as
                    
                    <a href="CSV.html#M001964">gets</a>
                    
                    <a href="CSV.html#M001965">readline</a>
                    
                </div>
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001963_source')" id="l_M001963_source">show</a>
                        
                    </p>
                    <div id="M001963_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/csv.rb, line 1826</span>
1826:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">shift</span>
1827:     <span class="ruby-comment cmt">#########################################################################</span>
1828:     <span class="ruby-comment cmt">### This method is purposefully kept a bit long as simple conditional ###</span>
1829:     <span class="ruby-comment cmt">### checks are faster than numerous (expensive) method calls.         ###</span>
1830:     <span class="ruby-comment cmt">#########################################################################</span>
1831: 
1832:     <span class="ruby-comment cmt"># handle headers not based on document content</span>
1833:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">header_row?</span> <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@return_headers</span> <span class="ruby-keyword kw">and</span>
1834:        [<span class="ruby-constant">Array</span>, <span class="ruby-constant">String</span>].<span class="ruby-identifier">include?</span> <span class="ruby-ivar">@use_headers</span>.<span class="ruby-identifier">class</span>
1835:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@unconverted_fields</span>
1836:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">add_unconverted_fields</span>(<span class="ruby-identifier">parse_headers</span>, <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>)
1837:       <span class="ruby-keyword kw">else</span>
1838:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">parse_headers</span>
1839:       <span class="ruby-keyword kw">end</span>
1840:     <span class="ruby-keyword kw">end</span>
1841: 
1842:     <span class="ruby-comment cmt">#</span>
1843:     <span class="ruby-comment cmt"># it can take multiple calls to &lt;tt&gt;@io.gets()&lt;/tt&gt; to get a full line,</span>
1844:     <span class="ruby-comment cmt"># because of \r and/or \n characters embedded in quoted fields</span>
1845:     <span class="ruby-comment cmt">#</span>
1846:     <span class="ruby-identifier">in_extended_col</span> = <span class="ruby-keyword kw">false</span>
1847:     <span class="ruby-identifier">csv</span>             = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
1848: 
1849:     <span class="ruby-identifier">loop</span> <span class="ruby-keyword kw">do</span>
1850:       <span class="ruby-comment cmt"># add another read to the line</span>
1851:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">parse</span> = <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">gets</span>(<span class="ruby-ivar">@row_sep</span>)
1852:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span>
1853:       <span class="ruby-keyword kw">end</span>
1854: 
1855:       <span class="ruby-identifier">parse</span>.<span class="ruby-identifier">sub!</span>(<span class="ruby-ivar">@parsers</span>[<span class="ruby-identifier">:line_end</span>], <span class="ruby-value str">&quot;&quot;</span>)
1856: 
1857:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">csv</span>.<span class="ruby-identifier">empty?</span>
1858:         <span class="ruby-comment cmt">#</span>
1859:         <span class="ruby-comment cmt"># I believe a blank line should be an &lt;tt&gt;Array.new&lt;/tt&gt;, not Ruby 1.8</span>
1860:         <span class="ruby-comment cmt"># CSV's &lt;tt&gt;[nil]&lt;/tt&gt;</span>
1861:         <span class="ruby-comment cmt">#</span>
1862:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">parse</span>.<span class="ruby-identifier">empty?</span>
1863:           <span class="ruby-ivar">@lineno</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
1864:           <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@skip_blanks</span>
1865:             <span class="ruby-keyword kw">next</span>
1866:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-ivar">@unconverted_fields</span>
1867:             <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">add_unconverted_fields</span>(<span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>, <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>)
1868:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-ivar">@use_headers</span>
1869:             <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span><span class="ruby-operator">::</span><span class="ruby-constant">Row</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>, <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>)
1870:           <span class="ruby-keyword kw">else</span>
1871:             <span class="ruby-keyword kw">return</span> <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
1872:           <span class="ruby-keyword kw">end</span>
1873:         <span class="ruby-keyword kw">end</span>
1874:       <span class="ruby-keyword kw">end</span>
1875: 
1876:       <span class="ruby-identifier">parts</span> =  <span class="ruby-identifier">parse</span>.<span class="ruby-identifier">split</span>(<span class="ruby-ivar">@col_sep</span>, <span class="ruby-value">-1</span>)
1877:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">parts</span>.<span class="ruby-identifier">empty?</span>
1878:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">in_extended_col</span>
1879:           <span class="ruby-identifier">csv</span>[<span class="ruby-value">-1</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-ivar">@col_sep</span>   <span class="ruby-comment cmt"># will be replaced with a @row_sep after the parts.each loop</span>
1880:         <span class="ruby-keyword kw">else</span>
1881:           <span class="ruby-identifier">csv</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-keyword kw">nil</span>
1882:         <span class="ruby-keyword kw">end</span>
1883:       <span class="ruby-keyword kw">end</span>
1884: 
1885:       <span class="ruby-comment cmt"># This loop is the hot path of csv parsing. Some things may be non-dry</span>
1886:       <span class="ruby-comment cmt"># for a reason. Make sure to benchmark when refactoring.</span>
1887:       <span class="ruby-identifier">parts</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">part</span><span class="ruby-operator">|</span>
1888:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">in_extended_col</span>
1889:           <span class="ruby-comment cmt"># If we are continuing a previous column</span>
1890:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">part</span>[<span class="ruby-value">-1</span>] <span class="ruby-operator">==</span> <span class="ruby-ivar">@quote_char</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">part</span>.<span class="ruby-identifier">count</span>(<span class="ruby-ivar">@quote_char</span>) <span class="ruby-operator">%</span> <span class="ruby-value">2</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
1891:             <span class="ruby-comment cmt"># extended column ends</span>
1892:             <span class="ruby-identifier">csv</span>.<span class="ruby-identifier">last</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">part</span>[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">-2</span>]
1893:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">csv</span>.<span class="ruby-identifier">last</span> <span class="ruby-operator">=~</span> <span class="ruby-ivar">@parsers</span>[<span class="ruby-identifier">:stray_quote</span>]
1894:               <span class="ruby-identifier">raise</span> <span class="ruby-constant">MalformedCSVError</span>,
1895:                     <span class="ruby-node">&quot;Missing or stray quote in line #{lineno + 1}&quot;</span>
1896:             <span class="ruby-keyword kw">end</span>
1897:             <span class="ruby-identifier">csv</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-ivar">@quote_char</span> <span class="ruby-operator">*</span> <span class="ruby-value">2</span>, <span class="ruby-ivar">@quote_char</span>)
1898:             <span class="ruby-identifier">in_extended_col</span> = <span class="ruby-keyword kw">false</span>
1899:           <span class="ruby-keyword kw">else</span>
1900:             <span class="ruby-identifier">csv</span>.<span class="ruby-identifier">last</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">part</span>
1901:             <span class="ruby-identifier">csv</span>.<span class="ruby-identifier">last</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-ivar">@col_sep</span>
1902:           <span class="ruby-keyword kw">end</span>
1903:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">part</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-ivar">@quote_char</span>
1904:           <span class="ruby-comment cmt"># If we are staring a new quoted column</span>
1905:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">part</span>[<span class="ruby-value">-1</span>] <span class="ruby-operator">!=</span> <span class="ruby-ivar">@quote_char</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">part</span>.<span class="ruby-identifier">count</span>(<span class="ruby-ivar">@quote_char</span>) <span class="ruby-operator">%</span> <span class="ruby-value">2</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
1906:             <span class="ruby-comment cmt"># start an extended column</span>
1907:             <span class="ruby-identifier">csv</span>             <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">part</span>[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>]
1908:             <span class="ruby-identifier">csv</span>.<span class="ruby-identifier">last</span>        <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-ivar">@col_sep</span>
1909:             <span class="ruby-identifier">in_extended_col</span> =  <span class="ruby-keyword kw">true</span>
1910:           <span class="ruby-keyword kw">else</span>
1911:             <span class="ruby-comment cmt"># regular quoted column</span>
1912:             <span class="ruby-identifier">csv</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">part</span>[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">-2</span>]
1913:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">csv</span>.<span class="ruby-identifier">last</span> <span class="ruby-operator">=~</span> <span class="ruby-ivar">@parsers</span>[<span class="ruby-identifier">:stray_quote</span>]
1914:               <span class="ruby-identifier">raise</span> <span class="ruby-constant">MalformedCSVError</span>,
1915:                     <span class="ruby-node">&quot;Missing or stray quote in line #{lineno + 1}&quot;</span>
1916:             <span class="ruby-keyword kw">end</span>
1917:             <span class="ruby-identifier">csv</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-ivar">@quote_char</span> <span class="ruby-operator">*</span> <span class="ruby-value">2</span>, <span class="ruby-ivar">@quote_char</span>)
1918:           <span class="ruby-keyword kw">end</span>
1919:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">part</span> <span class="ruby-operator">=~</span> <span class="ruby-ivar">@parsers</span>[<span class="ruby-identifier">:quote_or_nl</span>]
1920:           <span class="ruby-comment cmt"># Unquoted field with bad characters.</span>
1921:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">part</span> <span class="ruby-operator">=~</span> <span class="ruby-ivar">@parsers</span>[<span class="ruby-identifier">:nl_or_lf</span>]
1922:             <span class="ruby-identifier">raise</span> <span class="ruby-constant">MalformedCSVError</span>, <span class="ruby-value str">&quot;Unquoted fields do not allow &quot;</span> <span class="ruby-operator">+</span>
1923:                                      <span class="ruby-node">&quot;\\r or \\n (line #{lineno + 1}).&quot;</span>
1924:           <span class="ruby-keyword kw">else</span>
1925:             <span class="ruby-identifier">raise</span> <span class="ruby-constant">MalformedCSVError</span>, <span class="ruby-node">&quot;Illegal quoting in line #{lineno + 1}.&quot;</span>
1926:           <span class="ruby-keyword kw">end</span>
1927:         <span class="ruby-keyword kw">else</span>
1928:           <span class="ruby-comment cmt"># Regular ole unquoted field.</span>
1929:           <span class="ruby-identifier">csv</span> <span class="ruby-operator">&lt;&lt;</span> (<span class="ruby-identifier">part</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-value">? </span><span class="ruby-keyword kw">nil</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">part</span>)
1930:         <span class="ruby-keyword kw">end</span>
1931:       <span class="ruby-keyword kw">end</span>
1932: 
1933:       <span class="ruby-comment cmt"># Replace tacked on @col_sep with @row_sep if we are still in an extended</span>
1934:       <span class="ruby-comment cmt"># column.</span>
1935:       <span class="ruby-identifier">csv</span>[<span class="ruby-value">-1</span>][<span class="ruby-value">-1</span>] = <span class="ruby-ivar">@row_sep</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">in_extended_col</span>
1936: 
1937:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">in_extended_col</span>
1938:         <span class="ruby-comment cmt"># if we're at eof?(), a quoted field wasn't closed...</span>
1939:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">eof?</span>
1940:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">MalformedCSVError</span>,
1941:                 <span class="ruby-node">&quot;Unclosed quoted field on line #{lineno + 1}.&quot;</span>
1942:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-ivar">@field_size_limit</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">csv</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-ivar">@field_size_limit</span>
1943:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">MalformedCSVError</span>, <span class="ruby-node">&quot;Field size exceeded on line #{lineno + 1}.&quot;</span>
1944:         <span class="ruby-keyword kw">end</span>
1945:         <span class="ruby-comment cmt"># otherwise, we need to loop and pull some more data to complete the row</span>
1946:       <span class="ruby-keyword kw">else</span>
1947:         <span class="ruby-ivar">@lineno</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
1948: 
1949:         <span class="ruby-comment cmt"># save fields unconverted fields, if needed...</span>
1950:         <span class="ruby-identifier">unconverted</span> = <span class="ruby-identifier">csv</span>.<span class="ruby-identifier">dup</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@unconverted_fields</span>
1951: 
1952:         <span class="ruby-comment cmt"># convert fields, if needed...</span>
1953:         <span class="ruby-identifier">csv</span> = <span class="ruby-identifier">convert_fields</span>(<span class="ruby-identifier">csv</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@use_headers</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@converters</span>.<span class="ruby-identifier">empty?</span>
1954:         <span class="ruby-comment cmt"># parse out header rows and handle CSV::Row conversions...</span>
1955:         <span class="ruby-identifier">csv</span> = <span class="ruby-identifier">parse_headers</span>(<span class="ruby-identifier">csv</span>)  <span class="ruby-keyword kw">if</span>     <span class="ruby-ivar">@use_headers</span>
1956: 
1957:         <span class="ruby-comment cmt"># inject unconverted fields and accessor, if requested...</span>
1958:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@unconverted_fields</span> <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">not</span> <span class="ruby-identifier">csv</span>.<span class="ruby-identifier">respond_to?</span> <span class="ruby-identifier">:unconverted_fields</span>
1959:           <span class="ruby-identifier">add_unconverted_fields</span>(<span class="ruby-identifier">csv</span>, <span class="ruby-identifier">unconverted</span>)
1960:         <span class="ruby-keyword kw">end</span>
1961: 
1962:         <span class="ruby-comment cmt"># return the results</span>
1963:         <span class="ruby-keyword kw">break</span> <span class="ruby-identifier">csv</span>
1964:       <span class="ruby-keyword kw">end</span>
1965:     <span class="ruby-keyword kw">end</span>
1966:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001942">
                    
                    <a name="M001942"></a><b>skip_blanks?</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Returns <tt>true</tt> blank lines are skipped by the parser. See CSV::new
for details.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001942_source')" id="l_M001942_source">show</a>
                        
                    </p>
                    <div id="M001942_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/csv.rb, line 1669</span>
1669:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">skip_blanks?</span>()        <span class="ruby-ivar">@skip_blanks</span>        <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001936">
                    
                    <a name="M001936"></a><b>unconverted_fields?</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Returns <tt>true</tt> if unconverted_fields() to parsed results. See
CSV::new for details.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001936_source')" id="l_M001936_source">show</a>
                        
                    </p>
                    <div id="M001936_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/csv.rb, line 1638</span>
1638:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">unconverted_fields?</span>() <span class="ruby-ivar">@unconverted_fields</span> <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001939">
                    
                    <a name="M001939"></a><b>write_headers?</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Returns <tt>true</tt> if headers are written in output. See CSV::new for
details.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001939_source')" id="l_M001939_source">show</a>
                        
                    </p>
                    <div id="M001939_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/csv.rb, line 1653</span>
1653:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">write_headers?</span>()      <span class="ruby-ivar">@write_headers</span>      <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Private methods</div>
            
            <div class="method">
                <div class="title" id="M001971">
                    
                    <a name="M001971"></a><b>add_converter</b>(var_name, const, name = nil, &amp;converter)
                    
                </div>
                
                <div class="description">
                  <p>
The actual work method for adding converters, used by both <a
href="CSV.html#M001956">CSV.convert()</a> and <a
href="CSV.html#M001958">CSV.header_convert()</a>.
</p>
<p>
This method requires the <tt>var_name</tt> of the instance variable to
place the converters in, the <tt>const</tt> <a href="Hash.html">Hash</a> to
lookup named converters in, and the normal parameters of the <a
href="CSV.html#M001956">CSV.convert()</a> and <a
href="CSV.html#M001958">CSV.header_convert()</a> methods.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001971_source')" id="l_M001971_source">show</a>
                        
                    </p>
                    <div id="M001971_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/csv.rb, line 2200</span>
2200:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_converter</span>(<span class="ruby-identifier">var_name</span>, <span class="ruby-identifier">const</span>, <span class="ruby-identifier">name</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">converter</span>)
2201:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">name</span>.<span class="ruby-identifier">nil?</span>  <span class="ruby-comment cmt"># custom converter</span>
2202:       <span class="ruby-identifier">instance_variable_get</span>(<span class="ruby-node">&quot;@#{var_name}&quot;</span>) <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">converter</span>
2203:     <span class="ruby-keyword kw">else</span>          <span class="ruby-comment cmt"># named converter</span>
2204:       <span class="ruby-identifier">combo</span> = <span class="ruby-identifier">const</span>[<span class="ruby-identifier">name</span>]
2205:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">combo</span>
2206:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Array</span>  <span class="ruby-comment cmt"># combo converter</span>
2207:         <span class="ruby-identifier">combo</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">converter_name</span><span class="ruby-operator">|</span>
2208:           <span class="ruby-identifier">add_converter</span>(<span class="ruby-identifier">var_name</span>, <span class="ruby-identifier">const</span>, <span class="ruby-identifier">converter_name</span>)
2209:         <span class="ruby-keyword kw">end</span>
2210:       <span class="ruby-keyword kw">else</span>        <span class="ruby-comment cmt"># individual named converter</span>
2211:         <span class="ruby-identifier">instance_variable_get</span>(<span class="ruby-node">&quot;@#{var_name}&quot;</span>) <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">combo</span>
2212:       <span class="ruby-keyword kw">end</span>
2213:     <span class="ruby-keyword kw">end</span>
2214:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001974">
                    
                    <a name="M001974"></a><b>add_unconverted_fields</b>(row, fields)
                    
                </div>
                
                <div class="description">
                  <p>
This method injects an instance variable <tt>unconverted_fields</tt> into
<tt>row</tt> and an accessor method for <tt>row</tt> called
unconverted_fields(). The variable is set to the contents of
<tt>fields</tt>.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001974_source')" id="l_M001974_source">show</a>
                        
                    </p>
                    <div id="M001974_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/csv.rb, line 2285</span>
2285:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_unconverted_fields</span>(<span class="ruby-identifier">row</span>, <span class="ruby-identifier">fields</span>)
2286:     <span class="ruby-keyword kw">class</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">row</span>
2287:       <span class="ruby-identifier">attr_reader</span> <span class="ruby-identifier">:unconverted_fields</span>
2288:     <span class="ruby-keyword kw">end</span>
2289:     <span class="ruby-identifier">row</span>.<span class="ruby-identifier">instance_eval</span> { <span class="ruby-ivar">@unconverted_fields</span> = <span class="ruby-identifier">fields</span> }
2290:     <span class="ruby-identifier">row</span>
2291:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001972">
                    
                    <a name="M001972"></a><b>convert_fields</b>(fields, headers = false)
                    
                </div>
                
                <div class="description">
                  <p>
Processes <tt>fields</tt> with <tt>@converters</tt>, or <tt>@<a
href="CSV.html#M001941">header_converters</a></tt> if <tt>headers</tt> is
passed as <tt>true</tt>, returning the converted field set. Any converter
that changes the field into something other than a <a
href="String.html">String</a> halts the pipeline of conversion for that
field. This is primarily an efficiency shortcut.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001972_source')" id="l_M001972_source">show</a>
                        
                    </p>
                    <div id="M001972_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/csv.rb, line 2223</span>
2223:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">convert_fields</span>(<span class="ruby-identifier">fields</span>, <span class="ruby-identifier">headers</span> = <span class="ruby-keyword kw">false</span>)
2224:     <span class="ruby-comment cmt"># see if we are converting headers or fields</span>
2225:     <span class="ruby-identifier">converters</span> = <span class="ruby-identifier">headers</span> <span class="ruby-value">? </span><span class="ruby-ivar">@header_converters</span> <span class="ruby-operator">:</span> <span class="ruby-ivar">@converters</span>
2226: 
2227:     <span class="ruby-identifier">fields</span>.<span class="ruby-identifier">map</span>.<span class="ruby-identifier">with_index</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">field</span>, <span class="ruby-identifier">index</span><span class="ruby-operator">|</span>
2228:       <span class="ruby-identifier">converters</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">converter</span><span class="ruby-operator">|</span>
2229:         <span class="ruby-identifier">field</span> = <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">converter</span>.<span class="ruby-identifier">arity</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span>  <span class="ruby-comment cmt"># straight field converter</span>
2230:           <span class="ruby-identifier">converter</span>[<span class="ruby-identifier">field</span>]
2231:         <span class="ruby-keyword kw">else</span>                             <span class="ruby-comment cmt"># FieldInfo converter</span>
2232:           <span class="ruby-identifier">header</span> = <span class="ruby-ivar">@use_headers</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">headers</span> <span class="ruby-value">? </span><span class="ruby-ivar">@headers</span>[<span class="ruby-identifier">index</span>] <span class="ruby-operator">:</span> <span class="ruby-keyword kw">nil</span>
2233:           <span class="ruby-identifier">converter</span>[<span class="ruby-identifier">field</span>, <span class="ruby-constant">FieldInfo</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">index</span>, <span class="ruby-identifier">lineno</span>, <span class="ruby-identifier">header</span>)]
2234:         <span class="ruby-keyword kw">end</span>
2235:         <span class="ruby-keyword kw">break</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">field</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">String</span>  <span class="ruby-comment cmt"># short-curcuit pipeline for speed</span>
2236:       <span class="ruby-keyword kw">end</span>
2237:       <span class="ruby-identifier">field</span>  <span class="ruby-comment cmt"># final state of each field, converted or original</span>
2238:     <span class="ruby-keyword kw">end</span>
2239:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001976">
                    
                    <a name="M001976"></a><b>encode_re</b>(*chunks)
                    
                </div>
                
                <div class="description">
                  <p>
Builds a regular expression in <tt>@encoding</tt>. All <tt>chunks</tt> will
be transcoded to that encoding.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001976_source')" id="l_M001976_source">show</a>
                        
                    </p>
                    <div id="M001976_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/csv.rb, line 2308</span>
2308:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">encode_re</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">chunks</span>)
2309:     <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">encode_str</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">chunks</span>))
2310:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001977">
                    
                    <a name="M001977"></a><b>encode_str</b>(*chunks)
                    
                </div>
                
                <div class="description">
                  <p>
Builds a <a href="String.html">String</a> in <tt>@encoding</tt>. All
<tt>chunks</tt> will be transcoded to that encoding.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001977_source')" id="l_M001977_source">show</a>
                        
                    </p>
                    <div id="M001977_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/csv.rb, line 2316</span>
2316:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">encode_str</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">chunks</span>)
2317:     <span class="ruby-identifier">chunks</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">chunk</span><span class="ruby-operator">|</span> <span class="ruby-identifier">chunk</span>.<span class="ruby-identifier">encode</span>(<span class="ruby-ivar">@encoding</span>.<span class="ruby-identifier">name</span>) }.<span class="ruby-identifier">join</span>(<span class="ruby-value str">''</span>)
2318:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001975">
                    
                    <a name="M001975"></a><b>escape_re</b>(str)
                    
                </div>
                
                <div class="description">
                  <p>
This method is an encoding safe version of Regexp::escape(). It will escape
any characters that would change the meaning of a regular expression in the
encoding of <tt>str</tt>. Regular expression characters that cannot be
transcoded to the target encoding will be skipped and no escaping will be
performed if a backslash cannot be transcoded.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001975_source')" id="l_M001975_source">show</a>
                        
                    </p>
                    <div id="M001975_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/csv.rb, line 2300</span>
2300:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">escape_re</span>(<span class="ruby-identifier">str</span>)
2301:     <span class="ruby-identifier">str</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-ivar">@re_chars</span>) {<span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-ivar">@re_esc</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">c</span>}
2302:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001969">
                    
                    <a name="M001969"></a><b>init_converters</b>(options, field_name = :converters)
                    
                </div>
                
                <div class="description">
                  <p>
Loads any converters requested during construction.
</p>
<p>
If <tt>field_name</tt> is set <tt>:converters</tt> (the default) field
converters are set. When <tt>field_name</tt> is <tt>:<a
href="CSV.html#M001941">header_converters</a></tt> header converters are
added instead.
</p>
<p>
The <tt>:unconverted_fields</tt> option is also actived for
<tt>:converters</tt> calls, if requested.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001969_source')" id="l_M001969_source">show</a>
                        
                    </p>
                    <div id="M001969_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/csv.rb, line 2151</span>
2151:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">init_converters</span>(<span class="ruby-identifier">options</span>, <span class="ruby-identifier">field_name</span> = <span class="ruby-identifier">:converters</span>)
2152:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">field_name</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:converters</span>
2153:       <span class="ruby-ivar">@unconverted_fields</span> = <span class="ruby-identifier">options</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:unconverted_fields</span>)
2154:     <span class="ruby-keyword kw">end</span>
2155: 
2156:     <span class="ruby-identifier">instance_variable_set</span>(<span class="ruby-node">&quot;@#{field_name}&quot;</span>, <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>)
2157: 
2158:     <span class="ruby-comment cmt"># find the correct method to add the converters</span>
2159:     <span class="ruby-identifier">convert</span> = <span class="ruby-identifier">method</span>(<span class="ruby-identifier">field_name</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">sub</span>(<span class="ruby-regexp re">/ers\Z/</span>, <span class="ruby-value str">&quot;&quot;</span>))
2160: 
2161:     <span class="ruby-comment cmt"># load converters</span>
2162:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">field_name</span>].<span class="ruby-identifier">nil?</span>
2163:       <span class="ruby-comment cmt"># allow a single converter not wrapped in an Array</span>
2164:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">field_name</span>].<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">Array</span>
2165:         <span class="ruby-identifier">options</span>[<span class="ruby-identifier">field_name</span>] = [<span class="ruby-identifier">options</span>[<span class="ruby-identifier">field_name</span>]]
2166:       <span class="ruby-keyword kw">end</span>
2167:       <span class="ruby-comment cmt"># load each converter...</span>
2168:       <span class="ruby-identifier">options</span>[<span class="ruby-identifier">field_name</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">converter</span><span class="ruby-operator">|</span>
2169:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">converter</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">Proc</span>  <span class="ruby-comment cmt"># custom code block</span>
2170:           <span class="ruby-identifier">convert</span>.<span class="ruby-identifier">call</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">converter</span>)
2171:         <span class="ruby-keyword kw">else</span>                     <span class="ruby-comment cmt"># by name</span>
2172:           <span class="ruby-identifier">convert</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">converter</span>)
2173:         <span class="ruby-keyword kw">end</span>
2174:       <span class="ruby-keyword kw">end</span>
2175:     <span class="ruby-keyword kw">end</span>
2176: 
2177:     <span class="ruby-identifier">options</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">field_name</span>)
2178:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001970">
                    
                    <a name="M001970"></a><b>init_headers</b>(options)
                    
                </div>
                
                <div class="description">
                  <p>
Stores header row settings and loads header converters, if needed.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001970_source')" id="l_M001970_source">show</a>
                        
                    </p>
                    <div id="M001970_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/csv.rb, line 2181</span>
2181:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">init_headers</span>(<span class="ruby-identifier">options</span>)
2182:     <span class="ruby-ivar">@use_headers</span>    = <span class="ruby-identifier">options</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:headers</span>)
2183:     <span class="ruby-ivar">@return_headers</span> = <span class="ruby-identifier">options</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:return_headers</span>)
2184:     <span class="ruby-ivar">@write_headers</span>  = <span class="ruby-identifier">options</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:write_headers</span>)
2185: 
2186:     <span class="ruby-comment cmt"># headers must be delayed until shift(), in case they need a row of content</span>
2187:     <span class="ruby-ivar">@headers</span> = <span class="ruby-keyword kw">nil</span>
2188: 
2189:     <span class="ruby-identifier">init_converters</span>(<span class="ruby-identifier">options</span>, <span class="ruby-identifier">:header_converters</span>)
2190:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001968">
                    
                    <a name="M001968"></a><b>init_parsers</b>(options)
                    
                </div>
                
                <div class="description">
                  <p>
Pre-compiles parsers and stores them by name for access during reads.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001968_source')" id="l_M001968_source">show</a>
                        
                    </p>
                    <div id="M001968_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/csv.rb, line 2120</span>
2120:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">init_parsers</span>(<span class="ruby-identifier">options</span>)
2121:     <span class="ruby-comment cmt"># store the parser behaviors</span>
2122:     <span class="ruby-ivar">@skip_blanks</span>      = <span class="ruby-identifier">options</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:skip_blanks</span>)
2123:     <span class="ruby-ivar">@field_size_limit</span> = <span class="ruby-identifier">options</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:field_size_limit</span>)
2124: 
2125:     <span class="ruby-comment cmt"># prebuild Regexps for faster parsing</span>
2126:     <span class="ruby-identifier">esc_row_sep</span> = <span class="ruby-identifier">escape_re</span>(<span class="ruby-ivar">@row_sep</span>)
2127:     <span class="ruby-identifier">esc_quote</span>   = <span class="ruby-identifier">escape_re</span>(<span class="ruby-ivar">@quote_char</span>)
2128:     <span class="ruby-ivar">@parsers</span> = {
2129:       <span class="ruby-comment cmt"># for detecting parse errors</span>
2130:       <span class="ruby-identifier">quote_or_nl</span><span class="ruby-operator">:</span>    <span class="ruby-identifier">encode_re</span>(<span class="ruby-value str">&quot;[&quot;</span>, <span class="ruby-identifier">esc_quote</span>, <span class="ruby-value str">&quot;\r\n]&quot;</span>),
2131:       <span class="ruby-identifier">nl_or_lf</span><span class="ruby-operator">:</span>       <span class="ruby-identifier">encode_re</span>(<span class="ruby-value str">&quot;[\r\n]&quot;</span>),
2132:       <span class="ruby-identifier">stray_quote</span><span class="ruby-operator">:</span>    <span class="ruby-identifier">encode_re</span>( <span class="ruby-value str">&quot;[^&quot;</span>, <span class="ruby-identifier">esc_quote</span>, <span class="ruby-value str">&quot;]&quot;</span>, <span class="ruby-identifier">esc_quote</span>,
2133:                                  <span class="ruby-value str">&quot;[^&quot;</span>, <span class="ruby-identifier">esc_quote</span>, <span class="ruby-value str">&quot;]&quot;</span> ),
2134:       <span class="ruby-comment cmt"># safer than chomp!()</span>
2135:       <span class="ruby-identifier">line_end</span><span class="ruby-operator">:</span>       <span class="ruby-identifier">encode_re</span>(<span class="ruby-identifier">esc_row_sep</span>, <span class="ruby-value str">&quot;\\z&quot;</span>),
2136:       <span class="ruby-comment cmt"># illegal unquoted characters</span>
2137:       <span class="ruby-identifier">return_newline</span><span class="ruby-operator">:</span> <span class="ruby-identifier">encode_str</span>(<span class="ruby-value str">&quot;\r\n&quot;</span>)
2138:     }
2139:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001967">
                    
                    <a name="M001967"></a><b>init_separators</b>(options)
                    
                </div>
                
                <div class="description">
                  <p>
Stores the indicated separators for later use.
</p>
<p>
If auto-discovery was requested for <tt>@<a
href="CSV.html#row_sep">row_sep</a></tt>, this method will read ahead in
the <tt>@io</tt> and try to find one. <tt>ARGF</tt>, <tt>STDIN</tt>,
<tt>STDOUT</tt>, <tt>STDERR</tt> and any stream open for output only with a
default <tt>@<a href="CSV.html#row_sep">row_sep</a></tt> of
<tt>$INPUT_RECORD_SEPARATOR</tt> (<tt>$/</tt>).
</p>
<p>
This method also establishes the quoting rules used for <a
href="CSV.html">CSV</a> output.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001967_source')" id="l_M001967_source">show</a>
                        
                    </p>
                    <div id="M001967_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/csv.rb, line 2021</span>
2021:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">init_separators</span>(<span class="ruby-identifier">options</span>)
2022:     <span class="ruby-comment cmt"># store the selected separators</span>
2023:     <span class="ruby-ivar">@col_sep</span>    = <span class="ruby-identifier">options</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:col_sep</span>).<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">encode</span>(<span class="ruby-ivar">@encoding</span>)
2024:     <span class="ruby-ivar">@row_sep</span>    = <span class="ruby-identifier">options</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:row_sep</span>)  <span class="ruby-comment cmt"># encode after resolving :auto</span>
2025:     <span class="ruby-ivar">@quote_char</span> = <span class="ruby-identifier">options</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:quote_char</span>).<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">encode</span>(<span class="ruby-ivar">@encoding</span>)
2026: 
2027:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@quote_char</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">!=</span> <span class="ruby-value">1</span>
2028:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-value str">&quot;:quote_char has to be a single character String&quot;</span>
2029:     <span class="ruby-keyword kw">end</span>
2030: 
2031:     <span class="ruby-comment cmt">#</span>
2032:     <span class="ruby-comment cmt"># automatically discover row separator when requested</span>
2033:     <span class="ruby-comment cmt"># (not fully encoding safe)</span>
2034:     <span class="ruby-comment cmt">#</span>
2035:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@row_sep</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:auto</span>
2036:       <span class="ruby-keyword kw">if</span> [<span class="ruby-constant">ARGF</span>, <span class="ruby-constant">STDIN</span>, <span class="ruby-constant">STDOUT</span>, <span class="ruby-constant">STDERR</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-ivar">@io</span>) <span class="ruby-keyword kw">or</span>
2037:          (<span class="ruby-keyword kw">defined?</span>(<span class="ruby-constant">Zlib</span>) <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">class</span> <span class="ruby-operator">==</span> <span class="ruby-constant">Zlib</span><span class="ruby-operator">::</span><span class="ruby-constant">GzipWriter</span>)
2038:         <span class="ruby-ivar">@row_sep</span> = <span class="ruby-identifier">$INPUT_RECORD_SEPARATOR</span>
2039:       <span class="ruby-keyword kw">else</span>
2040:         <span class="ruby-keyword kw">begin</span>
2041:           <span class="ruby-comment cmt">#</span>
2042:           <span class="ruby-comment cmt"># remember where we were (pos() will raise an axception if @io is pipe</span>
2043:           <span class="ruby-comment cmt"># or not opened for reading)</span>
2044:           <span class="ruby-comment cmt">#</span>
2045:           <span class="ruby-identifier">saved_pos</span> = <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">pos</span>
2046:           <span class="ruby-keyword kw">while</span> <span class="ruby-ivar">@row_sep</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:auto</span>
2047:             <span class="ruby-comment cmt">#</span>
2048:             <span class="ruby-comment cmt"># if we run out of data, it's probably a single line</span>
2049:             <span class="ruby-comment cmt"># (ensure will set default value)</span>
2050:             <span class="ruby-comment cmt">#</span>
2051:             <span class="ruby-keyword kw">break</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">sample</span> = <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">gets</span>(<span class="ruby-keyword kw">nil</span>, <span class="ruby-value">1024</span>)
2052:             <span class="ruby-comment cmt"># extend sample if we're unsure of the line ending</span>
2053:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">sample</span>.<span class="ruby-identifier">end_with?</span> <span class="ruby-identifier">encode_str</span>(<span class="ruby-value str">&quot;\r&quot;</span>)
2054:               <span class="ruby-identifier">sample</span> <span class="ruby-operator">&lt;&lt;</span> (<span class="ruby-ivar">@io</span>.<span class="ruby-identifier">gets</span>(<span class="ruby-keyword kw">nil</span>, <span class="ruby-value">1</span>) <span class="ruby-operator">||</span> <span class="ruby-value str">&quot;&quot;</span>)
2055:             <span class="ruby-keyword kw">end</span>
2056: 
2057:             <span class="ruby-comment cmt"># try to find a standard separator</span>
2058:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">sample</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">encode_re</span>(<span class="ruby-value str">&quot;\r\n?|\n&quot;</span>)
2059:               <span class="ruby-ivar">@row_sep</span> = <span class="ruby-identifier">$&amp;</span>
2060:               <span class="ruby-keyword kw">break</span>
2061:             <span class="ruby-keyword kw">end</span>
2062:           <span class="ruby-keyword kw">end</span>
2063: 
2064:           <span class="ruby-comment cmt"># tricky seek() clone to work around GzipReader's lack of seek()</span>
2065:           <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">rewind</span>
2066:           <span class="ruby-comment cmt"># reset back to the remembered position</span>
2067:           <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">saved_pos</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1024</span>  <span class="ruby-comment cmt"># avoid loading a lot of data into memory</span>
2068:             <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">read</span>(<span class="ruby-value">1024</span>)
2069:             <span class="ruby-identifier">saved_pos</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1024</span>
2070:           <span class="ruby-keyword kw">end</span>
2071:           <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">read</span>(<span class="ruby-identifier">saved_pos</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">saved_pos</span>.<span class="ruby-identifier">nonzero?</span>
2072:         <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">IOError</span>         <span class="ruby-comment cmt"># not opened for reading</span>
2073:           <span class="ruby-comment cmt"># do nothing:  ensure will set default</span>
2074:         <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">NoMethodError</span>   <span class="ruby-comment cmt"># Zlib::GzipWriter doesn't have some IO methods</span>
2075:           <span class="ruby-comment cmt"># do nothing:  ensure will set default</span>
2076:         <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">SystemCallError</span> <span class="ruby-comment cmt"># pipe</span>
2077:           <span class="ruby-comment cmt"># do nothing:  ensure will set default</span>
2078:         <span class="ruby-keyword kw">ensure</span>
2079:           <span class="ruby-comment cmt">#</span>
2080:           <span class="ruby-comment cmt"># set default if we failed to detect</span>
2081:           <span class="ruby-comment cmt"># (stream not opened for reading, a pipe, or a single line of data)</span>
2082:           <span class="ruby-comment cmt">#</span>
2083:           <span class="ruby-ivar">@row_sep</span> = <span class="ruby-identifier">$INPUT_RECORD_SEPARATOR</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@row_sep</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:auto</span>
2084:         <span class="ruby-keyword kw">end</span>
2085:       <span class="ruby-keyword kw">end</span>
2086:     <span class="ruby-keyword kw">end</span>
2087:     <span class="ruby-ivar">@row_sep</span> = <span class="ruby-ivar">@row_sep</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">encode</span>(<span class="ruby-ivar">@encoding</span>)
2088: 
2089:     <span class="ruby-comment cmt"># establish quoting rules</span>
2090:     <span class="ruby-ivar">@force_quotes</span>   = <span class="ruby-identifier">options</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:force_quotes</span>)
2091:     <span class="ruby-identifier">do_quote</span>        = <span class="ruby-identifier">lambda</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">field</span><span class="ruby-operator">|</span>
2092:       <span class="ruby-identifier">field</span>         = <span class="ruby-constant">String</span>(<span class="ruby-identifier">field</span>)
2093:       <span class="ruby-identifier">encoded_quote</span> = <span class="ruby-ivar">@quote_char</span>.<span class="ruby-identifier">encode</span>(<span class="ruby-identifier">field</span>.<span class="ruby-identifier">encoding</span>)
2094:       <span class="ruby-identifier">encoded_quote</span>                                <span class="ruby-operator">+</span>
2095:       <span class="ruby-identifier">field</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-identifier">encoded_quote</span>, <span class="ruby-identifier">encoded_quote</span> <span class="ruby-operator">*</span> <span class="ruby-value">2</span>) <span class="ruby-operator">+</span>
2096:       <span class="ruby-identifier">encoded_quote</span>
2097:     <span class="ruby-keyword kw">end</span>
2098:     <span class="ruby-identifier">quotable_chars</span> = <span class="ruby-identifier">encode_str</span>(<span class="ruby-value str">&quot;\r\n&quot;</span>, <span class="ruby-ivar">@col_sep</span>, <span class="ruby-ivar">@quote_char</span>)
2099:     <span class="ruby-ivar">@quote</span>         = <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@force_quotes</span>
2100:       <span class="ruby-identifier">do_quote</span>
2101:     <span class="ruby-keyword kw">else</span>
2102:       <span class="ruby-identifier">lambda</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">field</span><span class="ruby-operator">|</span>
2103:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">field</span>.<span class="ruby-identifier">nil?</span>  <span class="ruby-comment cmt"># represent +nil+ fields as empty unquoted fields</span>
2104:           <span class="ruby-value str">&quot;&quot;</span>
2105:         <span class="ruby-keyword kw">else</span>
2106:           <span class="ruby-identifier">field</span> = <span class="ruby-constant">String</span>(<span class="ruby-identifier">field</span>)  <span class="ruby-comment cmt"># Stringify fields</span>
2107:           <span class="ruby-comment cmt"># represent empty fields as empty quoted fields</span>
2108:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">field</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-keyword kw">or</span>
2109:              <span class="ruby-identifier">field</span>.<span class="ruby-identifier">count</span>(<span class="ruby-identifier">quotable_chars</span>).<span class="ruby-identifier">nonzero?</span>
2110:             <span class="ruby-identifier">do_quote</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">field</span>)
2111:           <span class="ruby-keyword kw">else</span>
2112:             <span class="ruby-identifier">field</span>  <span class="ruby-comment cmt"># unquoted field</span>
2113:           <span class="ruby-keyword kw">end</span>
2114:         <span class="ruby-keyword kw">end</span>
2115:       <span class="ruby-keyword kw">end</span>
2116:     <span class="ruby-keyword kw">end</span>
2117:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001973">
                    
                    <a name="M001973"></a><b>parse_headers</b>(row = nil)
                    
                </div>
                
                <div class="description">
                  <p>
This method is used to turn a finished <tt>row</tt> into a <a
href="CSV/Row.html">CSV::Row</a>. Header rows are also dealt with here,
either by returning a <a href="CSV/Row.html">CSV::Row</a> with identical
headers and fields (save that the fields do not go through the converters)
or by reading past them to return a field row. Headers are also saved in
<tt>@headers</tt> for use in future rows.
</p>
<p>
When <tt>nil</tt>, <tt>row</tt> is assumed to be a header row not based on
an actual row of the stream.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001973_source')" id="l_M001973_source">show</a>
                        
                    </p>
                    <div id="M001973_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/csv.rb, line 2251</span>
2251:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">parse_headers</span>(<span class="ruby-identifier">row</span> = <span class="ruby-keyword kw">nil</span>)
2252:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@headers</span>.<span class="ruby-identifier">nil?</span>                <span class="ruby-comment cmt"># header row</span>
2253:       <span class="ruby-ivar">@headers</span> = <span class="ruby-keyword kw">case</span> <span class="ruby-ivar">@use_headers</span>  <span class="ruby-comment cmt"># save headers</span>
2254:                  <span class="ruby-comment cmt"># Array of headers</span>
2255:                  <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Array</span> <span class="ruby-keyword kw">then</span> <span class="ruby-ivar">@use_headers</span>
2256:                  <span class="ruby-comment cmt"># CSV header String</span>
2257:                  <span class="ruby-keyword kw">when</span> <span class="ruby-constant">String</span>
2258:                    <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">parse_line</span>( <span class="ruby-ivar">@use_headers</span>,
2259:                                           <span class="ruby-identifier">col_sep</span><span class="ruby-operator">:</span>    <span class="ruby-ivar">@col_sep</span>,
2260:                                           <span class="ruby-identifier">row_sep</span><span class="ruby-operator">:</span>    <span class="ruby-ivar">@row_sep</span>,
2261:                                           <span class="ruby-identifier">quote_char</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@quote_char</span> )
2262:                  <span class="ruby-comment cmt"># first row is headers</span>
2263:                  <span class="ruby-keyword kw">else</span>            <span class="ruby-identifier">row</span>
2264:                  <span class="ruby-keyword kw">end</span>
2265: 
2266:       <span class="ruby-comment cmt"># prepare converted and unconverted copies</span>
2267:       <span class="ruby-identifier">row</span>      = <span class="ruby-ivar">@headers</span>                       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">row</span>.<span class="ruby-identifier">nil?</span>
2268:       <span class="ruby-ivar">@headers</span> = <span class="ruby-identifier">convert_fields</span>(<span class="ruby-ivar">@headers</span>, <span class="ruby-keyword kw">true</span>)
2269: 
2270:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@return_headers</span>                                     <span class="ruby-comment cmt"># return headers</span>
2271:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span><span class="ruby-operator">::</span><span class="ruby-constant">Row</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@headers</span>, <span class="ruby-identifier">row</span>, <span class="ruby-keyword kw">true</span>)
2272:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-keyword kw">not</span> [<span class="ruby-constant">Array</span>, <span class="ruby-constant">String</span>].<span class="ruby-identifier">include?</span> <span class="ruby-ivar">@use_headers</span>.<span class="ruby-identifier">class</span>  <span class="ruby-comment cmt"># skip to field row</span>
2273:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">shift</span>
2274:       <span class="ruby-keyword kw">end</span>
2275:     <span class="ruby-keyword kw">end</span>
2276: 
2277:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span><span class="ruby-operator">::</span><span class="ruby-constant">Row</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@headers</span>, <span class="ruby-identifier">convert_fields</span>(<span class="ruby-identifier">row</span>))  <span class="ruby-comment cmt"># field row</span>
2278:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001978">
                    
                    <a name="M001978"></a><b>raw_encoding</b>(default = Encoding::ASCII_8BIT)
                    
                </div>
                
                <div class="description">
                  <p>
Returns the encoding of the internal <a href="IO.html">IO</a> object or the
<tt>default</tt> if the encoding cannot be determined.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001978_source')" id="l_M001978_source">show</a>
                        
                    </p>
                    <div id="M001978_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/csv.rb, line 2326</span>
2326:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">raw_encoding</span>(<span class="ruby-identifier">default</span> = <span class="ruby-constant">Encoding</span><span class="ruby-operator">::</span><span class="ruby-constant">ASCII_8BIT</span>)
2327:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">respond_to?</span> <span class="ruby-identifier">:internal_encoding</span>
2328:       <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">internal_encoding</span> <span class="ruby-operator">||</span> <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">external_encoding</span>
2329:     <span class="ruby-keyword kw">elsif</span> <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">StringIO</span>
2330:       <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">string</span>.<span class="ruby-identifier">encoding</span>
2331:     <span class="ruby-keyword kw">elsif</span> <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">respond_to?</span> <span class="ruby-identifier">:encoding</span>
2332:       <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">encoding</span>
2333:     <span class="ruby-keyword kw">else</span>
2334:       <span class="ruby-identifier">default</span>
2335:     <span class="ruby-keyword kw">end</span>
2336:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    