<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>Gem::TestCase</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../css/main.css" type="text/css" media="screen" />
    <script src="../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Class</span> 
            Gem::TestCase 
            
                <span class="parent">&lt; 
                    
                    <a href="../MiniTest/Unit/TestCase.html">MiniTest::Unit::TestCase</a>
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../files/lib/rubygems/test_case_rb.html">lib/rubygems/test_case.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    
    <div class="description">
        <p>
RubyGemTestCase provides a variety of methods for testing rubygems and
gem-related behavior in a sandbox. Through RubyGemTestCase you can install
and uninstall gems, fetch remote gems through a stub fetcher and be assured
your normal set of gems is not affected.
</p>
<p>
Tests are always run at a safe level of 1.
</p>

    </div>
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>A</dt>
        <dd>
            <ul>
                
                <li><a href="#M007058">all_spec_names</a>,</li>
                
                <li><a href="#M007046">assert_path_exists</a></li>
                
            </ul>
        </dd>
    
        <dt>B</dt>
        <dd>
            <ul>
                
                <li><a href="#M007115">build_rake_in</a></li>
                
            </ul>
        </dd>
    
        <dt>C</dt>
        <dd>
            <ul>
                
                <li><a href="#M007053">create_tmpdir</a></li>
                
            </ul>
        </dd>
    
        <dt>D</dt>
        <dd>
            <ul>
                
                <li><a href="#M007121">dep</a></li>
                
            </ul>
        </dd>
    
        <dt>I</dt>
        <dd>
            <ul>
                
                <li><a href="#M007050">install_gem</a>,</li>
                
                <li><a href="#M007051">install_gem_user</a>,</li>
                
                <li><a href="#M007074">install_specs</a></li>
                
            </ul>
        </dd>
    
        <dt>M</dt>
        <dd>
            <ul>
                
                <li><a href="#M007108">make_command</a>,</li>
                
                <li><a href="#M007109">make_command</a>,</li>
                
                <li><a href="#M007054">mu_pp</a></li>
                
            </ul>
        </dd>
    
        <dt>N</dt>
        <dd>
            <ul>
                
                <li><a href="#M007075">new_spec</a>,</li>
                
                <li><a href="#M007110">nmake_found?</a></li>
                
            </ul>
        </dd>
    
        <dt>P</dt>
        <dd>
            <ul>
                
                <li><a href="#M007114">process_based_port</a>,</li>
                
                <li><a href="#M007113">process_based_port</a></li>
                
            </ul>
        </dd>
    
        <dt>Q</dt>
        <dd>
            <ul>
                
                <li><a href="#M007060">quick_gem</a>,</li>
                
                <li><a href="#M007062">quick_spec</a></li>
                
            </ul>
        </dd>
    
        <dt>R</dt>
        <dd>
            <ul>
                
                <li><a href="#M007056">read_binary</a>,</li>
                
                <li><a href="#M007055">read_cache</a>,</li>
                
                <li><a href="#M007047">refute_path_exists</a>,</li>
                
                <li><a href="#M007122">req</a>,</li>
                
                <li><a href="#M007117">rubybin</a></li>
                
            </ul>
        </dd>
    
        <dt>S</dt>
        <dd>
            <ul>
                
                <li><a href="#M007048">setup</a>,</li>
                
                <li><a href="#M007123">spec</a></li>
                
            </ul>
        </dd>
    
        <dt>T</dt>
        <dd>
            <ul>
                
                <li><a href="#M007049">teardown</a></li>
                
            </ul>
        </dd>
    
        <dt>U</dt>
        <dd>
            <ul>
                
                <li><a href="#M007052">uninstall_gem</a>,</li>
                
                <li><a href="#M007065">util_build_gem</a>,</li>
                
                <li><a href="#M007073">util_clear_gems</a>,</li>
                
                <li><a href="#M007084">util_gem</a>,</li>
                
                <li><a href="#M007086">util_gzip</a>,</li>
                
                <li><a href="#M007087">util_make_gems</a>,</li>
                
                <li><a href="#M007094">util_set_arch</a>,</li>
                
                <li><a href="#M007097">util_setup_fake_fetcher</a>,</li>
                
                <li><a href="#M007099">util_setup_spec_fetcher</a>,</li>
                
                <li><a href="#M007082">util_spec</a>,</li>
                
                <li><a href="#M007102">util_zip</a></li>
                
            </ul>
        </dd>
    
        <dt>V</dt>
        <dd>
            <ul>
                
                <li><a href="#M007124">v</a>,</li>
                
                <li><a href="#M007107">vc_windows?</a>,</li>
                
                <li><a href="#M007105">vc_windows?</a></li>
                
            </ul>
        </dd>
    
        <dt>W</dt>
        <dd>
            <ul>
                
                <li><a href="#M007104">win_platform?</a>,</li>
                
                <li><a href="#M007103">win_platform?</a>,</li>
                
                <li><a href="#M007057">write_file</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    
    <div class="sectiontitle">Included Modules</div>
    <ul>
        
        <li>
            
            <a href="../JSON.html">JSON</a>
            
            START:includes
        </li>
        
    </ul>
    

    

    

    

    

    
            <div class="sectiontitle">Class Public methods</div>
            
            <div class="method">
                <div class="title" id="M007108">
                    
                    <a name="M007108"></a><b>make_command</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Returns the make command for the current platform. For versions of Ruby
built on MS Windows with VC++ or Borland it will return
&#8216;nmake&#8217;. On all other platforms, including Cygwin, it will
return &#8216;make&#8217;.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007108_source')" id="l_M007108_source">show</a>
                        
                    </p>
                    <div id="M007108_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rubygems/test_case.rb, line 754</span>
754:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">make_command</span>
755:     <span class="ruby-constant">ENV</span>[<span class="ruby-value str">&quot;make&quot;</span>] <span class="ruby-operator">||</span> (<span class="ruby-identifier">vc_windows?</span> <span class="ruby-value">? </span><span class="ruby-value str">'nmake'</span> <span class="ruby-operator">:</span> <span class="ruby-value str">'make'</span>)
756:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M007113">
                    
                    <a name="M007113"></a><b>process_based_port</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Allows tests to use a random (but controlled) port number instead of a
hardcoded one. This helps CI tools when running parallels builds on the
same builder slave.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007113_source')" id="l_M007113_source">show</a>
                        
                    </p>
                    <div id="M007113_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rubygems/test_case.rb, line 779</span>
779:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">process_based_port</span>
780:     <span class="ruby-ivar">@@process_based_port</span> <span class="ruby-operator">||=</span> <span class="ruby-value">8000</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">$$</span> <span class="ruby-operator">%</span> <span class="ruby-value">1000</span>
781:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M007117">
                    
                    <a name="M007117"></a><b>rubybin</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Finds the path to the ruby executable
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007117_source')" id="l_M007117_source">show</a>
                        
                    </p>
                    <div id="M007117_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rubygems/test_case.rb, line 811</span>
811:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">rubybin</span>
812:     <span class="ruby-identifier">ruby</span> = <span class="ruby-constant">ENV</span>[<span class="ruby-value str">&quot;RUBY&quot;</span>]
813:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">ruby</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ruby</span>
814:     <span class="ruby-identifier">ruby</span> = <span class="ruby-value str">&quot;ruby&quot;</span>
815:     <span class="ruby-identifier">rubyexe</span> = <span class="ruby-node">&quot;#{ruby}.exe&quot;</span>
816: 
817:     <span class="ruby-value">3</span>.<span class="ruby-identifier">times</span> <span class="ruby-keyword kw">do</span>
818:       <span class="ruby-keyword kw">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span> <span class="ruby-identifier">ruby</span> <span class="ruby-keyword kw">and</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">executable?</span> <span class="ruby-identifier">ruby</span> <span class="ruby-keyword kw">and</span> <span class="ruby-operator">!</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">directory?</span> <span class="ruby-identifier">ruby</span>
819:         <span class="ruby-keyword kw">return</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">ruby</span>)
820:       <span class="ruby-keyword kw">end</span>
821:       <span class="ruby-keyword kw">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span> <span class="ruby-identifier">rubyexe</span> <span class="ruby-keyword kw">and</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">executable?</span> <span class="ruby-identifier">rubyexe</span>
822:         <span class="ruby-keyword kw">return</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">rubyexe</span>)
823:       <span class="ruby-keyword kw">end</span>
824:       <span class="ruby-identifier">ruby</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;..&quot;</span>, <span class="ruby-identifier">ruby</span>)
825:     <span class="ruby-keyword kw">end</span>
826: 
827:     <span class="ruby-keyword kw">begin</span>
828:       <span class="ruby-identifier">require</span> <span class="ruby-value str">&quot;rbconfig&quot;</span>
829:       <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-constant">RbConfig</span><span class="ruby-operator">::</span><span class="ruby-constant">CONFIG</span>[<span class="ruby-value str">&quot;bindir&quot;</span>],
830:                 <span class="ruby-constant">RbConfig</span><span class="ruby-operator">::</span><span class="ruby-constant">CONFIG</span>[<span class="ruby-value str">&quot;ruby_install_name&quot;</span>] <span class="ruby-operator">+</span>
831:                 <span class="ruby-constant">RbConfig</span><span class="ruby-operator">::</span><span class="ruby-constant">CONFIG</span>[<span class="ruby-value str">&quot;EXEEXT&quot;</span>])
832:     <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">LoadError</span>
833:       <span class="ruby-value str">&quot;ruby&quot;</span>
834:     <span class="ruby-keyword kw">end</span>
835:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M007105">
                    
                    <a name="M007105"></a><b>vc_windows?</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Returns whether or not we&#8217;re on a version of Ruby built with VC++ (or
Borland) versus Cygwin, Mingw, etc.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007105_source')" id="l_M007105_source">show</a>
                        
                    </p>
                    <div id="M007105_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rubygems/test_case.rb, line 737</span>
737:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">vc_windows?</span>
738:     <span class="ruby-constant">RUBY_PLATFORM</span>.<span class="ruby-identifier">match</span>(<span class="ruby-value str">'mswin'</span>)
739:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M007103">
                    
                    <a name="M007103"></a><b>win_platform?</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Is this test being run on a Windows platform?
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007103_source')" id="l_M007103_source">show</a>
                        
                    </p>
                    <div id="M007103_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rubygems/test_case.rb, line 722</span>
722:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">win_platform?</span>
723:     <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">win_platform?</span>
724:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M007058">
                    
                    <a name="M007058"></a><b>all_spec_names</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007058_source')" id="l_M007058_source">show</a>
                        
                    </p>
                    <div id="M007058_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rubygems/test_case.rb, line 340</span>
340:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">all_spec_names</span>
341:     <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span>.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">:full_name</span>)
342:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M007046">
                    
                    <a name="M007046"></a><b>assert_path_exists</b>(path, msg = nil)
                    
                </div>
                
                <div class="description">
                  <p>
TODO: move to minitest
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007046_source')" id="l_M007046_source">show</a>
                        
                    </p>
                    <div id="M007046_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/rubygems/test_case.rb, line 84</span>
84:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">assert_path_exists</span> <span class="ruby-identifier">path</span>, <span class="ruby-identifier">msg</span> = <span class="ruby-keyword kw">nil</span>
85:     <span class="ruby-identifier">msg</span> = <span class="ruby-identifier">message</span>(<span class="ruby-identifier">msg</span>) { <span class="ruby-node">&quot;Expected path '#{path}' to exist&quot;</span> }
86:     <span class="ruby-identifier">assert</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">path</span>), <span class="ruby-identifier">msg</span>
87:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M007115">
                    
                    <a name="M007115"></a><b>build_rake_in</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Allows the proper version of <tt>rake</tt> to be used for the test.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007115_source')" id="l_M007115_source">show</a>
                        
                    </p>
                    <div id="M007115_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rubygems/test_case.rb, line 793</span>
793:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">build_rake_in</span>
794:     <span class="ruby-identifier">gem_ruby</span> = <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">ruby</span>
795:     <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">ruby</span> = <span class="ruby-ivar">@@ruby</span>
796:     <span class="ruby-identifier">env_rake</span> = <span class="ruby-constant">ENV</span>[<span class="ruby-value str">&quot;rake&quot;</span>]
797:     <span class="ruby-constant">ENV</span>[<span class="ruby-value str">&quot;rake&quot;</span>] = <span class="ruby-ivar">@@rake</span>
798:     <span class="ruby-keyword kw">yield</span> <span class="ruby-ivar">@@rake</span>
799:   <span class="ruby-keyword kw">ensure</span>
800:     <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">ruby</span> = <span class="ruby-identifier">gem_ruby</span>
801:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">env_rake</span>
802:       <span class="ruby-constant">ENV</span>[<span class="ruby-value str">&quot;rake&quot;</span>] = <span class="ruby-identifier">env_rake</span>
803:     <span class="ruby-keyword kw">else</span>
804:       <span class="ruby-constant">ENV</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value str">&quot;rake&quot;</span>)
805:     <span class="ruby-keyword kw">end</span>
806:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M007053">
                    
                    <a name="M007053"></a><b>create_tmpdir</b>()
                    
                </div>
                
                <div class="description">
                  <p>
creates a temporary directory with hax
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007053_source')" id="l_M007053_source">show</a>
                        
                    </p>
                    <div id="M007053_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rubygems/test_case.rb, line 291</span>
291:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create_tmpdir</span>
292:     <span class="ruby-identifier">tmpdir</span> = <span class="ruby-keyword kw">nil</span>
293:     <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">chdir</span> <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">tmpdir</span> <span class="ruby-keyword kw">do</span> <span class="ruby-identifier">tmpdir</span> = <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">pwd</span> <span class="ruby-keyword kw">end</span> <span class="ruby-comment cmt"># HACK OSX /private/tmp</span>
294:     <span class="ruby-identifier">tmpdir</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span> <span class="ruby-identifier">tmpdir</span>, <span class="ruby-node">&quot;test_rubygems_#{$$}&quot;</span>
295:     <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-identifier">tmpdir</span>
296:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">tmpdir</span>
297:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M007121">
                    
                    <a name="M007121"></a><b>dep</b>(name, *requirements)
                    
                </div>
                
                <div class="description">
                  <p>
Construct a new <a href="Dependency.html">Gem::Dependency</a>.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007121_source')" id="l_M007121_source">show</a>
                        
                    </p>
                    <div id="M007121_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rubygems/test_case.rb, line 851</span>
851:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">dep</span> <span class="ruby-identifier">name</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">requirements</span>
852:     <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Dependency</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">name</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">requirements</span>
853:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M007050">
                    
                    <a name="M007050"></a><b>install_gem</b>(spec)
                    
                </div>
                
                <div class="description">
                  <p>
Builds and installs the <a href="Specification.html">Gem::Specification</a>
<tt>spec</tt>
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007050_source')" id="l_M007050_source">show</a>
                        
                    </p>
                    <div id="M007050_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rubygems/test_case.rb, line 246</span>
246:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">install_gem</span> <span class="ruby-identifier">spec</span>
247:     <span class="ruby-identifier">require</span> <span class="ruby-value str">'rubygems/installer'</span>
248: 
249:     <span class="ruby-identifier">use_ui</span> <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">MockGemUi</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword kw">do</span>
250:       <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">chdir</span> <span class="ruby-ivar">@tempdir</span> <span class="ruby-keyword kw">do</span>
251:         <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Builder</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">spec</span>).<span class="ruby-identifier">build</span>
252:       <span class="ruby-keyword kw">end</span>
253:     <span class="ruby-keyword kw">end</span>
254: 
255:     <span class="ruby-identifier">gem</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-ivar">@tempdir</span>, <span class="ruby-constant">File</span>.<span class="ruby-identifier">basename</span>(<span class="ruby-identifier">spec</span>.<span class="ruby-identifier">cache_file</span>)).<span class="ruby-identifier">untaint</span>
256: 
257:     <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Installer</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">gem</span>, <span class="ruby-identifier">:wrappers</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>).<span class="ruby-identifier">install</span>
258:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M007051">
                    
                    <a name="M007051"></a><b>install_gem_user</b>(spec)
                    
                </div>
                
                <div class="description">
                  <p>
Builds and installs the <a href="Specification.html">Gem::Specification</a>
<tt>spec</tt> into the user dir
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007051_source')" id="l_M007051_source">show</a>
                        
                    </p>
                    <div id="M007051_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rubygems/test_case.rb, line 263</span>
263:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">install_gem_user</span> <span class="ruby-identifier">spec</span>
264:     <span class="ruby-identifier">require</span> <span class="ruby-value str">'rubygems/installer'</span>
265: 
266:     <span class="ruby-identifier">use_ui</span> <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">MockGemUi</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword kw">do</span>
267:       <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">chdir</span> <span class="ruby-ivar">@tempdir</span> <span class="ruby-keyword kw">do</span>
268:         <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Builder</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">spec</span>).<span class="ruby-identifier">build</span>
269:       <span class="ruby-keyword kw">end</span>
270:     <span class="ruby-keyword kw">end</span>
271: 
272:     <span class="ruby-identifier">gem</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-ivar">@tempdir</span>, <span class="ruby-constant">File</span>.<span class="ruby-identifier">basename</span>(<span class="ruby-identifier">spec</span>.<span class="ruby-identifier">cache_file</span>)).<span class="ruby-identifier">untaint</span>
273: 
274:     <span class="ruby-identifier">i</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Installer</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">gem</span>, <span class="ruby-identifier">:wrappers</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>, <span class="ruby-identifier">:user_install</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>)
275:     <span class="ruby-identifier">i</span>.<span class="ruby-identifier">install</span>
276:     <span class="ruby-identifier">i</span>.<span class="ruby-identifier">spec</span>
277:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M007074">
                    
                    <a name="M007074"></a><b>install_specs</b>(*specs)
                    
                </div>
                
                <div class="description">
                  <p>
Install the provided specs
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007074_source')" id="l_M007074_source">show</a>
                        
                    </p>
                    <div id="M007074_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rubygems/test_case.rb, line 444</span>
444:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">install_specs</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">specs</span>)
445:     <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span>.<span class="ruby-identifier">add_specs</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">specs</span>)
446:     <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">searcher</span> = <span class="ruby-keyword kw">nil</span>
447:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M007109">
                    
                    <a name="M007109"></a><b>make_command</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Returns the make command for the current platform. For versions of Ruby
built on MS Windows with VC++ or Borland it will return
&#8216;nmake&#8217;. On all other platforms, including Cygwin, it will
return &#8216;make&#8217;.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007109_source')" id="l_M007109_source">show</a>
                        
                    </p>
                    <div id="M007109_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rubygems/test_case.rb, line 763</span>
763:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">make_command</span>
764:     <span class="ruby-constant">ENV</span>[<span class="ruby-value str">&quot;make&quot;</span>] <span class="ruby-operator">||</span> (<span class="ruby-identifier">vc_windows?</span> <span class="ruby-value">? </span><span class="ruby-value str">'nmake'</span> <span class="ruby-operator">:</span> <span class="ruby-value str">'make'</span>)
765:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M007054">
                    
                    <a name="M007054"></a><b>mu_pp</b>(obj)
                    
                </div>
                
                <div class="description">
                  <p>
Enables pretty-print for all tests
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007054_source')" id="l_M007054_source">show</a>
                        
                    </p>
                    <div id="M007054_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rubygems/test_case.rb, line 302</span>
302:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">mu_pp</span>(<span class="ruby-identifier">obj</span>)
303:     <span class="ruby-identifier">s</span> = <span class="ruby-value str">''</span>
304:     <span class="ruby-identifier">s</span> = <span class="ruby-constant">PP</span>.<span class="ruby-identifier">pp</span> <span class="ruby-identifier">obj</span>, <span class="ruby-identifier">s</span>
305:     <span class="ruby-identifier">s</span> = <span class="ruby-identifier">s</span>.<span class="ruby-identifier">force_encoding</span>(<span class="ruby-constant">Encoding</span>.<span class="ruby-identifier">default_external</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">defined?</span> <span class="ruby-constant">Encoding</span>
306:     <span class="ruby-identifier">s</span>.<span class="ruby-identifier">chomp</span>
307:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M007075">
                    
                    <a name="M007075"></a><b>new_spec</b>(name, version, deps = nil, *files)
                    
                </div>
                
                <div class="description">
                  <p>
Create a new spec (or gem if passed an array of files) and set it up
properly. Use this instead of <a href="TestCase.html#M007082">util_spec</a>
and util_gem.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007075_source')" id="l_M007075_source">show</a>
                        
                    </p>
                    <div id="M007075_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rubygems/test_case.rb, line 453</span>
453:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">new_spec</span> <span class="ruby-identifier">name</span>, <span class="ruby-identifier">version</span>, <span class="ruby-identifier">deps</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">files</span>
454:     <span class="ruby-identifier">require</span> <span class="ruby-value str">'rubygems/specification'</span>
455: 
456:     <span class="ruby-identifier">spec</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
457:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">platform</span>    = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Platform</span><span class="ruby-operator">::</span><span class="ruby-constant">RUBY</span>
458:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">name</span>        = <span class="ruby-identifier">name</span>
459:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">version</span>     = <span class="ruby-identifier">version</span>
460:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">author</span>      = <span class="ruby-value str">'A User'</span>
461:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">email</span>       = <span class="ruby-value str">'example@example.com'</span>
462:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">homepage</span>    = <span class="ruby-value str">'http://example.com'</span>
463:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">summary</span>     = <span class="ruby-value str">&quot;this is a summary&quot;</span>
464:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">description</span> = <span class="ruby-value str">&quot;This is a test description&quot;</span>
465: 
466:       <span class="ruby-constant">Array</span>(<span class="ruby-identifier">deps</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">n</span>, <span class="ruby-identifier">req</span><span class="ruby-operator">|</span>
467:         <span class="ruby-identifier">s</span>.<span class="ruby-identifier">add_dependency</span> <span class="ruby-identifier">n</span>, (<span class="ruby-identifier">req</span> <span class="ruby-operator">||</span> <span class="ruby-value str">'&gt;= 0'</span>)
468:       <span class="ruby-keyword kw">end</span>
469: 
470:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">files</span>.<span class="ruby-identifier">push</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">files</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">files</span>.<span class="ruby-identifier">empty?</span>
471: 
472:       <span class="ruby-keyword kw">yield</span> <span class="ruby-identifier">s</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block_given?</span>
473:     <span class="ruby-keyword kw">end</span>
474: 
475:     <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">loaded_from</span> = <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">spec_file</span>
476: 
477:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">files</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-keyword kw">then</span>
478:       <span class="ruby-identifier">write_file</span> <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">spec_file</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">io</span><span class="ruby-operator">|</span>
479:         <span class="ruby-identifier">io</span>.<span class="ruby-identifier">write</span> <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">to_ruby_for_cache</span>
480:       <span class="ruby-keyword kw">end</span>
481: 
482:       <span class="ruby-identifier">util_build_gem</span> <span class="ruby-identifier">spec</span>
483: 
484:       <span class="ruby-identifier">cache_file</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span> <span class="ruby-ivar">@tempdir</span>, <span class="ruby-value str">'gems'</span>, <span class="ruby-node">&quot;#{spec.full_name}.gem&quot;</span>
485:       <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span> <span class="ruby-identifier">cache_file</span>
486:       <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mv</span> <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">cache_file</span>, <span class="ruby-identifier">cache_file</span>
487:       <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm</span> <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">spec_file</span>
488:     <span class="ruby-keyword kw">end</span>
489: 
490:     <span class="ruby-identifier">spec</span>
491:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M007110">
                    
                    <a name="M007110"></a><b>nmake_found?</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Returns whether or not the nmake command could be found.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007110_source')" id="l_M007110_source">show</a>
                        
                    </p>
                    <div id="M007110_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rubygems/test_case.rb, line 770</span>
770:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">nmake_found?</span>
771:     <span class="ruby-identifier">system</span>(<span class="ruby-value str">'nmake /? 1&gt;NUL 2&gt;&amp;1'</span>)
772:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M007114">
                    
                    <a name="M007114"></a><b>process_based_port</b>()
                    
                </div>
                
                <div class="description">
                  <p>
See ::<a href="TestCase.html#M007113">process_based_port</a>
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007114_source')" id="l_M007114_source">show</a>
                        
                    </p>
                    <div id="M007114_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rubygems/test_case.rb, line 786</span>
786:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">process_based_port</span>
787:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">process_based_port</span>
788:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M007060">
                    
                    <a name="M007060"></a><b>quick_gem</b>(name, version='2')
                    
                </div>
                
                <div class="description">
                  <p>
Creates a <a href="Specification.html">Gem::Specification</a> with a
minimum of extra work. <tt>name</tt> and <tt>version</tt> are the
gem&#8217;s name and version, platform, author, email, homepage, summary
and description are defaulted. The specification is yielded for
customization.
</p>
<p>
The gem is added to the installed gems in +@gemhome+ and to the current
source_index.
</p>
<p>
Use this with <a href="TestCase.html#M007057">write_file</a> to build an
installed gem.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007060_source')" id="l_M007060_source">show</a>
                        
                    </p>
                    <div id="M007060_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rubygems/test_case.rb, line 355</span>
355:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">quick_gem</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">version</span>=<span class="ruby-value str">'2'</span>)
356:     <span class="ruby-identifier">require</span> <span class="ruby-value str">'rubygems/specification'</span>
357: 
358:     <span class="ruby-identifier">spec</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
359:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">platform</span>    = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Platform</span><span class="ruby-operator">::</span><span class="ruby-constant">RUBY</span>
360:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">name</span>        = <span class="ruby-identifier">name</span>
361:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">version</span>     = <span class="ruby-identifier">version</span>
362:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">author</span>      = <span class="ruby-value str">'A User'</span>
363:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">email</span>       = <span class="ruby-value str">'example@example.com'</span>
364:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">homepage</span>    = <span class="ruby-value str">'http://example.com'</span>
365:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">summary</span>     = <span class="ruby-value str">&quot;this is a summary&quot;</span>
366:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">description</span> = <span class="ruby-value str">&quot;This is a test description&quot;</span>
367: 
368:       <span class="ruby-keyword kw">yield</span>(<span class="ruby-identifier">s</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block_given?</span>
369:     <span class="ruby-keyword kw">end</span>
370: 
371:     <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span>.<span class="ruby-identifier">map</span> <span class="ruby-comment cmt"># HACK: force specs to (re-)load before we write</span>
372: 
373:     <span class="ruby-identifier">written_path</span> = <span class="ruby-identifier">write_file</span> <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">spec_file</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">io</span><span class="ruby-operator">|</span>
374:       <span class="ruby-identifier">io</span>.<span class="ruby-identifier">write</span> <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">to_ruby_for_cache</span>
375:     <span class="ruby-keyword kw">end</span>
376: 
377:     <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">loaded_from</span> = <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">loaded_from</span> = <span class="ruby-identifier">written_path</span>
378: 
379:     <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span>.<span class="ruby-identifier">add_spec</span> <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">for_cache</span>
380: 
381:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">spec</span>
382:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M007062">
                    
                    <a name="M007062"></a><b>quick_spec</b>(name, version = '2')
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007062_source')" id="l_M007062_source">show</a>
                        
                    </p>
                    <div id="M007062_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rubygems/test_case.rb, line 384</span>
384:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">quick_spec</span> <span class="ruby-identifier">name</span>, <span class="ruby-identifier">version</span> = <span class="ruby-value str">'2'</span>
385:     <span class="ruby-comment cmt"># TODO: deprecate</span>
386:     <span class="ruby-identifier">require</span> <span class="ruby-value str">'rubygems/specification'</span>
387: 
388:     <span class="ruby-identifier">spec</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
389:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">platform</span>    = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Platform</span><span class="ruby-operator">::</span><span class="ruby-constant">RUBY</span>
390:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">name</span>        = <span class="ruby-identifier">name</span>
391:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">version</span>     = <span class="ruby-identifier">version</span>
392:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">author</span>      = <span class="ruby-value str">'A User'</span>
393:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">email</span>       = <span class="ruby-value str">'example@example.com'</span>
394:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">homepage</span>    = <span class="ruby-value str">'http://example.com'</span>
395:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">summary</span>     = <span class="ruby-value str">&quot;this is a summary&quot;</span>
396:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">description</span> = <span class="ruby-value str">&quot;This is a test description&quot;</span>
397: 
398:       <span class="ruby-keyword kw">yield</span>(<span class="ruby-identifier">s</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block_given?</span>
399:     <span class="ruby-keyword kw">end</span>
400: 
401:     <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">loaded_from</span> = <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">spec_file</span>
402: 
403:     <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span>.<span class="ruby-identifier">add_spec</span> <span class="ruby-identifier">spec</span>
404: 
405:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">spec</span>
406:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M007056">
                    
                    <a name="M007056"></a><b>read_binary</b>(path)
                    
                </div>
                
                <div class="description">
                  <p>
Reads a binary file at <tt>path</tt>
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007056_source')" id="l_M007056_source">show</a>
                        
                    </p>
                    <div id="M007056_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rubygems/test_case.rb, line 321</span>
321:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">read_binary</span>(<span class="ruby-identifier">path</span>)
322:     <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">read_binary</span> <span class="ruby-identifier">path</span>
323:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M007055">
                    
                    <a name="M007055"></a><b>read_cache</b>(path)
                    
                </div>
                
                <div class="description">
                  <p>
Reads a <a href="../Marshal.html">Marshal</a> file at <tt>path</tt>
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007055_source')" id="l_M007055_source">show</a>
                        
                    </p>
                    <div id="M007055_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rubygems/test_case.rb, line 312</span>
312:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">read_cache</span>(<span class="ruby-identifier">path</span>)
313:     <span class="ruby-identifier">open</span> <span class="ruby-identifier">path</span>.<span class="ruby-identifier">dup</span>.<span class="ruby-identifier">untaint</span>, <span class="ruby-value str">'rb'</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">io</span><span class="ruby-operator">|</span>
314:       <span class="ruby-constant">Marshal</span>.<span class="ruby-identifier">load</span> <span class="ruby-identifier">io</span>.<span class="ruby-identifier">read</span>
315:     <span class="ruby-keyword kw">end</span>
316:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M007047">
                    
                    <a name="M007047"></a><b>refute_path_exists</b>(path, msg = nil)
                    
                </div>
                
                <div class="description">
                  <p>
TODO: move to minitest
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007047_source')" id="l_M007047_source">show</a>
                        
                    </p>
                    <div id="M007047_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/rubygems/test_case.rb, line 90</span>
90:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">refute_path_exists</span> <span class="ruby-identifier">path</span>, <span class="ruby-identifier">msg</span> = <span class="ruby-keyword kw">nil</span>
91:     <span class="ruby-identifier">msg</span> = <span class="ruby-identifier">message</span>(<span class="ruby-identifier">msg</span>) { <span class="ruby-node">&quot;Expected path '#{path}' to not exist&quot;</span> }
92:     <span class="ruby-identifier">refute</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">path</span>), <span class="ruby-identifier">msg</span>
93:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M007122">
                    
                    <a name="M007122"></a><b>req</b>(*requirements)
                    
                </div>
                
                <div class="description">
                  <p>
Constructs a new <a href="Requirement.html">Gem::Requirement</a>.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007122_source')" id="l_M007122_source">show</a>
                        
                    </p>
                    <div id="M007122_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rubygems/test_case.rb, line 858</span>
858:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">req</span> <span class="ruby-operator">*</span><span class="ruby-identifier">requirements</span>
859:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">requirements</span>.<span class="ruby-identifier">first</span> <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Requirement</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">requirements</span>.<span class="ruby-identifier">first</span>
860:     <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Requirement</span>.<span class="ruby-identifier">create</span> <span class="ruby-identifier">requirements</span>
861:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M007048">
                    
                    <a name="M007048"></a><b>setup</b>()
                    
                </div>
                
                <div class="description">
                  <p>
<a href="TestCase.html#M007048">setup</a> prepares a sandboxed location to
install gems. All installs are directed to a temporary directory. All
install plugins are removed.
</p>
<p>
If the <tt>RUBY</tt> environment variable is set the given path is used for
Gem::ruby. The local platform is set to <tt>i386-mswin32</tt> for Windows
or <tt>i686-darwin8.10.1</tt> otherwise.
</p>
<p>
If the <tt>KEEP_FILES</tt> environment variable is set the files will not
be removed from <tt>/tmp/test_rubygems_#{$$}.#{<a
href="../Time.html#M001486">Time.now</a>.to_i}</tt>.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007048_source')" id="l_M007048_source">show</a>
                        
                    </p>
                    <div id="M007048_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rubygems/test_case.rb, line 113</span>
113:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">setup</span>
114:     <span class="ruby-keyword kw">super</span>
115: 
116:     <span class="ruby-ivar">@orig_gem_home</span> = <span class="ruby-constant">ENV</span>[<span class="ruby-value str">'GEM_HOME'</span>]
117:     <span class="ruby-ivar">@orig_gem_path</span> = <span class="ruby-constant">ENV</span>[<span class="ruby-value str">'GEM_PATH'</span>]
118: 
119:     <span class="ruby-ivar">@current_dir</span> = <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">pwd</span>
120:     <span class="ruby-ivar">@ui</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">MockGemUi</span>.<span class="ruby-identifier">new</span>
121: 
122:     <span class="ruby-identifier">tmpdir</span> = <span class="ruby-keyword kw">nil</span>
123:     <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">chdir</span> <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">tmpdir</span> <span class="ruby-keyword kw">do</span> <span class="ruby-identifier">tmpdir</span> = <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">pwd</span> <span class="ruby-keyword kw">end</span> <span class="ruby-comment cmt"># HACK OSX /private/tmp</span>
124: 
125:     <span class="ruby-keyword kw">if</span> <span class="ruby-constant">ENV</span>[<span class="ruby-value str">'KEEP_FILES'</span>] <span class="ruby-keyword kw">then</span>
126:       <span class="ruby-ivar">@tempdir</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">tmpdir</span>, <span class="ruby-node">&quot;test_rubygems_#{$$}.#{Time.now.to_i}&quot;</span>)
127:     <span class="ruby-keyword kw">else</span>
128:       <span class="ruby-ivar">@tempdir</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">tmpdir</span>, <span class="ruby-node">&quot;test_rubygems_#{$$}&quot;</span>)
129:     <span class="ruby-keyword kw">end</span>
130:     <span class="ruby-ivar">@tempdir</span>.<span class="ruby-identifier">untaint</span>
131:     <span class="ruby-ivar">@gemhome</span>  = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span> <span class="ruby-ivar">@tempdir</span>, <span class="ruby-value str">'gemhome'</span>
132:     <span class="ruby-ivar">@userhome</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span> <span class="ruby-ivar">@tempdir</span>, <span class="ruby-value str">'userhome'</span>
133: 
134:     <span class="ruby-ivar">@orig_ruby</span> = <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ruby</span> = <span class="ruby-constant">ENV</span>[<span class="ruby-value str">'RUBY'</span>] <span class="ruby-keyword kw">then</span>
135:                    <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">class_eval</span> { <span class="ruby-identifier">ruby</span>, <span class="ruby-ivar">@ruby</span> = <span class="ruby-ivar">@ruby</span>, <span class="ruby-identifier">ruby</span> }
136:                    <span class="ruby-identifier">ruby</span>
137:                  <span class="ruby-keyword kw">end</span>
138: 
139:     <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">ensure_gem_subdirectories</span> <span class="ruby-ivar">@gemhome</span>
140: 
141:     <span class="ruby-ivar">@orig_LOAD_PATH</span> = <span class="ruby-identifier">$LOAD_PATH</span>.<span class="ruby-identifier">dup</span>
142:     <span class="ruby-identifier">$LOAD_PATH</span>.<span class="ruby-identifier">map!</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span> <span class="ruby-identifier">s</span> }
143: 
144:     <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">chdir</span> <span class="ruby-ivar">@tempdir</span>
145: 
146:     <span class="ruby-ivar">@orig_ENV_HOME</span> = <span class="ruby-constant">ENV</span>[<span class="ruby-value str">'HOME'</span>]
147:     <span class="ruby-constant">ENV</span>[<span class="ruby-value str">'HOME'</span>] = <span class="ruby-ivar">@userhome</span>
148:     <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">instance_variable_set</span> <span class="ruby-identifier">:@user_home</span>, <span class="ruby-keyword kw">nil</span>
149: 
150:     <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-ivar">@gemhome</span>
151:     <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-ivar">@userhome</span>
152: 
153:     <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">use_paths</span>(<span class="ruby-ivar">@gemhome</span>)
154: 
155:     <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">loaded_specs</span>.<span class="ruby-identifier">clear</span>
156:     <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">unresolved_deps</span>.<span class="ruby-identifier">clear</span>
157: 
158:     <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">configuration</span>.<span class="ruby-identifier">verbose</span> = <span class="ruby-keyword kw">true</span>
159:     <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">configuration</span>.<span class="ruby-identifier">update_sources</span> = <span class="ruby-keyword kw">true</span>
160: 
161:     <span class="ruby-ivar">@gem_repo</span> = <span class="ruby-value str">&quot;http://gems.example.com/&quot;</span>
162:     <span class="ruby-ivar">@uri</span> = <span class="ruby-constant">URI</span>.<span class="ruby-identifier">parse</span> <span class="ruby-ivar">@gem_repo</span>
163:     <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">sources</span>.<span class="ruby-identifier">replace</span> [<span class="ruby-ivar">@gem_repo</span>]
164: 
165:     <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">searcher</span> = <span class="ruby-keyword kw">nil</span>
166:     <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">SpecFetcher</span>.<span class="ruby-identifier">fetcher</span> = <span class="ruby-keyword kw">nil</span>
167: 
168:     <span class="ruby-ivar">@orig_BASERUBY</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">ConfigMap</span>[<span class="ruby-identifier">:BASERUBY</span>]
169:     <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">ConfigMap</span>[<span class="ruby-identifier">:BASERUBY</span>] = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">ConfigMap</span>[<span class="ruby-identifier">:ruby_install_name</span>]
170: 
171:     <span class="ruby-ivar">@orig_arch</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">ConfigMap</span>[<span class="ruby-identifier">:arch</span>]
172: 
173:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">win_platform?</span>
174:       <span class="ruby-identifier">util_set_arch</span> <span class="ruby-value str">'i386-mswin32'</span>
175:     <span class="ruby-keyword kw">else</span>
176:       <span class="ruby-identifier">util_set_arch</span> <span class="ruby-value str">'i686-darwin8.10.1'</span>
177:     <span class="ruby-keyword kw">end</span>
178: 
179:     <span class="ruby-ivar">@marshal_version</span> = <span class="ruby-node">&quot;#{Marshal::MAJOR_VERSION}.#{Marshal::MINOR_VERSION}&quot;</span>
180: 
181:     <span class="ruby-comment cmt"># TODO: move to installer test cases</span>
182:     <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">post_build_hooks</span>.<span class="ruby-identifier">clear</span>
183:     <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">post_install_hooks</span>.<span class="ruby-identifier">clear</span>
184:     <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">post_uninstall_hooks</span>.<span class="ruby-identifier">clear</span>
185:     <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">pre_install_hooks</span>.<span class="ruby-identifier">clear</span>
186:     <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">pre_uninstall_hooks</span>.<span class="ruby-identifier">clear</span>
187: 
188:     <span class="ruby-comment cmt"># TODO: move to installer test cases</span>
189:     <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">post_build</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">installer</span><span class="ruby-operator">|</span>
190:       <span class="ruby-ivar">@post_build_hook_arg</span> = <span class="ruby-identifier">installer</span>
191:       <span class="ruby-keyword kw">true</span>
192:     <span class="ruby-keyword kw">end</span>
193: 
194:     <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">post_install</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">installer</span><span class="ruby-operator">|</span>
195:       <span class="ruby-ivar">@post_install_hook_arg</span> = <span class="ruby-identifier">installer</span>
196:     <span class="ruby-keyword kw">end</span>
197: 
198:     <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">post_uninstall</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">uninstaller</span><span class="ruby-operator">|</span>
199:       <span class="ruby-ivar">@post_uninstall_hook_arg</span> = <span class="ruby-identifier">uninstaller</span>
200:     <span class="ruby-keyword kw">end</span>
201: 
202:     <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">pre_install</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">installer</span><span class="ruby-operator">|</span>
203:       <span class="ruby-ivar">@pre_install_hook_arg</span> = <span class="ruby-identifier">installer</span>
204:       <span class="ruby-keyword kw">true</span>
205:     <span class="ruby-keyword kw">end</span>
206: 
207:     <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">pre_uninstall</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">uninstaller</span><span class="ruby-operator">|</span>
208:       <span class="ruby-ivar">@pre_uninstall_hook_arg</span> = <span class="ruby-identifier">uninstaller</span>
209:     <span class="ruby-keyword kw">end</span>
210:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M007123">
                    
                    <a name="M007123"></a><b>spec</b>(name, version, &amp;block)
                    
                </div>
                
                <div class="description">
                  <p>
Constructs a new <a href="Specification.html">Gem::Specification</a>.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007123_source')" id="l_M007123_source">show</a>
                        
                    </p>
                    <div id="M007123_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rubygems/test_case.rb, line 866</span>
866:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">spec</span> <span class="ruby-identifier">name</span>, <span class="ruby-identifier">version</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>
867:     <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">name</span>, <span class="ruby-identifier">v</span>(<span class="ruby-identifier">version</span>), <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>
868:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M007049">
                    
                    <a name="M007049"></a><b>teardown</b>()
                    
                </div>
                
                <div class="description">
                  <p>
<a href="TestCase.html#M007049">teardown</a> restores the process to its
original state and removes the tempdir unless the <tt>KEEP_FILES</tt>
environment variable was set.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007049_source')" id="l_M007049_source">show</a>
                        
                    </p>
                    <div id="M007049_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rubygems/test_case.rb, line 216</span>
216:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">teardown</span>
217:     <span class="ruby-identifier">$LOAD_PATH</span>.<span class="ruby-identifier">replace</span> <span class="ruby-ivar">@orig_LOAD_PATH</span>
218: 
219:     <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">ConfigMap</span>[<span class="ruby-identifier">:BASERUBY</span>] = <span class="ruby-ivar">@orig_BASERUBY</span>
220:     <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">ConfigMap</span>[<span class="ruby-identifier">:arch</span>] = <span class="ruby-ivar">@orig_arch</span>
221: 
222:     <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">defined?</span> <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">RemoteFetcher</span> <span class="ruby-keyword kw">then</span>
223:       <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">RemoteFetcher</span>.<span class="ruby-identifier">fetcher</span> = <span class="ruby-keyword kw">nil</span>
224:     <span class="ruby-keyword kw">end</span>
225: 
226:     <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">chdir</span> <span class="ruby-ivar">@current_dir</span>
227: 
228:     <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm_rf</span> <span class="ruby-ivar">@tempdir</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">ENV</span>[<span class="ruby-value str">'KEEP_FILES'</span>]
229: 
230:     <span class="ruby-constant">ENV</span>[<span class="ruby-value str">'GEM_HOME'</span>] = <span class="ruby-ivar">@orig_gem_home</span>
231:     <span class="ruby-constant">ENV</span>[<span class="ruby-value str">'GEM_PATH'</span>] = <span class="ruby-ivar">@orig_gem_path</span>
232: 
233:     <span class="ruby-identifier">_</span> = <span class="ruby-ivar">@orig_ruby</span>
234:     <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">class_eval</span> { <span class="ruby-ivar">@ruby</span> = <span class="ruby-identifier">_</span> } <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">_</span>
235: 
236:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@orig_ENV_HOME</span> <span class="ruby-keyword kw">then</span>
237:       <span class="ruby-constant">ENV</span>[<span class="ruby-value str">'HOME'</span>] = <span class="ruby-ivar">@orig_ENV_HOME</span>
238:     <span class="ruby-keyword kw">else</span>
239:       <span class="ruby-constant">ENV</span>.<span class="ruby-identifier">delete</span> <span class="ruby-value str">'HOME'</span>
240:     <span class="ruby-keyword kw">end</span>
241:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M007052">
                    
                    <a name="M007052"></a><b>uninstall_gem</b>(spec)
                    
                </div>
                
                <div class="description">
                  <p>
Uninstalls the <a href="Specification.html">Gem::Specification</a>
<tt>spec</tt>
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007052_source')" id="l_M007052_source">show</a>
                        
                    </p>
                    <div id="M007052_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rubygems/test_case.rb, line 281</span>
281:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">uninstall_gem</span> <span class="ruby-identifier">spec</span>
282:     <span class="ruby-identifier">require</span> <span class="ruby-value str">'rubygems/uninstaller'</span>
283: 
284:     <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Uninstaller</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">spec</span>.<span class="ruby-identifier">name</span>,
285:                          <span class="ruby-identifier">:executables</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>, <span class="ruby-identifier">:user_install</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>).<span class="ruby-identifier">uninstall</span>
286:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M007065">
                    
                    <a name="M007065"></a><b>util_build_gem</b>(spec)
                    
                </div>
                
                <div class="description">
                  <p>
Builds a gem from <tt>spec</tt> and places it in <tt><a
href="../File.html#M000416">File.join</a> @gemhome, 'cache'</tt>.
Automatically creates files based on <tt>spec.files</tt>
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007065_source')" id="l_M007065_source">show</a>
                        
                    </p>
                    <div id="M007065_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rubygems/test_case.rb, line 412</span>
412:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">util_build_gem</span>(<span class="ruby-identifier">spec</span>)
413:     <span class="ruby-identifier">dir</span> = <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">gem_dir</span>
414:     <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-identifier">dir</span>
415: 
416:     <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">chdir</span> <span class="ruby-identifier">dir</span> <span class="ruby-keyword kw">do</span>
417:       <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">files</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span>
418:         <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span> <span class="ruby-identifier">file</span>
419:         <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-identifier">file</span>)
420:         <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span> <span class="ruby-identifier">file</span>, <span class="ruby-value str">'w'</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">fp</span><span class="ruby-operator">|</span> <span class="ruby-identifier">fp</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;# #{file}&quot;</span> <span class="ruby-keyword kw">end</span>
421:       <span class="ruby-keyword kw">end</span>
422: 
423:       <span class="ruby-identifier">use_ui</span> <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">MockGemUi</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword kw">do</span>
424:         <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Builder</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">spec</span>).<span class="ruby-identifier">build</span>
425:       <span class="ruby-keyword kw">end</span>
426: 
427:       <span class="ruby-identifier">cache</span> = <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">cache_file</span>
428:       <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mv</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">basename</span>(<span class="ruby-identifier">cache</span>), <span class="ruby-identifier">cache</span>
429:     <span class="ruby-keyword kw">end</span>
430:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M007073">
                    
                    <a name="M007073"></a><b>util_clear_gems</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Removes all installed gems from +@gemhome+.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007073_source')" id="l_M007073_source">show</a>
                        
                    </p>
                    <div id="M007073_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rubygems/test_case.rb, line 435</span>
435:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">util_clear_gems</span>
436:     <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm_rf</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-ivar">@gemhome</span>, <span class="ruby-value str">&quot;gems&quot;</span>) <span class="ruby-comment cmt"># TODO: use Gem::Dirs</span>
437:     <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm_rf</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-ivar">@gemhome</span>, <span class="ruby-value str">&quot;specifications&quot;</span>)
438:     <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span>.<span class="ruby-identifier">reset</span>
439:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M007084">
                    
                    <a name="M007084"></a><b>util_gem</b>(name, version, deps = nil, &amp;block)
                    
                </div>
                
                <div class="description">
                  <p>
Creates a gem with <tt>name</tt>, <tt>version</tt> and <tt>deps</tt>. The
specification will be yielded before gem creation for customization. The
gem will be placed in <tt><a href="../File.html#M000416">File.join</a>
@tempdir, 'gems'</tt>. The specification and .gem file location are
returned.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007084_source')" id="l_M007084_source">show</a>
                        
                    </p>
                    <div id="M007084_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rubygems/test_case.rb, line 517</span>
517:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">util_gem</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">version</span>, <span class="ruby-identifier">deps</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
518:     <span class="ruby-comment cmt"># TODO: deprecate</span>
519:     <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;deps or block, not both&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">deps</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">block</span>
520: 
521:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">deps</span> <span class="ruby-keyword kw">then</span>
522:       <span class="ruby-identifier">block</span> = <span class="ruby-identifier">proc</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
523:         <span class="ruby-identifier">deps</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">n</span>, <span class="ruby-identifier">req</span><span class="ruby-operator">|</span>
524:           <span class="ruby-identifier">s</span>.<span class="ruby-identifier">add_dependency</span> <span class="ruby-identifier">n</span>, (<span class="ruby-identifier">req</span> <span class="ruby-operator">||</span> <span class="ruby-value str">'&gt;= 0'</span>)
525:         <span class="ruby-keyword kw">end</span>
526:       <span class="ruby-keyword kw">end</span>
527:     <span class="ruby-keyword kw">end</span>
528: 
529:     <span class="ruby-identifier">spec</span> = <span class="ruby-identifier">quick_gem</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">version</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
530: 
531:     <span class="ruby-identifier">util_build_gem</span> <span class="ruby-identifier">spec</span>
532: 
533:     <span class="ruby-identifier">cache_file</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span> <span class="ruby-ivar">@tempdir</span>, <span class="ruby-value str">'gems'</span>, <span class="ruby-node">&quot;#{spec.original_name}.gem&quot;</span>
534:     <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span> <span class="ruby-identifier">cache_file</span>
535:     <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mv</span> <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">cache_file</span>, <span class="ruby-identifier">cache_file</span>
536:     <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm</span> <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">spec_file</span>
537: 
538:     <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">loaded_from</span> = <span class="ruby-keyword kw">nil</span>
539: 
540:     [<span class="ruby-identifier">spec</span>, <span class="ruby-identifier">cache_file</span>]
541:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M007086">
                    
                    <a name="M007086"></a><b>util_gzip</b>(data)
                    
                </div>
                
                <div class="description">
                  <p>
Gzips <tt>data</tt>.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007086_source')" id="l_M007086_source">show</a>
                        
                    </p>
                    <div id="M007086_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rubygems/test_case.rb, line 546</span>
546:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">util_gzip</span>(<span class="ruby-identifier">data</span>)
547:     <span class="ruby-identifier">out</span> = <span class="ruby-constant">StringIO</span>.<span class="ruby-identifier">new</span>
548: 
549:     <span class="ruby-constant">Zlib</span><span class="ruby-operator">::</span><span class="ruby-constant">GzipWriter</span>.<span class="ruby-identifier">wrap</span> <span class="ruby-identifier">out</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">io</span><span class="ruby-operator">|</span>
550:       <span class="ruby-identifier">io</span>.<span class="ruby-identifier">write</span> <span class="ruby-identifier">data</span>
551:     <span class="ruby-keyword kw">end</span>
552: 
553:     <span class="ruby-identifier">out</span>.<span class="ruby-identifier">string</span>
554:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M007087">
                    
                    <a name="M007087"></a><b>util_make_gems</b>(prerelease = false)
                    
                </div>
                
                <div class="description">
                  <p>
Creates several default gems which all have a lib/code.rb file. The gems
are not installed but are available in the cache dir.
</p>
<table>
<tr><td valign="top">+@a1+:</td><td>gem a version 1, this is the best-described gem.

</td></tr>
<tr><td valign="top">+@a2+:</td><td>gem a version 2

</td></tr>
<tr><td valign="top">+@a3a:</td><td>gem a version 3.a

</td></tr>
<tr><td valign="top">+@a_evil9+:</td><td>gem a_evil version 9, use this to ensure similarly-named gems don&#8217;t
collide with a.

</td></tr>
<tr><td valign="top">+@b2+:</td><td>gem b version 2

</td></tr>
<tr><td valign="top">+@c1_2+:</td><td>gem c version 1.2

</td></tr>
<tr><td valign="top">+@pl1+:</td><td>gem pl version 1, this gem has a legacy platform of i386-linux.

</td></tr>
</table>
<p>
Additional <tt>prerelease</tt> gems may also be created:
</p>
<table>
<tr><td valign="top">+@a2_pre+:</td><td>gem a version 2.a

</td></tr>
</table>
<p>
TODO: nuke this and fix tests. this should speed up a lot
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007087_source')" id="l_M007087_source">show</a>
                        
                    </p>
                    <div id="M007087_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rubygems/test_case.rb, line 574</span>
574:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">util_make_gems</span>(<span class="ruby-identifier">prerelease</span> = <span class="ruby-keyword kw">false</span>)
575:     <span class="ruby-ivar">@a1</span> = <span class="ruby-identifier">quick_gem</span> <span class="ruby-value str">'a'</span>, <span class="ruby-value str">'1'</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
576:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">files</span> = <span class="ruby-node">%w[lib/code.rb]</span>
577:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">require_paths</span> = <span class="ruby-node">%w[lib]</span>
578:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">date</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span><span class="ruby-operator">::</span><span class="ruby-constant">TODAY</span> <span class="ruby-operator">-</span> <span class="ruby-value">86400</span>
579:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">homepage</span> = <span class="ruby-value str">'http://a.example.com'</span>
580:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">email</span> = <span class="ruby-node">%w[example@example.com example2@example.com]</span>
581:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">authors</span> = <span class="ruby-node">%w[Example Example2]</span>
582:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">description</span> = <span class="ruby-value str">&quot;This line is really, really long.  So long, in fact, that it is more than eighty characters long!  The purpose of this line is for testing wrapping behavior because sometimes people don't wrap their text to eighty characters.  Without the wrapping, the text might not look good in the RSS feed.\n\nAlso, a list:\n* An entry that\\'s actually kind of sort\n* an entry that\\'s really long, which will probably get wrapped funny.  That's ok, somebody wasn't thinking straight when they made it more than eighty characters.\n&quot;</span>
583:     <span class="ruby-keyword kw">end</span>
584: 
585:     <span class="ruby-identifier">init</span> = <span class="ruby-identifier">proc</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
586:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">files</span> = <span class="ruby-node">%w[lib/code.rb]</span>
587:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">require_paths</span> = <span class="ruby-node">%w[lib]</span>
588:     <span class="ruby-keyword kw">end</span>
589: 
590:     <span class="ruby-ivar">@a2</span>      = <span class="ruby-identifier">quick_gem</span>(<span class="ruby-value str">'a'</span>, <span class="ruby-value str">'2'</span>,      <span class="ruby-operator">&amp;</span><span class="ruby-identifier">init</span>)
591:     <span class="ruby-ivar">@a3a</span>     = <span class="ruby-identifier">quick_gem</span>(<span class="ruby-value str">'a'</span>, <span class="ruby-value str">'3.a'</span>,    <span class="ruby-operator">&amp;</span><span class="ruby-identifier">init</span>)
592:     <span class="ruby-ivar">@a_evil9</span> = <span class="ruby-identifier">quick_gem</span>(<span class="ruby-value str">'a_evil'</span>, <span class="ruby-value str">'9'</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">init</span>)
593:     <span class="ruby-ivar">@b2</span>      = <span class="ruby-identifier">quick_gem</span>(<span class="ruby-value str">'b'</span>, <span class="ruby-value str">'2'</span>,      <span class="ruby-operator">&amp;</span><span class="ruby-identifier">init</span>)
594:     <span class="ruby-ivar">@c1_2</span>    = <span class="ruby-identifier">quick_gem</span>(<span class="ruby-value str">'c'</span>, <span class="ruby-value str">'1.2'</span>,    <span class="ruby-operator">&amp;</span><span class="ruby-identifier">init</span>)
595: 
596:     <span class="ruby-ivar">@pl1</span>     = <span class="ruby-identifier">quick_gem</span> <span class="ruby-value str">'pl'</span>, <span class="ruby-value str">'1'</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span> <span class="ruby-comment cmt"># l for legacy</span>
597:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">files</span> = <span class="ruby-node">%w[lib/code.rb]</span>
598:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">require_paths</span> = <span class="ruby-node">%w[lib]</span>
599:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">platform</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Platform</span>.<span class="ruby-identifier">new</span> <span class="ruby-value str">'i386-linux'</span>
600:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">instance_variable_set</span> <span class="ruby-identifier">:@original_platform</span>, <span class="ruby-value str">'i386-linux'</span>
601:     <span class="ruby-keyword kw">end</span>
602: 
603:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">prerelease</span>
604:       <span class="ruby-ivar">@a2_pre</span> = <span class="ruby-identifier">quick_gem</span>(<span class="ruby-value str">'a'</span>, <span class="ruby-value str">'2.a'</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">init</span>)
605:       <span class="ruby-identifier">write_file</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-operator">*</span>??[<span class="ruby-identifier">gems</span> <span class="ruby-comment cmt">#{@a2_pre.original_name} lib code.rb])</span>
606:       <span class="ruby-identifier">util_build_gem</span> <span class="ruby-ivar">@a2_pre</span>
607:     <span class="ruby-keyword kw">end</span>
608: 
609:     <span class="ruby-identifier">write_file</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-operator">*</span>??[<span class="ruby-identifier">gems</span> <span class="ruby-comment cmt">#{@a1.original_name}   lib code.rb])</span>
610:     <span class="ruby-identifier">write_file</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-operator">*</span>??[<span class="ruby-identifier">gems</span> <span class="ruby-comment cmt">#{@a2.original_name}   lib code.rb])</span>
611:     <span class="ruby-identifier">write_file</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-operator">*</span>??[<span class="ruby-identifier">gems</span> <span class="ruby-comment cmt">#{@a3a.original_name}  lib code.rb])</span>
612:     <span class="ruby-identifier">write_file</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-operator">*</span>??[<span class="ruby-identifier">gems</span> <span class="ruby-comment cmt">#{@b2.original_name}   lib code.rb])</span>
613:     <span class="ruby-identifier">write_file</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-operator">*</span>??[<span class="ruby-identifier">gems</span> <span class="ruby-comment cmt">#{@c1_2.original_name} lib code.rb])</span>
614:     <span class="ruby-identifier">write_file</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-operator">*</span>??[<span class="ruby-identifier">gems</span> <span class="ruby-comment cmt">#{@pl1.original_name}  lib code.rb])</span>
615: 
616:     [<span class="ruby-ivar">@a1</span>, <span class="ruby-ivar">@a2</span>, <span class="ruby-ivar">@a3a</span>, <span class="ruby-ivar">@a_evil9</span>, <span class="ruby-ivar">@b2</span>, <span class="ruby-ivar">@c1_2</span>, <span class="ruby-ivar">@pl1</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">spec</span><span class="ruby-operator">|</span>
617:       <span class="ruby-identifier">util_build_gem</span> <span class="ruby-identifier">spec</span>
618:     <span class="ruby-keyword kw">end</span>
619: 
620:     <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm_r</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-ivar">@gemhome</span>, <span class="ruby-value str">&quot;gems&quot;</span>, <span class="ruby-ivar">@pl1</span>.<span class="ruby-identifier">original_name</span>)
621:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M007094">
                    
                    <a name="M007094"></a><b>util_set_arch</b>(arch)
                    
                </div>
                
                <div class="description">
                  <p>
<a href="../Set.html">Set</a> the platform to <tt>arch</tt>
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007094_source')" id="l_M007094_source">show</a>
                        
                    </p>
                    <div id="M007094_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rubygems/test_case.rb, line 633</span>
633:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">util_set_arch</span>(<span class="ruby-identifier">arch</span>)
634:     <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">ConfigMap</span>[<span class="ruby-identifier">:arch</span>] = <span class="ruby-identifier">arch</span>
635:     <span class="ruby-identifier">platform</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Platform</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">arch</span>
636: 
637:     <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">instance_variable_set</span> <span class="ruby-identifier">:@platforms</span>, <span class="ruby-keyword kw">nil</span>
638:     <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Platform</span>.<span class="ruby-identifier">instance_variable_set</span> <span class="ruby-identifier">:@local</span>, <span class="ruby-keyword kw">nil</span>
639: 
640:     <span class="ruby-identifier">platform</span>
641:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M007097">
                    
                    <a name="M007097"></a><b>util_setup_fake_fetcher</b>(prerelease = false)
                    
                </div>
                
                <div class="description">
                  <p>
Sets up a fake fetcher using the gems from <a
href="TestCase.html#M007087">util_make_gems</a>. Optionally additional
<tt>prerelease</tt> gems may be included.
</p>
<p>
Gems created by this method may be fetched using <a
href="RemoteFetcher.html">Gem::RemoteFetcher</a>.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007097_source')" id="l_M007097_source">show</a>
                        
                    </p>
                    <div id="M007097_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rubygems/test_case.rb, line 649</span>
649:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">util_setup_fake_fetcher</span>(<span class="ruby-identifier">prerelease</span> = <span class="ruby-keyword kw">false</span>)
650:     <span class="ruby-identifier">require</span> <span class="ruby-value str">'zlib'</span>
651:     <span class="ruby-identifier">require</span> <span class="ruby-value str">'socket'</span>
652:     <span class="ruby-identifier">require</span> <span class="ruby-value str">'rubygems/remote_fetcher'</span>
653: 
654:     <span class="ruby-ivar">@fetcher</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">FakeFetcher</span>.<span class="ruby-identifier">new</span>
655: 
656:     <span class="ruby-identifier">util_make_gems</span>(<span class="ruby-identifier">prerelease</span>)
657:     <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span>.<span class="ruby-identifier">reset</span>
658: 
659:     <span class="ruby-ivar">@all_gems</span> = [<span class="ruby-ivar">@a1</span>, <span class="ruby-ivar">@a2</span>, <span class="ruby-ivar">@a3a</span>, <span class="ruby-ivar">@a_evil9</span>, <span class="ruby-ivar">@b2</span>, <span class="ruby-ivar">@c1_2</span>].<span class="ruby-identifier">sort</span>
660:     <span class="ruby-ivar">@all_gem_names</span> = <span class="ruby-ivar">@all_gems</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">gem</span><span class="ruby-operator">|</span> <span class="ruby-identifier">gem</span>.<span class="ruby-identifier">full_name</span> }
661: 
662:     <span class="ruby-identifier">gem_names</span> = [<span class="ruby-ivar">@a1</span>.<span class="ruby-identifier">full_name</span>, <span class="ruby-ivar">@a2</span>.<span class="ruby-identifier">full_name</span>, <span class="ruby-ivar">@a3a</span>.<span class="ruby-identifier">full_name</span>, <span class="ruby-ivar">@b2</span>.<span class="ruby-identifier">full_name</span>]
663:     <span class="ruby-ivar">@gem_names</span> = <span class="ruby-identifier">gem_names</span>.<span class="ruby-identifier">sort</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;\n&quot;</span>)
664: 
665:     <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">RemoteFetcher</span>.<span class="ruby-identifier">fetcher</span> = <span class="ruby-ivar">@fetcher</span>
666:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M007099">
                    
                    <a name="M007099"></a><b>util_setup_spec_fetcher</b>(*specs)
                    
                </div>
                
                <div class="description">
                  <p>
Sets up <a href="SpecFetcher.html">Gem::SpecFetcher</a> to return
information from the gems in <tt>specs</tt>. Best used with +@all_gems+
from <a href="TestCase.html#M007097">util_setup_fake_fetcher</a>.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007099_source')" id="l_M007099_source">show</a>
                        
                    </p>
                    <div id="M007099_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rubygems/test_case.rb, line 672</span>
672:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">util_setup_spec_fetcher</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">specs</span>)
673:     <span class="ruby-identifier">specs</span> <span class="ruby-operator">-=</span> <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span>.<span class="ruby-identifier">_all</span>
674:     <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span>.<span class="ruby-identifier">add_specs</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">specs</span>)
675: 
676:     <span class="ruby-identifier">spec_fetcher</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">SpecFetcher</span>.<span class="ruby-identifier">fetcher</span>
677: 
678:     <span class="ruby-identifier">prerelease</span>, <span class="ruby-identifier">_</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span>.<span class="ruby-identifier">partition</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">spec</span><span class="ruby-operator">|</span>
679:       <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">version</span>.<span class="ruby-identifier">prerelease?</span>
680:     }
681: 
682:     <span class="ruby-identifier">spec_fetcher</span>.<span class="ruby-identifier">specs</span>[<span class="ruby-ivar">@uri</span>] = []
683:     <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">spec</span><span class="ruby-operator">|</span>
684:       <span class="ruby-identifier">spec_tuple</span> = [<span class="ruby-identifier">spec</span>.<span class="ruby-identifier">name</span>, <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">version</span>, <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">original_platform</span>]
685:       <span class="ruby-identifier">spec_fetcher</span>.<span class="ruby-identifier">specs</span>[<span class="ruby-ivar">@uri</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">spec_tuple</span>
686:     <span class="ruby-keyword kw">end</span>
687: 
688:     <span class="ruby-identifier">spec_fetcher</span>.<span class="ruby-identifier">latest_specs</span>[<span class="ruby-ivar">@uri</span>] = []
689:     <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span>.<span class="ruby-identifier">latest_specs</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">spec</span><span class="ruby-operator">|</span>
690:       <span class="ruby-identifier">spec_tuple</span> = [<span class="ruby-identifier">spec</span>.<span class="ruby-identifier">name</span>, <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">version</span>, <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">original_platform</span>]
691:       <span class="ruby-identifier">spec_fetcher</span>.<span class="ruby-identifier">latest_specs</span>[<span class="ruby-ivar">@uri</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">spec_tuple</span>
692:     <span class="ruby-keyword kw">end</span>
693: 
694:     <span class="ruby-identifier">spec_fetcher</span>.<span class="ruby-identifier">prerelease_specs</span>[<span class="ruby-ivar">@uri</span>] = []
695:     <span class="ruby-identifier">prerelease</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">spec</span><span class="ruby-operator">|</span>
696:       <span class="ruby-identifier">spec_tuple</span> = [<span class="ruby-identifier">spec</span>.<span class="ruby-identifier">name</span>, <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">version</span>, <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">original_platform</span>]
697:       <span class="ruby-identifier">spec_fetcher</span>.<span class="ruby-identifier">prerelease_specs</span>[<span class="ruby-ivar">@uri</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">spec_tuple</span>
698:     <span class="ruby-keyword kw">end</span>
699: 
700:     <span class="ruby-identifier">v</span> = <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">marshal_version</span>
701: 
702:     <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">spec</span><span class="ruby-operator">|</span>
703:       <span class="ruby-identifier">path</span> = <span class="ruby-node">&quot;#{@gem_repo}quick/Marshal.#{v}/#{spec.original_name}.gemspec.rz&quot;</span>
704:       <span class="ruby-identifier">data</span> = <span class="ruby-constant">Marshal</span>.<span class="ruby-identifier">dump</span> <span class="ruby-identifier">spec</span>
705:       <span class="ruby-identifier">data_deflate</span> = <span class="ruby-constant">Zlib</span><span class="ruby-operator">::</span><span class="ruby-constant">Deflate</span>.<span class="ruby-identifier">deflate</span> <span class="ruby-identifier">data</span>
706:       <span class="ruby-ivar">@fetcher</span>.<span class="ruby-identifier">data</span>[<span class="ruby-identifier">path</span>] = <span class="ruby-identifier">data_deflate</span>
707:     <span class="ruby-keyword kw">end</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">RemoteFetcher</span> <span class="ruby-operator">===</span> <span class="ruby-ivar">@fetcher</span> <span class="ruby-comment cmt"># HACK for test_download_to_cache</span>
708: 
709:     <span class="ruby-keyword kw">nil</span> <span class="ruby-comment cmt"># force errors</span>
710:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M007082">
                    
                    <a name="M007082"></a><b>util_spec</b>(name, version, deps = nil, &amp;block)
                    
                </div>
                
                <div class="description">
                  <p>
Creates a spec with <tt>name</tt>, <tt>version</tt> and <tt>deps</tt>.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007082_source')" id="l_M007082_source">show</a>
                        
                    </p>
                    <div id="M007082_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rubygems/test_case.rb, line 496</span>
496:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">util_spec</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">version</span>, <span class="ruby-identifier">deps</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
497:     <span class="ruby-comment cmt"># TODO: deprecate</span>
498:     <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;deps or block, not both&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">deps</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">block</span>
499: 
500:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">deps</span> <span class="ruby-keyword kw">then</span>
501:       <span class="ruby-identifier">block</span> = <span class="ruby-identifier">proc</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
502:         <span class="ruby-identifier">deps</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">n</span>, <span class="ruby-identifier">req</span><span class="ruby-operator">|</span>
503:           <span class="ruby-identifier">s</span>.<span class="ruby-identifier">add_dependency</span> <span class="ruby-identifier">n</span>, (<span class="ruby-identifier">req</span> <span class="ruby-operator">||</span> <span class="ruby-value str">'&gt;= 0'</span>)
504:         <span class="ruby-keyword kw">end</span>
505:       <span class="ruby-keyword kw">end</span>
506:     <span class="ruby-keyword kw">end</span>
507: 
508:     <span class="ruby-identifier">quick_spec</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">version</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
509:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M007102">
                    
                    <a name="M007102"></a><b>util_zip</b>(data)
                    
                </div>
                
                <div class="description">
                  <p>
Deflates <tt>data</tt>
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007102_source')" id="l_M007102_source">show</a>
                        
                    </p>
                    <div id="M007102_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rubygems/test_case.rb, line 715</span>
715:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">util_zip</span>(<span class="ruby-identifier">data</span>)
716:     <span class="ruby-constant">Zlib</span><span class="ruby-operator">::</span><span class="ruby-constant">Deflate</span>.<span class="ruby-identifier">deflate</span> <span class="ruby-identifier">data</span>
717:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M007124">
                    
                    <a name="M007124"></a><b>v</b>(string)
                    
                </div>
                
                <div class="description">
                  <p>
Construct a new <a href="Version.html">Gem::Version</a>.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007124_source')" id="l_M007124_source">show</a>
                        
                    </p>
                    <div id="M007124_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rubygems/test_case.rb, line 873</span>
873:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">v</span> <span class="ruby-identifier">string</span>
874:     <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Version</span>.<span class="ruby-identifier">create</span> <span class="ruby-identifier">string</span>
875:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M007107">
                    
                    <a name="M007107"></a><b>vc_windows?</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Returns whether or not we&#8217;re on a version of Ruby built with VC++ (or
Borland) versus Cygwin, Mingw, etc.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007107_source')" id="l_M007107_source">show</a>
                        
                    </p>
                    <div id="M007107_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rubygems/test_case.rb, line 745</span>
745:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">vc_windows?</span>
746:     <span class="ruby-constant">RUBY_PLATFORM</span>.<span class="ruby-identifier">match</span>(<span class="ruby-value str">'mswin'</span>)
747:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M007104">
                    
                    <a name="M007104"></a><b>win_platform?</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Is this test being run on a Windows platform?
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007104_source')" id="l_M007104_source">show</a>
                        
                    </p>
                    <div id="M007104_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rubygems/test_case.rb, line 729</span>
729:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">win_platform?</span>
730:     <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">win_platform?</span>
731:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M007057">
                    
                    <a name="M007057"></a><b>write_file</b>(path)
                    
                </div>
                
                <div class="description">
                  <p>
Writes a binary file to <tt>path</tt> which is relative to +@gemhome+
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007057_source')" id="l_M007057_source">show</a>
                        
                    </p>
                    <div id="M007057_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rubygems/test_case.rb, line 328</span>
328:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">write_file</span>(<span class="ruby-identifier">path</span>)
329:     <span class="ruby-identifier">path</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span> <span class="ruby-ivar">@gemhome</span>, <span class="ruby-identifier">path</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">Pathname</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">path</span>).<span class="ruby-identifier">absolute?</span>
330:     <span class="ruby-identifier">dir</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span> <span class="ruby-identifier">path</span>
331:     <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-identifier">dir</span>
332: 
333:     <span class="ruby-identifier">open</span> <span class="ruby-identifier">path</span>, <span class="ruby-value str">'wb'</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">io</span><span class="ruby-operator">|</span>
334:       <span class="ruby-keyword kw">yield</span> <span class="ruby-identifier">io</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block_given?</span>
335:     <span class="ruby-keyword kw">end</span>
336: 
337:     <span class="ruby-identifier">path</span>
338:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    