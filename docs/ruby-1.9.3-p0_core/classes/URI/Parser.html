<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>URI::Parser</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../css/main.css" type="text/css" media="screen" />
    <script src="../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Class</span> 
            URI::Parser 
            
                <span class="parent">&lt; 
                    
                    <a href="../Object.html">Object</a>
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../files/lib/uri/common_rb.html">lib/uri/common.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    
    <div class="description">
        <p>
class that Parses String&#8217;s into URI&#8217;s
</p>
<p>
It contains a <a href="../Hash.html">Hash</a> set of patterns and
Regexp&#8217;s that match and validate.
</p>

    </div>
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>C</dt>
        <dd>
            <ul>
                
                <li><a href="#M007806">convert_to_uri</a></li>
                
            </ul>
        </dd>
    
        <dt>E</dt>
        <dd>
            <ul>
                
                <li><a href="#M007791">escape</a>,</li>
                
                <li><a href="#M007789">extract</a></li>
                
            </ul>
        </dd>
    
        <dt>I</dt>
        <dd>
            <ul>
                
                <li><a href="#M007794">initialize_pattern</a>,</li>
                
                <li><a href="#M007800">initialize_regexp</a>,</li>
                
                <li><a href="#M007793">inspect</a></li>
                
            </ul>
        </dd>
    
        <dt>J</dt>
        <dd>
            <ul>
                
                <li><a href="#M007788">join</a></li>
                
            </ul>
        </dd>
    
        <dt>M</dt>
        <dd>
            <ul>
                
                <li><a href="#M007790">make_regexp</a></li>
                
            </ul>
        </dd>
    
        <dt>N</dt>
        <dd>
            <ul>
                
                <li><a href="#M007783">new</a></li>
                
            </ul>
        </dd>
    
        <dt>P</dt>
        <dd>
            <ul>
                
                <li><a href="#M007787">parse</a></li>
                
            </ul>
        </dd>
    
        <dt>S</dt>
        <dd>
            <ul>
                
                <li><a href="#M007784">split</a></li>
                
            </ul>
        </dd>
    
        <dt>U</dt>
        <dd>
            <ul>
                
                <li><a href="#M007792">unescape</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    
    <div class="sectiontitle">Included Modules</div>
    <ul>
        
        <li>
            
            <a href="REGEXP.html">URI::REGEXP</a>
            
            START:includes
        </li>
        
    </ul>
    

    

    

    

    
    <div class="sectiontitle">Attributes</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>pattern</td>
            <td class='attr-desc'><p>
The <a href="../Hash.html">Hash</a> of patterns.
</p>
<p>
see also <a href="Parser.html#M007794">URI::Parser.initialize_pattern</a>
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>regexp</td>
            <td class='attr-desc'><p>
The <a href="../Hash.html">Hash</a> of <a href="../Regexp.html">Regexp</a>
</p>
<p>
see also <a href="Parser.html#M007800">URI::Parser.initialize_regexp</a>
</p></td>
        </tr>
        
    </table>
    

    
            <div class="sectiontitle">Class Public methods</div>
            
            <div class="method">
                <div class="title" id="M007783">
                    
                    <a name="M007783"></a><b>new</b>(opts = {})
                    
                </div>
                
                <div class="description">
                  <h2>Synopsis</h2>
<pre>
  URI::Parser.new([opts])
</pre>
<h2>Args</h2>
<p>
The constructor accepts a hash as options for parser. Keys of options are
pattern names of <a href="../URI.html">URI</a> components and values of
options are pattern strings. The constructor generetes set of regexps for
parsing URIs.
</p>
<p>
You can use the following keys:
</p>
<pre>
  * :ESCAPED (URI::PATTERN::ESCAPED in default)
  * :UNRESERVED (URI::PATTERN::UNRESERVED in default)
  * :DOMLABEL (URI::PATTERN::DOMLABEL in default)
  * :TOPLABEL (URI::PATTERN::TOPLABEL in default)
  * :HOSTNAME (URI::PATTERN::HOSTNAME in default)
</pre>
<h2>Examples</h2>
<pre>
  p = URI::Parser.new(:ESCAPED =&gt; &quot;(?:%[a-fA-F0-9]{2}|%u[a-fA-F0-9]{4})&quot;)
  u = p.parse(&quot;http://example.jp/%uABCD&quot;) #=&gt; #&lt;URI::HTTP:0xb78cf4f8 URL:http://example.jp/%uABCD&gt;
  URI.parse(u.to_s) #=&gt; raises URI::InvalidURIError

  s = &quot;http://examle.com/ABCD&quot;
  u1 = p.parse(s) #=&gt; #&lt;URI::HTTP:0xb78c3220 URL:http://example.com/ABCD&gt;
  u2 = URI.parse(s) #=&gt; #&lt;URI::HTTP:0xb78b6d54 URL:http://example.com/ABCD&gt;
  u1 == u2 #=&gt; true
  u1.eql?(u2) #=&gt; false
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007783_source')" id="l_M007783_source">show</a>
                        
                    </p>
                    <div id="M007783_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/uri/common.rb, line 99</span>
 99:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">opts</span> = {})
100:       <span class="ruby-ivar">@pattern</span> = <span class="ruby-identifier">initialize_pattern</span>(<span class="ruby-identifier">opts</span>)
101:       <span class="ruby-ivar">@pattern</span>.<span class="ruby-identifier">each_value</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">freeze</span>}
102:       <span class="ruby-ivar">@pattern</span>.<span class="ruby-identifier">freeze</span>
103: 
104:       <span class="ruby-ivar">@regexp</span> = <span class="ruby-identifier">initialize_regexp</span>(<span class="ruby-ivar">@pattern</span>)
105:       <span class="ruby-ivar">@regexp</span>.<span class="ruby-identifier">each_value</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">freeze</span>}
106:       <span class="ruby-ivar">@regexp</span>.<span class="ruby-identifier">freeze</span>
107:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M007791">
                    
                    <a name="M007791"></a><b>escape( str )
escape( str, unsafe )
</b>
                    
                </div>
                
                <div class="description">
                  <h2>Args</h2>
<table>
<tr><td valign="top"><tt>str</tt>:</td><td><a href="../String.html">String</a> to make safe

</td></tr>
<tr><td valign="top"><tt>unsafe</tt>:</td><td><a href="../Regexp.html">Regexp</a> to apply. Defaults to
self.regexp[:UNSAFE]

</td></tr>
</table>
<h2>Description</h2>
<p>
constructs a safe <a href="../String.html">String</a> from <tt>str</tt>,
removing unsafe characters, replacing them with codes.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007791_source')" id="l_M007791_source">show</a>
                        
                    </p>
                    <div id="M007791_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/uri/common.rb, line 299</span>
299:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">escape</span>(<span class="ruby-identifier">str</span>, <span class="ruby-identifier">unsafe</span> = <span class="ruby-ivar">@regexp</span>[<span class="ruby-identifier">:UNSAFE</span>])
300:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">unsafe</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">Regexp</span>)
301:         <span class="ruby-comment cmt"># perhaps unsafe is String object</span>
302:         <span class="ruby-identifier">unsafe</span> = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;[#{Regexp.quote(unsafe)}]&quot;</span>, <span class="ruby-keyword kw">false</span>)
303:       <span class="ruby-keyword kw">end</span>
304:       <span class="ruby-identifier">str</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-identifier">unsafe</span>) <span class="ruby-keyword kw">do</span>
305:         <span class="ruby-identifier">us</span> = <span class="ruby-identifier">$&amp;</span>
306:         <span class="ruby-identifier">tmp</span> = <span class="ruby-value str">''</span>
307:         <span class="ruby-identifier">us</span>.<span class="ruby-identifier">each_byte</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">uc</span><span class="ruby-operator">|</span>
308:           <span class="ruby-identifier">tmp</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">sprintf</span>(<span class="ruby-value str">'%%%02X'</span>, <span class="ruby-identifier">uc</span>)
309:         <span class="ruby-keyword kw">end</span>
310:         <span class="ruby-identifier">tmp</span>
311:       <span class="ruby-keyword kw">end</span>.<span class="ruby-identifier">force_encoding</span>(<span class="ruby-constant">Encoding</span><span class="ruby-operator">::</span><span class="ruby-constant">US_ASCII</span>)
312:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M007789">
                    
                    <a name="M007789"></a><b>extract( str )
extract( str, schemes )
extract( str, schemes ) {|item| block }
</b>
                    
                </div>
                
                <div class="description">
                  <h2>Args</h2>
<table>
<tr><td valign="top"><tt>str</tt>:</td><td><a href="../String.html">String</a> to search

</td></tr>
<tr><td valign="top"><tt>schemes</tt>:</td><td>Patterns to apply to <tt>str</tt>

</td></tr>
</table>
<h2>Description</h2>
<p>
Attempts to parse and merge a set of URIs If no <tt>block</tt> given , then
returns the result, else it calls <tt>block</tt> for each element in
result.
</p>
<p>
see also <a href="Parser.html#M007790">URI::Parser.make_regexp</a>
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007789_source')" id="l_M007789_source">show</a>
                        
                    </p>
                    <div id="M007789_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/uri/common.rb, line 261</span>
261:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">extract</span>(<span class="ruby-identifier">str</span>, <span class="ruby-identifier">schemes</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
262:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block_given?</span>
263:         <span class="ruby-identifier">str</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-identifier">make_regexp</span>(<span class="ruby-identifier">schemes</span>)) { <span class="ruby-keyword kw">yield</span> <span class="ruby-identifier">$&amp;</span> }
264:         <span class="ruby-keyword kw">nil</span>
265:       <span class="ruby-keyword kw">else</span>
266:         <span class="ruby-identifier">result</span> = []
267:         <span class="ruby-identifier">str</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-identifier">make_regexp</span>(<span class="ruby-identifier">schemes</span>)) { <span class="ruby-identifier">result</span>.<span class="ruby-identifier">push</span> <span class="ruby-identifier">$&amp;</span> }
268:         <span class="ruby-identifier">result</span>
269:       <span class="ruby-keyword kw">end</span>
270:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M007793">
                    
                    <a name="M007793"></a><b>inspect</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007793_source')" id="l_M007793_source">show</a>
                        
                    </p>
                    <div id="M007793_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/uri/common.rb, line 335</span>
335:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">inspect</span>
336:       <span class="ruby-ivar">@@to_s</span>.<span class="ruby-identifier">bind</span>(<span class="ruby-keyword kw">self</span>).<span class="ruby-identifier">call</span>
337:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M007788">
                    
                    <a name="M007788"></a><b>join</b>(*uris)
                    
                </div>
                
                <div class="description">
                  <h2>Args</h2>
<table>
<tr><td valign="top"><tt>uris</tt>:</td><td>an <a href="../Array.html">Array</a> of Strings

</td></tr>
</table>
<h2>Description</h2>
<p>
Attempts to parse and merge a set of URIs
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007788_source')" id="l_M007788_source">show</a>
                        
                    </p>
                    <div id="M007788_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/uri/common.rb, line 235</span>
235:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">join</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">uris</span>)
236:       <span class="ruby-identifier">uris</span>[<span class="ruby-value">0</span>] = <span class="ruby-identifier">convert_to_uri</span>(<span class="ruby-identifier">uris</span>[<span class="ruby-value">0</span>])
237:       <span class="ruby-identifier">uris</span>.<span class="ruby-identifier">inject</span> <span class="ruby-identifier">:merge</span>
238:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M007790">
                    
                    <a name="M007790"></a><b>make_regexp</b>(schemes = nil)
                    
                </div>
                
                <div class="description">
                  <p>
returns <a href="../Regexp.html">Regexp</a> that is default
self.regexp[:ABS_URI_REF], unless <tt>schemes</tt> is provided. Then it is
a <a href="../Regexp.html#M001257">Regexp.union</a> with
self.pattern[:X_ABS_URI]
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007790_source')" id="l_M007790_source">show</a>
                        
                    </p>
                    <div id="M007790_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/uri/common.rb, line 274</span>
274:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">make_regexp</span>(<span class="ruby-identifier">schemes</span> = <span class="ruby-keyword kw">nil</span>)
275:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">schemes</span>
276:         <span class="ruby-ivar">@regexp</span>[<span class="ruby-identifier">:ABS_URI_REF</span>]
277:       <span class="ruby-keyword kw">else</span>
278:         <span class="ruby-node">/(?=#{Regexp.union(*schemes)}:)#{@pattern[:X_ABS_URI]}/</span><span class="ruby-identifier">x</span>
279:       <span class="ruby-keyword kw">end</span>
280:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M007787">
                    
                    <a name="M007787"></a><b>parse</b>(uri)
                    
                </div>
                
                <div class="description">
                  <h2>Args</h2>
<table>
<tr><td valign="top"><tt>uri</tt>:</td><td><a href="../String.html">String</a>

</td></tr>
</table>
<h2>Description</h2>
<p>
parses <tt>uri</tt> and constructs either matching <a
href="../URI.html">URI</a> scheme object (<a href="FTP.html">FTP</a>, <a
href="HTTP.html">HTTP</a>, <a href="HTTPS.html">HTTPS</a>, <a
href="LDAP.html">LDAP</a>, <a href="LDAPS.html">LDAPS</a>, or <a
href="MailTo.html">MailTo</a>) or <a href="Generic.html">URI::Generic</a>
</p>
<h2>Usage</h2>
<pre>
  p = URI::Parser.new
  p.parse(&quot;ldap://ldap.example.com/dc=example?user=john&quot;)
  #=&gt; #&lt;URI::LDAP:0x00000000b9e7e8 URL:ldap://ldap.example.com/dc=example?user=john&gt;
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007787_source')" id="l_M007787_source">show</a>
                        
                    </p>
                    <div id="M007787_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/uri/common.rb, line 209</span>
209:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">parse</span>(<span class="ruby-identifier">uri</span>)
210:       <span class="ruby-identifier">scheme</span>, <span class="ruby-identifier">userinfo</span>, <span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>,
211:         <span class="ruby-identifier">registry</span>, <span class="ruby-identifier">path</span>, <span class="ruby-identifier">opaque</span>, <span class="ruby-identifier">query</span>, <span class="ruby-identifier">fragment</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">split</span>(<span class="ruby-identifier">uri</span>)
212: 
213:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">scheme</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-constant">URI</span>.<span class="ruby-identifier">scheme_list</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">scheme</span>.<span class="ruby-identifier">upcase</span>)
214:         <span class="ruby-constant">URI</span>.<span class="ruby-identifier">scheme_list</span>[<span class="ruby-identifier">scheme</span>.<span class="ruby-identifier">upcase</span>].<span class="ruby-identifier">new</span>(<span class="ruby-identifier">scheme</span>, <span class="ruby-identifier">userinfo</span>, <span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>,
215:                                            <span class="ruby-identifier">registry</span>, <span class="ruby-identifier">path</span>, <span class="ruby-identifier">opaque</span>, <span class="ruby-identifier">query</span>,
216:                                            <span class="ruby-identifier">fragment</span>, <span class="ruby-keyword kw">self</span>)
217:       <span class="ruby-keyword kw">else</span>
218:         <span class="ruby-constant">Generic</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">scheme</span>, <span class="ruby-identifier">userinfo</span>, <span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>,
219:                     <span class="ruby-identifier">registry</span>, <span class="ruby-identifier">path</span>, <span class="ruby-identifier">opaque</span>, <span class="ruby-identifier">query</span>,
220:                     <span class="ruby-identifier">fragment</span>, <span class="ruby-keyword kw">self</span>)
221:       <span class="ruby-keyword kw">end</span>
222:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M007784">
                    
                    <a name="M007784"></a><b>split</b>(uri)
                    
                </div>
                
                <div class="description">
                  <p>
Returns a split <a href="../URI.html">URI</a> against regexp[:ABS_URI]
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007784_source')" id="l_M007784_source">show</a>
                        
                    </p>
                    <div id="M007784_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/uri/common.rb, line 120</span>
120:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">split</span>(<span class="ruby-identifier">uri</span>)
121:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">uri</span>
122:       <span class="ruby-keyword kw">when</span> <span class="ruby-value str">''</span>
123:         <span class="ruby-comment cmt"># null uri</span>
124: 
125:       <span class="ruby-keyword kw">when</span> <span class="ruby-ivar">@regexp</span>[<span class="ruby-identifier">:ABS_URI</span>]
126:         <span class="ruby-identifier">scheme</span>, <span class="ruby-identifier">opaque</span>, <span class="ruby-identifier">userinfo</span>, <span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>,
127:           <span class="ruby-identifier">registry</span>, <span class="ruby-identifier">path</span>, <span class="ruby-identifier">query</span>, <span class="ruby-identifier">fragment</span> = <span class="ruby-identifier">$~</span>[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>]
128: 
129:         <span class="ruby-comment cmt"># URI-reference = [ absoluteURI | relativeURI ] [ &quot;#&quot; fragment ]</span>
130: 
131:         <span class="ruby-comment cmt"># absoluteURI   = scheme &quot;:&quot; ( hier_part | opaque_part )</span>
132:         <span class="ruby-comment cmt"># hier_part     = ( net_path | abs_path ) [ &quot;?&quot; query ]</span>
133:         <span class="ruby-comment cmt"># opaque_part   = uric_no_slash *uric</span>
134: 
135:         <span class="ruby-comment cmt"># abs_path      = &quot;/&quot;  path_segments</span>
136:         <span class="ruby-comment cmt"># net_path      = &quot;//&quot; authority [ abs_path ]</span>
137: 
138:         <span class="ruby-comment cmt"># authority     = server | reg_name</span>
139:         <span class="ruby-comment cmt"># server        = [ [ userinfo &quot;@&quot; ] hostport ]</span>
140: 
141:         <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">scheme</span>
142:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">InvalidURIError</span>,
143:             <span class="ruby-node">&quot;bad URI(absolute but no scheme): #{uri}&quot;</span>
144:         <span class="ruby-keyword kw">end</span>
145:         <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">opaque</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">path</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">host</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">registry</span>))
146:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">InvalidURIError</span>,
147:             <span class="ruby-node">&quot;bad URI(absolute but no path): #{uri}&quot;</span>
148:         <span class="ruby-keyword kw">end</span>
149: 
150:       <span class="ruby-keyword kw">when</span> <span class="ruby-ivar">@regexp</span>[<span class="ruby-identifier">:REL_URI</span>]
151:         <span class="ruby-identifier">scheme</span> = <span class="ruby-keyword kw">nil</span>
152:         <span class="ruby-identifier">opaque</span> = <span class="ruby-keyword kw">nil</span>
153: 
154:         <span class="ruby-identifier">userinfo</span>, <span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>, <span class="ruby-identifier">registry</span>,
155:           <span class="ruby-identifier">rel_segment</span>, <span class="ruby-identifier">abs_path</span>, <span class="ruby-identifier">query</span>, <span class="ruby-identifier">fragment</span> = <span class="ruby-identifier">$~</span>[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>]
156:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">rel_segment</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">abs_path</span>
157:           <span class="ruby-identifier">path</span> = <span class="ruby-identifier">rel_segment</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">abs_path</span>
158:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">rel_segment</span>
159:           <span class="ruby-identifier">path</span> = <span class="ruby-identifier">rel_segment</span>
160:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">abs_path</span>
161:           <span class="ruby-identifier">path</span> = <span class="ruby-identifier">abs_path</span>
162:         <span class="ruby-keyword kw">end</span>
163: 
164:         <span class="ruby-comment cmt"># URI-reference = [ absoluteURI | relativeURI ] [ &quot;#&quot; fragment ]</span>
165: 
166:         <span class="ruby-comment cmt"># relativeURI   = ( net_path | abs_path | rel_path ) [ &quot;?&quot; query ]</span>
167: 
168:         <span class="ruby-comment cmt"># net_path      = &quot;//&quot; authority [ abs_path ]</span>
169:         <span class="ruby-comment cmt"># abs_path      = &quot;/&quot;  path_segments</span>
170:         <span class="ruby-comment cmt"># rel_path      = rel_segment [ abs_path ]</span>
171: 
172:         <span class="ruby-comment cmt"># authority     = server | reg_name</span>
173:         <span class="ruby-comment cmt"># server        = [ [ userinfo &quot;@&quot; ] hostport ]</span>
174: 
175:       <span class="ruby-keyword kw">else</span>
176:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">InvalidURIError</span>, <span class="ruby-node">&quot;bad URI(is not URI?): #{uri}&quot;</span>
177:       <span class="ruby-keyword kw">end</span>
178: 
179:       <span class="ruby-identifier">path</span> = <span class="ruby-value str">''</span> <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">path</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">opaque</span> <span class="ruby-comment cmt"># (see RFC2396 Section 5.2)</span>
180:       <span class="ruby-identifier">ret</span> = [
181:         <span class="ruby-identifier">scheme</span>,
182:         <span class="ruby-identifier">userinfo</span>, <span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>,         <span class="ruby-comment cmt"># X</span>
183:         <span class="ruby-identifier">registry</span>,                     <span class="ruby-comment cmt"># X</span>
184:         <span class="ruby-identifier">path</span>,                         <span class="ruby-comment cmt"># Y</span>
185:         <span class="ruby-identifier">opaque</span>,                       <span class="ruby-comment cmt"># Y</span>
186:         <span class="ruby-identifier">query</span>,
187:         <span class="ruby-identifier">fragment</span>
188:       ]
189:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">ret</span>
190:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M007792">
                    
                    <a name="M007792"></a><b>unescape( str )
unescape( str, unsafe )
</b>
                    
                </div>
                
                <div class="description">
                  <h2>Args</h2>
<table>
<tr><td valign="top"><tt>str</tt>:</td><td><a href="../String.html">String</a> to remove escapes from

</td></tr>
<tr><td valign="top"><tt>unsafe</tt>:</td><td><a href="../Regexp.html">Regexp</a> to apply. Defaults to
self.regexp[:ESCAPED]

</td></tr>
</table>
<h2>Description</h2>
<p>
Removes escapes from <tt>str</tt>
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007792_source')" id="l_M007792_source">show</a>
                        
                    </p>
                    <div id="M007792_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/uri/common.rb, line 330</span>
330:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">unescape</span>(<span class="ruby-identifier">str</span>, <span class="ruby-identifier">escaped</span> = <span class="ruby-ivar">@regexp</span>[<span class="ruby-identifier">:ESCAPED</span>])
331:       <span class="ruby-identifier">str</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-identifier">escaped</span>) { [<span class="ruby-identifier">$&amp;</span>[<span class="ruby-value">1</span>, <span class="ruby-value">2</span>].<span class="ruby-identifier">hex</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'C'</span>) }.<span class="ruby-identifier">force_encoding</span>(<span class="ruby-identifier">str</span>.<span class="ruby-identifier">encoding</span>)
332:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Private methods</div>
            
            <div class="method">
                <div class="title" id="M007806">
                    
                    <a name="M007806"></a><b>convert_to_uri</b>(uri)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007806_source')" id="l_M007806_source">show</a>
                        
                    </p>
                    <div id="M007806_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/uri/common.rb, line 531</span>
531:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">convert_to_uri</span>(<span class="ruby-identifier">uri</span>)
532:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">uri</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">URI</span><span class="ruby-operator">::</span><span class="ruby-constant">Generic</span>)
533:         <span class="ruby-identifier">uri</span>
534:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">uri</span> = <span class="ruby-constant">String</span>.<span class="ruby-identifier">try_convert</span>(<span class="ruby-identifier">uri</span>)
535:         <span class="ruby-identifier">parse</span>(<span class="ruby-identifier">uri</span>)
536:       <span class="ruby-keyword kw">else</span>
537:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>,
538:           <span class="ruby-value str">&quot;bad argument (expected URI object or URI string)&quot;</span>
539:       <span class="ruby-keyword kw">end</span>
540:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M007794">
                    
                    <a name="M007794"></a><b>initialize_pattern</b>(opts = {})
                    
                </div>
                
                <div class="description">
                  <p>
Constructs the default <a href="../Hash.html">Hash</a> of patterns
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007794_source')" id="l_M007794_source">show</a>
                        
                    </p>
                    <div id="M007794_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/uri/common.rb, line 342</span>
342:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize_pattern</span>(<span class="ruby-identifier">opts</span> = {})
343:       <span class="ruby-identifier">ret</span> = {}
344:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:ESCAPED</span>] = <span class="ruby-identifier">escaped</span> = (<span class="ruby-identifier">opts</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:ESCAPED</span>) <span class="ruby-operator">||</span> <span class="ruby-constant">PATTERN</span><span class="ruby-operator">::</span><span class="ruby-constant">ESCAPED</span>)
345:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:UNRESERVED</span>] = <span class="ruby-identifier">unreserved</span> = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:UNRESERVED</span>) <span class="ruby-operator">||</span> <span class="ruby-constant">PATTERN</span><span class="ruby-operator">::</span><span class="ruby-constant">UNRESERVED</span>
346:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:RESERVED</span>] = <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:RESERVED</span>) <span class="ruby-operator">||</span> <span class="ruby-constant">PATTERN</span><span class="ruby-operator">::</span><span class="ruby-constant">RESERVED</span>
347:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:DOMLABEL</span>] = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:DOMLABEL</span>) <span class="ruby-operator">||</span> <span class="ruby-constant">PATTERN</span><span class="ruby-operator">::</span><span class="ruby-constant">DOMLABEL</span>
348:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:TOPLABEL</span>] = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:TOPLABEL</span>) <span class="ruby-operator">||</span> <span class="ruby-constant">PATTERN</span><span class="ruby-operator">::</span><span class="ruby-constant">TOPLABEL</span>
349:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:HOSTNAME</span>] = <span class="ruby-identifier">hostname</span> = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:HOSTNAME</span>)
350: 
351:       <span class="ruby-comment cmt"># RFC 2396 (URI Generic Syntax)</span>
352:       <span class="ruby-comment cmt"># RFC 2732 (IPv6 Literal Addresses in URL's)</span>
353:       <span class="ruby-comment cmt"># RFC 2373 (IPv6 Addressing Architecture)</span>
354: 
355:       <span class="ruby-comment cmt"># uric          = reserved | unreserved | escaped</span>
356:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:URIC</span>] = <span class="ruby-identifier">uric</span> = <span class="ruby-node">&quot;(?:[#{unreserved}#{reserved}]|#{escaped})&quot;</span>
357:       <span class="ruby-comment cmt"># uric_no_slash = unreserved | escaped | &quot;;&quot; | &quot;?&quot; | &quot;:&quot; | &quot;@&quot; |</span>
358:       <span class="ruby-comment cmt">#                 &quot;&amp;&quot; | &quot;=&quot; | &quot;+&quot; | &quot;$&quot; | &quot;,&quot;</span>
359:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:URIC_NO_SLASH</span>] = <span class="ruby-identifier">uric_no_slash</span> = <span class="ruby-node">&quot;(?:[#{unreserved};?:@&amp;=+$,]|#{escaped})&quot;</span>
360:       <span class="ruby-comment cmt"># query         = *uric</span>
361:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:QUERY</span>] = <span class="ruby-identifier">query</span> = <span class="ruby-node">&quot;#{uric}*&quot;</span>
362:       <span class="ruby-comment cmt"># fragment      = *uric</span>
363:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:FRAGMENT</span>] = <span class="ruby-identifier">fragment</span> = <span class="ruby-node">&quot;#{uric}*&quot;</span>
364: 
365:       <span class="ruby-comment cmt"># hostname      = *( domainlabel &quot;.&quot; ) toplabel [ &quot;.&quot; ]</span>
366:       <span class="ruby-comment cmt"># reg-name      = *( unreserved / pct-encoded / sub-delims ) # RFC3986</span>
367:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">hostname</span>
368:         <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:HOSTNAME</span>] = <span class="ruby-identifier">hostname</span> = <span class="ruby-value str">&quot;(?:[a-zA-Z0-9\\-.]|%\\h\\h)+&quot;</span>
369:       <span class="ruby-keyword kw">end</span>
370: 
371:       <span class="ruby-comment cmt"># RFC 2373, APPENDIX B:</span>
372:       <span class="ruby-comment cmt"># IPv6address = hexpart [ &quot;:&quot; IPv4address ]</span>
373:       <span class="ruby-comment cmt"># IPv4address   = 1*3DIGIT &quot;.&quot; 1*3DIGIT &quot;.&quot; 1*3DIGIT &quot;.&quot; 1*3DIGIT</span>
374:       <span class="ruby-comment cmt"># hexpart = hexseq | hexseq &quot;::&quot; [ hexseq ] | &quot;::&quot; [ hexseq ]</span>
375:       <span class="ruby-comment cmt"># hexseq  = hex4 *( &quot;:&quot; hex4)</span>
376:       <span class="ruby-comment cmt"># hex4    = 1*4HEXDIG</span>
377:       <span class="ruby-comment cmt">#</span>
378:       <span class="ruby-comment cmt"># XXX: This definition has a flaw. &quot;::&quot; + IPv4address must be</span>
379:       <span class="ruby-comment cmt"># allowed too.  Here is a replacement.</span>
380:       <span class="ruby-comment cmt">#</span>
381:       <span class="ruby-comment cmt"># IPv4address = 1*3DIGIT &quot;.&quot; 1*3DIGIT &quot;.&quot; 1*3DIGIT &quot;.&quot; 1*3DIGIT</span>
382:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:IPV4ADDR</span>] = <span class="ruby-identifier">ipv4addr</span> = <span class="ruby-value str">&quot;\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}&quot;</span>
383:       <span class="ruby-comment cmt"># hex4     = 1*4HEXDIG</span>
384:       <span class="ruby-identifier">hex4</span> = <span class="ruby-node">&quot;[#{PATTERN::HEX}]{1,4}&quot;</span>
385:       <span class="ruby-comment cmt"># lastpart = hex4 | IPv4address</span>
386:       <span class="ruby-identifier">lastpart</span> = <span class="ruby-node">&quot;(?:#{hex4}|#{ipv4addr})&quot;</span>
387:       <span class="ruby-comment cmt"># hexseq1  = *( hex4 &quot;:&quot; ) hex4</span>
388:       <span class="ruby-identifier">hexseq1</span> = <span class="ruby-node">&quot;(?:#{hex4}:)*#{hex4}&quot;</span>
389:       <span class="ruby-comment cmt"># hexseq2  = *( hex4 &quot;:&quot; ) lastpart</span>
390:       <span class="ruby-identifier">hexseq2</span> = <span class="ruby-node">&quot;(?:#{hex4}:)*#{lastpart}&quot;</span>
391:       <span class="ruby-comment cmt"># IPv6address = hexseq2 | [ hexseq1 ] &quot;::&quot; [ hexseq2 ]</span>
392:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:IPV6ADDR</span>] = <span class="ruby-identifier">ipv6addr</span> = <span class="ruby-node">&quot;(?:#{hexseq2}|(?:#{hexseq1})?::(?:#{hexseq2})?)&quot;</span>
393: 
394:       <span class="ruby-comment cmt"># IPv6prefix  = ( hexseq1 | [ hexseq1 ] &quot;::&quot; [ hexseq1 ] ) &quot;/&quot; 1*2DIGIT</span>
395:       <span class="ruby-comment cmt"># unused</span>
396: 
397:       <span class="ruby-comment cmt"># ipv6reference = &quot;[&quot; IPv6address &quot;]&quot; (RFC 2732)</span>
398:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:IPV6REF</span>] = <span class="ruby-identifier">ipv6ref</span> = <span class="ruby-node">&quot;\\[#{ipv6addr}\\]&quot;</span>
399: 
400:       <span class="ruby-comment cmt"># host          = hostname | IPv4address</span>
401:       <span class="ruby-comment cmt"># host          = hostname | IPv4address | IPv6reference (RFC 2732)</span>
402:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:HOST</span>] = <span class="ruby-identifier">host</span> = <span class="ruby-node">&quot;(?:#{hostname}|#{ipv4addr}|#{ipv6ref})&quot;</span>
403:       <span class="ruby-comment cmt"># port          = *digit</span>
404:       <span class="ruby-identifier">port</span> = <span class="ruby-value str">'\d*'</span>
405:       <span class="ruby-comment cmt"># hostport      = host [ &quot;:&quot; port ]</span>
406:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:HOSTPORT</span>] = <span class="ruby-identifier">hostport</span> = <span class="ruby-node">&quot;#{host}(?::#{port})?&quot;</span>
407: 
408:       <span class="ruby-comment cmt"># userinfo      = *( unreserved | escaped |</span>
409:       <span class="ruby-comment cmt">#                    &quot;;&quot; | &quot;:&quot; | &quot;&amp;&quot; | &quot;=&quot; | &quot;+&quot; | &quot;$&quot; | &quot;,&quot; )</span>
410:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:USERINFO</span>] = <span class="ruby-identifier">userinfo</span> = <span class="ruby-node">&quot;(?:[#{unreserved};:&amp;=+$,]|#{escaped})*&quot;</span>
411: 
412:       <span class="ruby-comment cmt"># pchar         = unreserved | escaped |</span>
413:       <span class="ruby-comment cmt">#                 &quot;:&quot; | &quot;@&quot; | &quot;&amp;&quot; | &quot;=&quot; | &quot;+&quot; | &quot;$&quot; | &quot;,&quot;</span>
414:       <span class="ruby-identifier">pchar</span> = <span class="ruby-node">&quot;(?:[#{unreserved}:@&amp;=+$,]|#{escaped})&quot;</span>
415:       <span class="ruby-comment cmt"># param         = *pchar</span>
416:       <span class="ruby-identifier">param</span> = <span class="ruby-node">&quot;#{pchar}*&quot;</span>
417:       <span class="ruby-comment cmt"># segment       = *pchar *( &quot;;&quot; param )</span>
418:       <span class="ruby-identifier">segment</span> = <span class="ruby-node">&quot;#{pchar}*(?:;#{param})*&quot;</span>
419:       <span class="ruby-comment cmt"># path_segments = segment *( &quot;/&quot; segment )</span>
420:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:PATH_SEGMENTS</span>] = <span class="ruby-identifier">path_segments</span> = <span class="ruby-node">&quot;#{segment}(?:/#{segment})*&quot;</span>
421: 
422:       <span class="ruby-comment cmt"># server        = [ [ userinfo &quot;@&quot; ] hostport ]</span>
423:       <span class="ruby-identifier">server</span> = <span class="ruby-node">&quot;(?:#{userinfo}@)?#{hostport}&quot;</span>
424:       <span class="ruby-comment cmt"># reg_name      = 1*( unreserved | escaped | &quot;$&quot; | &quot;,&quot; |</span>
425:       <span class="ruby-comment cmt">#                     &quot;;&quot; | &quot;:&quot; | &quot;@&quot; | &quot;&amp;&quot; | &quot;=&quot; | &quot;+&quot; )</span>
426:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:REG_NAME</span>] = <span class="ruby-identifier">reg_name</span> = <span class="ruby-node">&quot;(?:[#{unreserved}$,;:@&amp;=+]|#{escaped})+&quot;</span>
427:       <span class="ruby-comment cmt"># authority     = server | reg_name</span>
428:       <span class="ruby-identifier">authority</span> = <span class="ruby-node">&quot;(?:#{server}|#{reg_name})&quot;</span>
429: 
430:       <span class="ruby-comment cmt"># rel_segment   = 1*( unreserved | escaped |</span>
431:       <span class="ruby-comment cmt">#                     &quot;;&quot; | &quot;@&quot; | &quot;&amp;&quot; | &quot;=&quot; | &quot;+&quot; | &quot;$&quot; | &quot;,&quot; )</span>
432:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:REL_SEGMENT</span>] = <span class="ruby-identifier">rel_segment</span> = <span class="ruby-node">&quot;(?:[#{unreserved};@&amp;=+$,]|#{escaped})+&quot;</span>
433: 
434:       <span class="ruby-comment cmt"># scheme        = alpha *( alpha | digit | &quot;+&quot; | &quot;-&quot; | &quot;.&quot; )</span>
435:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:SCHEME</span>] = <span class="ruby-identifier">scheme</span> = <span class="ruby-node">&quot;[#{PATTERN::ALPHA}][\\-+.#{PATTERN::ALPHA}\\d]*&quot;</span>
436: 
437:       <span class="ruby-comment cmt"># abs_path      = &quot;/&quot;  path_segments</span>
438:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:ABS_PATH</span>] = <span class="ruby-identifier">abs_path</span> = <span class="ruby-node">&quot;/#{path_segments}&quot;</span>
439:       <span class="ruby-comment cmt"># rel_path      = rel_segment [ abs_path ]</span>
440:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:REL_PATH</span>] = <span class="ruby-identifier">rel_path</span> = <span class="ruby-node">&quot;#{rel_segment}(?:#{abs_path})?&quot;</span>
441:       <span class="ruby-comment cmt"># net_path      = &quot;//&quot; authority [ abs_path ]</span>
442:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:NET_PATH</span>] = <span class="ruby-identifier">net_path</span> = <span class="ruby-node">&quot;//#{authority}(?:#{abs_path})?&quot;</span>
443: 
444:       <span class="ruby-comment cmt"># hier_part     = ( net_path | abs_path ) [ &quot;?&quot; query ]</span>
445:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:HIER_PART</span>] = <span class="ruby-identifier">hier_part</span> = <span class="ruby-node">&quot;(?:#{net_path}|#{abs_path})(?:\\?(?:#{query}))?&quot;</span>
446:       <span class="ruby-comment cmt"># opaque_part   = uric_no_slash *uric</span>
447:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:OPAQUE_PART</span>] = <span class="ruby-identifier">opaque_part</span> = <span class="ruby-node">&quot;#{uric_no_slash}#{uric}*&quot;</span>
448: 
449:       <span class="ruby-comment cmt"># absoluteURI   = scheme &quot;:&quot; ( hier_part | opaque_part )</span>
450:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:ABS_URI</span>] = <span class="ruby-identifier">abs_uri</span> = <span class="ruby-node">&quot;#{scheme}:(?:#{hier_part}|#{opaque_part})&quot;</span>
451:       <span class="ruby-comment cmt"># relativeURI   = ( net_path | abs_path | rel_path ) [ &quot;?&quot; query ]</span>
452:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:REL_URI</span>] = <span class="ruby-identifier">rel_uri</span> = <span class="ruby-node">&quot;(?:#{net_path}|#{abs_path}|#{rel_path})(?:\\?#{query})?&quot;</span>
453: 
454:       <span class="ruby-comment cmt"># URI-reference = [ absoluteURI | relativeURI ] [ &quot;#&quot; fragment ]</span>
455:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:URI_REF</span>] = <span class="ruby-node">&quot;(?:#{abs_uri}|#{rel_uri})?(?:##{fragment})?&quot;</span>
456: 
457:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:X_ABS_URI</span>] = <span class="ruby-node">&quot;
458:         (#{scheme}):                           (?# 1: scheme)
459:         (?:
460:            (#{opaque_part})                    (?# 2: opaque)
461:         |
462:            (?:(?:
463:              //(?:
464:                  (?:(?:(#{userinfo})@)?        (?# 3: userinfo)
465:                    (?:(#{host})(?::(\\d*))?))? (?# 4: host, 5: port)
466:                |
467:                  (#{reg_name})                 (?# 6: registry)
468:                )
469:              |
470:              (?!//))                           (?# XXX: '//' is the mark for hostport)
471:              (#{abs_path})?                    (?# 7: path)
472:            )(?:\\?(#{query}))?                 (?# 8: query)
473:         )
474:         (?:\\#(#{fragment}))?                  (?# 9: fragment)
475:       &quot;</span>
476: 
477:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:X_REL_URI</span>] = <span class="ruby-node">&quot;
478:         (?:
479:           (?:
480:             //
481:             (?:
482:               (?:(#{userinfo})@)?       (?# 1: userinfo)
483:                 (#{host})?(?::(\\d*))?  (?# 2: host, 3: port)
484:             |
485:               (#{reg_name})             (?# 4: registry)
486:             )
487:           )
488:         |
489:           (#{rel_segment})              (?# 5: rel_segment)
490:         )?
491:         (#{abs_path})?                  (?# 6: abs_path)
492:         (?:\\?(#{query}))?              (?# 7: query)
493:         (?:\\#(#{fragment}))?           (?# 8: fragment)
494:       &quot;</span>
495: 
496:       <span class="ruby-identifier">ret</span>
497:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M007800">
                    
                    <a name="M007800"></a><b>initialize_regexp</b>(pattern)
                    
                </div>
                
                <div class="description">
                  <p>
Constructs the default <a href="../Hash.html">Hash</a> of Regexp&#8217;s
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007800_source')" id="l_M007800_source">show</a>
                        
                    </p>
                    <div id="M007800_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/uri/common.rb, line 500</span>
500:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize_regexp</span>(<span class="ruby-identifier">pattern</span>)
501:       <span class="ruby-identifier">ret</span> = {}
502: 
503:       <span class="ruby-comment cmt"># for URI::split</span>
504:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:ABS_URI</span>] = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">'\A\s*'</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">pattern</span>[<span class="ruby-identifier">:X_ABS_URI</span>] <span class="ruby-operator">+</span> <span class="ruby-value str">'\s*\z'</span>, <span class="ruby-constant">Regexp</span><span class="ruby-operator">::</span><span class="ruby-constant">EXTENDED</span>)
505:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:REL_URI</span>] = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">'\A\s*'</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">pattern</span>[<span class="ruby-identifier">:X_REL_URI</span>] <span class="ruby-operator">+</span> <span class="ruby-value str">'\s*\z'</span>, <span class="ruby-constant">Regexp</span><span class="ruby-operator">::</span><span class="ruby-constant">EXTENDED</span>)
506: 
507:       <span class="ruby-comment cmt"># for URI::extract</span>
508:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:URI_REF</span>]     = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">pattern</span>[<span class="ruby-identifier">:URI_REF</span>])
509:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:ABS_URI_REF</span>] = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">pattern</span>[<span class="ruby-identifier">:X_ABS_URI</span>], <span class="ruby-constant">Regexp</span><span class="ruby-operator">::</span><span class="ruby-constant">EXTENDED</span>)
510:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:REL_URI_REF</span>] = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">pattern</span>[<span class="ruby-identifier">:X_REL_URI</span>], <span class="ruby-constant">Regexp</span><span class="ruby-operator">::</span><span class="ruby-constant">EXTENDED</span>)
511: 
512:       <span class="ruby-comment cmt"># for URI::escape/unescape</span>
513:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:ESCAPED</span>] = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">pattern</span>[<span class="ruby-identifier">:ESCAPED</span>])
514:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:UNSAFE</span>]  = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;[^#{pattern[:UNRESERVED]}#{pattern[:RESERVED]}]&quot;</span>)
515: 
516:       <span class="ruby-comment cmt"># for Generic#initialize</span>
517:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:SCHEME</span>]   = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;^#{pattern[:SCHEME]}$&quot;</span>)
518:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:USERINFO</span>] = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;^#{pattern[:USERINFO]}$&quot;</span>)
519:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:HOST</span>]     = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;^#{pattern[:HOST]}$&quot;</span>)
520:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:PORT</span>]     = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;^#{pattern[:PORT]}$&quot;</span>)
521:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:OPAQUE</span>]   = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;^#{pattern[:OPAQUE_PART]}$&quot;</span>)
522:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:REGISTRY</span>] = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;^#{pattern[:REG_NAME]}$&quot;</span>)
523:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:ABS_PATH</span>] = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;^#{pattern[:ABS_PATH]}$&quot;</span>)
524:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:REL_PATH</span>] = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;^#{pattern[:REL_PATH]}$&quot;</span>)
525:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:QUERY</span>]    = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;^#{pattern[:QUERY]}$&quot;</span>)
526:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:FRAGMENT</span>] = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;^#{pattern[:FRAGMENT]}$&quot;</span>)
527: 
528:       <span class="ruby-identifier">ret</span>
529:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    