<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>WEBrick::HTTPServlet::FileHandler</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../../css/main.css" type="text/css" media="screen" />
    <script src="../../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Class</span> 
            WEBrick::HTTPServlet::FileHandler 
            
                <span class="parent">&lt; 
                    
                    AbstractServlet
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../../files/lib/webrick/httpservlet/filehandler_rb.html">lib/webrick/httpservlet/filehandler.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    
    <div class="description">
        <p>
Serves files from a directory
</p>

    </div>
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>A</dt>
        <dd>
            <ul>
                
                <li><a href="#M008135">add_handler</a></li>
                
            </ul>
        </dd>
    
        <dt>C</dt>
        <dd>
            <ul>
                
                <li><a href="#M008163">call_callback</a>,</li>
                
                <li><a href="#M008159">check_filename</a></li>
                
            </ul>
        </dd>
    
        <dt>D</dt>
        <dd>
            <ul>
                
                <li><a href="#M008143">do_GET</a>,</li>
                
                <li><a href="#M008145">do_OPTIONS</a>,</li>
                
                <li><a href="#M008144">do_POST</a></li>
                
            </ul>
        </dd>
    
        <dt>E</dt>
        <dd>
            <ul>
                
                <li><a href="#M008148">exec_handler</a></li>
                
            </ul>
        </dd>
    
        <dt>G</dt>
        <dd>
            <ul>
                
                <li><a href="#M008153">get_handler</a></li>
                
            </ul>
        </dd>
    
        <dt>N</dt>
        <dd>
            <ul>
                
                <li><a href="#M008138">new</a>,</li>
                
                <li><a href="#M008165">nondisclosure_name?</a></li>
                
            </ul>
        </dd>
    
        <dt>P</dt>
        <dd>
            <ul>
                
                <li><a href="#M008147">prevent_directory_traversal</a></li>
                
            </ul>
        </dd>
    
        <dt>R</dt>
        <dd>
            <ul>
                
                <li><a href="#M008136">remove_handler</a></li>
                
            </ul>
        </dd>
    
        <dt>S</dt>
        <dd>
            <ul>
                
                <li><a href="#M008162">search_file</a>,</li>
                
                <li><a href="#M008161">search_index_file</a>,</li>
                
                <li><a href="#M008142">service</a>,</li>
                
                <li><a href="#M008166">set_dir_list</a>,</li>
                
                <li><a href="#M008158">set_filename</a>,</li>
                
                <li><a href="#M008160">shift_path_info</a></li>
                
            </ul>
        </dd>
    
        <dt>T</dt>
        <dd>
            <ul>
                
                <li><a href="#M008146">trailing_pathsep?</a></li>
                
            </ul>
        </dd>
    
        <dt>W</dt>
        <dd>
            <ul>
                
                <li><a href="#M008164">windows_ambiguous_name?</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    

    

    

    
    <div class="sectiontitle">Constants</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class="attr-name">HandlerTable</td>
            <td>=</td>
            <td class="attr-value">Hash.new</td>
        </tr>
        
        
    </table>
    

    

    
            <div class="sectiontitle">Class Public methods</div>
            
            <div class="method">
                <div class="title" id="M008135">
                    
                    <a name="M008135"></a><b>add_handler</b>(suffix, handler)
                    
                </div>
                
                <div class="description">
                  <p>
Allow custom handling of requests for files with <tt>suffix</tt> by class
<tt>handler</tt>
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M008135_source')" id="l_M008135_source">show</a>
                        
                    </p>
                    <div id="M008135_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/webrick/httpservlet/filehandler.rb, line 138</span>
138:       <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">add_handler</span>(<span class="ruby-identifier">suffix</span>, <span class="ruby-identifier">handler</span>)
139:         <span class="ruby-constant">HandlerTable</span>[<span class="ruby-identifier">suffix</span>] = <span class="ruby-identifier">handler</span>
140:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M008138">
                    
                    <a name="M008138"></a><b>new</b>(server, root, options={}, default=Config::FileHandler)
                    
                </div>
                
                <div class="description">
                  <p>
Creates a <a href="FileHandler.html">FileHandler</a> servlet on
<tt>server</tt> that serves files starting at directory <tt>root</tt>
</p>
<p>
If <tt>options</tt> is a <a href="../../Hash.html">Hash</a> the following
keys are allowed:
</p>
<table>
<tr><td valign="top">:AcceptableLanguages:</td><td><a href="../../Array.html">Array</a> of languages allowed for
accept-language

</td></tr>
<tr><td valign="top">:DirectoryCallback:</td><td>Allows preprocessing of directory requests

</td></tr>
<tr><td valign="top">:FancyIndexing:</td><td>If true, show an index for directories

</td></tr>
<tr><td valign="top">:FileCallback:</td><td>Allows preprocessing of file requests

</td></tr>
<tr><td valign="top">:HandlerCallback:</td><td>Allows preprocessing of requests

</td></tr>
<tr><td valign="top">:HandlerTable:</td><td>Maps file suffixes to file handlers. <a
href="DefaultFileHandler.html">DefaultFileHandler</a> is used by default
but any servlet can be used.

</td></tr>
<tr><td valign="top">:NondisclosureName:</td><td>Do not show files matching this array of globs

</td></tr>
<tr><td valign="top">:UserDir:</td><td>Directory inside ~user to serve content from for /~user requests. Only
works if mounted on /

</td></tr>
</table>
<p>
If <tt>options</tt> is true or false then <tt>:FancyIndexing</tt> is
enabled or disabled respectively.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M008138_source')" id="l_M008138_source">show</a>
                        
                    </p>
                    <div id="M008138_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/webrick/httpservlet/filehandler.rb, line 170</span>
170:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">server</span>, <span class="ruby-identifier">root</span>, <span class="ruby-identifier">options</span>={}, <span class="ruby-identifier">default</span>=<span class="ruby-constant">Config</span><span class="ruby-operator">::</span><span class="ruby-constant">FileHandler</span>)
171:         <span class="ruby-ivar">@config</span> = <span class="ruby-identifier">server</span>.<span class="ruby-identifier">config</span>
172:         <span class="ruby-ivar">@logger</span> = <span class="ruby-ivar">@config</span>[<span class="ruby-identifier">:Logger</span>]
173:         <span class="ruby-ivar">@root</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">root</span>)
174:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">true</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">options</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">false</span>
175:           <span class="ruby-identifier">options</span> = { <span class="ruby-identifier">:FancyIndexing</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">options</span> }
176:         <span class="ruby-keyword kw">end</span>
177:         <span class="ruby-ivar">@options</span> = <span class="ruby-identifier">default</span>.<span class="ruby-identifier">dup</span>.<span class="ruby-identifier">update</span>(<span class="ruby-identifier">options</span>)
178:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M008136">
                    
                    <a name="M008136"></a><b>remove_handler</b>(suffix)
                    
                </div>
                
                <div class="description">
                  <p>
Remove custom handling of requests for files with <tt>suffix</tt>
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M008136_source')" id="l_M008136_source">show</a>
                        
                    </p>
                    <div id="M008136_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/webrick/httpservlet/filehandler.rb, line 145</span>
145:       <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">remove_handler</span>(<span class="ruby-identifier">suffix</span>)
146:         <span class="ruby-constant">HandlerTable</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">suffix</span>)
147:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M008143">
                    
                    <a name="M008143"></a><b>do_GET</b>(req, res)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M008143_source')" id="l_M008143_source">show</a>
                        
                    </p>
                    <div id="M008143_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/webrick/httpservlet/filehandler.rb, line 201</span>
201:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">do_GET</span>(<span class="ruby-identifier">req</span>, <span class="ruby-identifier">res</span>)
202:         <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">exec_handler</span>(<span class="ruby-identifier">req</span>, <span class="ruby-identifier">res</span>)
203:           <span class="ruby-identifier">set_dir_list</span>(<span class="ruby-identifier">req</span>, <span class="ruby-identifier">res</span>)
204:         <span class="ruby-keyword kw">end</span>
205:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M008145">
                    
                    <a name="M008145"></a><b>do_OPTIONS</b>(req, res)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M008145_source')" id="l_M008145_source">show</a>
                        
                    </p>
                    <div id="M008145_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/webrick/httpservlet/filehandler.rb, line 213</span>
213:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">do_OPTIONS</span>(<span class="ruby-identifier">req</span>, <span class="ruby-identifier">res</span>)
214:         <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">exec_handler</span>(<span class="ruby-identifier">req</span>, <span class="ruby-identifier">res</span>)
215:           <span class="ruby-keyword kw">super</span>(<span class="ruby-identifier">req</span>, <span class="ruby-identifier">res</span>)
216:         <span class="ruby-keyword kw">end</span>
217:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M008144">
                    
                    <a name="M008144"></a><b>do_POST</b>(req, res)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M008144_source')" id="l_M008144_source">show</a>
                        
                    </p>
                    <div id="M008144_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/webrick/httpservlet/filehandler.rb, line 207</span>
207:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">do_POST</span>(<span class="ruby-identifier">req</span>, <span class="ruby-identifier">res</span>)
208:         <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">exec_handler</span>(<span class="ruby-identifier">req</span>, <span class="ruby-identifier">res</span>)
209:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">HTTPStatus</span><span class="ruby-operator">::</span><span class="ruby-constant">NotFound</span>, <span class="ruby-node">&quot;`#{req.path}' not found.&quot;</span>
210:         <span class="ruby-keyword kw">end</span>
211:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M008142">
                    
                    <a name="M008142"></a><b>service</b>(req, res)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M008142_source')" id="l_M008142_source">show</a>
                        
                    </p>
                    <div id="M008142_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/webrick/httpservlet/filehandler.rb, line 180</span>
180:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">service</span>(<span class="ruby-identifier">req</span>, <span class="ruby-identifier">res</span>)
181:         <span class="ruby-comment cmt"># if this class is mounted on &quot;/&quot; and /~username is requested.</span>
182:         <span class="ruby-comment cmt"># we're going to override path informations before invoking service.</span>
183:         <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">defined?</span>(<span class="ruby-constant">Etc</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:UserDir</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">req</span>.<span class="ruby-identifier">script_name</span>.<span class="ruby-identifier">empty?</span>
184:           <span class="ruby-keyword kw">if</span> <span class="ruby-regexp re">%r|^(/~([^/]+))|</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">req</span>.<span class="ruby-identifier">path_info</span>
185:             <span class="ruby-identifier">script_name</span>, <span class="ruby-identifier">user</span> = <span class="ruby-identifier">$1</span>, <span class="ruby-identifier">$2</span>
186:             <span class="ruby-identifier">path_info</span> = <span class="ruby-identifier">$'</span>
187:             <span class="ruby-keyword kw">begin</span>
188:               <span class="ruby-identifier">passwd</span> = <span class="ruby-constant">Etc</span><span class="ruby-operator">::</span><span class="ruby-identifier">getpwnam</span>(<span class="ruby-identifier">user</span>)
189:               <span class="ruby-ivar">@root</span> = <span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-identifier">join</span>(<span class="ruby-identifier">passwd</span>.<span class="ruby-identifier">dir</span>, <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:UserDir</span>])
190:               <span class="ruby-identifier">req</span>.<span class="ruby-identifier">script_name</span> = <span class="ruby-identifier">script_name</span>
191:               <span class="ruby-identifier">req</span>.<span class="ruby-identifier">path_info</span> = <span class="ruby-identifier">path_info</span>
192:             <span class="ruby-keyword kw">rescue</span>
193:               <span class="ruby-ivar">@logger</span>.<span class="ruby-identifier">debug</span> <span class="ruby-node">&quot;#{self.class}#do_GET: getpwnam(#{user}) failed&quot;</span>
194:             <span class="ruby-keyword kw">end</span>
195:           <span class="ruby-keyword kw">end</span>
196:         <span class="ruby-keyword kw">end</span>
197:         <span class="ruby-identifier">prevent_directory_traversal</span>(<span class="ruby-identifier">req</span>, <span class="ruby-identifier">res</span>)
198:         <span class="ruby-keyword kw">super</span>(<span class="ruby-identifier">req</span>, <span class="ruby-identifier">res</span>)
199:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Private methods</div>
            
            <div class="method">
                <div class="title" id="M008163">
                    
                    <a name="M008163"></a><b>call_callback</b>(callback_name, req, res)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M008163_source')" id="l_M008163_source">show</a>
                        
                    </p>
                    <div id="M008163_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/webrick/httpservlet/filehandler.rb, line 370</span>
370:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">call_callback</span>(<span class="ruby-identifier">callback_name</span>, <span class="ruby-identifier">req</span>, <span class="ruby-identifier">res</span>)
371:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">cb</span> = <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">callback_name</span>]
372:           <span class="ruby-identifier">cb</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">req</span>, <span class="ruby-identifier">res</span>)
373:         <span class="ruby-keyword kw">end</span>
374:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M008159">
                    
                    <a name="M008159"></a><b>check_filename</b>(req, res, name)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M008159_source')" id="l_M008159_source">show</a>
                        
                    </p>
                    <div id="M008159_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/webrick/httpservlet/filehandler.rb, line 323</span>
323:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">check_filename</span>(<span class="ruby-identifier">req</span>, <span class="ruby-identifier">res</span>, <span class="ruby-identifier">name</span>)
324:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">nondisclosure_name?</span>(<span class="ruby-identifier">name</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">windows_ambiguous_name?</span>(<span class="ruby-identifier">name</span>)
325:           <span class="ruby-ivar">@logger</span>.<span class="ruby-identifier">warn</span>(<span class="ruby-node">&quot;the request refers nondisclosure name `#{name}'.&quot;</span>)
326:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">HTTPStatus</span><span class="ruby-operator">::</span><span class="ruby-constant">NotFound</span>, <span class="ruby-node">&quot;`#{req.path}' not found.&quot;</span>
327:         <span class="ruby-keyword kw">end</span>
328:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M008148">
                    
                    <a name="M008148"></a><b>exec_handler</b>(req, res)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M008148_source')" id="l_M008148_source">show</a>
                        
                    </p>
                    <div id="M008148_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/webrick/httpservlet/filehandler.rb, line 265</span>
265:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">exec_handler</span>(<span class="ruby-identifier">req</span>, <span class="ruby-identifier">res</span>)
266:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">HTTPStatus</span><span class="ruby-operator">::</span><span class="ruby-constant">NotFound</span>, <span class="ruby-node">&quot;`#{req.path}' not found&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@root</span>
267:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">set_filename</span>(<span class="ruby-identifier">req</span>, <span class="ruby-identifier">res</span>)
268:           <span class="ruby-identifier">handler</span> = <span class="ruby-identifier">get_handler</span>(<span class="ruby-identifier">req</span>, <span class="ruby-identifier">res</span>)
269:           <span class="ruby-identifier">call_callback</span>(<span class="ruby-identifier">:HandlerCallback</span>, <span class="ruby-identifier">req</span>, <span class="ruby-identifier">res</span>)
270:           <span class="ruby-identifier">h</span> = <span class="ruby-identifier">handler</span>.<span class="ruby-identifier">get_instance</span>(<span class="ruby-ivar">@config</span>, <span class="ruby-identifier">res</span>.<span class="ruby-identifier">filename</span>)
271:           <span class="ruby-identifier">h</span>.<span class="ruby-identifier">service</span>(<span class="ruby-identifier">req</span>, <span class="ruby-identifier">res</span>)
272:           <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span>
273:         <span class="ruby-keyword kw">end</span>
274:         <span class="ruby-identifier">call_callback</span>(<span class="ruby-identifier">:HandlerCallback</span>, <span class="ruby-identifier">req</span>, <span class="ruby-identifier">res</span>)
275:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span>
276:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M008153">
                    
                    <a name="M008153"></a><b>get_handler</b>(req, res)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M008153_source')" id="l_M008153_source">show</a>
                        
                    </p>
                    <div id="M008153_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/webrick/httpservlet/filehandler.rb, line 278</span>
278:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_handler</span>(<span class="ruby-identifier">req</span>, <span class="ruby-identifier">res</span>)
279:         <span class="ruby-identifier">suffix1</span> = (<span class="ruby-regexp re">/\.(\w+)\z/</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">res</span>.<span class="ruby-identifier">filename</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">$1</span>.<span class="ruby-identifier">downcase</span>
280:         <span class="ruby-keyword kw">if</span> <span class="ruby-regexp re">/\.(\w+)\.([\w\-]+)\z/</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">res</span>.<span class="ruby-identifier">filename</span>
281:           <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:AcceptableLanguages</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">$2</span>.<span class="ruby-identifier">downcase</span>)
282:             <span class="ruby-identifier">suffix2</span> = <span class="ruby-identifier">$1</span>.<span class="ruby-identifier">downcase</span>
283:           <span class="ruby-keyword kw">end</span>
284:         <span class="ruby-keyword kw">end</span>
285:         <span class="ruby-identifier">handler_table</span> = <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:HandlerTable</span>]
286:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">handler_table</span>[<span class="ruby-identifier">suffix1</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">handler_table</span>[<span class="ruby-identifier">suffix2</span>] <span class="ruby-operator">||</span>
287:                <span class="ruby-constant">HandlerTable</span>[<span class="ruby-identifier">suffix1</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">HandlerTable</span>[<span class="ruby-identifier">suffix2</span>] <span class="ruby-operator">||</span>
288:                <span class="ruby-constant">DefaultFileHandler</span>
289:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M008165">
                    
                    <a name="M008165"></a><b>nondisclosure_name?</b>(name)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M008165_source')" id="l_M008165_source">show</a>
                        
                    </p>
                    <div id="M008165_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/webrick/httpservlet/filehandler.rb, line 382</span>
382:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">nondisclosure_name?</span>(<span class="ruby-identifier">name</span>)
383:         <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:NondisclosureName</span>].<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">pattern</span><span class="ruby-operator">|</span>
384:           <span class="ruby-keyword kw">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">fnmatch</span>(<span class="ruby-identifier">pattern</span>, <span class="ruby-identifier">name</span>, <span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">FNM_CASEFOLD</span>)
385:             <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span>
386:           <span class="ruby-keyword kw">end</span>
387:         }
388:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span>
389:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M008147">
                    
                    <a name="M008147"></a><b>prevent_directory_traversal</b>(req, res)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M008147_source')" id="l_M008147_source">show</a>
                        
                    </p>
                    <div id="M008147_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/webrick/httpservlet/filehandler.rb, line 242</span>
242:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">prevent_directory_traversal</span>(<span class="ruby-identifier">req</span>, <span class="ruby-identifier">res</span>)
243:         <span class="ruby-comment cmt"># Preventing directory traversal on Windows platforms;</span>
244:         <span class="ruby-comment cmt"># Backslashes (0x5c) in path_info are not interpreted as special</span>
245:         <span class="ruby-comment cmt"># character in URI notation. So the value of path_info should be</span>
246:         <span class="ruby-comment cmt"># normalize before accessing to the filesystem.</span>
247: 
248:         <span class="ruby-comment cmt"># dirty hack for filesystem encoding; in nature, File.expand_path</span>
249:         <span class="ruby-comment cmt"># should not be used for path normalization.  [Bug #3345]</span>
250:         <span class="ruby-identifier">path</span> = <span class="ruby-identifier">req</span>.<span class="ruby-identifier">path_info</span>.<span class="ruby-identifier">dup</span>.<span class="ruby-identifier">force_encoding</span>(<span class="ruby-constant">Encoding</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value str">&quot;filesystem&quot;</span>))
251:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">trailing_pathsep?</span>(<span class="ruby-identifier">req</span>.<span class="ruby-identifier">path_info</span>)
252:           <span class="ruby-comment cmt"># File.expand_path removes the trailing path separator.</span>
253:           <span class="ruby-comment cmt"># Adding a character is a workaround to save it.</span>
254:           <span class="ruby-comment cmt">#  File.expand_path(&quot;/aaa/&quot;)        #=&gt; &quot;/aaa&quot;</span>
255:           <span class="ruby-comment cmt">#  File.expand_path(&quot;/aaa/&quot; + &quot;x&quot;)  #=&gt; &quot;/aaa/x&quot;</span>
256:           <span class="ruby-identifier">expanded</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">path</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;x&quot;</span>)
257:           <span class="ruby-identifier">expanded</span>.<span class="ruby-identifier">chop!</span>  <span class="ruby-comment cmt"># remove trailing &quot;x&quot;</span>
258:         <span class="ruby-keyword kw">else</span>
259:           <span class="ruby-identifier">expanded</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">path</span>)
260:         <span class="ruby-keyword kw">end</span>
261:         <span class="ruby-identifier">expanded</span>.<span class="ruby-identifier">force_encoding</span>(<span class="ruby-identifier">req</span>.<span class="ruby-identifier">path_info</span>.<span class="ruby-identifier">encoding</span>)
262:         <span class="ruby-identifier">req</span>.<span class="ruby-identifier">path_info</span> = <span class="ruby-identifier">expanded</span>
263:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M008162">
                    
                    <a name="M008162"></a><b>search_file</b>(req, res, basename)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M008162_source')" id="l_M008162_source">show</a>
                        
                    </p>
                    <div id="M008162_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/webrick/httpservlet/filehandler.rb, line 348</span>
348:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">search_file</span>(<span class="ruby-identifier">req</span>, <span class="ruby-identifier">res</span>, <span class="ruby-identifier">basename</span>)
349:         <span class="ruby-identifier">langs</span> = <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:AcceptableLanguages</span>]
350:         <span class="ruby-identifier">path</span> = <span class="ruby-identifier">res</span>.<span class="ruby-identifier">filename</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">basename</span>
351:         <span class="ruby-keyword kw">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">file?</span>(<span class="ruby-identifier">path</span>)
352:           <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">basename</span>
353:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">langs</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
354:           <span class="ruby-identifier">req</span>.<span class="ruby-identifier">accept_language</span>.<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">lang</span><span class="ruby-operator">|</span>
355:             <span class="ruby-identifier">path_with_lang</span> = <span class="ruby-identifier">path</span> <span class="ruby-operator">+</span> <span class="ruby-node">&quot;.#{lang}&quot;</span>
356:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">langs</span>.<span class="ruby-identifier">member?</span>(<span class="ruby-identifier">lang</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">file?</span>(<span class="ruby-identifier">path_with_lang</span>)
357:               <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">basename</span> <span class="ruby-operator">+</span> <span class="ruby-node">&quot;.#{lang}&quot;</span>
358:             <span class="ruby-keyword kw">end</span>
359:           }
360:           (<span class="ruby-identifier">langs</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">req</span>.<span class="ruby-identifier">accept_language</span>).<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">lang</span><span class="ruby-operator">|</span>
361:             <span class="ruby-identifier">path_with_lang</span> = <span class="ruby-identifier">path</span> <span class="ruby-operator">+</span> <span class="ruby-node">&quot;.#{lang}&quot;</span>
362:             <span class="ruby-keyword kw">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">file?</span>(<span class="ruby-identifier">path_with_lang</span>)
363:               <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">basename</span> <span class="ruby-operator">+</span> <span class="ruby-node">&quot;.#{lang}&quot;</span>
364:             <span class="ruby-keyword kw">end</span>
365:           }
366:         <span class="ruby-keyword kw">end</span>
367:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span>
368:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M008161">
                    
                    <a name="M008161"></a><b>search_index_file</b>(req, res)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M008161_source')" id="l_M008161_source">show</a>
                        
                    </p>
                    <div id="M008161_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/webrick/httpservlet/filehandler.rb, line 339</span>
339:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">search_index_file</span>(<span class="ruby-identifier">req</span>, <span class="ruby-identifier">res</span>)
340:         <span class="ruby-ivar">@config</span>[<span class="ruby-identifier">:DirectoryIndex</span>].<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">index</span><span class="ruby-operator">|</span>
341:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">file</span> = <span class="ruby-identifier">search_file</span>(<span class="ruby-identifier">req</span>, <span class="ruby-identifier">res</span>, <span class="ruby-value str">&quot;/&quot;</span><span class="ruby-operator">+</span><span class="ruby-identifier">index</span>)
342:             <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">file</span>
343:           <span class="ruby-keyword kw">end</span>
344:         }
345:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span>
346:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M008166">
                    
                    <a name="M008166"></a><b>set_dir_list</b>(req, res)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M008166_source')" id="l_M008166_source">show</a>
                        
                    </p>
                    <div id="M008166_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/webrick/httpservlet/filehandler.rb, line 391</span>
391:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set_dir_list</span>(<span class="ruby-identifier">req</span>, <span class="ruby-identifier">res</span>)
392:         <span class="ruby-identifier">redirect_to_directory_uri</span>(<span class="ruby-identifier">req</span>, <span class="ruby-identifier">res</span>)
393:         <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:FancyIndexing</span>]
394:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">HTTPStatus</span><span class="ruby-operator">::</span><span class="ruby-constant">Forbidden</span>, <span class="ruby-node">&quot;no access permission to `#{req.path}'&quot;</span>
395:         <span class="ruby-keyword kw">end</span>
396:         <span class="ruby-identifier">local_path</span> = <span class="ruby-identifier">res</span>.<span class="ruby-identifier">filename</span>
397:         <span class="ruby-identifier">list</span> = <span class="ruby-constant">Dir</span><span class="ruby-operator">::</span><span class="ruby-identifier">entries</span>(<span class="ruby-identifier">local_path</span>).<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">name</span><span class="ruby-operator">|</span>
398:           <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;.&quot;</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;..&quot;</span>
399:           <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">nondisclosure_name?</span>(<span class="ruby-identifier">name</span>)
400:           <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">windows_ambiguous_name?</span>(<span class="ruby-identifier">name</span>)
401:           <span class="ruby-identifier">st</span> = (<span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-identifier">stat</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">local_path</span>, <span class="ruby-identifier">name</span>)) <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>)
402:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">st</span>.<span class="ruby-identifier">nil?</span>
403:             [ <span class="ruby-identifier">name</span>, <span class="ruby-keyword kw">nil</span>, <span class="ruby-value">-1</span> ]
404:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">st</span>.<span class="ruby-identifier">directory?</span>
405:             [ <span class="ruby-identifier">name</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/&quot;</span>, <span class="ruby-identifier">st</span>.<span class="ruby-identifier">mtime</span>, <span class="ruby-value">-1</span> ]
406:           <span class="ruby-keyword kw">else</span>
407:             [ <span class="ruby-identifier">name</span>, <span class="ruby-identifier">st</span>.<span class="ruby-identifier">mtime</span>, <span class="ruby-identifier">st</span>.<span class="ruby-identifier">size</span> ]
408:           <span class="ruby-keyword kw">end</span>
409:         }
410:         <span class="ruby-identifier">list</span>.<span class="ruby-identifier">compact!</span>
411: 
412:         <span class="ruby-keyword kw">if</span>    <span class="ruby-identifier">d0</span> = <span class="ruby-identifier">req</span>.<span class="ruby-identifier">query</span>[<span class="ruby-value str">&quot;N&quot;</span>]; <span class="ruby-identifier">idx</span> = <span class="ruby-value">0</span>
413:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">d0</span> = <span class="ruby-identifier">req</span>.<span class="ruby-identifier">query</span>[<span class="ruby-value str">&quot;M&quot;</span>]; <span class="ruby-identifier">idx</span> = <span class="ruby-value">1</span>
414:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">d0</span> = <span class="ruby-identifier">req</span>.<span class="ruby-identifier">query</span>[<span class="ruby-value str">&quot;S&quot;</span>]; <span class="ruby-identifier">idx</span> = <span class="ruby-value">2</span>
415:         <span class="ruby-keyword kw">else</span>  <span class="ruby-identifier">d0</span> = <span class="ruby-value str">&quot;A&quot;</span>           ; <span class="ruby-identifier">idx</span> = <span class="ruby-value">0</span>
416:         <span class="ruby-keyword kw">end</span>
417:         <span class="ruby-identifier">d1</span> = (<span class="ruby-identifier">d0</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;A&quot;</span>) <span class="ruby-operator">?</span> <span class="ruby-value str">&quot;D&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-value str">&quot;A&quot;</span>
418: 
419:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">d0</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;A&quot;</span>
420:           <span class="ruby-identifier">list</span>.<span class="ruby-identifier">sort!</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">a</span>,<span class="ruby-identifier">b</span><span class="ruby-operator">|</span> <span class="ruby-identifier">a</span>[<span class="ruby-identifier">idx</span>] <span class="ruby-operator">&lt;=&gt;</span> <span class="ruby-identifier">b</span>[<span class="ruby-identifier">idx</span>] }
421:         <span class="ruby-keyword kw">else</span>
422:           <span class="ruby-identifier">list</span>.<span class="ruby-identifier">sort!</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">a</span>,<span class="ruby-identifier">b</span><span class="ruby-operator">|</span> <span class="ruby-identifier">b</span>[<span class="ruby-identifier">idx</span>] <span class="ruby-operator">&lt;=&gt;</span> <span class="ruby-identifier">a</span>[<span class="ruby-identifier">idx</span>] }
423:         <span class="ruby-keyword kw">end</span>
424: 
425:         <span class="ruby-identifier">res</span>[<span class="ruby-value str">'content-type'</span>] = <span class="ruby-value str">&quot;text/html&quot;</span>
426: 
427:         <span class="ruby-identifier">res</span>.<span class="ruby-identifier">body</span> = <span class="ruby-value str">&quot;&lt;!DOCTYPE HTML PUBLIC \&quot;-//W3C//DTD HTML 3.2 Final//EN\&quot;&gt;\n&lt;HTML&gt;\n&lt;HEAD&gt;&lt;TITLE&gt;Index of \#{HTMLUtils::escape(req.path)}&lt;/TITLE&gt;&lt;/HEAD&gt;\n&lt;BODY&gt;\n&lt;H1&gt;Index of \#{HTMLUtils::escape(req.path)}&lt;/H1&gt;\n&quot;</span>
428: 
429:         <span class="ruby-identifier">res</span>.<span class="ruby-identifier">body</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;&lt;PRE&gt;\n&quot;</span>
430:         <span class="ruby-identifier">res</span>.<span class="ruby-identifier">body</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot; &lt;A HREF=\&quot;?N=#{d1}\&quot;&gt;Name&lt;/A&gt;                          &quot;</span>
431:         <span class="ruby-identifier">res</span>.<span class="ruby-identifier">body</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;&lt;A HREF=\&quot;?M=#{d1}\&quot;&gt;Last modified&lt;/A&gt;         &quot;</span>
432:         <span class="ruby-identifier">res</span>.<span class="ruby-identifier">body</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;&lt;A HREF=\&quot;?S=#{d1}\&quot;&gt;Size&lt;/A&gt;\n&quot;</span>
433:         <span class="ruby-identifier">res</span>.<span class="ruby-identifier">body</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;&lt;HR&gt;\n&quot;</span>
434: 
435:         <span class="ruby-identifier">list</span>.<span class="ruby-identifier">unshift</span> [ <span class="ruby-value str">&quot;..&quot;</span>, <span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-identifier">mtime</span>(<span class="ruby-identifier">local_path</span><span class="ruby-operator">+</span><span class="ruby-value str">&quot;/..&quot;</span>), <span class="ruby-value">-1</span> ]
436:         <span class="ruby-identifier">list</span>.<span class="ruby-identifier">each</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">name</span>, <span class="ruby-identifier">time</span>, <span class="ruby-identifier">size</span><span class="ruby-operator">|</span>
437:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;..&quot;</span>
438:             <span class="ruby-identifier">dname</span> = <span class="ruby-value str">&quot;Parent Directory&quot;</span>
439:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">name</span>.<span class="ruby-identifier">bytesize</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">25</span>
440:             <span class="ruby-identifier">dname</span> = <span class="ruby-identifier">name</span>.<span class="ruby-identifier">sub</span>(<span class="ruby-regexp re">/^(.{23})(?:.*)/</span>, <span class="ruby-value str">'\1..'</span>)
441:           <span class="ruby-keyword kw">else</span>
442:             <span class="ruby-identifier">dname</span> = <span class="ruby-identifier">name</span>
443:           <span class="ruby-keyword kw">end</span>
444:           <span class="ruby-identifier">s</span> =  <span class="ruby-node">&quot; &lt;A HREF=\&quot;#{HTTPUtils::escape(name)}\&quot;&gt;#{HTMLUtils::escape(dname)}&lt;/A&gt;&quot;</span>
445:           <span class="ruby-identifier">s</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot; &quot;</span> <span class="ruby-operator">*</span> (<span class="ruby-value">30</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">dname</span>.<span class="ruby-identifier">bytesize</span>)
446:           <span class="ruby-identifier">s</span> <span class="ruby-operator">&lt;&lt;</span> (<span class="ruby-identifier">time</span> <span class="ruby-value">? </span><span class="ruby-identifier">time</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-value str">&quot;%Y/%m/%d %H:%M      &quot;</span>) <span class="ruby-operator">:</span> <span class="ruby-value str">&quot; &quot;</span> <span class="ruby-operator">*</span> <span class="ruby-value">22</span>)
447:           <span class="ruby-identifier">s</span> <span class="ruby-operator">&lt;&lt;</span> (<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">0</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">size</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">:</span> <span class="ruby-value str">&quot;-&quot;</span>) <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;\n&quot;</span>
448:           <span class="ruby-identifier">res</span>.<span class="ruby-identifier">body</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">s</span>
449:         }
450:         <span class="ruby-identifier">res</span>.<span class="ruby-identifier">body</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;&lt;/PRE&gt;&lt;HR&gt;&quot;</span>
451: 
452:         <span class="ruby-identifier">res</span>.<span class="ruby-identifier">body</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;&lt;ADDRESS&gt;\n\#{HTMLUtils::escape(@config[:ServerSoftware])}&lt;BR&gt;\nat \#{req.host}:\#{req.port}\n&lt;/ADDRESS&gt;\n&lt;/BODY&gt;\n&lt;/HTML&gt;\n&quot;</span>
453:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M008158">
                    
                    <a name="M008158"></a><b>set_filename</b>(req, res)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M008158_source')" id="l_M008158_source">show</a>
                        
                    </p>
                    <div id="M008158_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/webrick/httpservlet/filehandler.rb, line 291</span>
291:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set_filename</span>(<span class="ruby-identifier">req</span>, <span class="ruby-identifier">res</span>)
292:         <span class="ruby-identifier">res</span>.<span class="ruby-identifier">filename</span> = <span class="ruby-ivar">@root</span>.<span class="ruby-identifier">dup</span>
293:         <span class="ruby-identifier">path_info</span> = <span class="ruby-identifier">req</span>.<span class="ruby-identifier">path_info</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">%r|/[^/]*|</span>)
294: 
295:         <span class="ruby-identifier">path_info</span>.<span class="ruby-identifier">unshift</span>(<span class="ruby-value str">&quot;&quot;</span>)  <span class="ruby-comment cmt"># dummy for checking @root dir</span>
296:         <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">base</span> = <span class="ruby-identifier">path_info</span>.<span class="ruby-identifier">first</span>
297:           <span class="ruby-keyword kw">break</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">base</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;/&quot;</span>
298:           <span class="ruby-keyword kw">break</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">directory?</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">res</span>.<span class="ruby-identifier">filename</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">base</span>))
299:           <span class="ruby-identifier">shift_path_info</span>(<span class="ruby-identifier">req</span>, <span class="ruby-identifier">res</span>, <span class="ruby-identifier">path_info</span>)
300:           <span class="ruby-identifier">call_callback</span>(<span class="ruby-identifier">:DirectoryCallback</span>, <span class="ruby-identifier">req</span>, <span class="ruby-identifier">res</span>)
301:         <span class="ruby-keyword kw">end</span>
302: 
303:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">base</span> = <span class="ruby-identifier">path_info</span>.<span class="ruby-identifier">first</span>
304:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">base</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;/&quot;</span>
305:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">file</span> = <span class="ruby-identifier">search_index_file</span>(<span class="ruby-identifier">req</span>, <span class="ruby-identifier">res</span>)
306:               <span class="ruby-identifier">shift_path_info</span>(<span class="ruby-identifier">req</span>, <span class="ruby-identifier">res</span>, <span class="ruby-identifier">path_info</span>, <span class="ruby-identifier">file</span>)
307:               <span class="ruby-identifier">call_callback</span>(<span class="ruby-identifier">:FileCallback</span>, <span class="ruby-identifier">req</span>, <span class="ruby-identifier">res</span>)
308:               <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span>
309:             <span class="ruby-keyword kw">end</span>
310:             <span class="ruby-identifier">shift_path_info</span>(<span class="ruby-identifier">req</span>, <span class="ruby-identifier">res</span>, <span class="ruby-identifier">path_info</span>)
311:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">file</span> = <span class="ruby-identifier">search_file</span>(<span class="ruby-identifier">req</span>, <span class="ruby-identifier">res</span>, <span class="ruby-identifier">base</span>)
312:             <span class="ruby-identifier">shift_path_info</span>(<span class="ruby-identifier">req</span>, <span class="ruby-identifier">res</span>, <span class="ruby-identifier">path_info</span>, <span class="ruby-identifier">file</span>)
313:             <span class="ruby-identifier">call_callback</span>(<span class="ruby-identifier">:FileCallback</span>, <span class="ruby-identifier">req</span>, <span class="ruby-identifier">res</span>)
314:             <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span>
315:           <span class="ruby-keyword kw">else</span>
316:             <span class="ruby-identifier">raise</span> <span class="ruby-constant">HTTPStatus</span><span class="ruby-operator">::</span><span class="ruby-constant">NotFound</span>, <span class="ruby-node">&quot;`#{req.path}' not found.&quot;</span>
317:           <span class="ruby-keyword kw">end</span>
318:         <span class="ruby-keyword kw">end</span>
319: 
320:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span>
321:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M008160">
                    
                    <a name="M008160"></a><b>shift_path_info</b>(req, res, path_info, base=nil)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M008160_source')" id="l_M008160_source">show</a>
                        
                    </p>
                    <div id="M008160_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/webrick/httpservlet/filehandler.rb, line 330</span>
330:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">shift_path_info</span>(<span class="ruby-identifier">req</span>, <span class="ruby-identifier">res</span>, <span class="ruby-identifier">path_info</span>, <span class="ruby-identifier">base</span>=<span class="ruby-keyword kw">nil</span>)
331:         <span class="ruby-identifier">tmp</span> = <span class="ruby-identifier">path_info</span>.<span class="ruby-identifier">shift</span>
332:         <span class="ruby-identifier">base</span> = <span class="ruby-identifier">base</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">tmp</span>
333:         <span class="ruby-identifier">req</span>.<span class="ruby-identifier">path_info</span> = <span class="ruby-identifier">path_info</span>.<span class="ruby-identifier">join</span>
334:         <span class="ruby-identifier">req</span>.<span class="ruby-identifier">script_name</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">base</span>
335:         <span class="ruby-identifier">res</span>.<span class="ruby-identifier">filename</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">res</span>.<span class="ruby-identifier">filename</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">base</span>)
336:         <span class="ruby-identifier">check_filename</span>(<span class="ruby-identifier">req</span>, <span class="ruby-identifier">res</span>, <span class="ruby-constant">File</span>.<span class="ruby-identifier">basename</span>(<span class="ruby-identifier">res</span>.<span class="ruby-identifier">filename</span>))
337:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M008146">
                    
                    <a name="M008146"></a><b>trailing_pathsep?</b>(path)
                    
                </div>
                
                <div class="description">
                  <p>
RFC3253: Versioning Extensions to WebDAV
</p>
<pre>
         (Web Distributed Authoring and Versioning)
</pre>
<p>
VERSION-CONTROL REPORT CHECKOUT CHECK_IN UNCHECKOUT MKWORKSPACE UPDATE
LABEL MERGE ACTIVITY
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M008146_source')" id="l_M008146_source">show</a>
                        
                    </p>
                    <div id="M008146_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/webrick/httpservlet/filehandler.rb, line 233</span>
233:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">trailing_pathsep?</span>(<span class="ruby-identifier">path</span>)
234:         <span class="ruby-comment cmt"># check for trailing path separator:</span>
235:         <span class="ruby-comment cmt">#   File.dirname(&quot;/aaaa/bbbb/&quot;)      #=&gt; &quot;/aaaa&quot;)</span>
236:         <span class="ruby-comment cmt">#   File.dirname(&quot;/aaaa/bbbb/x&quot;)     #=&gt; &quot;/aaaa/bbbb&quot;)</span>
237:         <span class="ruby-comment cmt">#   File.dirname(&quot;/aaaa/bbbb&quot;)       #=&gt; &quot;/aaaa&quot;)</span>
238:         <span class="ruby-comment cmt">#   File.dirname(&quot;/aaaa/bbbbx&quot;)      #=&gt; &quot;/aaaa&quot;)</span>
239:         <span class="ruby-keyword kw">return</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-identifier">path</span>) <span class="ruby-operator">!=</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-identifier">path</span><span class="ruby-operator">+</span><span class="ruby-value str">&quot;x&quot;</span>)
240:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M008164">
                    
                    <a name="M008164"></a><b>windows_ambiguous_name?</b>(name)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M008164_source')" id="l_M008164_source">show</a>
                        
                    </p>
                    <div id="M008164_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/webrick/httpservlet/filehandler.rb, line 376</span>
376:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">windows_ambiguous_name?</span>(<span class="ruby-identifier">name</span>)
377:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">if</span> <span class="ruby-regexp re">/[. ]+\z/</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">name</span>
378:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">if</span> <span class="ruby-regexp re">/::\$DATA\z/</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">name</span>
379:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span>
380:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    