<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>WEBrick::HTTPResponse</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../css/main.css" type="text/css" media="screen" />
    <script src="../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Class</span> 
            WEBrick::HTTPResponse 
            
                <span class="parent">&lt; 
                    
                    <a href="../Object.html">Object</a>
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../files/lib/webrick/httpresponse_rb.html">lib/webrick/httpresponse.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    
    <div class="description">
        <p>
An HTTP response.
</p>

    </div>
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>#</dt>
        <dd>
            <ul>
                
                <li><a href="#M008064">[]</a>,</li>
                
                <li><a href="#M008065">[]=</a>,</li>
                
                <li><a href="#M008090">_send_file</a>,</li>
                
                <li><a href="#M008091">_write_data</a></li>
                
            </ul>
        </dd>
    
        <dt>C</dt>
        <dd>
            <ul>
                
                <li><a href="#M008073">chunked=</a>,</li>
                
                <li><a href="#M008072">chunked?</a>,</li>
                
                <li><a href="#M008067">content_length</a>,</li>
                
                <li><a href="#M008068">content_length=</a>,</li>
                
                <li><a href="#M008069">content_type</a>,</li>
                
                <li><a href="#M008070">content_type=</a></li>
                
            </ul>
        </dd>
    
        <dt>E</dt>
        <dd>
            <ul>
                
                <li><a href="#M008071">each</a></li>
                
            </ul>
        </dd>
    
        <dt>K</dt>
        <dd>
            <ul>
                
                <li><a href="#M008074">keep_alive?</a></li>
                
            </ul>
        </dd>
    
        <dt>N</dt>
        <dd>
            <ul>
                
                <li><a href="#M008060">new</a></li>
                
            </ul>
        </dd>
    
        <dt>S</dt>
        <dd>
            <ul>
                
                <li><a href="#M008084">send_body</a>,</li>
                
                <li><a href="#M008088">send_body_io</a>,</li>
                
                <li><a href="#M008089">send_body_string</a>,</li>
                
                <li><a href="#M008079">send_header</a>,</li>
                
                <li><a href="#M008075">send_response</a>,</li>
                
                <li><a href="#M008087">set_error</a>,</li>
                
                <li><a href="#M008086">set_redirect</a>,</li>
                
                <li><a href="#M008076">setup_header</a>,</li>
                
                <li><a href="#M008063">status=</a>,</li>
                
                <li><a href="#M008062">status_line</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    

    

    

    

    
    <div class="sectiontitle">Attributes</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>http_version</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>status</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>header</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>cookies</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>reason_phrase</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>body</td>
            <td class='attr-desc'><p>
Body may be a <a href="../String.html">String</a> or <a
href="../IO.html">IO</a> subclass.
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>request_method</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>request_uri</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>request_http_version</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>filename</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>keep_alive</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>config</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>sent_size</td>
            <td class='attr-desc'></td>
        </tr>
        
    </table>
    

    
            <div class="sectiontitle">Class Public methods</div>
            
            <div class="method">
                <div class="title" id="M008060">
                    
                    <a name="M008060"></a><b>new</b>(config)
                    
                </div>
                
                <div class="description">
                  <p>
Creates a new HTTP response object
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M008060_source')" id="l_M008060_source">show</a>
                        
                    </p>
                    <div id="M008060_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/webrick/httpresponse.rb, line 39</span>
39:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">config</span>)
40:       <span class="ruby-ivar">@config</span> = <span class="ruby-identifier">config</span>
41:       <span class="ruby-ivar">@buffer_size</span> = <span class="ruby-identifier">config</span>[<span class="ruby-identifier">:OutputBufferSize</span>]
42:       <span class="ruby-ivar">@logger</span> = <span class="ruby-identifier">config</span>[<span class="ruby-identifier">:Logger</span>]
43:       <span class="ruby-ivar">@header</span> = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>
44:       <span class="ruby-ivar">@status</span> = <span class="ruby-constant">HTTPStatus</span><span class="ruby-operator">::</span><span class="ruby-constant">RC_OK</span>
45:       <span class="ruby-ivar">@reason_phrase</span> = <span class="ruby-keyword kw">nil</span>
46:       <span class="ruby-ivar">@http_version</span> = <span class="ruby-constant">HTTPVersion</span><span class="ruby-operator">::</span><span class="ruby-identifier">convert</span>(<span class="ruby-ivar">@config</span>[<span class="ruby-identifier">:HTTPVersion</span>])
47:       <span class="ruby-ivar">@body</span> = <span class="ruby-value str">''</span>
48:       <span class="ruby-ivar">@keep_alive</span> = <span class="ruby-keyword kw">true</span>
49:       <span class="ruby-ivar">@cookies</span> = []
50:       <span class="ruby-ivar">@request_method</span> = <span class="ruby-keyword kw">nil</span>
51:       <span class="ruby-ivar">@request_uri</span> = <span class="ruby-keyword kw">nil</span>
52:       <span class="ruby-ivar">@request_http_version</span> = <span class="ruby-ivar">@http_version</span>  <span class="ruby-comment cmt"># temporary</span>
53:       <span class="ruby-ivar">@chunked</span> = <span class="ruby-keyword kw">false</span>
54:       <span class="ruby-ivar">@filename</span> = <span class="ruby-keyword kw">nil</span>
55:       <span class="ruby-ivar">@sent_size</span> = <span class="ruby-value">0</span>
56:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M008064">
                    
                    <a name="M008064"></a><b>[]</b>(field)
                    
                </div>
                
                <div class="description">
                  <p>
Retrieves the response header <tt>field</tt>
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M008064_source')" id="l_M008064_source">show</a>
                        
                    </p>
                    <div id="M008064_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/webrick/httpresponse.rb, line 76</span>
76:     <span class="ruby-keyword kw">def</span> <span class="ruby-operator">[]</span>(<span class="ruby-identifier">field</span>)
77:       <span class="ruby-ivar">@header</span>[<span class="ruby-identifier">field</span>.<span class="ruby-identifier">downcase</span>]
78:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M008065">
                    
                    <a name="M008065"></a><b>[]=</b>(field, value)
                    
                </div>
                
                <div class="description">
                  <p>
Sets the response header <tt>field</tt> to <tt>value</tt>
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M008065_source')" id="l_M008065_source">show</a>
                        
                    </p>
                    <div id="M008065_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/webrick/httpresponse.rb, line 83</span>
83:     <span class="ruby-keyword kw">def</span> <span class="ruby-operator">[]=</span>(<span class="ruby-identifier">field</span>, <span class="ruby-identifier">value</span>)
84:       <span class="ruby-ivar">@header</span>[<span class="ruby-identifier">field</span>.<span class="ruby-identifier">downcase</span>] = <span class="ruby-identifier">value</span>.<span class="ruby-identifier">to_s</span>
85:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M008073">
                    
                    <a name="M008073"></a><b>chunked=</b>(val)
                    
                </div>
                
                <div class="description">
                  <p>
Enables chunked transfer encoding.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M008073_source')" id="l_M008073_source">show</a>
                        
                    </p>
                    <div id="M008073_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/webrick/httpresponse.rb, line 134</span>
134:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">chunked=</span>(<span class="ruby-identifier">val</span>)
135:       <span class="ruby-ivar">@chunked</span> = <span class="ruby-identifier">val</span> <span class="ruby-value">? </span><span class="ruby-keyword kw">true</span> <span class="ruby-operator">:</span> <span class="ruby-keyword kw">false</span>
136:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M008072">
                    
                    <a name="M008072"></a><b>chunked?</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Will this response body be returned using chunked transfer-encoding?
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M008072_source')" id="l_M008072_source">show</a>
                        
                    </p>
                    <div id="M008072_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/webrick/httpresponse.rb, line 127</span>
127:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">chunked?</span>
128:       <span class="ruby-ivar">@chunked</span>
129:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M008067">
                    
                    <a name="M008067"></a><b>content_length</b>()
                    
                </div>
                
                <div class="description">
                  <p>
The content-length header
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M008067_source')" id="l_M008067_source">show</a>
                        
                    </p>
                    <div id="M008067_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/webrick/httpresponse.rb, line 90</span>
90:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">content_length</span>
91:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">len</span> = <span class="ruby-keyword kw">self</span>[<span class="ruby-value str">'content-length'</span>]
92:         <span class="ruby-keyword kw">return</span> <span class="ruby-constant">Integer</span>(<span class="ruby-identifier">len</span>)
93:       <span class="ruby-keyword kw">end</span>
94:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M008068">
                    
                    <a name="M008068"></a><b>content_length=</b>(len)
                    
                </div>
                
                <div class="description">
                  <p>
Sets the content-length header to <tt>len</tt>
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M008068_source')" id="l_M008068_source">show</a>
                        
                    </p>
                    <div id="M008068_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/webrick/httpresponse.rb, line 99</span>
 99:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">content_length=</span>(<span class="ruby-identifier">len</span>)
100:       <span class="ruby-keyword kw">self</span>[<span class="ruby-value str">'content-length'</span>] = <span class="ruby-identifier">len</span>.<span class="ruby-identifier">to_s</span>
101:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M008069">
                    
                    <a name="M008069"></a><b>content_type</b>()
                    
                </div>
                
                <div class="description">
                  <p>
The content-type header
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M008069_source')" id="l_M008069_source">show</a>
                        
                    </p>
                    <div id="M008069_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/webrick/httpresponse.rb, line 106</span>
106:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">content_type</span>
107:       <span class="ruby-keyword kw">self</span>[<span class="ruby-value str">'content-type'</span>]
108:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M008070">
                    
                    <a name="M008070"></a><b>content_type=</b>(type)
                    
                </div>
                
                <div class="description">
                  <p>
Sets the content-type header to <tt>type</tt>
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M008070_source')" id="l_M008070_source">show</a>
                        
                    </p>
                    <div id="M008070_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/webrick/httpresponse.rb, line 113</span>
113:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">content_type=</span>(<span class="ruby-identifier">type</span>)
114:       <span class="ruby-keyword kw">self</span>[<span class="ruby-value str">'content-type'</span>] = <span class="ruby-identifier">type</span>
115:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M008071">
                    
                    <a name="M008071"></a><b>each</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Iterates over each header in the resopnse
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M008071_source')" id="l_M008071_source">show</a>
                        
                    </p>
                    <div id="M008071_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/webrick/httpresponse.rb, line 120</span>
120:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">each</span>
121:       <span class="ruby-ivar">@header</span>.<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">field</span>, <span class="ruby-identifier">value</span><span class="ruby-operator">|</span>  <span class="ruby-keyword kw">yield</span>(<span class="ruby-identifier">field</span>, <span class="ruby-identifier">value</span>) }
122:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M008074">
                    
                    <a name="M008074"></a><b>keep_alive?</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Will this response&#8217;s connection be kept alive?
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M008074_source')" id="l_M008074_source">show</a>
                        
                    </p>
                    <div id="M008074_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/webrick/httpresponse.rb, line 141</span>
141:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">keep_alive?</span>
142:       <span class="ruby-ivar">@keep_alive</span>
143:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M008084">
                    
                    <a name="M008084"></a><b>send_body</b>(socket)
                    
                </div>
                
                <div class="description">
                  <p>
Sends the body on <tt>socket</tt>
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M008084_source')" id="l_M008084_source">show</a>
                        
                    </p>
                    <div id="M008084_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/webrick/httpresponse.rb, line 246</span>
246:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">send_body</span>(<span class="ruby-identifier">socket</span>)
247:       <span class="ruby-keyword kw">case</span> <span class="ruby-ivar">@body</span>
248:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">IO</span> <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">send_body_io</span>(<span class="ruby-identifier">socket</span>)
249:       <span class="ruby-keyword kw">else</span> <span class="ruby-identifier">send_body_string</span>(<span class="ruby-identifier">socket</span>)
250:       <span class="ruby-keyword kw">end</span>
251:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M008079">
                    
                    <a name="M008079"></a><b>send_header</b>(socket)
                    
                </div>
                
                <div class="description">
                  <p>
Sends the headers on <tt>socket</tt>
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M008079_source')" id="l_M008079_source">show</a>
                        
                    </p>
                    <div id="M008079_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/webrick/httpresponse.rb, line 228</span>
228:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">send_header</span>(<span class="ruby-identifier">socket</span>)
229:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@http_version</span>.<span class="ruby-identifier">major</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
230:         <span class="ruby-identifier">data</span> = <span class="ruby-identifier">status_line</span>()
231:         <span class="ruby-ivar">@header</span>.<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
232:           <span class="ruby-identifier">tmp</span> = <span class="ruby-identifier">key</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/\bwww|^te$|\b\w/</span>){ <span class="ruby-identifier">$&amp;</span>.<span class="ruby-identifier">upcase</span> }
233:           <span class="ruby-identifier">data</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;#{tmp}: #{value}&quot;</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">CRLF</span>
234:         }
235:         <span class="ruby-ivar">@cookies</span>.<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">cookie</span><span class="ruby-operator">|</span>
236:           <span class="ruby-identifier">data</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;Set-Cookie: &quot;</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">cookie</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">CRLF</span>
237:         }
238:         <span class="ruby-identifier">data</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">CRLF</span>
239:         <span class="ruby-identifier">_write_data</span>(<span class="ruby-identifier">socket</span>, <span class="ruby-identifier">data</span>)
240:       <span class="ruby-keyword kw">end</span>
241:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M008075">
                    
                    <a name="M008075"></a><b>send_response</b>(socket)
                    
                </div>
                
                <div class="description">
                  <p>
Sends the response on <tt>socket</tt>
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M008075_source')" id="l_M008075_source">show</a>
                        
                    </p>
                    <div id="M008075_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/webrick/httpresponse.rb, line 148</span>
148:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">send_response</span>(<span class="ruby-identifier">socket</span>)
149:       <span class="ruby-keyword kw">begin</span>
150:         <span class="ruby-identifier">setup_header</span>()
151:         <span class="ruby-identifier">send_header</span>(<span class="ruby-identifier">socket</span>)
152:         <span class="ruby-identifier">send_body</span>(<span class="ruby-identifier">socket</span>)
153:       <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">EPIPE</span>, <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">ECONNRESET</span>, <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">ENOTCONN</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ex</span>
154:         <span class="ruby-ivar">@logger</span>.<span class="ruby-identifier">debug</span>(<span class="ruby-identifier">ex</span>)
155:         <span class="ruby-ivar">@keep_alive</span> = <span class="ruby-keyword kw">false</span>
156:       <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ex</span>
157:         <span class="ruby-ivar">@logger</span>.<span class="ruby-identifier">error</span>(<span class="ruby-identifier">ex</span>)
158:         <span class="ruby-ivar">@keep_alive</span> = <span class="ruby-keyword kw">false</span>
159:       <span class="ruby-keyword kw">end</span>
160:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M008087">
                    
                    <a name="M008087"></a><b>set_error</b>(ex, backtrace=false)
                    
                </div>
                
                <div class="description">
                  <p>
Creates an error page for exception <tt>ex</tt> with an optional
<tt>backtrace</tt>
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M008087_source')" id="l_M008087_source">show</a>
                        
                    </p>
                    <div id="M008087_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/webrick/httpresponse.rb, line 275</span>
275:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set_error</span>(<span class="ruby-identifier">ex</span>, <span class="ruby-identifier">backtrace</span>=<span class="ruby-keyword kw">false</span>)
276:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">ex</span>
277:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">HTTPStatus</span><span class="ruby-operator">::</span><span class="ruby-constant">Status</span>
278:         <span class="ruby-ivar">@keep_alive</span> = <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">if</span> <span class="ruby-constant">HTTPStatus</span><span class="ruby-operator">::</span><span class="ruby-identifier">error?</span>(<span class="ruby-identifier">ex</span>.<span class="ruby-identifier">code</span>)
279:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">status</span> = <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">code</span>
280:       <span class="ruby-keyword kw">else</span>
281:         <span class="ruby-ivar">@keep_alive</span> = <span class="ruby-keyword kw">false</span>
282:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">status</span> = <span class="ruby-constant">HTTPStatus</span><span class="ruby-operator">::</span><span class="ruby-constant">RC_INTERNAL_SERVER_ERROR</span>
283:       <span class="ruby-keyword kw">end</span>
284:       <span class="ruby-ivar">@header</span>[<span class="ruby-value str">'content-type'</span>] = <span class="ruby-value str">&quot;text/html; charset=ISO-8859-1&quot;</span>
285: 
286:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:create_error_page</span>)
287:         <span class="ruby-identifier">create_error_page</span>()
288:         <span class="ruby-keyword kw">return</span>
289:       <span class="ruby-keyword kw">end</span>
290: 
291:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@request_uri</span>
292:         <span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span> = <span class="ruby-ivar">@request_uri</span>.<span class="ruby-identifier">host</span>, <span class="ruby-ivar">@request_uri</span>.<span class="ruby-identifier">port</span>
293:       <span class="ruby-keyword kw">else</span>
294:         <span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span> = <span class="ruby-ivar">@config</span>[<span class="ruby-identifier">:ServerName</span>], <span class="ruby-ivar">@config</span>[<span class="ruby-identifier">:Port</span>]
295:       <span class="ruby-keyword kw">end</span>
296: 
297:       <span class="ruby-ivar">@body</span> = <span class="ruby-value str">''</span>
298:       <span class="ruby-ivar">@body</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;&lt;!DOCTYPE HTML PUBLIC \&quot;-//W3C//DTD HTML 4.0//EN\&quot;&gt;\n&lt;HTML&gt;\n&lt;HEAD&gt;&lt;TITLE&gt;\#{HTMLUtils::escape(@reason_phrase)}&lt;/TITLE&gt;&lt;/HEAD&gt;\n&lt;BODY&gt;\n&lt;H1&gt;\#{HTMLUtils::escape(@reason_phrase)}&lt;/H1&gt;\n\#{HTMLUtils::escape(ex.message)}\n&lt;HR&gt;\n&quot;</span>
299: 
300:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">backtrace</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">$DEBUG</span>
301:         <span class="ruby-ivar">@body</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;backtrace of `#{HTMLUtils::escape(ex.class.to_s)}' &quot;</span>
302:         <span class="ruby-ivar">@body</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;#{HTMLUtils::escape(ex.message)}&quot;</span>
303:         <span class="ruby-ivar">@body</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;&lt;PRE&gt;&quot;</span>
304:         <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">backtrace</span>.<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">line</span><span class="ruby-operator">|</span> <span class="ruby-ivar">@body</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;\t#{line}\n&quot;</span>}
305:         <span class="ruby-ivar">@body</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;&lt;/PRE&gt;&lt;HR&gt;&quot;</span>
306:       <span class="ruby-keyword kw">end</span>
307: 
308:       <span class="ruby-ivar">@body</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;&lt;ADDRESS&gt;\n\#{HTMLUtils::escape(@config[:ServerSoftware])} at\n\#{host}:\#{port}\n&lt;/ADDRESS&gt;\n&lt;/BODY&gt;\n&lt;/HTML&gt;\n&quot;</span>
309:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M008086">
                    
                    <a name="M008086"></a><b>set_redirect</b>(status, url)
                    
                </div>
                
                <div class="description">
                  <p>
Redirects to <tt>url</tt> with a <a
href="HTTPStatus/Redirect.html">WEBrick::HTTPStatus::Redirect</a>
<tt>status</tt>.
</p>
<p>
Example:
</p>
<pre>
  res.set_redirect WEBrick::HTTPStatus::TemporaryRedirect
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M008086_source')" id="l_M008086_source">show</a>
                        
                    </p>
                    <div id="M008086_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/webrick/httpresponse.rb, line 266</span>
266:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set_redirect</span>(<span class="ruby-identifier">status</span>, <span class="ruby-identifier">url</span>)
267:       <span class="ruby-ivar">@body</span> = <span class="ruby-node">&quot;&lt;HTML&gt;&lt;A HREF=\&quot;#{url.to_s}\&quot;&gt;#{url.to_s}&lt;/A&gt;.&lt;/HTML&gt;\n&quot;</span>
268:       <span class="ruby-ivar">@header</span>[<span class="ruby-value str">'location'</span>] = <span class="ruby-identifier">url</span>.<span class="ruby-identifier">to_s</span>
269:       <span class="ruby-identifier">raise</span> <span class="ruby-identifier">status</span>
270:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M008076">
                    
                    <a name="M008076"></a><b>setup_header</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Sets up the headers for sending
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M008076_source')" id="l_M008076_source">show</a>
                        
                    </p>
                    <div id="M008076_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/webrick/httpresponse.rb, line 165</span>
165:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">setup_header</span>()
166:       <span class="ruby-ivar">@reason_phrase</span>    <span class="ruby-operator">||=</span> <span class="ruby-constant">HTTPStatus</span><span class="ruby-operator">::</span><span class="ruby-identifier">reason_phrase</span>(<span class="ruby-ivar">@status</span>)
167:       <span class="ruby-ivar">@header</span>[<span class="ruby-value str">'server'</span>] <span class="ruby-operator">||=</span> <span class="ruby-ivar">@config</span>[<span class="ruby-identifier">:ServerSoftware</span>]
168:       <span class="ruby-ivar">@header</span>[<span class="ruby-value str">'date'</span>]   <span class="ruby-operator">||=</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">httpdate</span>
169: 
170:       <span class="ruby-comment cmt"># HTTP/0.9 features</span>
171:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@request_http_version</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value str">&quot;1.0&quot;</span>
172:         <span class="ruby-ivar">@http_version</span> = <span class="ruby-constant">HTTPVersion</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;0.9&quot;</span>)
173:         <span class="ruby-ivar">@keep_alive</span> = <span class="ruby-keyword kw">false</span>
174:       <span class="ruby-keyword kw">end</span>
175: 
176:       <span class="ruby-comment cmt"># HTTP/1.0 features</span>
177:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@request_http_version</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value str">&quot;1.1&quot;</span>
178:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">chunked?</span>
179:           <span class="ruby-ivar">@chunked</span> = <span class="ruby-keyword kw">false</span>
180:           <span class="ruby-identifier">ver</span> = <span class="ruby-ivar">@request_http_version</span>.<span class="ruby-identifier">to_s</span>
181:           <span class="ruby-identifier">msg</span> = <span class="ruby-node">&quot;chunked is set for an HTTP/#{ver} request. (ignored)&quot;</span>
182:           <span class="ruby-ivar">@logger</span>.<span class="ruby-identifier">warn</span>(<span class="ruby-identifier">msg</span>)
183:         <span class="ruby-keyword kw">end</span>
184:       <span class="ruby-keyword kw">end</span>
185: 
186:       <span class="ruby-comment cmt"># Determine the message length (RFC2616 -- 4.4 Message Length)</span>
187:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@status</span> <span class="ruby-operator">==</span> <span class="ruby-value">304</span> <span class="ruby-operator">||</span> <span class="ruby-ivar">@status</span> <span class="ruby-operator">==</span> <span class="ruby-value">204</span> <span class="ruby-operator">||</span> <span class="ruby-constant">HTTPStatus</span><span class="ruby-operator">::</span><span class="ruby-identifier">info?</span>(<span class="ruby-ivar">@status</span>)
188:         <span class="ruby-ivar">@header</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value str">'content-length'</span>)
189:         <span class="ruby-ivar">@body</span> = <span class="ruby-value str">&quot;&quot;</span>
190:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">chunked?</span>
191:         <span class="ruby-ivar">@header</span>[<span class="ruby-value str">&quot;transfer-encoding&quot;</span>] = <span class="ruby-value str">&quot;chunked&quot;</span>
192:         <span class="ruby-ivar">@header</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value str">'content-length'</span>)
193:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-regexp re">%r{^multipart/byteranges}</span> <span class="ruby-operator">=~</span> <span class="ruby-ivar">@header</span>[<span class="ruby-value str">'content-type'</span>]
194:         <span class="ruby-ivar">@header</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value str">'content-length'</span>)
195:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-ivar">@header</span>[<span class="ruby-value str">'content-length'</span>].<span class="ruby-identifier">nil?</span>
196:         <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@body</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">IO</span>)
197:           <span class="ruby-ivar">@header</span>[<span class="ruby-value str">'content-length'</span>] = <span class="ruby-ivar">@body</span> <span class="ruby-operator">?</span> <span class="ruby-ivar">@body</span>.<span class="ruby-identifier">bytesize</span> <span class="ruby-operator">:</span> <span class="ruby-value">0</span>
198:         <span class="ruby-keyword kw">end</span>
199:       <span class="ruby-keyword kw">end</span>
200: 
201:       <span class="ruby-comment cmt"># Keep-Alive connection.</span>
202:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@header</span>[<span class="ruby-value str">'connection'</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;close&quot;</span>
203:          <span class="ruby-ivar">@keep_alive</span> = <span class="ruby-keyword kw">false</span>
204:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">keep_alive?</span>
205:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">chunked?</span> <span class="ruby-operator">||</span> <span class="ruby-ivar">@header</span>[<span class="ruby-value str">'content-length'</span>]
206:           <span class="ruby-ivar">@header</span>[<span class="ruby-value str">'connection'</span>] = <span class="ruby-value str">&quot;Keep-Alive&quot;</span>
207:         <span class="ruby-keyword kw">else</span>
208:           <span class="ruby-identifier">msg</span> = <span class="ruby-value str">&quot;Could not determine content-length of response body. Set content-length of the response or set Response#chunked = true&quot;</span>
209:           <span class="ruby-ivar">@logger</span>.<span class="ruby-identifier">warn</span>(<span class="ruby-identifier">msg</span>)
210:           <span class="ruby-ivar">@header</span>[<span class="ruby-value str">'connection'</span>] = <span class="ruby-value str">&quot;close&quot;</span>
211:           <span class="ruby-ivar">@keep_alive</span> = <span class="ruby-keyword kw">false</span>
212:         <span class="ruby-keyword kw">end</span>
213:       <span class="ruby-keyword kw">else</span>
214:         <span class="ruby-ivar">@header</span>[<span class="ruby-value str">'connection'</span>] = <span class="ruby-value str">&quot;close&quot;</span>
215:       <span class="ruby-keyword kw">end</span>
216: 
217:       <span class="ruby-comment cmt"># Location is a single absoluteURI.</span>
218:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">location</span> = <span class="ruby-ivar">@header</span>[<span class="ruby-value str">'location'</span>]
219:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@request_uri</span>
220:           <span class="ruby-ivar">@header</span>[<span class="ruby-value str">'location'</span>] = <span class="ruby-ivar">@request_uri</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">location</span>)
221:         <span class="ruby-keyword kw">end</span>
222:       <span class="ruby-keyword kw">end</span>
223:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M008063">
                    
                    <a name="M008063"></a><b>status=</b>(status)
                    
                </div>
                
                <div class="description">
                  <p>
Sets the response&#8217;s status to the <tt>status</tt> code
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M008063_source')" id="l_M008063_source">show</a>
                        
                    </p>
                    <div id="M008063_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/webrick/httpresponse.rb, line 68</span>
68:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">status=</span>(<span class="ruby-identifier">status</span>)
69:       <span class="ruby-ivar">@status</span> = <span class="ruby-identifier">status</span>
70:       <span class="ruby-ivar">@reason_phrase</span> = <span class="ruby-constant">HTTPStatus</span><span class="ruby-operator">::</span><span class="ruby-identifier">reason_phrase</span>(<span class="ruby-identifier">status</span>)
71:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M008062">
                    
                    <a name="M008062"></a><b>status_line</b>()
                    
                </div>
                
                <div class="description">
                  <p>
The response&#8217;s HTTP status line
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M008062_source')" id="l_M008062_source">show</a>
                        
                    </p>
                    <div id="M008062_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/webrick/httpresponse.rb, line 61</span>
61:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">status_line</span>
62:       <span class="ruby-node">&quot;HTTP/#@http_version #@status #@reason_phrase #{CRLF}&quot;</span>
63:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Private methods</div>
            
            <div class="method">
                <div class="title" id="M008090">
                    
                    <a name="M008090"></a><b>_send_file</b>(output, input, offset, size)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M008090_source')" id="l_M008090_source">show</a>
                        
                    </p>
                    <div id="M008090_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/webrick/httpresponse.rb, line 376</span>
376:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">_send_file</span>(<span class="ruby-identifier">output</span>, <span class="ruby-identifier">input</span>, <span class="ruby-identifier">offset</span>, <span class="ruby-identifier">size</span>)
377:       <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">offset</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
378:         <span class="ruby-identifier">sz</span> = <span class="ruby-ivar">@buffer_size</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">size</span> <span class="ruby-value">? </span><span class="ruby-ivar">@buffer_size</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">size</span>
379:         <span class="ruby-identifier">buf</span> = <span class="ruby-identifier">input</span>.<span class="ruby-identifier">read</span>(<span class="ruby-identifier">sz</span>)
380:         <span class="ruby-identifier">offset</span> <span class="ruby-operator">-=</span> <span class="ruby-identifier">buf</span>.<span class="ruby-identifier">bytesize</span>
381:       <span class="ruby-keyword kw">end</span>
382: 
383:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
384:         <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">buf</span> = <span class="ruby-identifier">input</span>.<span class="ruby-identifier">read</span>(<span class="ruby-ivar">@buffer_size</span>)
385:           <span class="ruby-identifier">_write_data</span>(<span class="ruby-identifier">output</span>, <span class="ruby-identifier">buf</span>)
386:         <span class="ruby-keyword kw">end</span>
387:       <span class="ruby-keyword kw">else</span>
388:         <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
389:           <span class="ruby-identifier">sz</span> = <span class="ruby-ivar">@buffer_size</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">size</span> <span class="ruby-value">? </span><span class="ruby-ivar">@buffer_size</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">size</span>
390:           <span class="ruby-identifier">buf</span> = <span class="ruby-identifier">input</span>.<span class="ruby-identifier">read</span>(<span class="ruby-identifier">sz</span>)
391:           <span class="ruby-identifier">_write_data</span>(<span class="ruby-identifier">output</span>, <span class="ruby-identifier">buf</span>)
392:           <span class="ruby-identifier">size</span> <span class="ruby-operator">-=</span> <span class="ruby-identifier">buf</span>.<span class="ruby-identifier">bytesize</span>
393:         <span class="ruby-keyword kw">end</span>
394:       <span class="ruby-keyword kw">end</span>
395:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M008091">
                    
                    <a name="M008091"></a><b>_write_data</b>(socket, data)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M008091_source')" id="l_M008091_source">show</a>
                        
                    </p>
                    <div id="M008091_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/webrick/httpresponse.rb, line 397</span>
397:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">_write_data</span>(<span class="ruby-identifier">socket</span>, <span class="ruby-identifier">data</span>)
398:       <span class="ruby-identifier">socket</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">data</span>
399:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M008088">
                    
                    <a name="M008088"></a><b>send_body_io</b>(socket)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M008088_source')" id="l_M008088_source">show</a>
                        
                    </p>
                    <div id="M008088_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/webrick/httpresponse.rb, line 330</span>
330:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">send_body_io</span>(<span class="ruby-identifier">socket</span>)
331:       <span class="ruby-keyword kw">begin</span>
332:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@request_method</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;HEAD&quot;</span>
333:           <span class="ruby-comment cmt"># do nothing</span>
334:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">chunked?</span>
335:           <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">buf</span> = <span class="ruby-ivar">@body</span>.<span class="ruby-identifier">read</span>(<span class="ruby-ivar">@buffer_size</span>)
336:             <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">buf</span>.<span class="ruby-identifier">empty?</span>
337:             <span class="ruby-identifier">data</span> = <span class="ruby-value str">&quot;&quot;</span>
338:             <span class="ruby-identifier">data</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">format</span>(<span class="ruby-value str">&quot;%x&quot;</span>, <span class="ruby-identifier">buf</span>.<span class="ruby-identifier">bytesize</span>) <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">CRLF</span>
339:             <span class="ruby-identifier">data</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">buf</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">CRLF</span>
340:             <span class="ruby-identifier">_write_data</span>(<span class="ruby-identifier">socket</span>, <span class="ruby-identifier">data</span>)
341:             <span class="ruby-ivar">@sent_size</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">buf</span>.<span class="ruby-identifier">bytesize</span>
342:           <span class="ruby-keyword kw">end</span>
343:           <span class="ruby-identifier">_write_data</span>(<span class="ruby-identifier">socket</span>, <span class="ruby-node">&quot;0#{CRLF}#{CRLF}&quot;</span>)
344:         <span class="ruby-keyword kw">else</span>
345:           <span class="ruby-identifier">size</span> = <span class="ruby-ivar">@header</span>[<span class="ruby-value str">'content-length'</span>].<span class="ruby-identifier">to_i</span>
346:           <span class="ruby-identifier">_send_file</span>(<span class="ruby-identifier">socket</span>, <span class="ruby-ivar">@body</span>, <span class="ruby-value">0</span>, <span class="ruby-identifier">size</span>)
347:           <span class="ruby-ivar">@sent_size</span> = <span class="ruby-identifier">size</span>
348:         <span class="ruby-keyword kw">end</span>
349:       <span class="ruby-keyword kw">ensure</span>
350:         <span class="ruby-ivar">@body</span>.<span class="ruby-identifier">close</span>
351:       <span class="ruby-keyword kw">end</span>
352:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M008089">
                    
                    <a name="M008089"></a><b>send_body_string</b>(socket)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M008089_source')" id="l_M008089_source">show</a>
                        
                    </p>
                    <div id="M008089_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/webrick/httpresponse.rb, line 354</span>
354:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">send_body_string</span>(<span class="ruby-identifier">socket</span>)
355:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@request_method</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;HEAD&quot;</span>
356:         <span class="ruby-comment cmt"># do nothing</span>
357:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">chunked?</span>
358:         <span class="ruby-identifier">body</span> <span class="ruby-value">? </span><span class="ruby-ivar">@body</span>.<span class="ruby-identifier">bytesize</span> <span class="ruby-operator">:</span> <span class="ruby-value">0</span>
359:         <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">buf</span> = <span class="ruby-ivar">@body</span>[<span class="ruby-ivar">@sent_size</span>, <span class="ruby-ivar">@buffer_size</span>]
360:           <span class="ruby-keyword kw">break</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">buf</span>.<span class="ruby-identifier">empty?</span>
361:           <span class="ruby-identifier">data</span> = <span class="ruby-value str">&quot;&quot;</span>
362:           <span class="ruby-identifier">data</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">format</span>(<span class="ruby-value str">&quot;%x&quot;</span>, <span class="ruby-identifier">buf</span>.<span class="ruby-identifier">bytesize</span>) <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">CRLF</span>
363:           <span class="ruby-identifier">data</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">buf</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">CRLF</span>
364:           <span class="ruby-identifier">_write_data</span>(<span class="ruby-identifier">socket</span>, <span class="ruby-identifier">data</span>)
365:           <span class="ruby-ivar">@sent_size</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">buf</span>.<span class="ruby-identifier">bytesize</span>
366:         <span class="ruby-keyword kw">end</span>
367:         <span class="ruby-identifier">_write_data</span>(<span class="ruby-identifier">socket</span>, <span class="ruby-node">&quot;0#{CRLF}#{CRLF}&quot;</span>)
368:       <span class="ruby-keyword kw">else</span>
369:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@body</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@body</span>.<span class="ruby-identifier">bytesize</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
370:           <span class="ruby-identifier">_write_data</span>(<span class="ruby-identifier">socket</span>, <span class="ruby-ivar">@body</span>)
371:           <span class="ruby-ivar">@sent_size</span> = <span class="ruby-ivar">@body</span>.<span class="ruby-identifier">bytesize</span>
372:         <span class="ruby-keyword kw">end</span>
373:       <span class="ruby-keyword kw">end</span>
374:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    