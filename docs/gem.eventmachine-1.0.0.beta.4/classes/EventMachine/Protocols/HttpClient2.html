<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>EventMachine::Protocols::HttpClient2</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../../css/main.css" type="text/css" media="screen" />
    <script src="../../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Class</span> 
            EventMachine::Protocols::HttpClient2 
            
                <span class="parent">&lt; 
                    
                    Connection
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../../files/lib/em/protocols/httpclient2_rb.html">lib/em/protocols/httpclient2.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    
    <div class="description">
        <p>
<b>Note:</b> This class is deprecated and will be removed. Please use
EM-HTTP-<a href="HttpClient2/Request.html">Request</a> instead.
</p>
<h3>Usage</h3>
<pre>
 EM.run{
   conn = EM::Protocols::HttpClient2.connect 'google.com', 80

   req = conn.get('/')
   req.callback{ |response|
     p(response.status)
     p(response.headers)
     p(response.content)
   }
 }
</pre>

    </div>
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>C</dt>
        <dd>
            <ul>
                
                <li><a href="#M000153">connect</a>,</li>
                
                <li><a href="#M000158">connection_completed</a></li>
                
            </ul>
        </dd>
    
        <dt>G</dt>
        <dd>
            <ul>
                
                <li><a href="#M000154">get</a></li>
                
            </ul>
        </dd>
    
        <dt>N</dt>
        <dd>
            <ul>
                
                <li><a href="#M000139">new</a></li>
                
            </ul>
        </dd>
    
        <dt>P</dt>
        <dd>
            <ul>
                
                <li><a href="#M000165">pop_request</a>,</li>
                
                <li><a href="#M000155">post</a>,</li>
                
                <li><a href="#M000157">post_init</a></li>
                
            </ul>
        </dd>
    
        <dt>R</dt>
        <dd>
            <ul>
                
                <li><a href="#M000162">receive_binary_data</a>,</li>
                
                <li><a href="#M000161">receive_line</a>,</li>
                
                <li><a href="#M000160">request</a></li>
                
            </ul>
        </dd>
    
        <dt>S</dt>
        <dd>
            <ul>
                
                <li><a href="#M000156">set_default_host_header</a></li>
                
            </ul>
        </dd>
    
        <dt>U</dt>
        <dd>
            <ul>
                
                <li><a href="#M000159">unbind</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    
    <div class="sectiontitle">Included Modules</div>
    <ul>
        
        <li>
            
            <a href="Stomp.html">EventMachine::Protocols::Stomp</a>
            
            START:includes
        </li>
        
    </ul>
    

    

    
    <div class="sectiontitle">Classes and Modules</div>
    <ul>
        
        <li><span class="type">CLASS</span> <a href="HttpClient2/Request.html">EventMachine::Protocols::HttpClient2::Request</a></li>
        
    </ul>
    

    

    

    
            <div class="sectiontitle">Class Public methods</div>
            
            <div class="method">
                <div class="title" id="M000153">
                    
                    <a name="M000153"></a><b>connect</b>(*args)
                    
                </div>
                
                <div class="description">
                  <p>
Make a connection to a remote HTTP server. Can take either a pair of
arguments (which will be interpreted as a hostname/ip-address and a port),
or a hash. If the arguments are a hash, then supported values include:
</p>
<pre>
 :host =&gt; a hostname or ip-address
 :port =&gt; a port number
 :ssl =&gt; true to enable ssl
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000153_source')" id="l_M000153_source">show</a>
                        
                    </p>
                    <div id="M000153_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/em/protocols/httpclient2.rb, line 246</span>
246:       <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">connect</span> <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>
247:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">2</span>
248:           <span class="ruby-identifier">args</span> = {<span class="ruby-identifier">:host=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">args</span>[<span class="ruby-value">0</span>], <span class="ruby-identifier">:port=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">args</span>[<span class="ruby-value">1</span>]}
249:         <span class="ruby-keyword kw">else</span>
250:           <span class="ruby-identifier">args</span> = <span class="ruby-identifier">args</span>.<span class="ruby-identifier">first</span>
251:         <span class="ruby-keyword kw">end</span>
252: 
253:         <span class="ruby-identifier">h</span>,<span class="ruby-identifier">prt</span>,<span class="ruby-identifier">ssl</span> = <span class="ruby-identifier">args</span>[<span class="ruby-identifier">:host</span>], <span class="ruby-constant">Integer</span>(<span class="ruby-identifier">args</span>[<span class="ruby-identifier">:port</span>]), (<span class="ruby-identifier">args</span>[<span class="ruby-identifier">:tls</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">args</span>[<span class="ruby-identifier">:ssl</span>])
254:         <span class="ruby-identifier">conn</span> = <span class="ruby-constant">EM</span>.<span class="ruby-identifier">connect</span>( <span class="ruby-identifier">h</span>, <span class="ruby-identifier">prt</span>, <span class="ruby-keyword kw">self</span> )
255:         <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">start_tls</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ssl</span>
256:         <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">set_default_host_header</span>( <span class="ruby-identifier">h</span>, <span class="ruby-identifier">prt</span>, <span class="ruby-identifier">ssl</span> )
257:         <span class="ruby-identifier">conn</span>
258:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000139">
                    
                    <a name="M000139"></a><b>new</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000139_source')" id="l_M000139_source">show</a>
                        
                    </p>
                    <div id="M000139_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/em/protocols/httpclient2.rb, line 46</span>
46:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>
47:         <span class="ruby-identifier">warn</span> <span class="ruby-value str">&quot;HttpClient2 is deprecated and will be removed. EM-Http-Request should be used instead.&quot;</span>
48: 
49:         <span class="ruby-ivar">@authorization</span> = <span class="ruby-keyword kw">nil</span>
50:         <span class="ruby-ivar">@closed</span> = <span class="ruby-keyword kw">nil</span>
51:         <span class="ruby-ivar">@requests</span> = <span class="ruby-keyword kw">nil</span>
52:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M000158">
                    
                    <a name="M000158"></a><b>connection_completed</b>()
                    
                </div>
                
                <div class="description">
                  <p>
@private
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000158_source')" id="l_M000158_source">show</a>
                        
                    </p>
                    <div id="M000158_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/em/protocols/httpclient2.rb, line 309</span>
309:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">connection_completed</span>
310:         <span class="ruby-keyword kw">super</span>
311:         <span class="ruby-ivar">@connected</span>.<span class="ruby-identifier">succeed</span>
312:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000154">
                    
                    <a name="M000154"></a><b>get</b>(args)
                    
                </div>
                
                <div class="description">
                  <p>
Get a url
</p>
<pre>
 req = conn.get(:uri =&gt; '/')
 req.callback{|response| puts response.content }
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000154_source')" id="l_M000154_source">show</a>
                        
                    </p>
                    <div id="M000154_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/em/protocols/httpclient2.rb, line 265</span>
265:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get</span> <span class="ruby-identifier">args</span>
266:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>)
267:           <span class="ruby-identifier">args</span> = {<span class="ruby-identifier">:uri=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">args</span>}
268:         <span class="ruby-keyword kw">end</span>
269:         <span class="ruby-identifier">args</span>[<span class="ruby-identifier">:verb</span>] = <span class="ruby-value str">&quot;GET&quot;</span>
270:         <span class="ruby-identifier">request</span> <span class="ruby-identifier">args</span>
271:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000165">
                    
                    <a name="M000165"></a><b>pop_request</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000165_source')" id="l_M000165_source">show</a>
                        
                    </p>
                    <div id="M000165_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/em/protocols/httpclient2.rb, line 366</span>
366:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">pop_request</span>
367:         <span class="ruby-ivar">@requests</span>.<span class="ruby-identifier">pop</span>
368:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000155">
                    
                    <a name="M000155"></a><b>post</b>(args)
                    
                </div>
                
                <div class="description">
                  <p>
Post to a url
</p>
<pre>
 req = conn.post('/data')
 req.callback{|response| puts response.content }
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000155_source')" id="l_M000155_source">show</a>
                        
                    </p>
                    <div id="M000155_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/em/protocols/httpclient2.rb, line 279</span>
279:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">post</span> <span class="ruby-identifier">args</span>
280:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>)
281:           <span class="ruby-identifier">args</span> = {<span class="ruby-identifier">:uri=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">args</span>}
282:         <span class="ruby-keyword kw">end</span>
283:         <span class="ruby-identifier">args</span>[<span class="ruby-identifier">:verb</span>] = <span class="ruby-value str">&quot;POST&quot;</span>
284:         <span class="ruby-identifier">request</span> <span class="ruby-identifier">args</span>
285:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000157">
                    
                    <a name="M000157"></a><b>post_init</b>()
                    
                </div>
                
                <div class="description">
                  <p>
@private
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000157_source')" id="l_M000157_source">show</a>
                        
                    </p>
                    <div id="M000157_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/em/protocols/httpclient2.rb, line 303</span>
303:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">post_init</span>
304:         <span class="ruby-keyword kw">super</span>
305:         <span class="ruby-ivar">@connected</span> = <span class="ruby-constant">EM</span><span class="ruby-operator">::</span><span class="ruby-constant">DefaultDeferrable</span>.<span class="ruby-identifier">new</span>
306:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000162">
                    
                    <a name="M000162"></a><b>receive_binary_data</b>(text)
                    
                </div>
                
                <div class="description">
                  <p>
@private
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000162_source')" id="l_M000162_source">show</a>
                        
                    </p>
                    <div id="M000162_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/em/protocols/httpclient2.rb, line 358</span>
358:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">receive_binary_data</span> <span class="ruby-identifier">text</span>
359:         <span class="ruby-ivar">@requests</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">receive_text</span> <span class="ruby-identifier">text</span>
360:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000161">
                    
                    <a name="M000161"></a><b>receive_line</b>(ln)
                    
                </div>
                
                <div class="description">
                  <p>
@private
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000161_source')" id="l_M000161_source">show</a>
                        
                    </p>
                    <div id="M000161_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/em/protocols/httpclient2.rb, line 348</span>
348:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">receive_line</span> <span class="ruby-identifier">ln</span>
349:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">req</span> = <span class="ruby-ivar">@requests</span>.<span class="ruby-identifier">last</span>
350:           <span class="ruby-identifier">req</span>.<span class="ruby-identifier">receive_line</span> <span class="ruby-identifier">ln</span>
351:         <span class="ruby-keyword kw">else</span>
352:           <span class="ruby-identifier">p</span> <span class="ruby-value str">&quot;??????????&quot;</span>
353:           <span class="ruby-identifier">p</span> <span class="ruby-identifier">ln</span>
354:         <span class="ruby-keyword kw">end</span>
355:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000160">
                    
                    <a name="M000160"></a><b>request</b>(args)
                    
                </div>
                
                <div class="description">
                  <p>
@private
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000160_source')" id="l_M000160_source">show</a>
                        
                    </p>
                    <div id="M000160_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/em/protocols/httpclient2.rb, line 334</span>
334:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">request</span> <span class="ruby-identifier">args</span>
335:         <span class="ruby-identifier">args</span>[<span class="ruby-identifier">:host_header</span>] = <span class="ruby-ivar">@host_header</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">:host_header</span>)
336:         <span class="ruby-identifier">args</span>[<span class="ruby-identifier">:authorization</span>] = <span class="ruby-ivar">@authorization</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">:authorization</span>)
337:         <span class="ruby-identifier">r</span> = <span class="ruby-constant">Request</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword kw">self</span>, <span class="ruby-identifier">args</span>
338:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@closed</span>
339:           <span class="ruby-identifier">r</span>.<span class="ruby-identifier">fail</span>
340:         <span class="ruby-keyword kw">else</span>
341:           (<span class="ruby-ivar">@requests</span> <span class="ruby-operator">||=</span> []).<span class="ruby-identifier">unshift</span> <span class="ruby-identifier">r</span>
342:           <span class="ruby-ivar">@connected</span>.<span class="ruby-identifier">callback</span> {<span class="ruby-identifier">r</span>.<span class="ruby-identifier">send_request</span>}
343:         <span class="ruby-keyword kw">end</span>
344:         <span class="ruby-identifier">r</span>
345:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000156">
                    
                    <a name="M000156"></a><b>set_default_host_header</b>(host, port, ssl)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000156_source')" id="l_M000156_source">show</a>
                        
                    </p>
                    <div id="M000156_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/em/protocols/httpclient2.rb, line 293</span>
293:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set_default_host_header</span> <span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>, <span class="ruby-identifier">ssl</span>
294:         <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">ssl</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">port</span> <span class="ruby-operator">!=</span> <span class="ruby-value">443</span>) <span class="ruby-keyword kw">or</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">ssl</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">port</span> <span class="ruby-operator">!=</span> <span class="ruby-value">80</span>)
295:           <span class="ruby-ivar">@host_header</span> = <span class="ruby-node">&quot;#{host}:#{port}&quot;</span>
296:         <span class="ruby-keyword kw">else</span>
297:           <span class="ruby-ivar">@host_header</span> = <span class="ruby-identifier">host</span>
298:         <span class="ruby-keyword kw">end</span>
299:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000159">
                    
                    <a name="M000159"></a><b>unbind</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000159_source')" id="l_M000159_source">show</a>
                        
                    </p>
                    <div id="M000159_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/em/protocols/httpclient2.rb, line 327</span>
327:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">unbind</span>
328:         <span class="ruby-keyword kw">super</span>
329:         <span class="ruby-ivar">@closed</span> = <span class="ruby-keyword kw">true</span>
330:         (<span class="ruby-ivar">@requests</span> <span class="ruby-operator">||</span> []).<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">fail</span>}
331:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    