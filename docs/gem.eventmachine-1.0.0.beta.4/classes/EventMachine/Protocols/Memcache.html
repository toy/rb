<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>EventMachine::Protocols::Memcache</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../../css/main.css" type="text/css" media="screen" />
    <script src="../../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Module</span> 
            EventMachine::Protocols::Memcache 
            
        </h1>
        <ul class="files">
            
            <li><a href="../../../files/lib/em/protocols/memcache_rb.html">lib/em/protocols/memcache.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    
    <div class="description">
        <p>
Implements the <a href="Memcache.html">Memcache</a> protocol (<a
href="http://code.sixapart.com/svn/memcached/trunk/server/doc/protocol.txt">code.sixapart.com/svn/memcached/trunk/server/doc/protocol.txt</a>).
Requires memcached >= 1.2.4 w/ noreply support
</p>
<h2>Usage example</h2>
<pre>
  EM.run{
    cache = EM::P::Memcache.connect 'localhost', 11211

    cache.set :a, 'hello'
    cache.set :b, 'hi'
    cache.set :c, 'how are you?'
    cache.set :d, ''

    cache.get(:a){ |v| p v }
    cache.get_hash(:a, :b, :c, :d){ |v| p v }
    cache.get(:a,:b,:c,:d){ |a,b,c,d| p [a,b,c,d] }

    cache.get(:a,:z,:b,:y,:d){ |a,z,b,y,d| p [a,z,b,y,d] }

    cache.get(:missing){ |m| p [:missing=, m] }
    cache.set(:missing, 'abc'){ p :stored }
    cache.get(:missing){ |m| p [:missing=, m] }
    cache.del(:missing){ p :deleted }
    cache.get(:missing){ |m| p [:missing=, m] }
  }
</pre>

    </div>
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>C</dt>
        <dd>
            <ul>
                
                <li><a href="#M000185">connect</a>,</li>
                
                <li><a href="#M000190">connection_completed</a></li>
                
            </ul>
        </dd>
    
        <dt>D</dt>
        <dd>
            <ul>
                
                <li><a href="#M000184">del</a>,</li>
                
                <li><a href="#M000183">delete</a></li>
                
            </ul>
        </dd>
    
        <dt>G</dt>
        <dd>
            <ul>
                
                <li><a href="#M000175">get</a>,</li>
                
                <li><a href="#M000182">get_hash</a></li>
                
            </ul>
        </dd>
    
        <dt>N</dt>
        <dd>
            <ul>
                
                <li><a href="#M000189">new</a></li>
                
            </ul>
        </dd>
    
        <dt>P</dt>
        <dd>
            <ul>
                
                <li><a href="#M000194">process_cmd</a></li>
                
            </ul>
        </dd>
    
        <dt>R</dt>
        <dd>
            <ul>
                
                <li><a href="#M000191">receive_data</a></li>
                
            </ul>
        </dd>
    
        <dt>S</dt>
        <dd>
            <ul>
                
                <li><a href="#M000186">send_cmd</a>,</li>
                
                <li><a href="#M000181">set</a></li>
                
            </ul>
        </dd>
    
        <dt>U</dt>
        <dd>
            <ul>
                
                <li><a href="#M000195">unbind</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    
    <div class="sectiontitle">Included Modules</div>
    <ul>
        
        <li>
            
            <span>EM::Deferrable</span>
            
            START:includes
        </li>
        
    </ul>
    

    

    
    <div class="sectiontitle">Classes and Modules</div>
    <ul>
        
        <li><span class="type">CLASS</span> <a href="Memcache/ParserError.html">EventMachine::Protocols::Memcache::ParserError</a></li>
        
    </ul>
    

    
    <div class="sectiontitle">Constants</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class="attr-name">Cstored</td>
            <td>=</td>
            <td class="attr-value">'STORED'.freeze</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
@private
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">Cend</td>
            <td>=</td>
            <td class="attr-value">'END'.freeze</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
@private
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">Cdeleted</td>
            <td>=</td>
            <td class="attr-value">'DELETED'.freeze</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
@private
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">Cunknown</td>
            <td>=</td>
            <td class="attr-value">'NOT_FOUND'.freeze</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
@private
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">Cerror</td>
            <td>=</td>
            <td class="attr-value">'ERROR'.freeze</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
@private
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">Cempty</td>
            <td>=</td>
            <td class="attr-value">''.freeze</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
@private
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">Cdelimiter</td>
            <td>=</td>
            <td class="attr-value">&quot;\r\n&quot;.freeze</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
@private
</p>
</td>
        </tr>
        
        
    </table>
    

    

    
            <div class="sectiontitle">Class Public methods</div>
            
            <div class="method">
                <div class="title" id="M000185">
                    
                    <a name="M000185"></a><b>connect</b>(host = 'localhost', port = 11211)
                    
                </div>
                
                <div class="description">
                  <p>
Connect to a memcached server (must support NOREPLY, memcached >= 1.2.4)
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000185_source')" id="l_M000185_source">show</a>
                        
                    </p>
                    <div id="M000185_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/em/protocols/memcache.rb, line 114</span>
114:       <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">connect</span> <span class="ruby-identifier">host</span> = <span class="ruby-value str">'localhost'</span>, <span class="ruby-identifier">port</span> = <span class="ruby-value">11211</span>
115:         <span class="ruby-constant">EM</span>.<span class="ruby-identifier">connect</span> <span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>, <span class="ruby-keyword kw">self</span>, <span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>
116:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000189">
                    
                    <a name="M000189"></a><b>new</b>(host, port = 11211)
                    
                </div>
                
                <div class="description">
                  <p>
@private
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000189_source')" id="l_M000189_source">show</a>
                        
                    </p>
                    <div id="M000189_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/em/protocols/memcache.rb, line 134</span>
134:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span> <span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span> = <span class="ruby-value">11211</span>
135:         <span class="ruby-ivar">@host</span>, <span class="ruby-ivar">@port</span> = <span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>
136:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M000190">
                    
                    <a name="M000190"></a><b>connection_completed</b>()
                    
                </div>
                
                <div class="description">
                  <p>
@private
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000190_source')" id="l_M000190_source">show</a>
                        
                    </p>
                    <div id="M000190_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/em/protocols/memcache.rb, line 139</span>
139:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">connection_completed</span>
140:         <span class="ruby-ivar">@get_cbs</span> = []
141:         <span class="ruby-ivar">@set_cbs</span> = []
142:         <span class="ruby-ivar">@del_cbs</span> = []
143: 
144:         <span class="ruby-ivar">@values</span> = {}
145: 
146:         <span class="ruby-ivar">@reconnecting</span> = <span class="ruby-keyword kw">false</span>
147:         <span class="ruby-ivar">@connected</span> = <span class="ruby-keyword kw">true</span>
148:         <span class="ruby-identifier">succeed</span>
149:         <span class="ruby-comment cmt"># set_delimiter &quot;\r\n&quot;</span>
150:         <span class="ruby-comment cmt"># set_line_mode</span>
151:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000184">
                    
                    <a name="M000184"></a><b>del</b>(key, expires = 0, &amp;cb)
                    
                </div>
                
                <div class="description">
                  <p>
Alias for <a href="Memcache.html#M000183">delete</a>
</p>

                </div>
                
                
                
            </div>
            
            <div class="method">
                <div class="title" id="M000183">
                    
                    <a name="M000183"></a><b>delete</b>(key, expires = 0, &amp;cb)
                    
                </div>
                
                <div class="description">
                  <p>
Delete the value associated with a key
</p>
<pre>
 cache.del :a
 cache.del(:b){ puts &quot;deleted the value!&quot; }
</pre>

                </div>
                
                
                <div class="aka">
                    This method is also aliased as
                    
                    <a href="Memcache.html#M000184">del</a>
                    
                </div>
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000183_source')" id="l_M000183_source">show</a>
                        
                    </p>
                    <div id="M000183_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/em/protocols/memcache.rb, line 105</span>
105:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">delete</span> <span class="ruby-identifier">key</span>, <span class="ruby-identifier">expires</span> = <span class="ruby-value">0</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">cb</span>
106:         <span class="ruby-identifier">callback</span>{
107:           <span class="ruby-identifier">send_data</span> <span class="ruby-node">&quot;delete #{key} #{expires}#{cb ? '' : ' noreply'}\r\n&quot;</span>
108:           <span class="ruby-ivar">@del_cbs</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">cb</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">cb</span>
109:         }
110:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000175">
                    
                    <a name="M000175"></a><b>get</b>(*keys)
                    
                </div>
                
                <div class="description">
                  <p>
Get the value associated with one or multiple keys
</p>
<pre>
 cache.get(:a){ |v| p v }
 cache.get(:a,:b,:c,:d){ |a,b,c,d| p [a,b,c,d] }
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000175_source')" id="l_M000175_source">show</a>
                        
                    </p>
                    <div id="M000175_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/em/protocols/memcache.rb, line 61</span>
61:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get</span> <span class="ruby-operator">*</span><span class="ruby-identifier">keys</span>
62:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">block_given?</span>
63: 
64:         <span class="ruby-identifier">callback</span>{
65:           <span class="ruby-identifier">keys</span> = <span class="ruby-identifier">keys</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">k</span><span class="ruby-operator">|</span> <span class="ruby-identifier">k</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/\s/</span>,<span class="ruby-value str">'_'</span>) }
66:           <span class="ruby-identifier">send_data</span> <span class="ruby-node">&quot;get #{keys.join(' ')}\r\n&quot;</span>
67:           <span class="ruby-ivar">@get_cbs</span> <span class="ruby-operator">&lt;&lt;</span> [<span class="ruby-identifier">keys</span>, <span class="ruby-identifier">proc</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">values</span><span class="ruby-operator">|</span>
68:             <span class="ruby-keyword kw">yield</span> <span class="ruby-operator">*</span><span class="ruby-identifier">keys</span>.<span class="ruby-identifier">map</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">k</span><span class="ruby-operator">|</span> <span class="ruby-identifier">values</span>[<span class="ruby-identifier">k</span>] }
69:           }]
70:         }
71:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000182">
                    
                    <a name="M000182"></a><b>get_hash</b>(*keys)
                    
                </div>
                
                <div class="description">
                  <p>
Gets multiple values as a hash
</p>
<pre>
 cache.get_hash(:a, :b, :c, :d){ |h| puts h[:a] }
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000182_source')" id="l_M000182_source">show</a>
                        
                    </p>
                    <div id="M000182_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/em/protocols/memcache.rb, line 92</span>
92:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_hash</span> <span class="ruby-operator">*</span><span class="ruby-identifier">keys</span>
93:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">block_given?</span>
94: 
95:         <span class="ruby-identifier">get</span> <span class="ruby-operator">*</span><span class="ruby-identifier">keys</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-operator">*</span><span class="ruby-identifier">values</span><span class="ruby-operator">|</span>
96:           <span class="ruby-keyword kw">yield</span> <span class="ruby-identifier">keys</span>.<span class="ruby-identifier">inject</span>({}){ <span class="ruby-operator">|</span><span class="ruby-identifier">hash</span>, <span class="ruby-identifier">k</span><span class="ruby-operator">|</span> <span class="ruby-identifier">hash</span>.<span class="ruby-identifier">update</span> <span class="ruby-identifier">k</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">values</span>[<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">index</span>(<span class="ruby-identifier">k</span>)] }
97:         <span class="ruby-keyword kw">end</span>
98:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000194">
                    
                    <a name="M000194"></a><b>process_cmd</b>(line)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000194_source')" id="l_M000194_source">show</a>
                        
                    </p>
                    <div id="M000194_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/em/protocols/memcache.rb, line 175</span>
175:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">process_cmd</span> <span class="ruby-identifier">line</span>
176:         <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">line</span>.<span class="ruby-identifier">strip</span>
177:         <span class="ruby-keyword kw">when</span> <span class="ruby-regexp re">/^VALUE\s+(.+?)\s+(\d+)\s+(\d+)/</span> <span class="ruby-comment cmt"># VALUE &lt;key&gt; &lt;flags&gt; &lt;bytes&gt;</span>
178:           <span class="ruby-identifier">bytes</span> = <span class="ruby-constant">Integer</span>(<span class="ruby-identifier">$3</span>)
179:           <span class="ruby-comment cmt"># set_binary_mode bytes+2</span>
180:           <span class="ruby-comment cmt"># @cur_key = $1</span>
181:           <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@buffer</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">bytes</span> <span class="ruby-operator">+</span> <span class="ruby-value">2</span>
182:             <span class="ruby-ivar">@values</span>[<span class="ruby-identifier">$1</span>] = <span class="ruby-ivar">@buffer</span>.<span class="ruby-identifier">slice!</span>(<span class="ruby-value">0</span>,<span class="ruby-identifier">bytes</span>)
183:             <span class="ruby-ivar">@buffer</span>.<span class="ruby-identifier">slice!</span>(<span class="ruby-value">0</span>,<span class="ruby-value">2</span>) <span class="ruby-comment cmt"># \r\n</span>
184:           <span class="ruby-keyword kw">else</span>
185:             <span class="ruby-identifier">raise</span> <span class="ruby-constant">ParserError</span>
186:           <span class="ruby-keyword kw">end</span>
187: 
188:         <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Cend</span> <span class="ruby-comment cmt"># END</span>
189:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">entry</span> = <span class="ruby-ivar">@get_cbs</span>.<span class="ruby-identifier">shift</span>
190:             <span class="ruby-identifier">keys</span>, <span class="ruby-identifier">cb</span> = <span class="ruby-identifier">entry</span>
191:             <span class="ruby-identifier">cb</span>.<span class="ruby-identifier">call</span>(<span class="ruby-ivar">@values</span>)
192:           <span class="ruby-keyword kw">end</span>
193:           <span class="ruby-ivar">@values</span> = {}
194: 
195:         <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Cstored</span> <span class="ruby-comment cmt"># STORED</span>
196:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">cb</span> = <span class="ruby-ivar">@set_cbs</span>.<span class="ruby-identifier">shift</span>
197:             <span class="ruby-identifier">cb</span>.<span class="ruby-identifier">call</span>(<span class="ruby-keyword kw">true</span>)
198:           <span class="ruby-keyword kw">end</span>
199: 
200:         <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Cdeleted</span> <span class="ruby-comment cmt"># DELETED</span>
201:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">cb</span> = <span class="ruby-ivar">@del_cbs</span>.<span class="ruby-identifier">shift</span>
202:             <span class="ruby-identifier">cb</span>.<span class="ruby-identifier">call</span>(<span class="ruby-keyword kw">true</span>)
203:           <span class="ruby-keyword kw">end</span>
204: 
205:         <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Cunknown</span> <span class="ruby-comment cmt"># NOT_FOUND</span>
206:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">cb</span> = <span class="ruby-ivar">@del_cbs</span>.<span class="ruby-identifier">shift</span>
207:             <span class="ruby-identifier">cb</span>.<span class="ruby-identifier">call</span>(<span class="ruby-keyword kw">false</span>)
208:           <span class="ruby-keyword kw">end</span>
209: 
210:         <span class="ruby-keyword kw">else</span>
211:           <span class="ruby-identifier">p</span> [<span class="ruby-identifier">:MEMCACHE_UNKNOWN</span>, <span class="ruby-identifier">line</span>]
212:         <span class="ruby-keyword kw">end</span>
213:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000191">
                    
                    <a name="M000191"></a><b>receive_data</b>(data)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000191_source')" id="l_M000191_source">show</a>
                        
                    </p>
                    <div id="M000191_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/em/protocols/memcache.rb, line 158</span>
158:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">receive_data</span> <span class="ruby-identifier">data</span>
159:         (<span class="ruby-ivar">@buffer</span><span class="ruby-operator">||=</span><span class="ruby-value str">''</span>) <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">data</span>
160: 
161:         <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">index</span> = <span class="ruby-ivar">@buffer</span>.<span class="ruby-identifier">index</span>(<span class="ruby-constant">Cdelimiter</span>)
162:           <span class="ruby-keyword kw">begin</span>
163:             <span class="ruby-identifier">line</span> = <span class="ruby-ivar">@buffer</span>.<span class="ruby-identifier">slice!</span>(<span class="ruby-value">0</span>,<span class="ruby-identifier">index</span><span class="ruby-operator">+</span><span class="ruby-value">2</span>)
164:             <span class="ruby-identifier">process_cmd</span> <span class="ruby-identifier">line</span>
165:           <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">ParserError</span>
166:             <span class="ruby-ivar">@buffer</span>[<span class="ruby-value">0</span><span class="ruby-operator">...</span><span class="ruby-value">0</span>] = <span class="ruby-identifier">line</span>
167:             <span class="ruby-keyword kw">break</span>
168:           <span class="ruby-keyword kw">end</span>
169:         <span class="ruby-keyword kw">end</span>
170:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000181">
                    
                    <a name="M000181"></a><b>set</b>(key, val, exptime = 0, &amp;cb)
                    
                </div>
                
                <div class="description">
                  <p>
Set the value for a given key
</p>
<pre>
 cache.set :a, 'hello'
 cache.set(:missing, 'abc'){ puts &quot;stored the value!&quot; }
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000181_source')" id="l_M000181_source">show</a>
                        
                    </p>
                    <div id="M000181_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/em/protocols/memcache.rb, line 78</span>
78:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set</span> <span class="ruby-identifier">key</span>, <span class="ruby-identifier">val</span>, <span class="ruby-identifier">exptime</span> = <span class="ruby-value">0</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">cb</span>
79:         <span class="ruby-identifier">callback</span>{
80:           <span class="ruby-identifier">val</span> = <span class="ruby-identifier">val</span>.<span class="ruby-identifier">to_s</span>
81:           <span class="ruby-identifier">send_cmd</span> <span class="ruby-identifier">:set</span>, <span class="ruby-identifier">key</span>, <span class="ruby-value">0</span>, <span class="ruby-identifier">exptime</span>, <span class="ruby-identifier">val</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:bytesize</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">val</span>.<span class="ruby-identifier">bytesize</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">val</span>.<span class="ruby-identifier">size</span>, <span class="ruby-operator">!</span><span class="ruby-identifier">block_given?</span>
82:           <span class="ruby-identifier">send_data</span> <span class="ruby-identifier">val</span>
83:           <span class="ruby-identifier">send_data</span> <span class="ruby-constant">Cdelimiter</span>
84:           <span class="ruby-ivar">@set_cbs</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">cb</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">cb</span>
85:         }
86:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000195">
                    
                    <a name="M000195"></a><b>unbind</b>()
                    
                </div>
                
                <div class="description">
                  <p>
@private
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000195_source')" id="l_M000195_source">show</a>
                        
                    </p>
                    <div id="M000195_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/em/protocols/memcache.rb, line 221</span>
221:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">unbind</span>
222:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@connected</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@reconnecting</span>
223:           <span class="ruby-constant">EM</span>.<span class="ruby-identifier">add_timer</span>(<span class="ruby-value">1</span>){ <span class="ruby-identifier">reconnect</span> <span class="ruby-ivar">@host</span>, <span class="ruby-ivar">@port</span> }
224:           <span class="ruby-ivar">@connected</span> = <span class="ruby-keyword kw">false</span>
225:           <span class="ruby-ivar">@reconnecting</span> = <span class="ruby-keyword kw">true</span>
226:           <span class="ruby-ivar">@deferred_status</span> = <span class="ruby-keyword kw">nil</span>
227:         <span class="ruby-keyword kw">else</span>
228:           <span class="ruby-identifier">raise</span> <span class="ruby-value str">'Unable to connect to memcached server'</span>
229:         <span class="ruby-keyword kw">end</span>
230:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Private methods</div>
            
            <div class="method">
                <div class="title" id="M000186">
                    
                    <a name="M000186"></a><b>send_cmd</b>(cmd, key, flags = 0, exptime = 0, bytes = 0, noreply = false)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000186_source')" id="l_M000186_source">show</a>
                        
                    </p>
                    <div id="M000186_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/em/protocols/memcache.rb, line 118</span>
118:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">send_cmd</span> <span class="ruby-identifier">cmd</span>, <span class="ruby-identifier">key</span>, <span class="ruby-identifier">flags</span> = <span class="ruby-value">0</span>, <span class="ruby-identifier">exptime</span> = <span class="ruby-value">0</span>, <span class="ruby-identifier">bytes</span> = <span class="ruby-value">0</span>, <span class="ruby-identifier">noreply</span> = <span class="ruby-keyword kw">false</span>
119:         <span class="ruby-identifier">send_data</span> <span class="ruby-node">&quot;#{cmd} #{key} #{flags} #{exptime} #{bytes}#{noreply ? ' noreply' : ''}\r\n&quot;</span>
120:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    