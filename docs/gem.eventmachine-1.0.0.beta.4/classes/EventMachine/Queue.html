<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>EventMachine::Queue</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../css/main.css" type="text/css" media="screen" />
    <script src="../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Class</span> 
            EventMachine::Queue 
            
                <span class="parent">&lt; 
                    
                    Object
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../files/lib/em/queue_rb.html">lib/em/queue.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    
    <div class="description">
        <p>
A cross thread, reactor scheduled, linear queue.
</p>
<p>
This class provides a simple queue abstraction on top of the reactor
scheduler. It services two primary purposes:
</p>
<ul>
<li>API sugar for stateful protocols

</li>
<li>Pushing processing onto the reactor thread

</li>
</ul>
<p>
@example
</p>
<pre>
 q = EM::Queue.new
 q.push('one', 'two', 'three')
 3.times do
   q.pop { |msg| puts(msg) }
 end
</pre>

    </div>
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>#</dt>
        <dd>
            <ul>
                
                <li><a href="#M000297"><<</a></li>
                
            </ul>
        </dd>
    
        <dt>E</dt>
        <dd>
            <ul>
                
                <li><a href="#M000298">empty?</a></li>
                
            </ul>
        </dd>
    
        <dt>N</dt>
        <dd>
            <ul>
                
                <li><a href="#M000294">new</a>,</li>
                
                <li><a href="#M000306">num_waiting</a></li>
                
            </ul>
        </dd>
    
        <dt>P</dt>
        <dd>
            <ul>
                
                <li><a href="#M000295">pop</a>,</li>
                
                <li><a href="#M000296">push</a></li>
                
            </ul>
        </dd>
    
        <dt>S</dt>
        <dd>
            <ul>
                
                <li><a href="#M000305">size</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    

    

    

    

    

    
            <div class="sectiontitle">Class Public methods</div>
            
            <div class="method">
                <div class="title" id="M000294">
                    
                    <a name="M000294"></a><b>new</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000294_source')" id="l_M000294_source">show</a>
                        
                    </p>
                    <div id="M000294_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/em/queue.rb, line 19</span>
19:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>
20:       <span class="ruby-ivar">@items</span> = []
21:       <span class="ruby-ivar">@popq</span>  = []
22:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M000297">
                    
                    <a name="M000297"></a><b>&lt;&lt;</b>(*items)
                    
                </div>
                
                <div class="description">
                  <p>
Alias for <a href="Queue.html#M000296">push</a>
</p>

                </div>
                
                
                
            </div>
            
            <div class="method">
                <div class="title" id="M000298">
                    
                    <a name="M000298"></a><b>empty?</b>()
                    
                </div>
                
                <div class="description">
                  <p>
@return [Boolean] @note This is a peek, it&#8217;s not thread safe, and may
only tend toward accuracy.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000298_source')" id="l_M000298_source">show</a>
                        
                    </p>
                    <div id="M000298_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/em/queue.rb, line 54</span>
54:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">empty?</span>
55:       <span class="ruby-ivar">@items</span>.<span class="ruby-identifier">empty?</span>
56:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000306">
                    
                    <a name="M000306"></a><b>num_waiting</b>()
                    
                </div>
                
                <div class="description">
                  <p>
@return [Integer] Waiting size @note This is a peek at the number of jobs
that are currently waiting on the <a href="Queue.html">Queue</a>
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000306_source')" id="l_M000306_source">show</a>
                        
                    </p>
                    <div id="M000306_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/em/queue.rb, line 66</span>
66:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">num_waiting</span>
67:       <span class="ruby-ivar">@popq</span>.<span class="ruby-identifier">size</span>
68:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000295">
                    
                    <a name="M000295"></a><b>pop</b>(*a, &amp;b)
                    
                </div>
                
                <div class="description">
                  <p>
Pop items off the queue, running the block on the reactor thread. The pop
will not happen immediately, but at some point in the future, either in the
next tick, if the queue has data, or when the queue is populated.
</p>
<p>
@return [NilClass] nil
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000295_source')" id="l_M000295_source">show</a>
                        
                    </p>
                    <div id="M000295_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/em/queue.rb, line 29</span>
29:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">pop</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">a</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">b</span>)
30:       <span class="ruby-identifier">cb</span> = <span class="ruby-constant">EM</span><span class="ruby-operator">::</span><span class="ruby-constant">Callback</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">a</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">b</span>)
31:       <span class="ruby-constant">EM</span>.<span class="ruby-identifier">schedule</span> <span class="ruby-keyword kw">do</span>
32:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@items</span>.<span class="ruby-identifier">empty?</span>
33:           <span class="ruby-ivar">@popq</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">cb</span>
34:         <span class="ruby-keyword kw">else</span>
35:           <span class="ruby-identifier">cb</span>.<span class="ruby-identifier">call</span> <span class="ruby-ivar">@items</span>.<span class="ruby-identifier">shift</span>
36:         <span class="ruby-keyword kw">end</span>
37:       <span class="ruby-keyword kw">end</span>
38:       <span class="ruby-keyword kw">nil</span> <span class="ruby-comment cmt"># Always returns nil</span>
39:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000296">
                    
                    <a name="M000296"></a><b>push</b>(*items)
                    
                </div>
                
                <div class="description">
                  <p>
Push items onto the queue in the reactor thread. The items will not appear
in the queue immediately, but will be scheduled for addition during the
next reactor tick.
</p>

                </div>
                
                
                <div class="aka">
                    This method is also aliased as
                    
                    <a href="Queue.html#M000297">&lt;&lt;</a>
                    
                </div>
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000296_source')" id="l_M000296_source">show</a>
                        
                    </p>
                    <div id="M000296_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/em/queue.rb, line 44</span>
44:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">push</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">items</span>)
45:       <span class="ruby-constant">EM</span>.<span class="ruby-identifier">schedule</span> <span class="ruby-keyword kw">do</span>
46:         <span class="ruby-ivar">@items</span>.<span class="ruby-identifier">push</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">items</span>)
47:         <span class="ruby-ivar">@popq</span>.<span class="ruby-identifier">shift</span>.<span class="ruby-identifier">call</span> <span class="ruby-ivar">@items</span>.<span class="ruby-identifier">shift</span> <span class="ruby-keyword kw">until</span> <span class="ruby-ivar">@items</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">||</span> <span class="ruby-ivar">@popq</span>.<span class="ruby-identifier">empty?</span>
48:       <span class="ruby-keyword kw">end</span>
49:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000305">
                    
                    <a name="M000305"></a><b>size</b>()
                    
                </div>
                
                <div class="description">
                  <p>
@return [Integer] <a href="Queue.html">Queue</a> size @note This is a peek,
it&#8217;s not thread safe, and may only tend toward accuracy.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000305_source')" id="l_M000305_source">show</a>
                        
                    </p>
                    <div id="M000305_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/em/queue.rb, line 60</span>
60:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">size</span>
61:       <span class="ruby-ivar">@items</span>.<span class="ruby-identifier">size</span>
62:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    