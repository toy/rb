<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>EventMachine</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen" />
    <script src="../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Module</span> 
            EventMachine 
            
        </h1>
        <ul class="files">
            
            <li><a href="../files/lib/em/callback_rb.html">lib/em/callback.rb</a></li>
            
            <li><a href="../files/lib/em/channel_rb.html">lib/em/channel.rb</a></li>
            
            <li><a href="../files/lib/em/completion_rb.html">lib/em/completion.rb</a></li>
            
            <li><a href="../files/lib/em/connection_rb.html">lib/em/connection.rb</a></li>
            
            <li><a href="../files/lib/em/deferrable_rb.html">lib/em/deferrable.rb</a></li>
            
            <li><a href="../files/lib/em/file_watch_rb.html">lib/em/file_watch.rb</a></li>
            
            <li><a href="../files/lib/em/future_rb.html">lib/em/future.rb</a></li>
            
            <li><a href="../files/lib/em/iterator_rb.html">lib/em/iterator.rb</a></li>
            
            <li><a href="../files/lib/em/pool_rb.html">lib/em/pool.rb</a></li>
            
            <li><a href="../files/lib/em/process_watch_rb.html">lib/em/process_watch.rb</a></li>
            
            <li><a href="../files/lib/em/processes_rb.html">lib/em/processes.rb</a></li>
            
            <li><a href="../files/lib/em/protocols/header_and_content_rb.html">lib/em/protocols/header_and_content.rb</a></li>
            
            <li><a href="../files/lib/em/protocols/httpclient_rb.html">lib/em/protocols/httpclient.rb</a></li>
            
            <li><a href="../files/lib/em/protocols/httpclient2_rb.html">lib/em/protocols/httpclient2.rb</a></li>
            
            <li><a href="../files/lib/em/protocols/line_and_text_rb.html">lib/em/protocols/line_and_text.rb</a></li>
            
            <li><a href="../files/lib/em/protocols/line_protocol_rb.html">lib/em/protocols/line_protocol.rb</a></li>
            
            <li><a href="../files/lib/em/protocols/linetext2_rb.html">lib/em/protocols/linetext2.rb</a></li>
            
            <li><a href="../files/lib/em/protocols/memcache_rb.html">lib/em/protocols/memcache.rb</a></li>
            
            <li><a href="../files/lib/em/protocols/object_protocol_rb.html">lib/em/protocols/object_protocol.rb</a></li>
            
            <li><a href="../files/lib/em/protocols/postgres3_rb.html">lib/em/protocols/postgres3.rb</a></li>
            
            <li><a href="../files/lib/em/protocols/saslauth_rb.html">lib/em/protocols/saslauth.rb</a></li>
            
            <li><a href="../files/lib/em/protocols/smtpclient_rb.html">lib/em/protocols/smtpclient.rb</a></li>
            
            <li><a href="../files/lib/em/protocols/smtpserver_rb.html">lib/em/protocols/smtpserver.rb</a></li>
            
            <li><a href="../files/lib/em/protocols/socks4_rb.html">lib/em/protocols/socks4.rb</a></li>
            
            <li><a href="../files/lib/em/protocols/stomp_rb.html">lib/em/protocols/stomp.rb</a></li>
            
            <li><a href="../files/lib/em/protocols/tcptest_rb.html">lib/em/protocols/tcptest.rb</a></li>
            
            <li><a href="../files/lib/em/protocols_rb.html">lib/em/protocols.rb</a></li>
            
            <li><a href="../files/lib/em/queue_rb.html">lib/em/queue.rb</a></li>
            
            <li><a href="../files/lib/em/pure_ruby_rb.html">lib/em/pure_ruby.rb</a></li>
            
            <li><a href="../files/lib/em/resolver_rb.html">lib/em/resolver.rb</a></li>
            
            <li><a href="../files/lib/em/spawnable_rb.html">lib/em/spawnable.rb</a></li>
            
            <li><a href="../files/lib/em/streamer_rb.html">lib/em/streamer.rb</a></li>
            
            <li><a href="../files/lib/em/threaded_resource_rb.html">lib/em/threaded_resource.rb</a></li>
            
            <li><a href="../files/lib/em/tick_loop_rb.html">lib/em/tick_loop.rb</a></li>
            
            <li><a href="../files/lib/em/timers_rb.html">lib/em/timers.rb</a></li>
            
            <li><a href="../files/lib/em/version_rb.html">lib/em/version.rb</a></li>
            
            <li><a href="../files/lib/jeventmachine_rb.html">lib/jeventmachine.rb</a></li>
            
            <li><a href="../files/lib/eventmachine_rb.html">lib/eventmachine.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    
    <div class="description">
        <pre>
 = EM::Completion

 A completion is a callback container for various states of completion. In
 it's most basic form it has a start state and a finish state.

 This implementation includes some hold-back from the EM::Deferrable
 interface in order to be compatible - but it has a much cleaner
 implementation.

 In general it is preferred that this implementation be used as a state
 callback container than EM::DefaultDeferrable or other classes including
 EM::Deferrable. This is because it is generally more sane to keep this level
 of state in a dedicated state-back container. This generally leads to more
 malleable interfaces and software designs, as well as eradicating nasty bugs
 that result from abstraction leakage.

 == Basic Usage

 As already mentioned, the basic usage of a Completion is simply for its two
 final states, :succeeded and :failed.

 An asynchronous operation will complete at some future point in time, and
 users often want to react to this event. API authors will want to expose
 some common interface to react to these events.

 In the following example, the user wants to know when a short lived
 connection has completed its exchange with the remote server. The simple
 protocol just waits for an ack to its message.

    class Protocol &lt; EM::Connection
      include EM::P::LineText2

      def initialize(message, completion)
        @message, @completion = message, completion
        @completion.completion { close_connection }
        @completion.timeout(1, :timeout)
      end

      def post_init
        send_data(@message)
      end

      def receive_line(line)
        case line
        when /ACK/i
          @completion.succeed line
        when /ERR/i
          @completion.fail :error, line
        else
          @completion.fail :unknown, line
        end
      end

      def unbind
        @completion.fail :disconnected unless @completion.completed?
      end
    end

    class API
      attr_reader :host, :port

      def initialize(host = 'example.org', port = 8000)
        @host, @port = host, port
      end

      def request(message)
        completion = EM::Deferrable::Completion.new
        EM.connect(host, port, Protocol, message, completion)
        completion
      end
    end

    api = API.new
    completion = api.request('stuff')
    completion.callback do |line|
      puts &quot;API responded with: #{line}&quot;
    end
    completion.errback do |type, line|
      case type
      when :error
        puts &quot;API error: #{line}&quot;
      when :unknown
        puts &quot;API returned unknown response: #{line}&quot;
      when :disconnected
        puts &quot;API server disconnected prematurely&quot;
      when :timeout
        puts &quot;API server did not respond in a timely fashion&quot;
      end
    end

 == Advanced Usage

 This completion implementation also supports more state callbacks and
 arbitrary states (unlike the original Deferrable API). This allows for basic
 stateful process encapsulation. One might use this to setup state callbacks
 for various states in an exchange like in the basic usage example, except
 where the applicaiton could be made to react to &quot;connected&quot; and
 &quot;disconnected&quot; states additionally.

    class Protocol &lt; EM::Connection
      def initialize(completion)
        @response = []
        @completion = completion
        @completion.stateback(:disconnected) do
          @completion.succeed @response.join
        end
      end

      def connection_completed
        @host, @port = Socket.unpack_sockaddr_in get_peername
        @completion.change_state(:connected, @host, @port)
        send_data(&quot;GET http://example.org/ HTTP/1.0\r\n\r\n&quot;)
      end

      def receive_data(data)
        @response &lt;&lt; data
      end

      def unbind
        @completion.change_state(:disconnected, @host, @port)
      end
    end

    completion = EM::Deferrable::Completion.new
    completion.stateback(:connected) do |host, port|
      puts &quot;Connected to #{host}:#{port}&quot;
    end
    completion.stateback(:disconnected) do |host, port|
      puts &quot;Disconnected from #{host}:#{port}&quot;
    end
    completion.callback do |response|
      puts response
    end

    EM.connect('example.org', 80, Protocol, completion)

 == Timeout

 The Completion also has a timeout. The timeout is global and is not aware of
 states apart from completion states. The timeout is only engaged if #timeout
 is called, and it will call fail if it is reached.

 == Completion states

 By default there are two completion states, :succeeded and :failed. These
 states can be modified by subclassing and overrding the #completion_states
 method. Completion states are special, in that callbacks for all completion
 states are explcitly cleared when a completion state is entered. This
 prevents errors that could arise from accidental unterminated timeouts, and
 other such user errors.

 == Other notes

 Several APIs have been carried over from EM::Deferrable for compatibility
 reasons during a transitionary period. Specifically cancel_errback and
 cancel_callback are implemented, but their usage is to be strongly
 discouraged. Due to the already complex nature of reaction systems, dynamic
 callback deletion only makes the problem much worse. It is always better to
 add correct conditionals to the callback code, or use more states, than to
 address such implementaiton issues with conditional callbacks.
 ---
 @private
 ---
</pre>
<hr size="10"></hr><pre>
 ---
</pre>
<hr size="10"></hr><pre>
 ---
</pre>
<hr size="10"></hr><pre>
 ---
</pre>
<hr size="10"></hr><pre>
 ---
 @private
 ---
 Top-level EventMachine namespace. If you are looking for EventMachine examples, see {file:docs/GettingStarted.md EventMachine tutorial}.

 ## Key methods ##
 ### Starting and stopping the event loop ###

 * {EventMachine.run}
 * {EventMachine.stop_event_loop}

 ### Implementing clients ###

 * {EventMachine.connect}

 ### Implementing servers ###

 * {EventMachine.start_server}

 ### Working with timers ###

 * {EventMachine.add_timer}
 * {EventMachine.add_periodic_timer}
 * {EventMachine.cancel_timer}

 ### Working with blocking tasks ###

 * {EventMachine.defer}
 * {EventMachine.next_tick}

 ### Efficient proxying ###

 * {EventMachine.enable_proxy}
 * {EventMachine.disable_proxy}
</pre>

    </div>
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>C</dt>
        <dd>
            <ul>
                
                <li><a href="#M000006">Callback</a></li>
                
            </ul>
        </dd>
    
        <dt>#</dt>
        <dd>
            <ul>
                
                <li><a href="#M000540">_open_file_for_writing</a></li>
                
            </ul>
        </dd>
    
        <dt>A</dt>
        <dd>
            <ul>
                
                <li><a href="#M000455">add_oneshot_timer</a>,</li>
                
                <li><a href="#M000301">add_oneshot_timer</a>,</li>
                
                <li><a href="#M000505">add_periodic_timer</a>,</li>
                
                <li><a href="#M000503">add_shutdown_hook</a>,</li>
                
                <li><a href="#M000504">add_timer</a>,</li>
                
                <li><a href="#M000514">attach</a>,</li>
                
                <li><a href="#M000487">attach_fd</a>,</li>
                
                <li><a href="#M000515">attach_io</a></li>
                
            </ul>
        </dd>
    
        <dt>B</dt>
        <dd>
            <ul>
                
                <li><a href="#M000512">bind_connect</a>,</li>
                
                <li><a href="#M000308">bind_connect_server</a>,</li>
                
                <li><a href="#M000464">bind_connect_server</a></li>
                
            </ul>
        </dd>
    
        <dt>C</dt>
        <dd>
            <ul>
                
                <li><a href="#M000506">cancel_timer</a>,</li>
                
                <li><a href="#M000310">close_connection</a>,</li>
                
                <li><a href="#M000465">close_connection</a>,</li>
                
                <li><a href="#M000511">connect</a>,</li>
                
                <li><a href="#M000307">connect_server</a>,</li>
                
                <li><a href="#M000463">connect_server</a>,</li>
                
                <li><a href="#M000517">connect_unix_domain</a>,</li>
                
                <li><a href="#M000314">connect_unix_server</a>,</li>
                
                <li><a href="#M000522">connection_count</a></li>
                
            </ul>
        </dd>
    
        <dt>D</dt>
        <dd>
            <ul>
                
                <li><a href="#M000524">defer</a>,</li>
                
                <li><a href="#M000488">detach_fd</a>,</li>
                
                <li><a href="#M000536">disable_proxy</a></li>
                
            </ul>
        </dd>
    
        <dt>E</dt>
        <dd>
            <ul>
                
                <li><a href="#M000535">enable_proxy</a>,</li>
                
                <li><a href="#M000473">epoll</a>,</li>
                
                <li><a href="#M000322">epoll</a>,</li>
                
                <li><a href="#M000474">epoll=</a>,</li>
                
                <li><a href="#M000477">epoll?</a>,</li>
                
                <li><a href="#M000534">error_handler</a>,</li>
                
                <li><a href="#M000539">event_callback</a></li>
                
            </ul>
        </dd>
    
        <dt>F</dt>
        <dd>
            <ul>
                
                <li><a href="#M000502">fork_reactor</a></li>
                
            </ul>
        </dd>
    
        <dt>G</dt>
        <dd>
            <ul>
                
                <li><a href="#M000493">get_connection_count</a>,</li>
                
                <li><a href="#M000484">get_max_timer_count</a>,</li>
                
                <li><a href="#M000521">get_max_timers</a>,</li>
                
                <li><a href="#M000334">get_outbound_data_size</a>,</li>
                
                <li><a href="#M000316">get_peername</a>,</li>
                
                <li><a href="#M000486">get_peername</a>,</li>
                
                <li><a href="#M000326">get_sock_opt</a></li>
                
            </ul>
        </dd>
    
        <dt>H</dt>
        <dd>
            <ul>
                
                <li><a href="#M000537">heartbeat_interval</a>,</li>
                
                <li><a href="#M000538">heartbeat_interval=</a></li>
                
            </ul>
        </dd>
    
        <dt>I</dt>
        <dd>
            <ul>
                
                <li><a href="#M000300">initialize_event_machine</a>,</li>
                
                <li><a href="#M000453">initialize_event_machine</a>,</li>
                
                <li><a href="#M000481">invoke_popen</a>,</li>
                
                <li><a href="#M000491">is_notify_readable</a>,</li>
                
                <li><a href="#M000492">is_notify_writable</a></li>
                
            </ul>
        </dd>
    
        <dt>K</dt>
        <dd>
            <ul>
                
                <li><a href="#M000541">klass_from_handler</a>,</li>
                
                <li><a href="#M000475">kqueue</a>,</li>
                
                <li><a href="#M000476">kqueue=</a>,</li>
                
                <li><a href="#M000478">kqueue?</a></li>
                
            </ul>
        </dd>
    
        <dt>L</dt>
        <dd>
            <ul>
                
                <li><a href="#M000299">library_type</a>,</li>
                
                <li><a href="#M000485">library_type</a></li>
                
            </ul>
        </dd>
    
        <dt>N</dt>
        <dd>
            <ul>
                
                <li><a href="#M000526">next_tick</a></li>
                
            </ul>
        </dd>
    
        <dt>O</dt>
        <dd>
            <ul>
                
                <li><a href="#M000518">open_datagram_socket</a>,</li>
                
                <li><a href="#M000531">open_keyboard</a>,</li>
                
                <li><a href="#M000480">open_udp_socket</a>,</li>
                
                <li><a href="#M000317">open_udp_socket</a></li>
                
            </ul>
        </dd>
    
        <dt>P</dt>
        <dd>
            <ul>
                
                <li><a href="#M000529">popen</a></li>
                
            </ul>
        </dd>
    
        <dt>R</dt>
        <dd>
            <ul>
                
                <li><a href="#M000530">reactor_running?</a>,</li>
                
                <li><a href="#M000500">reactor_thread?</a>,</li>
                
                <li><a href="#M000482">read_keyboard</a>,</li>
                
                <li><a href="#M000339">read_keyboard</a>,</li>
                
                <li><a href="#M000516">reconnect</a>,</li>
                
                <li><a href="#M000454">release_machine</a>,</li>
                
                <li><a href="#M000303">release_machine</a>,</li>
                
                <li><a href="#M000498">run</a>,</li>
                
                <li><a href="#M000499">run_block</a>,</li>
                
                <li><a href="#M000523">run_deferred_callbacks</a>,</li>
                
                <li><a href="#M000302">run_machine</a>,</li>
                
                <li><a href="#M000456">run_machine</a></li>
                
            </ul>
        </dd>
    
        <dt>S</dt>
        <dd>
            <ul>
                
                <li><a href="#M000501">schedule</a>,</li>
                
                <li><a href="#M000309">send_data</a>,</li>
                
                <li><a href="#M000461">send_data</a>,</li>
                
                <li><a href="#M000462">send_datagram</a>,</li>
                
                <li><a href="#M000318">send_datagram</a>,</li>
                
                <li><a href="#M000496">send_file_data</a>,</li>
                
                <li><a href="#M000330">send_file_data</a>,</li>
                
                <li><a href="#M000466">set_comm_inactivity_timeout</a>,</li>
                
                <li><a href="#M000340">set_comm_inactivity_timeout</a>,</li>
                
                <li><a href="#M000528">set_descriptor_table_size</a>,</li>
                
                <li><a href="#M000527">set_effective_user</a>,</li>
                
                <li><a href="#M000468">set_heartbeat_interval</a>,</li>
                
                <li><a href="#M000325">set_max_timer_count</a>,</li>
                
                <li><a href="#M000483">set_max_timer_count</a>,</li>
                
                <li><a href="#M000520">set_max_timers</a>,</li>
                
                <li><a href="#M000489">set_notify_readable</a>,</li>
                
                <li><a href="#M000490">set_notify_writable</a>,</li>
                
                <li><a href="#M000467">set_pending_connect_timeout</a>,</li>
                
                <li><a href="#M000519">set_quantum</a>,</li>
                
                <li><a href="#M000324">set_rlimit_nofile</a>,</li>
                
                <li><a href="#M000479">set_rlimit_nofile</a>,</li>
                
                <li><a href="#M000329">set_sock_opt</a>,</li>
                
                <li><a href="#M000472">set_timer_quantum</a>,</li>
                
                <li><a href="#M000319">set_timer_quantum</a>,</li>
                
                <li><a href="#M000494">set_tls_parms</a>,</li>
                
                <li><a href="#M000315">signal_loopbreak</a>,</li>
                
                <li><a href="#M000471">signal_loopbreak</a>,</li>
                
                <li><a href="#M000375">spawn</a>,</li>
                
                <li><a href="#M000525">spawn_threadpool</a>,</li>
                
                <li><a href="#M000323">ssl?</a>,</li>
                
                <li><a href="#M000470">ssl?</a>,</li>
                
                <li><a href="#M000508">start_server</a>,</li>
                
                <li><a href="#M000311">start_tcp_server</a>,</li>
                
                <li><a href="#M000458">start_tcp_server</a>,</li>
                
                <li><a href="#M000469">start_tls</a>,</li>
                
                <li><a href="#M000495">start_tls</a>,</li>
                
                <li><a href="#M000510">start_unix_domain_server</a>,</li>
                
                <li><a href="#M000460">start_unix_server</a>,</li>
                
                <li><a href="#M000313">start_unix_server</a>,</li>
                
                <li><a href="#M000457">stop</a>,</li>
                
                <li><a href="#M000304">stop</a>,</li>
                
                <li><a href="#M000507">stop_event_loop</a>,</li>
                
                <li><a href="#M000509">stop_server</a>,</li>
                
                <li><a href="#M000459">stop_tcp_server</a>,</li>
                
                <li><a href="#M000312">stop_tcp_server</a>,</li>
                
                <li><a href="#M000125">system</a></li>
                
            </ul>
        </dd>
    
        <dt>T</dt>
        <dd>
            <ul>
                
                <li><a href="#M000436">tick_loop</a></li>
                
            </ul>
        </dd>
    
        <dt>W</dt>
        <dd>
            <ul>
                
                <li><a href="#M000513">watch</a>,</li>
                
                <li><a href="#M000532">watch_file</a>,</li>
                
                <li><a href="#M000533">watch_process</a></li>
                
            </ul>
        </dd>
    
        <dt>Y</dt>
        <dd>
            <ul>
                
                <li><a href="#M000376">yield</a>,</li>
                
                <li><a href="#M000384">yield_and_notify</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    

    

    
    <div class="sectiontitle">Classes and Modules</div>
    <ul>
        
        <li><span class="type">MODULE</span> <a href="EventMachine/DNS.html">EventMachine::DNS</a></li>
        
        <li><span class="type">MODULE</span> <a href="EventMachine/Deferrable.html">EventMachine::Deferrable</a></li>
        
        <li><span class="type">MODULE</span> <a href="EventMachine/Protocols.html">EventMachine::Protocols</a></li>
        
        <li><span class="type">MODULE</span> <a href="EventMachine/UuidGenerator.html">EventMachine::UuidGenerator</a></li>
        
        <li><span class="type">CLASS</span> <a href="EventMachine/Channel.html">EventMachine::Channel</a></li>
        
        <li><span class="type">CLASS</span> <a href="EventMachine/Completion.html">EventMachine::Completion</a></li>
        
        <li><span class="type">CLASS</span> <a href="EventMachine/Connection.html">EventMachine::Connection</a></li>
        
        <li><span class="type">CLASS</span> <a href="EventMachine/ConnectionError.html">EventMachine::ConnectionError</a></li>
        
        <li><span class="type">CLASS</span> <a href="EventMachine/ConnectionNotBound.html">EventMachine::ConnectionNotBound</a></li>
        
        <li><span class="type">CLASS</span> <a href="EventMachine/DatagramObject.html">EventMachine::DatagramObject</a></li>
        
        <li><span class="type">CLASS</span> <a href="EventMachine/DefaultDeferrable.html">EventMachine::DefaultDeferrable</a></li>
        
        <li><span class="type">CLASS</span> <a href="EventMachine/DeferrableChildProcess.html">EventMachine::DeferrableChildProcess</a></li>
        
        <li><span class="type">CLASS</span> <a href="EventMachine/Error.html">EventMachine::Error</a></li>
        
        <li><span class="type">CLASS</span> <a href="EventMachine/EvmaKeyboard.html">EventMachine::EvmaKeyboard</a></li>
        
        <li><span class="type">CLASS</span> <a href="EventMachine/EvmaTCPClient.html">EventMachine::EvmaTCPClient</a></li>
        
        <li><span class="type">CLASS</span> <a href="EventMachine/EvmaTCPServer.html">EventMachine::EvmaTCPServer</a></li>
        
        <li><span class="type">CLASS</span> <a href="EventMachine/EvmaUDPSocket.html">EventMachine::EvmaUDPSocket</a></li>
        
        <li><span class="type">CLASS</span> <a href="EventMachine/EvmaUNIXClient.html">EventMachine::EvmaUNIXClient</a></li>
        
        <li><span class="type">CLASS</span> <a href="EventMachine/EvmaUNIXServer.html">EventMachine::EvmaUNIXServer</a></li>
        
        <li><span class="type">CLASS</span> <a href="EventMachine/FileNotFoundException.html">EventMachine::FileNotFoundException</a></li>
        
        <li><span class="type">CLASS</span> <a href="EventMachine/FileStreamer.html">EventMachine::FileStreamer</a></li>
        
        <li><span class="type">CLASS</span> <a href="EventMachine/FileWatch.html">EventMachine::FileWatch</a></li>
        
        <li><span class="type">CLASS</span> <a href="EventMachine/Iterator.html">EventMachine::Iterator</a></li>
        
        <li><span class="type">CLASS</span> <a href="EventMachine/JEM.html">EventMachine::JEM</a></li>
        
        <li><span class="type">CLASS</span> <a href="EventMachine/LoopbreakReader.html">EventMachine::LoopbreakReader</a></li>
        
        <li><span class="type">CLASS</span> <a href="EventMachine/PeriodicTimer.html">EventMachine::PeriodicTimer</a></li>
        
        <li><span class="type">CLASS</span> <a href="EventMachine/Pool.html">EventMachine::Pool</a></li>
        
        <li><span class="type">CLASS</span> <a href="EventMachine/ProcessWatch.html">EventMachine::ProcessWatch</a></li>
        
        <li><span class="type">CLASS</span> <a href="EventMachine/Queue.html">EventMachine::Queue</a></li>
        
        <li><span class="type">CLASS</span> <a href="EventMachine/Reactor.html">EventMachine::Reactor</a></li>
        
        <li><span class="type">CLASS</span> <a href="EventMachine/Selectable.html">EventMachine::Selectable</a></li>
        
        <li><span class="type">CLASS</span> <a href="EventMachine/SpawnedProcess.html">EventMachine::SpawnedProcess</a></li>
        
        <li><span class="type">CLASS</span> <a href="EventMachine/StreamObject.html">EventMachine::StreamObject</a></li>
        
        <li><span class="type">CLASS</span> <a href="EventMachine/SystemCmd.html">EventMachine::SystemCmd</a></li>
        
        <li><span class="type">CLASS</span> <a href="EventMachine/ThreadedResource.html">EventMachine::ThreadedResource</a></li>
        
        <li><span class="type">CLASS</span> <a href="EventMachine/TickLoop.html">EventMachine::TickLoop</a></li>
        
        <li><span class="type">CLASS</span> <a href="EventMachine/Timer.html">EventMachine::Timer</a></li>
        
        <li><span class="type">CLASS</span> <a href="EventMachine/UnknownTimerFired.html">EventMachine::UnknownTimerFired</a></li>
        
        <li><span class="type">CLASS</span> <a href="EventMachine/Unsupported.html">EventMachine::Unsupported</a></li>
        
        <li><span class="type">CLASS</span> <a href="EventMachine/YieldBlockFromSpawnedProcess.html">EventMachine::YieldBlockFromSpawnedProcess</a></li>
        
    </ul>
    

    
    <div class="sectiontitle">Constants</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class="attr-name">TimerFired</td>
            <td>=</td>
            <td class="attr-value">100</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
@private
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">ConnectionData</td>
            <td>=</td>
            <td class="attr-value">101</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
@private
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">ConnectionUnbound</td>
            <td>=</td>
            <td class="attr-value">102</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
@private
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">ConnectionAccepted</td>
            <td>=</td>
            <td class="attr-value">103</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
@private
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">ConnectionCompleted</td>
            <td>=</td>
            <td class="attr-value">104</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
@private
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">LoopbreakSignalled</td>
            <td>=</td>
            <td class="attr-value">105</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
@private
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">VERSION</td>
            <td>=</td>
            <td class="attr-value">&quot;1.0.0.beta.4&quot;</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">TimerFired</td>
            <td>=</td>
            <td class="attr-value">100</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
TODO: These event numbers are defined in way too many places. DRY them up.
@private
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">ConnectionData</td>
            <td>=</td>
            <td class="attr-value">101</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
@private
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">ConnectionUnbound</td>
            <td>=</td>
            <td class="attr-value">102</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
@private
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">ConnectionAccepted</td>
            <td>=</td>
            <td class="attr-value">103</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
@private
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">ConnectionCompleted</td>
            <td>=</td>
            <td class="attr-value">104</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
@private
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">LoopbreakSignalled</td>
            <td>=</td>
            <td class="attr-value">105</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
@private
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">ConnectionNotifyReadable</td>
            <td>=</td>
            <td class="attr-value">106</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
@private
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">ConnectionNotifyWritable</td>
            <td>=</td>
            <td class="attr-value">107</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
@private
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">SslHandshakeCompleted</td>
            <td>=</td>
            <td class="attr-value">108</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
@private
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">ERRNOS</td>
            <td>=</td>
            <td class="attr-value">Errno::constants.grep(/^E/).inject(Hash.new(:unknown)) { |hash, name|     errno = Errno.__send__(:const_get, name)</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
System errnos @private
</p>
</td>
        </tr>
        
        
    </table>
    

    
    <div class="sectiontitle">Attributes</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>reactor_thread</td>
            <td class='attr-desc'><p>
Exposed to allow joining on the thread, when run in a multithreaded
environment. Performing other actions on the thread has undefined semantics
(read: a dangerous endevor).
</p>
<p>
@return [Thread]
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>threadpool</td>
            <td class='attr-desc'><p>
@private
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>threadpool_size</td>
            <td class='attr-desc'><p>
Size of the <a href="EventMachine.html#M000524">EventMachine.defer</a>
threadpool (defaults to 20) @return [Number]
</p></td>
        </tr>
        
    </table>
    

    
            <div class="sectiontitle">Class Public methods</div>
            
            <div class="method">
                <div class="title" id="M000006">
                    
                    <a name="M000006"></a><b>Callback</b>(object = nil, method = nil, &amp;blk)
                    
                </div>
                
                <div class="description">
                  <p>
Utility method for coercing arguments to an object that responds to :call.
Accepts an object and a method name to send to, or a block, or an object
that responds to :call.
</p>
<p>
@example <a href="EventMachine.html#M000006">EventMachine.Callback</a> used
with a block. Returns that block.
</p>
<pre>
 cb = EventMachine.Callback do |msg|
   puts(msg)
 end
 # returned object is a callable
 cb.call('hello world')
</pre>
<p>
@example <a href="EventMachine.html#M000006">EventMachine.Callback</a> used
with an object (to be more specific, class object) and a method name,
returns an object that responds to call
</p>
<pre>
 cb = EventMachine.Callback(Object, :puts)
 # returned object is a callable that delegates to Kernel#puts (in this case Object.puts)
 cb.call('hello world')
</pre>
<p>
@example <a href="EventMachine.html#M000006">EventMachine.Callback</a> used
with an object that responds to call. Returns the argument.
</p>
<pre>
 cb = EventMachine.Callback(proc{ |msg| puts(msg) })
 # returned object is a callable
 cb.call('hello world')
</pre>
<p>
@overload Callback(object, method)
</p>
<pre>
  Wraps `method` invocation on `object` into an object that responds to #call that proxies all the arguments to that method
  @param [Object] Object to invoke method on
  @param [Symbol] Method name
  @return [&lt;#call&gt;] An object that responds to #call that takes any number of arguments and invokes method on object with those arguments
</pre>
<p>
@overload Callback(object)
</p>
<pre>
  Returns callable object as is, without any coercion
  @param [&lt;#call&gt;] An object that responds to #call
  @return [&lt;#call&gt;] Its argument
</pre>
<p>
@overload Callback(&amp;block)
</p>
<pre>
  Returns block passed to it without any coercion
  @return [&lt;#call&gt;] Block passed to this method
</pre>
<p>
@raise [ArgumentError] When argument doesn&#8217;t respond to call, method
name is missing or when invoked without arguments and block isn&#8217;t
given
</p>
<p>
@return [<call>]
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000006_source')" id="l_M000006_source">show</a>
                        
                    </p>
                    <div id="M000006_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/em/callback.rb, line 47</span>
47:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Callback</span>(<span class="ruby-identifier">object</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">method</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">blk</span>)
48:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">object</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">method</span>
49:       <span class="ruby-identifier">lambda</span> { <span class="ruby-operator">|</span><span class="ruby-operator">*</span><span class="ruby-identifier">args</span><span class="ruby-operator">|</span> <span class="ruby-identifier">object</span>.<span class="ruby-identifier">__send__</span> <span class="ruby-identifier">method</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span> }
50:     <span class="ruby-keyword kw">else</span>
51:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">object</span>.<span class="ruby-identifier">respond_to?</span> <span class="ruby-identifier">:call</span>
52:         <span class="ruby-identifier">object</span>
53:       <span class="ruby-keyword kw">else</span>
54:         <span class="ruby-identifier">blk</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">raise</span>(<span class="ruby-constant">ArgumentError</span>)
55:       <span class="ruby-keyword kw">end</span> <span class="ruby-comment cmt"># if</span>
56:     <span class="ruby-keyword kw">end</span> <span class="ruby-comment cmt"># if</span>
57:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000540">
                    
                    <a name="M000540"></a><b>_open_file_for_writing</b>(filename, handler=nil)
                    
                </div>
                
                <div class="description">
                  <p>
@private
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000540_source')" id="l_M000540_source">show</a>
                        
                    </p>
                    <div id="M000540_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/eventmachine.rb, line 1448</span>
1448:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">_open_file_for_writing</span> <span class="ruby-identifier">filename</span>, <span class="ruby-identifier">handler</span>=<span class="ruby-keyword kw">nil</span>
1449:     <span class="ruby-identifier">klass</span> = <span class="ruby-identifier">klass_from_handler</span>(<span class="ruby-constant">Connection</span>, <span class="ruby-identifier">handler</span>)
1450: 
1451:     <span class="ruby-identifier">s</span> = <span class="ruby-identifier">_write_file</span> <span class="ruby-identifier">filename</span>
1452:     <span class="ruby-identifier">c</span> = <span class="ruby-identifier">klass</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">s</span>
1453:     <span class="ruby-ivar">@conns</span>[<span class="ruby-identifier">s</span>] = <span class="ruby-identifier">c</span>
1454:     <span class="ruby-identifier">block_given?</span> <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">yield</span> <span class="ruby-identifier">c</span>
1455:     <span class="ruby-identifier">c</span>
1456:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000455">
                    
                    <a name="M000455"></a><b>add_oneshot_timer</b>(interval)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000455_source')" id="l_M000455_source">show</a>
                        
                    </p>
                    <div id="M000455_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/jeventmachine.rb, line 107</span>
107:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">add_oneshot_timer</span> <span class="ruby-identifier">interval</span>
108:     <span class="ruby-ivar">@em</span>.<span class="ruby-identifier">installOneshotTimer</span> <span class="ruby-identifier">interval</span>
109:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000301">
                    
                    <a name="M000301"></a><b>add_oneshot_timer</b>(interval)
                    
                </div>
                
                <div class="description">
                  <p>
Changed 04Oct06: intervals from the caller are now in milliseconds, but our
native-ruby processor still wants them in seconds. @private
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000301_source')" id="l_M000301_source">show</a>
                        
                    </p>
                    <div id="M000301_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/em/pure_ruby.rb, line 56</span>
56:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_oneshot_timer</span> <span class="ruby-identifier">interval</span>
57:       <span class="ruby-constant">Reactor</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">install_oneshot_timer</span>(<span class="ruby-identifier">interval</span> <span class="ruby-operator">/</span> <span class="ruby-value">1000</span>)
58:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000505">
                    
                    <a name="M000505"></a><b>add_periodic_timer</b>(*args, &amp;block)
                    
                </div>
                
                <div class="description">
                  <p>
Adds a periodic timer to the event loop. It takes the same parameters as
the one-shot timer method, {<a
href="EventMachine.html#M000504">EventMachine.add_timer</a>}. This method
schedules execution of the given block repeatedly, at intervals of time *at
least* as great as the number of seconds given in the first parameter to
the call.
</p>
<p>
@example Write a dollar-sign to stderr every five seconds, without blocking
</p>
<pre>
 EventMachine.run {
   EventMachine.add_periodic_timer( 5 ) { $stderr.write &quot;$&quot; }
 }
</pre>
<p>
@param [Integer] delay Delay in seconds
</p>
<p>
@see <a
href="EventMachine/PeriodicTimer.html">EventMachine::PeriodicTimer</a> @see
<a href="EventMachine.html#M000504">EventMachine.add_timer</a>
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000505_source')" id="l_M000505_source">show</a>
                        
                    </p>
                    <div id="M000505_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/eventmachine.rb, line 337</span>
337:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">add_periodic_timer</span> <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>
338:     <span class="ruby-identifier">interval</span> = <span class="ruby-identifier">args</span>.<span class="ruby-identifier">shift</span>
339:     <span class="ruby-identifier">code</span> = <span class="ruby-identifier">args</span>.<span class="ruby-identifier">shift</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">block</span>
340: 
341:     <span class="ruby-constant">EventMachine</span><span class="ruby-operator">::</span><span class="ruby-constant">PeriodicTimer</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">interval</span>, <span class="ruby-identifier">code</span>)
342:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000503">
                    
                    <a name="M000503"></a><b>add_shutdown_hook</b>(&amp;block)
                    
                </div>
                
                <div class="description">
                  <p>
Adds a block to call as the reactor is shutting down.
</p>
<p>
These callbacks are called in the <em>reverse</em> order to which they are
added.
</p>
<p>
@example Scheduling operations to be run when <a
href="EventMachine.html">EventMachine</a> event loop is stopped
</p>
<pre>
  EventMachine.run do
    EventMachine.add_shutdown_hook { puts &quot;b&quot; }
    EventMachine.add_shutdown_hook { puts &quot;a&quot; }
    EventMachine.stop
  end

  # Outputs:
  #   a
  #   b
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000503_source')" id="l_M000503_source">show</a>
                        
                    </p>
                    <div id="M000503_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/eventmachine.rb, line 277</span>
277:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">add_shutdown_hook</span> <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>
278:     <span class="ruby-ivar">@tails</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">block</span>
279:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000504">
                    
                    <a name="M000504"></a><b>add_timer</b>(*args, &amp;block)
                    
                </div>
                
                <div class="description">
                  <p>
Adds a one-shot timer to the event loop. Call it with one or two
parameters. The first parameters is a delay-time expressed in
<b>seconds</b> (not milliseconds). The second parameter, if present, must
be an object that responds to :call. If 2nd parameter is not given, then
you can also simply pass a block to the method call.
</p>
<p>
This method may be called from the block passed to {<a
href="EventMachine.html#M000498">EventMachine.run</a>} or from any callback
method. It schedules execution of the proc or block passed to it, after the
passage of an interval of time equal to *at least* the number of seconds
specified in the first parameter to the call.
</p>
<p>
{<a href="EventMachine.html#M000504">EventMachine.add_timer</a>} is a
non-blocking method. Callbacks can and will be called during the interval
of time that the timer is in effect. There is no built-in limit to the
number of timers that can be outstanding at any given time.
</p>
<p>
@example Setting a one-shot timer with <a
href="EventMachine.html">EventMachine</a>
</p>
<pre>
 EventMachine.run {
   puts &quot;Starting the run now: #{Time.now}&quot;
   EventMachine.add_timer 5, proc { puts &quot;Executing timer event: #{Time.now}&quot; }
   EventMachine.add_timer(10) { puts &quot;Executing timer event: #{Time.now}&quot; }
 }
</pre>
<p>
@param [Integer] delay Delay in seconds @see <a
href="EventMachine/Timer.html">EventMachine::Timer</a> @see <a
href="EventMachine.html#M000505">EventMachine.add_periodic_timer</a>
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000504_source')" id="l_M000504_source">show</a>
                        
                    </p>
                    <div id="M000504_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/eventmachine.rb, line 309</span>
309:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">add_timer</span> <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>
310:     <span class="ruby-identifier">interval</span> = <span class="ruby-identifier">args</span>.<span class="ruby-identifier">shift</span>
311:     <span class="ruby-identifier">code</span> = <span class="ruby-identifier">args</span>.<span class="ruby-identifier">shift</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">block</span>
312:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">code</span>
313:       <span class="ruby-comment cmt"># check too many timers!</span>
314:       <span class="ruby-identifier">s</span> = <span class="ruby-identifier">add_oneshot_timer</span>((<span class="ruby-identifier">interval</span>.<span class="ruby-identifier">to_f</span> <span class="ruby-operator">*</span> <span class="ruby-value">1000</span>).<span class="ruby-identifier">to_i</span>)
315:       <span class="ruby-ivar">@timers</span>[<span class="ruby-identifier">s</span>] = <span class="ruby-identifier">code</span>
316:       <span class="ruby-identifier">s</span>
317:     <span class="ruby-keyword kw">end</span>
318:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000514">
                    
                    <a name="M000514"></a><b>attach</b>(io, handler=nil, *args, &amp;blk)
                    
                </div>
                
                <div class="description">
                  <p>
Attaches an <a href="IO.html">IO</a> object or file descriptor to the
eventloop as a regular connection. The file descriptor will be set as
non-blocking, and <a href="EventMachine.html">EventMachine</a> will process
receive_data and <a href="EventMachine.html#M000309">send_data</a> events
on it as it would for any other connection.
</p>
<p>
To watch a fd instead, use {<a
href="EventMachine.html#M000513">EventMachine.watch</a>}, which will not
alter the state of the socket and fire notify_readable and notify_writable
events instead.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000514_source')" id="l_M000514_source">show</a>
                        
                    </p>
                    <div id="M000514_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/eventmachine.rb, line 717</span>
717:   <span class="ruby-keyword kw">def</span> <span class="ruby-constant">EventMachine</span><span class="ruby-operator">::</span><span class="ruby-identifier">attach</span> <span class="ruby-identifier">io</span>, <span class="ruby-identifier">handler</span>=<span class="ruby-keyword kw">nil</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">blk</span>
718:     <span class="ruby-identifier">attach_io</span> <span class="ruby-identifier">io</span>, <span class="ruby-keyword kw">false</span>, <span class="ruby-identifier">handler</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">blk</span>
719:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000487">
                    
                    <a name="M000487"></a><b>attach_fd</b>(fileno, watch_mode)
                    
                </div>
                
                <div class="description">
                  <p>
@private
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000487_source')" id="l_M000487_source">show</a>
                        
                    </p>
                    <div id="M000487_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/jeventmachine.rb, line 207</span>
207:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">attach_fd</span> <span class="ruby-identifier">fileno</span>, <span class="ruby-identifier">watch_mode</span>
208:     <span class="ruby-comment cmt"># 3Aug09: We could pass in the actual SocketChannel, but then it would be modified (set as non-blocking), and</span>
209:     <span class="ruby-comment cmt"># we would need some logic to make sure detach_fd below didn't clobber it. For now, we just always make a new</span>
210:     <span class="ruby-comment cmt"># SocketChannel for the underlying file descriptor</span>
211:     <span class="ruby-comment cmt"># if fileno.java_kind_of? SocketChannel</span>
212:     <span class="ruby-comment cmt">#   ch = fileno</span>
213:     <span class="ruby-comment cmt">#   ch.configureBlocking(false)</span>
214:     <span class="ruby-comment cmt">#   fileno = nil</span>
215:     <span class="ruby-comment cmt"># elsif fileno.java_kind_of? java.nio.channels.Channel</span>
216: 
217:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">fileno</span>.<span class="ruby-identifier">java_kind_of?</span> <span class="ruby-identifier">java</span>.<span class="ruby-identifier">nio</span>.<span class="ruby-identifier">channels</span>.<span class="ruby-constant">Channel</span>
218:       <span class="ruby-identifier">field</span> = <span class="ruby-identifier">fileno</span>.<span class="ruby-identifier">getClass</span>.<span class="ruby-identifier">getDeclaredField</span>(<span class="ruby-value str">'fdVal'</span>)
219:       <span class="ruby-identifier">field</span>.<span class="ruby-identifier">setAccessible</span>(<span class="ruby-keyword kw">true</span>)
220:       <span class="ruby-identifier">fileno</span> = <span class="ruby-identifier">field</span>.<span class="ruby-identifier">get</span>(<span class="ruby-identifier">fileno</span>)
221:     <span class="ruby-keyword kw">else</span>
222:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-value str">'attach_fd requires Java Channel or POSIX fileno'</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">fileno</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">Fixnum</span>
223:     <span class="ruby-keyword kw">end</span>
224: 
225:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">fileno</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
226:       <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;can't open STDIN as selectable in Java =(&quot;</span>
227:     <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">fileno</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">Fixnum</span>
228:       <span class="ruby-comment cmt"># 8Aug09: The following code is specific to the sun jvm's SocketChannelImpl. Is there a cross-platform</span>
229:       <span class="ruby-comment cmt"># way of implementing this? If so, also remember to update EventableSocketChannel#close and #cleanup</span>
230:       <span class="ruby-identifier">fd</span> = <span class="ruby-constant">FileDescriptor</span>.<span class="ruby-identifier">new</span>
231:       <span class="ruby-identifier">fd</span>.<span class="ruby-identifier">set_field</span> <span class="ruby-value str">'fd'</span>, <span class="ruby-identifier">fileno</span>
232: 
233:       <span class="ruby-identifier">ch</span> = <span class="ruby-constant">SocketChannel</span>.<span class="ruby-identifier">open</span>
234:       <span class="ruby-identifier">ch</span>.<span class="ruby-identifier">configureBlocking</span>(<span class="ruby-keyword kw">false</span>)
235:       <span class="ruby-identifier">ch</span>.<span class="ruby-identifier">kill</span>
236:       <span class="ruby-identifier">ch</span>.<span class="ruby-identifier">set_field</span> <span class="ruby-value str">'fd'</span>, <span class="ruby-identifier">fd</span>
237:       <span class="ruby-identifier">ch</span>.<span class="ruby-identifier">set_field</span> <span class="ruby-value str">'fdVal'</span>, <span class="ruby-identifier">fileno</span>
238:       <span class="ruby-identifier">ch</span>.<span class="ruby-identifier">set_field</span> <span class="ruby-value str">'state'</span>, <span class="ruby-identifier">ch</span>.<span class="ruby-identifier">get_field</span>(<span class="ruby-value str">'ST_CONNECTED'</span>)
239:     <span class="ruby-keyword kw">end</span>
240: 
241:     <span class="ruby-ivar">@em</span>.<span class="ruby-identifier">attachChannel</span>(<span class="ruby-identifier">ch</span>,<span class="ruby-identifier">watch_mode</span>)
242:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000515">
                    
                    <a name="M000515"></a><b>attach_io</b>(io, watch_mode, handler=nil, *args)
                    
                </div>
                
                <div class="description">
                  <p>
@private
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000515_source')" id="l_M000515_source">show</a>
                        
                    </p>
                    <div id="M000515_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/eventmachine.rb, line 722</span>
722:   <span class="ruby-keyword kw">def</span> <span class="ruby-constant">EventMachine</span><span class="ruby-operator">::</span><span class="ruby-identifier">attach_io</span> <span class="ruby-identifier">io</span>, <span class="ruby-identifier">watch_mode</span>, <span class="ruby-identifier">handler</span>=<span class="ruby-keyword kw">nil</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>
723:     <span class="ruby-identifier">klass</span> = <span class="ruby-identifier">klass_from_handler</span>(<span class="ruby-constant">Connection</span>, <span class="ruby-identifier">handler</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
724: 
725:     <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">watch_mode</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">klass</span>.<span class="ruby-identifier">public_instance_methods</span>.<span class="ruby-identifier">any?</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">m</span><span class="ruby-operator">|</span> [<span class="ruby-identifier">:notify_readable</span>, <span class="ruby-identifier">:notify_writable</span>].<span class="ruby-identifier">include?</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">to_sym</span> }
726:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-value str">&quot;notify_readable/writable with EM.attach is not supported. Use EM.watch(io){ |c| c.notify_readable = true }&quot;</span>
727:     <span class="ruby-keyword kw">end</span>
728: 
729:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">io</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:fileno</span>)
730:       <span class="ruby-identifier">fd</span> = <span class="ruby-keyword kw">defined?</span>(<span class="ruby-constant">JRuby</span>) <span class="ruby-operator">?</span> <span class="ruby-constant">JRuby</span>.<span class="ruby-identifier">runtime</span>.<span class="ruby-identifier">getDescriptorByFileno</span>(<span class="ruby-identifier">io</span>.<span class="ruby-identifier">fileno</span>).<span class="ruby-identifier">getChannel</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">io</span>.<span class="ruby-identifier">fileno</span>
731:     <span class="ruby-keyword kw">else</span>
732:       <span class="ruby-identifier">fd</span> = <span class="ruby-identifier">io</span>
733:     <span class="ruby-keyword kw">end</span>
734: 
735:     <span class="ruby-identifier">s</span> = <span class="ruby-identifier">attach_fd</span> <span class="ruby-identifier">fd</span>, <span class="ruby-identifier">watch_mode</span>
736:     <span class="ruby-identifier">c</span> = <span class="ruby-identifier">klass</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">s</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>
737: 
738:     <span class="ruby-identifier">c</span>.<span class="ruby-identifier">instance_variable_set</span>(<span class="ruby-identifier">:@io</span>, <span class="ruby-identifier">io</span>)
739:     <span class="ruby-identifier">c</span>.<span class="ruby-identifier">instance_variable_set</span>(<span class="ruby-identifier">:@fd</span>, <span class="ruby-identifier">fd</span>)
740: 
741:     <span class="ruby-ivar">@conns</span>[<span class="ruby-identifier">s</span>] = <span class="ruby-identifier">c</span>
742:     <span class="ruby-identifier">block_given?</span> <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">yield</span> <span class="ruby-identifier">c</span>
743:     <span class="ruby-identifier">c</span>
744:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000512">
                    
                    <a name="M000512"></a><b>bind_connect</b>(bind_addr, bind_port, server, port=nil, handler=nil, *args)
                    
                </div>
                
                <div class="description">
                  <p>
This method is like {<a
href="EventMachine.html#M000511">EventMachine.connect</a>}, but allows for
a local address/port to bind the connection to.
</p>
<p>
@see <a href="EventMachine.html#M000511">EventMachine.connect</a>
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000512_source')" id="l_M000512_source">show</a>
                        
                    </p>
                    <div id="M000512_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/eventmachine.rb, line 637</span>
637:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">bind_connect</span> <span class="ruby-identifier">bind_addr</span>, <span class="ruby-identifier">bind_port</span>, <span class="ruby-identifier">server</span>, <span class="ruby-identifier">port</span>=<span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">handler</span>=<span class="ruby-keyword kw">nil</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>
638:     <span class="ruby-keyword kw">begin</span>
639:       <span class="ruby-identifier">port</span> = <span class="ruby-constant">Integer</span>(<span class="ruby-identifier">port</span>)
640:     <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-constant">TypeError</span>
641:       <span class="ruby-comment cmt"># there was no port, so server must be a unix domain socket</span>
642:       <span class="ruby-comment cmt"># the port argument is actually the handler, and the handler is one of the args</span>
643:       <span class="ruby-identifier">args</span>.<span class="ruby-identifier">unshift</span> <span class="ruby-identifier">handler</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">handler</span>
644:       <span class="ruby-identifier">handler</span> = <span class="ruby-identifier">port</span>
645:       <span class="ruby-identifier">port</span> = <span class="ruby-keyword kw">nil</span>
646:     <span class="ruby-keyword kw">end</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">port</span>
647: 
648:     <span class="ruby-identifier">klass</span> = <span class="ruby-identifier">klass_from_handler</span>(<span class="ruby-constant">Connection</span>, <span class="ruby-identifier">handler</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
649: 
650:     <span class="ruby-identifier">s</span> = <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">port</span>
651:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">bind_addr</span>
652:             <span class="ruby-identifier">bind_connect_server</span> <span class="ruby-identifier">bind_addr</span>, <span class="ruby-identifier">bind_port</span>.<span class="ruby-identifier">to_i</span>, <span class="ruby-identifier">server</span>, <span class="ruby-identifier">port</span>
653:           <span class="ruby-keyword kw">else</span>
654:             <span class="ruby-identifier">connect_server</span> <span class="ruby-identifier">server</span>, <span class="ruby-identifier">port</span>
655:           <span class="ruby-keyword kw">end</span>
656:         <span class="ruby-keyword kw">else</span>
657:           <span class="ruby-identifier">connect_unix_server</span> <span class="ruby-identifier">server</span>
658:         <span class="ruby-keyword kw">end</span>
659: 
660:     <span class="ruby-identifier">c</span> = <span class="ruby-identifier">klass</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">s</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>
661:     <span class="ruby-ivar">@conns</span>[<span class="ruby-identifier">s</span>] = <span class="ruby-identifier">c</span>
662:     <span class="ruby-identifier">block_given?</span> <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">yield</span> <span class="ruby-identifier">c</span>
663:     <span class="ruby-identifier">c</span>
664:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000308">
                    
                    <a name="M000308"></a><b>bind_connect_server</b>(bind_addr, bind_port, host, port)
                    
                </div>
                
                <div class="description">
                  <p>
@private
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000308_source')" id="l_M000308_source">show</a>
                        
                    </p>
                    <div id="M000308_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/em/pure_ruby.rb, line 80</span>
80:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">bind_connect_server</span> <span class="ruby-identifier">bind_addr</span>, <span class="ruby-identifier">bind_port</span>, <span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>
81:       <span class="ruby-constant">EvmaTCPClient</span>.<span class="ruby-identifier">connect</span>(<span class="ruby-identifier">bind_addr</span>, <span class="ruby-identifier">bind_port</span>, <span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>).<span class="ruby-identifier">uuid</span>
82:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000464">
                    
                    <a name="M000464"></a><b>bind_connect_server</b>(bind_addr, bind_port, server, port)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000464_source')" id="l_M000464_source">show</a>
                        
                    </p>
                    <div id="M000464_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/jeventmachine.rb, line 135</span>
135:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">bind_connect_server</span> <span class="ruby-identifier">bind_addr</span>, <span class="ruby-identifier">bind_port</span>, <span class="ruby-identifier">server</span>, <span class="ruby-identifier">port</span>
136:     <span class="ruby-ivar">@em</span>.<span class="ruby-identifier">connectTcpServer</span> <span class="ruby-identifier">bind_addr</span>, <span class="ruby-identifier">bind_port</span>.<span class="ruby-identifier">to_i</span>, <span class="ruby-identifier">server</span>, <span class="ruby-identifier">port</span>
137:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000506">
                    
                    <a name="M000506"></a><b>cancel_timer</b>(timer_or_sig)
                    
                </div>
                
                <div class="description">
                  <p>
Cancel a timer (can be a callback or an {EventMachine::Timer} instance).
</p>
<p>
@param [cancel, call] timer_or_sig A timer to cancel @see <a
href="EventMachine/Timer.html#M000445">EventMachine::Timer#cancel</a>
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000506_source')" id="l_M000506_source">show</a>
                        
                    </p>
                    <div id="M000506_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/eventmachine.rb, line 349</span>
349:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">cancel_timer</span> <span class="ruby-identifier">timer_or_sig</span>
350:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">timer_or_sig</span>.<span class="ruby-identifier">respond_to?</span> <span class="ruby-identifier">:cancel</span>
351:       <span class="ruby-identifier">timer_or_sig</span>.<span class="ruby-identifier">cancel</span>
352:     <span class="ruby-keyword kw">else</span>
353:       <span class="ruby-ivar">@timers</span>[<span class="ruby-identifier">timer_or_sig</span>] = <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@timers</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">timer_or_sig</span>)
354:     <span class="ruby-keyword kw">end</span>
355:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000310">
                    
                    <a name="M000310"></a><b>close_connection</b>(target, after_writing)
                    
                </div>
                
                <div class="description">
                  <p>
The extension version does NOT raise any kind of an error if an attempt is
made to close a non-existent connection. Not sure whether we should. For
now, we&#8217;ll raise an error here in that case. @private
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000310_source')" id="l_M000310_source">show</a>
                        
                    </p>
                    <div id="M000310_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/em/pure_ruby.rb, line 95</span>
95:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">close_connection</span> <span class="ruby-identifier">target</span>, <span class="ruby-identifier">after_writing</span>
96:       <span class="ruby-identifier">selectable</span> = <span class="ruby-constant">Reactor</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">get_selectable</span>( <span class="ruby-identifier">target</span> ) <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;unknown close_connection target&quot;</span>
97:       <span class="ruby-identifier">selectable</span>.<span class="ruby-identifier">schedule_close</span> <span class="ruby-identifier">after_writing</span>
98:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000465">
                    
                    <a name="M000465"></a><b>close_connection</b>(sig, after_writing)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000465_source')" id="l_M000465_source">show</a>
                        
                    </p>
                    <div id="M000465_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/jeventmachine.rb, line 138</span>
138:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">close_connection</span> <span class="ruby-identifier">sig</span>, <span class="ruby-identifier">after_writing</span>
139:     <span class="ruby-ivar">@em</span>.<span class="ruby-identifier">closeConnection</span> <span class="ruby-identifier">sig</span>, <span class="ruby-identifier">after_writing</span>
140:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000511">
                    
                    <a name="M000511"></a><b>connect</b>(server, port=nil, handler=nil, *args, &amp;blk)
                    
                </div>
                
                <div class="description">
                  <p>
Initiates a TCP connection to a remote server and sets up event handling
for the connection. {<a
href="EventMachine.html#M000511">EventMachine.connect</a>} requires event
loop to be running (see {<a
href="EventMachine.html#M000498">EventMachine.run</a>}).
</p>
<p>
{<a href="EventMachine.html#M000511">EventMachine.connect</a>} takes the IP
address (or hostname) and port of the remote server you want to connect to.
It also takes an optional handler (a module or a subclass of
{EventMachine::Connection}) which you must define, that contains the
callbacks that will be invoked by the event loop on behalf of the
connection.
</p>
<p>
Learn more about connection lifecycle callbacks in the {file:<a
href="../files/docs/GettingStarted_md.html">docs/GettingStarted.md</a> <a
href="EventMachine.html">EventMachine</a> tutorial} and
{file:docs/ConnectionLifecycleCallbacks.md <a
href="EventMachine/Connection.html">Connection</a> lifecycle guide}.
</p>
<p>
@example
</p>
<pre>
 # Here's a program which connects to a web server, sends a naive
 # request, parses the HTTP header of the response, and then
 # (antisocially) ends the event loop, which automatically drops the connection
 # (and incidentally calls the connection's unbind method).
 module DumbHttpClient
   def post_init
     send_data &quot;GET / HTTP/1.1\r\nHost: _\r\n\r\n&quot;
     @data = &quot;&quot;
     @parsed = false
   end

   def receive_data data
     @data &lt;&lt; data
     if !@parsed and @data =~ /[\n][\r]*[\n]/m
       @parsed = true
       puts &quot;RECEIVED HTTP HEADER:&quot;
       $`.each {|line| puts &quot;&gt;&gt;&gt; #{line}&quot; }

       puts &quot;Now we'll terminate the loop, which will also close the connection&quot;
       EventMachine::stop_event_loop
     end
   end

   def unbind
     puts &quot;A connection has terminated&quot;
   end
 end

 EventMachine.run {
   EventMachine.connect &quot;www.bayshorenetworks.com&quot;, 80, DumbHttpClient
 }
 puts &quot;The event loop has ended&quot;
</pre>
<p>
@example Defining protocol handler as a class
</p>
<pre>
 class MyProtocolHandler &lt; EventMachine::Connection
   def initialize *args
     super
     # whatever else you want to do here
   end

   # ...
 end
</pre>
<p>
@param [String] server Host to connect to @param [Integer] port Port to
connect to @param [Module, Class] handler A module or class that implements
connection lifecycle callbacks
</p>
<p>
@see <a href="EventMachine.html#M000508">EventMachine.start_server</a> @see
file:<a
href="../files/docs/GettingStarted_md.html">docs/GettingStarted.md</a> <a
href="EventMachine.html">EventMachine</a> tutorial
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000511_source')" id="l_M000511_source">show</a>
                        
                    </p>
                    <div id="M000511_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/eventmachine.rb, line 607</span>
607:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">connect</span> <span class="ruby-identifier">server</span>, <span class="ruby-identifier">port</span>=<span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">handler</span>=<span class="ruby-keyword kw">nil</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">blk</span>
608:     <span class="ruby-comment cmt"># EventMachine::connect initiates a TCP connection to a remote</span>
609:     <span class="ruby-comment cmt"># server and sets up event-handling for the connection.</span>
610:     <span class="ruby-comment cmt"># It internally creates an object that should not be handled</span>
611:     <span class="ruby-comment cmt"># by the caller. HOWEVER, it's often convenient to get the</span>
612:     <span class="ruby-comment cmt"># object to set up interfacing to other objects in the system.</span>
613:     <span class="ruby-comment cmt"># We return the newly-created anonymous-class object to the caller.</span>
614:     <span class="ruby-comment cmt"># It's expected that a considerable amount of code will depend</span>
615:     <span class="ruby-comment cmt"># on this behavior, so don't change it.</span>
616:     <span class="ruby-comment cmt">#</span>
617:     <span class="ruby-comment cmt"># Ok, added support for a user-defined block, 13Apr06.</span>
618:     <span class="ruby-comment cmt"># This leads us to an interesting choice because of the</span>
619:     <span class="ruby-comment cmt"># presence of the post_init call, which happens in the</span>
620:     <span class="ruby-comment cmt"># initialize method of the new object. We call the user's</span>
621:     <span class="ruby-comment cmt"># block and pass the new object to it. This is a great</span>
622:     <span class="ruby-comment cmt"># way to do protocol-specific initiation. It happens</span>
623:     <span class="ruby-comment cmt"># AFTER post_init has been called on the object, which I</span>
624:     <span class="ruby-comment cmt"># certainly hope is the right choice.</span>
625:     <span class="ruby-comment cmt"># Don't change this lightly, because accepted connections</span>
626:     <span class="ruby-comment cmt"># are different from connected ones and we don't want</span>
627:     <span class="ruby-comment cmt"># to have them behave differently with respect to post_init</span>
628:     <span class="ruby-comment cmt"># if at all possible.</span>
629: 
630:     <span class="ruby-identifier">bind_connect</span> <span class="ruby-keyword kw">nil</span>, <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">server</span>, <span class="ruby-identifier">port</span>, <span class="ruby-identifier">handler</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">blk</span>
631:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000307">
                    
                    <a name="M000307"></a><b>connect_server</b>(host, port)
                    
                </div>
                
                <div class="description">
                  <p>
@private
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000307_source')" id="l_M000307_source">show</a>
                        
                    </p>
                    <div id="M000307_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/em/pure_ruby.rb, line 75</span>
75:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">connect_server</span> <span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>
76:       <span class="ruby-identifier">bind_connect_server</span> <span class="ruby-keyword kw">nil</span>, <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>
77:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000463">
                    
                    <a name="M000463"></a><b>connect_server</b>(server, port)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000463_source')" id="l_M000463_source">show</a>
                        
                    </p>
                    <div id="M000463_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/jeventmachine.rb, line 132</span>
132:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">connect_server</span> <span class="ruby-identifier">server</span>, <span class="ruby-identifier">port</span>
133:     <span class="ruby-identifier">bind_connect_server</span> <span class="ruby-keyword kw">nil</span>, <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">server</span>, <span class="ruby-identifier">port</span>
134:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000517">
                    
                    <a name="M000517"></a><b>connect_unix_domain</b>(socketname, *args, &amp;blk)
                    
                </div>
                
                <div class="description">
                  <p>
Make a connection to a Unix-domain socket. This method is simply an alias
for {.connect}, which can connect to both TCP and Unix-domain sockets. Make
sure that your process has sufficient permissions to open the socket it is
given.
</p>
<p>
@param [String] socketname Unix domain socket (local fully-qualified path)
you want to connect to.
</p>
<p>
@note UNIX sockets, as the name suggests, are not available on Microsoft
Windows.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000517_source')" id="l_M000517_source">show</a>
                        
                    </p>
                    <div id="M000517_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/eventmachine.rb, line 779</span>
779:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">connect_unix_domain</span> <span class="ruby-identifier">socketname</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">blk</span>
780:     <span class="ruby-identifier">connect</span> <span class="ruby-identifier">socketname</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">blk</span>
781:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000314">
                    
                    <a name="M000314"></a><b>connect_unix_server</b>(chain)
                    
                </div>
                
                <div class="description">
                  <p>
@private
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000314_source')" id="l_M000314_source">show</a>
                        
                    </p>
                    <div id="M000314_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/em/pure_ruby.rb, line 119</span>
119:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">connect_unix_server</span> <span class="ruby-identifier">chain</span>
120:       <span class="ruby-constant">EvmaUNIXClient</span>.<span class="ruby-identifier">connect</span>(<span class="ruby-identifier">chain</span>).<span class="ruby-identifier">uuid</span>
121:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000522">
                    
                    <a name="M000522"></a><b>connection_count</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Returns the total number of connections (file descriptors) currently held
by the reactor. Note that a tick must pass after the
&#8216;initiation&#8217; of a connection for this number to increment.
It&#8217;s usually accurate, but don&#8217;t rely on the exact precision of
this number unless you really know EM internals.
</p>
<p>
@example
</p>
<pre>
 EventMachine.run {
   EventMachine.connect(&quot;rubyeventmachine.com&quot;, 80)
   # count will be 0 in this case, because connection is not
   # established yet
   count = EventMachine.connection_count
 }
</pre>
<p>
@example
</p>
<pre>
 EventMachine.run {
   EventMachine.connect(&quot;rubyeventmachine.com&quot;, 80)

   EventMachine.next_tick {
     # In this example, count will be 1 since the connection has been established in
     # the next loop of the reactor.
     count = EventMachine.connection_count
   }
 }
</pre>
<p>
@return [Integer] Number of connections currently held by the reactor.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000522_source')" id="l_M000522_source">show</a>
                        
                    </p>
                    <div id="M000522_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/eventmachine.rb, line 921</span>
921:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">connection_count</span>
922:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">get_connection_count</span>
923:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000524">
                    
                    <a name="M000524"></a><b>defer</b>(op = nil, callback = nil, &amp;blk)
                    
                </div>
                
                <div class="description">
                  <p>
<a href="EventMachine.html#M000524">EventMachine.defer</a> is used for
integrating blocking operations into EventMachine&#8217;s control flow. The
action of {.defer} is to take the block specified in the first parameter
(the &#8220;operation&#8221;) and schedule it for asynchronous execution on
an internal thread pool maintained by <a
href="EventMachine.html">EventMachine</a>. When the operation completes, it
will pass the result computed by the block (if any) back to the <a
href="EventMachine.html">EventMachine</a> reactor. Then, <a
href="EventMachine.html">EventMachine</a> calls the block specified in the
second parameter to {.defer} (the &#8220;callback&#8221;), as part of its
normal event handling loop. The result computed by the operation block is
passed as a parameter to the callback. You may omit the callback parameter
if you don&#8217;t need to execute any code after the operation completes.
</p>
<p>
## Caveats ##
</p>
<p>
Note carefully that the code in your deferred operation will be executed on
a separate thread from the main <a
href="EventMachine.html">EventMachine</a> processing and all other Ruby
threads that may exist in your program. Also, multiple deferred operations
may be running at once! Therefore, you are responsible for ensuring that
your operation code is threadsafe.
</p>
<p>
Don&#8217;t write a deferred operation that will block forever. If so, the
current implementation will not detect the problem, and the thread will
never be returned to the pool. <a href="EventMachine.html">EventMachine</a>
limits the number of threads in its pool, so if you do this enough times,
your subsequent deferred operations won&#8217;t get a chance to run.
</p>
<p>
@example
</p>
<pre>
 operation = proc {
   # perform a long-running operation here, such as a database query.
   &quot;result&quot; # as usual, the last expression evaluated in the block will be the return value.
 }
 callback = proc {|result|
   # do something with result here, such as send it back to a network client.
 }

 EventMachine.defer(operation, callback)
</pre>
<p>
@param [call] op An operation you want to offload to <a
href="EventMachine.html">EventMachine</a> thread pool @param [call]
callback A callback that will be run on the event loop thread after
`operation` finishes.
</p>
<p>
@see <a
href="EventMachine.html#threadpool_size">EventMachine.threadpool_size</a>
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000524_source')" id="l_M000524_source">show</a>
                        
                    </p>
                    <div id="M000524_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/eventmachine.rb, line 983</span>
 983:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">defer</span> <span class="ruby-identifier">op</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">callback</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">blk</span>
 984:     <span class="ruby-comment cmt"># OBSERVE that #next_tick hacks into this mechanism, so don't make any changes here</span>
 985:     <span class="ruby-comment cmt"># without syncing there.</span>
 986:     <span class="ruby-comment cmt">#</span>
 987:     <span class="ruby-comment cmt"># Running with $VERBOSE set to true gives a warning unless all ivars are defined when</span>
 988:     <span class="ruby-comment cmt"># they appear in rvalues. But we DON'T ever want to initialize @threadqueue unless we</span>
 989:     <span class="ruby-comment cmt"># need it, because the Ruby threads are so heavyweight. We end up with this bizarre</span>
 990:     <span class="ruby-comment cmt"># way of initializing @threadqueue because EventMachine is a Module, not a Class, and</span>
 991:     <span class="ruby-comment cmt"># has no constructor.</span>
 992: 
 993:     <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@threadpool</span>
 994:       <span class="ruby-identifier">require</span> <span class="ruby-value str">'thread'</span>
 995:       <span class="ruby-ivar">@threadpool</span> = []
 996:       <span class="ruby-ivar">@threadqueue</span> = <span class="ruby-operator">::</span><span class="ruby-constant">Queue</span>.<span class="ruby-identifier">new</span>
 997:       <span class="ruby-ivar">@resultqueue</span> = <span class="ruby-operator">::</span><span class="ruby-constant">Queue</span>.<span class="ruby-identifier">new</span>
 998:       <span class="ruby-identifier">spawn_threadpool</span>
 999:     <span class="ruby-keyword kw">end</span>
1000: 
1001:     <span class="ruby-ivar">@threadqueue</span> <span class="ruby-operator">&lt;&lt;</span> [<span class="ruby-identifier">op</span><span class="ruby-operator">||</span><span class="ruby-identifier">blk</span>,<span class="ruby-identifier">callback</span>]
1002:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000488">
                    
                    <a name="M000488"></a><b>detach_fd</b>(sig)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000488_source')" id="l_M000488_source">show</a>
                        
                    </p>
                    <div id="M000488_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/jeventmachine.rb, line 243</span>
243:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">detach_fd</span> <span class="ruby-identifier">sig</span>
244:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ch</span> = <span class="ruby-ivar">@em</span>.<span class="ruby-identifier">detachChannel</span>(<span class="ruby-identifier">sig</span>)
245:       <span class="ruby-identifier">ch</span>.<span class="ruby-identifier">get_field</span> <span class="ruby-value str">'fdVal'</span>
246:     <span class="ruby-keyword kw">end</span>
247:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000536">
                    
                    <a name="M000536"></a><b>disable_proxy</b>(from)
                    
                </div>
                
                <div class="description">
                  <p>
Takes just one argument, a {Connection} that has proxying enabled via {<a
href="EventMachine.html#M000535">EventMachine.enable_proxy</a>}. Calling
this method will remove that functionality and your connection will begin
receiving data via {<a
href="EventMachine/Connection.html#M000035">Connection#receive_data</a>}
again.
</p>
<p>
@param [EventMachine::Connection] from Source of data that is being proxied
@see <a href="EventMachine.html#M000535">EventMachine.enable_proxy</a>
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000536_source')" id="l_M000536_source">show</a>
                        
                    </p>
                    <div id="M000536_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/eventmachine.rb, line 1353</span>
1353:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">disable_proxy</span>(<span class="ruby-identifier">from</span>)
1354:     <span class="ruby-constant">EM</span><span class="ruby-operator">::</span><span class="ruby-identifier">stop_proxy</span>(<span class="ruby-identifier">from</span>.<span class="ruby-identifier">signature</span>)
1355:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000535">
                    
                    <a name="M000535"></a><b>enable_proxy</b>(from, to, bufsize=0, length=0)
                    
                </div>
                
                <div class="description">
                  <p>
This method allows for direct writing of incoming data back out to another
descriptor, at the C++ level in the reactor. This is very efficient and
especially useful for proxies where high performance is required.
Propogating data from a server response all the way up to Ruby, and then
back down to the reactor to be sent back to the client, is often
unnecessary and incurs a significant performance decrease.
</p>
<p>
The two arguments are instance of {EventMachine::Connection} subclasses,
&#8216;from&#8217; and &#8216;to&#8217;. &#8216;from&#8217; is the
connection whose inbound data you want relayed back out. &#8216;to&#8217;
is the connection to write it to.
</p>
<p>
Once you call this method, the &#8216;from&#8217; connection will no longer
get receive_data callbacks from the reactor, except in the case that
&#8216;to&#8217; connection has already closed when attempting to write to
it. You can see in the example, that proxy_target_unbound will be called
when this occurs. After that, further incoming data will be passed into
receive_data as normal.
</p>
<p>
Note also that this feature supports different types of descriptors: TCP,
UDP, and pipes. You can relay data from one kind to another, for example,
feed a pipe from a UDP stream.
</p>
<p>
@example
</p>
<pre>
 module ProxyConnection
   def initialize(client, request)
     @client, @request = client, request
   end

   def post_init
     EM::enable_proxy(self, @client)
   end

   def connection_completed
     send_data @request
   end

   def proxy_target_unbound
     close_connection
   end

   def unbind
     @client.close_connection_after_writing
   end
 end

 module ProxyServer
   def receive_data(data)
     (@buf ||= &quot;&quot;) &lt;&lt; data
     if @buf =~ /\r\n\r\n/ # all http headers received
       EventMachine.connect(&quot;10.0.0.15&quot;, 80, ProxyConnection, self, data)
     end
   end
 end

 EventMachine.run {
   EventMachine.start_server(&quot;127.0.0.1&quot;, 8080, ProxyServer)
 }
</pre>
<p>
@param [EventMachine::Connection] from Source of data to be
proxies/streamed. @param [EventMachine::Connection] to Destination of data
to be proxies/streamed. @param [Integer] bufsize Buffer size to use @param
[Integer] length Maximum number of bytes to proxy.
</p>
<p>
@see <a href="EventMachine.html#M000536">EventMachine.disable_proxy</a>
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000535_source')" id="l_M000535_source">show</a>
                        
                    </p>
                    <div id="M000535_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/eventmachine.rb, line 1343</span>
1343:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">enable_proxy</span>(<span class="ruby-identifier">from</span>, <span class="ruby-identifier">to</span>, <span class="ruby-identifier">bufsize</span>=<span class="ruby-value">0</span>, <span class="ruby-identifier">length</span>=<span class="ruby-value">0</span>)
1344:     <span class="ruby-constant">EM</span><span class="ruby-operator">::</span><span class="ruby-identifier">start_proxy</span>(<span class="ruby-identifier">from</span>.<span class="ruby-identifier">signature</span>, <span class="ruby-identifier">to</span>.<span class="ruby-identifier">signature</span>, <span class="ruby-identifier">bufsize</span>, <span class="ruby-identifier">length</span>)
1345:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000473">
                    
                    <a name="M000473"></a><b>epoll</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000473_source')" id="l_M000473_source">show</a>
                        
                    </p>
                    <div id="M000473_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/jeventmachine.rb, line 160</span>
160:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">epoll</span>
161:     <span class="ruby-comment cmt"># Epoll is a no-op for Java.</span>
162:     <span class="ruby-comment cmt"># The latest Java versions run epoll when possible in NIO.</span>
163:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000322">
                    
                    <a name="M000322"></a><b>epoll</b>()
                    
                </div>
                
                <div class="description">
                  <p>
This method is a harmless no-op in the pure-Ruby implementation. This is
intended to ensure that user code behaves properly across different EM
implementations. @private
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000322_source')" id="l_M000322_source">show</a>
                        
                    </p>
                    <div id="M000322_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/em/pure_ruby.rb, line 158</span>
158:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">epoll</span>
159:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000474">
                    
                    <a name="M000474"></a><b>epoll=</b>(val)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000474_source')" id="l_M000474_source">show</a>
                        
                    </p>
                    <div id="M000474_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/jeventmachine.rb, line 164</span>
164:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">epoll=</span> <span class="ruby-identifier">val</span>
165:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000477">
                    
                    <a name="M000477"></a><b>epoll?</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000477_source')" id="l_M000477_source">show</a>
                        
                    </p>
                    <div id="M000477_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/jeventmachine.rb, line 170</span>
170:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">epoll?</span>
171:     <span class="ruby-keyword kw">false</span>
172:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000534">
                    
                    <a name="M000534"></a><b>error_handler</b>(cb = nil, &amp;blk)
                    
                </div>
                
                <div class="description">
                  <p>
Catch-all for errors raised during event loop callbacks.
</p>
<p>
@example
</p>
<pre>
  EventMachine.error_handler{ |e|
    puts &quot;Error raised during event loop: #{e.message}&quot;
  }
</pre>
<p>
@param [call] cb Global catch-all errback
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000534_source')" id="l_M000534_source">show</a>
                        
                    </p>
                    <div id="M000534_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/eventmachine.rb, line 1276</span>
1276:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">error_handler</span> <span class="ruby-identifier">cb</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">blk</span>
1277:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">cb</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">blk</span>
1278:       <span class="ruby-ivar">@error_handler</span> = <span class="ruby-identifier">cb</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">blk</span>
1279:     <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">instance_variable_defined?</span> <span class="ruby-identifier">:@error_handler</span>
1280:       <span class="ruby-identifier">remove_instance_variable</span> <span class="ruby-identifier">:@error_handler</span>
1281:     <span class="ruby-keyword kw">end</span>
1282:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000539">
                    
                    <a name="M000539"></a><b>event_callback</b>(conn_binding, opcode, data)
                    
                </div>
                
                <div class="description">
                  <p>
@private
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000539_source')" id="l_M000539_source">show</a>
                        
                    </p>
                    <div id="M000539_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/eventmachine.rb, line 1376</span>
1376:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">event_callback</span> <span class="ruby-identifier">conn_binding</span>, <span class="ruby-identifier">opcode</span>, <span class="ruby-identifier">data</span>
1377:     <span class="ruby-comment cmt">#</span>
1378:     <span class="ruby-comment cmt"># Changed 27Dec07: Eliminated the hookable error handling.</span>
1379:     <span class="ruby-comment cmt"># No one was using it, and it degraded performance significantly.</span>
1380:     <span class="ruby-comment cmt"># It's in original_event_callback, which is dead code.</span>
1381:     <span class="ruby-comment cmt">#</span>
1382:     <span class="ruby-comment cmt"># Changed 25Jul08: Added a partial solution to the problem of exceptions</span>
1383:     <span class="ruby-comment cmt"># raised in user-written event-handlers. If such exceptions are not caught,</span>
1384:     <span class="ruby-comment cmt"># we must cause the reactor to stop, and then re-raise the exception.</span>
1385:     <span class="ruby-comment cmt"># Otherwise, the reactor doesn't stop and it's left on the call stack.</span>
1386:     <span class="ruby-comment cmt"># This is partial because we only added it to #unbind, where it's critical</span>
1387:     <span class="ruby-comment cmt"># (to keep unbind handlers from being re-entered when a stopping reactor</span>
1388:     <span class="ruby-comment cmt"># runs down open connections). It should go on the other calls to user</span>
1389:     <span class="ruby-comment cmt"># code, but the performance impact may be too large.</span>
1390:     <span class="ruby-comment cmt">#</span>
1391:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">opcode</span> <span class="ruby-operator">==</span> <span class="ruby-constant">ConnectionUnbound</span>
1392:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">c</span> = <span class="ruby-ivar">@conns</span>.<span class="ruby-identifier">delete</span>( <span class="ruby-identifier">conn_binding</span> )
1393:         <span class="ruby-keyword kw">begin</span>
1394:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">original_method</span>(<span class="ruby-identifier">:unbind</span>).<span class="ruby-identifier">arity</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span>
1395:             <span class="ruby-identifier">c</span>.<span class="ruby-identifier">unbind</span>(<span class="ruby-identifier">data</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-operator">?</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-operator">:</span> <span class="ruby-constant">EventMachine</span><span class="ruby-operator">::</span><span class="ruby-constant">ERRNOS</span>[<span class="ruby-identifier">data</span>])
1396:           <span class="ruby-keyword kw">else</span>
1397:             <span class="ruby-identifier">c</span>.<span class="ruby-identifier">unbind</span>
1398:           <span class="ruby-keyword kw">end</span>
1399:         <span class="ruby-keyword kw">rescue</span>
1400:           <span class="ruby-ivar">@wrapped_exception</span> = <span class="ruby-identifier">$!</span>
1401:           <span class="ruby-identifier">stop</span>
1402:         <span class="ruby-keyword kw">end</span>
1403:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">c</span> = <span class="ruby-ivar">@acceptors</span>.<span class="ruby-identifier">delete</span>( <span class="ruby-identifier">conn_binding</span> )
1404:         <span class="ruby-comment cmt"># no-op</span>
1405:       <span class="ruby-keyword kw">else</span>
1406:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">$!</span> <span class="ruby-comment cmt"># Bubble user generated errors.</span>
1407:           <span class="ruby-ivar">@wrapped_exception</span> = <span class="ruby-identifier">$!</span>
1408:           <span class="ruby-constant">EM</span>.<span class="ruby-identifier">stop</span>
1409:         <span class="ruby-keyword kw">else</span>
1410:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">ConnectionNotBound</span>, <span class="ruby-node">&quot;received ConnectionUnbound for an unknown signature: #{conn_binding}&quot;</span>
1411:         <span class="ruby-keyword kw">end</span>
1412:       <span class="ruby-keyword kw">end</span>
1413:     <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">opcode</span> <span class="ruby-operator">==</span> <span class="ruby-constant">ConnectionAccepted</span>
1414:       <span class="ruby-identifier">accep</span>,<span class="ruby-identifier">args</span>,<span class="ruby-identifier">blk</span> = <span class="ruby-ivar">@acceptors</span>[<span class="ruby-identifier">conn_binding</span>]
1415:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">NoHandlerForAcceptedConnection</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">accep</span>
1416:       <span class="ruby-identifier">c</span> = <span class="ruby-identifier">accep</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">data</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>
1417:       <span class="ruby-ivar">@conns</span>[<span class="ruby-identifier">data</span>] = <span class="ruby-identifier">c</span>
1418:       <span class="ruby-identifier">blk</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">blk</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">c</span>)
1419:       <span class="ruby-identifier">c</span> <span class="ruby-comment cmt"># (needed?)</span>
1420:       <span class="ruby-comment cmt">##</span>
1421:       <span class="ruby-comment cmt"># The remaining code is a fallback for the pure ruby and java reactors.</span>
1422:       <span class="ruby-comment cmt"># In the C++ reactor, these events are handled in the C event_callback() in rubymain.cpp</span>
1423:     <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">opcode</span> <span class="ruby-operator">==</span> <span class="ruby-constant">ConnectionCompleted</span>
1424:       <span class="ruby-identifier">c</span> = <span class="ruby-ivar">@conns</span>[<span class="ruby-identifier">conn_binding</span>] <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">raise</span> <span class="ruby-constant">ConnectionNotBound</span>, <span class="ruby-node">&quot;received ConnectionCompleted for unknown signature: #{conn_binding}&quot;</span>
1425:       <span class="ruby-identifier">c</span>.<span class="ruby-identifier">connection_completed</span>
1426:     <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">opcode</span> <span class="ruby-operator">==</span> <span class="ruby-constant">TimerFired</span>
1427:       <span class="ruby-identifier">t</span> = <span class="ruby-ivar">@timers</span>.<span class="ruby-identifier">delete</span>( <span class="ruby-identifier">data</span> )
1428:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">t</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">false</span> <span class="ruby-comment cmt"># timer cancelled</span>
1429:       <span class="ruby-identifier">t</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">raise</span> <span class="ruby-constant">UnknownTimerFired</span>, <span class="ruby-node">&quot;timer data: #{data}&quot;</span>
1430:       <span class="ruby-identifier">t</span>.<span class="ruby-identifier">call</span>
1431:     <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">opcode</span> <span class="ruby-operator">==</span> <span class="ruby-constant">ConnectionData</span>
1432:       <span class="ruby-identifier">c</span> = <span class="ruby-ivar">@conns</span>[<span class="ruby-identifier">conn_binding</span>] <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">raise</span> <span class="ruby-constant">ConnectionNotBound</span>, <span class="ruby-node">&quot;received data #{data} for unknown signature: #{conn_binding}&quot;</span>
1433:       <span class="ruby-identifier">c</span>.<span class="ruby-identifier">receive_data</span> <span class="ruby-identifier">data</span>
1434:     <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">opcode</span> <span class="ruby-operator">==</span> <span class="ruby-constant">LoopbreakSignalled</span>
1435:       <span class="ruby-identifier">run_deferred_callbacks</span>
1436:     <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">opcode</span> <span class="ruby-operator">==</span> <span class="ruby-constant">ConnectionNotifyReadable</span>
1437:       <span class="ruby-identifier">c</span> = <span class="ruby-ivar">@conns</span>[<span class="ruby-identifier">conn_binding</span>] <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">raise</span> <span class="ruby-constant">ConnectionNotBound</span>
1438:       <span class="ruby-identifier">c</span>.<span class="ruby-identifier">notify_readable</span>
1439:     <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">opcode</span> <span class="ruby-operator">==</span> <span class="ruby-constant">ConnectionNotifyWritable</span>
1440:       <span class="ruby-identifier">c</span> = <span class="ruby-ivar">@conns</span>[<span class="ruby-identifier">conn_binding</span>] <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">raise</span> <span class="ruby-constant">ConnectionNotBound</span>
1441:       <span class="ruby-identifier">c</span>.<span class="ruby-identifier">notify_writable</span>
1442:     <span class="ruby-keyword kw">end</span>
1443:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000502">
                    
                    <a name="M000502"></a><b>fork_reactor</b>(&amp;block)
                    
                </div>
                
                <div class="description">
                  <p>
Forks a new process, properly stops the reactor and then calls {<a
href="EventMachine.html#M000498">EventMachine.run</a>} inside of it again,
passing your block.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000502_source')" id="l_M000502_source">show</a>
                        
                    </p>
                    <div id="M000502_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/eventmachine.rb, line 246</span>
246:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">fork_reactor</span> <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>
247:     <span class="ruby-comment cmt"># This implementation is subject to change, especially if we clean up the relationship</span>
248:     <span class="ruby-comment cmt"># of EM#run to @reactor_running.</span>
249:     <span class="ruby-comment cmt"># Original patch by Aman Gupta.</span>
250:     <span class="ruby-comment cmt">#</span>
251:     <span class="ruby-constant">Kernel</span>.<span class="ruby-identifier">fork</span> <span class="ruby-keyword kw">do</span>
252:       <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">reactor_running?</span>
253:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">stop_event_loop</span>
254:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">release_machine</span>
255:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">instance_variable_set</span>( <span class="ruby-value str">'@reactor_running'</span>, <span class="ruby-keyword kw">false</span> )
256:       <span class="ruby-keyword kw">end</span>
257:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">run</span> <span class="ruby-identifier">block</span>
258:     <span class="ruby-keyword kw">end</span>
259:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000493">
                    
                    <a name="M000493"></a><b>get_connection_count</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000493_source')" id="l_M000493_source">show</a>
                        
                    </p>
                    <div id="M000493_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/jeventmachine.rb, line 262</span>
262:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">get_connection_count</span>
263:     <span class="ruby-ivar">@em</span>.<span class="ruby-identifier">getConnectionCount</span>
264:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000484">
                    
                    <a name="M000484"></a><b>get_max_timer_count</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000484_source')" id="l_M000484_source">show</a>
                        
                    </p>
                    <div id="M000484_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/jeventmachine.rb, line 194</span>
194:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">get_max_timer_count</span>
195:     <span class="ruby-comment cmt"># harmless no-op in Java. There's no built-in timer limit.</span>
196:     <span class="ruby-ivar">@max_timer_count</span> <span class="ruby-operator">||</span> <span class="ruby-value">100_000</span>
197:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000521">
                    
                    <a name="M000521"></a><b>get_max_timers</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Gets the current maximum number of allowed timers
</p>
<p>
@return [Integer] Maximum number of timers that may be outstanding at any
given time
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000521_source')" id="l_M000521_source">show</a>
                        
                    </p>
                    <div id="M000521_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/eventmachine.rb, line 890</span>
890:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">get_max_timers</span>
891:     <span class="ruby-identifier">get_max_timer_count</span>
892:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000334">
                    
                    <a name="M000334"></a><b>get_outbound_data_size</b>(sig)
                    
                </div>
                
                <div class="description">
                  <p>
@private
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000334_source')" id="l_M000334_source">show</a>
                        
                    </p>
                    <div id="M000334_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/em/pure_ruby.rb, line 206</span>
206:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_outbound_data_size</span> <span class="ruby-identifier">sig</span>
207:       <span class="ruby-identifier">r</span> = <span class="ruby-constant">Reactor</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">get_selectable</span>( <span class="ruby-identifier">sig</span> ) <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;unknown get_outbound_data_size target&quot;</span>
208:       <span class="ruby-identifier">r</span>.<span class="ruby-identifier">get_outbound_data_size</span>
209:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000316">
                    
                    <a name="M000316"></a><b>get_peername</b>(sig)
                    
                </div>
                
                <div class="description">
                  <p>
@private
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000316_source')" id="l_M000316_source">show</a>
                        
                    </p>
                    <div id="M000316_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/em/pure_ruby.rb, line 129</span>
129:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_peername</span> <span class="ruby-identifier">sig</span>
130:       <span class="ruby-identifier">selectable</span> = <span class="ruby-constant">Reactor</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">get_selectable</span>( <span class="ruby-identifier">sig</span> ) <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;unknown get_peername target&quot;</span>
131:       <span class="ruby-identifier">selectable</span>.<span class="ruby-identifier">get_peername</span>
132:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000486">
                    
                    <a name="M000486"></a><b>get_peername</b>(sig)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000486_source')" id="l_M000486_source">show</a>
                        
                    </p>
                    <div id="M000486_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/jeventmachine.rb, line 201</span>
201:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">get_peername</span> <span class="ruby-identifier">sig</span>
202:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">peer</span> = <span class="ruby-ivar">@em</span>.<span class="ruby-identifier">getPeerName</span>(<span class="ruby-identifier">sig</span>)
203:       <span class="ruby-constant">Socket</span>.<span class="ruby-identifier">pack_sockaddr_in</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">peer</span>)
204:     <span class="ruby-keyword kw">end</span>
205:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000326">
                    
                    <a name="M000326"></a><b>get_sock_opt</b>(signature, level, optname)
                    
                </div>
                
                <div class="description">
                  <p>
@private
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000326_source')" id="l_M000326_source">show</a>
                        
                    </p>
                    <div id="M000326_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/em/pure_ruby.rb, line 181</span>
181:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_sock_opt</span> <span class="ruby-identifier">signature</span>, <span class="ruby-identifier">level</span>, <span class="ruby-identifier">optname</span>
182:       <span class="ruby-identifier">selectable</span> = <span class="ruby-constant">Reactor</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">get_selectable</span>( <span class="ruby-identifier">signature</span> ) <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;unknown get_peername target&quot;</span>
183:       <span class="ruby-identifier">selectable</span>.<span class="ruby-identifier">getsockopt</span> <span class="ruby-identifier">level</span>, <span class="ruby-identifier">optname</span>
184:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000537">
                    
                    <a name="M000537"></a><b>heartbeat_interval</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Retrieve the heartbeat interval. This is how often <a
href="EventMachine.html">EventMachine</a> will check for dead connections
that have had an inactivity timeout set via {<a
href="EventMachine/Connection.html#M000069">Connection#set_comm_inactivity_timeout</a>}.
Default is 2 seconds.
</p>
<p>
@return [Integer] Heartbeat interval, in seconds
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000537_source')" id="l_M000537_source">show</a>
                        
                    </p>
                    <div id="M000537_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/eventmachine.rb, line 1362</span>
1362:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">heartbeat_interval</span>
1363:     <span class="ruby-constant">EM</span><span class="ruby-operator">::</span><span class="ruby-identifier">get_heartbeat_interval</span>
1364:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000538">
                    
                    <a name="M000538"></a><b>heartbeat_interval=</b>(time)
                    
                </div>
                
                <div class="description">
                  <p>
Set the heartbeat interval. This is how often <a
href="EventMachine.html">EventMachine</a> will check for dead connections
that have had an inactivity timeout set via {<a
href="EventMachine/Connection.html#M000069">Connection#set_comm_inactivity_timeout</a>}.
Takes a Numeric number of seconds. Default is 2.
</p>
<p>
@param [Integer] time Heartbeat interval, in seconds
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000538_source')" id="l_M000538_source">show</a>
                        
                    </p>
                    <div id="M000538_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/eventmachine.rb, line 1371</span>
1371:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">heartbeat_interval=</span>(<span class="ruby-identifier">time</span>)
1372:     <span class="ruby-constant">EM</span><span class="ruby-operator">::</span><span class="ruby-identifier">set_heartbeat_interval</span> <span class="ruby-identifier">time</span>.<span class="ruby-identifier">to_f</span>
1373:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000300">
                    
                    <a name="M000300"></a><b>initialize_event_machine</b>()
                    
                </div>
                
                <div class="description">
                  <p>
@private
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000300_source')" id="l_M000300_source">show</a>
                        
                    </p>
                    <div id="M000300_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/em/pure_ruby.rb, line 49</span>
49:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize_event_machine</span>
50:       <span class="ruby-constant">Reactor</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">initialize_for_run</span>
51:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000453">
                    
                    <a name="M000453"></a><b>initialize_event_machine</b>()
                    
                </div>
                
                <div class="description">
                  <p>
class <a href="EventMachine/Connection.html">Connection</a> <
com.rubyeventmachine.Connection
</p>
<pre>
  def associate_callback_target sig
    # No-op for the time being.
  end
</pre>
<p>
end
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000453_source')" id="l_M000453_source">show</a>
                        
                    </p>
                    <div id="M000453_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/jeventmachine.rb, line 101</span>
101:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">initialize_event_machine</span>
102:     <span class="ruby-ivar">@em</span> = <span class="ruby-constant">JEM</span>.<span class="ruby-identifier">new</span>
103:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000481">
                    
                    <a name="M000481"></a><b>invoke_popen</b>(cmd)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000481_source')" id="l_M000481_source">show</a>
                        
                    </p>
                    <div id="M000481_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/jeventmachine.rb, line 182</span>
182:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">invoke_popen</span> <span class="ruby-identifier">cmd</span>
183:     <span class="ruby-comment cmt"># TEMPORARILY unsupported until someone figures out how to do it.</span>
184:     <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;unsupported on this platform&quot;</span>
185:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000491">
                    
                    <a name="M000491"></a><b>is_notify_readable</b>(sig)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000491_source')" id="l_M000491_source">show</a>
                        
                    </p>
                    <div id="M000491_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/jeventmachine.rb, line 256</span>
256:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">is_notify_readable</span> <span class="ruby-identifier">sig</span>
257:     <span class="ruby-ivar">@em</span>.<span class="ruby-identifier">isNotifyReadable</span>(<span class="ruby-identifier">sig</span>)
258:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000492">
                    
                    <a name="M000492"></a><b>is_notify_writable</b>(sig)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000492_source')" id="l_M000492_source">show</a>
                        
                    </p>
                    <div id="M000492_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/jeventmachine.rb, line 259</span>
259:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">is_notify_writable</span> <span class="ruby-identifier">sig</span>
260:     <span class="ruby-ivar">@em</span>.<span class="ruby-identifier">isNotifyWritable</span>(<span class="ruby-identifier">sig</span>)
261:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000541">
                    
                    <a name="M000541"></a><b>klass_from_handler</b>(klass = Connection, handler = nil, *args)
                    
                </div>
                
                <div class="description">
                  <p>
@private
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000541_source')" id="l_M000541_source">show</a>
                        
                    </p>
                    <div id="M000541_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/eventmachine.rb, line 1459</span>
1459:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">klass_from_handler</span>(<span class="ruby-identifier">klass</span> = <span class="ruby-constant">Connection</span>, <span class="ruby-identifier">handler</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
1460:     <span class="ruby-identifier">klass</span> = <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">handler</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">handler</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Class</span>)
1461:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-node">&quot;must provide module or subclass of #{klass.name}&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">klass</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">handler</span>
1462:       <span class="ruby-identifier">handler</span>
1463:     <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">handler</span>
1464:       <span class="ruby-keyword kw">begin</span>
1465:         <span class="ruby-identifier">handler</span><span class="ruby-operator">::</span><span class="ruby-constant">EM_CONNECTION_CLASS</span>
1466:       <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">NameError</span>
1467:         <span class="ruby-identifier">handler</span><span class="ruby-operator">::</span><span class="ruby-identifier">const_set</span>(<span class="ruby-identifier">:EM_CONNECTION_CLASS</span>, <span class="ruby-constant">Class</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">klass</span>) {<span class="ruby-identifier">include</span> <span class="ruby-identifier">handler</span>})
1468:       <span class="ruby-keyword kw">end</span>
1469:     <span class="ruby-keyword kw">else</span>
1470:       <span class="ruby-identifier">klass</span>
1471:     <span class="ruby-keyword kw">end</span>
1472: 
1473:     <span class="ruby-identifier">arity</span> = <span class="ruby-identifier">klass</span>.<span class="ruby-identifier">instance_method</span>(<span class="ruby-identifier">:initialize</span>).<span class="ruby-identifier">arity</span>
1474:     <span class="ruby-identifier">expected</span> = <span class="ruby-identifier">arity</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">0</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">arity</span> <span class="ruby-operator">:</span> <span class="ruby-operator">-</span>(<span class="ruby-identifier">arity</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>)
1475:     <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">arity</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">0</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">expected</span>) <span class="ruby-keyword kw">or</span> (<span class="ruby-identifier">arity</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">0</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">expected</span>)
1476:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-node">&quot;wrong number of arguments for #{klass}#initialize (#{args.size} for #{expected})&quot;</span>
1477:     <span class="ruby-keyword kw">end</span>
1478: 
1479:     <span class="ruby-identifier">klass</span>
1480:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000475">
                    
                    <a name="M000475"></a><b>kqueue</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000475_source')" id="l_M000475_source">show</a>
                        
                    </p>
                    <div id="M000475_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/jeventmachine.rb, line 166</span>
166:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">kqueue</span>
167:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000476">
                    
                    <a name="M000476"></a><b>kqueue=</b>(val)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000476_source')" id="l_M000476_source">show</a>
                        
                    </p>
                    <div id="M000476_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/jeventmachine.rb, line 168</span>
168:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">kqueue=</span> <span class="ruby-identifier">val</span>
169:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000478">
                    
                    <a name="M000478"></a><b>kqueue?</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000478_source')" id="l_M000478_source">show</a>
                        
                    </p>
                    <div id="M000478_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/jeventmachine.rb, line 173</span>
173:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">kqueue?</span>
174:     <span class="ruby-keyword kw">false</span>
175:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000299">
                    
                    <a name="M000299"></a><b>library_type</b>()
                    
                </div>
                
                <div class="description">
                  <p>
This is mostly useful for automated tests. Return a distinctive symbol so
the caller knows whether he&#8217;s dealing with an extension or with a
pure-Ruby library. @private
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000299_source')" id="l_M000299_source">show</a>
                        
                    </p>
                    <div id="M000299_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/em/pure_ruby.rb, line 44</span>
44:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">library_type</span>
45:       <span class="ruby-identifier">:pure_ruby</span>
46:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000485">
                    
                    <a name="M000485"></a><b>library_type</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000485_source')" id="l_M000485_source">show</a>
                        
                    </p>
                    <div id="M000485_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/jeventmachine.rb, line 198</span>
198:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">library_type</span>
199:     <span class="ruby-identifier">:java</span>
200:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000526">
                    
                    <a name="M000526"></a><b>next_tick</b>(pr=nil, &amp;block)
                    
                </div>
                
                <div class="description">
                  <p>
Schedules a proc for execution immediately after the next
&#8220;turn&#8221; through the reactor core. An advanced technique, this
can be useful for improving memory management and/or application
responsiveness, especially when scheduling large amounts of data for
writing to a network connection.
</p>
<p>
This method takes either a single argument (which must be a callable
object) or a block.
</p>
<p>
@param [call] pr A callable object to run
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000526_source')" id="l_M000526_source">show</a>
                        
                    </p>
                    <div id="M000526_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/eventmachine.rb, line 1039</span>
1039:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">next_tick</span> <span class="ruby-identifier">pr</span>=<span class="ruby-keyword kw">nil</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>
1040:     <span class="ruby-comment cmt"># This works by adding to the @resultqueue that's used for #defer.</span>
1041:     <span class="ruby-comment cmt"># The general idea is that next_tick is used when we want to give the reactor a chance</span>
1042:     <span class="ruby-comment cmt"># to let other operations run, either to balance the load out more evenly, or to let</span>
1043:     <span class="ruby-comment cmt"># outbound network buffers drain, or both. So we probably do NOT want to block, and</span>
1044:     <span class="ruby-comment cmt"># we probably do NOT want to be spinning any threads. A program that uses next_tick</span>
1045:     <span class="ruby-comment cmt"># but not #defer shouldn't suffer the penalty of having Ruby threads running. They're</span>
1046:     <span class="ruby-comment cmt"># extremely expensive even if they're just sleeping.</span>
1047: 
1048:     <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-value str">&quot;no proc or block given&quot;</span> <span class="ruby-keyword kw">unless</span> ((<span class="ruby-identifier">pr</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">pr</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:call</span>)) <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">block</span>)
1049:     <span class="ruby-ivar">@next_tick_mutex</span>.<span class="ruby-identifier">synchronize</span> <span class="ruby-keyword kw">do</span>
1050:       <span class="ruby-ivar">@next_tick_queue</span> <span class="ruby-operator">&lt;&lt;</span> ( <span class="ruby-identifier">pr</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">block</span> )
1051:     <span class="ruby-keyword kw">end</span>
1052:     <span class="ruby-identifier">signal_loopbreak</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">reactor_running?</span>
1053:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000518">
                    
                    <a name="M000518"></a><b>open_datagram_socket</b>(address, port, handler=nil, *args)
                    
                </div>
                
                <div class="description">
                  <p>
Used for UDP-based protocols. Its usage is similar to that of {<a
href="EventMachine.html#M000508">EventMachine.start_server</a>}.
</p>
<p>
This method will create a new UDP (datagram) socket and bind it to the
address and port that you specify. The normal callbacks (see {<a
href="EventMachine.html#M000508">EventMachine.start_server</a>}) will be
called as events of interest occur on the newly-created socket, but there
are some differences in how they behave.
</p>
<p>
{<a
href="EventMachine/Connection.html#M000035">Connection#receive_data</a>}
will be called when a datagram packet is received on the socket, but unlike
TCP sockets, the message boundaries of the received data will be respected.
In other words, if the remote peer sent you a datagram of a particular
size, you may rely on {<a
href="EventMachine/Connection.html#M000035">Connection#receive_data</a>} to
give you the exact data in the packet, with the original data length. Also
observe that <a
href="EventMachine/Connection.html#M000035">Connection#receive_data</a> may
be called with a <b>zero-length</b> data payload, since empty datagrams are
permitted in UDP.
</p>
<p>
{<a href="EventMachine/Connection.html#M000048">Connection#send_data</a>}
is available with UDP packets as with TCP, but there is an important
difference. Because UDP communications are <b>connectionless</b>, there is
no implicit recipient for the packets you send. Ordinarily you must specify
the recipient for each packet you send. However, <a
href="EventMachine.html">EventMachine</a> provides for the typical pattern
of receiving a UDP datagram from a remote peer, performing some operation,
and then sending one or more packets in response to the same remote peer.
To support this model easily, just use {<a
href="EventMachine/Connection.html#M000048">Connection#send_data</a>} in
the code that you supply for {<a
href="EventMachine/Connection.html#M000035">Connection#receive_data</a>}.
</p>
<p>
<a href="EventMachine.html">EventMachine</a> will provide an implicit
return address for any messages sent to {<a
href="EventMachine/Connection.html#M000048">Connection#send_data</a>}
within the context of a {<a
href="EventMachine/Connection.html#M000035">Connection#receive_data</a>}
callback, and your response will automatically go to the correct remote
peer.
</p>
<p>
Observe that the port number that you supply to {<a
href="EventMachine.html#M000518">EventMachine.open_datagram_socket</a>} may
be zero. In this case, <a href="EventMachine.html">EventMachine</a> will
create a UDP socket that is bound to an [ephemeral port](<a
href="http://en.wikipedia.org/wiki/Ephemeral_port">en.wikipedia.org/wiki/Ephemeral_port</a>).
This is not appropriate for servers that must publish a well-known port to
which remote peers may send datagrams. But it can be useful for clients
that send datagrams to other servers. If you do this, you will receive any
responses from the remote servers through the normal {<a
href="EventMachine/Connection.html#M000035">Connection#receive_data</a>}
callback. Observe that you will probably have issues with firewalls
blocking the ephemeral port numbers, so this technique is most appropriate
for LANs.
</p>
<p>
If you wish to send datagrams to arbitrary remote peers (not necessarily
ones that have sent data to which you are responding), then see {<a
href="EventMachine/Connection.html#M000057">Connection#send_datagram</a>}.
</p>
<p>
DO NOT call <a href="EventMachine.html#M000309">send_data</a> from a
datagram socket outside of a {<a
href="EventMachine/Connection.html#M000035">Connection#receive_data</a>}
method. Use {<a
href="EventMachine/Connection.html#M000057">Connection#send_datagram</a>}.
If you do use {<a
href="EventMachine/Connection.html#M000048">Connection#send_data</a>}
outside of a {<a
href="EventMachine/Connection.html#M000035">Connection#receive_data</a>}
method, you&#8217;ll get a confusing error because there is no
&#8220;peer,&#8221; as <a href="EventMachine.html#M000309">send_data</a>
requires (inside of {<a
href="EventMachine/Connection.html#M000035">EventMachine::Connection#receive_data</a>},
{<a
href="EventMachine/Connection.html#M000048">EventMachine::Connection#send_data</a>}
&#8220;fakes&#8221; the peer as described above).
</p>
<p>
@param [String] address IP address @param [String] port Port @param [Class,
Module] handler A class or a module that implements connection lifecycle
callbacks.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000518_source')" id="l_M000518_source">show</a>
                        
                    </p>
                    <div id="M000518_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/eventmachine.rb, line 838</span>
838:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">open_datagram_socket</span> <span class="ruby-identifier">address</span>, <span class="ruby-identifier">port</span>, <span class="ruby-identifier">handler</span>=<span class="ruby-keyword kw">nil</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>
839:     <span class="ruby-comment cmt"># Replaced the implementation on 01Oct06. Thanks to Tobias Gustafsson for pointing</span>
840:     <span class="ruby-comment cmt"># out that this originally did not take a class but only a module.</span>
841: 
842: 
843:     <span class="ruby-identifier">klass</span> = <span class="ruby-identifier">klass_from_handler</span>(<span class="ruby-constant">Connection</span>, <span class="ruby-identifier">handler</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
844:     <span class="ruby-identifier">s</span> = <span class="ruby-identifier">open_udp_socket</span> <span class="ruby-identifier">address</span>, <span class="ruby-identifier">port</span>.<span class="ruby-identifier">to_i</span>
845:     <span class="ruby-identifier">c</span> = <span class="ruby-identifier">klass</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">s</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>
846:     <span class="ruby-ivar">@conns</span>[<span class="ruby-identifier">s</span>] = <span class="ruby-identifier">c</span>
847:     <span class="ruby-identifier">block_given?</span> <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">yield</span> <span class="ruby-identifier">c</span>
848:     <span class="ruby-identifier">c</span>
849:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000531">
                    
                    <a name="M000531"></a><b>open_keyboard</b>(handler=nil, *args)
                    
                </div>
                
                <div class="description">
                  <p>
(Experimental)
</p>
<p>
@private
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000531_source')" id="l_M000531_source">show</a>
                        
                    </p>
                    <div id="M000531_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/eventmachine.rb, line 1148</span>
1148:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">open_keyboard</span> <span class="ruby-identifier">handler</span>=<span class="ruby-keyword kw">nil</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>
1149:     <span class="ruby-identifier">klass</span> = <span class="ruby-identifier">klass_from_handler</span>(<span class="ruby-constant">Connection</span>, <span class="ruby-identifier">handler</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
1150: 
1151:     <span class="ruby-identifier">s</span> = <span class="ruby-identifier">read_keyboard</span>
1152:     <span class="ruby-identifier">c</span> = <span class="ruby-identifier">klass</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">s</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>
1153:     <span class="ruby-ivar">@conns</span>[<span class="ruby-identifier">s</span>] = <span class="ruby-identifier">c</span>
1154:     <span class="ruby-identifier">block_given?</span> <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">yield</span> <span class="ruby-identifier">c</span>
1155:     <span class="ruby-identifier">c</span>
1156:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000480">
                    
                    <a name="M000480"></a><b>open_udp_socket</b>(server, port)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000480_source')" id="l_M000480_source">show</a>
                        
                    </p>
                    <div id="M000480_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/jeventmachine.rb, line 179</span>
179:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">open_udp_socket</span> <span class="ruby-identifier">server</span>, <span class="ruby-identifier">port</span>
180:     <span class="ruby-ivar">@em</span>.<span class="ruby-identifier">openUdpSocket</span> <span class="ruby-identifier">server</span>, <span class="ruby-identifier">port</span>
181:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000317">
                    
                    <a name="M000317"></a><b>open_udp_socket</b>(host, port)
                    
                </div>
                
                <div class="description">
                  <p>
@private
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000317_source')" id="l_M000317_source">show</a>
                        
                    </p>
                    <div id="M000317_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/em/pure_ruby.rb, line 135</span>
135:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">open_udp_socket</span> <span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>
136:       <span class="ruby-constant">EvmaUDPSocket</span>.<span class="ruby-identifier">create</span>(<span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>).<span class="ruby-identifier">uuid</span>
137:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000529">
                    
                    <a name="M000529"></a><b>popen</b>(cmd, handler=nil, *args)
                    
                </div>
                
                <div class="description">
                  <p>
Runs an external process.
</p>
<p>
@example
</p>
<pre>
 module RubyCounter
   def post_init
     # count up to 5
     send_data &quot;5\n&quot;
   end
   def receive_data data
     puts &quot;ruby sent me: #{data}&quot;
   end
   def unbind
     puts &quot;ruby died with exit status: #{get_status.exitstatus}&quot;
   end
 end

 EventMachine.run {
   EventMachine.popen(&quot;ruby -e' $stdout.sync = true; gets.to_i.times{ |i| puts i+1; sleep 1 } '&quot;, RubyCounter)
 }
</pre>
<p>
@note This method is not supported on Microsoft Windows @see <a
href="EventMachine/DeferrableChildProcess.html">EventMachine::DeferrableChildProcess</a>
@see <a href="EventMachine.html#M000125">EventMachine.system</a>
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000529_source')" id="l_M000529_source">show</a>
                        
                    </p>
                    <div id="M000529_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/eventmachine.rb, line 1116</span>
1116:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">popen</span> <span class="ruby-identifier">cmd</span>, <span class="ruby-identifier">handler</span>=<span class="ruby-keyword kw">nil</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>
1117:     <span class="ruby-comment cmt"># At this moment, it's only available on Unix.</span>
1118:     <span class="ruby-comment cmt"># Perhaps misnamed since the underlying function uses socketpair and is full-duplex.</span>
1119: 
1120:     <span class="ruby-identifier">klass</span> = <span class="ruby-identifier">klass_from_handler</span>(<span class="ruby-constant">Connection</span>, <span class="ruby-identifier">handler</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
1121:     <span class="ruby-identifier">w</span> = <span class="ruby-constant">Shellwords</span><span class="ruby-operator">::</span><span class="ruby-identifier">shellwords</span>( <span class="ruby-identifier">cmd</span> )
1122:     <span class="ruby-identifier">w</span>.<span class="ruby-identifier">unshift</span>( <span class="ruby-identifier">w</span>.<span class="ruby-identifier">first</span> ) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">w</span>.<span class="ruby-identifier">first</span>
1123:     <span class="ruby-identifier">s</span> = <span class="ruby-identifier">invoke_popen</span>( <span class="ruby-identifier">w</span> )
1124:     <span class="ruby-identifier">c</span> = <span class="ruby-identifier">klass</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">s</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>
1125:     <span class="ruby-ivar">@conns</span>[<span class="ruby-identifier">s</span>] = <span class="ruby-identifier">c</span>
1126:     <span class="ruby-keyword kw">yield</span>(<span class="ruby-identifier">c</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block_given?</span>
1127:     <span class="ruby-identifier">c</span>
1128:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000530">
                    
                    <a name="M000530"></a><b>reactor_running?</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Tells you whether the <a href="EventMachine.html">EventMachine</a> reactor
loop is currently running.
</p>
<p>
Useful when writing libraries that want to run event-driven code, but may
be running in programs that are already event-driven. In such cases, if {<a
href="EventMachine.html#M000530">EventMachine.reactor_running?</a>} returns
false, your code can invoke {<a
href="EventMachine.html#M000498">EventMachine.run</a>} and run your
application code inside the block passed to that method. If this method
returns true, just execute your event-aware code.
</p>
<p>
@return [Boolean] true if the <a href="EventMachine.html">EventMachine</a>
reactor loop is currently running
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000530_source')" id="l_M000530_source">show</a>
                        
                    </p>
                    <div id="M000530_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/eventmachine.rb, line 1140</span>
1140:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">reactor_running?</span>
1141:     (<span class="ruby-ivar">@reactor_running</span> <span class="ruby-operator">||</span> <span class="ruby-keyword kw">false</span>)
1142:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000500">
                    
                    <a name="M000500"></a><b>reactor_thread?</b>()
                    
                </div>
                
                <div class="description">
                  <p>
@return [Boolean] true if the calling thread is the same thread as the
reactor.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000500_source')" id="l_M000500_source">show</a>
                        
                    </p>
                    <div id="M000500_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/eventmachine.rb, line 230</span>
230:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">reactor_thread?</span>
231:     <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span> <span class="ruby-operator">==</span> <span class="ruby-ivar">@reactor_thread</span>
232:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000482">
                    
                    <a name="M000482"></a><b>read_keyboard</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000482_source')" id="l_M000482_source">show</a>
                        
                    </p>
                    <div id="M000482_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/jeventmachine.rb, line 186</span>
186:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">read_keyboard</span>
187:     <span class="ruby-comment cmt"># TEMPORARILY unsupported until someone figures out how to do it.</span>
188:     <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;temporarily unsupported on this platform&quot;</span>
189:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000339">
                    
                    <a name="M000339"></a><b>read_keyboard</b>()
                    
                </div>
                
                <div class="description">
                  <p>
@private
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000339_source')" id="l_M000339_source">show</a>
                        
                    </p>
                    <div id="M000339_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/em/pure_ruby.rb, line 212</span>
212:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">read_keyboard</span>
213:       <span class="ruby-constant">EvmaKeyboard</span>.<span class="ruby-identifier">open</span>.<span class="ruby-identifier">uuid</span>
214:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000516">
                    
                    <a name="M000516"></a><b>reconnect</b>(server, port, handler)
                    
                </div>
                
                <div class="description">
                  <p>
Connect to a given host/port and re-use the provided
{EventMachine::Connection} instance. Consider also {<a
href="EventMachine/Connection.html#M000075">EventMachine::Connection#reconnect</a>}.
</p>
<p>
@see <a
href="EventMachine/Connection.html#M000075">EventMachine::Connection#reconnect</a>
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000516_source')" id="l_M000516_source">show</a>
                        
                    </p>
                    <div id="M000516_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/eventmachine.rb, line 751</span>
751:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">reconnect</span> <span class="ruby-identifier">server</span>, <span class="ruby-identifier">port</span>, <span class="ruby-identifier">handler</span>
752:     <span class="ruby-comment cmt"># Observe, the test for already-connected FAILS if we call a reconnect inside post_init,</span>
753:     <span class="ruby-comment cmt"># because we haven't set up the connection in @conns by that point.</span>
754:     <span class="ruby-comment cmt"># RESIST THE TEMPTATION to &quot;fix&quot; this problem by redefining the behavior of post_init.</span>
755:     <span class="ruby-comment cmt">#</span>
756:     <span class="ruby-comment cmt"># Changed 22Nov06: if called on an already-connected handler, just return the</span>
757:     <span class="ruby-comment cmt"># handler and do nothing more. Originally this condition raised an exception.</span>
758:     <span class="ruby-comment cmt"># We may want to change it yet again and call the block, if any.</span>
759: 
760:     <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;invalid handler&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">handler</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:connection_completed</span>)
761:     <span class="ruby-comment cmt">#raise &quot;still connected&quot; if @conns.has_key?(handler.signature)</span>
762:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">handler</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@conns</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">handler</span>.<span class="ruby-identifier">signature</span>)
763: 
764:     <span class="ruby-identifier">s</span> = <span class="ruby-identifier">connect_server</span> <span class="ruby-identifier">server</span>, <span class="ruby-identifier">port</span>
765:     <span class="ruby-identifier">handler</span>.<span class="ruby-identifier">signature</span> = <span class="ruby-identifier">s</span>
766:     <span class="ruby-ivar">@conns</span>[<span class="ruby-identifier">s</span>] = <span class="ruby-identifier">handler</span>
767:     <span class="ruby-identifier">block_given?</span> <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">yield</span> <span class="ruby-identifier">handler</span>
768:     <span class="ruby-identifier">handler</span>
769:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000454">
                    
                    <a name="M000454"></a><b>release_machine</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000454_source')" id="l_M000454_source">show</a>
                        
                    </p>
                    <div id="M000454_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/jeventmachine.rb, line 104</span>
104:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">release_machine</span>
105:     <span class="ruby-ivar">@em</span> = <span class="ruby-keyword kw">nil</span>
106:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000303">
                    
                    <a name="M000303"></a><b>release_machine</b>()
                    
                </div>
                
                <div class="description">
                  <p>
@private
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000303_source')" id="l_M000303_source">show</a>
                        
                    </p>
                    <div id="M000303_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/em/pure_ruby.rb, line 66</span>
66:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">release_machine</span>
67:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000498">
                    
                    <a name="M000498"></a><b>run</b>(blk=nil, tail=nil, &amp;block)
                    
                </div>
                
                <div class="description">
                  <p>
Initializes and runs an event loop. This method only returns if code inside
the block passed to this method calls {<a
href="EventMachine.html#M000507">EventMachine.stop_event_loop</a>}. The
block is executed after initializing its internal event loop but
<b>before</b> running the loop, therefore this block is the right place to
call any code that needs event loop to run, for example, {<a
href="EventMachine.html#M000508">EventMachine.start_server</a>}, {<a
href="EventMachine.html#M000511">EventMachine.connect</a>} or similar
methods of libraries that use <a href="EventMachine.html">EventMachine</a>
under the hood (like `EventMachine::HttpRequest.new` or `AMQP.start`).
</p>
<p>
Programs that are run for long periods of time (e.g. servers) usually start
event loop by calling {<a
href="EventMachine.html#M000498">EventMachine.run</a>}, and let it run
&#8220;forever&#8221;. It&#8217;s also possible to use {<a
href="EventMachine.html#M000498">EventMachine.run</a>} to make a single
client-connection to a remote server, process the data flow from that
single connection, and then call {<a
href="EventMachine.html#M000507">EventMachine.stop_event_loop</a>} to stop,
in other words, to run event loop for a short period of time (necessary to
complete some operation) and then shut it down.
</p>
<p>
Once event loop is running, it is perfectly possible to start multiple
servers and clients simultaneously: content-aware proxies like
[Proxymachine](<a
href="https://github.com/mojombo/proxymachine">github.com/mojombo/proxymachine</a>)
do just that.
</p>
<p>
## Using <a href="EventMachine.html">EventMachine</a> with Ruby on Rails
and other Web application frameworks ##
</p>
<p>
Standalone applications often run event loop on the main thread, thus
blocking for their entire lifespan. In case of Web applications, if you are
running an EventMachine-based app server such as [Thin](<a
href="http://code.macournoyer.com/thin/">code.macournoyer.com/thin/</a>) or
[Goliath](<a
href="https://github.com/postrank-labs/goliath/">github.com/postrank-labs/goliath/</a>),
they start event loop for you. Servers like Unicorn, Apache Passenger or
Mongrel occupy main Ruby thread to serve HTTP(S) requests. This means that
calling {<a href="EventMachine.html#M000498">EventMachine.run</a>} on the
same thread is not an option (it will result in Web server never binding to
the socket). In that case, start event loop in a separate thread as
demonstrated below.
</p>
<p>
@example Starting <a href="EventMachine.html">EventMachine</a> event loop
in the current thread to run the &#8220;Hello, world&#8221;-like Echo
server example
</p>
<pre>
  #!/usr/bin/env ruby

  require 'rubygems' # or use Bundler.setup
  require 'eventmachine'

  class EchoServer &lt; EM::Connection
    def receive_data(data)
      send_data(data)
    end
  end

  EventMachine.run do
    EventMachine.start_server(&quot;0.0.0.0&quot;, 10000, EchoServer)
  end
</pre>
<p>
@example Starting <a href="EventMachine.html">EventMachine</a> event loop
in a separate thread
</p>
<pre>
  # doesn't block current thread, can be used with Ruby on Rails, Sinatra, Merb, Rack
  # and any other application server that occupies main Ruby thread.
  Thread.new { EventMachine.run }
</pre>
<p>
@note This method blocks calling thread. If you need to start <a
href="EventMachine.html">EventMachine</a> event loop from a Web app
</p>
<pre>
      running on a non event-driven server (Unicorn, Apache Passenger, Mongrel), do it in a separate thread like demonstrated
      in one of the examples.
</pre>
<p>
@see file:<a
href="../files/docs/GettingStarted_md.html">docs/GettingStarted.md</a>
Getting started with <a href="EventMachine.html">EventMachine</a> @see <a
href="EventMachine.html#M000507">EventMachine.stop_event_loop</a>
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000498_source')" id="l_M000498_source">show</a>
                        
                    </p>
                    <div id="M000498_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/eventmachine.rb, line 148</span>
148:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">run</span> <span class="ruby-identifier">blk</span>=<span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">tail</span>=<span class="ruby-keyword kw">nil</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>
149:     <span class="ruby-comment cmt"># Obsoleted the use_threads mechanism.</span>
150:     <span class="ruby-comment cmt"># 25Nov06: Added the begin/ensure block. We need to be sure that release_machine</span>
151:     <span class="ruby-comment cmt"># gets called even if an exception gets thrown within any of the user code</span>
152:     <span class="ruby-comment cmt"># that the event loop runs. The best way to see this is to run a unit</span>
153:     <span class="ruby-comment cmt"># test with two functions, each of which calls {EventMachine.run} and each of</span>
154:     <span class="ruby-comment cmt"># which throws something inside of #run. Without the ensure, the second test</span>
155:     <span class="ruby-comment cmt"># will start without release_machine being called and will immediately throw</span>
156: 
157:     <span class="ruby-comment cmt">#</span>
158: 
159: 
160:     <span class="ruby-identifier">tail</span> <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@tails</span>.<span class="ruby-identifier">unshift</span>(<span class="ruby-identifier">tail</span>)
161: 
162:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">reactor_running?</span>
163:       (<span class="ruby-identifier">b</span> = <span class="ruby-identifier">blk</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">block</span>) <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">call</span> <span class="ruby-comment cmt"># next_tick(b)</span>
164:     <span class="ruby-keyword kw">else</span>
165:       <span class="ruby-ivar">@conns</span> = {}
166:       <span class="ruby-ivar">@acceptors</span> = {}
167:       <span class="ruby-ivar">@timers</span> = {}
168:       <span class="ruby-ivar">@wrapped_exception</span> = <span class="ruby-keyword kw">nil</span>
169:       <span class="ruby-ivar">@next_tick_queue</span> <span class="ruby-operator">||=</span> []
170:       <span class="ruby-ivar">@tails</span> <span class="ruby-operator">||=</span> []
171:       <span class="ruby-keyword kw">begin</span>
172:         <span class="ruby-ivar">@reactor_running</span> = <span class="ruby-keyword kw">true</span>
173:         <span class="ruby-identifier">initialize_event_machine</span>
174:         (<span class="ruby-identifier">b</span> = <span class="ruby-identifier">blk</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">block</span>) <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">add_timer</span>(<span class="ruby-value">0</span>, <span class="ruby-identifier">b</span>)
175:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@next_tick_queue</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@next_tick_queue</span>.<span class="ruby-identifier">empty?</span>
176:           <span class="ruby-identifier">add_timer</span>(<span class="ruby-value">0</span>) { <span class="ruby-identifier">signal_loopbreak</span> }
177:         <span class="ruby-keyword kw">end</span>
178:         <span class="ruby-ivar">@reactor_thread</span> = <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span>
179:         <span class="ruby-identifier">run_machine</span>
180:       <span class="ruby-keyword kw">ensure</span>
181:         <span class="ruby-keyword kw">until</span> <span class="ruby-ivar">@tails</span>.<span class="ruby-identifier">empty?</span>
182:           <span class="ruby-ivar">@tails</span>.<span class="ruby-identifier">pop</span>.<span class="ruby-identifier">call</span>
183:         <span class="ruby-keyword kw">end</span>
184: 
185:         <span class="ruby-keyword kw">begin</span>
186:           <span class="ruby-identifier">release_machine</span>
187:         <span class="ruby-keyword kw">ensure</span>
188:           <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@threadpool</span>
189:             <span class="ruby-ivar">@threadpool</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span> <span class="ruby-identifier">t</span>.<span class="ruby-identifier">exit</span> }
190:             <span class="ruby-ivar">@threadpool</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
191:               <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">t</span>.<span class="ruby-identifier">alive?</span>
192:               <span class="ruby-keyword kw">begin</span>
193:                 <span class="ruby-comment cmt"># Thread#kill! does not exist on 1.9 or rbx, and raises</span>
194:                 <span class="ruby-comment cmt"># NotImplemented on jruby</span>
195:                 <span class="ruby-identifier">t</span>.<span class="ruby-identifier">kill!</span>
196:               <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">NoMethodError</span>, <span class="ruby-constant">NotImplementedError</span>
197:                 <span class="ruby-identifier">t</span>.<span class="ruby-identifier">kill</span>
198:                 <span class="ruby-comment cmt"># XXX t.join here?</span>
199:               <span class="ruby-keyword kw">end</span>
200:             <span class="ruby-keyword kw">end</span>
201:             <span class="ruby-ivar">@threadqueue</span> = <span class="ruby-keyword kw">nil</span>
202:             <span class="ruby-ivar">@resultqueue</span> = <span class="ruby-keyword kw">nil</span>
203:             <span class="ruby-ivar">@threadpool</span> = <span class="ruby-keyword kw">nil</span>
204:           <span class="ruby-keyword kw">end</span>
205: 
206:           <span class="ruby-ivar">@next_tick_queue</span> = []
207:         <span class="ruby-keyword kw">end</span>
208:         <span class="ruby-ivar">@reactor_running</span> = <span class="ruby-keyword kw">false</span>
209:         <span class="ruby-ivar">@reactor_thread</span> = <span class="ruby-keyword kw">nil</span>
210:       <span class="ruby-keyword kw">end</span>
211: 
212:       <span class="ruby-identifier">raise</span> <span class="ruby-ivar">@wrapped_exception</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@wrapped_exception</span>
213:     <span class="ruby-keyword kw">end</span>
214:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000499">
                    
                    <a name="M000499"></a><b>run_block</b>(&amp;block)
                    
                </div>
                
                <div class="description">
                  <p>
Sugars a common use case. Will pass the given block to <a
href="EventMachine.html#M000498">run</a>, but will terminate the reactor
loop and exit the function as soon as the code in the block completes.
(Normally, {<a href="EventMachine.html#M000498">EventMachine.run</a>} keeps
running indefinitely, even after the block supplied to it finishes running,
until user code calls {<a
href="EventMachine.html#M000304">EventMachine.stop</a>})
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000499_source')" id="l_M000499_source">show</a>
                        
                    </p>
                    <div id="M000499_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/eventmachine.rb, line 221</span>
221:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">run_block</span> <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>
222:     <span class="ruby-identifier">pr</span> = <span class="ruby-identifier">proc</span> {
223:       <span class="ruby-identifier">block</span>.<span class="ruby-identifier">call</span>
224:       <span class="ruby-constant">EventMachine</span><span class="ruby-operator">::</span><span class="ruby-identifier">stop</span>
225:     }
226:     <span class="ruby-identifier">run</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">pr</span>)
227:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000523">
                    
                    <a name="M000523"></a><b>run_deferred_callbacks</b>()
                    
                </div>
                
                <div class="description">
                  <p>
The is the responder for the loopback-signalled event. It can be fired
either by code running on a separate thread ({<a
href="EventMachine.html#M000524">EventMachine.defer</a>}) or on the main
thread ({<a href="EventMachine.html#M000526">EventMachine.next_tick</a>}).
It will often happen that a <a
href="EventMachine.html#M000526">next_tick</a> handler will reschedule
itself. We consume a copy of the tick queue so that tick events scheduled
by tick events have to wait for the next pass through the reactor core.
</p>
<p>
@private
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000523_source')" id="l_M000523_source">show</a>
                        
                    </p>
                    <div id="M000523_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/eventmachine.rb, line 933</span>
933:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">run_deferred_callbacks</span>
934:     <span class="ruby-keyword kw">until</span> (<span class="ruby-ivar">@resultqueue</span> <span class="ruby-operator">||=</span> []).<span class="ruby-identifier">empty?</span>
935:       <span class="ruby-identifier">result</span>,<span class="ruby-identifier">cback</span> = <span class="ruby-ivar">@resultqueue</span>.<span class="ruby-identifier">pop</span>
936:       <span class="ruby-identifier">cback</span>.<span class="ruby-identifier">call</span> <span class="ruby-identifier">result</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">cback</span>
937:     <span class="ruby-keyword kw">end</span>
938: 
939:     <span class="ruby-ivar">@next_tick_mutex</span>.<span class="ruby-identifier">synchronize</span> <span class="ruby-keyword kw">do</span>
940:       <span class="ruby-identifier">jobs</span>, <span class="ruby-ivar">@next_tick_queue</span> = <span class="ruby-ivar">@next_tick_queue</span>, []
941:       <span class="ruby-identifier">jobs</span>
942:     <span class="ruby-keyword kw">end</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">j</span><span class="ruby-operator">|</span> <span class="ruby-identifier">j</span>.<span class="ruby-identifier">call</span> }
943:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000302">
                    
                    <a name="M000302"></a><b>run_machine</b>()
                    
                </div>
                
                <div class="description">
                  <p>
@private
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000302_source')" id="l_M000302_source">show</a>
                        
                    </p>
                    <div id="M000302_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/em/pure_ruby.rb, line 61</span>
61:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">run_machine</span>
62:       <span class="ruby-constant">Reactor</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">run</span>
63:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000456">
                    
                    <a name="M000456"></a><b>run_machine</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000456_source')" id="l_M000456_source">show</a>
                        
                    </p>
                    <div id="M000456_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/jeventmachine.rb, line 110</span>
110:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">run_machine</span>
111:     <span class="ruby-ivar">@em</span>.<span class="ruby-identifier">run</span>
112:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000501">
                    
                    <a name="M000501"></a><b>schedule</b>(*a, &amp;b)
                    
                </div>
                
                <div class="description">
                  <p>
Runs the given callback on the reactor thread, or immediately if called
from the reactor thread. Accepts the same arguments as
{EventMachine::Callback}
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000501_source')" id="l_M000501_source">show</a>
                        
                    </p>
                    <div id="M000501_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/eventmachine.rb, line 236</span>
236:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">schedule</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">a</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">b</span>)
237:     <span class="ruby-identifier">cb</span> = <span class="ruby-constant">Callback</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">a</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">b</span>)
238:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">reactor_running?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">reactor_thread?</span>
239:       <span class="ruby-identifier">cb</span>.<span class="ruby-identifier">call</span>
240:     <span class="ruby-keyword kw">else</span>
241:       <span class="ruby-identifier">next_tick</span> { <span class="ruby-identifier">cb</span>.<span class="ruby-identifier">call</span> }
242:     <span class="ruby-keyword kw">end</span>
243:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000309">
                    
                    <a name="M000309"></a><b>send_data</b>(target, data, datalength)
                    
                </div>
                
                <div class="description">
                  <p>
@private
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000309_source')" id="l_M000309_source">show</a>
                        
                    </p>
                    <div id="M000309_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/em/pure_ruby.rb, line 85</span>
85:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">send_data</span> <span class="ruby-identifier">target</span>, <span class="ruby-identifier">data</span>, <span class="ruby-identifier">datalength</span>
86:       <span class="ruby-identifier">selectable</span> = <span class="ruby-constant">Reactor</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">get_selectable</span>( <span class="ruby-identifier">target</span> ) <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;unknown send_data target&quot;</span>
87:       <span class="ruby-identifier">selectable</span>.<span class="ruby-identifier">send_data</span> <span class="ruby-identifier">data</span>
88:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000461">
                    
                    <a name="M000461"></a><b>send_data</b>(sig, data, length)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000461_source')" id="l_M000461_source">show</a>
                        
                    </p>
                    <div id="M000461_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/jeventmachine.rb, line 126</span>
126:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">send_data</span> <span class="ruby-identifier">sig</span>, <span class="ruby-identifier">data</span>, <span class="ruby-identifier">length</span>
127:     <span class="ruby-ivar">@em</span>.<span class="ruby-identifier">sendData</span> <span class="ruby-identifier">sig</span>, <span class="ruby-identifier">data</span>.<span class="ruby-identifier">to_java_bytes</span>
128:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000462">
                    
                    <a name="M000462"></a><b>send_datagram</b>(sig, data, length, address, port)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000462_source')" id="l_M000462_source">show</a>
                        
                    </p>
                    <div id="M000462_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/jeventmachine.rb, line 129</span>
129:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">send_datagram</span> <span class="ruby-identifier">sig</span>, <span class="ruby-identifier">data</span>, <span class="ruby-identifier">length</span>, <span class="ruby-identifier">address</span>, <span class="ruby-identifier">port</span>
130:     <span class="ruby-ivar">@em</span>.<span class="ruby-identifier">sendDatagram</span> <span class="ruby-identifier">sig</span>, <span class="ruby-identifier">data</span>.<span class="ruby-identifier">to_java_bytes</span>, <span class="ruby-identifier">length</span>, <span class="ruby-identifier">address</span>, <span class="ruby-identifier">port</span>
131:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000318">
                    
                    <a name="M000318"></a><b>send_datagram</b>(target, data, datalength, host, port)
                    
                </div>
                
                <div class="description">
                  <p>
This is currently only for UDP! We need to make it work with unix-domain
sockets as well. @private
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000318_source')" id="l_M000318_source">show</a>
                        
                    </p>
                    <div id="M000318_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/em/pure_ruby.rb, line 142</span>
142:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">send_datagram</span> <span class="ruby-identifier">target</span>, <span class="ruby-identifier">data</span>, <span class="ruby-identifier">datalength</span>, <span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>
143:       <span class="ruby-identifier">selectable</span> = <span class="ruby-constant">Reactor</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">get_selectable</span>( <span class="ruby-identifier">target</span> ) <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;unknown send_data target&quot;</span>
144:       <span class="ruby-identifier">selectable</span>.<span class="ruby-identifier">send_datagram</span> <span class="ruby-identifier">data</span>, <span class="ruby-constant">Socket</span><span class="ruby-operator">::</span><span class="ruby-identifier">pack_sockaddr_in</span>(<span class="ruby-identifier">port</span>, <span class="ruby-identifier">host</span>)
145:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000496">
                    
                    <a name="M000496"></a><b>send_file_data</b>(sig, filename)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000496_source')" id="l_M000496_source">show</a>
                        
                    </p>
                    <div id="M000496_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/jeventmachine.rb, line 270</span>
270:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">send_file_data</span>(<span class="ruby-identifier">sig</span>, <span class="ruby-identifier">filename</span>)
271:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000330">
                    
                    <a name="M000330"></a><b>send_file_data</b>(sig, filename)
                    
                </div>
                
                <div class="description">
                  <p>
@private
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000330_source')" id="l_M000330_source">show</a>
                        
                    </p>
                    <div id="M000330_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/em/pure_ruby.rb, line 193</span>
193:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">send_file_data</span> <span class="ruby-identifier">sig</span>, <span class="ruby-identifier">filename</span>
194:       <span class="ruby-identifier">sz</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">size</span>(<span class="ruby-identifier">filename</span>)
195:       <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;file too large&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">sz</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">32</span><span class="ruby-operator">*</span><span class="ruby-value">1024</span>
196:       <span class="ruby-identifier">data</span> =
197:         <span class="ruby-keyword kw">begin</span>
198:           <span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span> <span class="ruby-identifier">filename</span>
199:         <span class="ruby-keyword kw">rescue</span>
200:           <span class="ruby-value str">&quot;&quot;</span>
201:         <span class="ruby-keyword kw">end</span>
202:       <span class="ruby-identifier">send_data</span> <span class="ruby-identifier">sig</span>, <span class="ruby-identifier">data</span>, <span class="ruby-identifier">data</span>.<span class="ruby-identifier">length</span>
203:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000466">
                    
                    <a name="M000466"></a><b>set_comm_inactivity_timeout</b>(sig, interval)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000466_source')" id="l_M000466_source">show</a>
                        
                    </p>
                    <div id="M000466_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/jeventmachine.rb, line 141</span>
141:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">set_comm_inactivity_timeout</span> <span class="ruby-identifier">sig</span>, <span class="ruby-identifier">interval</span>
142:     <span class="ruby-ivar">@em</span>.<span class="ruby-identifier">setCommInactivityTimeout</span> <span class="ruby-identifier">sig</span>, <span class="ruby-identifier">interval</span>
143:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000340">
                    
                    <a name="M000340"></a><b>set_comm_inactivity_timeout</b>(sig, tm)
                    
                </div>
                
                <div class="description">
                  <p>
@private
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000340_source')" id="l_M000340_source">show</a>
                        
                    </p>
                    <div id="M000340_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/em/pure_ruby.rb, line 217</span>
217:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set_comm_inactivity_timeout</span> <span class="ruby-identifier">sig</span>, <span class="ruby-identifier">tm</span>
218:       <span class="ruby-identifier">r</span> = <span class="ruby-constant">Reactor</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">get_selectable</span>( <span class="ruby-identifier">sig</span> ) <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;unknown set_comm_inactivity_timeout target&quot;</span>
219:       <span class="ruby-identifier">r</span>.<span class="ruby-identifier">set_inactivity_timeout</span> <span class="ruby-identifier">tm</span>
220:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000528">
                    
                    <a name="M000528"></a><b>set_descriptor_table_size</b>(n_descriptors=nil)
                    
                </div>
                
                <div class="description">
                  <p>
Sets the maximum number of file or socket descriptors that your process may
open. If you call this method with no arguments, it will simply return the
current size of the descriptor table without attempting to change it.
</p>
<p>
The new limit on open descriptors *<b>only</b>* applies to sockets and
other descriptors that belong to <a
href="EventMachine.html">EventMachine</a>. It has **no effect** on the
number of descriptors you can create in ordinary Ruby code.
</p>
<p>
Not available on all platforms. Increasing the number of descriptors beyond
its default limit usually requires superuser privileges. (See {.<a
href="EventMachine.html#M000527">set_effective_user</a>} for a way to drop
superuser privileges while your program is running.)
</p>
<p>
@param [Integer] n_descriptors The maximum number of file or socket
descriptors that your process may open @return [Integer] The new descriptor
table size.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000528_source')" id="l_M000528_source">show</a>
                        
                    </p>
                    <div id="M000528_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/eventmachine.rb, line 1086</span>
1086:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">set_descriptor_table_size</span> <span class="ruby-identifier">n_descriptors</span>=<span class="ruby-keyword kw">nil</span>
1087:     <span class="ruby-constant">EventMachine</span><span class="ruby-operator">::</span><span class="ruby-identifier">set_rlimit_nofile</span> <span class="ruby-identifier">n_descriptors</span>
1088:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000527">
                    
                    <a name="M000527"></a><b>set_effective_user</b>(username)
                    
                </div>
                
                <div class="description">
                  <p>
A wrapper over the setuid system call. Particularly useful when opening a
network server on a privileged port because you can use this call to drop
privileges after opening the port. Also very useful after a call to {.<a
href="EventMachine.html#M000528">set_descriptor_table_size</a>}, which
generally requires that you start your process with root privileges.
</p>
<p>
This method is intended for use in enforcing security requirements,
consequently it will throw a fatal error and end your program if it fails.
</p>
<p>
@param [String] username The effective name of the user whose
privilege-level your process should attain.
</p>
<p>
@note This method has no effective implementation on Windows or in the
pure-Ruby
</p>
<pre>
      implementation of EventMachine
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000527_source')" id="l_M000527_source">show</a>
                        
                    </p>
                    <div id="M000527_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/eventmachine.rb, line 1067</span>
1067:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">set_effective_user</span> <span class="ruby-identifier">username</span>
1068:     <span class="ruby-constant">EventMachine</span><span class="ruby-operator">::</span><span class="ruby-identifier">setuid_string</span> <span class="ruby-identifier">username</span>
1069:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000468">
                    
                    <a name="M000468"></a><b>set_heartbeat_interval</b>(val)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000468_source')" id="l_M000468_source">show</a>
                        
                    </p>
                    <div id="M000468_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/jeventmachine.rb, line 146</span>
146:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">set_heartbeat_interval</span> <span class="ruby-identifier">val</span>
147:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000325">
                    
                    <a name="M000325"></a><b>set_max_timer_count</b>(n)
                    
                </div>
                
                <div class="description">
                  <p>
This method is a harmless no-op in pure Ruby, which doesn&#8217;t have a
built-in limit on the number of available timers. @private
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000325_source')" id="l_M000325_source">show</a>
                        
                    </p>
                    <div id="M000325_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/em/pure_ruby.rb, line 177</span>
177:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set_max_timer_count</span> <span class="ruby-identifier">n</span>
178:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000483">
                    
                    <a name="M000483"></a><b>set_max_timer_count</b>(num)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000483_source')" id="l_M000483_source">show</a>
                        
                    </p>
                    <div id="M000483_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/jeventmachine.rb, line 190</span>
190:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">set_max_timer_count</span> <span class="ruby-identifier">num</span>
191:     <span class="ruby-comment cmt"># harmless no-op in Java. There's no built-in timer limit.</span>
192:     <span class="ruby-ivar">@max_timer_count</span> = <span class="ruby-identifier">num</span>
193:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000520">
                    
                    <a name="M000520"></a><b>set_max_timers</b>(ct)
                    
                </div>
                
                <div class="description">
                  <p>
Sets the maximum number of timers and periodic timers that may be
outstanding at any given time. You only need to call {.<a
href="EventMachine.html#M000520">set_max_timers</a>} if you need more than
the default number of timers, which on most platforms is 1000.
</p>
<p>
@note This method has to be used <b>before</b> event loop is started.
</p>
<p>
@param [Integer] ct Maximum number of timers that may be outstanding at any
given time
</p>
<p>
@see <a href="EventMachine.html#M000504">EventMachine.add_timer</a> @see <a
href="EventMachine.html#M000505">EventMachine.add_periodic_timer</a> @see
<a href="EventMachine/Timer.html">EventMachine::Timer</a>
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000520_source')" id="l_M000520_source">show</a>
                        
                    </p>
                    <div id="M000520_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/eventmachine.rb, line 883</span>
883:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">set_max_timers</span> <span class="ruby-identifier">ct</span>
884:     <span class="ruby-identifier">set_max_timer_count</span> <span class="ruby-identifier">ct</span>
885:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000489">
                    
                    <a name="M000489"></a><b>set_notify_readable</b>(sig, mode)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000489_source')" id="l_M000489_source">show</a>
                        
                    </p>
                    <div id="M000489_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/jeventmachine.rb, line 249</span>
249:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">set_notify_readable</span> <span class="ruby-identifier">sig</span>, <span class="ruby-identifier">mode</span>
250:     <span class="ruby-ivar">@em</span>.<span class="ruby-identifier">setNotifyReadable</span>(<span class="ruby-identifier">sig</span>, <span class="ruby-identifier">mode</span>)
251:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000490">
                    
                    <a name="M000490"></a><b>set_notify_writable</b>(sig, mode)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000490_source')" id="l_M000490_source">show</a>
                        
                    </p>
                    <div id="M000490_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/jeventmachine.rb, line 252</span>
252:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">set_notify_writable</span> <span class="ruby-identifier">sig</span>, <span class="ruby-identifier">mode</span>
253:     <span class="ruby-ivar">@em</span>.<span class="ruby-identifier">setNotifyWritable</span>(<span class="ruby-identifier">sig</span>, <span class="ruby-identifier">mode</span>)
254:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000467">
                    
                    <a name="M000467"></a><b>set_pending_connect_timeout</b>(sig, val)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000467_source')" id="l_M000467_source">show</a>
                        
                    </p>
                    <div id="M000467_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/jeventmachine.rb, line 144</span>
144:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">set_pending_connect_timeout</span> <span class="ruby-identifier">sig</span>, <span class="ruby-identifier">val</span>
145:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000519">
                    
                    <a name="M000519"></a><b>set_quantum</b>(mills)
                    
                </div>
                
                <div class="description">
                  <p>
For advanced users. This function sets the default timer granularity, which
by default is slightly smaller than 100 milliseconds. Call this function to
set a higher or lower granularity. The function affects the behavior of {<a
href="EventMachine.html#M000504">EventMachine.add_timer</a>} and {<a
href="EventMachine.html#M000505">EventMachine.add_periodic_timer</a>}. Most
applications will not need to call this function.
</p>
<p>
Avoid setting the quantum to very low values because that may reduce
performance under some extreme conditions. We recommend that you not use
values lower than 10.
</p>
<p>
This method only can be used if event loop is running.
</p>
<p>
@param [Integer] mills New timer granularity, in milliseconds
</p>
<p>
@see <a href="EventMachine.html#M000504">EventMachine.add_timer</a> @see <a
href="EventMachine.html#M000505">EventMachine.add_periodic_timer</a> @see
<a href="EventMachine/Timer.html">EventMachine::Timer</a> @see <a
href="EventMachine.html#M000498">EventMachine.run</a>
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000519_source')" id="l_M000519_source">show</a>
                        
                    </p>
                    <div id="M000519_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/eventmachine.rb, line 868</span>
868:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">set_quantum</span> <span class="ruby-identifier">mills</span>
869:     <span class="ruby-identifier">set_timer_quantum</span> <span class="ruby-identifier">mills</span>.<span class="ruby-identifier">to_i</span>
870:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000324">
                    
                    <a name="M000324"></a><b>set_rlimit_nofile</b>(n)
                    
                </div>
                
                <div class="description">
                  <p>
This method is a no-op in the pure-Ruby implementation. We simply return
Ruby&#8217;s built-in per-process file-descriptor limit. @private
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000324_source')" id="l_M000324_source">show</a>
                        
                    </p>
                    <div id="M000324_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/em/pure_ruby.rb, line 170</span>
170:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set_rlimit_nofile</span> <span class="ruby-identifier">n</span>
171:       <span class="ruby-value">1024</span>
172:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000479">
                    
                    <a name="M000479"></a><b>set_rlimit_nofile</b>(n_descriptors)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000479_source')" id="l_M000479_source">show</a>
                        
                    </p>
                    <div id="M000479_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/jeventmachine.rb, line 176</span>
176:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">set_rlimit_nofile</span> <span class="ruby-identifier">n_descriptors</span>
177:     <span class="ruby-comment cmt"># Currently a no-op for Java.</span>
178:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000329">
                    
                    <a name="M000329"></a><b>set_sock_opt</b>(signature, level, optname, optval)
                    
                </div>
                
                <div class="description">
                  <p>
@private
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000329_source')" id="l_M000329_source">show</a>
                        
                    </p>
                    <div id="M000329_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/em/pure_ruby.rb, line 187</span>
187:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set_sock_opt</span> <span class="ruby-identifier">signature</span>, <span class="ruby-identifier">level</span>, <span class="ruby-identifier">optname</span>, <span class="ruby-identifier">optval</span>
188:       <span class="ruby-identifier">selectable</span> = <span class="ruby-constant">Reactor</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">get_selectable</span>( <span class="ruby-identifier">signature</span> ) <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;unknown get_peername target&quot;</span>
189:       <span class="ruby-identifier">selectable</span>.<span class="ruby-identifier">setsockopt</span> <span class="ruby-identifier">level</span>, <span class="ruby-identifier">optname</span>, <span class="ruby-identifier">optval</span>
190:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000472">
                    
                    <a name="M000472"></a><b>set_timer_quantum</b>(q)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000472_source')" id="l_M000472_source">show</a>
                        
                    </p>
                    <div id="M000472_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/jeventmachine.rb, line 157</span>
157:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">set_timer_quantum</span> <span class="ruby-identifier">q</span>
158:     <span class="ruby-ivar">@em</span>.<span class="ruby-identifier">setTimerQuantum</span> <span class="ruby-identifier">q</span>
159:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000319">
                    
                    <a name="M000319"></a><b>set_timer_quantum</b>(interval)
                    
                </div>
                
                <div class="description">
                  <p>
Sets reactor quantum in milliseconds. The underlying <a
href="EventMachine/Reactor.html">Reactor</a> function wants a (possibly
fractional) number of seconds. @private
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000319_source')" id="l_M000319_source">show</a>
                        
                    </p>
                    <div id="M000319_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/em/pure_ruby.rb, line 151</span>
151:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set_timer_quantum</span> <span class="ruby-identifier">interval</span>
152:       <span class="ruby-constant">Reactor</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">set_timer_quantum</span>(( <span class="ruby-value">1.0</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">interval</span>) <span class="ruby-operator">/</span> <span class="ruby-value">1000.0</span>)
153:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000494">
                    
                    <a name="M000494"></a><b>set_tls_parms</b>(sig, params)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000494_source')" id="l_M000494_source">show</a>
                        
                    </p>
                    <div id="M000494_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/jeventmachine.rb, line 266</span>
266:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">set_tls_parms</span>(<span class="ruby-identifier">sig</span>, <span class="ruby-identifier">params</span>)
267:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000315">
                    
                    <a name="M000315"></a><b>signal_loopbreak</b>()
                    
                </div>
                
                <div class="description">
                  <p>
@private
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000315_source')" id="l_M000315_source">show</a>
                        
                    </p>
                    <div id="M000315_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/em/pure_ruby.rb, line 124</span>
124:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">signal_loopbreak</span>
125:       <span class="ruby-constant">Reactor</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">signal_loopbreak</span>
126:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000471">
                    
                    <a name="M000471"></a><b>signal_loopbreak</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000471_source')" id="l_M000471_source">show</a>
                        
                    </p>
                    <div id="M000471_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/jeventmachine.rb, line 154</span>
154:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">signal_loopbreak</span>
155:     <span class="ruby-ivar">@em</span>.<span class="ruby-identifier">signalLoopbreak</span>
156:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000375">
                    
                    <a name="M000375"></a><b>spawn</b>(&amp;block)
                    
                </div>
                
                <div class="description">
                  <p>
Spawn an erlang-style process
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000375_source')" id="l_M000375_source">show</a>
                        
                    </p>
                    <div id="M000375_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/em/spawnable.rb, line 69</span>
69:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">spawn</span> <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>
70:     <span class="ruby-identifier">s</span> = <span class="ruby-constant">SpawnedProcess</span>.<span class="ruby-identifier">new</span>
71:     <span class="ruby-identifier">s</span>.<span class="ruby-identifier">set_receiver</span> <span class="ruby-identifier">block</span>
72:     <span class="ruby-identifier">s</span>
73:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000525">
                    
                    <a name="M000525"></a><b>spawn_threadpool</b>()
                    
                </div>
                
                <div class="description">
                  <p>
@private
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000525_source')" id="l_M000525_source">show</a>
                        
                    </p>
                    <div id="M000525_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/eventmachine.rb, line 1006</span>
1006:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">spawn_threadpool</span>
1007:     <span class="ruby-keyword kw">until</span> <span class="ruby-ivar">@threadpool</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-ivar">@threadpool_size</span>.<span class="ruby-identifier">to_i</span>
1008:       <span class="ruby-identifier">thread</span> = <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword kw">do</span>
1009:         <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span>.<span class="ruby-identifier">abort_on_exception</span> = <span class="ruby-keyword kw">true</span>
1010:         <span class="ruby-keyword kw">while</span> <span class="ruby-keyword kw">true</span>
1011:           <span class="ruby-identifier">op</span>, <span class="ruby-identifier">cback</span> = <span class="ruby-operator">*</span><span class="ruby-ivar">@threadqueue</span>.<span class="ruby-identifier">pop</span>
1012:           <span class="ruby-identifier">result</span> = <span class="ruby-identifier">op</span>.<span class="ruby-identifier">call</span>
1013:           <span class="ruby-ivar">@resultqueue</span> <span class="ruby-operator">&lt;&lt;</span> [<span class="ruby-identifier">result</span>, <span class="ruby-identifier">cback</span>]
1014:           <span class="ruby-constant">EventMachine</span>.<span class="ruby-identifier">signal_loopbreak</span>
1015:         <span class="ruby-keyword kw">end</span>
1016:       <span class="ruby-keyword kw">end</span>
1017:       <span class="ruby-ivar">@threadpool</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">thread</span>
1018:     <span class="ruby-keyword kw">end</span>
1019:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000323">
                    
                    <a name="M000323"></a><b>ssl?</b>()
                    
                </div>
                
                <div class="description">
                  <p>
This method is not implemented for pure-Ruby implementation @private
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000323_source')" id="l_M000323_source">show</a>
                        
                    </p>
                    <div id="M000323_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/em/pure_ruby.rb, line 163</span>
163:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">ssl?</span>
164:       <span class="ruby-keyword kw">false</span>
165:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000470">
                    
                    <a name="M000470"></a><b>ssl?</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000470_source')" id="l_M000470_source">show</a>
                        
                    </p>
                    <div id="M000470_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/jeventmachine.rb, line 151</span>
151:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">ssl?</span>
152:     <span class="ruby-keyword kw">false</span>
153:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000508">
                    
                    <a name="M000508"></a><b>start_server</b>(server, port=nil, handler=nil, *args, &amp;block)
                    
                </div>
                
                <div class="description">
                  <p>
Initiates a TCP server (socket acceptor) on the specified IP address and
port.
</p>
<p>
The IP address must be valid on the machine where the program runs, and the
process must be privileged enough to listen on the specified port (on
Unix-like systems, superuser privileges are usually required to listen on
any port lower than 1024). Only one listener may be running on any given
address/port combination. <a
href="EventMachine.html#M000508">start_server</a> will fail if the given
address and port are already listening on the machine, either because of a
prior call to {.<a href="EventMachine.html#M000508">start_server</a>} or
some unrelated process running on the machine. If {.<a
href="EventMachine.html#M000508">start_server</a>} succeeds, the new
network listener becomes active immediately and starts accepting
connections from remote peers, and these connections generate callback
events that are processed by the code specified in the handler parameter to
{.<a href="EventMachine.html#M000508">start_server</a>}.
</p>
<p>
The optional handler which is passed to this method is the key to
EventMachine&#8217;s ability to handle particular network protocols. The
handler parameter passed to <a
href="EventMachine.html#M000508">start_server</a> must be a Ruby Module
that you must define. When the network server that is started by <a
href="EventMachine.html#M000508">start_server</a> accepts a new connection,
it instantiates a new object of an anonymous class that is inherited from
{EventMachine::Connection}, *into which your handler module have been
included*.
</p>
<p>
Your handler module may override any of the methods in
{EventMachine::Connection}, such as {<a
href="EventMachine/Connection.html#M000035">EventMachine::Connection#receive_data</a>},
in order to implement the specific behavior of the network protocol.
</p>
<p>
Callbacks invoked in response to network events <b>always</b> take place
within the execution context of the object derived from
{EventMachine::Connection} extended by your handler module. There is one
object per connection, and all of the callbacks invoked for a particular
connection take the form of instance methods called against the
corresponding {EventMachine::Connection} object. Therefore, you are free to
define whatever instance variables you wish, in order to contain the
per-connection state required by the network protocol you are implementing.
</p>
<p>
{<a href="EventMachine.html#M000508">EventMachine.start_server</a>} is
usually called inside the block passed to {<a
href="EventMachine.html#M000498">EventMachine.run</a>}, but it can be
called from any <a href="EventMachine.html">EventMachine</a> callback. {<a
href="EventMachine.html#M000508">EventMachine.start_server</a>} will fail
unless the <a href="EventMachine.html">EventMachine</a> event loop is
currently running (which is why it&#8217;s often called in the block
suppled to {<a href="EventMachine.html#M000498">EventMachine.run</a>}).
</p>
<p>
You may call <a href="EventMachine.html#M000508">start_server</a> any
number of times to start up network listeners on different address/port
combinations. The servers will all run simultaneously. More interestingly,
each individual call to <a
href="EventMachine.html#M000508">start_server</a> can specify a different
handler module and thus implement a different network protocol from all the
others.
</p>
<p>
@example
</p>
<pre>
 require 'rubygems'
 require 'eventmachine'

 # Here is an example of a server that counts lines of input from the remote
 # peer and sends back the total number of lines received, after each line.
 # Try the example with more than one client connection opened via telnet,
 # and you will see that the line count increments independently on each
 # of the client connections. Also very important to note, is that the
 # handler for the receive_data function, which our handler redefines, may
 # not assume that the data it receives observes any kind of message boundaries.
 # Also, to use this example, be sure to change the server and port parameters
 # to the start_server call to values appropriate for your environment.
 module LineCounter
   MaxLinesPerConnection = 10

   def post_init
     puts &quot;Received a new connection&quot;
     @data_received = &quot;&quot;
     @line_count = 0
   end

   def receive_data data
     @data_received &lt;&lt; data
     while @data_received.slice!( /^[^\n]*[\n]/m )
       @line_count += 1
       send_data &quot;received #{@line_count} lines so far\r\n&quot;
       @line_count == MaxLinesPerConnection and close_connection_after_writing
     end
   end
 end

 EventMachine.run {
   host, port = &quot;192.168.0.100&quot;, 8090
   EventMachine.start_server host, port, LineCounter
   puts &quot;Now accepting connections on address #{host}, port #{port}...&quot;
   EventMachine.add_periodic_timer(10) { $stderr.write &quot;*&quot; }
 }
</pre>
<p>
@param [String] server Host to bind to. @param [Integer] port Port to bind
to. @param [Module, Class] handler A module or class that implements
connection callbacks
</p>
<p>
@note Don&#8217;t forget that in order to bind to ports < 1024 on Linux,
*BSD and Mac OS X your process must have superuser privileges.
</p>
<p>
@see file:<a
href="../files/docs/GettingStarted_md.html">docs/GettingStarted.md</a> <a
href="EventMachine.html">EventMachine</a> tutorial @see <a
href="EventMachine.html#M000509">EventMachine.stop_server</a>
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000508_source')" id="l_M000508_source">show</a>
                        
                    </p>
                    <div id="M000508_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/eventmachine.rb, line 502</span>
502:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">start_server</span> <span class="ruby-identifier">server</span>, <span class="ruby-identifier">port</span>=<span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">handler</span>=<span class="ruby-keyword kw">nil</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>
503:     <span class="ruby-keyword kw">begin</span>
504:       <span class="ruby-identifier">port</span> = <span class="ruby-constant">Integer</span>(<span class="ruby-identifier">port</span>)
505:     <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-constant">TypeError</span>
506:       <span class="ruby-comment cmt"># there was no port, so server must be a unix domain socket</span>
507:       <span class="ruby-comment cmt"># the port argument is actually the handler, and the handler is one of the args</span>
508:       <span class="ruby-identifier">args</span>.<span class="ruby-identifier">unshift</span> <span class="ruby-identifier">handler</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">handler</span>
509:       <span class="ruby-identifier">handler</span> = <span class="ruby-identifier">port</span>
510:       <span class="ruby-identifier">port</span> = <span class="ruby-keyword kw">nil</span>
511:     <span class="ruby-keyword kw">end</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">port</span>
512: 
513:     <span class="ruby-identifier">klass</span> = <span class="ruby-identifier">klass_from_handler</span>(<span class="ruby-constant">Connection</span>, <span class="ruby-identifier">handler</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
514: 
515:     <span class="ruby-identifier">s</span> = <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">port</span>
516:           <span class="ruby-identifier">start_tcp_server</span> <span class="ruby-identifier">server</span>, <span class="ruby-identifier">port</span>
517:         <span class="ruby-keyword kw">else</span>
518:           <span class="ruby-identifier">start_unix_server</span> <span class="ruby-identifier">server</span>
519:         <span class="ruby-keyword kw">end</span>
520:     <span class="ruby-ivar">@acceptors</span>[<span class="ruby-identifier">s</span>] = [<span class="ruby-identifier">klass</span>,<span class="ruby-identifier">args</span>,<span class="ruby-identifier">block</span>]
521:     <span class="ruby-identifier">s</span>
522:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000311">
                    
                    <a name="M000311"></a><b>start_tcp_server</b>(host, port)
                    
                </div>
                
                <div class="description">
                  <p>
@private
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000311_source')" id="l_M000311_source">show</a>
                        
                    </p>
                    <div id="M000311_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/em/pure_ruby.rb, line 101</span>
101:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">start_tcp_server</span> <span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>
102:       (<span class="ruby-identifier">s</span> = <span class="ruby-constant">EvmaTCPServer</span>.<span class="ruby-identifier">start_server</span> <span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>) <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;no acceptor&quot;</span>
103:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">uuid</span>
104:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000458">
                    
                    <a name="M000458"></a><b>start_tcp_server</b>(server, port)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000458_source')" id="l_M000458_source">show</a>
                        
                    </p>
                    <div id="M000458_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/jeventmachine.rb, line 116</span>
116:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">start_tcp_server</span> <span class="ruby-identifier">server</span>, <span class="ruby-identifier">port</span>
117:     <span class="ruby-ivar">@em</span>.<span class="ruby-identifier">startTcpServer</span> <span class="ruby-identifier">server</span>, <span class="ruby-identifier">port</span>
118:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000469">
                    
                    <a name="M000469"></a><b>start_tls</b>(sig)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000469_source')" id="l_M000469_source">show</a>
                        
                    </p>
                    <div id="M000469_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/jeventmachine.rb, line 148</span>
148:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">start_tls</span> <span class="ruby-identifier">sig</span>
149:     <span class="ruby-ivar">@em</span>.<span class="ruby-identifier">startTls</span> <span class="ruby-identifier">sig</span>
150:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000495">
                    
                    <a name="M000495"></a><b>start_tls</b>(sig)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000495_source')" id="l_M000495_source">show</a>
                        
                    </p>
                    <div id="M000495_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/jeventmachine.rb, line 268</span>
268:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">start_tls</span>(<span class="ruby-identifier">sig</span>)
269:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000510">
                    
                    <a name="M000510"></a><b>start_unix_domain_server</b>(filename, *args, &amp;block)
                    
                </div>
                
                <div class="description">
                  <p>
Start a Unix-domain server.
</p>
<p>
Note that this is an alias for {<a
href="EventMachine.html#M000508">EventMachine.start_server</a>}, which can
be used to start both TCP and Unix-domain servers.
</p>
<p>
@see <a href="EventMachine.html#M000508">EventMachine.start_server</a>
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000510_source')" id="l_M000510_source">show</a>
                        
                    </p>
                    <div id="M000510_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/eventmachine.rb, line 537</span>
537:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">start_unix_domain_server</span> <span class="ruby-identifier">filename</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>
538:     <span class="ruby-identifier">start_server</span> <span class="ruby-identifier">filename</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>
539:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000460">
                    
                    <a name="M000460"></a><b>start_unix_server</b>(filename)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000460_source')" id="l_M000460_source">show</a>
                        
                    </p>
                    <div id="M000460_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/jeventmachine.rb, line 122</span>
122:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">start_unix_server</span> <span class="ruby-identifier">filename</span>
123:     <span class="ruby-comment cmt"># TEMPORARILY unsupported until someone figures out how to do it.</span>
124:     <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;unsupported on this platform&quot;</span>
125:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000313">
                    
                    <a name="M000313"></a><b>start_unix_server</b>(chain)
                    
                </div>
                
                <div class="description">
                  <p>
@private
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000313_source')" id="l_M000313_source">show</a>
                        
                    </p>
                    <div id="M000313_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/em/pure_ruby.rb, line 113</span>
113:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">start_unix_server</span> <span class="ruby-identifier">chain</span>
114:       (<span class="ruby-identifier">s</span> = <span class="ruby-constant">EvmaUNIXServer</span>.<span class="ruby-identifier">start_server</span> <span class="ruby-identifier">chain</span>) <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;no acceptor&quot;</span>
115:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">uuid</span>
116:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000457">
                    
                    <a name="M000457"></a><b>stop</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000457_source')" id="l_M000457_source">show</a>
                        
                    </p>
                    <div id="M000457_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/jeventmachine.rb, line 113</span>
113:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">stop</span>
114:     <span class="ruby-ivar">@em</span>.<span class="ruby-identifier">stop</span>
115:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000304">
                    
                    <a name="M000304"></a><b>stop</b>()
                    
                </div>
                
                <div class="description">
                  <p>
@private
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000304_source')" id="l_M000304_source">show</a>
                        
                    </p>
                    <div id="M000304_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/em/pure_ruby.rb, line 70</span>
70:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">stop</span>
71:       <span class="ruby-constant">Reactor</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">stop</span>
72:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000507">
                    
                    <a name="M000507"></a><b>stop_event_loop</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Causes the processing loop to stop executing, which will cause all open
connections and accepting servers to be run down and closed. <a
href="EventMachine/Connection.html">Connection</a> termination callbacks
added using {<a
href="EventMachine.html#M000503">EventMachine.add_shutdown_hook</a>} will
be called as part of running this method.
</p>
<p>
When all of this processing is complete, the call to {<a
href="EventMachine.html#M000498">EventMachine.run</a>} which started the
processing loop will return and program flow will resume from the statement
following {<a href="EventMachine.html#M000498">EventMachine.run</a>} call.
</p>
<p>
@example Stopping a running <a href="EventMachine.html">EventMachine</a>
event loop
</p>
<pre>
 require 'rubygems'
 require 'eventmachine'

 module Redmond
   def post_init
     puts &quot;We're sending a dumb HTTP request to the remote peer.&quot;
     send_data &quot;GET / HTTP/1.1\r\nHost: www.microsoft.com\r\n\r\n&quot;
   end

   def receive_data data
     puts &quot;We received #{data.length} bytes from the remote peer.&quot;
     puts &quot;We're going to stop the event loop now.&quot;
     EventMachine::stop_event_loop
   end

   def unbind
     puts &quot;A connection has terminated.&quot;
   end
 end

 puts &quot;We're starting the event loop now.&quot;
 EventMachine.run {
   EventMachine.connect &quot;www.microsoft.com&quot;, 80, Redmond
 }
 puts &quot;The event loop has stopped.&quot;

 # This program will produce approximately the following output:
 #
 # We're starting the event loop now.
 # We're sending a dumb HTTP request to the remote peer.
 # We received 1440 bytes from the remote peer.
 # We're going to stop the event loop now.
 # A connection has terminated.
 # The event loop has stopped.
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000507_source')" id="l_M000507_source">show</a>
                        
                    </p>
                    <div id="M000507_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/eventmachine.rb, line 403</span>
403:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">stop_event_loop</span>
404:     <span class="ruby-constant">EventMachine</span><span class="ruby-operator">::</span><span class="ruby-identifier">stop</span>
405:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000509">
                    
                    <a name="M000509"></a><b>stop_server</b>(signature)
                    
                </div>
                
                <div class="description">
                  <p>
Stop a TCP server socket that was started with {<a
href="EventMachine.html#M000508">EventMachine.start_server</a>}. @see <a
href="EventMachine.html#M000508">EventMachine.start_server</a>
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000509_source')" id="l_M000509_source">show</a>
                        
                    </p>
                    <div id="M000509_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/eventmachine.rb, line 527</span>
527:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">stop_server</span> <span class="ruby-identifier">signature</span>
528:     <span class="ruby-constant">EventMachine</span><span class="ruby-operator">::</span><span class="ruby-identifier">stop_tcp_server</span> <span class="ruby-identifier">signature</span>
529:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000459">
                    
                    <a name="M000459"></a><b>stop_tcp_server</b>(sig)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000459_source')" id="l_M000459_source">show</a>
                        
                    </p>
                    <div id="M000459_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/jeventmachine.rb, line 119</span>
119:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">stop_tcp_server</span> <span class="ruby-identifier">sig</span>
120:     <span class="ruby-ivar">@em</span>.<span class="ruby-identifier">stopTcpServer</span> <span class="ruby-identifier">sig</span>
121:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000312">
                    
                    <a name="M000312"></a><b>stop_tcp_server</b>(sig)
                    
                </div>
                
                <div class="description">
                  <p>
@private
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000312_source')" id="l_M000312_source">show</a>
                        
                    </p>
                    <div id="M000312_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/em/pure_ruby.rb, line 107</span>
107:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">stop_tcp_server</span> <span class="ruby-identifier">sig</span>
108:       <span class="ruby-identifier">s</span> = <span class="ruby-constant">Reactor</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">get_selectable</span>(<span class="ruby-identifier">sig</span>)
109:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">schedule_close</span>
110:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000125">
                    
                    <a name="M000125"></a><b>system</b>(cmd, *args, &amp;cb)
                    
                </div>
                
                <div class="description">
                  <p>
EM::system is a simple wrapper for EM::popen. It is similar to
Kernel::system, but requires a single string argument for the command and
performs no shell expansion.
</p>
<p>
The block or proc passed to EM::system is called with two arguments: the
output generated by the command, and a Process::Status that contains
information about the command&#8217;s execution.
</p>
<pre>
 EM.run{
   EM.system('ls'){ |output,status| puts output if status.exitstatus == 0 }
 }
</pre>
<p>
You can also supply an additional proc to send some data to the process:
</p>
<pre>
 EM.run{
   EM.system('sh', proc{ |process|
     process.send_data(&quot;echo hello\n&quot;)
     process.send_data(&quot;exit\n&quot;)
   }, proc{ |out,status|
     puts(out)
   })
 }
</pre>
<p>
Like <a href="EventMachine.html#M000529">EventMachine.popen</a>, <a
href="EventMachine.html#M000125">EventMachine.system</a> currently does not
work on windows. It returns the pid of the spawned process.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000125_source')" id="l_M000125_source">show</a>
                        
                    </p>
                    <div id="M000125_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/em/processes.rb, line 112</span>
112:   <span class="ruby-keyword kw">def</span> <span class="ruby-constant">EventMachine</span><span class="ruby-operator">::</span><span class="ruby-identifier">system</span> <span class="ruby-identifier">cmd</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">cb</span>
113:     <span class="ruby-identifier">cb</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">pop</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">Proc</span>
114:     <span class="ruby-identifier">init</span> = <span class="ruby-identifier">args</span>.<span class="ruby-identifier">pop</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">Proc</span>
115: 
116:     <span class="ruby-comment cmt"># merge remaining arguments into the command</span>
117:     <span class="ruby-identifier">cmd</span> = ([<span class="ruby-identifier">cmd</span>] <span class="ruby-operator">+</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span><span class="ruby-identifier">a</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">dump</span>}).<span class="ruby-identifier">join</span>(<span class="ruby-value str">' '</span>)
118: 
119:     <span class="ruby-constant">EM</span>.<span class="ruby-identifier">get_subprocess_pid</span>(<span class="ruby-constant">EM</span>.<span class="ruby-identifier">popen</span>(<span class="ruby-identifier">cmd</span>, <span class="ruby-constant">SystemCmd</span>, <span class="ruby-identifier">cb</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span>
120:       <span class="ruby-identifier">init</span>[<span class="ruby-identifier">c</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">init</span>
121:     <span class="ruby-keyword kw">end</span>.<span class="ruby-identifier">signature</span>)
122:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000436">
                    
                    <a name="M000436"></a><b>tick_loop</b>(*a, &amp;b)
                    
                </div>
                
                <div class="description">
                  <p>
Creates and immediately starts an <a
href="EventMachine/TickLoop.html">EventMachine::TickLoop</a>
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000436_source')" id="l_M000436_source">show</a>
                        
                    </p>
                    <div id="M000436_source" class="dyn-source">
                        <pre>   <span class="ruby-comment cmt"># File lib/em/tick_loop.rb, line 3</span>
3:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">tick_loop</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">a</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">b</span>)
4:     <span class="ruby-constant">TickLoop</span>.<span class="ruby-identifier">new</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">a</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">b</span>).<span class="ruby-identifier">start</span>
5:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000513">
                    
                    <a name="M000513"></a><b>watch</b>(io, handler=nil, *args, &amp;blk)
                    
                </div>
                
                <div class="description">
                  <p>
{<a href="EventMachine.html#M000513">EventMachine.watch</a>} registers a
given file descriptor or <a href="IO.html">IO</a> object with the
eventloop. The file descriptor will not be modified (it will remain
blocking or non-blocking).
</p>
<p>
The eventloop can be used to process readable and writable events on the
file descriptor, using {<a
href="EventMachine/Connection.html#M000078">EventMachine::Connection#notify_readable=</a>}
and {<a
href="EventMachine/Connection.html#M000080">EventMachine::Connection#notify_writable=</a>}
</p>
<p>
{<a
href="EventMachine/Connection.html#M000079">EventMachine::Connection#notify_readable?</a>}
and {<a
href="EventMachine/Connection.html#M000081">EventMachine::Connection#notify_writable?</a>}
can be used to check what events are enabled on the connection.
</p>
<p>
To detach the file descriptor, use {<a
href="EventMachine/Connection.html#M000044">EventMachine::Connection#detach</a>}
</p>
<p>
@example
</p>
<pre>
 module SimpleHttpClient
   def notify_readable
     header = @io.readline

     if header == &quot;\r\n&quot;
       # detach returns the file descriptor number (fd == @io.fileno)
       fd = detach
     end
   rescue EOFError
     detach
   end

   def unbind
     EM.next_tick do
       # socket is detached from the eventloop, but still open
       data = @io.read
     end
   end
 end

 EventMachine.run {
   sock = TCPSocket.new('site.com', 80)
   sock.write(&quot;GET / HTTP/1.0\r\n\r\n&quot;)
   conn = EventMachine.watch(sock, SimpleHttpClient)
   conn.notify_readable = true
 }
</pre>
<p>
@author Riham Aldakkak (eSpace Technologies)
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000513_source')" id="l_M000513_source">show</a>
                        
                    </p>
                    <div id="M000513_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/eventmachine.rb, line 707</span>
707:   <span class="ruby-keyword kw">def</span> <span class="ruby-constant">EventMachine</span><span class="ruby-operator">::</span><span class="ruby-identifier">watch</span> <span class="ruby-identifier">io</span>, <span class="ruby-identifier">handler</span>=<span class="ruby-keyword kw">nil</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">blk</span>
708:     <span class="ruby-identifier">attach_io</span> <span class="ruby-identifier">io</span>, <span class="ruby-keyword kw">true</span>, <span class="ruby-identifier">handler</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">blk</span>
709:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000532">
                    
                    <a name="M000532"></a><b>watch_file</b>(filename, handler=nil, *args)
                    
                </div>
                
                <div class="description">
                  <p>
EventMachine&#8217;s file monitoring API. Currently supported are the
following events on individual files, using inotify on Linux systems, and
kqueue for *BSD and Mac OS X:
</p>
<ul>
<li>File modified (written to)

</li>
<li>File moved/renamed

</li>
<li>File deleted

</li>
</ul>
<p>
EventMachine::watch_file takes a filename and a handler Module containing
your custom callback methods. This will setup the low level monitoring on
the specified file, and create a new <a
href="EventMachine/FileWatch.html">EventMachine::FileWatch</a> object with
your Module mixed in. <a href="EventMachine/FileWatch.html">FileWatch</a>
is a subclass of {EventMachine::Connection}, so callbacks on this object
work in the familiar way. The callbacks that will be fired by <a
href="EventMachine.html">EventMachine</a> are:
</p>
<ul>
<li>file_modified

</li>
<li>file_moved

</li>
<li>file_deleted

</li>
</ul>
<p>
You can access the filename being monitored from within this object using
{<a href="EventMachine/FileWatch.html#M000086">FileWatch#path</a>}.
</p>
<p>
When a file is deleted, {<a
href="EventMachine/FileWatch.html#M000090">FileWatch#stop_watching</a>}
will be called after your file_deleted callback, to clean up the underlying
monitoring and remove EventMachine&#8217;s reference to the now-useless
{FileWatch} instance. This will in turn call unbind, if you wish to use it.
</p>
<p>
The corresponding system-level Errno will be raised when attempting to
monitor non-existent files, files with wrong permissions, or if an error
occurs dealing with inotify/kqueue.
</p>
<p>
@example
</p>
<pre>
 # Before running this example, make sure we have a file to monitor:
 # $ echo &quot;bar&quot; &gt; /tmp/foo

 module Handler
   def file_modified
     puts &quot;#{path} modified&quot;
   end

   def file_moved
     puts &quot;#{path} moved&quot;
   end

   def file_deleted
     puts &quot;#{path} deleted&quot;
   end

   def unbind
     puts &quot;#{path} monitoring ceased&quot;
   end
 end

 # for efficient file watching, use kqueue on Mac OS X
 EventMachine.kqueue = true if EventMachine.kqueue?

 EventMachine.run {
   EventMachine.watch_file(&quot;/tmp/foo&quot;, Handler)
 }

 # $ echo &quot;baz&quot; &gt;&gt; /tmp/foo    =&gt;    &quot;/tmp/foo modified&quot;
 # $ mv /tmp/foo /tmp/oof      =&gt;    &quot;/tmp/foo moved&quot;
 # $ rm /tmp/oof               =&gt;    &quot;/tmp/foo deleted&quot;
</pre>
<p>
@note The ability to pick up on the new filename after a rename is not yet
supported.
</p>
<pre>
      Calling #path will always return the filename you originally used.
</pre>
<p>
@param [String] filename Local path to the file to watch. @param [Class,
Module] handler A class or module that implements event handlers associated
with the file.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000532_source')" id="l_M000532_source">show</a>
                        
                    </p>
                    <div id="M000532_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/eventmachine.rb, line 1222</span>
1222:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">watch_file</span>(<span class="ruby-identifier">filename</span>, <span class="ruby-identifier">handler</span>=<span class="ruby-keyword kw">nil</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
1223:     <span class="ruby-identifier">klass</span> = <span class="ruby-identifier">klass_from_handler</span>(<span class="ruby-constant">FileWatch</span>, <span class="ruby-identifier">handler</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
1224: 
1225:     <span class="ruby-identifier">s</span> = <span class="ruby-constant">EM</span><span class="ruby-operator">::</span><span class="ruby-identifier">watch_filename</span>(<span class="ruby-identifier">filename</span>)
1226:     <span class="ruby-identifier">c</span> = <span class="ruby-identifier">klass</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">s</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>
1227:     <span class="ruby-comment cmt"># we have to set the path like this because of how Connection.new works</span>
1228:     <span class="ruby-identifier">c</span>.<span class="ruby-identifier">instance_variable_set</span>(<span class="ruby-value str">&quot;@path&quot;</span>, <span class="ruby-identifier">filename</span>)
1229:     <span class="ruby-ivar">@conns</span>[<span class="ruby-identifier">s</span>] = <span class="ruby-identifier">c</span>
1230:     <span class="ruby-identifier">block_given?</span> <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">yield</span> <span class="ruby-identifier">c</span>
1231:     <span class="ruby-identifier">c</span>
1232:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000533">
                    
                    <a name="M000533"></a><b>watch_process</b>(pid, handler=nil, *args)
                    
                </div>
                
                <div class="description">
                  <p>
EventMachine&#8217;s process monitoring API. On Mac OS X and *BSD this
method is implemented using kqueue.
</p>
<p>
@example
</p>
<pre>
 module ProcessWatcher
   def process_exited
     put 'the forked child died!'
   end
 end

 pid = fork{ sleep }

 EventMachine.run {
   EventMachine.watch_process(pid, ProcessWatcher)
   EventMachine.add_timer(1){ Process.kill('TERM', pid) }
 }
</pre>
<p>
@param [Integer] pid PID of the process to watch. @param [Class, Module]
handler A class or module that implements event handlers associated with
the file.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000533_source')" id="l_M000533_source">show</a>
                        
                    </p>
                    <div id="M000533_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/eventmachine.rb, line 1253</span>
1253:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">watch_process</span>(<span class="ruby-identifier">pid</span>, <span class="ruby-identifier">handler</span>=<span class="ruby-keyword kw">nil</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
1254:     <span class="ruby-identifier">pid</span> = <span class="ruby-identifier">pid</span>.<span class="ruby-identifier">to_i</span>
1255: 
1256:     <span class="ruby-identifier">klass</span> = <span class="ruby-identifier">klass_from_handler</span>(<span class="ruby-constant">ProcessWatch</span>, <span class="ruby-identifier">handler</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
1257: 
1258:     <span class="ruby-identifier">s</span> = <span class="ruby-constant">EM</span><span class="ruby-operator">::</span><span class="ruby-identifier">watch_pid</span>(<span class="ruby-identifier">pid</span>)
1259:     <span class="ruby-identifier">c</span> = <span class="ruby-identifier">klass</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">s</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>
1260:     <span class="ruby-comment cmt"># we have to set the path like this because of how Connection.new works</span>
1261:     <span class="ruby-identifier">c</span>.<span class="ruby-identifier">instance_variable_set</span>(<span class="ruby-value str">&quot;@pid&quot;</span>, <span class="ruby-identifier">pid</span>)
1262:     <span class="ruby-ivar">@conns</span>[<span class="ruby-identifier">s</span>] = <span class="ruby-identifier">c</span>
1263:     <span class="ruby-identifier">block_given?</span> <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">yield</span> <span class="ruby-identifier">c</span>
1264:     <span class="ruby-identifier">c</span>
1265:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000376">
                    
                    <a name="M000376"></a><b>yield</b>(&amp;block)
                    
                </div>
                
                <div class="description">
                  <p>
@private
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000376_source')" id="l_M000376_source">show</a>
                        
                    </p>
                    <div id="M000376_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/em/spawnable.rb, line 76</span>
76:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-keyword kw">yield</span> <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>
77:     <span class="ruby-keyword kw">return</span> <span class="ruby-constant">YieldBlockFromSpawnedProcess</span>.<span class="ruby-identifier">new</span>( <span class="ruby-identifier">block</span>, <span class="ruby-keyword kw">false</span> )
78:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000384">
                    
                    <a name="M000384"></a><b>yield_and_notify</b>(&amp;block)
                    
                </div>
                
                <div class="description">
                  <p>
@private
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000384_source')" id="l_M000384_source">show</a>
                        
                    </p>
                    <div id="M000384_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/em/spawnable.rb, line 81</span>
81:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yield_and_notify</span> <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>
82:     <span class="ruby-keyword kw">return</span> <span class="ruby-constant">YieldBlockFromSpawnedProcess</span>.<span class="ruby-identifier">new</span>( <span class="ruby-identifier">block</span>, <span class="ruby-keyword kw">true</span> )
83:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    