<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>CodeRay::Scanners::HTML</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../../css/main.css" type="text/css" media="screen" />
    <script src="../../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Class</span> 
            CodeRay::Scanners::HTML 
            
                <span class="parent">&lt; 
                    
                    Scanner
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../../files/lib/coderay/scanners/html_rb.html">lib/coderay/scanners/html.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    
    <div class="description">
        <p>
<a href="HTML.html">HTML</a> <a href="Scanner.html">Scanner</a>
</p>
<p>
Alias: <tt>xhtml</tt>
</p>
<p>
See also: <a href="XML.html">Scanners::XML</a>
</p>

    </div>
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>R</dt>
        <dd>
            <ul>
                
                <li><a href="#M000186">reset</a></li>
                
            </ul>
        </dd>
    
        <dt>S</dt>
        <dd>
            <ul>
                
                <li><a href="#M000188">scan_java_script</a>,</li>
                
                <li><a href="#M000189">scan_tokens</a>,</li>
                
                <li><a href="#M000187">setup</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    

    

    

    
    <div class="sectiontitle">Constants</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class="attr-name">EVENT_ATTRIBUTES</td>
            <td>=</td>
            <td class="attr-value">%w(       onabort onafterprint onbeforeprint onbeforeunload onblur oncanplay       oncanplaythrough onchange onclick oncontextmenu oncuechange ondblclick       ondrag ondragdrop ondragend ondragenter ondragleave ondragover       ondragstart ondrop ondurationchange onemptied onended onerror onfocus       onformchange onforminput onhashchange oninput oninvalid onkeydown       onkeypress onkeyup onload onloadeddata onloadedmetadata onloadstart       onmessage onmousedown onmousemove onmouseout onmouseover onmouseup       onmousewheel onmove onoffline ononline onpagehide onpageshow onpause       onplay onplaying onpopstate onprogress onratechange onreadystatechange       onredo onreset onresize onscroll onseeked onseeking onselect onshow       onstalled onstorage onsubmit onsuspend ontimeupdate onundo onunload       onvolumechange onwaiting     )</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">IN_ATTRIBUTE</td>
            <td>=</td>
            <td class="attr-value">WordList::CaseIgnoring.new(nil).       add(EVENT_ATTRIBUTES, :script)</td>
        </tr>
        
        
    </table>
    

    

    
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M000186">
                    
                    <a name="M000186"></a><b>reset</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000186_source')" id="l_M000186_source">show</a>
                        
                    </p>
                    <div id="M000186_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/coderay/scanners/html.rb, line 61</span>
61:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">reset</span>
62:       <span class="ruby-keyword kw">super</span>
63:       <span class="ruby-ivar">@state</span> = <span class="ruby-identifier">:initial</span>
64:       <span class="ruby-ivar">@plain_string_content</span> = <span class="ruby-keyword kw">nil</span>
65:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Protected methods</div>
            
            <div class="method">
                <div class="title" id="M000188">
                    
                    <a name="M000188"></a><b>scan_java_script</b>(encoder, code)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000188_source')" id="l_M000188_source">show</a>
                        
                    </p>
                    <div id="M000188_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/coderay/scanners/html.rb, line 74</span>
74:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">scan_java_script</span> <span class="ruby-identifier">encoder</span>, <span class="ruby-identifier">code</span>
75:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">code</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">code</span>.<span class="ruby-identifier">empty?</span>
76:         <span class="ruby-ivar">@java_script_scanner</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">Scanners</span><span class="ruby-operator">::</span><span class="ruby-constant">JavaScript</span>.<span class="ruby-identifier">new</span> <span class="ruby-value str">''</span>, <span class="ruby-identifier">:keep_tokens</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>
77:         <span class="ruby-comment cmt"># encoder.begin_group :inline</span>
78:         <span class="ruby-ivar">@java_script_scanner</span>.<span class="ruby-identifier">tokenize</span> <span class="ruby-identifier">code</span>, <span class="ruby-identifier">:tokens</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">encoder</span>
79:         <span class="ruby-comment cmt"># encoder.end_group :inline</span>
80:       <span class="ruby-keyword kw">end</span>
81:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000189">
                    
                    <a name="M000189"></a><b>scan_tokens</b>(encoder, options)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000189_source')" id="l_M000189_source">show</a>
                        
                    </p>
                    <div id="M000189_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/coderay/scanners/html.rb, line 83</span>
 83:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">scan_tokens</span> <span class="ruby-identifier">encoder</span>, <span class="ruby-identifier">options</span>
 84:       <span class="ruby-identifier">state</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:state</span>] <span class="ruby-operator">||</span> <span class="ruby-ivar">@state</span>
 85:       <span class="ruby-identifier">plain_string_content</span> = <span class="ruby-ivar">@plain_string_content</span>
 86:       <span class="ruby-identifier">in_tag</span> = <span class="ruby-identifier">in_attribute</span> = <span class="ruby-keyword kw">nil</span>
 87:       
 88:       <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">begin_group</span> <span class="ruby-identifier">:string</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">state</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:attribute_value_string</span>
 89:       
 90:       <span class="ruby-keyword kw">until</span> <span class="ruby-identifier">eos?</span>
 91:         
 92:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">state</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">:in_special_tag</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\s+/</span><span class="ruby-identifier">m</span>)
 93:           <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:space</span>
 94:           
 95:         <span class="ruby-keyword kw">else</span>
 96:           
 97:           <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">state</span>
 98:           
 99:           <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:initial</span>
100:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/&lt;!--(?:.*?--&gt;|.*)/</span><span class="ruby-identifier">m</span>)
101:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:comment</span>
102:             <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/&lt;!DOCTYPE(?:.*?&gt;|.*)/</span><span class="ruby-identifier">m</span>)
103:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:doctype</span>
104:             <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/&lt;\?xml(?:.*?\?&gt;|.*)/</span><span class="ruby-identifier">m</span>)
105:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:preprocessor</span>
106:             <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/&lt;\?(?:.*?\?&gt;|.*)/</span><span class="ruby-identifier">m</span>)
107:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:comment</span>
108:             <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/&lt;\/[-\w.:]*&gt;?/</span><span class="ruby-identifier">m</span>)
109:               <span class="ruby-identifier">in_tag</span> = <span class="ruby-keyword kw">nil</span>
110:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:tag</span>
111:             <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/&lt;(?:(script)|[-\w.:]+)(&gt;)?/</span><span class="ruby-identifier">m</span>)
112:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:tag</span>
113:               <span class="ruby-identifier">in_tag</span> = <span class="ruby-keyword kw">self</span>[<span class="ruby-value">1</span>]
114:               <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-value">2</span>]
115:                 <span class="ruby-identifier">state</span> = <span class="ruby-identifier">:in_special_tag</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">in_tag</span>
116:               <span class="ruby-keyword kw">else</span>
117:                 <span class="ruby-identifier">state</span> = <span class="ruby-identifier">:attribute</span>
118:               <span class="ruby-keyword kw">end</span>
119:             <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/[^&lt;&gt;&amp;]+/</span>)
120:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:plain</span>
121:             <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-node">/#{ENTITY}/o</span><span class="ruby-identifier">x</span>)
122:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:entity</span>
123:             <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/[&lt;&gt;&amp;]/</span>)
124:               <span class="ruby-identifier">in_tag</span> = <span class="ruby-keyword kw">nil</span>
125:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:error</span>
126:             <span class="ruby-keyword kw">else</span>
127:               <span class="ruby-identifier">raise_inspect</span> <span class="ruby-value str">'[BUG] else-case reached with state %p'</span> <span class="ruby-operator">%</span> [<span class="ruby-identifier">state</span>], <span class="ruby-identifier">encoder</span>
128:             <span class="ruby-keyword kw">end</span>
129:             
130:           <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:attribute</span>
131:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-node">/#{TAG_END}/o</span>)
132:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:tag</span>
133:               <span class="ruby-identifier">in_attribute</span> = <span class="ruby-keyword kw">nil</span>
134:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">in_tag</span>
135:                 <span class="ruby-identifier">state</span> = <span class="ruby-identifier">:in_special_tag</span>
136:               <span class="ruby-keyword kw">else</span>
137:                 <span class="ruby-identifier">state</span> = <span class="ruby-identifier">:initial</span>
138:               <span class="ruby-keyword kw">end</span>
139:             <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-node">/#{ATTR_NAME}/o</span>)
140:               <span class="ruby-identifier">in_attribute</span> = <span class="ruby-constant">IN_ATTRIBUTE</span>[<span class="ruby-identifier">match</span>]
141:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:attribute_name</span>
142:               <span class="ruby-identifier">state</span> = <span class="ruby-identifier">:attribute_equal</span>
143:             <span class="ruby-keyword kw">else</span>
144:               <span class="ruby-identifier">in_tag</span> = <span class="ruby-keyword kw">nil</span>
145:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">getch</span>, <span class="ruby-identifier">:error</span>
146:             <span class="ruby-keyword kw">end</span>
147:             
148:           <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:attribute_equal</span>
149:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/=/</span>)  <span class="ruby-comment cmt">#/</span>
150:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:operator</span>
151:               <span class="ruby-identifier">state</span> = <span class="ruby-identifier">:attribute_value</span>
152:             <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">scan</span>(<span class="ruby-node">/#{ATTR_NAME}/o</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">scan</span>(<span class="ruby-node">/#{TAG_END}/o</span>)
153:               <span class="ruby-identifier">state</span> = <span class="ruby-identifier">:attribute</span>
154:               <span class="ruby-keyword kw">next</span>
155:             <span class="ruby-keyword kw">else</span>
156:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">getch</span>, <span class="ruby-identifier">:error</span>
157:               <span class="ruby-identifier">state</span> = <span class="ruby-identifier">:attribute</span>
158:             <span class="ruby-keyword kw">end</span>
159:             
160:           <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:attribute_value</span>
161:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-node">/#{ATTR_NAME}/o</span>)
162:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:attribute_value</span>
163:               <span class="ruby-identifier">state</span> = <span class="ruby-identifier">:attribute</span>
164:             <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/[&quot;']/</span>)
165:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">in_attribute</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:script</span>
166:                 <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">begin_group</span> <span class="ruby-identifier">:inline</span>
167:                 <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:inline_delimiter</span>
168:                 <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/javascript:[ \t]*/</span>)
169:                   <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">matched</span>, <span class="ruby-identifier">:comment</span>
170:                 <span class="ruby-keyword kw">end</span>
171:                 <span class="ruby-identifier">code</span> = <span class="ruby-identifier">scan_until</span>(<span class="ruby-identifier">match</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'&quot;'</span> <span class="ruby-operator">?</span> <span class="ruby-regexp re">/(?=&quot;|\z)/</span> <span class="ruby-operator">:</span> <span class="ruby-regexp re">/(?='|\z)/</span>)
172:                 <span class="ruby-identifier">scan_java_script</span> <span class="ruby-identifier">encoder</span>, <span class="ruby-identifier">code</span>
173:                 <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/[&quot;']/</span>)
174:                 <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:inline_delimiter</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">match</span>
175:                 <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">end_group</span> <span class="ruby-identifier">:inline</span>
176:                 <span class="ruby-identifier">state</span> = <span class="ruby-identifier">:attribute</span>
177:                 <span class="ruby-identifier">in_attribute</span> = <span class="ruby-keyword kw">nil</span>
178:               <span class="ruby-keyword kw">else</span>
179:                 <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">begin_group</span> <span class="ruby-identifier">:string</span>
180:                 <span class="ruby-identifier">state</span> = <span class="ruby-identifier">:attribute_value_string</span>
181:                 <span class="ruby-identifier">plain_string_content</span> = <span class="ruby-constant">PLAIN_STRING_CONTENT</span>[<span class="ruby-identifier">match</span>]
182:                 <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:delimiter</span>
183:               <span class="ruby-keyword kw">end</span>
184:             <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-node">/#{TAG_END}/o</span>)
185:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:tag</span>
186:               <span class="ruby-identifier">state</span> = <span class="ruby-identifier">:initial</span>
187:             <span class="ruby-keyword kw">else</span>
188:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">getch</span>, <span class="ruby-identifier">:error</span>
189:             <span class="ruby-keyword kw">end</span>
190:             
191:           <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:attribute_value_string</span>
192:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-identifier">plain_string_content</span>)
193:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:content</span>
194:             <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/['&quot;]/</span>)
195:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:delimiter</span>
196:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">end_group</span> <span class="ruby-identifier">:string</span>
197:               <span class="ruby-identifier">state</span> = <span class="ruby-identifier">:attribute</span>
198:             <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-node">/#{ENTITY}/o</span><span class="ruby-identifier">x</span>)
199:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:entity</span>
200:             <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/&amp;/</span>)
201:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:content</span>
202:             <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/[\n&gt;]/</span>)
203:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">end_group</span> <span class="ruby-identifier">:string</span>
204:               <span class="ruby-identifier">state</span> = <span class="ruby-identifier">:initial</span>
205:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:error</span>
206:             <span class="ruby-keyword kw">end</span>
207:             
208:           <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:in_special_tag</span>
209:             <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">in_tag</span>
210:             <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'script'</span>
211:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:space</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/[ \t]*\n/</span>)
212:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/(\s*&lt;!--)(?:(.*?)(--&gt;)|(.*))/</span><span class="ruby-identifier">m</span>)
213:                 <span class="ruby-identifier">code</span> = <span class="ruby-keyword kw">self</span>[<span class="ruby-value">2</span>] <span class="ruby-operator">||</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-value">4</span>]
214:                 <span class="ruby-identifier">closing</span> = <span class="ruby-keyword kw">self</span>[<span class="ruby-value">3</span>]
215:                 <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-value">1</span>], <span class="ruby-identifier">:comment</span>
216:               <span class="ruby-keyword kw">else</span>
217:                 <span class="ruby-identifier">code</span> = <span class="ruby-identifier">scan_until</span>(<span class="ruby-regexp re">/(?=(?:\n\s*)?&lt;\/script&gt;)|\z/</span>)
218:                 <span class="ruby-identifier">closing</span> = <span class="ruby-keyword kw">false</span>
219:               <span class="ruby-keyword kw">end</span>
220:               <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">code</span>.<span class="ruby-identifier">empty?</span>
221:                 <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">begin_group</span> <span class="ruby-identifier">:inline</span>
222:                 <span class="ruby-identifier">scan_java_script</span> <span class="ruby-identifier">encoder</span>, <span class="ruby-identifier">code</span>
223:                 <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">end_group</span> <span class="ruby-identifier">:inline</span>
224:               <span class="ruby-keyword kw">end</span>
225:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">closing</span>, <span class="ruby-identifier">:comment</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">closing</span>
226:               <span class="ruby-identifier">state</span> = <span class="ruby-identifier">:initial</span>
227:             <span class="ruby-keyword kw">else</span>
228:               <span class="ruby-identifier">raise</span> <span class="ruby-value str">'unknown special tag: %p'</span> <span class="ruby-operator">%</span> [<span class="ruby-identifier">in_tag</span>]
229:             <span class="ruby-keyword kw">end</span>
230:             
231:           <span class="ruby-keyword kw">else</span>
232:             <span class="ruby-identifier">raise_inspect</span> <span class="ruby-value str">'Unknown state: %p'</span> <span class="ruby-operator">%</span> [<span class="ruby-identifier">state</span>], <span class="ruby-identifier">encoder</span>
233:             
234:           <span class="ruby-keyword kw">end</span>
235:           
236:         <span class="ruby-keyword kw">end</span>
237:         
238:       <span class="ruby-keyword kw">end</span>
239:       
240:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:keep_state</span>]
241:         <span class="ruby-ivar">@state</span> = <span class="ruby-identifier">state</span>
242:         <span class="ruby-ivar">@plain_string_content</span> = <span class="ruby-identifier">plain_string_content</span>
243:       <span class="ruby-keyword kw">end</span>
244:       
245:       <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">end_group</span> <span class="ruby-identifier">:string</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">state</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:attribute_value_string</span>
246:       
247:       <span class="ruby-identifier">encoder</span>
248:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000187">
                    
                    <a name="M000187"></a><b>setup</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000187_source')" id="l_M000187_source">show</a>
                        
                    </p>
                    <div id="M000187_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/coderay/scanners/html.rb, line 69</span>
69:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">setup</span>
70:       <span class="ruby-ivar">@state</span> = <span class="ruby-identifier">:initial</span>
71:       <span class="ruby-ivar">@plain_string_content</span> = <span class="ruby-keyword kw">nil</span>
72:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    