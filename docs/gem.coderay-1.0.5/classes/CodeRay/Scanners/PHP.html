<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>CodeRay::Scanners::PHP</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../../css/main.css" type="text/css" media="screen" />
    <script src="../../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Class</span> 
            CodeRay::Scanners::PHP 
            
                <span class="parent">&lt; 
                    
                    Scanner
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../../files/lib/coderay/scanners/php_rb.html">lib/coderay/scanners/php.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    
    <div class="description">
        <p>
<a href="Scanner.html">Scanner</a> for <a href="PHP.html">PHP</a>.
</p>
<p>
Original by Stefan Walk.
</p>

    </div>
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>R</dt>
        <dd>
            <ul>
                
                <li><a href="#M000196">reset_instance</a></li>
                
            </ul>
        </dd>
    
        <dt>S</dt>
        <dd>
            <ul>
                
                <li><a href="#M000197">scan_tokens</a>,</li>
                
                <li><a href="#M000195">setup</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    

    

    
    <div class="sectiontitle">Classes and Modules</div>
    <ul>
        
        <li><span class="type">MODULE</span> <a href="PHP/RE.html">CodeRay::Scanners::PHP::RE</a></li>
        
        <li><span class="type">MODULE</span> <a href="PHP/Words.html">CodeRay::Scanners::PHP::Words</a></li>
        
    </ul>
    

    
    <div class="sectiontitle">Constants</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class="attr-name">KINDS_NOT_LOC</td>
            <td>=</td>
            <td class="attr-value">HTML::KINDS_NOT_LOC</td>
        </tr>
        
        
    </table>
    

    

    
            <div class="sectiontitle">Instance Protected methods</div>
            
            <div class="method">
                <div class="title" id="M000196">
                    
                    <a name="M000196"></a><b>reset_instance</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000196_source')" id="l_M000196_source">show</a>
                        
                    </p>
                    <div id="M000196_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/coderay/scanners/php.rb, line 23</span>
23:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">reset_instance</span>
24:       <span class="ruby-keyword kw">super</span>
25:       <span class="ruby-ivar">@html_scanner</span>.<span class="ruby-identifier">reset</span>
26:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000197">
                    
                    <a name="M000197"></a><b>scan_tokens</b>(encoder, options)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000197_source')" id="l_M000197_source">show</a>
                        
                    </p>
                    <div id="M000197_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/coderay/scanners/php.rb, line 234</span>
234:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">scan_tokens</span> <span class="ruby-identifier">encoder</span>, <span class="ruby-identifier">options</span>
235:       
236:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">check</span>(<span class="ruby-constant">RE</span><span class="ruby-operator">::</span><span class="ruby-constant">PHP_START</span>) <span class="ruby-operator">||</span>  <span class="ruby-comment cmt"># starts with &lt;?</span>
237:        (<span class="ruby-identifier">match?</span>(<span class="ruby-regexp re">/\s*&lt;\S/</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">check</span>(<span class="ruby-node">/.{1,1000}#{RE::PHP_START}/o</span><span class="ruby-identifier">m</span>)) <span class="ruby-operator">||</span> <span class="ruby-comment cmt"># starts with tag and contains &lt;?</span>
238:        <span class="ruby-identifier">check</span>(<span class="ruby-node">/.{0,1000}#{RE::HTML_INDICATOR}/o</span><span class="ruby-identifier">m</span>) <span class="ruby-operator">||</span>
239:        <span class="ruby-identifier">check</span>(<span class="ruby-node">/.{1,100}#{RE::PHP_START}/o</span><span class="ruby-identifier">m</span>)  <span class="ruby-comment cmt"># PHP start after max 100 chars</span>
240:         <span class="ruby-comment cmt"># is HTML with embedded PHP, so start with HTML</span>
241:         <span class="ruby-identifier">states</span> = [<span class="ruby-identifier">:initial</span>]
242:       <span class="ruby-keyword kw">else</span>
243:         <span class="ruby-comment cmt"># is just PHP, so start with PHP surrounded by HTML</span>
244:         <span class="ruby-identifier">states</span> = [<span class="ruby-identifier">:initial</span>, <span class="ruby-identifier">:php</span>]
245:       <span class="ruby-keyword kw">end</span>
246:       
247:       <span class="ruby-identifier">label_expected</span> = <span class="ruby-keyword kw">true</span>
248:       <span class="ruby-identifier">case_expected</span> = <span class="ruby-keyword kw">false</span>
249:       
250:       <span class="ruby-identifier">heredoc_delimiter</span> = <span class="ruby-keyword kw">nil</span>
251:       <span class="ruby-identifier">delimiter</span> = <span class="ruby-keyword kw">nil</span>
252:       <span class="ruby-identifier">modifier</span> = <span class="ruby-keyword kw">nil</span>
253:       
254:       <span class="ruby-keyword kw">until</span> <span class="ruby-identifier">eos?</span>
255:         
256:         <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">states</span>.<span class="ruby-identifier">last</span>
257:         
258:         <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:initial</span>  <span class="ruby-comment cmt"># HTML</span>
259:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-constant">RE</span><span class="ruby-operator">::</span><span class="ruby-constant">PHP_START</span>)
260:             <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:inline_delimiter</span>
261:             <span class="ruby-identifier">label_expected</span> = <span class="ruby-keyword kw">true</span>
262:             <span class="ruby-identifier">states</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">:php</span>
263:           <span class="ruby-keyword kw">else</span>
264:             <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan_until</span>(<span class="ruby-node">/(?=#{RE::PHP_START})/o</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">scan_rest</span>
265:             <span class="ruby-ivar">@html_scanner</span>.<span class="ruby-identifier">tokenize</span> <span class="ruby-identifier">match</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">match</span>.<span class="ruby-identifier">empty?</span>
266:           <span class="ruby-keyword kw">end</span>
267:         
268:         <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:php</span>
269:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\s+/</span>)
270:             <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:space</span>
271:           
272:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-node">%r! (?m: \/\* (?: .*? \*\/ | .* ) ) | (?://|\#) .*? (?=#{RE::PHP_END}|$) !</span><span class="ruby-identifier">xo</span>)
273:             <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:comment</span>
274:           
275:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-constant">RE</span><span class="ruby-operator">::</span><span class="ruby-constant">IDENTIFIER</span>)
276:             <span class="ruby-identifier">kind</span> = <span class="ruby-constant">Words</span><span class="ruby-operator">::</span><span class="ruby-constant">IDENT_KIND</span>[<span class="ruby-identifier">match</span>]
277:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">kind</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:ident</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">label_expected</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">check</span>(<span class="ruby-regexp re">/:(?!:)/</span>)
278:               <span class="ruby-identifier">kind</span> = <span class="ruby-identifier">:label</span>
279:               <span class="ruby-identifier">label_expected</span> = <span class="ruby-keyword kw">true</span>
280:             <span class="ruby-keyword kw">else</span>
281:               <span class="ruby-identifier">label_expected</span> = <span class="ruby-keyword kw">false</span>
282:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">kind</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:ident</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">match</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/^[A-Z]/</span>
283:                 <span class="ruby-identifier">kind</span> = <span class="ruby-identifier">:constant</span>
284:               <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">kind</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:keyword</span>
285:                 <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">match</span>
286:                 <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'class'</span>
287:                   <span class="ruby-identifier">states</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">:class_expected</span>
288:                 <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'function'</span>
289:                   <span class="ruby-identifier">states</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">:function_expected</span>
290:                 <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'case'</span>, <span class="ruby-value str">'default'</span>
291:                   <span class="ruby-identifier">case_expected</span> = <span class="ruby-keyword kw">true</span>
292:                 <span class="ruby-keyword kw">end</span>
293:               <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">match</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'b'</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">check</span>(<span class="ruby-regexp re">/['&quot;]/</span>)  <span class="ruby-comment cmt"># binary string literal</span>
294:                 <span class="ruby-identifier">modifier</span> = <span class="ruby-identifier">match</span>
295:                 <span class="ruby-keyword kw">next</span>
296:               <span class="ruby-keyword kw">end</span>
297:             <span class="ruby-keyword kw">end</span>
298:             <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">kind</span>
299:           
300:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/(?:\d+\.\d*|\d*\.\d+)(?:e[-+]?\d+)?|\d+e[-+]?\d+/i</span>)
301:             <span class="ruby-identifier">label_expected</span> = <span class="ruby-keyword kw">false</span>
302:             <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:float</span>
303:           
304:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/0x[0-9a-fA-F]+/</span>)
305:             <span class="ruby-identifier">label_expected</span> = <span class="ruby-keyword kw">false</span>
306:             <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:hex</span>
307:           
308:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\d+/</span>)
309:             <span class="ruby-identifier">label_expected</span> = <span class="ruby-keyword kw">false</span>
310:             <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:integer</span>
311:           
312:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/['&quot;`]/</span>)
313:             <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">begin_group</span> <span class="ruby-identifier">:string</span>
314:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">modifier</span>
315:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">modifier</span>, <span class="ruby-identifier">:modifier</span>
316:               <span class="ruby-identifier">modifier</span> = <span class="ruby-keyword kw">nil</span>
317:             <span class="ruby-keyword kw">end</span>
318:             <span class="ruby-identifier">delimiter</span> = <span class="ruby-identifier">match</span>
319:             <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:delimiter</span>
320:             <span class="ruby-identifier">states</span>.<span class="ruby-identifier">push</span> <span class="ruby-identifier">match</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;'&quot;</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">:sqstring</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">:dqstring</span>
321:           
322:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-constant">RE</span><span class="ruby-operator">::</span><span class="ruby-constant">VARIABLE</span>)
323:             <span class="ruby-identifier">label_expected</span> = <span class="ruby-keyword kw">false</span>
324:             <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-constant">Words</span><span class="ruby-operator">::</span><span class="ruby-constant">VARIABLE_KIND</span>[<span class="ruby-identifier">match</span>]
325:           
326:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\{/</span>)
327:             <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:operator</span>
328:             <span class="ruby-identifier">label_expected</span> = <span class="ruby-keyword kw">true</span>
329:             <span class="ruby-identifier">states</span>.<span class="ruby-identifier">push</span> <span class="ruby-identifier">:php</span>
330:           
331:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\}/</span>)
332:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">states</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span>
333:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:error</span>
334:             <span class="ruby-keyword kw">else</span>
335:               <span class="ruby-identifier">states</span>.<span class="ruby-identifier">pop</span>
336:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">states</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-operator">::</span><span class="ruby-constant">Array</span>)
337:                 <span class="ruby-identifier">delimiter</span> = <span class="ruby-identifier">states</span>.<span class="ruby-identifier">last</span>[<span class="ruby-value">1</span>]
338:                 <span class="ruby-identifier">states</span>[<span class="ruby-value">-1</span>] = <span class="ruby-identifier">states</span>.<span class="ruby-identifier">last</span>[<span class="ruby-value">0</span>]
339:                 <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:delimiter</span>
340:                 <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">end_group</span> <span class="ruby-identifier">:inline</span>
341:               <span class="ruby-keyword kw">else</span>
342:                 <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:operator</span>
343:                 <span class="ruby-identifier">label_expected</span> = <span class="ruby-keyword kw">true</span>
344:               <span class="ruby-keyword kw">end</span>
345:             <span class="ruby-keyword kw">end</span>
346:           
347:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/@/</span>)
348:             <span class="ruby-identifier">label_expected</span> = <span class="ruby-keyword kw">false</span>
349:             <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:exception</span>
350:           
351:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-constant">RE</span><span class="ruby-operator">::</span><span class="ruby-constant">PHP_END</span>)
352:             <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:inline_delimiter</span>
353:             <span class="ruby-identifier">states</span> = [<span class="ruby-identifier">:initial</span>]
354:           
355:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-node">/&lt;&lt;&lt;(?:(#{RE::IDENTIFIER})|&quot;(#{RE::IDENTIFIER})&quot;|'(#{RE::IDENTIFIER})')/o</span>)
356:             <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">begin_group</span> <span class="ruby-identifier">:string</span>
357:             <span class="ruby-comment cmt"># warn 'heredoc in heredoc?' if heredoc_delimiter</span>
358:             <span class="ruby-identifier">heredoc_delimiter</span> = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">escape</span>(<span class="ruby-keyword kw">self</span>[<span class="ruby-value">1</span>] <span class="ruby-operator">||</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-value">2</span>] <span class="ruby-operator">||</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-value">3</span>])
359:             <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:delimiter</span>
360:             <span class="ruby-identifier">states</span>.<span class="ruby-identifier">push</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-value">3</span>] <span class="ruby-operator">?</span> <span class="ruby-identifier">:sqstring</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">:dqstring</span>
361:             <span class="ruby-identifier">heredoc_delimiter</span> = <span class="ruby-node">/#{heredoc_delimiter}(?=;?$)/</span>
362:           
363:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-node">/#{RE::OPERATOR}/o</span>)
364:             <span class="ruby-identifier">label_expected</span> = <span class="ruby-identifier">match</span> <span class="ruby-operator">==</span> <span class="ruby-value str">';'</span>
365:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">case_expected</span>
366:               <span class="ruby-identifier">label_expected</span> = <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">match</span> <span class="ruby-operator">==</span> <span class="ruby-value str">':'</span>
367:               <span class="ruby-identifier">case_expected</span> = <span class="ruby-keyword kw">false</span>
368:             <span class="ruby-keyword kw">end</span>
369:             <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:operator</span>
370:           
371:           <span class="ruby-keyword kw">else</span>
372:             <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">getch</span>, <span class="ruby-identifier">:error</span>
373:           
374:           <span class="ruby-keyword kw">end</span>
375:         
376:         <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:sqstring</span>
377:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-identifier">heredoc_delimiter</span> <span class="ruby-value">? </span><span class="ruby-operator">/</span>[<span class="ruby-operator">^</span>\\\<span class="ruby-identifier">n</span>]<span class="ruby-operator">+</span><span class="ruby-regexp re">/ : /</span>[<span class="ruby-operator">^</span><span class="ruby-value str">'\\]+/)
378:             encoder.text_token match, :content
379:           elsif !heredoc_delimiter &amp;&amp; match = scan(/'</span><span class="ruby-operator">/</span>)
380:             <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:delimiter</span>
381:             <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">end_group</span> <span class="ruby-identifier">:string</span>
382:             <span class="ruby-identifier">delimiter</span> = <span class="ruby-keyword kw">nil</span>
383:             <span class="ruby-identifier">label_expected</span> = <span class="ruby-keyword kw">false</span>
384:             <span class="ruby-identifier">states</span>.<span class="ruby-identifier">pop</span>
385:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">heredoc_delimiter</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\n/</span>)
386:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">scan</span> <span class="ruby-identifier">heredoc_delimiter</span>
387:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-value str">&quot;\n&quot;</span>, <span class="ruby-identifier">:content</span>
388:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">matched</span>, <span class="ruby-identifier">:delimiter</span>
389:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">end_group</span> <span class="ruby-identifier">:string</span>
390:               <span class="ruby-identifier">heredoc_delimiter</span> = <span class="ruby-keyword kw">nil</span>
391:               <span class="ruby-identifier">label_expected</span> = <span class="ruby-keyword kw">false</span>
392:               <span class="ruby-identifier">states</span>.<span class="ruby-identifier">pop</span>
393:             <span class="ruby-keyword kw">else</span>
394:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:content</span>
395:             <span class="ruby-keyword kw">end</span>
396:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-identifier">heredoc_delimiter</span> <span class="ruby-value">? </span><span class="ruby-operator">/</span>\\\\<span class="ruby-regexp re">/ : /</span>\\[\\<span class="ruby-value str">'\n]/)
397:             encoder.text_token match, :char
398:           elsif match = scan(/\\./m)
399:             encoder.text_token match, :content
400:           elsif match = scan(/\\/)
401:             encoder.text_token match, :error
402:           else
403:             states.pop
404:           end
405:         
406:         when :dqstring
407:           if match = scan(heredoc_delimiter ? /[^${\\\n]+/ : (delimiter == '</span><span class="ruby-value str">&quot;' ? /[^&quot;</span>${\\]<span class="ruby-operator">+</span><span class="ruby-regexp re">/ : /</span>[<span class="ruby-operator">^</span><span class="ruby-value">`${\\]+/))
408:             encoder.text_token match, :content
409:           elsif !heredoc_delimiter &amp;&amp; match = scan(delimiter == '&quot;' ? /&quot;/ : /`</span><span class="ruby-operator">/</span>)
410:             <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:delimiter</span>
411:             <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">end_group</span> <span class="ruby-identifier">:string</span>
412:             <span class="ruby-identifier">delimiter</span> = <span class="ruby-keyword kw">nil</span>
413:             <span class="ruby-identifier">label_expected</span> = <span class="ruby-keyword kw">false</span>
414:             <span class="ruby-identifier">states</span>.<span class="ruby-identifier">pop</span>
415:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">heredoc_delimiter</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\n/</span>)
416:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">scan</span> <span class="ruby-identifier">heredoc_delimiter</span>
417:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-value str">&quot;\n&quot;</span>, <span class="ruby-identifier">:content</span>
418:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">matched</span>, <span class="ruby-identifier">:delimiter</span>
419:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">end_group</span> <span class="ruby-identifier">:string</span>
420:               <span class="ruby-identifier">heredoc_delimiter</span> = <span class="ruby-keyword kw">nil</span>
421:               <span class="ruby-identifier">label_expected</span> = <span class="ruby-keyword kw">false</span>
422:               <span class="ruby-identifier">states</span>.<span class="ruby-identifier">pop</span>
423:             <span class="ruby-keyword kw">else</span>
424:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:content</span>
425:             <span class="ruby-keyword kw">end</span>
426:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\\(?:x[0-9A-Fa-f]{1,2}|[0-7]{1,3})/</span>)
427:             <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:char</span>
428:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-identifier">heredoc_delimiter</span> <span class="ruby-value">? </span><span class="ruby-operator">/</span>\\[<span class="ruby-identifier">nrtvf</span>\\$]<span class="ruby-operator">/</span> <span class="ruby-operator">:</span> (<span class="ruby-identifier">delimiter</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'&quot;'</span> <span class="ruby-operator">?</span> <span class="ruby-regexp re">/\\[nrtvf\\$&quot;]/</span> <span class="ruby-operator">:</span> <span class="ruby-regexp re">/\\[nrtvf\\$`]/</span>))
429:             <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:char</span>
430:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\\./</span><span class="ruby-identifier">m</span>)
431:             <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:content</span>
432:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\\/</span>)
433:             <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:error</span>
434:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-node">/#{RE::VARIABLE}/o</span>)
435:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">check</span>(<span class="ruby-node">/\[#{RE::IDENTIFIER}\]/o</span>)
436:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">begin_group</span> <span class="ruby-identifier">:inline</span>
437:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:local_variable</span>
438:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\[/</span>), <span class="ruby-identifier">:operator</span>
439:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">scan</span>(<span class="ruby-node">/#{RE::IDENTIFIER}/o</span>), <span class="ruby-identifier">:ident</span>
440:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\]/</span>), <span class="ruby-identifier">:operator</span>
441:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">end_group</span> <span class="ruby-identifier">:inline</span>
442:             <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">check</span>(<span class="ruby-regexp re">/\[/</span>)
443:               <span class="ruby-identifier">match</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">scan</span>(<span class="ruby-node">/\[['&quot;]?#{RE::IDENTIFIER}?['&quot;]?\]?/o</span>)
444:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:error</span>
445:             <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">check</span>(<span class="ruby-node">/-&gt;#{RE::IDENTIFIER}/o</span>)
446:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">begin_group</span> <span class="ruby-identifier">:inline</span>
447:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:local_variable</span>
448:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/-&gt;/</span>), <span class="ruby-identifier">:operator</span>
449:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">scan</span>(<span class="ruby-node">/#{RE::IDENTIFIER}/o</span>), <span class="ruby-identifier">:ident</span>
450:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">end_group</span> <span class="ruby-identifier">:inline</span>
451:             <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">check</span>(<span class="ruby-regexp re">/-&gt;/</span>)
452:               <span class="ruby-identifier">match</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/-&gt;/</span>)
453:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:error</span>
454:             <span class="ruby-keyword kw">else</span>
455:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:local_variable</span>
456:             <span class="ruby-keyword kw">end</span>
457:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\{/</span>)
458:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">check</span>(<span class="ruby-regexp re">/\$/</span>)
459:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">begin_group</span> <span class="ruby-identifier">:inline</span>
460:               <span class="ruby-identifier">states</span>[<span class="ruby-value">-1</span>] = [<span class="ruby-identifier">states</span>.<span class="ruby-identifier">last</span>, <span class="ruby-identifier">delimiter</span>]
461:               <span class="ruby-identifier">delimiter</span> = <span class="ruby-keyword kw">nil</span>
462:               <span class="ruby-identifier">states</span>.<span class="ruby-identifier">push</span> <span class="ruby-identifier">:php</span>
463:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:delimiter</span>
464:             <span class="ruby-keyword kw">else</span>
465:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:content</span>
466:             <span class="ruby-keyword kw">end</span>
467:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-node">/\$\{#{RE::IDENTIFIER}\}/o</span>)
468:             <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:local_variable</span>
469:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\$/</span>)
470:             <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:content</span>
471:           <span class="ruby-keyword kw">else</span>
472:             <span class="ruby-identifier">states</span>.<span class="ruby-identifier">pop</span>
473:           <span class="ruby-keyword kw">end</span>
474:         
475:         <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:class_expected</span>
476:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\s+/</span>)
477:             <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:space</span>
478:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-node">/#{RE::IDENTIFIER}/o</span>)
479:             <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:class</span>
480:             <span class="ruby-identifier">states</span>.<span class="ruby-identifier">pop</span>
481:           <span class="ruby-keyword kw">else</span>
482:             <span class="ruby-identifier">states</span>.<span class="ruby-identifier">pop</span>
483:           <span class="ruby-keyword kw">end</span>
484:         
485:         <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:function_expected</span>
486:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\s+/</span>)
487:             <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:space</span>
488:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/&amp;/</span>)
489:             <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:operator</span>
490:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-node">/#{RE::IDENTIFIER}/o</span>)
491:             <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:function</span>
492:             <span class="ruby-identifier">states</span>.<span class="ruby-identifier">pop</span>
493:           <span class="ruby-keyword kw">else</span>
494:             <span class="ruby-identifier">states</span>.<span class="ruby-identifier">pop</span>
495:           <span class="ruby-keyword kw">end</span>
496:         
497:         <span class="ruby-keyword kw">else</span>
498:           <span class="ruby-identifier">raise_inspect</span> <span class="ruby-value str">'Unknown state!'</span>, <span class="ruby-identifier">encoder</span>, <span class="ruby-identifier">states</span>
499:         <span class="ruby-keyword kw">end</span>
500:         
501:       <span class="ruby-keyword kw">end</span>
502:       
503:       <span class="ruby-identifier">encoder</span>
504:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000195">
                    
                    <a name="M000195"></a><b>setup</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000195_source')" id="l_M000195_source">show</a>
                        
                    </p>
                    <div id="M000195_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/coderay/scanners/php.rb, line 19</span>
19:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">setup</span>
20:       <span class="ruby-ivar">@html_scanner</span> = <span class="ruby-constant">CodeRay</span>.<span class="ruby-identifier">scanner</span> <span class="ruby-identifier">:html</span>, <span class="ruby-identifier">:tokens</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@tokens</span>, <span class="ruby-identifier">:keep_tokens</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>, <span class="ruby-identifier">:keep_state</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>
21:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    