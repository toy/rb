<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>CodeRay::Scanners::Clojure</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../../css/main.css" type="text/css" media="screen" />
    <script src="../../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Class</span> 
            CodeRay::Scanners::Clojure 
            
                <span class="parent">&lt; 
                    
                    Scanner
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../../files/lib/coderay/scanners/clojure_rb.html">lib/coderay/scanners/clojure.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    
    <div class="description">
        <p>
<a href="Clojure.html">Clojure</a> scanner by Licenser.
</p>

    </div>
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>S</dt>
        <dd>
            <ul>
                
                <li><a href="#M000172">scan_tokens</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    

    

    

    
    <div class="sectiontitle">Constants</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class="attr-name">IDENT_KIND</td>
            <td>=</td>
            <td class="attr-value">WordList.new(:ident).         add(SPECIAL_FORMS, :keyword).         add(CORE_FORMS, :keyword).         add(PREDEFINED_CONSTANTS, :predefined_constant)</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">KEYWORD_NEXT_TOKEN_KIND</td>
            <td>=</td>
            <td class="attr-value">WordList.new(nil).         add(%w[ def defn defn- definline defmacro defmulti defmethod defstruct defonce declare ], :function).         add(%w[ ns ], :namespace).         add(%w[ defprotocol defrecord ], :class)</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">BASIC_IDENTIFIER</td>
            <td>=</td>
            <td class="attr-value">/[a-zA-Z$%*\/_+!?&amp;&lt;&gt;\-=]=?[a-zA-Z0-9$&amp;*+!\/_?&lt;&gt;\-\#]*/</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">IDENTIFIER</td>
            <td>=</td>
            <td class="attr-value">/(?!-\d)(?:(?:#{BASIC_IDENTIFIER}\.)*#{BASIC_IDENTIFIER}(?:\/#{BASIC_IDENTIFIER})?\.?)|\.\.?/</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">SYMBOL</td>
            <td>=</td>
            <td class="attr-value">/::?#{IDENTIFIER}/o</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">DIGIT</td>
            <td>=</td>
            <td class="attr-value">/\d/</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">DIGIT10</td>
            <td>=</td>
            <td class="attr-value">DIGIT</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">DIGIT16</td>
            <td>=</td>
            <td class="attr-value">/[0-9a-f]/i</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">DIGIT8</td>
            <td>=</td>
            <td class="attr-value">/[0-7]/</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">DIGIT2</td>
            <td>=</td>
            <td class="attr-value">/[01]/</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">RADIX16</td>
            <td>=</td>
            <td class="attr-value">/\#x/i</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">RADIX8</td>
            <td>=</td>
            <td class="attr-value">/\#o/i</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">RADIX2</td>
            <td>=</td>
            <td class="attr-value">/\#b/i</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">RADIX10</td>
            <td>=</td>
            <td class="attr-value">/\#d/i</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">EXACTNESS</td>
            <td>=</td>
            <td class="attr-value">/#i|#e/i</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">SIGN</td>
            <td>=</td>
            <td class="attr-value">/[\+-]?/</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">EXP_MARK</td>
            <td>=</td>
            <td class="attr-value">/[esfdl]/i</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">EXP</td>
            <td>=</td>
            <td class="attr-value">/#{EXP_MARK}#{SIGN}#{DIGIT}+/</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">SUFFIX</td>
            <td>=</td>
            <td class="attr-value">/#{EXP}?/</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">PREFIX10</td>
            <td>=</td>
            <td class="attr-value">/#{RADIX10}?#{EXACTNESS}?|#{EXACTNESS}?#{RADIX10}?/</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">PREFIX16</td>
            <td>=</td>
            <td class="attr-value">/#{RADIX16}#{EXACTNESS}?|#{EXACTNESS}?#{RADIX16}/</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">PREFIX8</td>
            <td>=</td>
            <td class="attr-value">/#{RADIX8}#{EXACTNESS}?|#{EXACTNESS}?#{RADIX8}/</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">PREFIX2</td>
            <td>=</td>
            <td class="attr-value">/#{RADIX2}#{EXACTNESS}?|#{EXACTNESS}?#{RADIX2}/</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">UINT10</td>
            <td>=</td>
            <td class="attr-value">/#{DIGIT10}+#*/</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">UINT16</td>
            <td>=</td>
            <td class="attr-value">/#{DIGIT16}+#*/</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">UINT8</td>
            <td>=</td>
            <td class="attr-value">/#{DIGIT8}+#*/</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">UINT2</td>
            <td>=</td>
            <td class="attr-value">/#{DIGIT2}+#*/</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">DECIMAL</td>
            <td>=</td>
            <td class="attr-value">/#{DIGIT10}+#+\.#*#{SUFFIX}|#{DIGIT10}+\.#{DIGIT10}*#*#{SUFFIX}|\.#{DIGIT10}+#*#{SUFFIX}|#{UINT10}#{EXP}/</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">UREAL10</td>
            <td>=</td>
            <td class="attr-value">/#{UINT10}\/#{UINT10}|#{DECIMAL}|#{UINT10}/</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">UREAL16</td>
            <td>=</td>
            <td class="attr-value">/#{UINT16}\/#{UINT16}|#{UINT16}/</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">UREAL8</td>
            <td>=</td>
            <td class="attr-value">/#{UINT8}\/#{UINT8}|#{UINT8}/</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">UREAL2</td>
            <td>=</td>
            <td class="attr-value">/#{UINT2}\/#{UINT2}|#{UINT2}/</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">REAL10</td>
            <td>=</td>
            <td class="attr-value">/#{SIGN}#{UREAL10}/</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">REAL16</td>
            <td>=</td>
            <td class="attr-value">/#{SIGN}#{UREAL16}/</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">REAL8</td>
            <td>=</td>
            <td class="attr-value">/#{SIGN}#{UREAL8}/</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">REAL2</td>
            <td>=</td>
            <td class="attr-value">/#{SIGN}#{UREAL2}/</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">IMAG10</td>
            <td>=</td>
            <td class="attr-value">/i|#{UREAL10}i/</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">IMAG16</td>
            <td>=</td>
            <td class="attr-value">/i|#{UREAL16}i/</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">IMAG8</td>
            <td>=</td>
            <td class="attr-value">/i|#{UREAL8}i/</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">IMAG2</td>
            <td>=</td>
            <td class="attr-value">/i|#{UREAL2}i/</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">COMPLEX10</td>
            <td>=</td>
            <td class="attr-value">/#{REAL10}@#{REAL10}|#{REAL10}\+#{IMAG10}|#{REAL10}-#{IMAG10}|\+#{IMAG10}|-#{IMAG10}|#{REAL10}/</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">COMPLEX16</td>
            <td>=</td>
            <td class="attr-value">/#{REAL16}@#{REAL16}|#{REAL16}\+#{IMAG16}|#{REAL16}-#{IMAG16}|\+#{IMAG16}|-#{IMAG16}|#{REAL16}/</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">COMPLEX8</td>
            <td>=</td>
            <td class="attr-value">/#{REAL8}@#{REAL8}|#{REAL8}\+#{IMAG8}|#{REAL8}-#{IMAG8}|\+#{IMAG8}|-#{IMAG8}|#{REAL8}/</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">COMPLEX2</td>
            <td>=</td>
            <td class="attr-value">/#{REAL2}@#{REAL2}|#{REAL2}\+#{IMAG2}|#{REAL2}-#{IMAG2}|\+#{IMAG2}|-#{IMAG2}|#{REAL2}/</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">NUM10</td>
            <td>=</td>
            <td class="attr-value">/#{PREFIX10}?#{COMPLEX10}/</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">NUM16</td>
            <td>=</td>
            <td class="attr-value">/#{PREFIX16}#{COMPLEX16}/</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">NUM8</td>
            <td>=</td>
            <td class="attr-value">/#{PREFIX8}#{COMPLEX8}/</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">NUM2</td>
            <td>=</td>
            <td class="attr-value">/#{PREFIX2}#{COMPLEX2}/</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">NUM</td>
            <td>=</td>
            <td class="attr-value">/#{NUM10}|#{NUM16}|#{NUM8}|#{NUM2}/</td>
        </tr>
        
        
    </table>
    

    

    
            <div class="sectiontitle">Instance Protected methods</div>
            
            <div class="method">
                <div class="title" id="M000172">
                    
                    <a name="M000172"></a><b>scan_tokens</b>(encoder, options)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000172_source')" id="l_M000172_source">show</a>
                        
                    </p>
                    <div id="M000172_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/coderay/scanners/clojure.rb, line 145</span>
145:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">scan_tokens</span> <span class="ruby-identifier">encoder</span>, <span class="ruby-identifier">options</span>
146:         
147:         <span class="ruby-identifier">state</span> = <span class="ruby-identifier">:initial</span>
148:         <span class="ruby-identifier">kind</span> = <span class="ruby-keyword kw">nil</span>
149:         
150:         <span class="ruby-keyword kw">until</span> <span class="ruby-identifier">eos?</span>
151:           
152:           <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">state</span>
153:           <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:initial</span>
154:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/ \s+ | \\\n | , /</span><span class="ruby-identifier">x</span>)
155:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:space</span>
156:             <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/['`\(\[\)\]\{\}]|\#[({]|~@?|[@\^]/</span>)
157:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:operator</span>
158:             <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/;.*/</span>)
159:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:comment</span>  <span class="ruby-comment cmt"># TODO: recognize (comment ...) too</span>
160:             <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\#?\\(?:newline|space|.?)/</span>)
161:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:char</span>
162:             <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\#[ft]/</span>)
163:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:predefined_constant</span>
164:             <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-node">/#{IDENTIFIER}/o</span>)
165:               <span class="ruby-identifier">kind</span> = <span class="ruby-constant">IDENT_KIND</span>[<span class="ruby-identifier">match</span>]
166:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">kind</span>
167:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">rest?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">kind</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:keyword</span>
168:                 <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">kind</span> = <span class="ruby-constant">KEYWORD_NEXT_TOKEN_KIND</span>[<span class="ruby-identifier">match</span>]
169:                   <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:space</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\s+/o</span>)
170:                   <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">kind</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-node">/#{IDENTIFIER}/o</span>)
171:                 <span class="ruby-keyword kw">end</span>
172:               <span class="ruby-keyword kw">end</span>
173:             <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-node">/#{SYMBOL}/o</span>)
174:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:symbol</span>
175:             <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\./</span>)
176:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:operator</span>
177:             <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-node">/ \# \^ #{IDENTIFIER} /o</span><span class="ruby-identifier">x</span>)
178:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:type</span>
179:             <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/ (\#)? &quot; /</span><span class="ruby-identifier">x</span>)
180:               <span class="ruby-identifier">state</span> = <span class="ruby-keyword kw">self</span>[<span class="ruby-value">1</span>] <span class="ruby-operator">?</span> <span class="ruby-identifier">:regexp</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">:string</span>
181:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">begin_group</span> <span class="ruby-identifier">state</span>
182:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:delimiter</span>
183:             <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-node">/#{NUM}/o</span>) <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">not</span> <span class="ruby-identifier">matched</span>.<span class="ruby-identifier">empty?</span>
184:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">match</span>[<span class="ruby-regexp re">/[.e\/]/i</span>] <span class="ruby-operator">?</span> <span class="ruby-identifier">:float</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">:integer</span>
185:             <span class="ruby-keyword kw">else</span>
186:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">getch</span>, <span class="ruby-identifier">:error</span>
187:             <span class="ruby-keyword kw">end</span>
188:             
189:           <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:string</span>, <span class="ruby-identifier">:regexp</span>
190:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/[^&quot;\\]+|\\.?/</span>)
191:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:content</span>
192:             <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/&quot;/</span>)
193:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">text_token</span> <span class="ruby-identifier">match</span>, <span class="ruby-identifier">:delimiter</span>
194:               <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">end_group</span> <span class="ruby-identifier">state</span>
195:               <span class="ruby-identifier">state</span> = <span class="ruby-identifier">:initial</span>
196:             <span class="ruby-keyword kw">else</span>
197:               <span class="ruby-identifier">raise_inspect</span> <span class="ruby-value str">&quot;else case \&quot; reached; %p not handled.&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">peek</span>(<span class="ruby-value">1</span>),
198:                 <span class="ruby-identifier">encoder</span>, <span class="ruby-identifier">state</span>
199:             <span class="ruby-keyword kw">end</span>
200:             
201:           <span class="ruby-keyword kw">else</span>
202:             <span class="ruby-identifier">raise</span> <span class="ruby-value str">'else case reached'</span>
203:             
204:           <span class="ruby-keyword kw">end</span>
205:           
206:         <span class="ruby-keyword kw">end</span>
207:         
208:         <span class="ruby-keyword kw">if</span> [<span class="ruby-identifier">:string</span>, <span class="ruby-identifier">:regexp</span>].<span class="ruby-identifier">include?</span> <span class="ruby-identifier">state</span>
209:           <span class="ruby-identifier">encoder</span>.<span class="ruby-identifier">end_group</span> <span class="ruby-identifier">state</span>
210:         <span class="ruby-keyword kw">end</span>
211:         
212:         <span class="ruby-identifier">encoder</span>
213:         
214:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    