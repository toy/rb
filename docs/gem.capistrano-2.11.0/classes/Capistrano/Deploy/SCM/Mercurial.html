<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>Capistrano::Deploy::SCM::Mercurial</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../../../css/main.css" type="text/css" media="screen" />
    <script src="../../../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Class</span> 
            Capistrano::Deploy::SCM::Mercurial 
            
                <span class="parent">&lt; 
                    
                    Base
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../../../files/lib/capistrano/recipes/deploy/scm/mercurial_rb.html">lib/capistrano/recipes/deploy/scm/mercurial.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    
    <div class="description">
        <p>
Implements the <a href="../../../Capistrano.html">Capistrano</a> <a
href="../SCM.html">SCM</a> interface for the <a
href="Mercurial.html">Mercurial</a> revision control system (<a
href="http://www.selenic.com/mercurial/">www.selenic.com/mercurial/</a>).
Latest updates at <a
href="http://tackletechnology.org/oss/cap2-mercurial">tackletechnology.org/oss/cap2-mercurial</a>
</p>

    </div>
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>C</dt>
        <dd>
            <ul>
                
                <li><a href="#M000275">checkout</a>,</li>
                
                <li><a href="#M000286">clone</a></li>
                
            </ul>
        </dd>
    
        <dt>D</dt>
        <dd>
            <ul>
                
                <li><a href="#M000278">diff</a></li>
                
            </ul>
        </dd>
    
        <dt>E</dt>
        <dd>
            <ul>
                
                <li><a href="#M000277">export</a></li>
                
            </ul>
        </dd>
    
        <dt>H</dt>
        <dd>
            <ul>
                
                <li><a href="#M000281">handle_data</a>,</li>
                
                <li><a href="#M000274">head</a></li>
                
            </ul>
        </dd>
    
        <dt>L</dt>
        <dd>
            <ul>
                
                <li><a href="#M000279">log</a></li>
                
            </ul>
        </dd>
    
        <dt>P</dt>
        <dd>
            <ul>
                
                <li><a href="#M000287">pull</a></li>
                
            </ul>
        </dd>
    
        <dt>Q</dt>
        <dd>
            <ul>
                
                <li><a href="#M000280">query_revision</a></li>
                
            </ul>
        </dd>
    
        <dt>S</dt>
        <dd>
            <ul>
                
                <li><a href="#M000291">scm_password_or_prompt</a>,</li>
                
                <li><a href="#M000276">sync</a></li>
                
            </ul>
        </dd>
    
        <dt>U</dt>
        <dd>
            <ul>
                
                <li><a href="#M000288">update</a></li>
                
            </ul>
        </dd>
    
        <dt>V</dt>
        <dd>
            <ul>
                
                <li><a href="#M000290">verbose</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    

    

    

    

    

    
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M000275">
                    
                    <a name="M000275"></a><b>checkout</b>(changeset, destination)
                    
                </div>
                
                <div class="description">
                  <p>
Clone the repository and update to the specified changeset.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000275_source')" id="l_M000275_source">show</a>
                        
                    </p>
                    <div id="M000275_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/capistrano/recipes/deploy/scm/mercurial.rb, line 25</span>
25:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">checkout</span>(<span class="ruby-identifier">changeset</span>, <span class="ruby-identifier">destination</span>)
26:           <span class="ruby-identifier">clone</span>(<span class="ruby-identifier">destination</span>) <span class="ruby-operator">+</span> <span class="ruby-value str">&quot; &amp;&amp; &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">update</span>(<span class="ruby-identifier">changeset</span>, <span class="ruby-identifier">destination</span>)
27:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000278">
                    
                    <a name="M000278"></a><b>diff</b>(from, to=nil)
                    
                </div>
                
                <div class="description">
                  <p>
Compute the difference between the two changesets <tt>from</tt> and
<tt>to</tt> as a unified diff.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000278_source')" id="l_M000278_source">show</a>
                        
                    </p>
                    <div id="M000278_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/capistrano/recipes/deploy/scm/mercurial.rb, line 42</span>
42:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">diff</span>(<span class="ruby-identifier">from</span>, <span class="ruby-identifier">to</span>=<span class="ruby-keyword kw">nil</span>)
43:           <span class="ruby-identifier">scm</span> <span class="ruby-identifier">:diff</span>,
44:               <span class="ruby-node">&quot;--rev #{from}&quot;</span>,
45:               (<span class="ruby-identifier">to</span> <span class="ruby-value">? </span><span class="ruby-node">&quot;--rev #{to}&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-keyword kw">nil</span>)
46:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000277">
                    
                    <a name="M000277"></a><b>export</b>(revision, destination)
                    
                </div>
                
                <div class="description">
                  <p>
One day we will have hg archive, although i think its not needed
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000277_source')" id="l_M000277_source">show</a>
                        
                    </p>
                    <div id="M000277_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/capistrano/recipes/deploy/scm/mercurial.rb, line 35</span>
35:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">export</span>(<span class="ruby-identifier">revision</span>, <span class="ruby-identifier">destination</span>)
36:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">NotImplementedError</span>, <span class="ruby-node">&quot;`diff' is not implemented by #{self.class.name}&quot;</span> <span class="ruby-operator">+</span>
37:           <span class="ruby-value str">&quot;use checkout strategy&quot;</span>
38:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000281">
                    
                    <a name="M000281"></a><b>handle_data</b>(state, stream, text)
                    
                </div>
                
                <div class="description">
                  <p>
Determine response for <a href="../SCM.html">SCM</a> prompts user/pass can
come from ssh and http distribution methods yes/no is for when ssh asks you
about fingerprints
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000281_source')" id="l_M000281_source">show</a>
                        
                    </p>
                    <div id="M000281_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/capistrano/recipes/deploy/scm/mercurial.rb, line 69</span>
69:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">handle_data</span>(<span class="ruby-identifier">state</span>, <span class="ruby-identifier">stream</span>, <span class="ruby-identifier">text</span>)
70:           <span class="ruby-identifier">host</span> = <span class="ruby-identifier">state</span>[<span class="ruby-identifier">:channel</span>][<span class="ruby-identifier">:host</span>]
71:           <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span> <span class="ruby-node">&quot;[#{host} :: #{stream}] #{text}&quot;</span>
72:           <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">text</span>
73:           <span class="ruby-keyword kw">when</span> <span class="ruby-regexp re">/^user:/</span><span class="ruby-identifier">mi</span>
74:             <span class="ruby-comment cmt"># support :scm_user for backwards compatibility of this module</span>
75:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">user</span> = <span class="ruby-identifier">variable</span>(<span class="ruby-identifier">:scm_username</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">variable</span>(<span class="ruby-identifier">:scm_user</span>)
76:               <span class="ruby-node">&quot;#{user}\n&quot;</span>
77:             <span class="ruby-keyword kw">else</span>
78:               <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;No variable :scm_username specified and Mercurial asked!\n&quot;</span> <span class="ruby-operator">+</span>
79:                 <span class="ruby-node">&quot;Prompt was: #{text}&quot;</span>
80:             <span class="ruby-keyword kw">end</span>
81:           <span class="ruby-keyword kw">when</span> <span class="ruby-regexp re">/\bpassword:/</span><span class="ruby-identifier">mi</span>
82:             <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">pass</span> = <span class="ruby-identifier">scm_password_or_prompt</span>
83:               <span class="ruby-comment cmt"># fall back on old behavior of erroring out with msg</span>
84:               <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;No variable :scm_password specified and Mercurial asked!\n&quot;</span> <span class="ruby-operator">+</span>
85:                 <span class="ruby-node">&quot;Prompt was: #{text}&quot;</span>
86:             <span class="ruby-keyword kw">end</span>
87:             <span class="ruby-node">&quot;#{pass}\n&quot;</span>
88:           <span class="ruby-keyword kw">when</span> <span class="ruby-regexp re">/yes\/no/i</span>
89:             <span class="ruby-value str">&quot;yes\n&quot;</span>
90:           <span class="ruby-keyword kw">end</span>
91:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000274">
                    
                    <a name="M000274"></a><b>head</b>()
                    
                </div>
                
                <div class="description">
                  <p>
For mercurial HEAD == tip except that it bases this assumption on what tip
is in the current repository (so push before you deploy)
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000274_source')" id="l_M000274_source">show</a>
                        
                    </p>
                    <div id="M000274_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/capistrano/recipes/deploy/scm/mercurial.rb, line 20</span>
20:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">head</span>
21:           <span class="ruby-identifier">variable</span>(<span class="ruby-identifier">:branch</span>) <span class="ruby-operator">||</span> <span class="ruby-value str">&quot;tip&quot;</span>
22:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000279">
                    
                    <a name="M000279"></a><b>log</b>(from, to=nil)
                    
                </div>
                
                <div class="description">
                  <p>
Return a log of all changes between the two specified changesets,
<tt>from</tt> and <tt>to</tt>, inclusive or the log for <tt>from</tt> if
<tt>to</tt> is omitted.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000279_source')" id="l_M000279_source">show</a>
                        
                    </p>
                    <div id="M000279_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/capistrano/recipes/deploy/scm/mercurial.rb, line 50</span>
50:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">log</span>(<span class="ruby-identifier">from</span>, <span class="ruby-identifier">to</span>=<span class="ruby-keyword kw">nil</span>)
51:           <span class="ruby-identifier">scm</span> <span class="ruby-identifier">:log</span>,
52:               <span class="ruby-identifier">verbose</span>,
53:               <span class="ruby-node">&quot;--rev #{from}&quot;</span> <span class="ruby-operator">+</span>
54:               (<span class="ruby-identifier">to</span> <span class="ruby-value">? </span><span class="ruby-node">&quot;:#{to}&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-value str">&quot;&quot;</span>)
55:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000280">
                    
                    <a name="M000280"></a><b>query_revision</b>(changeset)
                    
                </div>
                
                <div class="description">
                  <p>
Translates a tag to a changeset if needed or just returns changeset.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000280_source')" id="l_M000280_source">show</a>
                        
                    </p>
                    <div id="M000280_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/capistrano/recipes/deploy/scm/mercurial.rb, line 58</span>
58:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">query_revision</span>(<span class="ruby-identifier">changeset</span>)
59:           <span class="ruby-identifier">cmd</span> = <span class="ruby-identifier">scm</span> <span class="ruby-identifier">:log</span>,
60:                     <span class="ruby-identifier">verbose</span>,
61:                     <span class="ruby-node">&quot;-r #{changeset}&quot;</span>,
62:                     <span class="ruby-value str">&quot;--template '{node|short}'&quot;</span>
63:                     <span class="ruby-keyword kw">yield</span> <span class="ruby-identifier">cmd</span>
64:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000276">
                    
                    <a name="M000276"></a><b>sync</b>(changeset, destination)
                    
                </div>
                
                <div class="description">
                  <p>
Pull from the repository and update to the specified changeset.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000276_source')" id="l_M000276_source">show</a>
                        
                    </p>
                    <div id="M000276_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/capistrano/recipes/deploy/scm/mercurial.rb, line 30</span>
30:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sync</span>(<span class="ruby-identifier">changeset</span>, <span class="ruby-identifier">destination</span>)
31:           <span class="ruby-identifier">pull</span>(<span class="ruby-identifier">destination</span>) <span class="ruby-operator">+</span> <span class="ruby-value str">&quot; &amp;&amp; &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">update</span>(<span class="ruby-identifier">changeset</span>, <span class="ruby-identifier">destination</span>)
32:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Private methods</div>
            
            <div class="method">
                <div class="title" id="M000286">
                    
                    <a name="M000286"></a><b>clone</b>(destination)
                    
                </div>
                
                <div class="description">
                  <p>
Fine grained mercurial commands
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000286_source')" id="l_M000286_source">show</a>
                        
                    </p>
                    <div id="M000286_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/capistrano/recipes/deploy/scm/mercurial.rb, line 96</span>
 96:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">clone</span>(<span class="ruby-identifier">destination</span>) 
 97:           <span class="ruby-identifier">scm</span> <span class="ruby-identifier">:clone</span>,
 98:               <span class="ruby-identifier">verbose</span>,
 99:               <span class="ruby-value str">&quot;--noupdate&quot;</span>, <span class="ruby-comment cmt"># do not update to tip when cloning is done</span>
100:               <span class="ruby-identifier">repository</span>,   <span class="ruby-comment cmt"># clone which repository?</span>
101:               <span class="ruby-identifier">destination</span>   <span class="ruby-comment cmt"># and put the clone where?</span>
102:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000287">
                    
                    <a name="M000287"></a><b>pull</b>(destination)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000287_source')" id="l_M000287_source">show</a>
                        
                    </p>
                    <div id="M000287_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/capistrano/recipes/deploy/scm/mercurial.rb, line 104</span>
104:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">pull</span>(<span class="ruby-identifier">destination</span>)
105:           <span class="ruby-identifier">scm</span> <span class="ruby-identifier">:pull</span>,
106:               <span class="ruby-identifier">verbose</span>,
107:               <span class="ruby-node">&quot;--repository #{destination}&quot;</span>, <span class="ruby-comment cmt"># pull changes into what?</span>
108:               <span class="ruby-identifier">repository</span>                     <span class="ruby-comment cmt"># and pull the changes from?</span>
109:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000291">
                    
                    <a name="M000291"></a><b>scm_password_or_prompt</b>()
                    
                </div>
                
                <div class="description">
                  <p>
honor Cap 2.1+&#8217;s :scm_prefer_prompt if present
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000291_source')" id="l_M000291_source">show</a>
                        
                    </p>
                    <div id="M000291_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/capistrano/recipes/deploy/scm/mercurial.rb, line 129</span>
129:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">scm_password_or_prompt</span>
130:           <span class="ruby-ivar">@scm_password_or_prompt</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">variable</span>(<span class="ruby-identifier">:scm_password</span>) <span class="ruby-operator">||</span>
131:             (<span class="ruby-constant">Capistrano</span><span class="ruby-operator">::</span><span class="ruby-constant">CLI</span>.<span class="ruby-identifier">password_prompt</span>(<span class="ruby-value str">&quot;hg password: &quot;</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">variable</span>(<span class="ruby-identifier">:scm_prefer_prompt</span>))
132:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000288">
                    
                    <a name="M000288"></a><b>update</b>(changeset, destination)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000288_source')" id="l_M000288_source">show</a>
                        
                    </p>
                    <div id="M000288_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/capistrano/recipes/deploy/scm/mercurial.rb, line 111</span>
111:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update</span>(<span class="ruby-identifier">changeset</span>, <span class="ruby-identifier">destination</span>)
112:           <span class="ruby-identifier">scm</span> <span class="ruby-identifier">:update</span>,
113:               <span class="ruby-identifier">verbose</span>,
114:               <span class="ruby-node">&quot;--repository #{destination}&quot;</span>, <span class="ruby-comment cmt"># update what?</span>
115:               <span class="ruby-value str">&quot;--clean&quot;</span>,                     <span class="ruby-comment cmt"># ignore untracked changes</span>
116:               <span class="ruby-identifier">changeset</span>                      <span class="ruby-comment cmt"># update to this changeset</span>
117:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000290">
                    
                    <a name="M000290"></a><b>verbose</b>()
                    
                </div>
                
                <div class="description">
                  <p>
verbosity configuration grokking :)
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000290_source')" id="l_M000290_source">show</a>
                        
                    </p>
                    <div id="M000290_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/capistrano/recipes/deploy/scm/mercurial.rb, line 120</span>
120:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">verbose</span>
121:           <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">variable</span>(<span class="ruby-identifier">:scm_verbose</span>)
122:             <span class="ruby-keyword kw">when</span> <span class="ruby-keyword kw">nil</span>   <span class="ruby-keyword kw">then</span> <span class="ruby-keyword kw">nil</span>
123:             <span class="ruby-keyword kw">when</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">then</span> <span class="ruby-value str">&quot;--quiet&quot;</span>
124:             <span class="ruby-keyword kw">else</span>            <span class="ruby-value str">&quot;--verbose&quot;</span>
125:           <span class="ruby-keyword kw">end</span>
126:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    