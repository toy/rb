<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>Object</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen" />
    <script src="../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Class</span> 
            Object 
            
                <span class="parent">&lt; 
                    
                    <a href="Object.html">Object</a>
                    
                </span>
            
        </h1>
        <ul class="files">
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>B</dt>
        <dd>
            <ul>
                
                <li><a href="#M000436">build_nested_query</a>,</li>
                
                <li><a href="#M000435">build_query</a>,</li>
                
                <li><a href="#M000444">byte_ranges</a>,</li>
                
                <li><a href="#M000441">bytesize</a>,</li>
                
                <li><a href="#M000442">bytesize</a></li>
                
            </ul>
        </dd>
    
        <dt>D</dt>
        <dd>
            <ul>
                
                <li><a href="#M000440">delete_cookie_header!</a></li>
                
            </ul>
        </dd>
    
        <dt>E</dt>
        <dd>
            <ul>
                
                <li><a href="#M000437">escape_html</a></li>
                
            </ul>
        </dd>
    
        <dt>N</dt>
        <dd>
            <ul>
                
                <li><a href="#M000433">normalize_params</a></li>
                
            </ul>
        </dd>
    
        <dt>P</dt>
        <dd>
            <ul>
                
                <li><a href="#M000434">params_hash_type?</a></li>
                
            </ul>
        </dd>
    
        <dt>R</dt>
        <dd>
            <ul>
                
                <li><a href="#M000443">rfc2822</a></li>
                
            </ul>
        </dd>
    
        <dt>S</dt>
        <dd>
            <ul>
                
                <li><a href="#M000438">select_best_encoding</a>,</li>
                
                <li><a href="#M000439">set_cookie_header!</a>,</li>
                
                <li><a href="#M000468">status_code</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    

    

    

    

    

    
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M000436">
                    
                    <a name="M000436"></a><b>build_nested_query</b>(value, prefix = nil)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000436_source')" id="l_M000436_source">show</a>
                        
                    </p>
                    <div id="M000436_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rack/utils.rb, line 145</span>
145:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">build_nested_query</span>(<span class="ruby-identifier">value</span>, <span class="ruby-identifier">prefix</span> = <span class="ruby-keyword kw">nil</span>)
146:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">value</span>
147:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Array</span>
148:         <span class="ruby-identifier">value</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
149:           <span class="ruby-identifier">build_nested_query</span>(<span class="ruby-identifier">v</span>, <span class="ruby-node">&quot;#{prefix}[]&quot;</span>)
150:         }.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;&amp;&quot;</span>)
151:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Hash</span>
152:         <span class="ruby-identifier">value</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
153:           <span class="ruby-identifier">build_nested_query</span>(<span class="ruby-identifier">v</span>, <span class="ruby-identifier">prefix</span> <span class="ruby-value">? </span><span class="ruby-node">&quot;#{prefix}[#{escape(k)}]&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">escape</span>(<span class="ruby-identifier">k</span>))
154:         }.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;&amp;&quot;</span>)
155:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">String</span>
156:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-value str">&quot;value must be a Hash&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">prefix</span>.<span class="ruby-identifier">nil?</span>
157:         <span class="ruby-node">&quot;#{prefix}=#{escape(value)}&quot;</span>
158:       <span class="ruby-keyword kw">else</span>
159:         <span class="ruby-identifier">prefix</span>
160:       <span class="ruby-keyword kw">end</span>
161:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000435">
                    
                    <a name="M000435"></a><b>build_query</b>(params)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000435_source')" id="l_M000435_source">show</a>
                        
                    </p>
                    <div id="M000435_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rack/utils.rb, line 134</span>
134:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">build_query</span>(<span class="ruby-identifier">params</span>)
135:       <span class="ruby-identifier">params</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
136:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">class</span> <span class="ruby-operator">==</span> <span class="ruby-constant">Array</span>
137:           <span class="ruby-identifier">build_query</span>(<span class="ruby-identifier">v</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> [<span class="ruby-identifier">k</span>, <span class="ruby-identifier">x</span>] })
138:         <span class="ruby-keyword kw">else</span>
139:           <span class="ruby-identifier">v</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-value">? </span><span class="ruby-identifier">escape</span>(<span class="ruby-identifier">k</span>) <span class="ruby-operator">:</span> <span class="ruby-node">&quot;#{escape(k)}=#{escape(v)}&quot;</span>
140:         <span class="ruby-keyword kw">end</span>
141:       }.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;&amp;&quot;</span>)
142:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000444">
                    
                    <a name="M000444"></a><b>byte_ranges</b>(env, size)
                    
                </div>
                
                <div class="description">
                  <p>
Parses the &#8220;Range:&#8221; header, if present, into an array of Range
objects. Returns nil if the header is missing or syntactically invalid.
Returns an empty array if none of the ranges are satisfiable.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000444_source')" id="l_M000444_source">show</a>
                        
                    </p>
                    <div id="M000444_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rack/utils.rb, line 309</span>
309:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">byte_ranges</span>(<span class="ruby-identifier">env</span>, <span class="ruby-identifier">size</span>)
310:       <span class="ruby-comment cmt"># See &lt;http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.35&gt;</span>
311:       <span class="ruby-identifier">http_range</span> = <span class="ruby-identifier">env</span>[<span class="ruby-value str">'HTTP_RANGE'</span>]
312:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">http_range</span>
313:       <span class="ruby-identifier">ranges</span> = []
314:       <span class="ruby-identifier">http_range</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp re">/,\s*/</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">range_spec</span><span class="ruby-operator">|</span>
315:         <span class="ruby-identifier">matches</span> = <span class="ruby-identifier">range_spec</span>.<span class="ruby-identifier">match</span>(<span class="ruby-regexp re">/bytes=(\d*)-(\d*)/</span>)
316:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span>  <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">matches</span>
317:         <span class="ruby-identifier">r0</span>,<span class="ruby-identifier">r1</span> = <span class="ruby-identifier">matches</span>[<span class="ruby-value">1</span>], <span class="ruby-identifier">matches</span>[<span class="ruby-value">2</span>]
318:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">r0</span>.<span class="ruby-identifier">empty?</span>
319:           <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span>  <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">r1</span>.<span class="ruby-identifier">empty?</span>
320:           <span class="ruby-comment cmt"># suffix-byte-range-spec, represents trailing suffix of file</span>
321:           <span class="ruby-identifier">r0</span> = [<span class="ruby-identifier">size</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">r1</span>.<span class="ruby-identifier">to_i</span>, <span class="ruby-value">0</span>].<span class="ruby-identifier">max</span>
322:           <span class="ruby-identifier">r1</span> = <span class="ruby-identifier">size</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>
323:         <span class="ruby-keyword kw">else</span>
324:           <span class="ruby-identifier">r0</span> = <span class="ruby-identifier">r0</span>.<span class="ruby-identifier">to_i</span>
325:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">r1</span>.<span class="ruby-identifier">empty?</span>
326:             <span class="ruby-identifier">r1</span> = <span class="ruby-identifier">size</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>
327:           <span class="ruby-keyword kw">else</span>
328:             <span class="ruby-identifier">r1</span> = <span class="ruby-identifier">r1</span>.<span class="ruby-identifier">to_i</span>
329:             <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span>  <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">r1</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">r0</span>  <span class="ruby-comment cmt"># backwards range is syntactically invalid</span>
330:             <span class="ruby-identifier">r1</span> = <span class="ruby-identifier">size</span><span class="ruby-operator">-</span><span class="ruby-value">1</span>  <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">r1</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">size</span>
331:           <span class="ruby-keyword kw">end</span>
332:         <span class="ruby-keyword kw">end</span>
333:         <span class="ruby-identifier">ranges</span> <span class="ruby-operator">&lt;&lt;</span> (<span class="ruby-identifier">r0</span><span class="ruby-operator">..</span><span class="ruby-identifier">r1</span>)  <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">r0</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">r1</span>
334:       <span class="ruby-keyword kw">end</span>
335:       <span class="ruby-identifier">ranges</span>
336:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000441">
                    
                    <a name="M000441"></a><b>bytesize</b>(string)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000441_source')" id="l_M000441_source">show</a>
                        
                    </p>
                    <div id="M000441_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rack/utils.rb, line 280</span>
280:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">bytesize</span>(<span class="ruby-identifier">string</span>)
281:         <span class="ruby-identifier">string</span>.<span class="ruby-identifier">bytesize</span>
282:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000442">
                    
                    <a name="M000442"></a><b>bytesize</b>(string)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000442_source')" id="l_M000442_source">show</a>
                        
                    </p>
                    <div id="M000442_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rack/utils.rb, line 284</span>
284:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">bytesize</span>(<span class="ruby-identifier">string</span>)
285:         <span class="ruby-identifier">string</span>.<span class="ruby-identifier">size</span>
286:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000440">
                    
                    <a name="M000440"></a><b>delete_cookie_header!</b>(header, key, value = {})
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000440_source')" id="l_M000440_source">show</a>
                        
                    </p>
                    <div id="M000440_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rack/utils.rb, line 247</span>
247:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">delete_cookie_header!</span>(<span class="ruby-identifier">header</span>, <span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span> = {})
248:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">header</span>[<span class="ruby-value str">&quot;Set-Cookie&quot;</span>]
249:       <span class="ruby-keyword kw">when</span> <span class="ruby-keyword kw">nil</span>, <span class="ruby-value str">''</span>
250:         <span class="ruby-identifier">cookies</span> = []
251:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">String</span>
252:         <span class="ruby-identifier">cookies</span> = <span class="ruby-identifier">header</span>[<span class="ruby-value str">&quot;Set-Cookie&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;\n&quot;</span>)
253:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Array</span>
254:         <span class="ruby-identifier">cookies</span> = <span class="ruby-identifier">header</span>[<span class="ruby-value str">&quot;Set-Cookie&quot;</span>]
255:       <span class="ruby-keyword kw">end</span>
256: 
257:       <span class="ruby-identifier">cookies</span>.<span class="ruby-identifier">reject!</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">cookie</span><span class="ruby-operator">|</span>
258:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">value</span>[<span class="ruby-identifier">:domain</span>]
259:           <span class="ruby-identifier">cookie</span> <span class="ruby-operator">=~</span> <span class="ruby-node">/\A#{escape(key)}=.*domain=#{value[:domain]}/</span>
260:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">value</span>[<span class="ruby-identifier">:path</span>]
261:           <span class="ruby-identifier">cookie</span> <span class="ruby-operator">=~</span> <span class="ruby-node">/\A#{escape(key)}=.*path=#{value[:path]}/</span>
262:         <span class="ruby-keyword kw">else</span>
263:           <span class="ruby-identifier">cookie</span> <span class="ruby-operator">=~</span> <span class="ruby-node">/\A#{escape(key)}=/</span>
264:         <span class="ruby-keyword kw">end</span>
265:       }
266: 
267:       <span class="ruby-identifier">header</span>[<span class="ruby-value str">&quot;Set-Cookie&quot;</span>] = <span class="ruby-identifier">cookies</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;\n&quot;</span>)
268: 
269:       <span class="ruby-identifier">set_cookie_header!</span>(<span class="ruby-identifier">header</span>, <span class="ruby-identifier">key</span>,
270:                  {<span class="ruby-identifier">:value</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">''</span>, <span class="ruby-identifier">:path</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">:domain</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">nil</span>,
271:                    <span class="ruby-identifier">:expires</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">at</span>(<span class="ruby-value">0</span>) }.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">value</span>))
272: 
273:       <span class="ruby-keyword kw">nil</span>
274:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000437">
                    
                    <a name="M000437"></a><b>escape_html</b>(string)
                    
                </div>
                
                <div class="description">
                  <p>
Escape ampersands, brackets and quotes to their HTML/XML entities.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000437_source')" id="l_M000437_source">show</a>
                        
                    </p>
                    <div id="M000437_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rack/utils.rb, line 181</span>
181:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">escape_html</span>(<span class="ruby-identifier">string</span>)
182:       <span class="ruby-identifier">string</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-constant">ESCAPE_HTML_PATTERN</span>){<span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-constant">ESCAPE_HTML</span>[<span class="ruby-identifier">c</span>] }
183:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000433">
                    
                    <a name="M000433"></a><b>normalize_params</b>(params, name, v = nil)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000433_source')" id="l_M000433_source">show</a>
                        
                    </p>
                    <div id="M000433_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rack/utils.rb, line 97</span>
 97:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">normalize_params</span>(<span class="ruby-identifier">params</span>, <span class="ruby-identifier">name</span>, <span class="ruby-identifier">v</span> = <span class="ruby-keyword kw">nil</span>)
 98:       <span class="ruby-identifier">name</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">%r(\A[\[\]]*([^\[\]]+)\]*)</span>
 99:       <span class="ruby-identifier">k</span> = <span class="ruby-identifier">$1</span> <span class="ruby-operator">||</span> <span class="ruby-value str">''</span>
100:       <span class="ruby-identifier">after</span> = <span class="ruby-identifier">$'</span> <span class="ruby-operator">||</span> <span class="ruby-value str">''</span>
101: 
102:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">k</span>.<span class="ruby-identifier">empty?</span>
103: 
104:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">after</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;&quot;</span>
105:         <span class="ruby-identifier">params</span>[<span class="ruby-identifier">k</span>] = <span class="ruby-identifier">v</span>
106:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">after</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;[]&quot;</span>
107:         <span class="ruby-identifier">params</span>[<span class="ruby-identifier">k</span>] <span class="ruby-operator">||=</span> []
108:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">TypeError</span>, <span class="ruby-node">&quot;expected Array (got #{params[k].class.name}) for param `#{k}'&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">k</span>].<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>)
109:         <span class="ruby-identifier">params</span>[<span class="ruby-identifier">k</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">v</span>
110:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">after</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">%r(^\[\]\[([^\[\]]+)\]$)</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">after</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">%r(^\[\](.+)$)</span>
111:         <span class="ruby-identifier">child_key</span> = <span class="ruby-identifier">$1</span>
112:         <span class="ruby-identifier">params</span>[<span class="ruby-identifier">k</span>] <span class="ruby-operator">||=</span> []
113:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">TypeError</span>, <span class="ruby-node">&quot;expected Array (got #{params[k].class.name}) for param `#{k}'&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">k</span>].<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>)
114:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params_hash_type?</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">k</span>].<span class="ruby-identifier">last</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">k</span>].<span class="ruby-identifier">last</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-identifier">child_key</span>)
115:           <span class="ruby-identifier">normalize_params</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">k</span>].<span class="ruby-identifier">last</span>, <span class="ruby-identifier">child_key</span>, <span class="ruby-identifier">v</span>)
116:         <span class="ruby-keyword kw">else</span>
117:           <span class="ruby-identifier">params</span>[<span class="ruby-identifier">k</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">normalize_params</span>(<span class="ruby-identifier">params</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">new</span>, <span class="ruby-identifier">child_key</span>, <span class="ruby-identifier">v</span>)
118:         <span class="ruby-keyword kw">end</span>
119:       <span class="ruby-keyword kw">else</span>
120:         <span class="ruby-identifier">params</span>[<span class="ruby-identifier">k</span>] <span class="ruby-operator">||=</span> <span class="ruby-identifier">params</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">new</span>
121:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">TypeError</span>, <span class="ruby-node">&quot;expected Hash (got #{params[k].class.name}) for param `#{k}'&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">params_hash_type?</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">k</span>])
122:         <span class="ruby-identifier">params</span>[<span class="ruby-identifier">k</span>] = <span class="ruby-identifier">normalize_params</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">k</span>], <span class="ruby-identifier">after</span>, <span class="ruby-identifier">v</span>)
123:       <span class="ruby-keyword kw">end</span>
124: 
125:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">params</span>
126:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000434">
                    
                    <a name="M000434"></a><b>params_hash_type?</b>(obj)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000434_source')" id="l_M000434_source">show</a>
                        
                    </p>
                    <div id="M000434_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rack/utils.rb, line 129</span>
129:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">params_hash_type?</span>(<span class="ruby-identifier">obj</span>)
130:       <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">KeySpaceConstrainedParams</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">Hash</span>)
131:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000443">
                    
                    <a name="M000443"></a><b>rfc2822</b>(time)
                    
                </div>
                
                <div class="description">
                  <p>
Modified version of stdlib time.rb Time#rfc2822 to use
&#8217;%d-%b-%Y&#8217; instead of &#8217;% %b %Y&#8217;. It assumes that
the time is in GMT to comply to the RFC 2109.
</p>
<p>
NOTE: I&#8217;m not sure the RFC says it requires GMT, but is ambigous
enough that I&#8217;m certain someone implemented only that option. Do not
use %a and %b from Time.strptime, it would use localized names for weekday
and month.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000443_source')" id="l_M000443_source">show</a>
                        
                    </p>
                    <div id="M000443_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rack/utils.rb, line 299</span>
299:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">rfc2822</span>(<span class="ruby-identifier">time</span>)
300:       <span class="ruby-identifier">wday</span> = <span class="ruby-constant">Time</span><span class="ruby-operator">::</span><span class="ruby-constant">RFC2822_DAY_NAME</span>[<span class="ruby-identifier">time</span>.<span class="ruby-identifier">wday</span>]
301:       <span class="ruby-identifier">mon</span> = <span class="ruby-constant">Time</span><span class="ruby-operator">::</span><span class="ruby-constant">RFC2822_MONTH_NAME</span>[<span class="ruby-identifier">time</span>.<span class="ruby-identifier">mon</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>]
302:       <span class="ruby-identifier">time</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-node">&quot;#{wday}, %d-#{mon}-%Y %H:%M:%S GMT&quot;</span>)
303:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000438">
                    
                    <a name="M000438"></a><b>select_best_encoding</b>(available_encodings, accept_encoding)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000438_source')" id="l_M000438_source">show</a>
                        
                    </p>
                    <div id="M000438_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rack/utils.rb, line 186</span>
186:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">select_best_encoding</span>(<span class="ruby-identifier">available_encodings</span>, <span class="ruby-identifier">accept_encoding</span>)
187:       <span class="ruby-comment cmt"># http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html</span>
188: 
189:       <span class="ruby-identifier">expanded_accept_encoding</span> =
190:         <span class="ruby-identifier">accept_encoding</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">m</span>, <span class="ruby-identifier">q</span><span class="ruby-operator">|</span>
191:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">m</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;*&quot;</span>
192:             (<span class="ruby-identifier">available_encodings</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">accept_encoding</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">m2</span>, <span class="ruby-identifier">_</span><span class="ruby-operator">|</span> <span class="ruby-identifier">m2</span> }).<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">m2</span><span class="ruby-operator">|</span> [<span class="ruby-identifier">m2</span>, <span class="ruby-identifier">q</span>] }
193:           <span class="ruby-keyword kw">else</span>
194:             [[<span class="ruby-identifier">m</span>, <span class="ruby-identifier">q</span>]]
195:           <span class="ruby-keyword kw">end</span>
196:         }.<span class="ruby-identifier">inject</span>([]) { <span class="ruby-operator">|</span><span class="ruby-identifier">mem</span>, <span class="ruby-identifier">list</span><span class="ruby-operator">|</span>
197:           <span class="ruby-identifier">mem</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">list</span>
198:         }
199: 
200:       <span class="ruby-identifier">encoding_candidates</span> = <span class="ruby-identifier">expanded_accept_encoding</span>.<span class="ruby-identifier">sort_by</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">_</span>, <span class="ruby-identifier">q</span><span class="ruby-operator">|</span> <span class="ruby-operator">-</span><span class="ruby-identifier">q</span> }.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">m</span>, <span class="ruby-identifier">_</span><span class="ruby-operator">|</span> <span class="ruby-identifier">m</span> }
201: 
202:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">encoding_candidates</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-value str">&quot;identity&quot;</span>)
203:         <span class="ruby-identifier">encoding_candidates</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value str">&quot;identity&quot;</span>)
204:       <span class="ruby-keyword kw">end</span>
205: 
206:       <span class="ruby-identifier">expanded_accept_encoding</span>.<span class="ruby-identifier">find_all</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">m</span>, <span class="ruby-identifier">q</span><span class="ruby-operator">|</span>
207:         <span class="ruby-identifier">q</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span><span class="ruby-value">.0</span>
208:       }.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">m</span>, <span class="ruby-identifier">_</span><span class="ruby-operator">|</span>
209:         <span class="ruby-identifier">encoding_candidates</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">m</span>)
210:       }
211: 
212:       <span class="ruby-keyword kw">return</span> (<span class="ruby-identifier">encoding_candidates</span> <span class="ruby-operator">&amp;</span> <span class="ruby-identifier">available_encodings</span>)[<span class="ruby-value">0</span>]
213:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000439">
                    
                    <a name="M000439"></a><b>set_cookie_header!</b>(header, key, value)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000439_source')" id="l_M000439_source">show</a>
                        
                    </p>
                    <div id="M000439_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rack/utils.rb, line 216</span>
216:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set_cookie_header!</span>(<span class="ruby-identifier">header</span>, <span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span>)
217:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">value</span>
218:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Hash</span>
219:         <span class="ruby-identifier">domain</span>  = <span class="ruby-value str">&quot;; domain=&quot;</span>  <span class="ruby-operator">+</span> <span class="ruby-identifier">value</span>[<span class="ruby-identifier">:domain</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">value</span>[<span class="ruby-identifier">:domain</span>]
220:         <span class="ruby-identifier">path</span>    = <span class="ruby-value str">&quot;; path=&quot;</span>    <span class="ruby-operator">+</span> <span class="ruby-identifier">value</span>[<span class="ruby-identifier">:path</span>]   <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">value</span>[<span class="ruby-identifier">:path</span>]
221:         <span class="ruby-comment cmt"># According to RFC 2109, we need dashes here.</span>
222:         <span class="ruby-comment cmt"># N.B.: cgi.rb uses spaces...</span>
223:         <span class="ruby-identifier">expires</span> = <span class="ruby-value str">&quot;; expires=&quot;</span> <span class="ruby-operator">+</span>
224:           <span class="ruby-identifier">rfc2822</span>(<span class="ruby-identifier">value</span>[<span class="ruby-identifier">:expires</span>].<span class="ruby-identifier">clone</span>.<span class="ruby-identifier">gmtime</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">value</span>[<span class="ruby-identifier">:expires</span>]
225:         <span class="ruby-identifier">secure</span> = <span class="ruby-value str">&quot;; secure&quot;</span>  <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">value</span>[<span class="ruby-identifier">:secure</span>]
226:         <span class="ruby-identifier">httponly</span> = <span class="ruby-value str">&quot;; HttpOnly&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">value</span>[<span class="ruby-identifier">:httponly</span>]
227:         <span class="ruby-identifier">value</span> = <span class="ruby-identifier">value</span>[<span class="ruby-identifier">:value</span>]
228:       <span class="ruby-keyword kw">end</span>
229:       <span class="ruby-identifier">value</span> = [<span class="ruby-identifier">value</span>] <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">Array</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">value</span>
230:       <span class="ruby-identifier">cookie</span> = <span class="ruby-identifier">escape</span>(<span class="ruby-identifier">key</span>) <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;=&quot;</span> <span class="ruby-operator">+</span>
231:         <span class="ruby-identifier">value</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">escape</span> <span class="ruby-identifier">v</span> }.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;&amp;&quot;</span>) <span class="ruby-operator">+</span>
232:         <span class="ruby-node">&quot;#{domain}#{path}#{expires}#{secure}#{httponly}&quot;</span>
233: 
234:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">header</span>[<span class="ruby-value str">&quot;Set-Cookie&quot;</span>]
235:       <span class="ruby-keyword kw">when</span> <span class="ruby-keyword kw">nil</span>, <span class="ruby-value str">''</span>
236:         <span class="ruby-identifier">header</span>[<span class="ruby-value str">&quot;Set-Cookie&quot;</span>] = <span class="ruby-identifier">cookie</span>
237:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">String</span>
238:         <span class="ruby-identifier">header</span>[<span class="ruby-value str">&quot;Set-Cookie&quot;</span>] = [<span class="ruby-identifier">header</span>[<span class="ruby-value str">&quot;Set-Cookie&quot;</span>], <span class="ruby-identifier">cookie</span>].<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;\n&quot;</span>)
239:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Array</span>
240:         <span class="ruby-identifier">header</span>[<span class="ruby-value str">&quot;Set-Cookie&quot;</span>] = (<span class="ruby-identifier">header</span>[<span class="ruby-value str">&quot;Set-Cookie&quot;</span>] <span class="ruby-operator">+</span> [<span class="ruby-identifier">cookie</span>]).<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;\n&quot;</span>)
241:       <span class="ruby-keyword kw">end</span>
242: 
243:       <span class="ruby-keyword kw">nil</span>
244:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000468">
                    
                    <a name="M000468"></a><b>status_code</b>(status)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000468_source')" id="l_M000468_source">show</a>
                        
                    </p>
                    <div id="M000468_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rack/utils.rb, line 535</span>
535:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">status_code</span>(<span class="ruby-identifier">status</span>)
536:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">status</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Symbol</span>)
537:         <span class="ruby-constant">SYMBOL_TO_STATUS_CODE</span>[<span class="ruby-identifier">status</span>] <span class="ruby-operator">||</span> <span class="ruby-value">500</span>
538:       <span class="ruby-keyword kw">else</span>
539:         <span class="ruby-identifier">status</span>.<span class="ruby-identifier">to_i</span>
540:       <span class="ruby-keyword kw">end</span>
541:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    