<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>Vagrant::Environment</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../css/main.css" type="text/css" media="screen" />
    <script src="../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Class</span> 
            Vagrant::Environment 
            
                <span class="parent">&lt; 
                    
                    Object
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../files/lib/vagrant/environment_rb.html">lib/vagrant/environment.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    
    <div class="description">
        <p>
Represents a single <a href="../Vagrant.html">Vagrant</a> environment. A
&#8220;<a href="../Vagrant.html">Vagrant</a> environment&#8221; is defined
as basically a folder with a &#8220;Vagrantfile.&#8221; This class allows
access to the VMs, <a href="CLI.html">CLI</a>, etc. all in the scope of
this environment.
</p>

    </div>
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>A</dt>
        <dd>
            <ul>
                
                <li><a href="#M000370">action_registry</a>,</li>
                
                <li><a href="#M000369">action_runner</a></li>
                
            </ul>
        </dd>
    
        <dt>B</dt>
        <dd>
            <ul>
                
                <li><a href="#M000362">boxes</a></li>
                
            </ul>
        </dd>
    
        <dt>C</dt>
        <dd>
            <ul>
                
                <li><a href="#M000367">cli</a>,</li>
                
                <li><a href="#M000376">config</a>,</li>
                
                <li><a href="#M000383">copy_insecure_private_key</a></li>
                
            </ul>
        </dd>
    
        <dt>D</dt>
        <dd>
            <ul>
                
                <li><a href="#M000361">dotfile_path</a></li>
                
            </ul>
        </dd>
    
        <dt>F</dt>
        <dd>
            <ul>
                
                <li><a href="#M000384">find_vagrantfile</a></li>
                
            </ul>
        </dd>
    
        <dt>G</dt>
        <dd>
            <ul>
                
                <li><a href="#M000371">global_data</a></li>
                
            </ul>
        </dd>
    
        <dt>H</dt>
        <dd>
            <ul>
                
                <li><a href="#M000368">host</a></li>
                
            </ul>
        </dd>
    
        <dt>L</dt>
        <dd>
            <ul>
                
                <li><a href="#M000378">load!</a>,</li>
                
                <li><a href="#M000380">load_config!</a>,</li>
                
                <li><a href="#M000381">load_vms!</a>,</li>
                
                <li><a href="#M000377">loaded?</a>,</li>
                
                <li><a href="#M000372">local_data</a>,</li>
                
                <li><a href="#M000375">lock</a>,</li>
                
                <li><a href="#M000374">lock_path</a></li>
                
            </ul>
        </dd>
    
        <dt>M</dt>
        <dd>
            <ul>
                
                <li><a href="#M000366">multivm?</a></li>
                
            </ul>
        </dd>
    
        <dt>N</dt>
        <dd>
            <ul>
                
                <li><a href="#M000354">new</a></li>
                
            </ul>
        </dd>
    
        <dt>P</dt>
        <dd>
            <ul>
                
                <li><a href="#M000365">primary_vm</a></li>
                
            </ul>
        </dd>
    
        <dt>R</dt>
        <dd>
            <ul>
                
                <li><a href="#M000379">reload!</a>,</li>
                
                <li><a href="#M000373">root_path</a></li>
                
            </ul>
        </dd>
    
        <dt>S</dt>
        <dd>
            <ul>
                
                <li><a href="#M000382">setup_home_path</a></li>
                
            </ul>
        </dd>
    
        <dt>V</dt>
        <dd>
            <ul>
                
                <li><a href="#M000363">vms</a>,</li>
                
                <li><a href="#M000364">vms_ordered</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    

    

    

    
    <div class="sectiontitle">Constants</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class="attr-name">HOME_SUBDIRS</td>
            <td>=</td>
            <td class="attr-value">[&quot;tmp&quot;, &quot;boxes&quot;]</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">DEFAULT_VM</td>
            <td>=</td>
            <td class="attr-value">:default</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">DEFAULT_HOME</td>
            <td>=</td>
            <td class="attr-value">&quot;~/.vagrant.d&quot;</td>
        </tr>
        
        
    </table>
    

    
    <div class="sectiontitle">Attributes</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>cwd</td>
            <td class='attr-desc'><p>
The `cwd` that this environment represents
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>vagrantfile_name</td>
            <td class='attr-desc'><p>
The valid name for a Vagrantfile for this environment.
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>ui</td>
            <td class='attr-desc'><p>
The {UI} object to communicate with the outside world.
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>home_path</td>
            <td class='attr-desc'><p>
The directory to the &#8220;home&#8221; folder that <a
href="../Vagrant.html">Vagrant</a> will use to store global state.
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>tmp_path</td>
            <td class='attr-desc'><p>
The directory where temporary files for <a
href="../Vagrant.html">Vagrant</a> go.
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>boxes_path</td>
            <td class='attr-desc'><p>
The directory where boxes are stored.
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>default_private_key_path</td>
            <td class='attr-desc'><p>
The path to the default private key
</p></td>
        </tr>
        
    </table>
    

    
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M000370">
                    
                    <a name="M000370"></a><b>action_registry</b>()
                    
                </div>
                
                <div class="description">
                  <p>
<a href="Action.html">Action</a> registry for registering new actions with
this environment.
</p>
<p>
@return [Registry]
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000370_source')" id="l_M000370_source">show</a>
                        
                    </p>
                    <div id="M000370_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/vagrant/environment.rb, line 199</span>
199:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">action_registry</span>
200:       <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@action_registry</span> <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">defined?</span>(<span class="ruby-ivar">@action_registry</span>)
201: 
202:       <span class="ruby-comment cmt"># The action registry hasn't been loaded yet, so load it</span>
203:       <span class="ruby-comment cmt"># and setup the built-in actions with it.</span>
204:       <span class="ruby-ivar">@action_registry</span> = <span class="ruby-constant">Registry</span>.<span class="ruby-identifier">new</span>
205:       <span class="ruby-constant">Vagrant</span><span class="ruby-operator">::</span><span class="ruby-constant">Action</span>.<span class="ruby-identifier">builtin!</span>(<span class="ruby-ivar">@action_registry</span>)
206:       <span class="ruby-ivar">@action_registry</span>
207:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000369">
                    
                    <a name="M000369"></a><b>action_runner</b>()
                    
                </div>
                
                <div class="description">
                  <p>
<a href="Action.html">Action</a> runner for executing actions in the
context of this environment.
</p>
<p>
@return [Action::Runner]
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000369_source')" id="l_M000369_source">show</a>
                        
                    </p>
                    <div id="M000369_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/vagrant/environment.rb, line 182</span>
182:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">action_runner</span>
183:       <span class="ruby-ivar">@action_runner</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">Action</span><span class="ruby-operator">::</span><span class="ruby-constant">Runner</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">action_registry</span>) <span class="ruby-keyword kw">do</span>
184:         {
185:           <span class="ruby-identifier">:action_runner</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">action_runner</span>,
186:           <span class="ruby-identifier">:box_collection</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">boxes</span>,
187:           <span class="ruby-identifier">:global_config</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">config</span>.<span class="ruby-identifier">global</span>,
188:           <span class="ruby-identifier">:host</span>           =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">host</span>,
189:           <span class="ruby-identifier">:root_path</span>      =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">root_path</span>,
190:           <span class="ruby-identifier">:tmp_path</span>       =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">tmp_path</span>,
191:           <span class="ruby-identifier">:ui</span>             =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@ui</span>
192:         }
193:       <span class="ruby-keyword kw">end</span>
194:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000362">
                    
                    <a name="M000362"></a><b>boxes</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Returns the collection of boxes for the environment.
</p>
<p>
@return [BoxCollection]
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000362_source')" id="l_M000362_source">show</a>
                        
                    </p>
                    <div id="M000362_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/vagrant/environment.rb, line 105</span>
105:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">boxes</span>
106:       <span class="ruby-ivar">@_boxes</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">BoxCollection</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">boxes_path</span>, <span class="ruby-identifier">action_runner</span>)
107:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000367">
                    
                    <a name="M000367"></a><b>cli</b>(*args)
                    
                </div>
                
                <div class="description">
                  <p>
Makes a call to the <a href="CLI.html">CLI</a> with the given arguments as
if they came from the real command line (sometimes they do!). An example:
</p>
<pre>
    env.cli(&quot;package&quot;, &quot;--vagrantfile&quot;, &quot;Vagrantfile&quot;)
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000367_source')" id="l_M000367_source">show</a>
                        
                    </p>
                    <div id="M000367_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/vagrant/environment.rb, line 155</span>
155:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">cli</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
156:       <span class="ruby-constant">CLI</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">args</span>.<span class="ruby-identifier">flatten</span>, <span class="ruby-keyword kw">self</span>).<span class="ruby-identifier">execute</span>
157:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000376">
                    
                    <a name="M000376"></a><b>config</b>()
                    
                </div>
                
                <div class="description">
                  <p>
The configuration object represented by this environment. This will trigger
the environment to load if it hasn&#8217;t loaded yet (see {<a
href="Environment.html#M000378">load!</a>}).
</p>
<p>
@return [Config::Container]
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000376_source')" id="l_M000376_source">show</a>
                        
                    </p>
                    <div id="M000376_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/vagrant/environment.rb, line 295</span>
295:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">config</span>
296:       <span class="ruby-identifier">load!</span> <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">loaded?</span>
297:       <span class="ruby-ivar">@config</span>
298:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000361">
                    
                    <a name="M000361"></a><b>dotfile_path</b>()
                    
                </div>
                
                <div class="description">
                  <p>
The path to the `dotfile`, which contains the persisted UUID of the <a
href="VM.html">VM</a> if it exists.
</p>
<p>
@return [Pathname]
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000361_source')" id="l_M000361_source">show</a>
                        
                    </p>
                    <div id="M000361_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/vagrant/environment.rb, line 97</span>
 97:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">dotfile_path</span>
 98:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">root_path</span>
 99:       <span class="ruby-identifier">root_path</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">config</span>.<span class="ruby-identifier">global</span>.<span class="ruby-identifier">vagrant</span>.<span class="ruby-identifier">dotfile_name</span>)
100:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000371">
                    
                    <a name="M000371"></a><b>global_data</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Loads on initial access and reads data from the global data store. The
global data store is global to <a href="../Vagrant.html">Vagrant</a>
everywhere (in every environment), so it can be used to store system-wide
information. Note that &#8220;system-wide&#8221; typically means &#8220;for
this user&#8221; since the location of the global data store is in the home
directory.
</p>
<p>
@return [DataStore]
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000371_source')" id="l_M000371_source">show</a>
                        
                    </p>
                    <div id="M000371_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/vagrant/environment.rb, line 216</span>
216:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">global_data</span>
217:       <span class="ruby-ivar">@global_data</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">DataStore</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-value str">&quot;global_data.json&quot;</span>, <span class="ruby-identifier">home_path</span>))
218:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000368">
                    
                    <a name="M000368"></a><b>host</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Returns the host object associated with this environment.
</p>
<p>
@return [Hosts::Base]
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000368_source')" id="l_M000368_source">show</a>
                        
                    </p>
                    <div id="M000368_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/vagrant/environment.rb, line 162</span>
162:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">host</span>
163:       <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@host</span> <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">defined?</span>(<span class="ruby-ivar">@host</span>)
164: 
165:       <span class="ruby-comment cmt"># Attempt to figure out the host class. Note that the order</span>
166:       <span class="ruby-comment cmt"># matters here, so please don't touch. Specifically: The symbol</span>
167:       <span class="ruby-comment cmt"># check is done after the detect check because the symbol check</span>
168:       <span class="ruby-comment cmt"># will return nil, and we don't want to trigger a detect load.</span>
169:       <span class="ruby-identifier">host_klass</span> = <span class="ruby-identifier">config</span>.<span class="ruby-identifier">global</span>.<span class="ruby-identifier">vagrant</span>.<span class="ruby-identifier">host</span>
170:       <span class="ruby-identifier">host_klass</span> = <span class="ruby-constant">Hosts</span>.<span class="ruby-identifier">detect</span>(<span class="ruby-constant">Vagrant</span>.<span class="ruby-identifier">hosts</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">host_klass</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">host_klass</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:detect</span>
171:       <span class="ruby-identifier">host_klass</span> = <span class="ruby-constant">Vagrant</span>.<span class="ruby-identifier">hosts</span>.<span class="ruby-identifier">get</span>(<span class="ruby-identifier">host_klass</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">host_klass</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Symbol</span>)
172: 
173:       <span class="ruby-comment cmt"># If no host class is detected, we use the base class.</span>
174:       <span class="ruby-identifier">host_klass</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">Hosts</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>
175: 
176:       <span class="ruby-ivar">@host</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">host_klass</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@ui</span>)
177:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000378">
                    
                    <a name="M000378"></a><b>load!</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Loads this entire environment, setting up the instance variables such as
`vm`, `config`, etc. on this environment. The order this method calls its
other methods is very particular.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000378_source')" id="l_M000378_source">show</a>
                        
                    </p>
                    <div id="M000378_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/vagrant/environment.rb, line 315</span>
315:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">load!</span>
316:       <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">loaded?</span>
317:         <span class="ruby-ivar">@loaded</span> = <span class="ruby-keyword kw">true</span>
318:         <span class="ruby-ivar">@logger</span>.<span class="ruby-identifier">info</span>(<span class="ruby-value str">&quot;Loading configuration...&quot;</span>)
319:         <span class="ruby-identifier">load_config!</span>
320:       <span class="ruby-keyword kw">end</span>
321: 
322:       <span class="ruby-keyword kw">self</span>
323:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000380">
                    
                    <a name="M000380"></a><b>load_config!</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Loads this environment&#8217;s configuration and stores it in the {<a
href="Environment.html#M000376">config</a>} variable. The configuration
loaded by this method is specified to this environment, meaning that it
will use the given root directory to load the Vagrantfile into that
context.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000380_source')" id="l_M000380_source">show</a>
                        
                    </p>
                    <div id="M000380_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/vagrant/environment.rb, line 338</span>
338:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">load_config!</span>
339:       <span class="ruby-comment cmt"># Initialize the config loader</span>
340:       <span class="ruby-identifier">config_loader</span> = <span class="ruby-constant">Config</span><span class="ruby-operator">::</span><span class="ruby-constant">Loader</span>.<span class="ruby-identifier">new</span>
341:       <span class="ruby-identifier">config_loader</span>.<span class="ruby-identifier">load_order</span> = [<span class="ruby-identifier">:default</span>, <span class="ruby-identifier">:box</span>, <span class="ruby-identifier">:home</span>, <span class="ruby-identifier">:root</span>, <span class="ruby-identifier">:vm</span>]
342: 
343:       <span class="ruby-identifier">inner_load</span> = <span class="ruby-identifier">lambda</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-operator">*</span><span class="ruby-identifier">args</span><span class="ruby-operator">|</span>
344:         <span class="ruby-comment cmt"># This is for Ruby 1.8.7 compatibility. Ruby 1.8.7 doesn't allow</span>
345:         <span class="ruby-comment cmt"># default arguments for lambdas, so we get around by doing a *args</span>
346:         <span class="ruby-comment cmt"># and setting the args here.</span>
347:         <span class="ruby-identifier">subvm</span> = <span class="ruby-identifier">args</span>[<span class="ruby-value">0</span>]
348:         <span class="ruby-identifier">box</span>   = <span class="ruby-identifier">args</span>[<span class="ruby-value">1</span>]
349: 
350:         <span class="ruby-comment cmt"># Default Vagrantfile first. This is the Vagrantfile that ships</span>
351:         <span class="ruby-comment cmt"># with Vagrant.</span>
352:         <span class="ruby-identifier">config_loader</span>.<span class="ruby-identifier">set</span>(<span class="ruby-identifier">:default</span>, <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-value str">&quot;config/default.rb&quot;</span>, <span class="ruby-constant">Vagrant</span>.<span class="ruby-identifier">source_root</span>))
353: 
354:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">box</span>
355:           <span class="ruby-comment cmt"># We load the box Vagrantfile</span>
356:           <span class="ruby-identifier">box_vagrantfile</span> = <span class="ruby-identifier">find_vagrantfile</span>(<span class="ruby-identifier">box</span>.<span class="ruby-identifier">directory</span>)
357:           <span class="ruby-identifier">config_loader</span>.<span class="ruby-identifier">set</span>(<span class="ruby-identifier">:box</span>, <span class="ruby-identifier">box_vagrantfile</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">box_vagrantfile</span>
358:         <span class="ruby-keyword kw">end</span>
359: 
360:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">home_path</span>
361:           <span class="ruby-comment cmt"># Load the home Vagrantfile</span>
362:           <span class="ruby-identifier">home_vagrantfile</span> = <span class="ruby-identifier">find_vagrantfile</span>(<span class="ruby-identifier">home_path</span>)
363:           <span class="ruby-identifier">config_loader</span>.<span class="ruby-identifier">set</span>(<span class="ruby-identifier">:home</span>, <span class="ruby-identifier">home_vagrantfile</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">home_vagrantfile</span>
364:         <span class="ruby-keyword kw">end</span>
365: 
366:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">root_path</span>
367:           <span class="ruby-comment cmt"># Load the Vagrantfile in this directory</span>
368:           <span class="ruby-identifier">root_vagrantfile</span> = <span class="ruby-identifier">find_vagrantfile</span>(<span class="ruby-identifier">root_path</span>)
369:           <span class="ruby-identifier">config_loader</span>.<span class="ruby-identifier">set</span>(<span class="ruby-identifier">:root</span>, <span class="ruby-identifier">root_vagrantfile</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">root_vagrantfile</span>
370:         <span class="ruby-keyword kw">end</span>
371: 
372:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">subvm</span>
373:           <span class="ruby-comment cmt"># We have subvm configuration, so set that up as well.</span>
374:           <span class="ruby-identifier">config_loader</span>.<span class="ruby-identifier">set</span>(<span class="ruby-identifier">:vm</span>, <span class="ruby-identifier">subvm</span>.<span class="ruby-identifier">proc_stack</span>)
375:         <span class="ruby-keyword kw">end</span>
376: 
377:         <span class="ruby-comment cmt"># Execute the configuration stack and store the result as the final</span>
378:         <span class="ruby-comment cmt"># value in the config ivar.</span>
379:         <span class="ruby-identifier">config_loader</span>.<span class="ruby-identifier">load</span>
380:       <span class="ruby-keyword kw">end</span>
381: 
382:       <span class="ruby-comment cmt"># For the global configuration, we only need to load the configuration</span>
383:       <span class="ruby-comment cmt"># in a single pass, since nothing is conditional on the configuration.</span>
384:       <span class="ruby-identifier">global</span> = <span class="ruby-identifier">inner_load</span>.<span class="ruby-identifier">call</span>
385: 
386:       <span class="ruby-comment cmt"># For each virtual machine represented by this environment, we have</span>
387:       <span class="ruby-comment cmt"># to load the configuration in two-passes. We do this because the</span>
388:       <span class="ruby-comment cmt"># first pass is used to determine the box for the VM. The second pass</span>
389:       <span class="ruby-comment cmt"># is used to also load the box Vagrantfile.</span>
390:       <span class="ruby-identifier">defined_vm_keys</span> = <span class="ruby-identifier">global</span>.<span class="ruby-identifier">vm</span>.<span class="ruby-identifier">defined_vm_keys</span>.<span class="ruby-identifier">dup</span>
391:       <span class="ruby-identifier">defined_vms</span>     = <span class="ruby-identifier">global</span>.<span class="ruby-identifier">vm</span>.<span class="ruby-identifier">defined_vms</span>.<span class="ruby-identifier">dup</span>
392: 
393:       <span class="ruby-comment cmt"># If this isn't a multi-VM environment, then setup the default VM</span>
394:       <span class="ruby-comment cmt"># to simply be our configuration.</span>
395:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">defined_vm_keys</span>.<span class="ruby-identifier">empty?</span>
396:         <span class="ruby-identifier">defined_vm_keys</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">DEFAULT_VM</span>
397:         <span class="ruby-identifier">defined_vms</span>[<span class="ruby-constant">DEFAULT_VM</span>] = <span class="ruby-constant">Config</span><span class="ruby-operator">::</span><span class="ruby-constant">VMConfig</span><span class="ruby-operator">::</span><span class="ruby-constant">SubVM</span>.<span class="ruby-identifier">new</span>
398:       <span class="ruby-keyword kw">end</span>
399: 
400:       <span class="ruby-identifier">vm_configs</span> = <span class="ruby-identifier">defined_vm_keys</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">vm_name</span><span class="ruby-operator">|</span>
401:         <span class="ruby-ivar">@logger</span>.<span class="ruby-identifier">debug</span>(<span class="ruby-node">&quot;Loading configuration for VM: #{vm_name}&quot;</span>)
402: 
403:         <span class="ruby-identifier">subvm</span> = <span class="ruby-identifier">defined_vms</span>[<span class="ruby-identifier">vm_name</span>]
404: 
405:         <span class="ruby-comment cmt"># First pass, first run.</span>
406:         <span class="ruby-identifier">config</span> = <span class="ruby-identifier">inner_load</span>[<span class="ruby-identifier">subvm</span>]
407: 
408:         <span class="ruby-comment cmt"># Second pass, with the box</span>
409:         <span class="ruby-identifier">config</span> = <span class="ruby-identifier">inner_load</span>[<span class="ruby-identifier">subvm</span>, <span class="ruby-identifier">boxes</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">config</span>.<span class="ruby-identifier">vm</span>.<span class="ruby-identifier">box</span>)]
410:         <span class="ruby-identifier">config</span>.<span class="ruby-identifier">vm</span>.<span class="ruby-identifier">name</span> = <span class="ruby-identifier">vm_name</span>
411: 
412:         <span class="ruby-comment cmt"># Return the final configuration for this VM</span>
413:         <span class="ruby-identifier">config</span>
414:       <span class="ruby-keyword kw">end</span>
415: 
416:       <span class="ruby-comment cmt"># Finally, we have our configuration. Set it and forget it.</span>
417:       <span class="ruby-ivar">@config</span> = <span class="ruby-constant">Config</span><span class="ruby-operator">::</span><span class="ruby-constant">Container</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">global</span>, <span class="ruby-identifier">vm_configs</span>)
418:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000381">
                    
                    <a name="M000381"></a><b>load_vms!</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Loads the persisted <a href="VM.html">VM</a> (if it exists) for this
environment.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000381_source')" id="l_M000381_source">show</a>
                        
                    </p>
                    <div id="M000381_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/vagrant/environment.rb, line 421</span>
421:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">load_vms!</span>
422:       <span class="ruby-identifier">result</span> = {}
423: 
424:       <span class="ruby-comment cmt"># Load all the virtual machine instances.</span>
425:       <span class="ruby-identifier">config</span>.<span class="ruby-identifier">vms</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">name</span><span class="ruby-operator">|</span>
426:         <span class="ruby-identifier">result</span>[<span class="ruby-identifier">name</span>] = <span class="ruby-constant">Vagrant</span><span class="ruby-operator">::</span><span class="ruby-constant">VM</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">name</span>, <span class="ruby-keyword kw">self</span>, <span class="ruby-identifier">config</span>.<span class="ruby-identifier">for_vm</span>(<span class="ruby-identifier">name</span>))
427:       <span class="ruby-keyword kw">end</span>
428: 
429:       <span class="ruby-identifier">result</span>
430:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000377">
                    
                    <a name="M000377"></a><b>loaded?</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Returns a boolean representing if the environment has been loaded or not.
</p>
<p>
@return [Bool]
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000377_source')" id="l_M000377_source">show</a>
                        
                    </p>
                    <div id="M000377_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/vagrant/environment.rb, line 308</span>
308:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">loaded?</span>
309:       <span class="ruby-operator">!</span><span class="ruby-operator">!</span><span class="ruby-ivar">@loaded</span>
310:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000372">
                    
                    <a name="M000372"></a><b>local_data</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Loads (on initial access) and reads data from the local data store. This
file is always at the root path as the file &#8220;~/.vagrant&#8220; and
contains a JSON dump of a hash. See {DataStore} for more information.
</p>
<p>
@return [DataStore]
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000372_source')" id="l_M000372_source">show</a>
                        
                    </p>
                    <div id="M000372_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/vagrant/environment.rb, line 226</span>
226:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">local_data</span>
227:       <span class="ruby-ivar">@local_data</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">DataStore</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">dotfile_path</span>)
228:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000375">
                    
                    <a name="M000375"></a><b>lock</b>()
                    
                </div>
                
                <div class="description">
                  <p>
This locks <a href="../Vagrant.html">Vagrant</a> for the duration of the
block passed to this method. During this time, any other environment which
attempts to lock which points to the same lock file will fail.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000375_source')" id="l_M000375_source">show</a>
                        
                    </p>
                    <div id="M000375_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/vagrant/environment.rb, line 262</span>
262:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">lock</span>
263:       <span class="ruby-comment cmt"># This allows multiple locks in the same process to be nested</span>
264:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">yield</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@lock_acquired</span>
265: 
266:       <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">lock_path</span>, <span class="ruby-value str">&quot;w+&quot;</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span>
267:         <span class="ruby-comment cmt"># The file locking fails only if it returns &quot;false.&quot; If it</span>
268:         <span class="ruby-comment cmt"># succeeds it returns a 0, so we must explicitly check for</span>
269:         <span class="ruby-comment cmt"># the proper error case.</span>
270:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">Errors</span><span class="ruby-operator">::</span><span class="ruby-constant">EnvironmentLockedError</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">f</span>.<span class="ruby-identifier">flock</span>(<span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">LOCK_EX</span> <span class="ruby-operator">|</span> <span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">LOCK_NB</span>) <span class="ruby-operator">===</span> <span class="ruby-keyword kw">false</span>
271: 
272:         <span class="ruby-keyword kw">begin</span>
273:           <span class="ruby-comment cmt"># Mark that we have a lock</span>
274:           <span class="ruby-ivar">@lock_acquired</span> = <span class="ruby-keyword kw">true</span>
275: 
276:           <span class="ruby-keyword kw">yield</span>
277:         <span class="ruby-keyword kw">ensure</span>
278:           <span class="ruby-comment cmt"># We need to make sure that no matter what this is always</span>
279:           <span class="ruby-comment cmt"># reset to false so we don't think we have a lock when we</span>
280:           <span class="ruby-comment cmt"># actually don't.</span>
281:           <span class="ruby-ivar">@lock_acquired</span> = <span class="ruby-keyword kw">false</span>
282:         <span class="ruby-keyword kw">end</span>
283:       <span class="ruby-keyword kw">end</span>
284:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000374">
                    
                    <a name="M000374"></a><b>lock_path</b>()
                    
                </div>
                
                <div class="description">
                  <p>
This returns the path which <a href="../Vagrant.html">Vagrant</a> uses to
determine the location of the file lock. This is specific to each operating
system.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000374_source')" id="l_M000374_source">show</a>
                        
                    </p>
                    <div id="M000374_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/vagrant/environment.rb, line 255</span>
255:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">lock_path</span>
256:       <span class="ruby-ivar">@lock_path</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">tmp_path</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;vagrant.lock&quot;</span>)
257:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000366">
                    
                    <a name="M000366"></a><b>multivm?</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Returns a boolean whether this environment represents a multi-<a
href="VM.html">VM</a> environment or not. This will work even when called
on child environments.
</p>
<p>
@return [Bool]
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000366_source')" id="l_M000366_source">show</a>
                        
                    </p>
                    <div id="M000366_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/vagrant/environment.rb, line 146</span>
146:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">multivm?</span>
147:       <span class="ruby-identifier">vms</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">vms</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">first</span> <span class="ruby-operator">!=</span> <span class="ruby-constant">DEFAULT_VM</span>
148:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000365">
                    
                    <a name="M000365"></a><b>primary_vm</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Returns the primary <a href="VM.html">VM</a> associated with this
environment. This method is only applicable for multi-<a
href="VM.html">VM</a> environments. This can potentially be nil if no
primary <a href="VM.html">VM</a> is specified.
</p>
<p>
@return [VM]
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000365_source')" id="l_M000365_source">show</a>
                        
                    </p>
                    <div id="M000365_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/vagrant/environment.rb, line 131</span>
131:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">primary_vm</span>
132:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">vms</span>.<span class="ruby-identifier">values</span>.<span class="ruby-identifier">first</span> <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">multivm?</span>
133: 
134:       <span class="ruby-identifier">config</span>.<span class="ruby-identifier">vm</span>.<span class="ruby-identifier">defined_vms</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">name</span>, <span class="ruby-identifier">subvm</span><span class="ruby-operator">|</span>
135:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">vms</span>[<span class="ruby-identifier">name</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">subvm</span>.<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:primary</span>]
136:       <span class="ruby-keyword kw">end</span>
137: 
138:       <span class="ruby-keyword kw">nil</span>
139:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000379">
                    
                    <a name="M000379"></a><b>reload!</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Reloads the configuration of this environment.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000379_source')" id="l_M000379_source">show</a>
                        
                    </p>
                    <div id="M000379_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/vagrant/environment.rb, line 326</span>
326:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">reload!</span>
327:       <span class="ruby-comment cmt"># Reload the configuration</span>
328:       <span class="ruby-identifier">load_config!</span>
329: 
330:       <span class="ruby-comment cmt"># Clear the VMs because this can now be diferent due to configuration</span>
331:       <span class="ruby-ivar">@vms</span> = <span class="ruby-keyword kw">nil</span>
332:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000373">
                    
                    <a name="M000373"></a><b>root_path</b>()
                    
                </div>
                
                <div class="description">
                  <p>
The root path is the path where the top-most (loaded last) Vagrantfile
resides. It can be considered the project root for this environment.
</p>
<p>
@return [String]
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000373_source')" id="l_M000373_source">show</a>
                        
                    </p>
                    <div id="M000373_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/vagrant/environment.rb, line 235</span>
235:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">root_path</span>
236:       <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@root_path</span> <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">defined?</span>(<span class="ruby-ivar">@root_path</span>)
237: 
238:       <span class="ruby-identifier">root_finder</span> = <span class="ruby-identifier">lambda</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">path</span><span class="ruby-operator">|</span>
239:         <span class="ruby-comment cmt"># Note: To remain compatible with Ruby 1.8, we have to use</span>
240:         <span class="ruby-comment cmt"># a `find` here instead of an `each`.</span>
241:         <span class="ruby-identifier">found</span> = <span class="ruby-identifier">vagrantfile_name</span>.<span class="ruby-identifier">find</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">rootfile</span><span class="ruby-operator">|</span>
242:           <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">path</span>.<span class="ruby-identifier">to_s</span>, <span class="ruby-identifier">rootfile</span>))
243:         <span class="ruby-keyword kw">end</span>
244: 
245:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">path</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">found</span>
246:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">path</span>.<span class="ruby-identifier">root?</span> <span class="ruby-operator">||</span> <span class="ruby-operator">!</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">path</span>)
247:         <span class="ruby-identifier">root_finder</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">path</span>.<span class="ruby-identifier">parent</span>)
248:       <span class="ruby-keyword kw">end</span>
249: 
250:       <span class="ruby-ivar">@root_path</span> = <span class="ruby-identifier">root_finder</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">cwd</span>)
251:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000382">
                    
                    <a name="M000382"></a><b>setup_home_path</b>()
                    
                </div>
                
                <div class="description">
                  <p>
This sets the `@<a href="Environment.html#home_path">home_path</a>`
variable properly.
</p>
<p>
@return [Pathname]
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000382_source')" id="l_M000382_source">show</a>
                        
                    </p>
                    <div id="M000382_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/vagrant/environment.rb, line 435</span>
435:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">setup_home_path</span>
436:       <span class="ruby-ivar">@home_path</span> = <span class="ruby-constant">Pathname</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-ivar">@home_path</span> <span class="ruby-operator">||</span>
437:                                                  <span class="ruby-constant">ENV</span>[<span class="ruby-value str">&quot;VAGRANT_HOME&quot;</span>] <span class="ruby-operator">||</span>
438:                                                  <span class="ruby-constant">DEFAULT_HOME</span>))
439:       <span class="ruby-ivar">@logger</span>.<span class="ruby-identifier">info</span>(<span class="ruby-node">&quot;Home path: #{@home_path}&quot;</span>)
440: 
441:       <span class="ruby-comment cmt"># Setup the array of necessary home directories</span>
442:       <span class="ruby-identifier">dirs</span> = [<span class="ruby-ivar">@home_path</span>]
443:       <span class="ruby-identifier">dirs</span> <span class="ruby-operator">+=</span> <span class="ruby-constant">HOME_SUBDIRS</span>.<span class="ruby-identifier">collect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">subdir</span><span class="ruby-operator">|</span> <span class="ruby-ivar">@home_path</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">subdir</span>) }
444: 
445:       <span class="ruby-comment cmt"># Go through each required directory, creating it if it doesn't exist</span>
446:       <span class="ruby-identifier">dirs</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">dir</span><span class="ruby-operator">|</span>
447:         <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">directory?</span>(<span class="ruby-identifier">dir</span>)
448: 
449:         <span class="ruby-keyword kw">begin</span>
450:           <span class="ruby-ivar">@logger</span>.<span class="ruby-identifier">info</span>(<span class="ruby-node">&quot;Creating: #{dir}&quot;</span>)
451:           <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span>(<span class="ruby-identifier">dir</span>)
452:         <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">EACCES</span>
453:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">Errors</span><span class="ruby-operator">::</span><span class="ruby-constant">HomeDirectoryNotAccessible</span>, <span class="ruby-identifier">:home_path</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@home_path</span>.<span class="ruby-identifier">to_s</span>
454:         <span class="ruby-keyword kw">end</span>
455:       <span class="ruby-keyword kw">end</span>
456:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000363">
                    
                    <a name="M000363"></a><b>vms</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Returns the VMs associated with this environment.
</p>
<p>
@return [Hash<Symbol,VM>]
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000363_source')" id="l_M000363_source">show</a>
                        
                    </p>
                    <div id="M000363_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/vagrant/environment.rb, line 112</span>
112:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">vms</span>
113:       <span class="ruby-identifier">load!</span> <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">loaded?</span>
114:       <span class="ruby-ivar">@vms</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">load_vms!</span>
115:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000364">
                    
                    <a name="M000364"></a><b>vms_ordered</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Returns the VMs associated with this environment, in the order that they
were defined.
</p>
<p>
@return [Array<VM>]
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000364_source')" id="l_M000364_source">show</a>
                        
                    </p>
                    <div id="M000364_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/vagrant/environment.rb, line 121</span>
121:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">vms_ordered</span>
122:       <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@vms</span>.<span class="ruby-identifier">values</span> <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">multivm?</span>
123:       <span class="ruby-ivar">@vms_enum</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">config</span>.<span class="ruby-identifier">global</span>.<span class="ruby-identifier">vm</span>.<span class="ruby-identifier">defined_vm_keys</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">name</span><span class="ruby-operator">|</span> <span class="ruby-ivar">@vms</span>[<span class="ruby-identifier">name</span>] }
124:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Protected methods</div>
            
            <div class="method">
                <div class="title" id="M000383">
                    
                    <a name="M000383"></a><b>copy_insecure_private_key</b>()
                    
                </div>
                
                <div class="description">
                  <p>
This method copies the private key into the home directory if it
doesn&#8217;t already exist.
</p>
<p>
This must be done because `ssh` requires that the key is chmod 0600, but if
<a href="../Vagrant.html">Vagrant</a> is installed as a separate user, then
the effective uid won&#8217;t be able to read the key. So the key is copied
to the home directory and chmod 0600.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000383_source')" id="l_M000383_source">show</a>
                        
                    </p>
                    <div id="M000383_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/vagrant/environment.rb, line 467</span>
467:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">copy_insecure_private_key</span>
468:       <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@default_private_key_path</span>.<span class="ruby-identifier">exist?</span>
469:         <span class="ruby-ivar">@logger</span>.<span class="ruby-identifier">info</span>(<span class="ruby-value str">&quot;Copying private key to home directory&quot;</span>)
470:         <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">cp</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-value str">&quot;keys/vagrant&quot;</span>, <span class="ruby-constant">Vagrant</span>.<span class="ruby-identifier">source_root</span>),
471:                      <span class="ruby-ivar">@default_private_key_path</span>)
472:       <span class="ruby-keyword kw">end</span>
473: 
474:       <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">Util</span><span class="ruby-operator">::</span><span class="ruby-constant">Platform</span>.<span class="ruby-identifier">windows?</span>
475:         <span class="ruby-comment cmt"># On Windows, permissions don't matter as much, so don't worry</span>
476:         <span class="ruby-comment cmt"># about doing chmod.</span>
477:         <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Util</span><span class="ruby-operator">::</span><span class="ruby-constant">FileMode</span>.<span class="ruby-identifier">from_octal</span>(<span class="ruby-ivar">@default_private_key_path</span>.<span class="ruby-identifier">stat</span>.<span class="ruby-identifier">mode</span>) <span class="ruby-operator">!=</span> <span class="ruby-value str">&quot;600&quot;</span>
478:           <span class="ruby-ivar">@logger</span>.<span class="ruby-identifier">info</span>(<span class="ruby-value str">&quot;Changing permissions on private key to 0600&quot;</span>)
479:           <span class="ruby-ivar">@default_private_key_path</span>.<span class="ruby-identifier">chmod</span>(<span class="ruby-value">0600</span>)
480:         <span class="ruby-keyword kw">end</span>
481:       <span class="ruby-keyword kw">end</span>
482:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000384">
                    
                    <a name="M000384"></a><b>find_vagrantfile</b>(search_path)
                    
                </div>
                
                <div class="description">
                  <p>
Finds the Vagrantfile in the given directory.
</p>
<p>
@param [Pathname] path Path to search in. @return [Pathname]
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000384_source')" id="l_M000384_source">show</a>
                        
                    </p>
                    <div id="M000384_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/vagrant/environment.rb, line 488</span>
488:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">find_vagrantfile</span>(<span class="ruby-identifier">search_path</span>)
489:       <span class="ruby-ivar">@vagrantfile_name</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">vagrantfile</span><span class="ruby-operator">|</span>
490:         <span class="ruby-identifier">current_path</span> = <span class="ruby-identifier">search_path</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">vagrantfile</span>)
491:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">current_path</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">current_path</span>.<span class="ruby-identifier">exist?</span>
492:       <span class="ruby-keyword kw">end</span>
493: 
494:       <span class="ruby-keyword kw">nil</span>
495:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Class Public methods</div>
            
            <div class="method">
                <div class="title" id="M000354">
                    
                    <a name="M000354"></a><b>new</b>(opts=nil)
                    
                </div>
                
                <div class="description">
                  <p>
Initializes a new environment with the given options. The options is a hash
where the main available key is `cwd`, which defines where the environment
represents. There are other options available but they shouldn&#8217;t be
used in general. If `cwd` is nil, then it defaults to the `Dir.pwd` (which
is the cwd of the executing process).
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000354_source')" id="l_M000354_source">show</a>
                        
                    </p>
                    <div id="M000354_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/vagrant/environment.rb, line 45</span>
45:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">opts</span>=<span class="ruby-keyword kw">nil</span>)
46:       <span class="ruby-identifier">opts</span> = {
47:         <span class="ruby-identifier">:cwd</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">nil</span>,
48:         <span class="ruby-identifier">:vagrantfile_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">nil</span>,
49:         <span class="ruby-identifier">:lock_path</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">nil</span>,
50:         <span class="ruby-identifier">:ui_class</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">nil</span>,
51:         <span class="ruby-identifier">:home_path</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">nil</span>
52:       }.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">opts</span> <span class="ruby-operator">||</span> {})
53: 
54:       <span class="ruby-comment cmt"># Set the default working directory to look for the vagrantfile</span>
55:       <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:cwd</span>] <span class="ruby-operator">||=</span> <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">pwd</span>
56:       <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:cwd</span>] = <span class="ruby-constant">Pathname</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:cwd</span>])
57: 
58:       <span class="ruby-comment cmt"># Set the default vagrantfile name, which can be either Vagrantfile</span>
59:       <span class="ruby-comment cmt"># or vagrantfile (capital for backwards compatibility)</span>
60:       <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:vagrantfile_name</span>] <span class="ruby-operator">||=</span> [<span class="ruby-value str">&quot;Vagrantfile&quot;</span>, <span class="ruby-value str">&quot;vagrantfile&quot;</span>]
61:       <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:vagrantfile_name</span>] = [<span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:vagrantfile_name</span>]] <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:vagrantfile_name</span>].<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>)
62: 
63:       <span class="ruby-comment cmt"># Set instance variables for all the configuration parameters.</span>
64:       <span class="ruby-ivar">@cwd</span>    = <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:cwd</span>]
65:       <span class="ruby-ivar">@vagrantfile_name</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:vagrantfile_name</span>]
66:       <span class="ruby-ivar">@lock_path</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:lock_path</span>]
67:       <span class="ruby-ivar">@home_path</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:home_path</span>]
68: 
69:       <span class="ruby-identifier">ui_class</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:ui_class</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">UI</span><span class="ruby-operator">::</span><span class="ruby-constant">Silent</span>
70:       <span class="ruby-ivar">@ui</span>      = <span class="ruby-identifier">ui_class</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;vagrant&quot;</span>)
71: 
72:       <span class="ruby-ivar">@loaded</span> = <span class="ruby-keyword kw">false</span>
73:       <span class="ruby-ivar">@lock_acquired</span> = <span class="ruby-keyword kw">false</span>
74: 
75:       <span class="ruby-ivar">@logger</span> = <span class="ruby-constant">Log4r</span><span class="ruby-operator">::</span><span class="ruby-constant">Logger</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;vagrant::environment&quot;</span>)
76:       <span class="ruby-ivar">@logger</span>.<span class="ruby-identifier">info</span>(<span class="ruby-node">&quot;Environment initialized (#{self})&quot;</span>)
77:       <span class="ruby-ivar">@logger</span>.<span class="ruby-identifier">info</span>(<span class="ruby-node">&quot;  - cwd: #{cwd}&quot;</span>)
78: 
79:       <span class="ruby-comment cmt"># Setup the home directory</span>
80:       <span class="ruby-identifier">setup_home_path</span>
81:       <span class="ruby-ivar">@tmp_path</span> = <span class="ruby-ivar">@home_path</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;tmp&quot;</span>)
82:       <span class="ruby-ivar">@boxes_path</span> = <span class="ruby-ivar">@home_path</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;boxes&quot;</span>)
83: 
84:       <span class="ruby-comment cmt"># Setup the default private key</span>
85:       <span class="ruby-ivar">@default_private_key_path</span> = <span class="ruby-ivar">@home_path</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;insecure_private_key&quot;</span>)
86:       <span class="ruby-identifier">copy_insecure_private_key</span>
87:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    