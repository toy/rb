<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>Rake::ExtensionTask</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../css/main.css" type="text/css" media="screen" />
    <script src="../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Class</span> 
            Rake::ExtensionTask 
            
                <span class="parent">&lt; 
                    
                    BaseExtensionTask
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../files/lib/rake/extensiontask_rb.html">lib/rake/extensiontask.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>B</dt>
        <dd>
            <ul>
                
                <li><a href="#M000019">binary</a></li>
                
            </ul>
        </dd>
    
        <dt>C</dt>
        <dd>
            <ul>
                
                <li><a href="#M000032">compiled_files</a>,</li>
                
                <li><a href="#M000033">compiles_cross_platform</a>,</li>
                
                <li><a href="#M000014">cross_compiling</a>,</li>
                
                <li><a href="#M000013">cross_platform</a></li>
                
            </ul>
        </dd>
    
        <dt>D</dt>
        <dd>
            <ul>
                
                <li><a href="#M000020">define</a>,</li>
                
                <li><a href="#M000021">define_compile_tasks</a>,</li>
                
                <li><a href="#M000026">define_cross_platform_tasks</a>,</li>
                
                <li><a href="#M000027">define_cross_platform_tasks_with_version</a>,</li>
                
                <li><a href="#M000028">define_dummy_cross_platform_tasks</a>,</li>
                
                <li><a href="#M000024">define_native_tasks</a>,</li>
                
                <li><a href="#M000031">dev_null</a></li>
                
            </ul>
        </dd>
    
        <dt>E</dt>
        <dd>
            <ul>
                
                <li><a href="#M000029">extconf</a></li>
                
            </ul>
        </dd>
    
        <dt>F</dt>
        <dd>
            <ul>
                
                <li><a href="#M000035">fake_rb</a></li>
                
            </ul>
        </dd>
    
        <dt>I</dt>
        <dd>
            <ul>
                
                <li><a href="#M000012">init</a></li>
                
            </ul>
        </dd>
    
        <dt>M</dt>
        <dd>
            <ul>
                
                <li><a href="#M000030">make</a></li>
                
            </ul>
        </dd>
    
        <dt>N</dt>
        <dd>
            <ul>
                
                <li><a href="#M000034">natives_cross_platform</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    

    

    

    

    
    <div class="sectiontitle">Attributes</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>config_script</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>cross_compile</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>cross_platform</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>cross_config_options</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>no_native</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>config_includes</td>
            <td class='attr-desc'></td>
        </tr>
        
    </table>
    

    
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M000019">
                    
                    <a name="M000019"></a><b>binary</b>(platform = nil)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000019_source')" id="l_M000019_source">show</a>
                        
                    </p>
                    <div id="M000019_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/rake/extensiontask.rb, line 39</span>
39:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">binary</span>(<span class="ruby-identifier">platform</span> = <span class="ruby-keyword kw">nil</span>)
40:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">platform</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;java&quot;</span>
41:         <span class="ruby-node">&quot;#{name}.#{RbConfig::MAKEFILE_CONFIG['DLEXT']}&quot;</span>
42:       <span class="ruby-keyword kw">else</span>
43:         <span class="ruby-keyword kw">super</span>
44:       <span class="ruby-keyword kw">end</span>
45:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000014">
                    
                    <a name="M000014"></a><b>cross_compiling</b>(&amp;block)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000014_source')" id="l_M000014_source">show</a>
                        
                    </p>
                    <div id="M000014_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/rake/extensiontask.rb, line 35</span>
35:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">cross_compiling</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
36:       <span class="ruby-ivar">@cross_compiling</span> = <span class="ruby-identifier">block</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block_given?</span>
37:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000013">
                    
                    <a name="M000013"></a><b>cross_platform</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000013_source')" id="l_M000013_source">show</a>
                        
                    </p>
                    <div id="M000013_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/rake/extensiontask.rb, line 31</span>
31:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">cross_platform</span>
32:       <span class="ruby-ivar">@cross_platform</span> <span class="ruby-operator">||=</span> <span class="ruby-value str">'i386-mingw32'</span>
33:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000020">
                    
                    <a name="M000020"></a><b>define</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000020_source')" id="l_M000020_source">show</a>
                        
                    </p>
                    <div id="M000020_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/rake/extensiontask.rb, line 47</span>
47:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">define</span>
48:       <span class="ruby-keyword kw">if</span> (<span class="ruby-keyword kw">defined?</span>(<span class="ruby-constant">RUBY_ENGINE</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-constant">RUBY_ENGINE</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'ironruby'</span>)
49:         <span class="ruby-identifier">warn_once</span> <span class="ruby-value str">&quot;WARNING: You're attempting to (cross-)compile C extensions from a platform\n(\#{RUBY_ENGINE}) that does not support native extensions or mkmf.rb.\nRerun `rake` under MRI Ruby 1.8.x/1.9.x to cross/native compile.\n&quot;</span>
50:         <span class="ruby-keyword kw">return</span>
51:       <span class="ruby-keyword kw">end</span>
52: 
53:       <span class="ruby-keyword kw">super</span>
54: 
55:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">compiled_files</span>.<span class="ruby-identifier">empty?</span>
56:         <span class="ruby-identifier">warn</span> <span class="ruby-node">&quot;WARNING: rake-compiler found compiled files in '#{@ext_dir}' directory. Please remove them.&quot;</span>
57:       <span class="ruby-keyword kw">end</span>
58: 
59:       <span class="ruby-comment cmt"># only gems with 'ruby' platforms are allowed to define native tasks</span>
60:       <span class="ruby-identifier">define_native_tasks</span> <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@no_native</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-ivar">@gem_spec</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@gem_spec</span>.<span class="ruby-identifier">platform</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'ruby'</span>)
61: 
62:       <span class="ruby-comment cmt"># only define cross platform functionality when enabled</span>
63:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@cross_compile</span>
64: 
65:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">cross_platform</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>) <span class="ruby-keyword kw">then</span>
66:         <span class="ruby-identifier">cross_platform</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">platf</span><span class="ruby-operator">|</span> <span class="ruby-identifier">define_cross_platform_tasks</span>(<span class="ruby-identifier">platf</span>) }
67:       <span class="ruby-keyword kw">else</span>
68:         <span class="ruby-identifier">define_cross_platform_tasks</span>(<span class="ruby-identifier">cross_platform</span>)
69:       <span class="ruby-keyword kw">end</span>
70:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000012">
                    
                    <a name="M000012"></a><b>init</b>(name = nil, gem_spec = nil)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000012_source')" id="l_M000012_source">show</a>
                        
                    </p>
                    <div id="M000012_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/rake/extensiontask.rb, line 19</span>
19:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">init</span>(<span class="ruby-identifier">name</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">gem_spec</span> = <span class="ruby-keyword kw">nil</span>)
20:       <span class="ruby-keyword kw">super</span>
21:       <span class="ruby-ivar">@config_script</span> = <span class="ruby-value str">'extconf.rb'</span>
22:       <span class="ruby-ivar">@source_pattern</span> = <span class="ruby-value str">&quot;*.c&quot;</span>
23:       <span class="ruby-ivar">@compiled_pattern</span> = <span class="ruby-value str">&quot;*.{o,obj,so,bundle,dSYM}&quot;</span>
24:       <span class="ruby-ivar">@cross_compile</span> = <span class="ruby-keyword kw">false</span>
25:       <span class="ruby-ivar">@cross_config_options</span> = []
26:       <span class="ruby-ivar">@cross_compiling</span> = <span class="ruby-keyword kw">nil</span>
27:       <span class="ruby-ivar">@no_native</span> = <span class="ruby-keyword kw">false</span>
28:       <span class="ruby-ivar">@config_includes</span> = []
29:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Private methods</div>
            
            <div class="method">
                <div class="title" id="M000032">
                    
                    <a name="M000032"></a><b>compiled_files</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000032_source')" id="l_M000032_source">show</a>
                        
                    </p>
                    <div id="M000032_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rake/extensiontask.rb, line 391</span>
391:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">compiled_files</span>
392:       <span class="ruby-constant">FileList</span>[<span class="ruby-node">&quot;#{@ext_dir}/#{@compiled_pattern}&quot;</span>]
393:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000033">
                    
                    <a name="M000033"></a><b>compiles_cross_platform</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000033_source')" id="l_M000033_source">show</a>
                        
                    </p>
                    <div id="M000033_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rake/extensiontask.rb, line 395</span>
395:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">compiles_cross_platform</span>
396:       [<span class="ruby-operator">*</span><span class="ruby-ivar">@cross_platform</span>].<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span> <span class="ruby-node">&quot;compile:#{p}&quot;</span> }
397:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000021">
                    
                    <a name="M000021"></a><b>define_compile_tasks</b>(for_platform = nil, ruby_ver = RUBY_VERSION)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000021_source')" id="l_M000021_source">show</a>
                        
                    </p>
                    <div id="M000021_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rake/extensiontask.rb, line 78</span>
 78:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">define_compile_tasks</span>(<span class="ruby-identifier">for_platform</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">ruby_ver</span> = <span class="ruby-constant">RUBY_VERSION</span>)
 79:       <span class="ruby-comment cmt"># platform usage</span>
 80:       <span class="ruby-identifier">platf</span> = <span class="ruby-identifier">for_platform</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">platform</span>
 81: 
 82:       <span class="ruby-comment cmt"># lib_path</span>
 83:       <span class="ruby-identifier">lib_path</span> = <span class="ruby-identifier">lib_dir</span>
 84: 
 85:       <span class="ruby-comment cmt"># tmp_path</span>
 86:       <span class="ruby-identifier">tmp_path</span> = <span class="ruby-node">&quot;#{@tmp_dir}/#{platf}/#{@name}/#{ruby_ver}&quot;</span>
 87: 
 88:       <span class="ruby-comment cmt"># cleanup and clobbering</span>
 89:       <span class="ruby-constant">CLEAN</span>.<span class="ruby-identifier">include</span>(<span class="ruby-identifier">tmp_path</span>)
 90:       <span class="ruby-constant">CLOBBER</span>.<span class="ruby-identifier">include</span>(<span class="ruby-node">&quot;#{lib_path}/#{binary(platf)}&quot;</span>)
 91:       <span class="ruby-constant">CLOBBER</span>.<span class="ruby-identifier">include</span>(<span class="ruby-node">&quot;#{@tmp_dir}&quot;</span>)
 92: 
 93:       <span class="ruby-comment cmt"># directories we need</span>
 94:       <span class="ruby-identifier">directory</span> <span class="ruby-identifier">tmp_path</span>
 95:       <span class="ruby-identifier">directory</span> <span class="ruby-identifier">lib_dir</span>
 96: 
 97:       <span class="ruby-comment cmt"># copy binary from temporary location to final lib</span>
 98:       <span class="ruby-comment cmt"># tmp/extension_name/extension_name.{so,bundle} =&gt; lib/</span>
 99:       <span class="ruby-identifier">task</span> <span class="ruby-node">&quot;copy:#{@name}:#{platf}:#{ruby_ver}&quot;</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">lib_path</span>, <span class="ruby-node">&quot;#{tmp_path}/#{binary(platf)}&quot;</span>] <span class="ruby-keyword kw">do</span>
100:         <span class="ruby-identifier">install</span> <span class="ruby-node">&quot;#{tmp_path}/#{binary(platf)}&quot;</span>, <span class="ruby-node">&quot;#{lib_path}/#{binary(platf)}&quot;</span>
101:       <span class="ruby-keyword kw">end</span>
102: 
103:       <span class="ruby-comment cmt"># binary in temporary folder depends on makefile and source files</span>
104:       <span class="ruby-comment cmt"># tmp/extension_name/extension_name.{so,bundle}</span>
105:       <span class="ruby-identifier">file</span> <span class="ruby-node">&quot;#{tmp_path}/#{binary(platf)}&quot;</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-node">&quot;#{tmp_path}/Makefile&quot;</span>] <span class="ruby-operator">+</span> <span class="ruby-identifier">source_files</span> <span class="ruby-keyword kw">do</span>
106:         <span class="ruby-identifier">jruby_compile_msg</span> = <span class="ruby-value str">&quot;Compiling a native C extension on JRuby. This is discouraged and a\nJava extension should be preferred.\n&quot;</span>
107:         <span class="ruby-identifier">warn_once</span>(<span class="ruby-identifier">jruby_compile_msg</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">defined?</span>(<span class="ruby-constant">JRUBY_VERSION</span>)
108: 
109:         <span class="ruby-identifier">chdir</span> <span class="ruby-identifier">tmp_path</span> <span class="ruby-keyword kw">do</span>
110:           <span class="ruby-identifier">sh</span> <span class="ruby-identifier">make</span>
111:         <span class="ruby-keyword kw">end</span>
112:       <span class="ruby-keyword kw">end</span>
113: 
114:       <span class="ruby-comment cmt"># makefile depends of tmp_dir and config_script</span>
115:       <span class="ruby-comment cmt"># tmp/extension_name/Makefile</span>
116:       <span class="ruby-identifier">file</span> <span class="ruby-node">&quot;#{tmp_path}/Makefile&quot;</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">tmp_path</span>, <span class="ruby-identifier">extconf</span>] <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
117:         <span class="ruby-identifier">options</span> = <span class="ruby-ivar">@config_options</span>.<span class="ruby-identifier">dup</span>
118: 
119:         <span class="ruby-comment cmt"># include current directory</span>
120:         <span class="ruby-identifier">include_dirs</span> = [<span class="ruby-value str">'.'</span>].<span class="ruby-identifier">concat</span>(<span class="ruby-ivar">@config_includes</span>).<span class="ruby-identifier">uniq</span>.<span class="ruby-identifier">join</span>(<span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">PATH_SEPARATOR</span>)
121:         <span class="ruby-identifier">cmd</span> = [<span class="ruby-constant">Gem</span>.<span class="ruby-identifier">ruby</span>, <span class="ruby-node">&quot;-I#{include_dirs}&quot;</span>]
122: 
123:         <span class="ruby-comment cmt"># if fake.rb is present, add to the command line</span>
124:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">t</span>.<span class="ruby-identifier">prerequisites</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-node">&quot;#{tmp_path}/fake.rb&quot;</span>) <span class="ruby-keyword kw">then</span>
125:           <span class="ruby-identifier">cmd</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">'-rfake'</span>
126:         <span class="ruby-keyword kw">end</span>
127: 
128:         <span class="ruby-comment cmt"># build a relative path to extconf script</span>
129:         <span class="ruby-identifier">abs_tmp_path</span> = (<span class="ruby-constant">Pathname</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">Dir</span>.<span class="ruby-identifier">pwd</span>) <span class="ruby-operator">+</span> <span class="ruby-identifier">tmp_path</span>).<span class="ruby-identifier">realpath</span>
130:         <span class="ruby-identifier">abs_extconf</span> = (<span class="ruby-constant">Pathname</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">Dir</span>.<span class="ruby-identifier">pwd</span>) <span class="ruby-operator">+</span> <span class="ruby-identifier">extconf</span>).<span class="ruby-identifier">realpath</span>
131: 
132:         <span class="ruby-comment cmt"># now add the extconf script</span>
133:         <span class="ruby-identifier">cmd</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">abs_extconf</span>.<span class="ruby-identifier">relative_path_from</span>(<span class="ruby-identifier">abs_tmp_path</span>)
134: 
135:         <span class="ruby-comment cmt"># rbconfig.rb will be present if we are cross compiling</span>
136:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">t</span>.<span class="ruby-identifier">prerequisites</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-node">&quot;#{tmp_path}/rbconfig.rb&quot;</span>) <span class="ruby-keyword kw">then</span>
137:           <span class="ruby-identifier">options</span>.<span class="ruby-identifier">push</span>(<span class="ruby-operator">*</span><span class="ruby-ivar">@cross_config_options</span>)
138:         <span class="ruby-keyword kw">end</span>
139: 
140:         <span class="ruby-comment cmt"># add options to command</span>
141:         <span class="ruby-identifier">cmd</span>.<span class="ruby-identifier">push</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">options</span>)
142: 
143:         <span class="ruby-comment cmt"># add any extra command line options</span>
144:         <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">extra_options</span>.<span class="ruby-identifier">empty?</span>
145:           <span class="ruby-identifier">cmd</span>.<span class="ruby-identifier">push</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">extra_options</span>)
146:         <span class="ruby-keyword kw">end</span>
147: 
148:         <span class="ruby-identifier">chdir</span> <span class="ruby-identifier">tmp_path</span> <span class="ruby-keyword kw">do</span>
149:           <span class="ruby-comment cmt"># FIXME: Rake is broken for multiple arguments system() calls.</span>
150:           <span class="ruby-comment cmt"># Add current directory to the search path of Ruby</span>
151:           <span class="ruby-identifier">sh</span> <span class="ruby-identifier">cmd</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">' '</span>)
152:         <span class="ruby-keyword kw">end</span>
153:       <span class="ruby-keyword kw">end</span>
154: 
155:       <span class="ruby-comment cmt"># compile tasks</span>
156:       <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">Rake</span><span class="ruby-operator">::</span><span class="ruby-constant">Task</span>.<span class="ruby-identifier">task_defined?</span>(<span class="ruby-value str">'compile'</span>) <span class="ruby-keyword kw">then</span>
157:         <span class="ruby-identifier">desc</span> <span class="ruby-value str">&quot;Compile all the extensions&quot;</span>
158:         <span class="ruby-identifier">task</span> <span class="ruby-value str">&quot;compile&quot;</span>
159:       <span class="ruby-keyword kw">end</span>
160: 
161:       <span class="ruby-comment cmt"># compile:name</span>
162:       <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">Rake</span><span class="ruby-operator">::</span><span class="ruby-constant">Task</span>.<span class="ruby-identifier">task_defined?</span>(<span class="ruby-node">&quot;compile:#{@name}&quot;</span>) <span class="ruby-keyword kw">then</span>
163:         <span class="ruby-identifier">desc</span> <span class="ruby-node">&quot;Compile #{@name}&quot;</span>
164:         <span class="ruby-identifier">task</span> <span class="ruby-node">&quot;compile:#{@name}&quot;</span>
165:       <span class="ruby-keyword kw">end</span>
166: 
167:       <span class="ruby-comment cmt"># Allow segmented compilation by platform (open door for 'cross compile')</span>
168:       <span class="ruby-identifier">task</span> <span class="ruby-node">&quot;compile:#{@name}:#{platf}&quot;</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-node">&quot;copy:#{@name}:#{platf}:#{ruby_ver}&quot;</span>]
169:       <span class="ruby-identifier">task</span> <span class="ruby-node">&quot;compile:#{platf}&quot;</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-node">&quot;compile:#{@name}:#{platf}&quot;</span>]
170: 
171:       <span class="ruby-comment cmt"># Only add this extension to the compile chain if current</span>
172:       <span class="ruby-comment cmt"># platform matches the indicated one.</span>
173:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">platf</span> <span class="ruby-operator">==</span> <span class="ruby-constant">RUBY_PLATFORM</span> <span class="ruby-keyword kw">then</span>
174:         <span class="ruby-comment cmt"># ensure file is always copied</span>
175:         <span class="ruby-identifier">file</span> <span class="ruby-node">&quot;#{lib_path}/#{binary(platf)}&quot;</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-node">&quot;copy:#{name}:#{platf}:#{ruby_ver}&quot;</span>]
176: 
177:         <span class="ruby-identifier">task</span> <span class="ruby-node">&quot;compile:#{@name}&quot;</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-node">&quot;compile:#{@name}:#{platf}&quot;</span>]
178:         <span class="ruby-identifier">task</span> <span class="ruby-value str">&quot;compile&quot;</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-node">&quot;compile:#{platf}&quot;</span>]
179:       <span class="ruby-keyword kw">end</span>
180:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000026">
                    
                    <a name="M000026"></a><b>define_cross_platform_tasks</b>(for_platform)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000026_source')" id="l_M000026_source">show</a>
                        
                    </p>
                    <div id="M000026_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rake/extensiontask.rb, line 252</span>
252:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">define_cross_platform_tasks</span>(<span class="ruby-identifier">for_platform</span>)
253:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ruby_vers</span> = <span class="ruby-constant">ENV</span>[<span class="ruby-value str">'RUBY_CC_VERSION'</span>]
254:         <span class="ruby-identifier">ruby_vers</span> = <span class="ruby-constant">ENV</span>[<span class="ruby-value str">'RUBY_CC_VERSION'</span>].<span class="ruby-identifier">split</span>(<span class="ruby-value str">':'</span>)
255:       <span class="ruby-keyword kw">else</span>
256:         <span class="ruby-identifier">ruby_vers</span> = [<span class="ruby-constant">RUBY_VERSION</span>]
257:       <span class="ruby-keyword kw">end</span>
258: 
259:       <span class="ruby-identifier">multi</span> = (<span class="ruby-identifier">ruby_vers</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>) <span class="ruby-operator">?</span> <span class="ruby-keyword kw">true</span> <span class="ruby-operator">:</span> <span class="ruby-keyword kw">false</span>
260: 
261:       <span class="ruby-identifier">ruby_vers</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">version</span><span class="ruby-operator">|</span>
262:         <span class="ruby-comment cmt"># save original lib_dir</span>
263:         <span class="ruby-identifier">orig_lib_dir</span> = <span class="ruby-ivar">@lib_dir</span>
264: 
265:         <span class="ruby-comment cmt"># tweak lib directory only when targeting multiple versions</span>
266:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">multi</span> <span class="ruby-keyword kw">then</span>
267:           <span class="ruby-identifier">version</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/(\d+.\d+)/</span>
268:           <span class="ruby-ivar">@lib_dir</span> = <span class="ruby-node">&quot;#{@lib_dir}/#{$1}&quot;</span>
269:         <span class="ruby-keyword kw">end</span>
270: 
271:         <span class="ruby-identifier">define_cross_platform_tasks_with_version</span>(<span class="ruby-identifier">for_platform</span>, <span class="ruby-identifier">version</span>)
272: 
273:         <span class="ruby-comment cmt"># restore lib_dir</span>
274:         <span class="ruby-ivar">@lib_dir</span> = <span class="ruby-identifier">orig_lib_dir</span>
275:       <span class="ruby-keyword kw">end</span>
276:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000027">
                    
                    <a name="M000027"></a><b>define_cross_platform_tasks_with_version</b>(for_platform, ruby_ver)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000027_source')" id="l_M000027_source">show</a>
                        
                    </p>
                    <div id="M000027_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rake/extensiontask.rb, line 278</span>
278:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">define_cross_platform_tasks_with_version</span>(<span class="ruby-identifier">for_platform</span>, <span class="ruby-identifier">ruby_ver</span>)
279:       <span class="ruby-identifier">config_path</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-value str">&quot;~/.rake-compiler/config.yml&quot;</span>)
280: 
281:       <span class="ruby-comment cmt"># warn the user about the need of configuration to use cross compilation.</span>
282:       <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">config_path</span>)
283:         <span class="ruby-identifier">define_dummy_cross_platform_tasks</span>
284:         <span class="ruby-keyword kw">return</span>
285:       <span class="ruby-keyword kw">end</span>
286: 
287:       <span class="ruby-identifier">config_file</span> = <span class="ruby-constant">YAML</span>.<span class="ruby-identifier">load_file</span>(<span class="ruby-identifier">config_path</span>)
288: 
289:       <span class="ruby-comment cmt"># tmp_path</span>
290:       <span class="ruby-identifier">tmp_path</span> = <span class="ruby-node">&quot;#{@tmp_dir}/#{for_platform}/#{@name}/#{ruby_ver}&quot;</span>
291: 
292:       <span class="ruby-comment cmt"># lib_path</span>
293:       <span class="ruby-identifier">lib_path</span> = <span class="ruby-identifier">lib_dir</span>
294: 
295:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">rbconfig_file</span> = <span class="ruby-identifier">config_file</span>[<span class="ruby-node">&quot;rbconfig-#{ruby_ver}&quot;</span>] <span class="ruby-keyword kw">then</span>
296:         <span class="ruby-identifier">warn</span> <span class="ruby-node">&quot;no configuration section for specified version of Ruby (rbconfig-#{ruby_ver})&quot;</span>
297:         <span class="ruby-keyword kw">return</span>
298:       <span class="ruby-keyword kw">end</span>
299: 
300:       <span class="ruby-comment cmt"># mkmf</span>
301:       <span class="ruby-identifier">mkmf_file</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-identifier">rbconfig_file</span>), <span class="ruby-value str">'..'</span>, <span class="ruby-value str">'mkmf.rb'</span>))
302: 
303:       <span class="ruby-comment cmt"># define compilation tasks for cross platform!</span>
304:       <span class="ruby-identifier">define_compile_tasks</span>(<span class="ruby-identifier">for_platform</span>, <span class="ruby-identifier">ruby_ver</span>)
305: 
306:       <span class="ruby-comment cmt"># chain fake.rb, rbconfig.rb and mkmf.rb to Makefile generation</span>
307:       <span class="ruby-identifier">file</span> <span class="ruby-node">&quot;#{tmp_path}/Makefile&quot;</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-node">&quot;#{tmp_path}/fake.rb&quot;</span>,
308:                                       <span class="ruby-node">&quot;#{tmp_path}/rbconfig.rb&quot;</span>,
309:                                       <span class="ruby-node">&quot;#{tmp_path}/mkmf.rb&quot;</span>]
310: 
311:       <span class="ruby-comment cmt"># copy the file from the cross-ruby location</span>
312:       <span class="ruby-identifier">file</span> <span class="ruby-node">&quot;#{tmp_path}/rbconfig.rb&quot;</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">rbconfig_file</span>] <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
313:         <span class="ruby-identifier">cp</span> <span class="ruby-identifier">t</span>.<span class="ruby-identifier">prerequisites</span>.<span class="ruby-identifier">first</span>, <span class="ruby-identifier">t</span>.<span class="ruby-identifier">name</span>
314:       <span class="ruby-keyword kw">end</span>
315: 
316:       <span class="ruby-comment cmt"># copy mkmf from cross-ruby location</span>
317:       <span class="ruby-identifier">file</span> <span class="ruby-node">&quot;#{tmp_path}/mkmf.rb&quot;</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">mkmf_file</span>] <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
318:         <span class="ruby-identifier">cp</span> <span class="ruby-identifier">t</span>.<span class="ruby-identifier">prerequisites</span>.<span class="ruby-identifier">first</span>, <span class="ruby-identifier">t</span>.<span class="ruby-identifier">name</span>
319:       <span class="ruby-keyword kw">end</span>
320: 
321:       <span class="ruby-comment cmt"># genearte fake.rb for different ruby versions</span>
322:       <span class="ruby-identifier">file</span> <span class="ruby-node">&quot;#{tmp_path}/fake.rb&quot;</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
323:         <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">t</span>.<span class="ruby-identifier">name</span>, <span class="ruby-value str">'w'</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span>
324:           <span class="ruby-identifier">f</span>.<span class="ruby-identifier">write</span> <span class="ruby-identifier">fake_rb</span>(<span class="ruby-identifier">for_platform</span>, <span class="ruby-identifier">ruby_ver</span>)
325:         <span class="ruby-keyword kw">end</span>
326:       <span class="ruby-keyword kw">end</span>
327: 
328:       <span class="ruby-comment cmt"># now define native tasks for cross compiled files</span>
329:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@gem_spec</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@gem_spec</span>.<span class="ruby-identifier">platform</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'ruby'</span> <span class="ruby-keyword kw">then</span>
330:         <span class="ruby-identifier">define_native_tasks</span>(<span class="ruby-identifier">for_platform</span>, <span class="ruby-identifier">ruby_ver</span>, <span class="ruby-ivar">@cross_compiling</span>)
331:       <span class="ruby-keyword kw">end</span>
332: 
333:       <span class="ruby-comment cmt"># create cross task</span>
334:       <span class="ruby-identifier">task</span> <span class="ruby-value str">'cross'</span> <span class="ruby-keyword kw">do</span>
335:         <span class="ruby-comment cmt"># clear compile dependencies</span>
336:         <span class="ruby-constant">Rake</span><span class="ruby-operator">::</span><span class="ruby-constant">Task</span>[<span class="ruby-value str">'compile'</span>].<span class="ruby-identifier">prerequisites</span>.<span class="ruby-identifier">reject!</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span> <span class="ruby-operator">!</span><span class="ruby-identifier">compiles_cross_platform</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">t</span>) }
337: 
338:         <span class="ruby-comment cmt"># chain the cross platform ones</span>
339:         <span class="ruby-identifier">task</span> <span class="ruby-value str">'compile'</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-node">&quot;compile:#{for_platform}&quot;</span>]
340: 
341:         <span class="ruby-comment cmt"># clear lib/binary dependencies and trigger cross platform ones</span>
342:         <span class="ruby-comment cmt"># check if lib/binary is defined (damn bundle versus so versus dll)</span>
343:         <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Rake</span><span class="ruby-operator">::</span><span class="ruby-constant">Task</span>.<span class="ruby-identifier">task_defined?</span>(<span class="ruby-node">&quot;#{lib_path}/#{binary(for_platform)}&quot;</span>) <span class="ruby-keyword kw">then</span>
344:           <span class="ruby-constant">Rake</span><span class="ruby-operator">::</span><span class="ruby-constant">Task</span>[<span class="ruby-node">&quot;#{lib_path}/#{binary(for_platform)}&quot;</span>].<span class="ruby-identifier">prerequisites</span>.<span class="ruby-identifier">clear</span>
345:         <span class="ruby-keyword kw">end</span>
346: 
347:         <span class="ruby-comment cmt"># FIXME: targeting multiple platforms copies the file twice</span>
348:         <span class="ruby-identifier">file</span> <span class="ruby-node">&quot;#{lib_path}/#{binary(for_platform)}&quot;</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-node">&quot;copy:#{@name}:#{for_platform}:#{ruby_ver}&quot;</span>]
349: 
350:         <span class="ruby-comment cmt"># if everything for native task is in place</span>
351:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@gem_spec</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@gem_spec</span>.<span class="ruby-identifier">platform</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'ruby'</span> <span class="ruby-keyword kw">then</span>
352:           <span class="ruby-comment cmt"># double check: only cross platform native tasks should be here</span>
353:           <span class="ruby-comment cmt"># FIXME: Sooo brittle</span>
354:           <span class="ruby-constant">Rake</span><span class="ruby-operator">::</span><span class="ruby-constant">Task</span>[<span class="ruby-value str">'native'</span>].<span class="ruby-identifier">prerequisites</span>.<span class="ruby-identifier">reject!</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span> <span class="ruby-operator">!</span><span class="ruby-identifier">natives_cross_platform</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">t</span>) }
355:           <span class="ruby-identifier">task</span> <span class="ruby-value str">'native'</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-node">&quot;native:#{for_platform}&quot;</span>]
356:         <span class="ruby-keyword kw">end</span>
357:       <span class="ruby-keyword kw">end</span>
358:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000028">
                    
                    <a name="M000028"></a><b>define_dummy_cross_platform_tasks</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000028_source')" id="l_M000028_source">show</a>
                        
                    </p>
                    <div id="M000028_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rake/extensiontask.rb, line 360</span>
360:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">define_dummy_cross_platform_tasks</span>
361:       <span class="ruby-identifier">task</span> <span class="ruby-value str">'cross'</span> <span class="ruby-keyword kw">do</span>
362:         <span class="ruby-constant">Rake</span><span class="ruby-operator">::</span><span class="ruby-constant">Task</span>[<span class="ruby-value str">'compile'</span>].<span class="ruby-identifier">clear</span>
363:         <span class="ruby-identifier">task</span> <span class="ruby-value str">'compile'</span> <span class="ruby-keyword kw">do</span>
364:           <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;rake-compiler must be configured first to enable cross-compilation&quot;</span>
365:         <span class="ruby-keyword kw">end</span>
366:       <span class="ruby-keyword kw">end</span>
367:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000024">
                    
                    <a name="M000024"></a><b>define_native_tasks</b>(for_platform = nil, ruby_ver = RUBY_VERSION, callback = nil)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000024_source')" id="l_M000024_source">show</a>
                        
                    </p>
                    <div id="M000024_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rake/extensiontask.rb, line 186</span>
186:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">define_native_tasks</span>(<span class="ruby-identifier">for_platform</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">ruby_ver</span> = <span class="ruby-constant">RUBY_VERSION</span>, <span class="ruby-identifier">callback</span> = <span class="ruby-keyword kw">nil</span>)
187:       <span class="ruby-identifier">platf</span> = <span class="ruby-identifier">for_platform</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">platform</span>
188: 
189:       <span class="ruby-comment cmt"># tmp_path</span>
190:       <span class="ruby-identifier">tmp_path</span> = <span class="ruby-node">&quot;#{@tmp_dir}/#{platf}/#{@name}/#{ruby_ver}&quot;</span>
191: 
192:       <span class="ruby-comment cmt"># lib_path</span>
193:       <span class="ruby-identifier">lib_path</span> = <span class="ruby-identifier">lib_dir</span>
194: 
195:       <span class="ruby-comment cmt"># create 'native:gem_name' and chain it to 'native' task</span>
196:       <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">Rake</span><span class="ruby-operator">::</span><span class="ruby-constant">Task</span>.<span class="ruby-identifier">task_defined?</span>(<span class="ruby-node">&quot;native:#{@gem_spec.name}:#{platf}&quot;</span>)
197:         <span class="ruby-identifier">task</span> <span class="ruby-node">&quot;native:#{@gem_spec.name}:#{platf}&quot;</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
198:           <span class="ruby-comment cmt"># FIXME: workaround Gem::Specification limitation around cache_file:</span>
199:           <span class="ruby-comment cmt"># http://github.com/rubygems/rubygems/issues/78</span>
200:           <span class="ruby-identifier">spec</span> = <span class="ruby-identifier">gem_spec</span>.<span class="ruby-identifier">dup</span>
201:           <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">instance_variable_set</span>(<span class="ruby-identifier">:&quot;@cache_file&quot;</span>, <span class="ruby-keyword kw">nil</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:cache_file</span>)
202: 
203:           <span class="ruby-comment cmt"># adjust to specified platform</span>
204:           <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">platform</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Platform</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">platf</span>)
205: 
206:           <span class="ruby-comment cmt"># clear the extensions defined in the specs</span>
207:           <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">extensions</span>.<span class="ruby-identifier">clear</span>
208: 
209:           <span class="ruby-comment cmt"># add the binaries that this task depends on</span>
210:           <span class="ruby-identifier">ext_files</span> = []
211: 
212:           <span class="ruby-comment cmt"># go through native prerequisites and grab the real extension files from there</span>
213:           <span class="ruby-identifier">t</span>.<span class="ruby-identifier">prerequisites</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">ext</span><span class="ruby-operator">|</span>
214:             <span class="ruby-identifier">ext_files</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">ext</span>
215:           <span class="ruby-keyword kw">end</span>
216: 
217:           <span class="ruby-comment cmt"># include the files in the gem specification</span>
218:           <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">files</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">ext_files</span>
219: 
220:           <span class="ruby-comment cmt"># expose gem specification for customization</span>
221:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">callback</span>
222:             <span class="ruby-identifier">callback</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">spec</span>)
223:           <span class="ruby-keyword kw">end</span>
224: 
225:           <span class="ruby-comment cmt"># Generate a package for this gem</span>
226:           <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">PackageTask</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">spec</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">pkg</span><span class="ruby-operator">|</span>
227:             <span class="ruby-identifier">pkg</span>.<span class="ruby-identifier">need_zip</span> = <span class="ruby-keyword kw">false</span>
228:             <span class="ruby-identifier">pkg</span>.<span class="ruby-identifier">need_tar</span> = <span class="ruby-keyword kw">false</span>
229:           <span class="ruby-keyword kw">end</span>
230:         <span class="ruby-keyword kw">end</span>
231:       <span class="ruby-keyword kw">end</span>
232: 
233:       <span class="ruby-comment cmt"># add binaries to the dependency chain</span>
234:       <span class="ruby-identifier">task</span> <span class="ruby-node">&quot;native:#{@gem_spec.name}:#{platf}&quot;</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-node">&quot;#{lib_path}/#{binary(platf)}&quot;</span>]
235: 
236:       <span class="ruby-comment cmt"># ensure the extension get copied</span>
237:       <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">Rake</span><span class="ruby-operator">::</span><span class="ruby-constant">Task</span>.<span class="ruby-identifier">task_defined?</span>(<span class="ruby-node">&quot;#{lib_path}/#{binary(platf)}&quot;</span>) <span class="ruby-keyword kw">then</span>
238:         <span class="ruby-identifier">file</span> <span class="ruby-node">&quot;#{lib_path}/#{binary(platf)}&quot;</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-node">&quot;copy:#{@name}:#{platf}:#{ruby_ver}&quot;</span>]
239:       <span class="ruby-keyword kw">end</span>
240: 
241:       <span class="ruby-comment cmt"># Allow segmented packaging by platform (open door for 'cross compile')</span>
242:       <span class="ruby-identifier">task</span> <span class="ruby-node">&quot;native:#{platf}&quot;</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-node">&quot;native:#{@gem_spec.name}:#{platf}&quot;</span>]
243: 
244:       <span class="ruby-comment cmt"># Only add this extension to the compile chain if current</span>
245:       <span class="ruby-comment cmt"># platform matches the indicated one.</span>
246:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">platf</span> <span class="ruby-operator">==</span> <span class="ruby-constant">RUBY_PLATFORM</span> <span class="ruby-keyword kw">then</span>
247:         <span class="ruby-identifier">task</span> <span class="ruby-node">&quot;native:#{@gem_spec.name}&quot;</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-node">&quot;native:#{@gem_spec.name}:#{platf}&quot;</span>]
248:         <span class="ruby-identifier">task</span> <span class="ruby-value str">&quot;native&quot;</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-node">&quot;native:#{platf}&quot;</span>]
249:       <span class="ruby-keyword kw">end</span>
250:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000031">
                    
                    <a name="M000031"></a><b>dev_null</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000031_source')" id="l_M000031_source">show</a>
                        
                    </p>
                    <div id="M000031_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rake/extensiontask.rb, line 387</span>
387:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">dev_null</span>
388:       <span class="ruby-identifier">windows?</span> <span class="ruby-value">? </span><span class="ruby-value str">'NUL'</span> <span class="ruby-operator">:</span> <span class="ruby-value str">'/dev/null'</span>
389:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000029">
                    
                    <a name="M000029"></a><b>extconf</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000029_source')" id="l_M000029_source">show</a>
                        
                    </p>
                    <div id="M000029_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rake/extensiontask.rb, line 369</span>
369:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">extconf</span>
370:       <span class="ruby-node">&quot;#{@ext_dir}/#{@config_script}&quot;</span>
371:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000035">
                    
                    <a name="M000035"></a><b>fake_rb</b>(platform, version)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000035_source')" id="l_M000035_source">show</a>
                        
                    </p>
                    <div id="M000035_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rake/extensiontask.rb, line 403</span>
403:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">fake_rb</span>(<span class="ruby-identifier">platform</span>, <span class="ruby-identifier">version</span>)
404:       <span class="ruby-value str">&quot;class Object\nremove_const :RUBY_PLATFORM\nremove_const :RUBY_VERSION\nremove_const :RUBY_DESCRIPTION if defined?(RUBY_DESCRIPTION)\nRUBY_PLATFORM = \&quot;\#{platform}\&quot;\nRUBY_VERSION = \&quot;\#{version}\&quot;\nRUBY_DESCRIPTION = \&quot;ruby \\\#{RUBY_VERSION} (\\\#{RUBY_RELEASE_DATE}) [\\\#{RUBY_PLATFORM}]\&quot;\nend\nif RUBY_PLATFORM =~ /mswin|bccwin|mingw/\nclass File\nremove_const :ALT_SEPARATOR\nALT_SEPARATOR = \&quot;\\\\\\\\\&quot;\nend\nend\n\nposthook = proc do\n$ruby = \&quot;\#{Gem.ruby}\&quot;\nuntrace_var(:$ruby, posthook)\nend\ntrace_var(:$ruby, posthook)\n&quot;</span>
405:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000030">
                    
                    <a name="M000030"></a><b>make</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000030_source')" id="l_M000030_source">show</a>
                        
                    </p>
                    <div id="M000030_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rake/extensiontask.rb, line 373</span>
373:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">make</span>
374:       <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@make</span>
375:         <span class="ruby-ivar">@make</span> =
376:           <span class="ruby-keyword kw">if</span> <span class="ruby-constant">RUBY_PLATFORM</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/mswin/</span> <span class="ruby-keyword kw">then</span>
377:             <span class="ruby-value str">'nmake'</span>
378:           <span class="ruby-keyword kw">else</span>
379:             <span class="ruby-constant">ENV</span>[<span class="ruby-value str">'MAKE'</span>] <span class="ruby-operator">||</span> <span class="ruby-node">%w[gmake make]</span>.<span class="ruby-identifier">find</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span>
380:               <span class="ruby-identifier">system</span>(<span class="ruby-node">&quot;#{c} -v &gt;&gt; #{dev_null} 2&gt;&amp;1&quot;</span>)
381:             }
382:           <span class="ruby-keyword kw">end</span>
383:       <span class="ruby-keyword kw">end</span>
384:       <span class="ruby-ivar">@make</span>
385:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000034">
                    
                    <a name="M000034"></a><b>natives_cross_platform</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000034_source')" id="l_M000034_source">show</a>
                        
                    </p>
                    <div id="M000034_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rake/extensiontask.rb, line 399</span>
399:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">natives_cross_platform</span>
400:       [<span class="ruby-operator">*</span><span class="ruby-ivar">@cross_platform</span>].<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span> <span class="ruby-node">&quot;native:#{p}&quot;</span> }
401:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    