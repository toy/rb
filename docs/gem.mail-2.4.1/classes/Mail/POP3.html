<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>Mail::POP3</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../css/main.css" type="text/css" media="screen" />
    <script src="../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Class</span> 
            Mail::POP3 
            
                <span class="parent">&lt; 
                    
                    Retriever
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../files/lib/mail/network/retriever_methods/pop3_rb.html">lib/mail/network/retriever_methods/pop3.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    
    <div class="description">
        <p>
The Pop3 retriever allows to get the last, first or all emails from a <a
href="POP3.html">POP3</a> server. Each email retrieved (<a
href="RFC2822.html">RFC2822</a>) is given as an instance of
<tt>Message</tt>.
</p>
<p>
While being retrieved, emails can be yielded if a block is given.
</p>
<h3>Example of retrieving Emails from GMail:</h3>
<pre>
  Mail.defaults do
    retriever_method :pop3, { :address             =&gt; &quot;pop.gmail.com&quot;,
                              :port                =&gt; 995,
                              :user_name           =&gt; '&lt;username&gt;',
                              :password            =&gt; '&lt;password&gt;',
                              :enable_ssl          =&gt; true }
  end

  Mail.all    #=&gt; Returns an array of all emails
  Mail.first  #=&gt; Returns the first unread email
  Mail.last   #=&gt; Returns the first unread email
</pre>
<p>
You can also pass options into Mail.find to locate an email in your pop
mailbox with the following options:
</p>
<pre>
  what:  last or first emails. The default is :first.
  order: order of emails returned. Possible values are :asc or :desc. Default value is :asc.
  count: number of emails to retrieve. The default value is 10. A value of 1 returns an
         instance of Message, not an array of Message instances.

  Mail.find(:what =&gt; :first, :count =&gt; 10, :order =&gt; :asc)
  #=&gt; Returns the first 10 emails in ascending order
</pre>

    </div>
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>C</dt>
        <dd>
            <ul>
                
                <li><a href="#M000690">connection</a></li>
                
            </ul>
        </dd>
    
        <dt>D</dt>
        <dd>
            <ul>
                
                <li><a href="#M000688">delete_all</a></li>
                
            </ul>
        </dd>
    
        <dt>F</dt>
        <dd>
            <ul>
                
                <li><a href="#M000684">find</a></li>
                
            </ul>
        </dd>
    
        <dt>N</dt>
        <dd>
            <ul>
                
                <li><a href="#M000683">new</a></li>
                
            </ul>
        </dd>
    
        <dt>S</dt>
        <dd>
            <ul>
                
                <li><a href="#M000692">start</a></li>
                
            </ul>
        </dd>
    
        <dt>V</dt>
        <dd>
            <ul>
                
                <li><a href="#M000691">validate_options</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    

    

    

    

    
    <div class="sectiontitle">Attributes</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>settings</td>
            <td class='attr-desc'></td>
        </tr>
        
    </table>
    

    
            <div class="sectiontitle">Class Public methods</div>
            
            <div class="method">
                <div class="title" id="M000683">
                    
                    <a name="M000683"></a><b>new</b>(values)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000683_source')" id="l_M000683_source">show</a>
                        
                    </p>
                    <div id="M000683_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/mail/network/retriever_methods/pop3.rb, line 37</span>
37:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">values</span>)
38:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">settings</span> = { <span class="ruby-identifier">:address</span>              =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;localhost&quot;</span>,
39:                         <span class="ruby-identifier">:port</span>                 =<span class="ruby-operator">&gt;</span> <span class="ruby-value">110</span>,
40:                         <span class="ruby-identifier">:user_name</span>            =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">nil</span>,
41:                         <span class="ruby-identifier">:password</span>             =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">nil</span>,
42:                         <span class="ruby-identifier">:authentication</span>       =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">nil</span>,
43:                         <span class="ruby-identifier">:enable_ssl</span>           =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span> }.<span class="ruby-identifier">merge!</span>(<span class="ruby-identifier">values</span>)
44:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M000690">
                    
                    <a name="M000690"></a><b>connection</b>(&amp;block)
                    
                </div>
                
                <div class="description">
                  <p>
Returns the connection object of the retrievable (<a
href="IMAP.html">IMAP</a> or <a href="POP3.html">POP3</a>)
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000690_source')" id="l_M000690_source">show</a>
                        
                    </p>
                    <div id="M000690_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/mail/network/retriever_methods/pop3.rb, line 102</span>
102:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">connection</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
103:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">'Mail::Retrievable#connection takes a block'</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">block_given?</span>
104: 
105:       <span class="ruby-identifier">start</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">pop3</span><span class="ruby-operator">|</span>
106:         <span class="ruby-keyword kw">yield</span> <span class="ruby-identifier">pop3</span>
107:       <span class="ruby-keyword kw">end</span>
108:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000688">
                    
                    <a name="M000688"></a><b>delete_all</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Delete all emails from a <a href="POP3.html">POP3</a> server
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000688_source')" id="l_M000688_source">show</a>
                        
                    </p>
                    <div id="M000688_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/mail/network/retriever_methods/pop3.rb, line 92</span>
92:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">delete_all</span>
93:       <span class="ruby-identifier">start</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">pop3</span><span class="ruby-operator">|</span>
94:         <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">pop3</span>.<span class="ruby-identifier">mails</span>.<span class="ruby-identifier">empty?</span>
95:           <span class="ruby-identifier">pop3</span>.<span class="ruby-identifier">delete_all</span>
96:           <span class="ruby-identifier">pop3</span>.<span class="ruby-identifier">finish</span>
97:         <span class="ruby-keyword kw">end</span>
98:       <span class="ruby-keyword kw">end</span>
99:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000684">
                    
                    <a name="M000684"></a><b>find</b>(options = {}, &amp;block)
                    
                </div>
                
                <div class="description">
                  <p>
Find emails in a <a href="POP3.html">POP3</a> mailbox. Without any options,
the 5 last received emails are returned.
</p>
<p>
Possible options:
</p>
<pre>
  what:  last or first emails. The default is :first.
  order: order of emails returned. Possible values are :asc or :desc. Default value is :asc.
  count: number of emails to retrieve. The default value is 10. A value of 1 returns an
         instance of Message, not an array of Message instances.
  delete_after_find: flag for whether to delete each retreived email after find. Default
          is false. Use #find_and_delete if you would like this to default to true.
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000684_source')" id="l_M000684_source">show</a>
                        
                    </p>
                    <div id="M000684_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/mail/network/retriever_methods/pop3.rb, line 58</span>
58:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">find</span>(<span class="ruby-identifier">options</span> = {}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
59:       <span class="ruby-identifier">options</span> = <span class="ruby-identifier">validate_options</span>(<span class="ruby-identifier">options</span>)
60:       
61:       <span class="ruby-identifier">start</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">pop3</span><span class="ruby-operator">|</span>
62:         <span class="ruby-identifier">mails</span> = <span class="ruby-identifier">pop3</span>.<span class="ruby-identifier">mails</span>
63:         <span class="ruby-identifier">pop3</span>.<span class="ruby-identifier">reset</span> <span class="ruby-comment cmt"># Clears all &quot;deleted&quot; marks. This prevents non-explicit/accidental deletions due to server settings.</span>
64:         <span class="ruby-identifier">mails</span>.<span class="ruby-identifier">sort!</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">m1</span>, <span class="ruby-identifier">m2</span><span class="ruby-operator">|</span> <span class="ruby-identifier">m2</span>.<span class="ruby-identifier">number</span> <span class="ruby-operator">&lt;=&gt;</span> <span class="ruby-identifier">m1</span>.<span class="ruby-identifier">number</span> } <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:what</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">:last</span>
65:         <span class="ruby-identifier">mails</span> = <span class="ruby-identifier">mails</span>.<span class="ruby-identifier">first</span>(<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:count</span>]) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:count</span>].<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">Integer</span>
66:         
67:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:what</span>].<span class="ruby-identifier">to_sym</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:last</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:order</span>].<span class="ruby-identifier">to_sym</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:desc</span> <span class="ruby-operator">||</span>
68:            <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:what</span>].<span class="ruby-identifier">to_sym</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:first</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:order</span>].<span class="ruby-identifier">to_sym</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:asc</span> <span class="ruby-operator">||</span>
69:           <span class="ruby-identifier">mails</span>.<span class="ruby-identifier">reverse!</span>
70:         <span class="ruby-keyword kw">end</span>
71:         
72:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block_given?</span>
73:           <span class="ruby-identifier">mails</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">mail</span><span class="ruby-operator">|</span>
74:             <span class="ruby-identifier">new_message</span> = <span class="ruby-constant">Mail</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">mail</span>.<span class="ruby-identifier">pop</span>)
75:             <span class="ruby-identifier">new_message</span>.<span class="ruby-identifier">mark_for_delete</span> = <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:delete_after_find</span>]
76:             <span class="ruby-keyword kw">yield</span> <span class="ruby-identifier">new_message</span>
77:             <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">delete</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:delete_after_find</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">new_message</span>.<span class="ruby-identifier">is_marked_for_delete?</span> <span class="ruby-comment cmt"># Delete if still marked for delete</span>
78:           <span class="ruby-keyword kw">end</span>
79:         <span class="ruby-keyword kw">else</span>
80:           <span class="ruby-identifier">emails</span> = []
81:           <span class="ruby-identifier">mails</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">mail</span><span class="ruby-operator">|</span>
82:             <span class="ruby-identifier">emails</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Mail</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">mail</span>.<span class="ruby-identifier">pop</span>)
83:             <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">delete</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:delete_after_find</span>]
84:           <span class="ruby-keyword kw">end</span>
85:           <span class="ruby-identifier">emails</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:count</span>] <span class="ruby-operator">==</span> <span class="ruby-value">1</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">emails</span>.<span class="ruby-identifier">first</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">emails</span>
86:         <span class="ruby-keyword kw">end</span>
87:         
88:       <span class="ruby-keyword kw">end</span>
89:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Private methods</div>
            
            <div class="method">
                <div class="title" id="M000692">
                    
                    <a name="M000692"></a><b>start</b>(config = Configuration.instance, &amp;block)
                    
                </div>
                
                <div class="description">
                  <p>
Start a <a href="POP3.html">POP3</a> session and ensure that it will be
closed in any case. Any messages marked for deletion via find_and_delete or
with the :delete_after_find option will be deleted when the session is
closed.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000692_source')" id="l_M000692_source">show</a>
                        
                    </p>
                    <div id="M000692_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/mail/network/retriever_methods/pop3.rb, line 125</span>
125:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">start</span>(<span class="ruby-identifier">config</span> = <span class="ruby-constant">Configuration</span>.<span class="ruby-identifier">instance</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
126:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;Mail::Retrievable#pop3_start takes a block&quot;</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">block_given?</span>
127:     
128:       <span class="ruby-identifier">pop3</span> = <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">POP3</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">settings</span>[<span class="ruby-identifier">:address</span>], <span class="ruby-identifier">settings</span>[<span class="ruby-identifier">:port</span>], <span class="ruby-keyword kw">false</span>)
129:       <span class="ruby-identifier">pop3</span>.<span class="ruby-identifier">enable_ssl</span>(<span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">SSL</span><span class="ruby-operator">::</span><span class="ruby-constant">VERIFY_NONE</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">settings</span>[<span class="ruby-identifier">:enable_ssl</span>]
130:       <span class="ruby-identifier">pop3</span>.<span class="ruby-identifier">start</span>(<span class="ruby-identifier">settings</span>[<span class="ruby-identifier">:user_name</span>], <span class="ruby-identifier">settings</span>[<span class="ruby-identifier">:password</span>])
131:     
132:       <span class="ruby-keyword kw">yield</span> <span class="ruby-identifier">pop3</span>
133:     <span class="ruby-keyword kw">ensure</span>
134:       <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">defined?</span>(<span class="ruby-identifier">pop3</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">pop3</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">pop3</span>.<span class="ruby-identifier">started?</span>
135:         <span class="ruby-identifier">pop3</span>.<span class="ruby-identifier">finish</span>
136:       <span class="ruby-keyword kw">end</span>
137:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000691">
                    
                    <a name="M000691"></a><b>validate_options</b>(options)
                    
                </div>
                
                <div class="description">
                  <p>
Set default options
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000691_source')" id="l_M000691_source">show</a>
                        
                    </p>
                    <div id="M000691_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/mail/network/retriever_methods/pop3.rb, line 113</span>
113:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">validate_options</span>(<span class="ruby-identifier">options</span>)
114:       <span class="ruby-identifier">options</span> <span class="ruby-operator">||=</span> {}
115:       <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:count</span>] <span class="ruby-operator">||=</span> <span class="ruby-value">10</span>
116:       <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:order</span>] <span class="ruby-operator">||=</span> <span class="ruby-identifier">:asc</span>
117:       <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:what</span>]  <span class="ruby-operator">||=</span> <span class="ruby-identifier">:first</span>
118:       <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:delete_after_find</span>] <span class="ruby-operator">||=</span> <span class="ruby-keyword kw">false</span>
119:       <span class="ruby-identifier">options</span>
120:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    