<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>Mail::Encodings</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../css/main.css" type="text/css" media="screen" />
    <script src="../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Module</span> 
            Mail::Encodings 
            
        </h1>
        <ul class="files">
            
            <li><a href="../../files/lib/mail/encodings/7bit_rb.html">lib/mail/encodings/7bit.rb</a></li>
            
            <li><a href="../../files/lib/mail/encodings/8bit_rb.html">lib/mail/encodings/8bit.rb</a></li>
            
            <li><a href="../../files/lib/mail/encodings/base64_rb.html">lib/mail/encodings/base64.rb</a></li>
            
            <li><a href="../../files/lib/mail/encodings/binary_rb.html">lib/mail/encodings/binary.rb</a></li>
            
            <li><a href="../../files/lib/mail/encodings/transfer_encoding_rb.html">lib/mail/encodings/transfer_encoding.rb</a></li>
            
            <li><a href="../../files/lib/mail/encodings/quoted_printable_rb.html">lib/mail/encodings/quoted_printable.rb</a></li>
            
            <li><a href="../../files/lib/mail/encodings_rb.html">lib/mail/encodings.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>A</dt>
        <dd>
            <ul>
                
                <li><a href="#M000149">address_encode</a></li>
                
            </ul>
        </dd>
    
        <dt>B</dt>
        <dd>
            <ul>
                
                <li><a href="#M000167">b_value_decode</a>,</li>
                
                <li><a href="#M000159">b_value_encode</a></li>
                
            </ul>
        </dd>
    
        <dt>D</dt>
        <dd>
            <ul>
                
                <li><a href="#M000146">decode_encode</a>,</li>
                
                <li><a href="#M000138">defined?</a></li>
                
            </ul>
        </dd>
    
        <dt>E</dt>
        <dd>
            <ul>
                
                <li><a href="#M000151">encode_non_usascii</a></li>
                
            </ul>
        </dd>
    
        <dt>F</dt>
        <dd>
            <ul>
                
                <li><a href="#M000171">find_encoding</a></li>
                
            </ul>
        </dd>
    
        <dt>G</dt>
        <dd>
            <ul>
                
                <li><a href="#M000142">get_all</a>,</li>
                
                <li><a href="#M000139">get_encoding</a>,</li>
                
                <li><a href="#M000143">get_name</a></li>
                
            </ul>
        </dd>
    
        <dt>P</dt>
        <dd>
            <ul>
                
                <li><a href="#M000145">param_decode</a>,</li>
                
                <li><a href="#M000144">param_encode</a></li>
                
            </ul>
        </dd>
    
        <dt>Q</dt>
        <dd>
            <ul>
                
                <li><a href="#M000168">q_value_decode</a>,</li>
                
                <li><a href="#M000164">q_value_encode</a></li>
                
            </ul>
        </dd>
    
        <dt>R</dt>
        <dd>
            <ul>
                
                <li><a href="#M000137">register</a></li>
                
            </ul>
        </dd>
    
        <dt>S</dt>
        <dd>
            <ul>
                
                <li><a href="#M000170">split_encoding_from_string</a></li>
                
            </ul>
        </dd>
    
        <dt>U</dt>
        <dd>
            <ul>
                
                <li><a href="#M000148">unquote_and_convert_to</a></li>
                
            </ul>
        </dd>
    
        <dt>V</dt>
        <dd>
            <ul>
                
                <li><a href="#M000147">value_decode</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    
    <div class="sectiontitle">Included Modules</div>
    <ul>
        
        <li>
            
            <a href="RFC2822/Hour0.html">Mail::RFC2822::Hour0</a>
            
            START:includes
        </li>
        
    </ul>
    

    

    
    <div class="sectiontitle">Classes and Modules</div>
    <ul>
        
        <li><span class="type">CLASS</span> <a href="Encodings/Base64.html">Mail::Encodings::Base64</a></li>
        
        <li><span class="type">CLASS</span> <a href="Encodings/Binary.html">Mail::Encodings::Binary</a></li>
        
        <li><span class="type">CLASS</span> <a href="Encodings/EightBit.html">Mail::Encodings::EightBit</a></li>
        
        <li><span class="type">CLASS</span> <a href="Encodings/QuotedPrintable.html">Mail::Encodings::QuotedPrintable</a></li>
        
        <li><span class="type">CLASS</span> <a href="Encodings/SevenBit.html">Mail::Encodings::SevenBit</a></li>
        
        <li><span class="type">CLASS</span> <a href="Encodings/TransferEncoding.html">Mail::Encodings::TransferEncoding</a></li>
        
    </ul>
    

    

    

    
            <div class="sectiontitle">Class Public methods</div>
            
            <div class="method">
                <div class="title" id="M000149">
                    
                    <a name="M000149"></a><b>address_encode</b>(address, charset = 'utf-8')
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000149_source')" id="l_M000149_source">show</a>
                        
                    </p>
                    <div id="M000149_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/mail/encodings.rb, line 178</span>
178:     <span class="ruby-keyword kw">def</span> <span class="ruby-constant">Encodings</span>.<span class="ruby-identifier">address_encode</span>(<span class="ruby-identifier">address</span>, <span class="ruby-identifier">charset</span> = <span class="ruby-value str">'utf-8'</span>)
179:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">address</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>)
180:         <span class="ruby-comment cmt"># loop back through for each element</span>
181:         <span class="ruby-identifier">address</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span> <span class="ruby-constant">Encodings</span>.<span class="ruby-identifier">address_encode</span>(<span class="ruby-identifier">a</span>, <span class="ruby-identifier">charset</span>) }.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;, &quot;</span>)
182:       <span class="ruby-keyword kw">else</span>
183:         <span class="ruby-comment cmt"># find any word boundary that is not ascii and encode it</span>
184:         <span class="ruby-identifier">encode_non_usascii</span>(<span class="ruby-identifier">address</span>, <span class="ruby-identifier">charset</span>)
185:       <span class="ruby-keyword kw">end</span>
186:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000159">
                    
                    <a name="M000159"></a><b>b_value_encode</b>(encoded_str, encoding = nil)
                    
                </div>
                
                <div class="description">
                  <p>
Encode a string with <a href="Encodings/Base64.html">Base64</a> Encoding
and returns it ready to be inserted as a value for a field, that is, in the
=?<charset>?B?<string>?= format
</p>
<p>
Example:
</p>
<pre>
 Encodings.b_value_encode('This is „ÅÇ string', 'UTF-8')
 #=&gt; &quot;=?UTF-8?B?VGhpcyBpcyDjgYIgc3RyaW5n?=&quot;
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000159_source')" id="l_M000159_source">show</a>
                        
                    </p>
                    <div id="M000159_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/mail/encodings.rb, line 215</span>
215:     <span class="ruby-keyword kw">def</span> <span class="ruby-constant">Encodings</span>.<span class="ruby-identifier">b_value_encode</span>(<span class="ruby-identifier">encoded_str</span>, <span class="ruby-identifier">encoding</span> = <span class="ruby-keyword kw">nil</span>)
216:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">encoded_str</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">encoded_str</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">ascii_only?</span>
217:       <span class="ruby-identifier">string</span>, <span class="ruby-identifier">encoding</span> = <span class="ruby-constant">RubyVer</span>.<span class="ruby-identifier">b_value_encode</span>(<span class="ruby-identifier">encoded_str</span>, <span class="ruby-identifier">encoding</span>)
218:       <span class="ruby-identifier">map_lines</span>(<span class="ruby-identifier">string</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">str</span><span class="ruby-operator">|</span>
219:         <span class="ruby-node">&quot;=?#{encoding}?B?#{str.chomp}?=&quot;</span>
220:       <span class="ruby-keyword kw">end</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot; &quot;</span>)
221:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000146">
                    
                    <a name="M000146"></a><b>decode_encode</b>(str, output_type)
                    
                </div>
                
                <div class="description">
                  <p>
Decodes or encodes a string as needed for either <a
href="Encodings/Base64.html">Base64</a> or QP encoding types in the
=?<encoding>?[QB]?<string>?=&#8221; format.
</p>
<p>
The output type needs to be :decode to decode the input string or :encode
to encode the input string. The character set used for encoding will either
be the value of $KCODE for Ruby < 1.9 or the encoding on the string passed
in.
</p>
<p>
On encoding, will only send out <a href="Encodings/Base64.html">Base64</a>
encoded strings.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000146_source')" id="l_M000146_source">show</a>
                        
                    </p>
                    <div id="M000146_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/mail/encodings.rb, line 98</span>
 98:     <span class="ruby-keyword kw">def</span> <span class="ruby-constant">Encodings</span>.<span class="ruby-identifier">decode_encode</span>(<span class="ruby-identifier">str</span>, <span class="ruby-identifier">output_type</span>)
 99:       <span class="ruby-keyword kw">case</span>
100:       <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">output_type</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:decode</span>
101:         <span class="ruby-constant">Encodings</span>.<span class="ruby-identifier">value_decode</span>(<span class="ruby-identifier">str</span>)
102:       <span class="ruby-keyword kw">else</span>
103:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">str</span>.<span class="ruby-identifier">ascii_only?</span>
104:           <span class="ruby-identifier">str</span>
105:         <span class="ruby-keyword kw">else</span>
106:           <span class="ruby-constant">Encodings</span>.<span class="ruby-identifier">b_value_encode</span>(<span class="ruby-identifier">str</span>, <span class="ruby-identifier">find_encoding</span>(<span class="ruby-identifier">str</span>))
107:         <span class="ruby-keyword kw">end</span>
108:       <span class="ruby-keyword kw">end</span>
109:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000138">
                    
                    <a name="M000138"></a><b>defined?</b>( str )
                    
                </div>
                
                <div class="description">
                  <p>
Is the encoding we want defined?
</p>
<p>
Example:
</p>
<pre>
 Encodings.defined?(:base64) #=&gt; true
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000138_source')" id="l_M000138_source">show</a>
                        
                    </p>
                    <div id="M000138_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/mail/encodings.rb, line 29</span>
29:     <span class="ruby-keyword kw">def</span> <span class="ruby-constant">Encodings</span>.<span class="ruby-keyword kw">defined?</span>( <span class="ruby-identifier">str</span> )
30:       <span class="ruby-ivar">@transfer_encodings</span>.<span class="ruby-identifier">include?</span> <span class="ruby-identifier">get_name</span>(<span class="ruby-identifier">str</span>)
31:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000151">
                    
                    <a name="M000151"></a><b>encode_non_usascii</b>(address, charset)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000151_source')" id="l_M000151_source">show</a>
                        
                    </p>
                    <div id="M000151_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/mail/encodings.rb, line 188</span>
188:     <span class="ruby-keyword kw">def</span> <span class="ruby-constant">Encodings</span>.<span class="ruby-identifier">encode_non_usascii</span>(<span class="ruby-identifier">address</span>, <span class="ruby-identifier">charset</span>)
189:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">address</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">address</span>.<span class="ruby-identifier">ascii_only?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">charset</span>.<span class="ruby-identifier">nil?</span>
190:       <span class="ruby-identifier">us_ascii</span> = <span class="ruby-value str">%Q{\x00-\x7f}</span>
191:       <span class="ruby-comment cmt"># Encode any non usascii strings embedded inside of quotes</span>
192:       <span class="ruby-identifier">address</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-node">/(&quot;.*?[^#{us_ascii}].*?&quot;)/</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span> <span class="ruby-constant">Encodings</span>.<span class="ruby-identifier">b_value_encode</span>(<span class="ruby-identifier">unquote</span>(<span class="ruby-identifier">s</span>), <span class="ruby-identifier">charset</span>) }
193:       <span class="ruby-comment cmt"># Then loop through all remaining items and encode as needed</span>
194:       <span class="ruby-identifier">tokens</span> = <span class="ruby-identifier">address</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp re">/\s/</span>)
195:       <span class="ruby-identifier">map_with_index</span>(<span class="ruby-identifier">tokens</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">word</span>, <span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
196:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">word</span>.<span class="ruby-identifier">ascii_only?</span>
197:           <span class="ruby-identifier">word</span>
198:         <span class="ruby-keyword kw">else</span>
199:           <span class="ruby-identifier">previous_non_ascii</span> = <span class="ruby-identifier">tokens</span>[<span class="ruby-identifier">i</span><span class="ruby-operator">-</span><span class="ruby-value">1</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">tokens</span>[<span class="ruby-identifier">i</span><span class="ruby-operator">-</span><span class="ruby-value">1</span>].<span class="ruby-identifier">ascii_only?</span>
200:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">previous_non_ascii</span>
201:             <span class="ruby-identifier">word</span> = <span class="ruby-node">&quot; #{word}&quot;</span>
202:           <span class="ruby-keyword kw">end</span>
203:           <span class="ruby-constant">Encodings</span>.<span class="ruby-identifier">b_value_encode</span>(<span class="ruby-identifier">word</span>, <span class="ruby-identifier">charset</span>)
204:         <span class="ruby-keyword kw">end</span>
205:       <span class="ruby-keyword kw">end</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">' '</span>)
206:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000142">
                    
                    <a name="M000142"></a><b>get_all</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000142_source')" id="l_M000142_source">show</a>
                        
                    </p>
                    <div id="M000142_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/mail/encodings.rb, line 45</span>
45:     <span class="ruby-keyword kw">def</span> <span class="ruby-constant">Encodings</span>.<span class="ruby-identifier">get_all</span>
46:       <span class="ruby-ivar">@transfer_encodings</span>.<span class="ruby-identifier">values</span>
47:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000139">
                    
                    <a name="M000139"></a><b>get_encoding</b>( str )
                    
                </div>
                
                <div class="description">
                  <p>
Gets a defined encoding type, <a
href="Encodings/QuotedPrintable.html">QuotedPrintable</a> or <a
href="Encodings/Base64.html">Base64</a> for now.
</p>
<p>
Each encoding needs to be defined as a Mail::Encodings::ClassName for this
to work, allows us to add other encodings in the future.
</p>
<p>
Example:
</p>
<pre>
 Encodings.get_encoding(:base64) #=&gt; Mail::Encodings::Base64
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000139_source')" id="l_M000139_source">show</a>
                        
                    </p>
                    <div id="M000139_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/mail/encodings.rb, line 41</span>
41:     <span class="ruby-keyword kw">def</span> <span class="ruby-constant">Encodings</span>.<span class="ruby-identifier">get_encoding</span>( <span class="ruby-identifier">str</span> )
42:       <span class="ruby-ivar">@transfer_encodings</span>[<span class="ruby-identifier">get_name</span>(<span class="ruby-identifier">str</span>)]
43:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000143">
                    
                    <a name="M000143"></a><b>get_name</b>(enc)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000143_source')" id="l_M000143_source">show</a>
                        
                    </p>
                    <div id="M000143_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/mail/encodings.rb, line 49</span>
49:     <span class="ruby-keyword kw">def</span> <span class="ruby-constant">Encodings</span>.<span class="ruby-identifier">get_name</span>(<span class="ruby-identifier">enc</span>)
50:       <span class="ruby-identifier">enc</span> = <span class="ruby-identifier">enc</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-value str">&quot;-&quot;</span>, <span class="ruby-value str">&quot;_&quot;</span>).<span class="ruby-identifier">downcase</span>
51:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000145">
                    
                    <a name="M000145"></a><b>param_decode</b>(str, encoding)
                    
                </div>
                
                <div class="description">
                  <p>
Decodes a parameter value using URI Escaping.
</p>
<p>
Example:
</p>
<pre>
 Mail::Encodings.param_decode(&quot;This%20is%20fun&quot;, 'us-ascii') #=&gt; &quot;This is fun&quot;

 str = Mail::Encodings.param_decode(&quot;This%20is%20fun&quot;, 'iso-8559-1')
 str.encoding #=&gt; 'ISO-8859-1'      ## Only on Ruby 1.9
 str #=&gt; &quot;This is fun&quot;
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000145_source')" id="l_M000145_source">show</a>
                        
                    </p>
                    <div id="M000145_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/mail/encodings.rb, line 86</span>
86:     <span class="ruby-keyword kw">def</span> <span class="ruby-constant">Encodings</span>.<span class="ruby-identifier">param_decode</span>(<span class="ruby-identifier">str</span>, <span class="ruby-identifier">encoding</span>)
87:       <span class="ruby-constant">RubyVer</span>.<span class="ruby-identifier">param_decode</span>(<span class="ruby-identifier">str</span>, <span class="ruby-identifier">encoding</span>)
88:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000144">
                    
                    <a name="M000144"></a><b>param_encode</b>(str)
                    
                </div>
                
                <div class="description">
                  <p>
Encodes a parameter value using URI Escaping, note the language field
&#8216;en&#8217; can be set using <a
href="Configuration.html">Mail::Configuration</a>, like so:
</p>
<pre>
 Mail.defaults.do
   param_encode_language 'jp'
 end
</pre>
<p>
The character set used for encoding will either be the value of $KCODE for
Ruby < 1.9 or the encoding on the string passed in.
</p>
<p>
Example:
</p>
<pre>
 Mail::Encodings.param_encode(&quot;This is fun&quot;) #=&gt; &quot;us-ascii'en'This%20is%20fun&quot;
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000144_source')" id="l_M000144_source">show</a>
                        
                    </p>
                    <div id="M000144_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/mail/encodings.rb, line 66</span>
66:     <span class="ruby-keyword kw">def</span> <span class="ruby-constant">Encodings</span>.<span class="ruby-identifier">param_encode</span>(<span class="ruby-identifier">str</span>)
67:       <span class="ruby-keyword kw">case</span>
68:       <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">str</span>.<span class="ruby-identifier">ascii_only?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">str</span> <span class="ruby-operator">=~</span> <span class="ruby-constant">TOKEN_UNSAFE</span>
69:         <span class="ruby-node">%Q{&quot;#{str}&quot;}</span>
70:       <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">str</span>.<span class="ruby-identifier">ascii_only?</span>
71:         <span class="ruby-identifier">str</span>
72:       <span class="ruby-keyword kw">else</span>
73:         <span class="ruby-constant">RubyVer</span>.<span class="ruby-identifier">param_encode</span>(<span class="ruby-identifier">str</span>)
74:       <span class="ruby-keyword kw">end</span>
75:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000164">
                    
                    <a name="M000164"></a><b>q_value_encode</b>(encoded_str, encoding = nil)
                    
                </div>
                
                <div class="description">
                  <p>
Encode a string with Quoted-Printable Encoding and returns it ready to be
inserted as a value for a field, that is, in the =?<charset>?Q?<string>?=
format
</p>
<p>
Example:
</p>
<pre>
 Encodings.q_value_encode('This is „ÅÇ string', 'UTF-8')
 #=&gt; &quot;=?UTF-8?Q?This_is_=E3=81=82_string?=&quot;
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000164_source')" id="l_M000164_source">show</a>
                        
                    </p>
                    <div id="M000164_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/mail/encodings.rb, line 230</span>
230:     <span class="ruby-keyword kw">def</span> <span class="ruby-constant">Encodings</span>.<span class="ruby-identifier">q_value_encode</span>(<span class="ruby-identifier">encoded_str</span>, <span class="ruby-identifier">encoding</span> = <span class="ruby-keyword kw">nil</span>)
231:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">encoded_str</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">encoded_str</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">ascii_only?</span>
232:       <span class="ruby-identifier">string</span>, <span class="ruby-identifier">encoding</span> = <span class="ruby-constant">RubyVer</span>.<span class="ruby-identifier">q_value_encode</span>(<span class="ruby-identifier">encoded_str</span>, <span class="ruby-identifier">encoding</span>)
233:       <span class="ruby-identifier">string</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-value str">&quot;=\r\n&quot;</span>, <span class="ruby-value str">''</span>) <span class="ruby-comment cmt"># We already have limited the string to the length we want</span>
234:       <span class="ruby-identifier">map_lines</span>(<span class="ruby-identifier">string</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">str</span><span class="ruby-operator">|</span>
235:         <span class="ruby-node">&quot;=?#{encoding}?Q?#{str.chomp.gsub(/ /, '_')}?=&quot;</span>
236:       <span class="ruby-keyword kw">end</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot; &quot;</span>)
237:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000137">
                    
                    <a name="M000137"></a><b>register</b>(name, cls)
                    
                </div>
                
                <div class="description">
                  <p>
Register transfer encoding
</p>
<p>
Example
</p>
<p>
<a href="Encodings.html#M000137">Encodings.register</a>
&#8220;base64&#8221;, <a
href="Encodings/Base64.html">Mail::Encodings::Base64</a>
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000137_source')" id="l_M000137_source">show</a>
                        
                    </p>
                    <div id="M000137_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/mail/encodings.rb, line 20</span>
20:     <span class="ruby-keyword kw">def</span> <span class="ruby-constant">Encodings</span>.<span class="ruby-identifier">register</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">cls</span>)
21:         <span class="ruby-ivar">@transfer_encodings</span>[<span class="ruby-identifier">get_name</span>(<span class="ruby-identifier">name</span>)] = <span class="ruby-identifier">cls</span>
22:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000148">
                    
                    <a name="M000148"></a><b>unquote_and_convert_to</b>(str, to_encoding)
                    
                </div>
                
                <div class="description">
                  <p>
Takes an encoded string of the format =?<encoding>?[QB]?<string>?=
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000148_source')" id="l_M000148_source">show</a>
                        
                    </p>
                    <div id="M000148_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/mail/encodings.rb, line 149</span>
149:     <span class="ruby-keyword kw">def</span> <span class="ruby-constant">Encodings</span>.<span class="ruby-identifier">unquote_and_convert_to</span>(<span class="ruby-identifier">str</span>, <span class="ruby-identifier">to_encoding</span>)
150:       <span class="ruby-identifier">original_encoding</span> = <span class="ruby-identifier">split_encoding_from_string</span>( <span class="ruby-identifier">str</span> )
151: 
152:       <span class="ruby-identifier">output</span> = <span class="ruby-identifier">value_decode</span>( <span class="ruby-identifier">str</span> ).<span class="ruby-identifier">to_s</span>
153: 
154:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">original_encoding</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">downcase</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-value str">&quot;-&quot;</span>, <span class="ruby-value str">&quot;&quot;</span>) <span class="ruby-operator">==</span> <span class="ruby-identifier">to_encoding</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">downcase</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-value str">&quot;-&quot;</span>, <span class="ruby-value str">&quot;&quot;</span>)
155:         <span class="ruby-identifier">output</span>
156:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">original_encoding</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">to_encoding</span>
157:         <span class="ruby-keyword kw">begin</span>
158:           <span class="ruby-keyword kw">if</span> <span class="ruby-constant">RUBY_VERSION</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value str">'1.9'</span>
159:             <span class="ruby-identifier">output</span>.<span class="ruby-identifier">encode</span>(<span class="ruby-identifier">to_encoding</span>)
160:           <span class="ruby-keyword kw">else</span>
161:             <span class="ruby-identifier">require</span> <span class="ruby-value str">'iconv'</span>
162:             <span class="ruby-constant">Iconv</span>.<span class="ruby-identifier">iconv</span>(<span class="ruby-identifier">to_encoding</span>, <span class="ruby-identifier">original_encoding</span>, <span class="ruby-identifier">output</span>).<span class="ruby-identifier">first</span>
163:           <span class="ruby-keyword kw">end</span>
164:         <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Iconv</span><span class="ruby-operator">::</span><span class="ruby-constant">IllegalSequence</span>, <span class="ruby-constant">Iconv</span><span class="ruby-operator">::</span><span class="ruby-constant">InvalidEncoding</span>, <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">EINVAL</span>
165:           <span class="ruby-comment cmt"># the 'from' parameter specifies a charset other than what the text</span>
166:           <span class="ruby-comment cmt"># actually is...not much we can do in this case but just return the</span>
167:           <span class="ruby-comment cmt"># unconverted text.</span>
168:           <span class="ruby-comment cmt">#</span>
169:           <span class="ruby-comment cmt"># Ditto if either parameter represents an unknown charset, like</span>
170:           <span class="ruby-comment cmt"># X-UNKNOWN.</span>
171:           <span class="ruby-identifier">output</span>
172:         <span class="ruby-keyword kw">end</span>
173:       <span class="ruby-keyword kw">else</span>
174:         <span class="ruby-identifier">output</span>
175:       <span class="ruby-keyword kw">end</span>
176:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000147">
                    
                    <a name="M000147"></a><b>value_decode</b>(str)
                    
                </div>
                
                <div class="description">
                  <p>
Decodes a given string as <a href="Encodings/Base64.html">Base64</a> or
Quoted Printable, depending on what type it is.
</p>
<p>
String has to be of the format =?<encoding>?[QB]?<string>?=
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000147_source')" id="l_M000147_source">show</a>
                        
                    </p>
                    <div id="M000147_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/mail/encodings.rb, line 115</span>
115:     <span class="ruby-keyword kw">def</span> <span class="ruby-constant">Encodings</span>.<span class="ruby-identifier">value_decode</span>(<span class="ruby-identifier">str</span>)
116:       <span class="ruby-comment cmt"># Optimization: If there's no encoded-words in the string, just return it</span>
117:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">str</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">str</span>.<span class="ruby-identifier">index</span>(<span class="ruby-value str">&quot;=?&quot;</span>)
118: 
119:       <span class="ruby-identifier">str</span> = <span class="ruby-identifier">str</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/\?=(\s*)=\?/</span>, <span class="ruby-value str">'?==?'</span>) <span class="ruby-comment cmt"># Remove whitespaces between 'encoded-word's</span>
120: 
121:       <span class="ruby-comment cmt"># Split on white-space boundaries with capture, so we capture the white-space as well</span>
122:       <span class="ruby-identifier">str</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp re">/([ \t])/</span>).<span class="ruby-identifier">map</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">text</span><span class="ruby-operator">|</span>
123:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">text</span>.<span class="ruby-identifier">index</span>(<span class="ruby-value str">'=?'</span>) .<span class="ruby-identifier">nil?</span>
124:           <span class="ruby-identifier">text</span>
125:         <span class="ruby-keyword kw">else</span>
126:           <span class="ruby-comment cmt"># Join QP encoded-words that are adjacent to avoid decoding partial chars</span>
127:           <span class="ruby-identifier">text</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">/\?\=\=\?.+?\?[Qq]\?/</span><span class="ruby-identifier">m</span>, <span class="ruby-value str">''</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">text</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/\?==\?/</span>
128: 
129:           <span class="ruby-comment cmt"># Search for occurences of quoted strings or plain strings</span>
130:           <span class="ruby-identifier">text</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/(                                  # Group around entire regex to include it in matches
131:                        \=\?[^?]+\?([QB])\?[^?]+?\?\=  # Quoted String with subgroup for encoding method
132:                        |                                # or
133:                        .+?(?=\=\?)                      # Plain String
134:                      )/</span><span class="ruby-identifier">xmi</span>).<span class="ruby-identifier">map</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">matches</span><span class="ruby-operator">|</span>
135:             <span class="ruby-identifier">string</span>, <span class="ruby-identifier">method</span> = <span class="ruby-operator">*</span><span class="ruby-identifier">matches</span>
136:             <span class="ruby-keyword kw">if</span>    <span class="ruby-identifier">method</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'b'</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">method</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'B'</span>
137:               <span class="ruby-identifier">b_value_decode</span>(<span class="ruby-identifier">string</span>)
138:             <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">method</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'q'</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">method</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'Q'</span>
139:               <span class="ruby-identifier">q_value_decode</span>(<span class="ruby-identifier">string</span>)
140:             <span class="ruby-keyword kw">else</span>
141:               <span class="ruby-identifier">string</span>
142:             <span class="ruby-keyword kw">end</span>
143:           <span class="ruby-keyword kw">end</span>
144:         <span class="ruby-keyword kw">end</span>
145:       <span class="ruby-keyword kw">end</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;&quot;</span>)
146:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Class Private methods</div>
            
            <div class="method">
                <div class="title" id="M000167">
                    
                    <a name="M000167"></a><b>b_value_decode</b>(str)
                    
                </div>
                
                <div class="description">
                  <p>
Decodes a <a href="Encodings/Base64.html">Base64</a> string from the
&#8220;=?UTF-8?B?VGhpcyBpcyDjgYIgc3RyaW5n?=&#8221; format
</p>
<p>
Example:
</p>
<pre>
 Encodings.b_value_decode(&quot;=?UTF-8?B?VGhpcyBpcyDjgYIgc3RyaW5n?=&quot;)
 #=&gt; 'This is „ÅÇ string'
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000167_source')" id="l_M000167_source">show</a>
                        
                    </p>
                    <div id="M000167_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/mail/encodings.rb, line 247</span>
247:     <span class="ruby-keyword kw">def</span> <span class="ruby-constant">Encodings</span>.<span class="ruby-identifier">b_value_decode</span>(<span class="ruby-identifier">str</span>)
248:       <span class="ruby-constant">RubyVer</span>.<span class="ruby-identifier">b_value_decode</span>(<span class="ruby-identifier">str</span>)
249:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000171">
                    
                    <a name="M000171"></a><b>find_encoding</b>(str)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000171_source')" id="l_M000171_source">show</a>
                        
                    </p>
                    <div id="M000171_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/mail/encodings.rb, line 270</span>
270:     <span class="ruby-keyword kw">def</span> <span class="ruby-constant">Encodings</span>.<span class="ruby-identifier">find_encoding</span>(<span class="ruby-identifier">str</span>)
271:       <span class="ruby-constant">RUBY_VERSION</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value str">'1.9'</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">str</span>.<span class="ruby-identifier">encoding</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">$KCODE</span>
272:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000168">
                    
                    <a name="M000168"></a><b>q_value_decode</b>(str)
                    
                </div>
                
                <div class="description">
                  <p>
Decodes a Quoted-Printable string from the
&#8220;=?UTF-8?Q?This_is_=E3=81=82_string?=&#8221; format
</p>
<p>
Example:
</p>
<pre>
 Encodings.q_value_decode(&quot;=?UTF-8?Q?This_is_=E3=81=82_string?=&quot;)
 #=&gt; 'This is „ÅÇ string'
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000168_source')" id="l_M000168_source">show</a>
                        
                    </p>
                    <div id="M000168_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/mail/encodings.rb, line 257</span>
257:     <span class="ruby-keyword kw">def</span> <span class="ruby-constant">Encodings</span>.<span class="ruby-identifier">q_value_decode</span>(<span class="ruby-identifier">str</span>)
258:       <span class="ruby-constant">RubyVer</span>.<span class="ruby-identifier">q_value_decode</span>(<span class="ruby-identifier">str</span>)
259:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000170">
                    
                    <a name="M000170"></a><b>split_encoding_from_string</b>( str )
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000170_source')" id="l_M000170_source">show</a>
                        
                    </p>
                    <div id="M000170_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/mail/encodings.rb, line 261</span>
261:     <span class="ruby-keyword kw">def</span> <span class="ruby-constant">Encodings</span>.<span class="ruby-identifier">split_encoding_from_string</span>( <span class="ruby-identifier">str</span> )
262:       <span class="ruby-identifier">match</span> = <span class="ruby-identifier">str</span>.<span class="ruby-identifier">match</span>(<span class="ruby-regexp re">/\=\?([^?]+)?\?[QB]\?(.+)?\?\=/</span><span class="ruby-identifier">mi</span>)
263:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">match</span>
264:         <span class="ruby-identifier">match</span>[<span class="ruby-value">1</span>]
265:       <span class="ruby-keyword kw">else</span>
266:         <span class="ruby-keyword kw">nil</span>
267:       <span class="ruby-keyword kw">end</span>
268:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    