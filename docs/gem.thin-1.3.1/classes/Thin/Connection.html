<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>Thin::Connection</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../css/main.css" type="text/css" media="screen" />
    <script src="../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Class</span> 
            Thin::Connection 
            
                <span class="parent">&lt; 
                    
                    EventMachine::Connection
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../files/lib/thin/connection_rb.html">lib/thin/connection.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    
    <div class="description">
        <p>
<a href="Connection.html">Connection</a> between the server and client.
This class is instanciated by EventMachine on each new connection that is
opened.
</p>

    </div>
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>C</dt>
        <dd>
            <ul>
                
                <li><a href="#M000088">can_persist!</a>,</li>
                
                <li><a href="#M000089">can_persist?</a>,</li>
                
                <li><a href="#M000081">close_request_response</a></li>
                
            </ul>
        </dd>
    
        <dt>H</dt>
        <dd>
            <ul>
                
                <li><a href="#M000079">handle_error</a></li>
                
            </ul>
        </dd>
    
        <dt>P</dt>
        <dd>
            <ul>
                
                <li><a href="#M000090">persistent?</a>,</li>
                
                <li><a href="#M000058">post_init</a>,</li>
                
                <li><a href="#M000075">post_process</a>,</li>
                
                <li><a href="#M000069">pre_process</a>,</li>
                
                <li><a href="#M000060">process</a></li>
                
            </ul>
        </dd>
    
        <dt>R</dt>
        <dd>
            <ul>
                
                <li><a href="#M000059">receive_data</a>,</li>
                
                <li><a href="#M000093">remote_address</a></li>
                
            </ul>
        </dd>
    
        <dt>S</dt>
        <dd>
            <ul>
                
                <li><a href="#M000094">socket_address</a></li>
                
            </ul>
        </dd>
    
        <dt>T</dt>
        <dd>
            <ul>
                
                <li><a href="#M000082">terminate_request</a>,</li>
                
                <li><a href="#M000091">threaded?</a></li>
                
            </ul>
        </dd>
    
        <dt>U</dt>
        <dd>
            <ul>
                
                <li><a href="#M000083">unbind</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    
    <div class="sectiontitle">Included Modules</div>
    <ul>
        
        <li>
            
            <a href="VERSION.html">Thin::VERSION</a>
            
            START:includes
        </li>
        
    </ul>
    

    

    

    
    <div class="sectiontitle">Constants</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class="attr-name">AsyncResponse</td>
            <td>=</td>
            <td class="attr-value">[-1, {}, []].freeze</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
This is a template async response. N.B. Can&#8217;t use string for body on
1.9
</p>
</td>
        </tr>
        
        
    </table>
    

    
    <div class="sectiontitle">Attributes</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>app</td>
            <td class='attr-desc'><p>
<a href="../Rack.html">Rack</a> application (adapter) served by this
connection.
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>backend</td>
            <td class='attr-desc'><p>
Backend to the server
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>request</td>
            <td class='attr-desc'><p>
Current request served by the connection
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>response</td>
            <td class='attr-desc'><p>
Next response sent through the connection
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [W]
            </td>
            <td class='attr-name'>threaded</td>
            <td class='attr-desc'><p>
Calling the application in a threaded allowing concurrent processing of
requests.
</p></td>
        </tr>
        
    </table>
    

    
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M000088">
                    
                    <a name="M000088"></a><b>can_persist!</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Allows this connection to be persistent.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000088_source')" id="l_M000088_source">show</a>
                        
                    </p>
                    <div id="M000088_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/thin/connection.rb, line 160</span>
160:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">can_persist!</span>
161:       <span class="ruby-ivar">@can_persist</span> = <span class="ruby-keyword kw">true</span>
162:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000089">
                    
                    <a name="M000089"></a><b>can_persist?</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Return <tt>true</tt> if this connection is allowed to stay open and be
persistent.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000089_source')" id="l_M000089_source">show</a>
                        
                    </p>
                    <div id="M000089_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/thin/connection.rb, line 165</span>
165:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">can_persist?</span>
166:       <span class="ruby-ivar">@can_persist</span>
167:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000081">
                    
                    <a name="M000081"></a><b>close_request_response</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000081_source')" id="l_M000081_source">show</a>
                        
                    </p>
                    <div id="M000081_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/thin/connection.rb, line 129</span>
129:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">close_request_response</span>
130:       <span class="ruby-ivar">@request</span>.<span class="ruby-identifier">async_close</span>.<span class="ruby-identifier">succeed</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@request</span>.<span class="ruby-identifier">async_close</span>
131:       <span class="ruby-ivar">@request</span>.<span class="ruby-identifier">close</span>  <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
132:       <span class="ruby-ivar">@response</span>.<span class="ruby-identifier">close</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
133:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000079">
                    
                    <a name="M000079"></a><b>handle_error</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Logs catched exception and closes the connection.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000079_source')" id="l_M000079_source">show</a>
                        
                    </p>
                    <div id="M000079_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/thin/connection.rb, line 123</span>
123:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">handle_error</span>
124:       <span class="ruby-identifier">log</span> <span class="ruby-node">&quot;!! Unexpected error while processing request: #{$!.message}&quot;</span>
125:       <span class="ruby-identifier">log_error</span>
126:       <span class="ruby-identifier">close_connection</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
127:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000090">
                    
                    <a name="M000090"></a><b>persistent?</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Return <tt>true</tt> if the connection must be left open and ready to be
reused for another request.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000090_source')" id="l_M000090_source">show</a>
                        
                    </p>
                    <div id="M000090_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/thin/connection.rb, line 171</span>
171:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">persistent?</span>
172:       <span class="ruby-ivar">@can_persist</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@response</span>.<span class="ruby-identifier">persistent?</span>
173:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000058">
                    
                    <a name="M000058"></a><b>post_init</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Get the connection ready to process a request.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000058_source')" id="l_M000058_source">show</a>
                        
                    </p>
                    <div id="M000058_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/thin/connection.rb, line 30</span>
30:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">post_init</span>
31:       <span class="ruby-ivar">@request</span>  = <span class="ruby-constant">Request</span>.<span class="ruby-identifier">new</span>
32:       <span class="ruby-ivar">@response</span> = <span class="ruby-constant">Response</span>.<span class="ruby-identifier">new</span>
33:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000075">
                    
                    <a name="M000075"></a><b>post_process</b>(result)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000075_source')" id="l_M000075_source">show</a>
                        
                    </p>
                    <div id="M000075_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/thin/connection.rb, line 89</span>
 89:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">post_process</span>(<span class="ruby-identifier">result</span>)
 90:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">result</span>
 91:       <span class="ruby-identifier">result</span> = <span class="ruby-identifier">result</span>.<span class="ruby-identifier">to_a</span>
 92:       
 93:       <span class="ruby-comment cmt"># Status code -1 indicates that we're going to respond later (async).</span>
 94:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">result</span>.<span class="ruby-identifier">first</span> <span class="ruby-operator">==</span> <span class="ruby-constant">AsyncResponse</span>.<span class="ruby-identifier">first</span>
 95: 
 96:       <span class="ruby-ivar">@response</span>.<span class="ruby-identifier">status</span>, <span class="ruby-ivar">@response</span>.<span class="ruby-identifier">headers</span>, <span class="ruby-ivar">@response</span>.<span class="ruby-identifier">body</span> = <span class="ruby-operator">*</span><span class="ruby-identifier">result</span>
 97: 
 98:       <span class="ruby-identifier">log</span> <span class="ruby-value str">&quot;!! Rack application returned nil body. Probably you wanted it to be an empty string?&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@response</span>.<span class="ruby-identifier">body</span>.<span class="ruby-identifier">nil?</span>
 99: 
100:       <span class="ruby-comment cmt"># Make the response persistent if requested by the client</span>
101:       <span class="ruby-ivar">@response</span>.<span class="ruby-identifier">persistent!</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@request</span>.<span class="ruby-identifier">persistent?</span>
102: 
103:       <span class="ruby-comment cmt"># Send the response</span>
104:       <span class="ruby-ivar">@response</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">chunk</span><span class="ruby-operator">|</span>
105:         <span class="ruby-identifier">trace</span> { <span class="ruby-identifier">chunk</span> }
106:         <span class="ruby-identifier">send_data</span> <span class="ruby-identifier">chunk</span>
107:       <span class="ruby-keyword kw">end</span>
108: 
109:     <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Exception</span>
110:       <span class="ruby-identifier">handle_error</span>
111:     <span class="ruby-keyword kw">ensure</span>
112:       <span class="ruby-comment cmt"># If the body is being deferred, then terminate afterward.</span>
113:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@response</span>.<span class="ruby-identifier">body</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:callback</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@response</span>.<span class="ruby-identifier">body</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:errback</span>)
114:         <span class="ruby-ivar">@response</span>.<span class="ruby-identifier">body</span>.<span class="ruby-identifier">callback</span> { <span class="ruby-identifier">terminate_request</span> }
115:         <span class="ruby-ivar">@response</span>.<span class="ruby-identifier">body</span>.<span class="ruby-identifier">errback</span>  { <span class="ruby-identifier">terminate_request</span> }
116:       <span class="ruby-keyword kw">else</span>
117:         <span class="ruby-comment cmt"># Don't terminate the response if we're going async.</span>
118:         <span class="ruby-identifier">terminate_request</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">result</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">result</span>.<span class="ruby-identifier">first</span> <span class="ruby-operator">==</span> <span class="ruby-constant">AsyncResponse</span>.<span class="ruby-identifier">first</span>
119:       <span class="ruby-keyword kw">end</span>
120:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000069">
                    
                    <a name="M000069"></a><b>pre_process</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000069_source')" id="l_M000069_source">show</a>
                        
                    </p>
                    <div id="M000069_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/thin/connection.rb, line 57</span>
57:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">pre_process</span>
58:       <span class="ruby-comment cmt"># Add client info to the request env</span>
59:       <span class="ruby-ivar">@request</span>.<span class="ruby-identifier">remote_address</span> = <span class="ruby-identifier">remote_address</span>
60: 
61:       <span class="ruby-comment cmt"># Connection may be closed unless the App#call response was a [-1, ...]</span>
62:       <span class="ruby-comment cmt"># It should be noted that connection objects will linger until this </span>
63:       <span class="ruby-comment cmt"># callback is no longer referenced, so be tidy!</span>
64:       <span class="ruby-ivar">@request</span>.<span class="ruby-identifier">async_callback</span> = <span class="ruby-identifier">method</span>(<span class="ruby-identifier">:post_process</span>)
65:       
66:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@backend</span>.<span class="ruby-identifier">ssl?</span>
67:         <span class="ruby-ivar">@request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-value str">&quot;rack.url_scheme&quot;</span>] = <span class="ruby-value str">&quot;https&quot;</span>
68:         
69:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">cert</span> = <span class="ruby-identifier">get_peer_cert</span>
70:           <span class="ruby-ivar">@request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-value str">'rack.peer_cert'</span>] = <span class="ruby-identifier">cert</span>
71:         <span class="ruby-keyword kw">end</span>
72:       <span class="ruby-keyword kw">end</span>
73: 
74:       <span class="ruby-comment cmt"># When we're under a non-async framework like rails, we can still spawn</span>
75:       <span class="ruby-comment cmt"># off async responses using the callback info, so there's little point</span>
76:       <span class="ruby-comment cmt"># in removing this.</span>
77:       <span class="ruby-identifier">response</span> = <span class="ruby-constant">AsyncResponse</span>
78:       <span class="ruby-identifier">catch</span>(<span class="ruby-identifier">:async</span>) <span class="ruby-keyword kw">do</span>
79:         <span class="ruby-comment cmt"># Process the request calling the Rack adapter</span>
80:         <span class="ruby-identifier">response</span> = <span class="ruby-ivar">@app</span>.<span class="ruby-identifier">call</span>(<span class="ruby-ivar">@request</span>.<span class="ruby-identifier">env</span>)
81:       <span class="ruby-keyword kw">end</span>
82:       <span class="ruby-identifier">response</span>
83:     <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Exception</span>
84:       <span class="ruby-identifier">handle_error</span>
85:       <span class="ruby-identifier">terminate_request</span>
86:       <span class="ruby-keyword kw">nil</span> <span class="ruby-comment cmt"># Signal to post_process that the request could not be processed</span>
87:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000060">
                    
                    <a name="M000060"></a><b>process</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Called when all data was received and the request is ready to be processed.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000060_source')" id="l_M000060_source">show</a>
                        
                    </p>
                    <div id="M000060_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/thin/connection.rb, line 47</span>
47:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">process</span>
48:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">threaded?</span>
49:         <span class="ruby-ivar">@request</span>.<span class="ruby-identifier">threaded</span> = <span class="ruby-keyword kw">true</span>
50:         <span class="ruby-constant">EventMachine</span>.<span class="ruby-identifier">defer</span>(<span class="ruby-identifier">method</span>(<span class="ruby-identifier">:pre_process</span>), <span class="ruby-identifier">method</span>(<span class="ruby-identifier">:post_process</span>))
51:       <span class="ruby-keyword kw">else</span>
52:         <span class="ruby-ivar">@request</span>.<span class="ruby-identifier">threaded</span> = <span class="ruby-keyword kw">false</span>
53:         <span class="ruby-identifier">post_process</span>(<span class="ruby-identifier">pre_process</span>)
54:       <span class="ruby-keyword kw">end</span>
55:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000059">
                    
                    <a name="M000059"></a><b>receive_data</b>(data)
                    
                </div>
                
                <div class="description">
                  <p>
Called when data is received from the client.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000059_source')" id="l_M000059_source">show</a>
                        
                    </p>
                    <div id="M000059_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/thin/connection.rb, line 36</span>
36:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">receive_data</span>(<span class="ruby-identifier">data</span>)
37:       <span class="ruby-identifier">trace</span> { <span class="ruby-identifier">data</span> }
38:       <span class="ruby-identifier">process</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@request</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">data</span>)
39:     <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">InvalidRequest</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
40:       <span class="ruby-identifier">log</span> <span class="ruby-value str">&quot;!! Invalid request&quot;</span>
41:       <span class="ruby-identifier">log_error</span> <span class="ruby-identifier">e</span>
42:       <span class="ruby-identifier">close_connection</span>
43:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000093">
                    
                    <a name="M000093"></a><b>remote_address</b>()
                    
                </div>
                
                <div class="description">
                  <p>
IP Address of the remote client.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000093_source')" id="l_M000093_source">show</a>
                        
                    </p>
                    <div id="M000093_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/thin/connection.rb, line 183</span>
183:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">remote_address</span>
184:       <span class="ruby-identifier">socket_address</span>
185:     <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Exception</span>
186:       <span class="ruby-identifier">log_error</span>
187:       <span class="ruby-keyword kw">nil</span>
188:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000082">
                    
                    <a name="M000082"></a><b>terminate_request</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Does request and response cleanup (closes open IO streams and deletes
created temporary files). Re-initializes response and request if client
supports persistent connection.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000082_source')" id="l_M000082_source">show</a>
                        
                    </p>
                    <div id="M000082_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/thin/connection.rb, line 139</span>
139:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">terminate_request</span>
140:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">persistent?</span>
141:         <span class="ruby-identifier">close_connection_after_writing</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
142:         <span class="ruby-identifier">close_request_response</span>
143:       <span class="ruby-keyword kw">else</span>
144:         <span class="ruby-identifier">close_request_response</span>
145:         <span class="ruby-comment cmt"># Prepare the connection for another request if the client</span>
146:         <span class="ruby-comment cmt"># supports HTTP pipelining (persistent connection).</span>
147:         <span class="ruby-identifier">post_init</span>
148:       <span class="ruby-keyword kw">end</span>
149:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000091">
                    
                    <a name="M000091"></a><b>threaded?</b>()
                    
                </div>
                
                <div class="description">
                  <p>
<tt>true</tt> if <tt>app.call</tt> will be called inside a thread. You can
set all requests as threaded setting <tt>Connection#threaded=true</tt> or
on a per-request case returning <tt>true</tt> in <tt>app.deferred?</tt>.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000091_source')" id="l_M000091_source">show</a>
                        
                    </p>
                    <div id="M000091_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/thin/connection.rb, line 178</span>
178:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">threaded?</span>
179:       <span class="ruby-ivar">@threaded</span> <span class="ruby-operator">||</span> (<span class="ruby-ivar">@app</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:deferred?</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@app</span>.<span class="ruby-identifier">deferred?</span>(<span class="ruby-ivar">@request</span>.<span class="ruby-identifier">env</span>))
180:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000083">
                    
                    <a name="M000083"></a><b>unbind</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Called when the connection is unbinded from the socket and can no longer be
used to process requests.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000083_source')" id="l_M000083_source">show</a>
                        
                    </p>
                    <div id="M000083_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/thin/connection.rb, line 153</span>
153:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">unbind</span>
154:       <span class="ruby-ivar">@request</span>.<span class="ruby-identifier">async_close</span>.<span class="ruby-identifier">succeed</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@request</span>.<span class="ruby-identifier">async_close</span>
155:       <span class="ruby-ivar">@response</span>.<span class="ruby-identifier">body</span>.<span class="ruby-identifier">fail</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@response</span>.<span class="ruby-identifier">body</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:fail</span>)
156:       <span class="ruby-ivar">@backend</span>.<span class="ruby-identifier">connection_finished</span>(<span class="ruby-keyword kw">self</span>)
157:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Protected methods</div>
            
            <div class="method">
                <div class="title" id="M000094">
                    
                    <a name="M000094"></a><b>socket_address</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Returns IP address of peer as a string.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000094_source')" id="l_M000094_source">show</a>
                        
                    </p>
                    <div id="M000094_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/thin/connection.rb, line 192</span>
192:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">socket_address</span>
193:         <span class="ruby-constant">Socket</span>.<span class="ruby-identifier">unpack_sockaddr_in</span>(<span class="ruby-identifier">get_peername</span>)[<span class="ruby-value">1</span>]
194:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    