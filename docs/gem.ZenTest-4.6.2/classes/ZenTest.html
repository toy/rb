<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>ZenTest</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen" />
    <script src="../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Class</span> 
            ZenTest 
            
                <span class="parent">&lt; 
                    
                    Object
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../files/lib/zentest_rb.html">lib/zentest.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    
    <div class="description">
        <p>
<a href="ZenTest.html">ZenTest</a> scans your target and unit-test code and
writes your missing code based on simple naming rules, enabling XP at a
much quicker pace. <a href="ZenTest.html">ZenTest</a> only works with Ruby
and Test::Unit.
</p>
<h2>RULES</h2>
<p>
<a href="ZenTest.html">ZenTest</a> uses the following rules to figure out
what code should be generated:
</p>
<ul>
<li>Definition:

<ul>
<li>CUT = Class Under Test

</li>
<li>TC = Test Class (for CUT)

</li>
</ul>
</li>
<li>TC&#8217;s name is the same as CUT w/ &#8220;Test&#8221; prepended at every
scope level.

<ul>
<li>Example: TestA::TestB vs A::B.

</li>
</ul>
</li>
<li>CUT method names are used in CT, with &#8220;test_&#8221; prependend and
optional &#8220;_ext&#8221; extensions for differentiating test case edge
boundaries.

<ul>
<li>Example:

<ul>
<li>A::B#blah

</li>
<li>TestA::TestB#test_blah_normal

</li>
<li>TestA::TestB#test_blah_missing_file

</li>
</ul>
</li>
</ul>
</li>
<li>All naming conventions are bidirectional with the exception of test
extensions.

</li>
</ul>
<p>
See <a href="ZenTestMapping.html">ZenTestMapping</a> for documentation on
method naming.
</p>

    </div>
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>A</dt>
        <dd>
            <ul>
                
                <li><a href="#M000101">add_missing_method</a>,</li>
                
                <li><a href="#M000106">analyze</a>,</li>
                
                <li><a href="#M000103">analyze_impl</a>,</li>
                
                <li><a href="#M000104">analyze_test</a>,</li>
                
                <li><a href="#M000112">autotest</a></li>
                
            </ul>
        </dd>
    
        <dt>C</dt>
        <dd>
            <ul>
                
                <li><a href="#M000097">convert_class_name</a>,</li>
                
                <li><a href="#M000105">create_method</a></li>
                
            </ul>
        </dd>
    
        <dt>F</dt>
        <dd>
            <ul>
                
                <li><a href="#M000111">fix</a></li>
                
            </ul>
        </dd>
    
        <dt>G</dt>
        <dd>
            <ul>
                
                <li><a href="#M000107">generate_code</a>,</li>
                
                <li><a href="#M000090">get_class</a>,</li>
                
                <li><a href="#M000095">get_inherited_methods_for</a>,</li>
                
                <li><a href="#M000091">get_methods_for</a></li>
                
            </ul>
        </dd>
    
        <dt>I</dt>
        <dd>
            <ul>
                
                <li><a href="#M000096">is_test_class</a></li>
                
            </ul>
        </dd>
    
        <dt>L</dt>
        <dd>
            <ul>
                
                <li><a href="#M000089">load_file</a></li>
                
            </ul>
        </dd>
    
        <dt>M</dt>
        <dd>
            <ul>
                
                <li><a href="#M000102">methods_and_tests</a>,</li>
                
                <li><a href="#M000087">missing_methods</a></li>
                
            </ul>
        </dd>
    
        <dt>N</dt>
        <dd>
            <ul>
                
                <li><a href="#M000088">new</a></li>
                
            </ul>
        </dd>
    
        <dt>P</dt>
        <dd>
            <ul>
                
                <li><a href="#M000099">process_class</a></li>
                
            </ul>
        </dd>
    
        <dt>R</dt>
        <dd>
            <ul>
                
                <li><a href="#M000108">result</a></li>
                
            </ul>
        </dd>
    
        <dt>S</dt>
        <dd>
            <ul>
                
                <li><a href="#M000100">scan_files</a></li>
                
            </ul>
        </dd>
    
        <dt>U</dt>
        <dd>
            <ul>
                
                <li><a href="#M000109">usage</a>,</li>
                
                <li><a href="#M000110">usage_with_exit</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    
    <div class="sectiontitle">Included Modules</div>
    <ul>
        
        <li>
            
            <a href="Autotest/Isolate.html">Autotest::Isolate</a>
            
            START:includes
        </li>
        
    </ul>
    

    

    

    
    <div class="sectiontitle">Constants</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class="attr-name">VERSION</td>
            <td>=</td>
            <td class="attr-value">'4.6.2'</td>
        </tr>
        
        
    </table>
    

    

    
            <div class="sectiontitle">Class Public methods</div>
            
            <div class="method">
                <div class="title" id="M000112">
                    
                    <a name="M000112"></a><b>autotest</b>(*klasses)
                    
                </div>
                
                <div class="description">
                  <p>
Process all the supplied classes for methods etc, and analyse the results.
Generate the skeletal code and eval it to put the methods into the runtime
environment.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000112_source')" id="l_M000112_source">show</a>
                        
                    </p>
                    <div id="M000112_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/zentest.rb, line 575</span>
575:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">autotest</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">klasses</span>)
576:     <span class="ruby-identifier">zentest</span> = <span class="ruby-constant">ZenTest</span>.<span class="ruby-identifier">new</span>
577:     <span class="ruby-identifier">klasses</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">klass</span><span class="ruby-operator">|</span>
578:       <span class="ruby-identifier">zentest</span>.<span class="ruby-identifier">process_class</span>(<span class="ruby-identifier">klass</span>)
579:     <span class="ruby-keyword kw">end</span>
580: 
581:     <span class="ruby-identifier">zentest</span>.<span class="ruby-identifier">analyze</span>
582: 
583:     <span class="ruby-identifier">zentest</span>.<span class="ruby-identifier">missing_methods</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">klass</span>,<span class="ruby-identifier">methods</span><span class="ruby-operator">|</span>
584:       <span class="ruby-identifier">methods</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">method</span>,<span class="ruby-identifier">x</span><span class="ruby-operator">|</span>
585:         <span class="ruby-identifier">warn</span> <span class="ruby-node">&quot;autotest generating #{klass}##{method}&quot;</span>
586:       <span class="ruby-keyword kw">end</span>
587:     <span class="ruby-keyword kw">end</span>
588: 
589:     <span class="ruby-identifier">zentest</span>.<span class="ruby-identifier">generate_code</span>
590:     <span class="ruby-identifier">code</span> = <span class="ruby-identifier">zentest</span>.<span class="ruby-identifier">result</span>
591:     <span class="ruby-identifier">puts</span> <span class="ruby-identifier">code</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">$DEBUG</span>
592: 
593:     <span class="ruby-constant">Object</span>.<span class="ruby-identifier">class_eval</span> <span class="ruby-identifier">code</span>
594:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000111">
                    
                    <a name="M000111"></a><b>fix</b>(*files)
                    
                </div>
                
                <div class="description">
                  <p>
Runs <a href="ZenTest.html">ZenTest</a> over all the supplied files so that
they are analysed and the missing methods have skeleton code written. If no
files are supplied, splutter out some help.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000111_source')" id="l_M000111_source">show</a>
                        
                    </p>
                    <div id="M000111_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/zentest.rb, line 562</span>
562:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">fix</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">files</span>)
563:     <span class="ruby-constant">ZenTest</span>.<span class="ruby-identifier">usage_with_exit</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">files</span>.<span class="ruby-identifier">empty?</span>
564:     <span class="ruby-identifier">zentest</span> = <span class="ruby-constant">ZenTest</span>.<span class="ruby-identifier">new</span>
565:     <span class="ruby-identifier">zentest</span>.<span class="ruby-identifier">scan_files</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">files</span>)
566:     <span class="ruby-identifier">zentest</span>.<span class="ruby-identifier">analyze</span>
567:     <span class="ruby-identifier">zentest</span>.<span class="ruby-identifier">generate_code</span>
568:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">zentest</span>.<span class="ruby-identifier">result</span>
569:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000088">
                    
                    <a name="M000088"></a><b>new</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000088_source')" id="l_M000088_source">show</a>
                        
                    </p>
                    <div id="M000088_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/zentest.rb, line 73</span>
73:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>
74:     <span class="ruby-ivar">@result</span> = []
75:     <span class="ruby-ivar">@test_klasses</span> = {}
76:     <span class="ruby-ivar">@klasses</span> = {}
77:     <span class="ruby-ivar">@error_count</span> = <span class="ruby-value">0</span>
78:     <span class="ruby-ivar">@inherited_methods</span> = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">h</span>,<span class="ruby-identifier">k</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">k</span>] = {} }
79:     <span class="ruby-comment cmt"># key = klassname, val = hash of methods =&gt; true</span>
80:     <span class="ruby-ivar">@missing_methods</span> = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">h</span>,<span class="ruby-identifier">k</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">k</span>] = {} }
81:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000109">
                    
                    <a name="M000109"></a><b>usage</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Provide a certain amount of help.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000109_source')" id="l_M000109_source">show</a>
                        
                    </p>
                    <div id="M000109_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/zentest.rb, line 519</span>
519:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">usage</span>
520:     <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;usage: \#{File.basename $0} [options] test-and-implementation-files...\n\nZenTest scans your target and unit-test code and writes your missing\ncode based on simple naming rules, enabling XP at a much quicker\npace. ZenTest only works with Ruby and Test::Unit.\n\nZenTest uses the following rules to figure out what code should be\ngenerated:\n\n* Definition:\n* CUT = Class Under Test\n* TC = Test Class (for CUT)\n* TC's name is the same as CUT w/ \&quot;Test\&quot; prepended at every scope level.\n* Example: TestA::TestB vs A::B.\n* CUT method names are used in CT, with \&quot;test_\&quot; prependend and optional \&quot;_ext\&quot; extensions for differentiating test case edge boundaries.\n* Example:\n* A::B#blah\n* TestA::TestB#test_blah_normal\n* TestA::TestB#test_blah_missing_file\n* All naming conventions are bidirectional with the exception of test extensions.\n\noptions:\n-h display this information\n-v display version information\n-r Reverse mapping (ClassTest instead of TestClass)\n-e (Rapid XP) eval the code generated instead of printing it\n\n&quot;</span>
521:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000110">
                    
                    <a name="M000110"></a><b>usage_with_exit</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Give help, then quit.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000110_source')" id="l_M000110_source">show</a>
                        
                    </p>
                    <div id="M000110_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/zentest.rb, line 553</span>
553:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">usage_with_exit</span>
554:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">usage</span>
555:     <span class="ruby-identifier">exit</span> <span class="ruby-value">0</span>
556:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M000101">
                    
                    <a name="M000101"></a><b>add_missing_method</b>(klassname, methodname)
                    
                </div>
                
                <div class="description">
                  <p>
Adds a missing method to the collected results.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000101_source')" id="l_M000101_source">show</a>
                        
                    </p>
                    <div id="M000101_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/zentest.rb, line 327</span>
327:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_missing_method</span>(<span class="ruby-identifier">klassname</span>, <span class="ruby-identifier">methodname</span>)
328:     <span class="ruby-ivar">@result</span>.<span class="ruby-identifier">push</span> <span class="ruby-node">&quot;# ERROR method #{klassname}\##{methodname} does not exist (1)&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">$DEBUG</span> <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">not</span> <span class="ruby-identifier">$TESTING</span>
329:     <span class="ruby-ivar">@error_count</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
330:     <span class="ruby-ivar">@missing_methods</span>[<span class="ruby-identifier">klassname</span>][<span class="ruby-identifier">methodname</span>] = <span class="ruby-keyword kw">true</span>
331:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000106">
                    
                    <a name="M000106"></a><b>analyze</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Walk each known class and test that each method has a test method Then do
it in the other direction...
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000106_source')" id="l_M000106_source">show</a>
                        
                    </p>
                    <div id="M000106_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/zentest.rb, line 443</span>
443:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">analyze</span>
444:     <span class="ruby-comment cmt"># walk each known class and test that each method has a test method</span>
445:     <span class="ruby-ivar">@klasses</span>.<span class="ruby-identifier">each_key</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">klassname</span><span class="ruby-operator">|</span>
446:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">analyze_impl</span>(<span class="ruby-identifier">klassname</span>)
447:     <span class="ruby-keyword kw">end</span>
448: 
449:     <span class="ruby-comment cmt"># now do it in the other direction...</span>
450:     <span class="ruby-ivar">@test_klasses</span>.<span class="ruby-identifier">each_key</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">testklassname</span><span class="ruby-operator">|</span>
451:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">analyze_test</span>(<span class="ruby-identifier">testklassname</span>)
452:     <span class="ruby-keyword kw">end</span>
453:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000103">
                    
                    <a name="M000103"></a><b>analyze_impl</b>(klassname)
                    
                </div>
                
                <div class="description">
                  <p>
Checks, for the given class klassname, that each method has a corrsponding
test method. If it doesn&#8217;t this is added to the information for that
class
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000103_source')" id="l_M000103_source">show</a>
                        
                    </p>
                    <div id="M000103_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/zentest.rb, line 343</span>
343:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">analyze_impl</span>(<span class="ruby-identifier">klassname</span>)
344:     <span class="ruby-identifier">testklassname</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">convert_class_name</span>(<span class="ruby-identifier">klassname</span>)
345:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@test_klasses</span>[<span class="ruby-identifier">testklassname</span>] <span class="ruby-keyword kw">then</span>
346:       <span class="ruby-identifier">_</span>, <span class="ruby-identifier">testmethods</span> = <span class="ruby-identifier">methods_and_tests</span>(<span class="ruby-identifier">klassname</span>, <span class="ruby-identifier">testklassname</span>)
347: 
348:       <span class="ruby-comment cmt"># check that each method has a test method</span>
349:       <span class="ruby-ivar">@klasses</span>[<span class="ruby-identifier">klassname</span>].<span class="ruby-identifier">each_key</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">methodname</span> <span class="ruby-operator">|</span>
350:         <span class="ruby-identifier">testmethodname</span> = <span class="ruby-identifier">normal_to_test</span>(<span class="ruby-identifier">methodname</span>)
351:         <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">testmethods</span>[<span class="ruby-identifier">testmethodname</span>] <span class="ruby-keyword kw">then</span>
352:           <span class="ruby-keyword kw">begin</span>
353:             <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">testmethods</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">find</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">m</span><span class="ruby-operator">|</span> <span class="ruby-identifier">m</span> <span class="ruby-operator">=~</span> <span class="ruby-node">/#{testmethodname}(_\w+)+$/</span> } <span class="ruby-keyword kw">then</span>
354:               <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">add_missing_method</span>(<span class="ruby-identifier">testklassname</span>, <span class="ruby-identifier">testmethodname</span>)
355:             <span class="ruby-keyword kw">end</span>
356:           <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">RegexpError</span>
357:             <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;# ERROR trying to use '#{testmethodname}' as a regex. Look at #{klassname}.#{methodname}&quot;</span>
358:           <span class="ruby-keyword kw">end</span>
359:         <span class="ruby-keyword kw">end</span> <span class="ruby-comment cmt"># testmethods[testmethodname]</span>
360:       <span class="ruby-keyword kw">end</span> <span class="ruby-comment cmt"># @klasses[klassname].each_key</span>
361:     <span class="ruby-keyword kw">else</span> <span class="ruby-comment cmt"># ! @test_klasses[testklassname]</span>
362:       <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;# ERROR test class #{testklassname} does not exist&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">$DEBUG</span>
363:       <span class="ruby-ivar">@error_count</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
364: 
365:       <span class="ruby-ivar">@klasses</span>[<span class="ruby-identifier">klassname</span>].<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">methodname</span> <span class="ruby-operator">|</span>
366:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">add_missing_method</span>(<span class="ruby-identifier">testklassname</span>, <span class="ruby-identifier">normal_to_test</span>(<span class="ruby-identifier">methodname</span>))
367:       <span class="ruby-keyword kw">end</span>
368:     <span class="ruby-keyword kw">end</span> <span class="ruby-comment cmt"># @test_klasses[testklassname]</span>
369:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000104">
                    
                    <a name="M000104"></a><b>analyze_test</b>(testklassname)
                    
                </div>
                
                <div class="description">
                  <p>
For the given test class testklassname, ensure that all the test methods
have corresponding (normal) methods. If not, add them to the information
about that class.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000104_source')" id="l_M000104_source">show</a>
                        
                    </p>
                    <div id="M000104_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/zentest.rb, line 374</span>
374:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">analyze_test</span>(<span class="ruby-identifier">testklassname</span>)
375:     <span class="ruby-identifier">klassname</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">convert_class_name</span>(<span class="ruby-identifier">testklassname</span>)
376: 
377:     <span class="ruby-comment cmt"># CUT might be against a core class, if so, slurp it and analyze it</span>
378:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">$stdlib</span>[<span class="ruby-identifier">klassname</span>] <span class="ruby-keyword kw">then</span>
379:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">process_class</span>(<span class="ruby-identifier">klassname</span>, <span class="ruby-keyword kw">true</span>)
380:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">analyze_impl</span>(<span class="ruby-identifier">klassname</span>)
381:     <span class="ruby-keyword kw">end</span>
382: 
383:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@klasses</span>[<span class="ruby-identifier">klassname</span>] <span class="ruby-keyword kw">then</span>
384:       <span class="ruby-identifier">methods</span>, <span class="ruby-identifier">testmethods</span> = <span class="ruby-identifier">methods_and_tests</span>(<span class="ruby-identifier">klassname</span>,<span class="ruby-identifier">testklassname</span>)
385: 
386:       <span class="ruby-comment cmt"># check that each test method has a method</span>
387:       <span class="ruby-identifier">testmethods</span>.<span class="ruby-identifier">each_key</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">testmethodname</span> <span class="ruby-operator">|</span>
388:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">testmethodname</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/^test_(?!integration_)/</span> <span class="ruby-keyword kw">then</span>
389: 
390:           <span class="ruby-comment cmt"># try the current name</span>
391:           <span class="ruby-identifier">methodname</span> = <span class="ruby-identifier">test_to_normal</span>(<span class="ruby-identifier">testmethodname</span>, <span class="ruby-identifier">klassname</span>)
392:           <span class="ruby-identifier">orig_name</span> = <span class="ruby-identifier">methodname</span>.<span class="ruby-identifier">dup</span>
393: 
394:           <span class="ruby-identifier">found</span> = <span class="ruby-keyword kw">false</span>
395:           <span class="ruby-keyword kw">until</span> <span class="ruby-identifier">methodname</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;&quot;</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">methods</span>[<span class="ruby-identifier">methodname</span>] <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@inherited_methods</span>[<span class="ruby-identifier">klassname</span>][<span class="ruby-identifier">methodname</span>] <span class="ruby-keyword kw">do</span>
396:               <span class="ruby-comment cmt"># try the name minus an option (ie mut_opt1 -&gt; mut)</span>
397:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">methodname</span>.<span class="ruby-identifier">sub!</span>(<span class="ruby-regexp re">/_[^_]+$/</span>, <span class="ruby-value str">''</span>) <span class="ruby-keyword kw">then</span>
398:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">methods</span>[<span class="ruby-identifier">methodname</span>] <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@inherited_methods</span>[<span class="ruby-identifier">klassname</span>][<span class="ruby-identifier">methodname</span>] <span class="ruby-keyword kw">then</span>
399:                 <span class="ruby-identifier">found</span> = <span class="ruby-keyword kw">true</span>
400:               <span class="ruby-keyword kw">end</span>
401:             <span class="ruby-keyword kw">else</span>
402:               <span class="ruby-keyword kw">break</span> <span class="ruby-comment cmt"># no more substitutions will take place</span>
403:             <span class="ruby-keyword kw">end</span>
404:           <span class="ruby-keyword kw">end</span> <span class="ruby-comment cmt"># methodname == &quot;&quot; or ...</span>
405: 
406:           <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">found</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">methods</span>[<span class="ruby-identifier">methodname</span>] <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">methodname</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;initialize&quot;</span> <span class="ruby-keyword kw">then</span>
407:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">add_missing_method</span>(<span class="ruby-identifier">klassname</span>, <span class="ruby-identifier">orig_name</span>)
408:           <span class="ruby-keyword kw">end</span>
409: 
410:         <span class="ruby-keyword kw">else</span> <span class="ruby-comment cmt"># not a test_.* method</span>
411:           <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">testmethodname</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/^util_/</span> <span class="ruby-keyword kw">then</span>
412:             <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;# WARNING Skipping #{testklassname}\##{testmethodname}&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">$DEBUG</span>
413:           <span class="ruby-keyword kw">end</span>
414:         <span class="ruby-keyword kw">end</span> <span class="ruby-comment cmt"># testmethodname =~ ...</span>
415:       <span class="ruby-keyword kw">end</span> <span class="ruby-comment cmt"># testmethods.each_key</span>
416:     <span class="ruby-keyword kw">else</span> <span class="ruby-comment cmt"># ! @klasses[klassname]</span>
417:       <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;# ERROR class #{klassname} does not exist&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">$DEBUG</span>
418:       <span class="ruby-ivar">@error_count</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
419: 
420:       <span class="ruby-ivar">@test_klasses</span>[<span class="ruby-identifier">testklassname</span>].<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">testmethodname</span><span class="ruby-operator">|</span>
421:         <span class="ruby-ivar">@missing_methods</span>[<span class="ruby-identifier">klassname</span>][<span class="ruby-identifier">test_to_normal</span>(<span class="ruby-identifier">testmethodname</span>)] = <span class="ruby-keyword kw">true</span>
422:       <span class="ruby-keyword kw">end</span>
423:     <span class="ruby-keyword kw">end</span> <span class="ruby-comment cmt"># @klasses[klassname]</span>
424:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000097">
                    
                    <a name="M000097"></a><b>convert_class_name</b>(name)
                    
                </div>
                
                <div class="description">
                  <p>
Generate the name of a testclass from non-test class so that Foo::Blah =>
TestFoo::TestBlah, etc. It the name is already a test class, convert it the
other way.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000097_source')" id="l_M000097_source">show</a>
                        
                    </p>
                    <div id="M000097_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/zentest.rb, line 191</span>
191:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">convert_class_name</span>(<span class="ruby-identifier">name</span>)
192:     <span class="ruby-identifier">name</span> = <span class="ruby-identifier">name</span>.<span class="ruby-identifier">to_s</span>
193: 
194:     <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">is_test_class</span>(<span class="ruby-identifier">name</span>) <span class="ruby-keyword kw">then</span>
195:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">$r</span> <span class="ruby-keyword kw">then</span>
196:         <span class="ruby-identifier">name</span> = <span class="ruby-identifier">name</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/Test($|::)/</span>, <span class="ruby-value str">'\1'</span>) <span class="ruby-comment cmt"># FooTest::BlahTest =&gt; Foo::Blah</span>
197:       <span class="ruby-keyword kw">else</span>
198:         <span class="ruby-identifier">name</span> = <span class="ruby-identifier">name</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/(^|::)Test/</span>, <span class="ruby-value str">'\1'</span>) <span class="ruby-comment cmt"># TestFoo::TestBlah =&gt; Foo::Blah</span>
199:       <span class="ruby-keyword kw">end</span>
200:     <span class="ruby-keyword kw">else</span>
201:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">$r</span> <span class="ruby-keyword kw">then</span>
202:         <span class="ruby-identifier">name</span> = <span class="ruby-identifier">name</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/($|::)/</span>, <span class="ruby-value str">'Test\1'</span>) <span class="ruby-comment cmt"># Foo::Blah =&gt; FooTest::BlahTest</span>
203:       <span class="ruby-keyword kw">else</span>
204:         <span class="ruby-identifier">name</span> = <span class="ruby-identifier">name</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/(^|::)/</span>, <span class="ruby-value str">'\1Test'</span>) <span class="ruby-comment cmt"># Foo::Blah =&gt; TestFoo::TestBlah</span>
205:       <span class="ruby-keyword kw">end</span>
206:     <span class="ruby-keyword kw">end</span>
207: 
208:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">name</span>
209:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000105">
                    
                    <a name="M000105"></a><b>create_method</b>(indentunit, indent, name)
                    
                </div>
                
                <div class="description">
                  <p>
create a given method at a given indentation. Returns an array containing
the lines of the method.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000105_source')" id="l_M000105_source">show</a>
                        
                    </p>
                    <div id="M000105_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/zentest.rb, line 429</span>
429:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create_method</span>(<span class="ruby-identifier">indentunit</span>, <span class="ruby-identifier">indent</span>, <span class="ruby-identifier">name</span>)
430:     <span class="ruby-identifier">meth</span> = []
431:     <span class="ruby-identifier">meth</span>.<span class="ruby-identifier">push</span> <span class="ruby-identifier">indentunit</span><span class="ruby-operator">*</span><span class="ruby-identifier">indent</span> <span class="ruby-operator">+</span> <span class="ruby-node">&quot;def #{name}&quot;</span>
432:     <span class="ruby-identifier">meth</span>.<span class="ruby-identifier">last</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;(*args)&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">name</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/^test/</span>
433:     <span class="ruby-identifier">indent</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
434:     <span class="ruby-identifier">meth</span>.<span class="ruby-identifier">push</span> <span class="ruby-identifier">indentunit</span><span class="ruby-operator">*</span><span class="ruby-identifier">indent</span> <span class="ruby-operator">+</span> <span class="ruby-node">&quot;raise NotImplementedError, 'Need to write #{name}'&quot;</span>
435:     <span class="ruby-identifier">indent</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span>
436:     <span class="ruby-identifier">meth</span>.<span class="ruby-identifier">push</span> <span class="ruby-identifier">indentunit</span><span class="ruby-operator">*</span><span class="ruby-identifier">indent</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;end&quot;</span>
437:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">meth</span>
438:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000107">
                    
                    <a name="M000107"></a><b>generate_code</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Using the results gathered during analysis generate skeletal code with
methods raising NotImplementedError, so that they can be filled in later,
and so the tests will fail to start with.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000107_source')" id="l_M000107_source">show</a>
                        
                    </p>
                    <div id="M000107_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/zentest.rb, line 459</span>
459:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">generate_code</span>
460:     <span class="ruby-ivar">@result</span>.<span class="ruby-identifier">unshift</span> <span class="ruby-node">&quot;# Code Generated by ZenTest v. #{VERSION}&quot;</span>
461: 
462:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">$DEBUG</span> <span class="ruby-keyword kw">then</span>
463:       <span class="ruby-ivar">@result</span>.<span class="ruby-identifier">push</span> <span class="ruby-node">&quot;# found classes: #{@klasses.keys.join(', ')}&quot;</span>
464:       <span class="ruby-ivar">@result</span>.<span class="ruby-identifier">push</span> <span class="ruby-node">&quot;# found test classes: #{@test_klasses.keys.join(', ')}&quot;</span>
465:     <span class="ruby-keyword kw">end</span>
466: 
467:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@missing_methods</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> <span class="ruby-keyword kw">then</span>
468:       <span class="ruby-ivar">@result</span>.<span class="ruby-identifier">push</span> <span class="ruby-value str">&quot;&quot;</span>
469:       <span class="ruby-ivar">@result</span>.<span class="ruby-identifier">push</span> <span class="ruby-value str">&quot;require 'test/unit/testcase'&quot;</span>
470:       <span class="ruby-ivar">@result</span>.<span class="ruby-identifier">push</span> <span class="ruby-value str">&quot;require 'test/unit' if $0 == __FILE__&quot;</span>
471:       <span class="ruby-ivar">@result</span>.<span class="ruby-identifier">push</span> <span class="ruby-value str">&quot;&quot;</span>
472:     <span class="ruby-keyword kw">end</span>
473: 
474:     <span class="ruby-identifier">indentunit</span> = <span class="ruby-value str">&quot;  &quot;</span>
475: 
476:     <span class="ruby-ivar">@missing_methods</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">sort</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">fullklasspath</span><span class="ruby-operator">|</span>
477:       <span class="ruby-identifier">methods</span> = <span class="ruby-ivar">@missing_methods</span>[<span class="ruby-identifier">fullklasspath</span>]
478:       <span class="ruby-identifier">cls_methods</span> = <span class="ruby-identifier">methods</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">grep</span>(<span class="ruby-regexp re">/^(self\.|test_class_)/</span>)
479:       <span class="ruby-identifier">methods</span>.<span class="ruby-identifier">delete_if</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">cls_methods</span>.<span class="ruby-identifier">include?</span> <span class="ruby-identifier">k</span> }
480: 
481:       <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">methods</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">cls_methods</span>.<span class="ruby-identifier">empty?</span>
482: 
483:       <span class="ruby-identifier">indent</span> = <span class="ruby-value">0</span>
484:       <span class="ruby-identifier">is_test_class</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">is_test_class</span>(<span class="ruby-identifier">fullklasspath</span>)
485: 
486:       <span class="ruby-ivar">@result</span>.<span class="ruby-identifier">push</span> <span class="ruby-identifier">indentunit</span><span class="ruby-operator">*</span><span class="ruby-identifier">indent</span> <span class="ruby-operator">+</span> <span class="ruby-node">&quot;class #{fullklasspath}&quot;</span> <span class="ruby-operator">+</span> (<span class="ruby-identifier">is_test_class</span> <span class="ruby-value">? </span><span class="ruby-value str">&quot; &lt; Test::Unit::TestCase&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-value str">''</span>)
487:       <span class="ruby-identifier">indent</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
488: 
489:       <span class="ruby-identifier">meths</span> = []
490: 
491:       <span class="ruby-identifier">cls_methods</span>.<span class="ruby-identifier">sort</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">method</span><span class="ruby-operator">|</span>
492:         <span class="ruby-identifier">meth</span> = <span class="ruby-identifier">create_method</span>(<span class="ruby-identifier">indentunit</span>, <span class="ruby-identifier">indent</span>, <span class="ruby-identifier">method</span>)
493:         <span class="ruby-identifier">meths</span>.<span class="ruby-identifier">push</span> <span class="ruby-identifier">meth</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;\n&quot;</span>)
494:       <span class="ruby-keyword kw">end</span>
495: 
496:       <span class="ruby-identifier">methods</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">sort</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">method</span><span class="ruby-operator">|</span>
497:         <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">method</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/pretty_print/</span>
498:         <span class="ruby-identifier">meth</span> = <span class="ruby-identifier">create_method</span>(<span class="ruby-identifier">indentunit</span>, <span class="ruby-identifier">indent</span>, <span class="ruby-identifier">method</span>)
499:         <span class="ruby-identifier">meths</span>.<span class="ruby-identifier">push</span> <span class="ruby-identifier">meth</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;\n&quot;</span>)
500:       <span class="ruby-keyword kw">end</span>
501: 
502:       <span class="ruby-ivar">@result</span>.<span class="ruby-identifier">push</span> <span class="ruby-identifier">meths</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;\n\n&quot;</span>)
503: 
504:       <span class="ruby-identifier">indent</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span>
505:       <span class="ruby-ivar">@result</span>.<span class="ruby-identifier">push</span> <span class="ruby-identifier">indentunit</span><span class="ruby-operator">*</span><span class="ruby-identifier">indent</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;end&quot;</span>
506:       <span class="ruby-ivar">@result</span>.<span class="ruby-identifier">push</span> <span class="ruby-value str">''</span>
507:     <span class="ruby-keyword kw">end</span>
508: 
509:     <span class="ruby-ivar">@result</span>.<span class="ruby-identifier">push</span> <span class="ruby-node">&quot;# Number of errors detected: #{@error_count}&quot;</span>
510:     <span class="ruby-ivar">@result</span>.<span class="ruby-identifier">push</span> <span class="ruby-value str">''</span>
511:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000090">
                    
                    <a name="M000090"></a><b>get_class</b>(klassname)
                    
                </div>
                
                <div class="description">
                  <p>
obtain the class klassname, either from <a href="Module.html">Module</a> or
using ObjectSpace to search for it.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000090_source')" id="l_M000090_source">show</a>
                        
                    </p>
                    <div id="M000090_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/zentest.rb, line 100</span>
100:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_class</span>(<span class="ruby-identifier">klassname</span>)
101:     <span class="ruby-keyword kw">begin</span>
102:       <span class="ruby-identifier">klass</span> = <span class="ruby-identifier">klassname</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp re">/::/</span>).<span class="ruby-identifier">inject</span>(<span class="ruby-constant">Object</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">n</span><span class="ruby-operator">|</span> <span class="ruby-identifier">k</span>.<span class="ruby-identifier">const_get</span> <span class="ruby-identifier">n</span> }
103:       <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;# found class #{klass.name}&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">$DEBUG</span>
104:     <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">NameError</span>
105:       <span class="ruby-constant">ObjectSpace</span>.<span class="ruby-identifier">each_object</span>(<span class="ruby-constant">Class</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">cls</span><span class="ruby-operator">|</span>
106:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">cls</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">=~</span> <span class="ruby-node">/(^|::)#{klassname}$/</span> <span class="ruby-keyword kw">then</span>
107:           <span class="ruby-identifier">klass</span> = <span class="ruby-identifier">cls</span>
108:           <span class="ruby-identifier">klassname</span> = <span class="ruby-identifier">cls</span>.<span class="ruby-identifier">name</span>
109:           <span class="ruby-keyword kw">break</span>
110:         <span class="ruby-keyword kw">end</span>
111:       <span class="ruby-keyword kw">end</span>
112:       <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;# searched and found #{klass.name}&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">klass</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">$DEBUG</span>
113:     <span class="ruby-keyword kw">end</span>
114: 
115:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">klass</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">not</span> <span class="ruby-identifier">$TESTING</span> <span class="ruby-keyword kw">then</span>
116:       <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Could not figure out how to get #{klassname}...&quot;</span>
117:       <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;Report to support-zentest@zenspider.com w/ relevant source&quot;</span>
118:     <span class="ruby-keyword kw">end</span>
119: 
120:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">klass</span>
121:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000095">
                    
                    <a name="M000095"></a><b>get_inherited_methods_for</b>(klass, full)
                    
                </div>
                
                <div class="description">
                  <p>
Return the methods for class klass, as a hash with the method nemas as
keys, and true as the value for all keys. Unless full is true, leave out
the methods for Object which all classes get.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000095_source')" id="l_M000095_source">show</a>
                        
                    </p>
                    <div id="M000095_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/zentest.rb, line 156</span>
156:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_inherited_methods_for</span>(<span class="ruby-identifier">klass</span>, <span class="ruby-identifier">full</span>)
157:     <span class="ruby-identifier">klass</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">get_class</span>(<span class="ruby-identifier">klass</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">klass</span>.<span class="ruby-identifier">kind_of?</span> <span class="ruby-constant">String</span>
158: 
159:     <span class="ruby-identifier">klassmethods</span> = {}
160:     <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">klass</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">method_defined?</span>(<span class="ruby-identifier">:superclass</span>)) <span class="ruby-keyword kw">then</span>
161:       <span class="ruby-identifier">superklass</span> = <span class="ruby-identifier">klass</span>.<span class="ruby-identifier">superclass</span>
162:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">superklass</span> <span class="ruby-keyword kw">then</span>
163:         <span class="ruby-identifier">the_methods</span> = <span class="ruby-identifier">superklass</span>.<span class="ruby-identifier">instance_methods</span>(<span class="ruby-keyword kw">true</span>)
164: 
165:         <span class="ruby-comment cmt"># generally we don't test Object's methods...</span>
166:         <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">full</span> <span class="ruby-keyword kw">then</span>
167:           <span class="ruby-identifier">the_methods</span> <span class="ruby-operator">-=</span> <span class="ruby-constant">Object</span>.<span class="ruby-identifier">instance_methods</span>(<span class="ruby-keyword kw">true</span>)
168:           <span class="ruby-identifier">the_methods</span> <span class="ruby-operator">-=</span> <span class="ruby-constant">Kernel</span>.<span class="ruby-identifier">methods</span> <span class="ruby-comment cmt"># FIX (true) - check 1.6 vs 1.8</span>
169:         <span class="ruby-keyword kw">end</span>
170: 
171:         <span class="ruby-identifier">the_methods</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">meth</span><span class="ruby-operator">|</span>
172:           <span class="ruby-identifier">klassmethods</span>[<span class="ruby-identifier">meth</span>.<span class="ruby-identifier">to_s</span>] = <span class="ruby-keyword kw">true</span>
173:         <span class="ruby-keyword kw">end</span>
174:       <span class="ruby-keyword kw">end</span>
175:     <span class="ruby-keyword kw">end</span>
176:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">klassmethods</span>
177:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000091">
                    
                    <a name="M000091"></a><b>get_methods_for</b>(klass, full=false)
                    
                </div>
                
                <div class="description">
                  <p>
Get the public instance, class and singleton methods for class klass. If
full is true, include the methods from Kernel and other modules that get
included. The methods suite, new, pretty_print, pretty_print_cycle will not
be included in the resuting array.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000091_source')" id="l_M000091_source">show</a>
                        
                    </p>
                    <div id="M000091_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/zentest.rb, line 128</span>
128:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_methods_for</span>(<span class="ruby-identifier">klass</span>, <span class="ruby-identifier">full</span>=<span class="ruby-keyword kw">false</span>)
129:     <span class="ruby-identifier">klass</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">get_class</span>(<span class="ruby-identifier">klass</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">klass</span>.<span class="ruby-identifier">kind_of?</span> <span class="ruby-constant">String</span>
130: 
131:     <span class="ruby-comment cmt"># WTF? public_instance_methods: default vs true vs false = 3 answers</span>
132:     <span class="ruby-comment cmt"># to_s on all results if ruby &gt;= 1.9</span>
133:     <span class="ruby-identifier">public_methods</span> = <span class="ruby-identifier">klass</span>.<span class="ruby-identifier">public_instance_methods</span>(<span class="ruby-keyword kw">false</span>)
134:     <span class="ruby-identifier">public_methods</span> <span class="ruby-operator">-=</span> <span class="ruby-constant">Kernel</span>.<span class="ruby-identifier">methods</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">full</span>
135:     <span class="ruby-identifier">public_methods</span>.<span class="ruby-identifier">map!</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">m</span><span class="ruby-operator">|</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">to_s</span> }
136:     <span class="ruby-identifier">public_methods</span> <span class="ruby-operator">-=</span> <span class="ruby-node">%w(pretty_print pretty_print_cycle)</span>
137: 
138:     <span class="ruby-identifier">klass_methods</span> = <span class="ruby-identifier">klass</span>.<span class="ruby-identifier">singleton_methods</span>(<span class="ruby-identifier">full</span>)
139:     <span class="ruby-identifier">klass_methods</span> <span class="ruby-operator">-=</span> <span class="ruby-constant">Class</span>.<span class="ruby-identifier">public_methods</span>(<span class="ruby-keyword kw">true</span>)
140:     <span class="ruby-identifier">klass_methods</span> = <span class="ruby-identifier">klass_methods</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">m</span><span class="ruby-operator">|</span> <span class="ruby-node">&quot;self.#{m}&quot;</span> }
141:     <span class="ruby-identifier">klass_methods</span>  <span class="ruby-operator">-=</span> <span class="ruby-node">%w(self.suite new)</span>
142: 
143:     <span class="ruby-identifier">result</span> = {}
144:     (<span class="ruby-identifier">public_methods</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">klass_methods</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">meth</span><span class="ruby-operator">|</span>
145:       <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;# found method #{meth}&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">$DEBUG</span>
146:       <span class="ruby-identifier">result</span>[<span class="ruby-identifier">meth</span>] = <span class="ruby-keyword kw">true</span>
147:     <span class="ruby-keyword kw">end</span>
148: 
149:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">result</span>
150:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000096">
                    
                    <a name="M000096"></a><b>is_test_class</b>(klass)
                    
                </div>
                
                <div class="description">
                  <p>
Check the class klass is a testing class (by inspecting its name).
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000096_source')" id="l_M000096_source">show</a>
                        
                    </p>
                    <div id="M000096_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/zentest.rb, line 181</span>
181:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">is_test_class</span>(<span class="ruby-identifier">klass</span>)
182:     <span class="ruby-identifier">klass</span> = <span class="ruby-identifier">klass</span>.<span class="ruby-identifier">to_s</span>
183:     <span class="ruby-identifier">klasspath</span> = <span class="ruby-identifier">klass</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp re">/::/</span>)
184:     <span class="ruby-identifier">a_bad_classpath</span> = <span class="ruby-identifier">klasspath</span>.<span class="ruby-identifier">find</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span> <span class="ruby-identifier">s</span> <span class="ruby-operator">!~</span> (<span class="ruby-identifier">$r</span> <span class="ruby-operator">?</span> <span class="ruby-regexp re">/Test$/</span> <span class="ruby-operator">:</span> <span class="ruby-regexp re">/^Test/</span>) <span class="ruby-keyword kw">end</span>
185:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">a_bad_classpath</span>.<span class="ruby-identifier">nil?</span>
186:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000089">
                    
                    <a name="M000089"></a><b>load_file</b>(file)
                    
                </div>
                
                <div class="description">
                  <p>
<a href="ZenTest.html#M000089">load_file</a> wraps require, skipping the
loading of $0.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000089_source')" id="l_M000089_source">show</a>
                        
                    </p>
                    <div id="M000089_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/zentest.rb, line 84</span>
84:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">load_file</span>(<span class="ruby-identifier">file</span>)
85:     <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;# loading #{file} // #{$0}&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">$DEBUG</span>
86: 
87:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">file</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">$0</span> <span class="ruby-keyword kw">then</span>
88:       <span class="ruby-keyword kw">begin</span>
89:         <span class="ruby-identifier">require</span> <span class="ruby-identifier">file</span>
90:       <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">LoadError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">err</span>
91:         <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Could not load #{file}: #{err}&quot;</span>
92:       <span class="ruby-keyword kw">end</span>
93:     <span class="ruby-keyword kw">else</span>
94:       <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;# Skipping loading myself (#{file})&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">$DEBUG</span>
95:     <span class="ruby-keyword kw">end</span>
96:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000102">
                    
                    <a name="M000102"></a><b>methods_and_tests</b>(klassname, testklassname)
                    
                </div>
                
                <div class="description">
                  <p>
looks up the methods and the corresponding test methods in the collection
already built. To reduce duplication and hide implementation details.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000102_source')" id="l_M000102_source">show</a>
                        
                    </p>
                    <div id="M000102_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/zentest.rb, line 336</span>
336:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">methods_and_tests</span>(<span class="ruby-identifier">klassname</span>, <span class="ruby-identifier">testklassname</span>)
337:     <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@klasses</span>[<span class="ruby-identifier">klassname</span>], <span class="ruby-ivar">@test_klasses</span>[<span class="ruby-identifier">testklassname</span>]
338:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000087">
                    
                    <a name="M000087"></a><b>missing_methods</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000087_source')" id="l_M000087_source">show</a>
                        
                    </p>
                    <div id="M000087_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/zentest.rb, line 70</span>
70:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">missing_methods</span>; <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;Something is wack&quot;</span>; <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000099">
                    
                    <a name="M000099"></a><b>process_class</b>(klassname, full=false)
                    
                </div>
                
                <div class="description">
                  <p>
Does all the work of finding a class by name, obtaining its methods and
those of its superclass. The full parameter determines if all the methods
including those of Object and mixed in modules are obtained (true if they
are, false by default).
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000099_source')" id="l_M000099_source">show</a>
                        
                    </p>
                    <div id="M000099_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/zentest.rb, line 216</span>
216:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">process_class</span>(<span class="ruby-identifier">klassname</span>, <span class="ruby-identifier">full</span>=<span class="ruby-keyword kw">false</span>)
217:     <span class="ruby-identifier">klass</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">get_class</span>(<span class="ruby-identifier">klassname</span>)
218:     <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Couldn't get class for #{klassname}&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">klass</span>.<span class="ruby-identifier">nil?</span>
219:     <span class="ruby-identifier">klassname</span> = <span class="ruby-identifier">klass</span>.<span class="ruby-identifier">name</span> <span class="ruby-comment cmt"># refetch to get full name</span>
220: 
221:     <span class="ruby-identifier">is_test_class</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">is_test_class</span>(<span class="ruby-identifier">klassname</span>)
222:     <span class="ruby-identifier">target</span> = <span class="ruby-identifier">is_test_class</span> <span class="ruby-value">? </span><span class="ruby-ivar">@test_klasses</span> <span class="ruby-operator">:</span> <span class="ruby-ivar">@klasses</span>
223: 
224:     <span class="ruby-comment cmt"># record public instance methods JUST in this class</span>
225:     <span class="ruby-identifier">target</span>[<span class="ruby-identifier">klassname</span>] = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">get_methods_for</span>(<span class="ruby-identifier">klass</span>, <span class="ruby-identifier">full</span>)
226: 
227:     <span class="ruby-comment cmt"># record ALL instance methods including superclasses (minus Object)</span>
228:     <span class="ruby-comment cmt"># Only minus Object if full is true.</span>
229:     <span class="ruby-ivar">@inherited_methods</span>[<span class="ruby-identifier">klassname</span>] = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">get_inherited_methods_for</span>(<span class="ruby-identifier">klass</span>, <span class="ruby-identifier">full</span>)
230:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">klassname</span>
231:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000108">
                    
                    <a name="M000108"></a><b>result</b>()
                    
                </div>
                
                <div class="description">
                  <p>
presents results in a readable manner.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000108_source')" id="l_M000108_source">show</a>
                        
                    </p>
                    <div id="M000108_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/zentest.rb, line 514</span>
514:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">result</span>
515:     <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@result</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;\n&quot;</span>)
516:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000100">
                    
                    <a name="M000100"></a><b>scan_files</b>(*files)
                    
                </div>
                
                <div class="description">
                  <p>
Work through files, collecting class names, method names and assertions.
Detects <a href="ZenTest.html">ZenTest</a> (SKIP|FULL) comments in the
bodies of classes. For each class a count of methods and test methods is
kept, and the ratio noted.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000100_source')" id="l_M000100_source">show</a>
                        
                    </p>
                    <div id="M000100_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/zentest.rb, line 238</span>
238:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">scan_files</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">files</span>)
239:     <span class="ruby-identifier">assert_count</span> = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">0</span>)
240:     <span class="ruby-identifier">method_count</span> = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">0</span>)
241:     <span class="ruby-identifier">klassname</span> = <span class="ruby-keyword kw">nil</span>
242: 
243:     <span class="ruby-identifier">files</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">path</span><span class="ruby-operator">|</span>
244:       <span class="ruby-identifier">is_loaded</span> = <span class="ruby-keyword kw">false</span>
245: 
246:       <span class="ruby-comment cmt"># if reading stdin, slurp the whole thing at once</span>
247:       <span class="ruby-identifier">file</span> = (<span class="ruby-identifier">path</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;-&quot;</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">$stdin</span>.<span class="ruby-identifier">read</span> <span class="ruby-operator">:</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">path</span>))
248: 
249:       <span class="ruby-identifier">file</span>.<span class="ruby-identifier">each_line</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">line</span><span class="ruby-operator">|</span>
250: 
251:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">klassname</span> <span class="ruby-keyword kw">then</span>
252:           <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">line</span>
253:           <span class="ruby-keyword kw">when</span> <span class="ruby-regexp re">/^\s*def/</span> <span class="ruby-keyword kw">then</span>
254:             <span class="ruby-identifier">method_count</span>[<span class="ruby-identifier">klassname</span>] <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
255:           <span class="ruby-keyword kw">when</span> <span class="ruby-regexp re">/assert|flunk/</span> <span class="ruby-keyword kw">then</span>
256:             <span class="ruby-identifier">assert_count</span>[<span class="ruby-identifier">klassname</span>] <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
257:           <span class="ruby-keyword kw">end</span>
258:         <span class="ruby-keyword kw">end</span>
259: 
260:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">line</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/^\s*(?:class|module)\s+([\w:]+)/</span> <span class="ruby-keyword kw">then</span>
261:           <span class="ruby-identifier">klassname</span> = <span class="ruby-identifier">$1</span>
262: 
263:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">line</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/\#\s*ZenTest SKIP/</span> <span class="ruby-keyword kw">then</span>
264:             <span class="ruby-identifier">klassname</span> = <span class="ruby-keyword kw">nil</span>
265:             <span class="ruby-keyword kw">next</span>
266:           <span class="ruby-keyword kw">end</span>
267: 
268:           <span class="ruby-identifier">full</span> = <span class="ruby-keyword kw">false</span>
269:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">line</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/\#\s*ZenTest FULL/</span> <span class="ruby-keyword kw">then</span>
270:             <span class="ruby-identifier">full</span> = <span class="ruby-keyword kw">true</span>
271:           <span class="ruby-keyword kw">end</span>
272: 
273:           <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">is_loaded</span> <span class="ruby-keyword kw">then</span>
274:             <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">path</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;-&quot;</span> <span class="ruby-keyword kw">then</span>
275:               <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">load_file</span>(<span class="ruby-identifier">path</span>)
276:             <span class="ruby-keyword kw">else</span>
277:               <span class="ruby-identifier">eval</span> <span class="ruby-identifier">file</span>, <span class="ruby-constant">TOPLEVEL_BINDING</span>
278:             <span class="ruby-keyword kw">end</span>
279:             <span class="ruby-identifier">is_loaded</span> = <span class="ruby-keyword kw">true</span>
280:           <span class="ruby-keyword kw">end</span>
281: 
282:           <span class="ruby-keyword kw">begin</span>
283:             <span class="ruby-identifier">klassname</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">process_class</span>(<span class="ruby-identifier">klassname</span>, <span class="ruby-identifier">full</span>)
284:           <span class="ruby-keyword kw">rescue</span>
285:             <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;# Couldn't find class for name #{klassname}&quot;</span>
286:             <span class="ruby-keyword kw">next</span>
287:           <span class="ruby-keyword kw">end</span>
288: 
289:           <span class="ruby-comment cmt"># Special Case: ZenTest is already loaded since we are running it</span>
290:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">klassname</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;TestZenTest&quot;</span> <span class="ruby-keyword kw">then</span>
291:             <span class="ruby-identifier">klassname</span> = <span class="ruby-value str">&quot;ZenTest&quot;</span>
292:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">process_class</span>(<span class="ruby-identifier">klassname</span>, <span class="ruby-keyword kw">false</span>)
293:           <span class="ruby-keyword kw">end</span>
294: 
295:         <span class="ruby-keyword kw">end</span> <span class="ruby-comment cmt"># if /class/</span>
296:       <span class="ruby-keyword kw">end</span> <span class="ruby-comment cmt"># IO.foreach</span>
297:     <span class="ruby-keyword kw">end</span> <span class="ruby-comment cmt"># files</span>
298: 
299:     <span class="ruby-identifier">result</span> = []
300:     <span class="ruby-identifier">method_count</span>.<span class="ruby-identifier">each_key</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">classname</span><span class="ruby-operator">|</span>
301: 
302:       <span class="ruby-identifier">entry</span> = {}
303: 
304:       <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">is_test_class</span>(<span class="ruby-identifier">classname</span>)
305:       <span class="ruby-identifier">testclassname</span> = <span class="ruby-identifier">convert_class_name</span>(<span class="ruby-identifier">classname</span>)
306:       <span class="ruby-identifier">a_count</span> = <span class="ruby-identifier">assert_count</span>[<span class="ruby-identifier">testclassname</span>]
307:       <span class="ruby-identifier">m_count</span> = <span class="ruby-identifier">method_count</span>[<span class="ruby-identifier">classname</span>]
308:       <span class="ruby-identifier">ratio</span> = <span class="ruby-identifier">a_count</span>.<span class="ruby-identifier">to_f</span> <span class="ruby-operator">/</span> <span class="ruby-identifier">m_count</span>.<span class="ruby-identifier">to_f</span> <span class="ruby-operator">*</span> <span class="ruby-value">100.0</span>
309: 
310:       <span class="ruby-identifier">entry</span>[<span class="ruby-value str">'n'</span>] = <span class="ruby-identifier">classname</span>
311:       <span class="ruby-identifier">entry</span>[<span class="ruby-value str">'r'</span>] = <span class="ruby-identifier">ratio</span>
312:       <span class="ruby-identifier">entry</span>[<span class="ruby-value str">'a'</span>] = <span class="ruby-identifier">a_count</span>
313:       <span class="ruby-identifier">entry</span>[<span class="ruby-value str">'m'</span>] = <span class="ruby-identifier">m_count</span>
314: 
315:       <span class="ruby-identifier">result</span>.<span class="ruby-identifier">push</span> <span class="ruby-identifier">entry</span>
316:     <span class="ruby-keyword kw">end</span>
317: 
318:     <span class="ruby-identifier">sorted_results</span> = <span class="ruby-identifier">result</span>.<span class="ruby-identifier">sort</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">a</span>,<span class="ruby-identifier">b</span><span class="ruby-operator">|</span> <span class="ruby-identifier">b</span>[<span class="ruby-value str">'r'</span>] <span class="ruby-operator">&lt;=&gt;</span> <span class="ruby-identifier">a</span>[<span class="ruby-value str">'r'</span>] }
319: 
320:     <span class="ruby-ivar">@result</span>.<span class="ruby-identifier">push</span> <span class="ruby-identifier">sprintf</span>(<span class="ruby-value str">&quot;# %25s: %4s / %4s = %6s%%&quot;</span>, <span class="ruby-value str">&quot;classname&quot;</span>, <span class="ruby-value str">&quot;asrt&quot;</span>, <span class="ruby-value str">&quot;meth&quot;</span>, <span class="ruby-value str">&quot;ratio&quot;</span>)
321:     <span class="ruby-identifier">sorted_results</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">e</span><span class="ruby-operator">|</span>
322:       <span class="ruby-ivar">@result</span>.<span class="ruby-identifier">push</span> <span class="ruby-identifier">sprintf</span>(<span class="ruby-value str">&quot;# %25s: %4d / %4d = %6.2f%%&quot;</span>, <span class="ruby-identifier">e</span>[<span class="ruby-value str">'n'</span>], <span class="ruby-identifier">e</span>[<span class="ruby-value str">'a'</span>], <span class="ruby-identifier">e</span>[<span class="ruby-value str">'m'</span>], <span class="ruby-identifier">e</span>[<span class="ruby-value str">'r'</span>])
323:     <span class="ruby-keyword kw">end</span>
324:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    