<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>Multiruby</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen" />
    <script src="../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Module</span> 
            Multiruby 
            
        </h1>
        <ul class="files">
            
            <li><a href="../files/lib/multiruby_rb.html">lib/multiruby.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    
    <div class="description">
        <p>
multiruby_setup is a script to help you manage multiruby.
</p>
<p>
usage: multiruby_setup [-h|cmd|spec...]
</p>
<pre>
  cmds:

    -h, --help, help = show this help.
    build            = build and install everything. used internally.
    clean            = clean scm build dirs and remove non-scm build dirs.
    list             = print installed versions.
    rm:$version      = remove a particular version.
    rubygems:merge   = symlink all rubygem dirs to one dir.
    tags             = list all tags from svn.
    update           = update svn builds.
    update:rubygems  = update rubygems and nuke install dirs.

  specs:

    the_usual              = alias for latest versions from tar + rubygems
    mri:svn:current        = alias for mri:svn:releases and mri:svn:branches.
    mri:svn:releases       = alias for supported releases of mri ruby.
    mri:svn:branches       = alias for active branches of mri ruby.
    mri:svn:branch:$branch = install a specific $branch of mri from svn.
    mri:svn:tag:$tag       = install a specific $tag of mri from svn.
    mri:tar:$version       = install a specific $version of mri from tarball.

  environment variables:

    GEM_URL  = url for rubygems tarballs
    MRI_SVN  = url for MRI SVN
    RUBY_URL = url for MRI tarballs
    VERSIONS = what versions to install

    RUBYOPT is cleared on installs.
</pre>
<p>
NOTES:
</p>
<ul>
<li>you can add a symlink to your rubinius build into ~/.multiruby/install

</li>
<li>I need patches/maintainers for other implementations.

</li>
</ul>

    </div>
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>B</dt>
        <dd>
            <ul>
                
                <li><a href="#M000024">build_and_install</a></li>
                
            </ul>
        </dd>
    
        <dt>C</dt>
        <dd>
            <ul>
                
                <li><a href="#M000026">clean</a></li>
                
            </ul>
        </dd>
    
        <dt>E</dt>
        <dd>
            <ul>
                
                <li><a href="#M000027">each_scm_build_dir</a>,</li>
                
                <li><a href="#M000023">env</a></li>
                
            </ul>
        </dd>
    
        <dt>F</dt>
        <dd>
            <ul>
                
                <li><a href="#M000031">fetch_tar</a></li>
                
            </ul>
        </dd>
    
        <dt>G</dt>
        <dd>
            <ul>
                
                <li><a href="#M000033">gnu_utils_build</a></li>
                
            </ul>
        </dd>
    
        <dt>H</dt>
        <dd>
            <ul>
                
                <li><a href="#M000034">help</a></li>
                
            </ul>
        </dd>
    
        <dt>I</dt>
        <dd>
            <ul>
                
                <li><a href="#M000035">in_build_dir</a>,</li>
                
                <li><a href="#M000036">in_install_dir</a>,</li>
                
                <li><a href="#M000038">in_root_dir</a>,</li>
                
                <li><a href="#M000039">in_tmp_dir</a>,</li>
                
                <li><a href="#M000040">in_versions_dir</a></li>
                
            </ul>
        </dd>
    
        <dt>L</dt>
        <dd>
            <ul>
                
                <li><a href="#M000041">list</a></li>
                
            </ul>
        </dd>
    
        <dt>M</dt>
        <dd>
            <ul>
                
                <li><a href="#M000028">matching_versions</a>,</li>
                
                <li><a href="#M000043">merge_rubygems</a>,</li>
                
                <li><a href="#M000046">mri_latest_tag</a></li>
                
            </ul>
        </dd>
    
        <dt>R</dt>
        <dd>
            <ul>
                
                <li><a href="#M000048">rake_build</a>,</li>
                
                <li><a href="#M000049">rm</a>,</li>
                
                <li><a href="#M000050">root_dir</a>,</li>
                
                <li><a href="#M000052">run</a></li>
                
            </ul>
        </dd>
    
        <dt>S</dt>
        <dd>
            <ul>
                
                <li><a href="#M000053">setup_dirs</a>,</li>
                
                <li><a href="#M000055">svn_co</a></li>
                
            </ul>
        </dd>
    
        <dt>T</dt>
        <dd>
            <ul>
                
                <li><a href="#M000056">tags</a></li>
                
            </ul>
        </dd>
    
        <dt>U</dt>
        <dd>
            <ul>
                
                <li><a href="#M000059">update</a>,</li>
                
                <li><a href="#M000062">update_rubygems</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    

    

    

    
    <div class="sectiontitle">Constants</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class="attr-name">TAGS</td>
            <td>=</td>
            <td class="attr-value">%w(    1_8_7 1_9_1 1_9_2)</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">BRANCHES</td>
            <td>=</td>
            <td class="attr-value">%w(1_8 1_8_7 1_9 trunk)</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">VERSIONS</td>
            <td>=</td>
            <td class="attr-value">env('VERSIONS', TAGS.join(&quot;:&quot;).gsub(/_/, '.')).split(/:/)</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">MRI_SVN</td>
            <td>=</td>
            <td class="attr-value">env 'MRI_SVN',  'http://svn.ruby-lang.org/repos/ruby'</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">RUBY_URL</td>
            <td>=</td>
            <td class="attr-value">env 'RUBY_URL', 'http://ftp.ruby-lang.org/pub/ruby'</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">GEM_URL</td>
            <td>=</td>
            <td class="attr-value">env 'GEM_URL',  'http://files.rubyforge.vm.bytemark.co.uk/rubygems'</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">HELP</td>
            <td>=</td>
            <td class="attr-value">[]</td>
        </tr>
        
        
    </table>
    

    

    
            <div class="sectiontitle">Class Public methods</div>
            
            <div class="method">
                <div class="title" id="M000024">
                    
                    <a name="M000024"></a><b>build_and_install</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000024_source')" id="l_M000024_source">show</a>
                        
                    </p>
                    <div id="M000024_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/multiruby.rb, line 63</span>
 63:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">build_and_install</span>
 64:     <span class="ruby-constant">ENV</span>.<span class="ruby-identifier">delete</span> <span class="ruby-value str">'RUBYOPT'</span>
 65: 
 66:     <span class="ruby-identifier">root_dir</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">root_dir</span>
 67:     <span class="ruby-identifier">versions</span> = []
 68: 
 69:     <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">chdir</span> <span class="ruby-identifier">root_dir</span> <span class="ruby-keyword kw">do</span>
 70:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">setup_dirs</span>
 71: 
 72:       <span class="ruby-identifier">rubygems</span> = <span class="ruby-constant">Dir</span>[<span class="ruby-value str">&quot;versions/rubygems*.tgz&quot;</span>]
 73:       <span class="ruby-identifier">abort</span> <span class="ruby-value str">&quot;You should delete all but one rubygem tarball&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">rubygems</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>
 74:       <span class="ruby-identifier">rubygem_tarball</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span> <span class="ruby-identifier">rubygems</span>.<span class="ruby-identifier">last</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
 75: 
 76:       <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">chdir</span> <span class="ruby-value str">&quot;build&quot;</span> <span class="ruby-keyword kw">do</span>
 77:         <span class="ruby-constant">Dir</span>[<span class="ruby-value str">&quot;../versions/*&quot;</span>].<span class="ruby-identifier">sort</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">tarball</span><span class="ruby-operator">|</span>
 78:           <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">tarball</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/rubygems/</span>
 79: 
 80:           <span class="ruby-identifier">build_dir</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">basename</span> <span class="ruby-identifier">tarball</span>, <span class="ruby-value str">&quot;.tar.gz&quot;</span>
 81:           <span class="ruby-identifier">version</span> = <span class="ruby-identifier">build_dir</span>.<span class="ruby-identifier">sub</span>(<span class="ruby-regexp re">/^ruby-?/</span>, <span class="ruby-value str">''</span>)
 82:           <span class="ruby-identifier">versions</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">version</span>
 83:           <span class="ruby-identifier">inst_dir</span> = <span class="ruby-node">&quot;#{root_dir}/install/#{version}&quot;</span>
 84: 
 85:           <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">test</span> <span class="ruby-operator">?</span><span class="ruby-identifier">d</span>, <span class="ruby-identifier">inst_dir</span> <span class="ruby-keyword kw">then</span>
 86:             <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">test</span> <span class="ruby-operator">?</span><span class="ruby-identifier">d</span>, <span class="ruby-identifier">build_dir</span> <span class="ruby-keyword kw">then</span>
 87:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">test</span> <span class="ruby-operator">?</span><span class="ruby-identifier">d</span>, <span class="ruby-identifier">tarball</span> <span class="ruby-keyword kw">then</span>
 88:                 <span class="ruby-identifier">dir</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">basename</span> <span class="ruby-identifier">tarball</span>
 89:                 <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">ln_sf</span> <span class="ruby-node">&quot;../versions/#{dir}&quot;</span>, <span class="ruby-node">&quot;../build/#{dir}&quot;</span>
 90:               <span class="ruby-keyword kw">else</span>
 91:                 <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;creating #{inst_dir}&quot;</span>
 92:                 <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">mkdir</span> <span class="ruby-identifier">inst_dir</span>
 93:                 <span class="ruby-identifier">run</span> <span class="ruby-node">&quot;tar zxf #{tarball}&quot;</span>
 94:               <span class="ruby-keyword kw">end</span>
 95:             <span class="ruby-keyword kw">end</span>
 96:             <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">chdir</span> <span class="ruby-identifier">build_dir</span> <span class="ruby-keyword kw">do</span>
 97:               <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;building and installing #{version}&quot;</span>
 98:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">test</span> <span class="ruby-operator">?</span><span class="ruby-identifier">f</span>, <span class="ruby-value str">&quot;configure.in&quot;</span> <span class="ruby-keyword kw">then</span>
 99:                 <span class="ruby-identifier">gnu_utils_build</span> <span class="ruby-identifier">inst_dir</span>
100:               <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">test</span> <span class="ruby-operator">?</span><span class="ruby-identifier">f</span>, <span class="ruby-value str">&quot;Rakefile&quot;</span> <span class="ruby-keyword kw">then</span>
101:                 <span class="ruby-identifier">rake_build</span> <span class="ruby-identifier">inst_dir</span>
102:               <span class="ruby-keyword kw">else</span>
103:                 <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;dunno how to build&quot;</span>
104:               <span class="ruby-keyword kw">end</span>
105: 
106:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">rubygem_tarball</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">version</span> <span class="ruby-operator">!~</span> <span class="ruby-regexp re">/1[._-]9|mri_trunk|rubinius/</span> <span class="ruby-keyword kw">then</span>
107:                 <span class="ruby-identifier">rubygems</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">basename</span> <span class="ruby-identifier">rubygem_tarball</span>, <span class="ruby-value str">&quot;.tgz&quot;</span>
108:                 <span class="ruby-identifier">run</span> <span class="ruby-node">&quot;tar zxf #{rubygem_tarball}&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">test</span> <span class="ruby-operator">?</span><span class="ruby-identifier">d</span>, <span class="ruby-identifier">rubygems</span>
109: 
110:                 <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">chdir</span> <span class="ruby-identifier">rubygems</span> <span class="ruby-keyword kw">do</span>
111:                   <span class="ruby-identifier">run</span> <span class="ruby-value str">&quot;../ruby ./setup.rb --no-rdoc --no-ri&quot;</span>, <span class="ruby-value str">&quot;../log.rubygems&quot;</span>
112:                 <span class="ruby-keyword kw">end</span>
113:               <span class="ruby-keyword kw">end</span>
114:             <span class="ruby-keyword kw">end</span>
115:           <span class="ruby-keyword kw">end</span>
116:         <span class="ruby-keyword kw">end</span>
117:       <span class="ruby-keyword kw">end</span>
118:     <span class="ruby-keyword kw">end</span>
119: 
120:     <span class="ruby-identifier">versions</span>
121:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000026">
                    
                    <a name="M000026"></a><b>clean</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000026_source')" id="l_M000026_source">show</a>
                        
                    </p>
                    <div id="M000026_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/multiruby.rb, line 123</span>
123:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">clean</span>
124:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">each_scm_build_dir</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">style</span><span class="ruby-operator">|</span>
125:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">style</span>
126:       <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:svn</span> <span class="ruby-keyword kw">then</span>
127:         <span class="ruby-keyword kw">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span> <span class="ruby-value str">&quot;Rakefile&quot;</span> <span class="ruby-keyword kw">then</span>
128:           <span class="ruby-identifier">run</span> <span class="ruby-value str">&quot;rake clean&quot;</span>
129:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span> <span class="ruby-value str">&quot;Makefile&quot;</span> <span class="ruby-keyword kw">then</span>
130:           <span class="ruby-identifier">run</span> <span class="ruby-value str">&quot;make clean&quot;</span>
131:         <span class="ruby-keyword kw">end</span>
132:       <span class="ruby-keyword kw">else</span>
133:         <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm_rf</span> <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">pwd</span>
134:       <span class="ruby-keyword kw">end</span>
135:     <span class="ruby-keyword kw">end</span>
136:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000027">
                    
                    <a name="M000027"></a><b>each_scm_build_dir</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000027_source')" id="l_M000027_source">show</a>
                        
                    </p>
                    <div id="M000027_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/multiruby.rb, line 138</span>
138:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">each_scm_build_dir</span>
139:     <span class="ruby-constant">Multiruby</span>.<span class="ruby-identifier">in_build_dir</span> <span class="ruby-keyword kw">do</span>
140:       <span class="ruby-constant">Dir</span>[<span class="ruby-value str">&quot;*&quot;</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">dir</span><span class="ruby-operator">|</span>
141:         <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">directory?</span> <span class="ruby-identifier">dir</span>
142:         <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">chdir</span> <span class="ruby-identifier">dir</span> <span class="ruby-keyword kw">do</span>
143:           <span class="ruby-keyword kw">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-value str">&quot;.svn&quot;</span>) <span class="ruby-keyword kw">then</span>
144:             <span class="ruby-keyword kw">yield</span> <span class="ruby-operator">:</span><span class="ruby-identifier">svn</span>
145:           <span class="ruby-keyword kw">else</span>
146:             <span class="ruby-keyword kw">yield</span> <span class="ruby-operator">:</span><span class="ruby-identifier">none</span>
147:           <span class="ruby-keyword kw">end</span>
148:         <span class="ruby-keyword kw">end</span>
149:       <span class="ruby-keyword kw">end</span>
150:     <span class="ruby-keyword kw">end</span>
151:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000023">
                    
                    <a name="M000023"></a><b>env</b>(name, fallback;)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000023_source')" id="l_M000023_source">show</a>
                        
                    </p>
                    <div id="M000023_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/multiruby.rb, line 46</span>
46:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">env</span> <span class="ruby-identifier">name</span>, <span class="ruby-identifier">fallback</span>; <span class="ruby-constant">ENV</span>[<span class="ruby-identifier">name</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">fallback</span>; <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000031">
                    
                    <a name="M000031"></a><b>fetch_tar</b>(v)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000031_source')" id="l_M000031_source">show</a>
                        
                    </p>
                    <div id="M000031_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/multiruby.rb, line 173</span>
173:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">fetch_tar</span> <span class="ruby-identifier">v</span>
174:     <span class="ruby-identifier">in_versions_dir</span> <span class="ruby-keyword kw">do</span>
175:       <span class="ruby-identifier">warn</span> <span class="ruby-node">&quot;  Determining latest version for #{v}&quot;</span>
176:       <span class="ruby-identifier">ver</span> = <span class="ruby-identifier">v</span>[<span class="ruby-regexp re">/\d+\.\d+/</span>]
177:       <span class="ruby-identifier">base</span> = <span class="ruby-identifier">matching_versions</span>(<span class="ruby-node">&quot;#{RUBY_URL}/#{ver}/&quot;</span>, <span class="ruby-identifier">v</span>).<span class="ruby-identifier">last</span>
178:       <span class="ruby-identifier">abort</span> <span class="ruby-node">&quot;Could not determine release for #{v}&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">base</span>
179:       <span class="ruby-identifier">url</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span> <span class="ruby-constant">RUBY_URL</span>, <span class="ruby-identifier">ver</span>, <span class="ruby-identifier">base</span>
180:       <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">file?</span> <span class="ruby-identifier">base</span> <span class="ruby-keyword kw">then</span>
181:         <span class="ruby-identifier">warn</span> <span class="ruby-node">&quot;    Fetching #{base} via HTTP... this might take a while.&quot;</span>
182:         <span class="ruby-identifier">open</span>(<span class="ruby-identifier">url</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span>
183:           <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span> <span class="ruby-identifier">base</span>, <span class="ruby-value str">'w'</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">out</span><span class="ruby-operator">|</span>
184:             <span class="ruby-identifier">out</span>.<span class="ruby-identifier">write</span> <span class="ruby-identifier">f</span>.<span class="ruby-identifier">read</span>
185:           <span class="ruby-keyword kw">end</span>
186:         <span class="ruby-keyword kw">end</span>
187:       <span class="ruby-keyword kw">end</span>
188:     <span class="ruby-keyword kw">end</span>
189:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000033">
                    
                    <a name="M000033"></a><b>gnu_utils_build</b>(inst_dir)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000033_source')" id="l_M000033_source">show</a>
                        
                    </p>
                    <div id="M000033_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/multiruby.rb, line 191</span>
191:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">gnu_utils_build</span> <span class="ruby-identifier">inst_dir</span>
192:     <span class="ruby-identifier">run</span> <span class="ruby-value str">&quot;autoconf&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">test</span> <span class="ruby-operator">?</span><span class="ruby-identifier">f</span>, <span class="ruby-value str">&quot;configure&quot;</span>
193:     <span class="ruby-identifier">run</span> <span class="ruby-node">&quot;./configure --enable-shared --prefix #{inst_dir}&quot;</span>, <span class="ruby-value str">&quot;log.configure&quot;</span> <span class="ruby-keyword kw">unless</span>
194:       <span class="ruby-identifier">test</span> <span class="ruby-operator">?</span><span class="ruby-identifier">f</span>, <span class="ruby-value str">&quot;Makefile&quot;</span>
195:     <span class="ruby-identifier">run</span> <span class="ruby-value str">&quot;(nice make -j4; nice make)&quot;</span>, <span class="ruby-value str">&quot;log.build&quot;</span>
196:     <span class="ruby-identifier">run</span> <span class="ruby-value str">&quot;make install&quot;</span>, <span class="ruby-value str">&quot;log.install&quot;</span>
197:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000034">
                    
                    <a name="M000034"></a><b>help</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000034_source')" id="l_M000034_source">show</a>
                        
                    </p>
                    <div id="M000034_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/multiruby.rb, line 199</span>
199:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">help</span>
200:     <span class="ruby-identifier">puts</span> <span class="ruby-constant">HELP</span>.<span class="ruby-identifier">join</span>
201:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000035">
                    
                    <a name="M000035"></a><b>in_build_dir</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000035_source')" id="l_M000035_source">show</a>
                        
                    </p>
                    <div id="M000035_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/multiruby.rb, line 203</span>
203:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">in_build_dir</span>
204:     <span class="ruby-identifier">in_root_dir</span> <span class="ruby-value str">&quot;build&quot;</span> <span class="ruby-keyword kw">do</span>
205:       <span class="ruby-keyword kw">yield</span>
206:     <span class="ruby-keyword kw">end</span>
207:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000036">
                    
                    <a name="M000036"></a><b>in_install_dir</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000036_source')" id="l_M000036_source">show</a>
                        
                    </p>
                    <div id="M000036_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/multiruby.rb, line 209</span>
209:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">in_install_dir</span>
210:     <span class="ruby-identifier">in_root_dir</span> <span class="ruby-value str">&quot;install&quot;</span> <span class="ruby-keyword kw">do</span>
211:       <span class="ruby-keyword kw">yield</span>
212:     <span class="ruby-keyword kw">end</span>
213:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000038">
                    
                    <a name="M000038"></a><b>in_root_dir</b>(subdir = &quot;&quot;)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000038_source')" id="l_M000038_source">show</a>
                        
                    </p>
                    <div id="M000038_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/multiruby.rb, line 215</span>
215:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">in_root_dir</span> <span class="ruby-identifier">subdir</span> = <span class="ruby-value str">&quot;&quot;</span>
216:     <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">chdir</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">root_dir</span>, <span class="ruby-identifier">subdir</span>) <span class="ruby-keyword kw">do</span>
217:       <span class="ruby-keyword kw">yield</span>
218:     <span class="ruby-keyword kw">end</span>
219:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000039">
                    
                    <a name="M000039"></a><b>in_tmp_dir</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000039_source')" id="l_M000039_source">show</a>
                        
                    </p>
                    <div id="M000039_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/multiruby.rb, line 221</span>
221:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">in_tmp_dir</span>
222:     <span class="ruby-identifier">in_root_dir</span> <span class="ruby-value str">&quot;tmp&quot;</span> <span class="ruby-keyword kw">do</span>
223:       <span class="ruby-keyword kw">yield</span>
224:     <span class="ruby-keyword kw">end</span>
225:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000040">
                    
                    <a name="M000040"></a><b>in_versions_dir</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000040_source')" id="l_M000040_source">show</a>
                        
                    </p>
                    <div id="M000040_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/multiruby.rb, line 227</span>
227:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">in_versions_dir</span>
228:     <span class="ruby-identifier">in_root_dir</span> <span class="ruby-value str">&quot;versions&quot;</span> <span class="ruby-keyword kw">do</span>
229:       <span class="ruby-keyword kw">yield</span>
230:     <span class="ruby-keyword kw">end</span>
231:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000041">
                    
                    <a name="M000041"></a><b>list</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000041_source')" id="l_M000041_source">show</a>
                        
                    </p>
                    <div id="M000041_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/multiruby.rb, line 233</span>
233:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">list</span>
234:     <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;Known versions:&quot;</span>
235:     <span class="ruby-identifier">in_install_dir</span> <span class="ruby-keyword kw">do</span>
236:       <span class="ruby-constant">Dir</span>[<span class="ruby-value str">&quot;*&quot;</span>].<span class="ruby-identifier">sort</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">d</span><span class="ruby-operator">|</span>
237:         <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;  #{d}&quot;</span>
238:       <span class="ruby-keyword kw">end</span>
239:     <span class="ruby-keyword kw">end</span>
240:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000028">
                    
                    <a name="M000028"></a><b>matching_versions</b>(url, matching=nil)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000028_source')" id="l_M000028_source">show</a>
                        
                    </p>
                    <div id="M000028_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/multiruby.rb, line 153</span>
153:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">matching_versions</span> <span class="ruby-identifier">url</span>, <span class="ruby-identifier">matching</span>=<span class="ruby-keyword kw">nil</span>
154:     <span class="ruby-identifier">file</span> = <span class="ruby-constant">URI</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">url</span>).<span class="ruby-identifier">read</span>
155: 
156:     <span class="ruby-identifier">map</span> = {
157:       <span class="ruby-value str">&quot;preview&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;beta&quot;</span>,
158:       <span class="ruby-value str">&quot;rc&quot;</span>      =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;beta2&quot;</span>,
159:       <span class="ruby-value str">&quot;p&quot;</span>       =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;release&quot;</span>,
160:       <span class="ruby-value str">&quot;tar&quot;</span>     =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;aargh&quot;</span>,
161:       <span class="ruby-value str">&quot;gz&quot;</span>      =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;aargh&quot;</span>,
162:     }
163: 
164:     <span class="ruby-identifier">versions</span> = <span class="ruby-identifier">file</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/href=&quot;(ruby.*tar.gz)&quot;/</span>).<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">sort_by</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
165:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\d+|[a-z]+/</span>).<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span> <span class="ruby-constant">Integer</span>(<span class="ruby-identifier">a</span>) <span class="ruby-keyword kw">rescue</span> <span class="ruby-identifier">map</span>[<span class="ruby-identifier">a</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">a</span> }
166:     }
167: 
168:     <span class="ruby-identifier">versions</span> = <span class="ruby-identifier">versions</span>.<span class="ruby-identifier">grep</span>(<span class="ruby-node">/#{Regexp.escape(matching)}/</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">matching</span>
169: 
170:     <span class="ruby-identifier">versions</span>
171:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000043">
                    
                    <a name="M000043"></a><b>merge_rubygems</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000043_source')" id="l_M000043_source">show</a>
                        
                    </p>
                    <div id="M000043_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/multiruby.rb, line 242</span>
242:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">merge_rubygems</span>
243:     <span class="ruby-identifier">in_install_dir</span> <span class="ruby-keyword kw">do</span>
244:       <span class="ruby-identifier">gems</span> = <span class="ruby-constant">Dir</span>[<span class="ruby-value str">&quot;*/lib/ruby/gems&quot;</span>]
245: 
246:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">test</span> <span class="ruby-operator">?</span><span class="ruby-identifier">d</span>, <span class="ruby-value str">&quot;../gems&quot;</span> <span class="ruby-keyword kw">then</span>
247:         <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mv</span> <span class="ruby-identifier">gems</span>.<span class="ruby-identifier">first</span>, <span class="ruby-value str">&quot;..&quot;</span>
248:       <span class="ruby-keyword kw">end</span>
249: 
250:       <span class="ruby-identifier">gems</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">d</span><span class="ruby-operator">|</span>
251:         <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm_rf</span> <span class="ruby-identifier">d</span>
252:         <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">ln_sf</span> <span class="ruby-value str">&quot;../../../../gems&quot;</span>, <span class="ruby-identifier">d</span>
253:       <span class="ruby-keyword kw">end</span>
254:     <span class="ruby-keyword kw">end</span>
255:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000046">
                    
                    <a name="M000046"></a><b>mri_latest_tag</b>(v)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000046_source')" id="l_M000046_source">show</a>
                        
                    </p>
                    <div id="M000046_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/multiruby.rb, line 257</span>
257:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">mri_latest_tag</span> <span class="ruby-identifier">v</span>
258:     <span class="ruby-constant">Multiruby</span>.<span class="ruby-identifier">tags</span>.<span class="ruby-identifier">grep</span>(<span class="ruby-node">/#{v}/</span>).<span class="ruby-identifier">last</span>
259:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000048">
                    
                    <a name="M000048"></a><b>rake_build</b>(inst_dir)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000048_source')" id="l_M000048_source">show</a>
                        
                    </p>
                    <div id="M000048_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/multiruby.rb, line 261</span>
261:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">rake_build</span> <span class="ruby-identifier">inst_dir</span>
262:     <span class="ruby-identifier">run</span> <span class="ruby-value str">&quot;rake&quot;</span>, <span class="ruby-value str">&quot;log.build&quot;</span>
263:     <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">ln_sf</span> <span class="ruby-node">&quot;../build/#{File.basename Dir.pwd}&quot;</span>, <span class="ruby-identifier">inst_dir</span>
264:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000049">
                    
                    <a name="M000049"></a><b>rm</b>(name)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000049_source')" id="l_M000049_source">show</a>
                        
                    </p>
                    <div id="M000049_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/multiruby.rb, line 266</span>
266:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">rm</span> <span class="ruby-identifier">name</span>
267:     <span class="ruby-constant">Multiruby</span>.<span class="ruby-identifier">in_root_dir</span> <span class="ruby-keyword kw">do</span>
268:       <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm_rf</span> <span class="ruby-constant">Dir</span>[<span class="ruby-node">&quot;*/#{name}&quot;</span>]
269:       <span class="ruby-identifier">f</span> = <span class="ruby-node">&quot;versions/ruby-#{name}.tar.gz&quot;</span>
270:       <span class="ruby-constant">File</span>.<span class="ruby-identifier">unlink</span> <span class="ruby-identifier">f</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">test</span> <span class="ruby-operator">?</span><span class="ruby-identifier">f</span>, <span class="ruby-identifier">f</span>
271:     <span class="ruby-keyword kw">end</span>
272:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000050">
                    
                    <a name="M000050"></a><b>root_dir</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000050_source')" id="l_M000050_source">show</a>
                        
                    </p>
                    <div id="M000050_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/multiruby.rb, line 274</span>
274:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">root_dir</span>
275:     <span class="ruby-identifier">root_dir</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-constant">ENV</span>[<span class="ruby-value str">'MULTIRUBY'</span>] <span class="ruby-operator">||</span>
276:                                 <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-constant">ENV</span>[<span class="ruby-value str">'HOME'</span>], <span class="ruby-value str">&quot;.multiruby&quot;</span>))
277: 
278:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">test</span> <span class="ruby-operator">?</span><span class="ruby-identifier">d</span>, <span class="ruby-identifier">root_dir</span> <span class="ruby-keyword kw">then</span>
279:       <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;creating #{root_dir}&quot;</span>
280:       <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">mkdir</span> <span class="ruby-identifier">root_dir</span>, <span class="ruby-value">0700</span>
281:     <span class="ruby-keyword kw">end</span>
282: 
283:     <span class="ruby-identifier">root_dir</span>
284:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000052">
                    
                    <a name="M000052"></a><b>run</b>(base_cmd, log = nil)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000052_source')" id="l_M000052_source">show</a>
                        
                    </p>
                    <div id="M000052_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/multiruby.rb, line 286</span>
286:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">run</span> <span class="ruby-identifier">base_cmd</span>, <span class="ruby-identifier">log</span> = <span class="ruby-keyword kw">nil</span>
287:     <span class="ruby-identifier">cmd</span> = <span class="ruby-identifier">base_cmd</span>
288:     <span class="ruby-identifier">cmd</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot; &gt; #{log} 2&gt;&amp;1&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">log</span>
289:     <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Running command: #{cmd}&quot;</span>
290:     <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;ERROR: Command failed with exit code #{$?}&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">system</span> <span class="ruby-identifier">cmd</span>
291:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000053">
                    
                    <a name="M000053"></a><b>setup_dirs</b>(download = true)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000053_source')" id="l_M000053_source">show</a>
                        
                    </p>
                    <div id="M000053_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/multiruby.rb, line 293</span>
293:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">setup_dirs</span> <span class="ruby-identifier">download</span> = <span class="ruby-keyword kw">true</span>
294:     <span class="ruby-node">%w(build install versions tmp)</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">dir</span><span class="ruby-operator">|</span>
295:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">test</span> <span class="ruby-operator">?</span><span class="ruby-identifier">d</span>, <span class="ruby-identifier">dir</span> <span class="ruby-keyword kw">then</span>
296:         <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;creating #{dir}&quot;</span>
297:         <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">mkdir</span> <span class="ruby-identifier">dir</span>
298:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">dir</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;versions&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">download</span> <span class="ruby-keyword kw">then</span>
299:           <span class="ruby-identifier">warn</span> <span class="ruby-value str">&quot;  Downloading initial ruby tarballs to ~/.multiruby/versions:&quot;</span>
300:           <span class="ruby-constant">VERSIONS</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
301:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">fetch_tar</span> <span class="ruby-identifier">v</span>
302:           <span class="ruby-keyword kw">end</span>
303:           <span class="ruby-identifier">warn</span> <span class="ruby-value str">&quot;  ...done&quot;</span>
304:           <span class="ruby-identifier">warn</span> <span class="ruby-value str">&quot;  Put other ruby tarballs in ~/.multiruby/versions to use them.&quot;</span>
305:         <span class="ruby-keyword kw">end</span>
306:       <span class="ruby-keyword kw">end</span>
307:     <span class="ruby-keyword kw">end</span>
308:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000055">
                    
                    <a name="M000055"></a><b>svn_co</b>(url, dir)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000055_source')" id="l_M000055_source">show</a>
                        
                    </p>
                    <div id="M000055_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/multiruby.rb, line 310</span>
310:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">svn_co</span> <span class="ruby-identifier">url</span>, <span class="ruby-identifier">dir</span>
311:     <span class="ruby-constant">Multiruby</span>.<span class="ruby-identifier">in_versions_dir</span> <span class="ruby-keyword kw">do</span>
312:       <span class="ruby-constant">Multiruby</span>.<span class="ruby-identifier">run</span> <span class="ruby-node">&quot;svn co #{url} #{dir}&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">directory?</span> <span class="ruby-identifier">dir</span>
313:       <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">ln_sf</span> <span class="ruby-node">&quot;../versions/#{dir}&quot;</span>, <span class="ruby-node">&quot;../build/#{dir}&quot;</span>
314:     <span class="ruby-keyword kw">end</span>
315:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000056">
                    
                    <a name="M000056"></a><b>tags</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000056_source')" id="l_M000056_source">show</a>
                        
                    </p>
                    <div id="M000056_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/multiruby.rb, line 317</span>
317:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">tags</span>
318:     <span class="ruby-identifier">tags</span> = <span class="ruby-keyword kw">nil</span>
319:     <span class="ruby-constant">Multiruby</span>.<span class="ruby-identifier">in_tmp_dir</span> <span class="ruby-keyword kw">do</span>
320:       <span class="ruby-identifier">cache</span> = <span class="ruby-value str">&quot;svn.tag.cache&quot;</span>
321:       <span class="ruby-constant">File</span>.<span class="ruby-identifier">unlink</span> <span class="ruby-identifier">cache</span> <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span> <span class="ruby-operator">-</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">mtime</span>(<span class="ruby-identifier">cache</span>) <span class="ruby-operator">&gt;</span> <span class="ruby-value">3600</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
322: 
323:       <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span> <span class="ruby-identifier">cache</span>, <span class="ruby-value str">&quot;w&quot;</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span>
324:         <span class="ruby-identifier">f</span>.<span class="ruby-identifier">write</span> <span class="ruby-node">`svn ls #{MRI_SVN}/tags/`</span>
325:       <span class="ruby-keyword kw">end</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span> <span class="ruby-identifier">cache</span>
326: 
327:       <span class="ruby-identifier">tags</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span>(<span class="ruby-identifier">cache</span>).<span class="ruby-identifier">split</span>(<span class="ruby-regexp re">/\n/</span>).<span class="ruby-identifier">grep</span>(<span class="ruby-regexp re">/^v/</span>).<span class="ruby-identifier">reject</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span> <span class="ruby-identifier">s</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/preview/</span>}
328:     <span class="ruby-keyword kw">end</span>
329: 
330:     <span class="ruby-identifier">tags</span> = <span class="ruby-identifier">tags</span>.<span class="ruby-identifier">sort_by</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\d+/</span>).<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">to_i</span> } }
331:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000059">
                    
                    <a name="M000059"></a><b>update</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000059_source')" id="l_M000059_source">show</a>
                        
                    </p>
                    <div id="M000059_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/multiruby.rb, line 333</span>
333:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">update</span>
334:     <span class="ruby-comment cmt"># TODO:</span>
335:     <span class="ruby-comment cmt"># update will look at the dir name and act accordingly rel_.* will</span>
336:     <span class="ruby-comment cmt"># figure out latest tag on that name and svn sw to it trunk and</span>
337:     <span class="ruby-comment cmt"># others will just svn update</span>
338: 
339:     <span class="ruby-identifier">clean</span> = []
340: 
341:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">each_scm_build_dir</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">style</span><span class="ruby-operator">|</span>
342:       <span class="ruby-identifier">dir</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">basename</span>(<span class="ruby-constant">Dir</span>.<span class="ruby-identifier">pwd</span>)
343:       <span class="ruby-identifier">warn</span> <span class="ruby-identifier">dir</span>
344: 
345:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">style</span>
346:       <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:svn</span> <span class="ruby-keyword kw">then</span>
347:         <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">dir</span>
348:         <span class="ruby-keyword kw">when</span> <span class="ruby-regexp re">/mri_\d/</span> <span class="ruby-keyword kw">then</span>
349:           <span class="ruby-identifier">system</span> <span class="ruby-value str">&quot;svn cleanup&quot;</span> <span class="ruby-comment cmt"># just in case</span>
350:           <span class="ruby-identifier">svn_up</span> = <span class="ruby-value">`svn up`</span>
351:           <span class="ruby-identifier">in_build_dir</span> <span class="ruby-keyword kw">do</span>
352:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">svn_up</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/^[ADUCG] /</span> <span class="ruby-keyword kw">then</span>
353:               <span class="ruby-identifier">clean</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">dir</span>
354:             <span class="ruby-keyword kw">else</span>
355:               <span class="ruby-identifier">warn</span> <span class="ruby-value str">&quot;  no update&quot;</span>
356:             <span class="ruby-keyword kw">end</span>
357:             <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">ln_sf</span> <span class="ruby-node">&quot;../build/#{dir}&quot;</span>, <span class="ruby-node">&quot;../versions/#{dir}&quot;</span>
358:           <span class="ruby-keyword kw">end</span>
359:         <span class="ruby-keyword kw">when</span> <span class="ruby-regexp re">/mri_rel_(.+)/</span> <span class="ruby-keyword kw">then</span>
360:           <span class="ruby-identifier">ver</span> = <span class="ruby-identifier">$1</span>
361:           <span class="ruby-identifier">url</span> = <span class="ruby-value">`svn info`</span>[<span class="ruby-regexp re">/^URL: (.*)/</span>, <span class="ruby-value">1</span>]
362:           <span class="ruby-identifier">latest</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">mri_latest_tag</span>(<span class="ruby-identifier">ver</span>).<span class="ruby-identifier">chomp</span>(<span class="ruby-value str">'/'</span>)
363:           <span class="ruby-identifier">new_url</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-identifier">url</span>), <span class="ruby-identifier">latest</span>)
364:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">new_url</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">url</span> <span class="ruby-keyword kw">then</span>
365:             <span class="ruby-identifier">run</span> <span class="ruby-node">&quot;svn sw #{new_url}&quot;</span>
366:             <span class="ruby-identifier">clean</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">dir</span>
367:           <span class="ruby-keyword kw">else</span>
368:             <span class="ruby-identifier">warn</span> <span class="ruby-value str">&quot;  no update&quot;</span>
369:           <span class="ruby-keyword kw">end</span>
370:         <span class="ruby-keyword kw">else</span>
371:           <span class="ruby-identifier">warn</span> <span class="ruby-node">&quot;  update in this svn dir not supported yet: #{dir}&quot;</span>
372:         <span class="ruby-keyword kw">end</span>
373:       <span class="ruby-keyword kw">else</span>
374:         <span class="ruby-identifier">warn</span> <span class="ruby-node">&quot;  update in non-svn dir not supported yet: #{dir}&quot;</span>
375:       <span class="ruby-keyword kw">end</span>
376:     <span class="ruby-keyword kw">end</span>
377: 
378:     <span class="ruby-identifier">in_install_dir</span> <span class="ruby-keyword kw">do</span>
379:       <span class="ruby-identifier">clean</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">dir</span><span class="ruby-operator">|</span>
380:         <span class="ruby-identifier">warn</span> <span class="ruby-node">&quot;removing install/#{dir}&quot;</span>
381:         <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm_rf</span> <span class="ruby-identifier">dir</span>
382:       <span class="ruby-keyword kw">end</span>
383:     <span class="ruby-keyword kw">end</span>
384:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000062">
                    
                    <a name="M000062"></a><b>update_rubygems</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000062_source')" id="l_M000062_source">show</a>
                        
                    </p>
                    <div id="M000062_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/multiruby.rb, line 386</span>
386:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">update_rubygems</span>
387:     <span class="ruby-identifier">warn</span> <span class="ruby-value str">&quot;  Determining latest version for rubygems&quot;</span>
388:     <span class="ruby-identifier">html</span> = <span class="ruby-constant">URI</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-constant">GEM_URL</span>).<span class="ruby-identifier">read</span>
389: 
390:     <span class="ruby-identifier">versions</span> = <span class="ruby-identifier">html</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/href=&quot;rubygems-update-(\d+(?:\.\d+)+).gem/i</span>).<span class="ruby-identifier">flatten</span>
391:     <span class="ruby-identifier">latest</span> = <span class="ruby-identifier">versions</span>.<span class="ruby-identifier">sort_by</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\d+/</span>).<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">to_i</span> } }.<span class="ruby-identifier">last</span>
392: 
393:     <span class="ruby-constant">Multiruby</span>.<span class="ruby-identifier">in_versions_dir</span> <span class="ruby-keyword kw">do</span>
394:       <span class="ruby-identifier">file</span> = <span class="ruby-node">&quot;rubygems-#{latest}.tgz&quot;</span>
395:       <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">file?</span> <span class="ruby-identifier">file</span> <span class="ruby-keyword kw">then</span>
396:         <span class="ruby-identifier">warn</span> <span class="ruby-node">&quot;    Fetching rubygems-#{latest}.tgz via HTTP.&quot;</span>
397:         <span class="ruby-constant">File</span>.<span class="ruby-identifier">unlink</span>(<span class="ruby-operator">*</span><span class="ruby-constant">Dir</span>[<span class="ruby-value str">&quot;rubygems*&quot;</span>])
398:         <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span> <span class="ruby-identifier">file</span>, <span class="ruby-value str">'w'</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span>
399:           <span class="ruby-identifier">f</span>.<span class="ruby-identifier">write</span> <span class="ruby-constant">URI</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-constant">GEM_URL</span><span class="ruby-operator">+</span><span class="ruby-value str">&quot;/&quot;</span><span class="ruby-operator">+</span><span class="ruby-identifier">file</span>).<span class="ruby-identifier">read</span>
400:         <span class="ruby-keyword kw">end</span>
401:       <span class="ruby-keyword kw">end</span>
402:     <span class="ruby-keyword kw">end</span>
403: 
404:     <span class="ruby-constant">Multiruby</span>.<span class="ruby-identifier">in_build_dir</span> <span class="ruby-keyword kw">do</span>
405:       <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm_rf</span> <span class="ruby-constant">Dir</span>[<span class="ruby-value str">&quot;rubygems*&quot;</span>]
406:     <span class="ruby-keyword kw">end</span>
407: 
408:     <span class="ruby-constant">Multiruby</span>.<span class="ruby-identifier">in_install_dir</span> <span class="ruby-keyword kw">do</span>
409:       <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm_rf</span> <span class="ruby-constant">Dir</span>[<span class="ruby-value str">&quot;*&quot;</span>]
410:     <span class="ruby-keyword kw">end</span>
411:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    