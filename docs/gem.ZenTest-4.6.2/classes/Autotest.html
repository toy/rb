<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>Autotest</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen" />
    <script src="../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Class</span> 
            Autotest 
            
                <span class="parent">&lt; 
                    
                    Object
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../files/lib/autotest/preload_rb.html">lib/autotest/preload.rb</a></li>
            
            <li><a href="../files/lib/autotest_rb.html">lib/autotest.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    
    <div class="description">
        <p>
<a href="Autotest.html">Autotest</a> continuously scans the files in your
project for changes and runs the appropriate tests. Test failures are run
until they have all passed. Then the full test suite is run to ensure that
nothing else was inadvertantly broken.
</p>
<p>
If you want <a href="Autotest.html">Autotest</a> to start over from the
top, hit ^C once. If you want <a href="Autotest.html">Autotest</a> to quit,
hit ^C twice.
</p>
<p>
Rails:
</p>
<p>
The autotest command will automatically discover a Rails directory by
looking for config/environment.rb. When Rails is discovered, autotest uses
RailsAutotest to perform file mappings and other work. See RailsAutotest
for details.
</p>
<p>
Plugins:
</p>
<p>
Plugins are available by creating a .autotest file either in your project
root or in your home directory. You can then write event handlers in the
form of:
</p>
<pre>
  Autotest.add_hook hook_name { |autotest| ... }
</pre>
<p>
The available hooks are listed in <tt><a
href="Autotest.html#ALL_HOOKS">ALL_HOOKS</a></tt>.
</p>
<p>
See example_dot_autotest.rb for more details.
</p>
<p>
If a hook returns a true value, it signals to autotest that the hook was
handled and should not continue executing hooks.
</p>
<p>
Naming:
</p>
<p>
<a href="Autotest.html">Autotest</a> uses a simple naming scheme to figure
out how to map implementation files to test files following the Test::Unit
naming scheme.
</p>
<ul>
<li>Test files must be stored in test/

</li>
<li>Test files names must start with test_

</li>
<li>Test class names must start with Test

</li>
<li>Implementation files must be stored in lib/

</li>
<li>Implementation files must match up with a test file named
test_.*implementation.rb

</li>
</ul>
<p>
Strategy:
</p>
<ol>
<li>Find all files and associate them from impl <-> test.

</li>
<li>Run all tests.

</li>
<li>Scan for failures.

</li>
<li>Detect changes in ANY (ruby?. file, rerun all failures + changed files.

</li>
<li>Until 0 defects, goto 3.

</li>
<li>When 0 defects, goto 2.

</li>
</ol>

    </div>
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>A</dt>
        <dd>
            <ul>
                
                <li><a href="#M000019">add_discovery</a>,</li>
                
                <li><a href="#M000076">add_exception</a>,</li>
                
                <li><a href="#M000082">add_hook</a>,</li>
                
                <li><a href="#M000071">add_mapping</a>,</li>
                
                <li><a href="#M000032">add_sigint_handler</a>,</li>
                
                <li><a href="#M000037">add_sigquit_handler</a>,</li>
                
                <li><a href="#M000044">all_good</a>,</li>
                
                <li><a href="#M000020">autodiscover</a></li>
                
            </ul>
        </dd>
    
        <dt>C</dt>
        <dd>
            <ul>
                
                <li><a href="#M000078">clear_exceptions</a>,</li>
                
                <li><a href="#M000075">clear_mappings</a>,</li>
                
                <li><a href="#M000047">consolidate_failures</a></li>
                
            </ul>
        </dd>
    
        <dt>E</dt>
        <dd>
            <ul>
                
                <li><a href="#M000079">exceptions</a></li>
                
            </ul>
        </dd>
    
        <dt>F</dt>
        <dd>
            <ul>
                
                <li><a href="#M000070">files_matching</a>,</li>
                
                <li><a href="#M000051">find_files</a>,</li>
                
                <li><a href="#M000054">find_files_to_test</a></li>
                
            </ul>
        </dd>
    
        <dt>G</dt>
        <dd>
            <ul>
                
                <li><a href="#M000029">get_to_green</a></li>
                
            </ul>
        </dd>
    
        <dt>H</dt>
        <dd>
            <ul>
                
                <li><a href="#M000057">handle_results</a>,</li>
                
                <li><a href="#M000080">hook</a></li>
                
            </ul>
        </dd>
    
        <dt>K</dt>
        <dd>
            <ul>
                
                <li><a href="#M000058">known_files</a></li>
                
            </ul>
        </dd>
    
        <dt>M</dt>
        <dd>
            <ul>
                
                <li><a href="#M000061">make_test_cmd</a></li>
                
            </ul>
        </dd>
    
        <dt>N</dt>
        <dd>
            <ul>
                
                <li><a href="#M000022">new</a>,</li>
                
                <li><a href="#M000063">new_hash_of_arrays</a></li>
                
            </ul>
        </dd>
    
        <dt>O</dt>
        <dd>
            <ul>
                
                <li><a href="#M000009">old_run_tests</a>,</li>
                
                <li><a href="#M000014">options</a>,</li>
                
                <li><a href="#M000013">options</a></li>
                
            </ul>
        </dd>
    
        <dt>P</dt>
        <dd>
            <ul>
                
                <li><a href="#M000015">parse_options</a>,</li>
                
                <li><a href="#M000045">path_to_classname</a></li>
                
            </ul>
        </dd>
    
        <dt>R</dt>
        <dd>
            <ul>
                
                <li><a href="#M000077">remove_exception</a>,</li>
                
                <li><a href="#M000072">remove_mapping</a>,</li>
                
                <li><a href="#M000064">reorder</a>,</li>
                
                <li><a href="#M000065">rerun_all_tests</a>,</li>
                
                <li><a href="#M000066">reset</a>,</li>
                
                <li><a href="#M000042">restart</a>,</li>
                
                <li><a href="#M000067">ruby</a>,</li>
                
                <li><a href="#M000060">ruby_cmd</a>,</li>
                
                <li><a href="#M000021">run</a>,</li>
                
                <li><a href="#M000025">run</a>,</li>
                
                <li><a href="#M000030">run_tests</a>,</li>
                
                <li><a href="#M000008">run_tests</a>,</li>
                
                <li><a href="#M000018">runner</a></li>
                
            </ul>
        </dd>
    
        <dt>T</dt>
        <dd>
            <ul>
                
                <li><a href="#M000068">test_files_for</a></li>
                
            </ul>
        </dd>
    
        <dt>W</dt>
        <dd>
            <ul>
                
                <li><a href="#M000069">wait_for_changes</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    

    

    
    <div class="sectiontitle">Classes and Modules</div>
    <ul>
        
        <li><span class="type">MODULE</span> <a href="Autotest/AutoUpdate.html">Autotest::AutoUpdate</a></li>
        
        <li><span class="type">MODULE</span> <a href="Autotest/Bundler.html">Autotest::Bundler</a></li>
        
        <li><span class="type">MODULE</span> <a href="Autotest/Isolate.html">Autotest::Isolate</a></li>
        
        <li><span class="type">MODULE</span> <a href="Autotest/Once.html">Autotest::Once</a></li>
        
        <li><span class="type">MODULE</span> <a href="Autotest/Preload.html">Autotest::Preload</a></li>
        
        <li><span class="type">MODULE</span> <a href="Autotest/RCov.html">Autotest::RCov</a></li>
        
        <li><span class="type">MODULE</span> <a href="Autotest/Restart.html">Autotest::Restart</a></li>
        
        <li><span class="type">MODULE</span> <a href="Autotest/Timestamp.html">Autotest::Timestamp</a></li>
        
    </ul>
    

    
    <div class="sectiontitle">Constants</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class="attr-name">RUBY19</td>
            <td>=</td>
            <td class="attr-value">defined? Encoding</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">T0</td>
            <td>=</td>
            <td class="attr-value">Time.at 0</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">ALL_HOOKS</td>
            <td>=</td>
            <td class="attr-value">[ :all_good, :died, :green, :initialize,                 :post_initialize, :interrupt, :quit, :ran_command,                 :red, :reset, :run_command, :updated, :waiting ]</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">HOOKS</td>
            <td>=</td>
            <td class="attr-value">Hash.new { |h,k| h[k] = [] }</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">WINDOZE</td>
            <td>=</td>
            <td class="attr-value">/mswin|mingw/ =~ RbConfig::CONFIG['host_os']</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">SEP</td>
            <td>=</td>
            <td class="attr-value">WINDOZE ? '&amp;' : ';'</td>
        </tr>
        
        
    </table>
    

    
    <div class="sectiontitle">Attributes</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [W]
            </td>
            <td class='attr-name'>known_files</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>completed_re</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>extra_class_map</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>extra_files</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>failed_results_re</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>files_to_test</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>find_order</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>interrupted</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>latest_results</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>last_mtime</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>libs</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>order</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>output</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>prefix</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>results</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>sleep</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>tainted</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>testlib</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>find_directories</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>unit_diff</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>wants_to_quit</td>
            <td class='attr-desc'></td>
        </tr>
        
    </table>
    

    
            <div class="sectiontitle">Class Public methods</div>
            
            <div class="method">
                <div class="title" id="M000019">
                    
                    <a name="M000019"></a><b>add_discovery</b>(&amp;proc)
                    
                </div>
                
                <div class="description">
                  <p>
Add a proc to the collection of discovery procs. See <tt>autodiscover</tt>.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000019_source')" id="l_M000019_source">show</a>
                        
                    </p>
                    <div id="M000019_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/autotest.rb, line 175</span>
175:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">add_discovery</span> <span class="ruby-operator">&amp;</span><span class="ruby-identifier">proc</span>
176:     <span class="ruby-ivar">@@discoveries</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">proc</span>
177:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000082">
                    
                    <a name="M000082"></a><b>add_hook</b>(name, &amp;block)
                    
                </div>
                
                <div class="description">
                  <p>
Add the supplied block to the available hooks, with the given name.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000082_source')" id="l_M000082_source">show</a>
                        
                    </p>
                    <div id="M000082_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/autotest.rb, line 844</span>
844:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">add_hook</span> <span class="ruby-identifier">name</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>
845:     <span class="ruby-constant">HOOKS</span>[<span class="ruby-identifier">name</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">block</span>
846:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000020">
                    
                    <a name="M000020"></a><b>autodiscover</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Automatically find all potential autotest runner styles by searching your
loadpath, vendor/plugins, and rubygems for
&#8220;autotest/discover.rb&#8220;. If found, that file is loaded and it
should register discovery procs with autotest using <tt><a
href="Autotest.html#M000019">add_discovery</a></tt>. That proc should
return one or more strings describing the user&#8217;s current environment.
Those styles are then combined to dynamically invoke an autotest plugin to
suite your environment. That plugin should define a subclass of <a
href="Autotest.html">Autotest</a> with a corresponding name.
</p>
<h3>Process:</h3>
<ol>
<li>All autotest/discover.rb files loaded.

</li>
<li>Those procs determine your styles (eg [&#8220;rails&#8221;,
&#8220;rspec&#8221;]).

</li>
<li>Require file by sorting styles and joining (eg
&#8216;autotest/rails_rspec&#8217;).

</li>
<li>Invoke run method on appropriate class (eg Autotest::RailsRspec.run).

</li>
</ol>
<h3>Example autotest/discover.rb:</h3>
<pre>
  Autotest.add_discovery do
    &quot;rails&quot; if File.exist? 'config/environment.rb'
  end
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000020_source')" id="l_M000020_source">show</a>
                        
                    </p>
                    <div id="M000020_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/autotest.rb, line 204</span>
204:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">autodiscover</span>
205:     <span class="ruby-identifier">require</span> <span class="ruby-value str">'rubygems'</span>
206: 
207:     <span class="ruby-comment cmt"># *sigh*</span>
208:     <span class="ruby-comment cmt">#</span>
209:     <span class="ruby-comment cmt"># This is needed for rspec's hacky discovery mechanism. For some</span>
210:     <span class="ruby-comment cmt"># reason rspec2 added generators that create</span>
211:     <span class="ruby-comment cmt"># &quot;autotest/discover.rb&quot; right in the project directory instead of</span>
212:     <span class="ruby-comment cmt"># keeping it in the rspec gem and properly deciding that the</span>
213:     <span class="ruby-comment cmt"># project is an rspec based project or not. See the url for more</span>
214:     <span class="ruby-comment cmt"># details:</span>
215:     <span class="ruby-comment cmt">#</span>
216:     <span class="ruby-comment cmt"># http://rubyforge.org/tracker/?func=detail&amp;atid=1678&amp;aid=28775&amp;group_id=419</span>
217:     <span class="ruby-comment cmt">#</span>
218:     <span class="ruby-comment cmt"># For the record, the sane way to do it is the bacon way:</span>
219:     <span class="ruby-comment cmt">#</span>
220:     <span class="ruby-comment cmt"># &quot;Since version 1.0, there is autotest support. You need to tag</span>
221:     <span class="ruby-comment cmt"># your test directories (test/ or spec/) by creating an .bacon</span>
222:     <span class="ruby-comment cmt"># file there. Autotest then will find it.&quot;</span>
223:     <span class="ruby-comment cmt">#</span>
224:     <span class="ruby-comment cmt"># I'm submitting a counter-patch to rspec to fix stuff properly,</span>
225:     <span class="ruby-comment cmt"># but for now I'm stuck with this because their brokenness is</span>
226:     <span class="ruby-comment cmt"># documented in multiple books.</span>
227:     <span class="ruby-comment cmt">#</span>
228:     <span class="ruby-comment cmt"># I'm removing this code once a sane rspec goes out.</span>
229: 
230:     <span class="ruby-identifier">hacky_discovery</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span>.<span class="ruby-identifier">any?</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/^rspec/</span> }
231:     <span class="ruby-identifier">$:</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">'.'</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">hacky_discovery</span>
232: 
233:     <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">find_files</span>(<span class="ruby-value str">&quot;autotest/discover&quot;</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span>
234:       <span class="ruby-identifier">load</span> <span class="ruby-identifier">f</span>
235:     <span class="ruby-keyword kw">end</span>
236: 
237:     <span class="ruby-comment cmt"># call all discovery procs and determine the style to use</span>
238:     <span class="ruby-ivar">@@discoveries</span>.<span class="ruby-identifier">map</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">proc</span><span class="ruby-operator">|</span> <span class="ruby-identifier">proc</span>.<span class="ruby-identifier">call</span> }.<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">sort</span>.<span class="ruby-identifier">uniq</span>
239:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000022">
                    
                    <a name="M000022"></a><b>new</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Initialize the instance and then load the user&#8217;s .autotest file, if
any.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000022_source')" id="l_M000022_source">show</a>
                        
                    </p>
                    <div id="M000022_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/autotest.rb, line 275</span>
275:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>
276:     <span class="ruby-comment cmt"># these two are set directly because they're wrapped with</span>
277:     <span class="ruby-comment cmt"># add/remove/clear accessor methods</span>
278:     <span class="ruby-ivar">@exception_list</span> = []
279:     <span class="ruby-ivar">@test_mappings</span> = []
280:     <span class="ruby-ivar">@child</span> = <span class="ruby-keyword kw">nil</span>
281: 
282:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">completed_re</span> =
283:       <span class="ruby-regexp re">/\d+ tests, \d+ assertions, \d+ failures, \d+ errors(, \d+ skips)?/</span>
284:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">extra_class_map</span>   = {}
285:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">extra_files</span>       = []
286:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">failed_results_re</span> = <span class="ruby-regexp re">/^\s+\d+\) (?:Failure|Error):\n(.*?)\((.*?)\)/</span>
287:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">files_to_test</span>     = <span class="ruby-identifier">new_hash_of_arrays</span>
288:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">find_order</span>        = []
289:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">known_files</span>       = <span class="ruby-keyword kw">nil</span>
290:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">libs</span>              = <span class="ruby-node">%w[. lib test]</span>.<span class="ruby-identifier">join</span>(<span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">PATH_SEPARATOR</span>)
291:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">order</span>             = <span class="ruby-identifier">:random</span>
292:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">output</span>            = <span class="ruby-identifier">$stderr</span>
293:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">prefix</span>            = <span class="ruby-keyword kw">nil</span>
294:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">sleep</span>             = <span class="ruby-value">1</span>
295:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">testlib</span>           = <span class="ruby-value str">&quot;test/unit&quot;</span>
296:     <span class="ruby-identifier">specified_directories</span>  = <span class="ruby-constant">ARGV</span>.<span class="ruby-identifier">reject</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">arg</span><span class="ruby-operator">|</span> <span class="ruby-identifier">arg</span>.<span class="ruby-identifier">start_with?</span>(<span class="ruby-value str">&quot;-&quot;</span>) } <span class="ruby-comment cmt"># options are not directories</span>
297:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">find_directories</span>  = <span class="ruby-identifier">specified_directories</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-value">? </span>[<span class="ruby-value str">'.'</span>] <span class="ruby-operator">:</span> <span class="ruby-identifier">specified_directories</span>
298:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">unit_diff</span>         = <span class="ruby-keyword kw">nil</span>
299:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">latest_results</span>    = <span class="ruby-keyword kw">nil</span>
300: 
301:     <span class="ruby-comment cmt"># file in /lib -&gt; run test in /test</span>
302:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">add_mapping</span>(<span class="ruby-regexp re">/^lib\/.*\.rb$/</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">filename</span>, <span class="ruby-identifier">_</span><span class="ruby-operator">|</span>
303:       <span class="ruby-identifier">possible</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">basename</span>(<span class="ruby-identifier">filename</span>).<span class="ruby-identifier">gsub</span> <span class="ruby-value str">'_'</span>, <span class="ruby-value str">'_?'</span> <span class="ruby-comment cmt"># ' stupid emacs</span>
304:       <span class="ruby-identifier">files_matching</span> <span class="ruby-node">%r%^test/.*#{possible}$%</span>
305:     <span class="ruby-keyword kw">end</span>
306: 
307:     <span class="ruby-comment cmt"># file in /test -&gt; run it</span>
308:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">add_mapping</span>(<span class="ruby-regexp re">/^test.*\/test_.*rb$/</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">filename</span>, <span class="ruby-identifier">_</span><span class="ruby-operator">|</span>
309:       <span class="ruby-identifier">filename</span>
310:     <span class="ruby-keyword kw">end</span>
311: 
312:     <span class="ruby-identifier">default_configs</span> = [<span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-value str">'~/.autotest'</span>), <span class="ruby-value str">'./.autotest'</span>]
313:     <span class="ruby-identifier">configs</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:rc</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">default_configs</span>
314: 
315:     <span class="ruby-identifier">configs</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span>
316:       <span class="ruby-identifier">load</span> <span class="ruby-identifier">f</span> <span class="ruby-keyword kw">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span> <span class="ruby-identifier">f</span>
317:     <span class="ruby-keyword kw">end</span>
318:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000013">
                    
                    <a name="M000013"></a><b>options</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000013_source')" id="l_M000013_source">show</a>
                        
                    </p>
                    <div id="M000013_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/autotest.rb, line 69</span>
69:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">options</span>
70:     <span class="ruby-ivar">@@options</span> <span class="ruby-operator">||=</span> {}
71:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000015">
                    
                    <a name="M000015"></a><b>parse_options</b>(args = ARGV)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000015_source')" id="l_M000015_source">show</a>
                        
                    </p>
                    <div id="M000015_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/autotest.rb, line 85</span>
 85:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">parse_options</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
 86:     <span class="ruby-identifier">require</span> <span class="ruby-value str">'optparse'</span>
 87:     <span class="ruby-identifier">options</span> = {
 88:       <span class="ruby-identifier">:args</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">dup</span>
 89:     }
 90: 
 91:     <span class="ruby-constant">OptionParser</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">opts</span><span class="ruby-operator">|</span>
 92:       <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">banner</span> = <span class="ruby-value str">&quot;Continuous testing for your ruby app.\n\nAutotest automatically tests code that has changed. It\nassumes the code is in lib, and tests are in tests. Autotest\nuses plugins to control what happens. You configure plugins\nwith require statements in the .autotest file in your\nproject base directory, and a default configuration for all\nyour projects in the .autotest file in your home directory.\n\nUsage:\nautotest [options]\n&quot;</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/^        /</span>, <span class="ruby-value str">''</span>)
 93: 
 94:       <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span> <span class="ruby-value str">&quot;-f&quot;</span>, <span class="ruby-value str">&quot;--fast-start&quot;</span>, <span class="ruby-value str">&quot;Do not run full tests at start&quot;</span> <span class="ruby-keyword kw">do</span>
 95:         <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:no_full_after_start</span>] = <span class="ruby-keyword kw">true</span>
 96:       <span class="ruby-keyword kw">end</span>
 97: 
 98:       <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">&quot;-c&quot;</span>, <span class="ruby-value str">&quot;--no-full-after-failed&quot;</span>,
 99:               <span class="ruby-value str">&quot;Do not run all tests on red-&gt;green&quot;</span>) <span class="ruby-keyword kw">do</span>
100:         <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:no_full_after_failed</span>] = <span class="ruby-keyword kw">true</span>
101:       <span class="ruby-keyword kw">end</span>
102: 
103:       <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span> <span class="ruby-value str">&quot;-v&quot;</span>, <span class="ruby-value str">&quot;--verbose&quot;</span>, <span class="ruby-value str">&quot;Be annoyingly verbose (debugs .autotest).&quot;</span> <span class="ruby-keyword kw">do</span>
104:         <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:verbose</span>] = <span class="ruby-keyword kw">true</span>
105:       <span class="ruby-keyword kw">end</span>
106: 
107:       <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span> <span class="ruby-value str">&quot;-q&quot;</span>, <span class="ruby-value str">&quot;--quiet&quot;</span>, <span class="ruby-value str">&quot;Be quiet.&quot;</span> <span class="ruby-keyword kw">do</span>
108:         <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:quiet</span>] = <span class="ruby-keyword kw">true</span>
109:       <span class="ruby-keyword kw">end</span>
110: 
111:       <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">&quot;-r&quot;</span>, <span class="ruby-value str">&quot;--rc CONF&quot;</span>, <span class="ruby-constant">String</span>, <span class="ruby-value str">&quot;Override path to config file&quot;</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">o</span><span class="ruby-operator">|</span>
112:         <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:rc</span>] = <span class="ruby-constant">Array</span>(<span class="ruby-identifier">o</span>)
113:       <span class="ruby-keyword kw">end</span>
114: 
115:       <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">&quot;-s&quot;</span>, <span class="ruby-value str">&quot;--style STYLE&quot;</span>, <span class="ruby-constant">String</span>,
116:               <span class="ruby-value str">&quot;Manually specify test style. (default: autodiscover)&quot;</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">style</span><span class="ruby-operator">|</span>
117:         <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:style</span>] = <span class="ruby-constant">Array</span>(<span class="ruby-identifier">style</span>)
118:       <span class="ruby-keyword kw">end</span>
119: 
120:       <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">&quot;-w&quot;</span>, <span class="ruby-value str">&quot;--warnings&quot;</span>, <span class="ruby-value str">&quot;Turn on ruby warnings&quot;</span>) <span class="ruby-keyword kw">do</span>
121:         <span class="ruby-identifier">$-w</span> = <span class="ruby-keyword kw">true</span>
122:       <span class="ruby-keyword kw">end</span>
123: 
124:       <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span> <span class="ruby-value str">&quot;-h&quot;</span>, <span class="ruby-value str">&quot;--help&quot;</span>, <span class="ruby-value str">&quot;Show this.&quot;</span> <span class="ruby-keyword kw">do</span>
125:         <span class="ruby-identifier">puts</span> <span class="ruby-identifier">opts</span>
126:         <span class="ruby-identifier">exit</span> <span class="ruby-value">1</span>
127:       <span class="ruby-keyword kw">end</span>
128:     <span class="ruby-keyword kw">end</span>.<span class="ruby-identifier">parse!</span> <span class="ruby-identifier">args</span>
129: 
130:     <span class="ruby-constant">Autotest</span>.<span class="ruby-identifier">options</span>.<span class="ruby-identifier">merge!</span> <span class="ruby-identifier">options</span>
131: 
132:     <span class="ruby-identifier">options</span>
133:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000021">
                    
                    <a name="M000021"></a><b>run</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Initialize and run the system.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000021_source')" id="l_M000021_source">show</a>
                        
                    </p>
                    <div id="M000021_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/autotest.rb, line 244</span>
244:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">run</span>
245:     <span class="ruby-identifier">new</span>.<span class="ruby-identifier">run</span>
246:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000018">
                    
                    <a name="M000018"></a><b>runner</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Calculates the autotest runner to use to run the tests.
</p>
<p>
Can be overridden with &#8212;style, otherwise uses ::autodiscover.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000018_source')" id="l_M000018_source">show</a>
                        
                    </p>
                    <div id="M000018_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/autotest.rb, line 153</span>
153:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">runner</span>
154:     <span class="ruby-identifier">style</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:style</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">Autotest</span>.<span class="ruby-identifier">autodiscover</span>
155:     <span class="ruby-identifier">target</span> = <span class="ruby-constant">Autotest</span>
156: 
157:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">style</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-keyword kw">then</span>
158:       <span class="ruby-identifier">mod</span> = <span class="ruby-node">&quot;autotest/#{style.join &quot;_&quot;}&quot;</span>
159:       <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;loading #{mod}&quot;</span>
160:       <span class="ruby-keyword kw">begin</span>
161:         <span class="ruby-identifier">require</span> <span class="ruby-identifier">mod</span>
162:       <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">LoadError</span>
163:         <span class="ruby-identifier">abort</span> <span class="ruby-node">&quot;Autotest style #{mod} doesn't seem to exist. Aborting.&quot;</span>
164:       <span class="ruby-keyword kw">end</span>
165:       <span class="ruby-identifier">target</span> = <span class="ruby-constant">Autotest</span>.<span class="ruby-identifier">const_get</span>(<span class="ruby-identifier">style</span>.<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">capitalize</span>}.<span class="ruby-identifier">join</span>)
166:     <span class="ruby-keyword kw">end</span>
167: 
168:     <span class="ruby-identifier">target</span>
169:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M000076">
                    
                    <a name="M000076"></a><b>add_exception</b>(regexp)
                    
                </div>
                
                <div class="description">
                  <p>
Adds <tt>regexp</tt> to the list of exceptions for find_file. This must be
called <em>before</em> the exceptions are compiled.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000076_source')" id="l_M000076_source">show</a>
                        
                    </p>
                    <div id="M000076_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/autotest.rb, line 770</span>
770:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_exception</span> <span class="ruby-identifier">regexp</span>
771:     <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;exceptions already compiled&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">defined?</span> <span class="ruby-ivar">@exceptions</span>
772: 
773:     <span class="ruby-ivar">@exception_list</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">regexp</span>
774:     <span class="ruby-keyword kw">nil</span>
775:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000071">
                    
                    <a name="M000071"></a><b>add_mapping</b>(regexp, prepend = false, &amp;proc)
                    
                </div>
                
                <div class="description">
                  <p>
Adds a file mapping, optionally prepending the mapping to the front of the
list if <tt>prepend</tt> is true. <tt>regexp</tt> should match a file path
in the codebase. <tt>proc</tt> is passed a matched filename and
Regexp.last_match. <tt>proc</tt> should return an array of tests to run.
</p>
<p>
For example, if test_helper.rb is modified, rerun all tests:
</p>
<pre>
  at.add_mapping(/test_helper.rb/) do |f, _|
    at.files_matching(/^test.*rb$/)
  end
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000071_source')" id="l_M000071_source">show</a>
                        
                    </p>
                    <div id="M000071_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/autotest.rb, line 734</span>
734:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_mapping</span> <span class="ruby-identifier">regexp</span>, <span class="ruby-identifier">prepend</span> = <span class="ruby-keyword kw">false</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">proc</span>
735:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">prepend</span> <span class="ruby-keyword kw">then</span>
736:       <span class="ruby-ivar">@test_mappings</span>.<span class="ruby-identifier">unshift</span> [<span class="ruby-identifier">regexp</span>, <span class="ruby-identifier">proc</span>]
737:     <span class="ruby-keyword kw">else</span>
738:       <span class="ruby-ivar">@test_mappings</span>.<span class="ruby-identifier">push</span> [<span class="ruby-identifier">regexp</span>, <span class="ruby-identifier">proc</span>]
739:     <span class="ruby-keyword kw">end</span>
740:     <span class="ruby-keyword kw">nil</span>
741:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000032">
                    
                    <a name="M000032"></a><b>add_sigint_handler</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Installs a sigint handler.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000032_source')" id="l_M000032_source">show</a>
                        
                    </p>
                    <div id="M000032_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/autotest.rb, line 416</span>
416:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_sigint_handler</span>
417:     <span class="ruby-identifier">trap</span> <span class="ruby-value str">'INT'</span> <span class="ruby-keyword kw">do</span>
418:       <span class="ruby-constant">Process</span>.<span class="ruby-identifier">kill</span> <span class="ruby-value str">&quot;KILL&quot;</span>, <span class="ruby-ivar">@child</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@child</span>
419: 
420:       <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">interrupted</span> <span class="ruby-keyword kw">then</span>
421:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">wants_to_quit</span> = <span class="ruby-keyword kw">true</span>
422:       <span class="ruby-keyword kw">else</span>
423:         <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">hook</span> <span class="ruby-identifier">:interrupt</span> <span class="ruby-keyword kw">then</span>
424:           <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;Interrupt a second time to quit&quot;</span>
425:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">interrupted</span> = <span class="ruby-keyword kw">true</span>
426:           <span class="ruby-constant">Kernel</span>.<span class="ruby-identifier">sleep</span> <span class="ruby-value">1.5</span>
427:         <span class="ruby-keyword kw">end</span>
428:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">Interrupt</span>, <span class="ruby-keyword kw">nil</span> <span class="ruby-comment cmt"># let the run loop catch it</span>
429:       <span class="ruby-keyword kw">end</span>
430:     <span class="ruby-keyword kw">end</span>
431:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000037">
                    
                    <a name="M000037"></a><b>add_sigquit_handler</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Installs a sigquit handler
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000037_source')" id="l_M000037_source">show</a>
                        
                    </p>
                    <div id="M000037_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/autotest.rb, line 436</span>
436:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_sigquit_handler</span>
437:     <span class="ruby-identifier">trap</span> <span class="ruby-value str">'QUIT'</span> <span class="ruby-keyword kw">do</span>
438:       <span class="ruby-identifier">restart</span>
439:     <span class="ruby-keyword kw">end</span>
440:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000044">
                    
                    <a name="M000044"></a><b>all_good</b>()
                    
                </div>
                
                <div class="description">
                  <p>
If there are no files left to test (because they&#8217;ve all passed), then
all is good.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000044_source')" id="l_M000044_source">show</a>
                        
                    </p>
                    <div id="M000044_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/autotest.rb, line 463</span>
463:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">all_good</span>
464:     <span class="ruby-identifier">files_to_test</span>.<span class="ruby-identifier">empty?</span>
465:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000078">
                    
                    <a name="M000078"></a><b>clear_exceptions</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Clears the list of exceptions for find_file. This must be called
<em>before</em> the exceptions are compiled.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000078_source')" id="l_M000078_source">show</a>
                        
                    </p>
                    <div id="M000078_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/autotest.rb, line 791</span>
791:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">clear_exceptions</span>
792:     <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;exceptions already compiled&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">defined?</span> <span class="ruby-ivar">@exceptions</span>
793:     <span class="ruby-ivar">@exception_list</span>.<span class="ruby-identifier">clear</span>
794:     <span class="ruby-keyword kw">nil</span>
795:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000075">
                    
                    <a name="M000075"></a><b>clear_mappings</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Clears all file mappings. This is DANGEROUS as it entirely disables
autotest. You must add at least one file mapping that does a good job of
rerunning appropriate tests.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000075_source')" id="l_M000075_source">show</a>
                        
                    </p>
                    <div id="M000075_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/autotest.rb, line 758</span>
758:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">clear_mappings</span>
759:     <span class="ruby-ivar">@test_mappings</span>.<span class="ruby-identifier">clear</span>
760:     <span class="ruby-keyword kw">nil</span>
761:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000047">
                    
                    <a name="M000047"></a><b>consolidate_failures</b>(failed)
                    
                </div>
                
                <div class="description">
                  <p>
Returns a hash mapping a file name to the known failures for that file.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000047_source')" id="l_M000047_source">show</a>
                        
                    </p>
                    <div id="M000047_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/autotest.rb, line 484</span>
484:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">consolidate_failures</span> <span class="ruby-identifier">failed</span>
485:     <span class="ruby-identifier">filters</span> = <span class="ruby-identifier">new_hash_of_arrays</span>
486: 
487:     <span class="ruby-identifier">class_map</span> = <span class="ruby-constant">Hash</span>[<span class="ruby-operator">*</span><span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">find_order</span>.<span class="ruby-identifier">grep</span>(<span class="ruby-regexp re">/^test/</span>).<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span> <span class="ruby-comment cmt"># TODO: ugly</span>
488:                        [<span class="ruby-identifier">path_to_classname</span>(<span class="ruby-identifier">f</span>), <span class="ruby-identifier">f</span>]
489:                      }.<span class="ruby-identifier">flatten</span>]
490:     <span class="ruby-identifier">class_map</span>.<span class="ruby-identifier">merge!</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">extra_class_map</span>
491: 
492:     <span class="ruby-identifier">failed</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">method</span>, <span class="ruby-identifier">klass</span><span class="ruby-operator">|</span>
493:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">class_map</span>.<span class="ruby-identifier">has_key?</span> <span class="ruby-identifier">klass</span> <span class="ruby-keyword kw">then</span>
494:         <span class="ruby-identifier">filters</span>[<span class="ruby-identifier">class_map</span>[<span class="ruby-identifier">klass</span>]] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">method</span>
495:       <span class="ruby-keyword kw">else</span>
496:         <span class="ruby-identifier">output</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Unable to map class #{klass} to a file&quot;</span>
497:       <span class="ruby-keyword kw">end</span>
498:     <span class="ruby-keyword kw">end</span>
499: 
500:     <span class="ruby-identifier">filters</span>
501:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000079">
                    
                    <a name="M000079"></a><b>exceptions</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Return a compiled regexp of exceptions for <a
href="Autotest.html#M000051">find_files</a> or nil if no filtering should
take place. This regexp is generated from <tt>exception_list</tt>.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000079_source')" id="l_M000079_source">show</a>
                        
                    </p>
                    <div id="M000079_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/autotest.rb, line 802</span>
802:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">exceptions</span>
803:     <span class="ruby-keyword kw">unless</span> <span class="ruby-keyword kw">defined?</span> <span class="ruby-ivar">@exceptions</span> <span class="ruby-keyword kw">then</span>
804:       <span class="ruby-ivar">@exceptions</span> = <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@exception_list</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-keyword kw">then</span>
805:                       <span class="ruby-keyword kw">nil</span>
806:                     <span class="ruby-keyword kw">else</span>
807:                       <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">union</span>(<span class="ruby-operator">*</span><span class="ruby-ivar">@exception_list</span>)
808:                     <span class="ruby-keyword kw">end</span>
809:     <span class="ruby-keyword kw">end</span>
810: 
811:     <span class="ruby-ivar">@exceptions</span>
812:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000070">
                    
                    <a name="M000070"></a><b>files_matching</b>(regexp)
                    
                </div>
                
                <div class="description">
                  <p>
Returns all known files in the codebase matching <tt>regexp</tt>.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000070_source')" id="l_M000070_source">show</a>
                        
                    </p>
                    <div id="M000070_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/autotest.rb, line 718</span>
718:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">files_matching</span> <span class="ruby-identifier">regexp</span>
719:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">find_order</span>.<span class="ruby-identifier">select</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span><span class="ruby-operator">|</span> <span class="ruby-identifier">k</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">regexp</span> }
720:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000051">
                    
                    <a name="M000051"></a><b>find_files</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Find the files to process, ignoring temporary files, source configuration
management files, etc., and return a Hash mapping filename to modification
time.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000051_source')" id="l_M000051_source">show</a>
                        
                    </p>
                    <div id="M000051_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/autotest.rb, line 508</span>
508:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">find_files</span>
509:     <span class="ruby-identifier">result</span> = {}
510:     <span class="ruby-identifier">targets</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">find_directories</span> <span class="ruby-operator">+</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">extra_files</span>
511:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">find_order</span>.<span class="ruby-identifier">clear</span>
512: 
513:     <span class="ruby-identifier">targets</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">target</span><span class="ruby-operator">|</span>
514:       <span class="ruby-identifier">order</span> = []
515:       <span class="ruby-constant">Find</span>.<span class="ruby-identifier">find</span> <span class="ruby-identifier">target</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span>
516:         <span class="ruby-constant">Find</span>.<span class="ruby-identifier">prune</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">f</span> <span class="ruby-operator">=~</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">exceptions</span>
517: 
518:         <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">test</span> <span class="ruby-operator">?</span><span class="ruby-identifier">d</span>, <span class="ruby-identifier">f</span>
519:         <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">f</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/(swp|~|rej|orig)$/</span> <span class="ruby-comment cmt"># temporary/patch files</span>
520:         <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">f</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/^\.\/tmp/</span>          <span class="ruby-comment cmt"># temporary dir, used by isolate</span>
521:         <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">f</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/\/\.?#/</span>            <span class="ruby-comment cmt"># Emacs autosave/cvs merge files</span>
522: 
523:         <span class="ruby-identifier">filename</span> = <span class="ruby-identifier">f</span>.<span class="ruby-identifier">sub</span>(<span class="ruby-regexp re">/^\.\//</span>, <span class="ruby-value str">''</span>)
524: 
525:         <span class="ruby-identifier">result</span>[<span class="ruby-identifier">filename</span>] = <span class="ruby-constant">File</span>.<span class="ruby-identifier">stat</span>(<span class="ruby-identifier">filename</span>).<span class="ruby-identifier">mtime</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">next</span>
526:         <span class="ruby-identifier">order</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">filename</span>
527:       <span class="ruby-keyword kw">end</span>
528:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">find_order</span>.<span class="ruby-identifier">push</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">order</span>.<span class="ruby-identifier">sort</span>)
529:     <span class="ruby-keyword kw">end</span>
530: 
531:     <span class="ruby-identifier">result</span>
532:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000054">
                    
                    <a name="M000054"></a><b>find_files_to_test</b>(files = find_files)
                    
                </div>
                
                <div class="description">
                  <p>
Find the files which have been modified, update the recorded timestamps,
and use this to update the files to test. Returns the latest mtime of the
files modified or nil when nothing was modified.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000054_source')" id="l_M000054_source">show</a>
                        
                    </p>
                    <div id="M000054_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/autotest.rb, line 540</span>
540:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">find_files_to_test</span> <span class="ruby-identifier">files</span> = <span class="ruby-identifier">find_files</span>
541:     <span class="ruby-identifier">updated</span> = <span class="ruby-identifier">files</span>.<span class="ruby-identifier">select</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">filename</span>, <span class="ruby-identifier">mtime</span><span class="ruby-operator">|</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">last_mtime</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">mtime</span> }
542: 
543:     <span class="ruby-comment cmt"># nothing to update or initially run</span>
544:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">updated</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">||</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">last_mtime</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-keyword kw">then</span>
545:       <span class="ruby-identifier">p</span> <span class="ruby-identifier">updated</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:verbose</span>]
546: 
547:       <span class="ruby-identifier">hook</span> <span class="ruby-identifier">:updated</span>, <span class="ruby-identifier">updated</span>
548:     <span class="ruby-keyword kw">end</span>
549: 
550:     <span class="ruby-identifier">updated</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">f</span>,<span class="ruby-identifier">m</span><span class="ruby-operator">|</span> <span class="ruby-identifier">test_files_for</span> <span class="ruby-identifier">f</span> }.<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">uniq</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">filename</span><span class="ruby-operator">|</span>
551:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">files_to_test</span>[<span class="ruby-identifier">filename</span>] <span class="ruby-comment cmt"># creates key with default value</span>
552:     <span class="ruby-keyword kw">end</span>
553: 
554:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">updated</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-keyword kw">then</span>
555:       <span class="ruby-keyword kw">nil</span>
556:     <span class="ruby-keyword kw">else</span>
557:       <span class="ruby-identifier">files</span>.<span class="ruby-identifier">values</span>.<span class="ruby-identifier">max</span>
558:     <span class="ruby-keyword kw">end</span>
559:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000029">
                    
                    <a name="M000029"></a><b>get_to_green</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Keep running the tests after a change, until all pass.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000029_source')" id="l_M000029_source">show</a>
                        
                    </p>
                    <div id="M000029_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/autotest.rb, line 355</span>
355:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_to_green</span>
356:     <span class="ruby-keyword kw">begin</span>
357:       <span class="ruby-identifier">run_tests</span>
358:       <span class="ruby-identifier">wait_for_changes</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">all_good</span>
359:     <span class="ruby-keyword kw">end</span> <span class="ruby-keyword kw">until</span> <span class="ruby-identifier">all_good</span>
360:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000057">
                    
                    <a name="M000057"></a><b>handle_results</b>(results)
                    
                </div>
                
                <div class="description">
                  <p>
Check results for failures, set the &#8220;bar&#8221; to red or green, and
if there are failures record this.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000057_source')" id="l_M000057_source">show</a>
                        
                    </p>
                    <div id="M000057_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/autotest.rb, line 565</span>
565:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">handle_results</span> <span class="ruby-identifier">results</span>
566:     <span class="ruby-identifier">results</span> = <span class="ruby-identifier">results</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/\e\[\d+m/</span>, <span class="ruby-value str">''</span>) <span class="ruby-comment cmt"># strip ascii color</span>
567:     <span class="ruby-identifier">failed</span> = <span class="ruby-identifier">results</span>.<span class="ruby-identifier">scan</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">failed_results_re</span>
568:     <span class="ruby-identifier">completed</span> = <span class="ruby-identifier">results</span>[<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">completed_re</span>]
569: 
570:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">completed</span> <span class="ruby-keyword kw">then</span>
571:       <span class="ruby-identifier">completed</span> = <span class="ruby-identifier">completed</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/(\d+) (\w+)/</span>).<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">v</span>, <span class="ruby-identifier">k</span><span class="ruby-operator">|</span> [<span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span>.<span class="ruby-identifier">to_i</span>] }
572: 
573:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">latest_results</span> = <span class="ruby-constant">Hash</span>[<span class="ruby-operator">*</span><span class="ruby-identifier">completed</span>.<span class="ruby-identifier">flatten</span>]
574:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">files_to_test</span>  = <span class="ruby-identifier">consolidate_failures</span> <span class="ruby-identifier">failed</span>
575: 
576:       <span class="ruby-identifier">color</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">files_to_test</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-value">? </span><span class="ruby-operator">:</span><span class="ruby-identifier">green</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">:red</span>
577:       <span class="ruby-identifier">hook</span> <span class="ruby-identifier">color</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">$TESTING</span>
578:     <span class="ruby-keyword kw">else</span>
579:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">latest_results</span> = <span class="ruby-keyword kw">nil</span>
580:     <span class="ruby-keyword kw">end</span>
581: 
582:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">tainted</span> = <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">files_to_test</span>.<span class="ruby-identifier">empty?</span>
583:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000080">
                    
                    <a name="M000080"></a><b>hook</b>(name, *args)
                    
                </div>
                
                <div class="description">
                  <p>
Call the event hook named <tt>name</tt>, passing in optional args depending
on the hook itself.
</p>
<p>
Returns false if no hook handled the event.
</p>
<h3>Hook Writers!</h3>
<p>
This executes all registered hooks <em>until one returns truthy</em>. Pay
attention to the return value of your block!
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000080_source')" id="l_M000080_source">show</a>
                        
                    </p>
                    <div id="M000080_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/autotest.rb, line 828</span>
828:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">hook</span> <span class="ruby-identifier">name</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>
829:     <span class="ruby-identifier">deprecated</span> = {
830:       <span class="ruby-comment cmt"># none currently</span>
831:     }
832: 
833:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">deprecated</span>[<span class="ruby-identifier">name</span>] <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">not</span> <span class="ruby-constant">HOOKS</span>[<span class="ruby-identifier">name</span>].<span class="ruby-identifier">empty?</span> <span class="ruby-keyword kw">then</span>
834:       <span class="ruby-identifier">warn</span> <span class="ruby-node">&quot;hook #{name} has been deprecated, use #{deprecated[name]}&quot;</span>
835:     <span class="ruby-keyword kw">end</span>
836: 
837:     <span class="ruby-constant">HOOKS</span>[<span class="ruby-identifier">name</span>].<span class="ruby-identifier">any?</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">plugin</span><span class="ruby-operator">|</span> <span class="ruby-identifier">plugin</span>[<span class="ruby-keyword kw">self</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>] }
838:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000058">
                    
                    <a name="M000058"></a><b>known_files</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Lazy accessor for the <a href="Autotest.html#M000058">known_files</a> hash.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000058_source')" id="l_M000058_source">show</a>
                        
                    </p>
                    <div id="M000058_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/autotest.rb, line 588</span>
588:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">known_files</span>
589:     <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@known_files</span> <span class="ruby-keyword kw">then</span>
590:       <span class="ruby-ivar">@known_files</span> = <span class="ruby-constant">Hash</span>[<span class="ruby-operator">*</span><span class="ruby-identifier">find_order</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span> [<span class="ruby-identifier">f</span>, <span class="ruby-keyword kw">true</span>] }.<span class="ruby-identifier">flatten</span>]
591:     <span class="ruby-keyword kw">end</span>
592:     <span class="ruby-ivar">@known_files</span>
593:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000061">
                    
                    <a name="M000061"></a><b>make_test_cmd</b>(files_to_test)
                    
                </div>
                
                <div class="description">
                  <p>
Generate the commands to test the supplied files
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000061_source')" id="l_M000061_source">show</a>
                        
                    </p>
                    <div id="M000061_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/autotest.rb, line 605</span>
605:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">make_test_cmd</span> <span class="ruby-identifier">files_to_test</span>
606:     <span class="ruby-identifier">cmds</span> = []
607:     <span class="ruby-identifier">full</span>, <span class="ruby-identifier">partial</span> = <span class="ruby-identifier">reorder</span>(<span class="ruby-identifier">files_to_test</span>).<span class="ruby-identifier">partition</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">empty?</span> }
608:     <span class="ruby-identifier">diff</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">unit_diff</span>
609:     <span class="ruby-identifier">diff</span> = <span class="ruby-node">&quot; | #{diff}&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">diff</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">diff</span> <span class="ruby-operator">!~</span> <span class="ruby-regexp re">/^\|/</span>
610: 
611:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">full</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-keyword kw">then</span>
612:       <span class="ruby-identifier">classes</span> = <span class="ruby-identifier">full</span>.<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">k</span>}.<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">uniq</span>
613:       <span class="ruby-identifier">classes</span>.<span class="ruby-identifier">unshift</span> <span class="ruby-identifier">testlib</span>
614:       <span class="ruby-identifier">classes</span> = <span class="ruby-identifier">classes</span>.<span class="ruby-identifier">join</span> <span class="ruby-value str">&quot; &quot;</span>
615:       <span class="ruby-identifier">cmds</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;#{ruby_cmd} -e \&quot;%w[#{classes}].each { |f| require f }\&quot;#{diff}&quot;</span>
616:     <span class="ruby-keyword kw">end</span>
617: 
618:     <span class="ruby-identifier">partial</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">klass</span>, <span class="ruby-identifier">methods</span><span class="ruby-operator">|</span>
619:       <span class="ruby-identifier">regexp</span> = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">union</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">methods</span>).<span class="ruby-identifier">source</span>
620:       <span class="ruby-identifier">cmds</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;#{ruby_cmd} #{klass} -n \&quot;/^(#{regexp})$/\&quot;#{diff}&quot;</span>
621:     <span class="ruby-keyword kw">end</span>
622: 
623:     <span class="ruby-identifier">cmds</span>.<span class="ruby-identifier">join</span> <span class="ruby-node">&quot;#{SEP} &quot;</span>
624:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000063">
                    
                    <a name="M000063"></a><b>new_hash_of_arrays</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000063_source')" id="l_M000063_source">show</a>
                        
                    </p>
                    <div id="M000063_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/autotest.rb, line 626</span>
626:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">new_hash_of_arrays</span>
627:     <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">h</span>,<span class="ruby-identifier">k</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">k</span>] = [] }
628:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000009">
                    
                    <a name="M000009"></a><b>old_run_tests</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Alias for <a href="Autotest.html#M000008">run_tests</a>
</p>

                </div>
                
                
                
            </div>
            
            <div class="method">
                <div class="title" id="M000014">
                    
                    <a name="M000014"></a><b>options</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000014_source')" id="l_M000014_source">show</a>
                        
                    </p>
                    <div id="M000014_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/autotest.rb, line 73</span>
73:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">options</span>
74:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">options</span>
75:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000045">
                    
                    <a name="M000045"></a><b>path_to_classname</b>(s)
                    
                </div>
                
                <div class="description">
                  <p>
Convert a path in a string, s, into a class name, changing underscores to
CamelCase, etc.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000045_source')" id="l_M000045_source">show</a>
                        
                    </p>
                    <div id="M000045_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/autotest.rb, line 471</span>
471:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">path_to_classname</span> <span class="ruby-identifier">s</span>
472:     <span class="ruby-identifier">sep</span> = <span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">SEPARATOR</span>
473:     <span class="ruby-identifier">f</span> = <span class="ruby-identifier">s</span>.<span class="ruby-identifier">sub</span>(<span class="ruby-node">/^test#{sep}/</span>, <span class="ruby-value str">''</span>).<span class="ruby-identifier">sub</span>(<span class="ruby-regexp re">/\.rb$/</span>, <span class="ruby-value str">''</span>).<span class="ruby-identifier">split</span> <span class="ruby-identifier">sep</span>
474:     <span class="ruby-identifier">f</span> = <span class="ruby-identifier">f</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">path</span><span class="ruby-operator">|</span> <span class="ruby-identifier">path</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp re">/_|(\d+)/</span>).<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">seg</span><span class="ruby-operator">|</span> <span class="ruby-identifier">seg</span>.<span class="ruby-identifier">capitalize</span> }.<span class="ruby-identifier">join</span> }
475:     <span class="ruby-identifier">f</span> = <span class="ruby-identifier">f</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">path</span><span class="ruby-operator">|</span> <span class="ruby-identifier">path</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/^Test/</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">path</span> <span class="ruby-operator">:</span> <span class="ruby-node">&quot;Test#{path}&quot;</span>  }
476: 
477:     <span class="ruby-identifier">f</span>.<span class="ruby-identifier">join</span> <span class="ruby-value str">'::'</span>
478:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000077">
                    
                    <a name="M000077"></a><b>remove_exception</b>(regexp)
                    
                </div>
                
                <div class="description">
                  <p>
Removes <tt>regexp</tt> to the list of exceptions for find_file. This must
be called <em>before</em> the exceptions are compiled.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000077_source')" id="l_M000077_source">show</a>
                        
                    </p>
                    <div id="M000077_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/autotest.rb, line 781</span>
781:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">remove_exception</span> <span class="ruby-identifier">regexp</span>
782:     <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;exceptions already compiled&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">defined?</span> <span class="ruby-ivar">@exceptions</span>
783:     <span class="ruby-ivar">@exception_list</span>.<span class="ruby-identifier">delete</span> <span class="ruby-identifier">regexp</span>
784:     <span class="ruby-keyword kw">nil</span>
785:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000072">
                    
                    <a name="M000072"></a><b>remove_mapping</b>(regexp)
                    
                </div>
                
                <div class="description">
                  <p>
Removed a file mapping matching <tt>regexp</tt>.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000072_source')" id="l_M000072_source">show</a>
                        
                    </p>
                    <div id="M000072_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/autotest.rb, line 746</span>
746:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">remove_mapping</span> <span class="ruby-identifier">regexp</span>
747:     <span class="ruby-ivar">@test_mappings</span>.<span class="ruby-identifier">delete_if</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
748:       <span class="ruby-identifier">k</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">regexp</span>
749:     <span class="ruby-keyword kw">end</span>
750:     <span class="ruby-keyword kw">nil</span>
751:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000064">
                    
                    <a name="M000064"></a><b>reorder</b>(files_to_test)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000064_source')" id="l_M000064_source">show</a>
                        
                    </p>
                    <div id="M000064_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/autotest.rb, line 630</span>
630:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">reorder</span> <span class="ruby-identifier">files_to_test</span>
631:     <span class="ruby-keyword kw">case</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">order</span>
632:     <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:alpha</span> <span class="ruby-keyword kw">then</span>
633:       <span class="ruby-identifier">files_to_test</span>.<span class="ruby-identifier">sort_by</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">k</span> }
634:     <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:reverse</span> <span class="ruby-keyword kw">then</span>
635:       <span class="ruby-identifier">files_to_test</span>.<span class="ruby-identifier">sort_by</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">k</span> }.<span class="ruby-identifier">reverse</span>
636:     <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:random</span> <span class="ruby-keyword kw">then</span>
637:       <span class="ruby-identifier">max</span> = <span class="ruby-identifier">files_to_test</span>.<span class="ruby-identifier">size</span>
638:       <span class="ruby-identifier">files_to_test</span>.<span class="ruby-identifier">sort_by</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">rand</span> <span class="ruby-identifier">max</span> }
639:     <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:natural</span> <span class="ruby-keyword kw">then</span>
640:       (<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">find_order</span> <span class="ruby-operator">&amp;</span> <span class="ruby-identifier">files_to_test</span>.<span class="ruby-identifier">keys</span>).<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span> [<span class="ruby-identifier">f</span>, <span class="ruby-identifier">files_to_test</span>[<span class="ruby-identifier">f</span>]] }
641:     <span class="ruby-keyword kw">else</span>
642:       <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;unknown order type: #{self.order.inspect}&quot;</span>
643:     <span class="ruby-keyword kw">end</span>
644:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000065">
                    
                    <a name="M000065"></a><b>rerun_all_tests</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Rerun the tests from cold (reset state)
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000065_source')" id="l_M000065_source">show</a>
                        
                    </p>
                    <div id="M000065_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/autotest.rb, line 649</span>
649:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">rerun_all_tests</span>
650:     <span class="ruby-identifier">reset</span>
651:     <span class="ruby-identifier">run_tests</span>
652: 
653:     <span class="ruby-identifier">hook</span> <span class="ruby-identifier">:all_good</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">all_good</span>
654:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000066">
                    
                    <a name="M000066"></a><b>reset</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Clear all state information about test failures and whether interrupts will
kill autotest.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000066_source')" id="l_M000066_source">show</a>
                        
                    </p>
                    <div id="M000066_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/autotest.rb, line 660</span>
660:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">reset</span>
661:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">files_to_test</span>.<span class="ruby-identifier">clear</span>
662:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">find_order</span>.<span class="ruby-identifier">clear</span>
663: 
664:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">interrupted</span>   = <span class="ruby-keyword kw">false</span>
665:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">known_files</span>   = <span class="ruby-keyword kw">nil</span>
666:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">last_mtime</span>    = <span class="ruby-constant">T0</span>
667:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">tainted</span>       = <span class="ruby-keyword kw">false</span>
668:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">wants_to_quit</span> = <span class="ruby-keyword kw">false</span>
669: 
670:     <span class="ruby-identifier">hook</span> <span class="ruby-identifier">:reset</span>
671:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000042">
                    
                    <a name="M000042"></a><b>restart</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000042_source')" id="l_M000042_source">show</a>
                        
                    </p>
                    <div id="M000042_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/autotest.rb, line 442</span>
442:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">restart</span>
443:     <span class="ruby-constant">Process</span>.<span class="ruby-identifier">kill</span> <span class="ruby-value str">&quot;KILL&quot;</span>, <span class="ruby-ivar">@child</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@child</span>
444: 
445:     <span class="ruby-identifier">cmd</span> = [<span class="ruby-identifier">$0</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">options</span>[<span class="ruby-identifier">:args</span>]]
446: 
447:     <span class="ruby-identifier">index</span> = <span class="ruby-identifier">$LOAD_PATH</span>.<span class="ruby-identifier">index</span> <span class="ruby-constant">RbConfig</span><span class="ruby-operator">::</span><span class="ruby-constant">CONFIG</span>[<span class="ruby-value str">&quot;sitelibdir&quot;</span>]
448: 
449:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">index</span> <span class="ruby-keyword kw">then</span>
450:       <span class="ruby-identifier">extra</span> = <span class="ruby-identifier">$LOAD_PATH</span>[<span class="ruby-value">0</span><span class="ruby-operator">...</span><span class="ruby-identifier">index</span>]
451:       <span class="ruby-identifier">cmd</span> = [<span class="ruby-constant">Gem</span>.<span class="ruby-identifier">ruby</span>, <span class="ruby-value str">&quot;-I&quot;</span>, <span class="ruby-identifier">extra</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;:&quot;</span>)] <span class="ruby-operator">+</span> <span class="ruby-identifier">cmd</span>
452:     <span class="ruby-keyword kw">end</span>
453: 
454:     <span class="ruby-identifier">puts</span> <span class="ruby-identifier">cmd</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot; &quot;</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:verbose</span>]
455: 
456:     <span class="ruby-identifier">exec</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">cmd</span>)
457:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000067">
                    
                    <a name="M000067"></a><b>ruby</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Determine and return the path of the ruby executable.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000067_source')" id="l_M000067_source">show</a>
                        
                    </p>
                    <div id="M000067_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/autotest.rb, line 676</span>
676:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">ruby</span>
677:     <span class="ruby-identifier">ruby</span> = <span class="ruby-constant">ENV</span>[<span class="ruby-value str">'RUBY'</span>]
678:     <span class="ruby-identifier">ruby</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-constant">RbConfig</span><span class="ruby-operator">::</span><span class="ruby-constant">CONFIG</span>[<span class="ruby-value str">'bindir'</span>],
679:                        <span class="ruby-constant">RbConfig</span><span class="ruby-operator">::</span><span class="ruby-constant">CONFIG</span>[<span class="ruby-value str">'ruby_install_name'</span>])
680: 
681:     <span class="ruby-identifier">ruby</span>.<span class="ruby-identifier">gsub!</span> <span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">SEPARATOR</span>, <span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">ALT_SEPARATOR</span> <span class="ruby-keyword kw">if</span> <span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">ALT_SEPARATOR</span>
682: 
683:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">ruby</span>
684:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000060">
                    
                    <a name="M000060"></a><b>ruby_cmd</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Returns the base of the ruby command.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000060_source')" id="l_M000060_source">show</a>
                        
                    </p>
                    <div id="M000060_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/autotest.rb, line 598</span>
598:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">ruby_cmd</span>
599:     <span class="ruby-node">&quot;#{prefix}#{ruby} -I#{libs} -rubygems&quot;</span>
600:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000025">
                    
                    <a name="M000025"></a><b>run</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Repeatedly run failed tests, then all tests, then wait for changes and
carry on until killed.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000025_source')" id="l_M000025_source">show</a>
                        
                    </p>
                    <div id="M000025_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/autotest.rb, line 324</span>
324:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">run</span>
325:     <span class="ruby-identifier">hook</span> <span class="ruby-identifier">:initialize</span>
326:     <span class="ruby-identifier">hook</span> <span class="ruby-identifier">:post_initialize</span>
327: 
328:     <span class="ruby-identifier">reset</span>
329:     <span class="ruby-identifier">add_sigint_handler</span>
330: 
331:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">last_mtime</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:no_full_after_start</span>]
332: 
333:     <span class="ruby-identifier">loop</span> <span class="ruby-keyword kw">do</span>
334:       <span class="ruby-keyword kw">begin</span> <span class="ruby-comment cmt"># ^c handler</span>
335:         <span class="ruby-identifier">get_to_green</span>
336:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">tainted?</span> <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">not</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:no_full_after_failed</span>] <span class="ruby-keyword kw">then</span>
337:           <span class="ruby-identifier">rerun_all_tests</span>
338:         <span class="ruby-keyword kw">else</span>
339:           <span class="ruby-identifier">hook</span> <span class="ruby-identifier">:all_good</span>
340:         <span class="ruby-keyword kw">end</span>
341:         <span class="ruby-identifier">wait_for_changes</span>
342:       <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Interrupt</span>
343:         <span class="ruby-keyword kw">break</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">wants_to_quit</span>
344:         <span class="ruby-identifier">reset</span>
345:       <span class="ruby-keyword kw">end</span>
346:     <span class="ruby-keyword kw">end</span>
347:     <span class="ruby-identifier">hook</span> <span class="ruby-identifier">:quit</span>
348:   <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">err</span>
349:     <span class="ruby-identifier">hook</span>(<span class="ruby-identifier">:died</span>, <span class="ruby-identifier">err</span>) <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">raise</span> <span class="ruby-identifier">err</span>
350:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000030">
                    
                    <a name="M000030"></a><b>run_tests</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Look for files to test then run the tests and handle the results.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000030_source')" id="l_M000030_source">show</a>
                        
                    </p>
                    <div id="M000030_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/autotest.rb, line 365</span>
365:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">run_tests</span>
366:     <span class="ruby-identifier">hook</span> <span class="ruby-identifier">:run_command</span>
367: 
368:     <span class="ruby-identifier">new_mtime</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">find_files_to_test</span>
369:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">new_mtime</span>
370:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">last_mtime</span> = <span class="ruby-identifier">new_mtime</span>
371: 
372:     <span class="ruby-identifier">cmd</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">make_test_cmd</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">files_to_test</span>
373:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">cmd</span>.<span class="ruby-identifier">empty?</span>
374: 
375:     <span class="ruby-identifier">puts</span> <span class="ruby-identifier">cmd</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:quiet</span>]
376: 
377:     <span class="ruby-identifier">old_sync</span> = <span class="ruby-identifier">$stdout</span>.<span class="ruby-identifier">sync</span>
378:     <span class="ruby-identifier">$stdout</span>.<span class="ruby-identifier">sync</span> = <span class="ruby-keyword kw">true</span>
379:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">results</span> = []
380:     <span class="ruby-identifier">line</span> = []
381:     <span class="ruby-keyword kw">begin</span>
382:       <span class="ruby-identifier">open</span> <span class="ruby-node">&quot;| #{cmd}&quot;</span>, <span class="ruby-value str">&quot;r&quot;</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span>
383:         <span class="ruby-keyword kw">until</span> <span class="ruby-identifier">f</span>.<span class="ruby-identifier">eof?</span> <span class="ruby-keyword kw">do</span>
384:           <span class="ruby-identifier">c</span> = <span class="ruby-identifier">f</span>.<span class="ruby-identifier">getc</span> <span class="ruby-keyword kw">or</span> <span class="ruby-keyword kw">break</span>
385:           <span class="ruby-keyword kw">if</span> <span class="ruby-constant">RUBY19</span> <span class="ruby-keyword kw">then</span>
386:             <span class="ruby-identifier">print</span> <span class="ruby-identifier">c</span>
387:           <span class="ruby-keyword kw">else</span>
388:             <span class="ruby-identifier">putc</span> <span class="ruby-identifier">c</span>
389:           <span class="ruby-keyword kw">end</span>
390:           <span class="ruby-identifier">line</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">c</span>
391:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">c</span> <span class="ruby-operator">==</span> <span class="ruby-value">?\n</span> <span class="ruby-keyword kw">then</span>
392:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">results</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-constant">RUBY19</span> <span class="ruby-keyword kw">then</span>
393:                               <span class="ruby-identifier">line</span>.<span class="ruby-identifier">join</span>
394:                             <span class="ruby-keyword kw">else</span>
395:                               <span class="ruby-identifier">line</span>.<span class="ruby-identifier">pack</span> <span class="ruby-value str">&quot;c*&quot;</span>
396:                             <span class="ruby-keyword kw">end</span>
397:             <span class="ruby-identifier">line</span>.<span class="ruby-identifier">clear</span>
398:           <span class="ruby-keyword kw">end</span>
399:         <span class="ruby-keyword kw">end</span>
400:       <span class="ruby-keyword kw">end</span>
401:     <span class="ruby-keyword kw">ensure</span>
402:       <span class="ruby-identifier">$stdout</span>.<span class="ruby-identifier">sync</span> = <span class="ruby-identifier">old_sync</span>
403:     <span class="ruby-keyword kw">end</span>
404:     <span class="ruby-identifier">hook</span> <span class="ruby-identifier">:ran_command</span>
405:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">results</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">results</span>.<span class="ruby-identifier">join</span>
406: 
407:     <span class="ruby-identifier">handle_results</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">results</span>
408:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000008">
                    
                    <a name="M000008"></a><b>run_tests</b>()
                    
                </div>
                
                
                <div class="aka">
                    This method is also aliased as
                    
                    <a href="Autotest.html#M000009">old_run_tests</a>
                    
                </div>
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000008_source')" id="l_M000008_source">show</a>
                        
                    </p>
                    <div id="M000008_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/autotest/preload.rb, line 29</span>
29:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">run_tests</span>
30:     <span class="ruby-identifier">hook</span> <span class="ruby-identifier">:run_command</span>
31: 
32:     <span class="ruby-identifier">new_mtime</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">find_files_to_test</span>
33:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">new_mtime</span>
34:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">last_mtime</span> = <span class="ruby-identifier">new_mtime</span>
35: 
36:     <span class="ruby-keyword kw">begin</span>
37:       <span class="ruby-comment cmt"># TODO: deal with unit_diff and partial test runs later</span>
38:       <span class="ruby-identifier">original_argv</span> = <span class="ruby-constant">ARGV</span>.<span class="ruby-identifier">dup</span>
39:       <span class="ruby-constant">ARGV</span>.<span class="ruby-identifier">clear</span>
40: 
41:       <span class="ruby-ivar">@child</span> = <span class="ruby-identifier">fork</span> <span class="ruby-keyword kw">do</span>
42:         <span class="ruby-identifier">trap</span> <span class="ruby-value str">&quot;QUIT&quot;</span>, <span class="ruby-value str">&quot;DEFAULT&quot;</span>
43:         <span class="ruby-identifier">trap</span> <span class="ruby-value str">&quot;INT&quot;</span>, <span class="ruby-value str">&quot;DEFAULT&quot;</span>
44:         <span class="ruby-identifier">files_to_test</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span>
45:           <span class="ruby-identifier">load</span> <span class="ruby-identifier">file</span>
46:         <span class="ruby-keyword kw">end</span>
47:       <span class="ruby-keyword kw">end</span>
48:       <span class="ruby-constant">Process</span>.<span class="ruby-identifier">wait</span>
49:     <span class="ruby-keyword kw">ensure</span>
50:       <span class="ruby-ivar">@child</span> = <span class="ruby-keyword kw">nil</span>
51:       <span class="ruby-constant">ARGV</span>.<span class="ruby-identifier">replace</span> <span class="ruby-identifier">original_argv</span>
52:     <span class="ruby-keyword kw">end</span>
53: 
54:     <span class="ruby-identifier">hook</span> <span class="ruby-identifier">:ran_command</span>
55:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000068">
                    
                    <a name="M000068"></a><b>test_files_for</b>(filename)
                    
                </div>
                
                <div class="description">
                  <p>
Return the name of the file with the tests for filename by finding a
<tt>test_mapping</tt> that matches the file and executing the
mapping&#8217;s proc.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000068_source')" id="l_M000068_source">show</a>
                        
                    </p>
                    <div id="M000068_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/autotest.rb, line 691</span>
691:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_files_for</span> <span class="ruby-identifier">filename</span>
692:     <span class="ruby-identifier">result</span> = <span class="ruby-ivar">@test_mappings</span>.<span class="ruby-identifier">find</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">file_re</span>, <span class="ruby-identifier">ignored</span><span class="ruby-operator">|</span> <span class="ruby-identifier">filename</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">file_re</span> }
693: 
694:     <span class="ruby-identifier">p</span> <span class="ruby-identifier">:test_file_for</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">filename</span>, <span class="ruby-identifier">result</span>.<span class="ruby-identifier">first</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">result</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">$DEBUG</span>
695: 
696:     <span class="ruby-identifier">result</span> = <span class="ruby-identifier">result</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-value">? </span>[] <span class="ruby-operator">:</span> [<span class="ruby-identifier">result</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">filename</span>, <span class="ruby-identifier">$~</span>)].<span class="ruby-identifier">flatten</span>
697: 
698:     <span class="ruby-identifier">output</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;No tests matched #{filename}&quot;</span> <span class="ruby-keyword kw">if</span>
699:       (<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:verbose</span>] <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">$TESTING</span>) <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">result</span>.<span class="ruby-identifier">empty?</span>
700: 
701:     <span class="ruby-identifier">result</span>.<span class="ruby-identifier">sort</span>.<span class="ruby-identifier">uniq</span>.<span class="ruby-identifier">select</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span> <span class="ruby-identifier">known_files</span>[<span class="ruby-identifier">f</span>] }
702:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000069">
                    
                    <a name="M000069"></a><b>wait_for_changes</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Sleep then look for files to test, until there are some.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000069_source')" id="l_M000069_source">show</a>
                        
                    </p>
                    <div id="M000069_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/autotest.rb, line 707</span>
707:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">wait_for_changes</span>
708:     <span class="ruby-identifier">hook</span> <span class="ruby-identifier">:waiting</span>
709:     <span class="ruby-constant">Kernel</span>.<span class="ruby-identifier">sleep</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">sleep</span> <span class="ruby-keyword kw">until</span> <span class="ruby-identifier">find_files_to_test</span>
710:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    