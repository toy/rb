<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>Haml::HTML::ERB</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../../css/main.css" type="text/css" media="screen" />
    <script src="../../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Class</span> 
            Haml::HTML::ERB 
            
                <span class="parent">&lt; 
                    
                    Erubis::Basic::Engine
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../../files/lib/haml/html/erb_rb.html">lib/haml/html/erb.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    
    <div class="description">
        <p>
A class for converting <a href="ERB.html">ERB</a> code into a format
that&#8217;s easier for the {Haml::HTML} Hpricot-based parser to
understand.
</p>
<p>
Uses [Erubis](<a
href="http://www.kuwata-lab.com/erubis)'s">www.kuwata-lab.com/erubis)'s</a>
extensible parsing powers to parse the <a href="ERB.html">ERB</a> in a
reliable way, and [ruby_parser](<a
href="http://parsetree.rubyforge.org/)'s">parsetree.rubyforge.org/)'s</a>
Ruby knowledge to figure out whether a given chunk of Ruby code starts a
block or not.
</p>
<p>
The <a href="ERB.html">ERB</a> tags are converted to <a
href="../HTML.html">HTML</a> tags in the following way. `<% &#8230; %>` is
converted into `<haml:silent> &#8230; </haml:silent>`. `<%= &#8230; %>` is
converted into `<haml:loud> &#8230; </haml:loud>`. Finally, if either of
these opens a Ruby block, `<haml:block> &#8230; </haml:block>` will wrap
the entire contents of the block - that is, everything that should be
indented beneath the previous silent or loud tag.
</p>

    </div>
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>A</dt>
        <dd>
            <ul>
                
                <li><a href="#M000179">add_expr_debug</a>,</li>
                
                <li><a href="#M000177">add_expr_literal</a>,</li>
                
                <li><a href="#M000172">add_postamble</a>,</li>
                
                <li><a href="#M000171">add_preamble</a>,</li>
                
                <li><a href="#M000176">add_stmt</a>,</li>
                
                <li><a href="#M000173">add_text</a></li>
                
            </ul>
        </dd>
    
        <dt>B</dt>
        <dd>
            <ul>
                
                <li><a href="#M000184">block_closer?</a>,</li>
                
                <li><a href="#M000183">block_opener?</a></li>
                
            </ul>
        </dd>
    
        <dt>C</dt>
        <dd>
            <ul>
                
                <li><a href="#M000169">compile</a></li>
                
            </ul>
        </dd>
    
        <dt>E</dt>
        <dd>
            <ul>
                
                <li><a href="#M000170">escaped_expr</a></li>
                
            </ul>
        </dd>
    
        <dt>H</dt>
        <dd>
            <ul>
                
                <li><a href="#M000180">h</a></li>
                
            </ul>
        </dd>
    
        <dt>M</dt>
        <dd>
            <ul>
                
                <li><a href="#M000185">mid_block?</a></li>
                
            </ul>
        </dd>
    
        <dt>V</dt>
        <dd>
            <ul>
                
                <li><a href="#M000181">valid_ruby?</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    

    

    

    

    

    
            <div class="sectiontitle">Class Public methods</div>
            
            <div class="method">
                <div class="title" id="M000169">
                    
                    <a name="M000169"></a><b>compile</b>(template)
                    
                </div>
                
                <div class="description">
                  <p>
Compiles an <a href="ERB.html">ERB</a> template into a <a
href="../HTML.html">HTML</a> document containing `haml:` tags.
</p>
<p>
@param template [String] The <a href="ERB.html">ERB</a> template @return
[String] The output document @see <a href="ERB.html">Haml::HTML::ERB</a>
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000169_source')" id="l_M000169_source">show</a>
                        
                    </p>
                    <div id="M000169_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/haml/html/erb.rb, line 27</span>
27:       <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">compile</span>(<span class="ruby-identifier">template</span>)
28:         <span class="ruby-identifier">new</span>(<span class="ruby-identifier">template</span>).<span class="ruby-identifier">src</span>
29:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M000179">
                    
                    <a name="M000179"></a><b>add_expr_debug</b>(src, code)
                    
                </div>
                
                <div class="description">
                  <p>
`html2haml` doesn&#8217;t support debugging expressions.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000179_source')" id="l_M000179_source">show</a>
                        
                    </p>
                    <div id="M000179_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/haml/html/erb.rb, line 81</span>
81:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_expr_debug</span>(<span class="ruby-identifier">src</span>, <span class="ruby-identifier">code</span>)
82:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">Haml</span><span class="ruby-operator">::</span><span class="ruby-constant">Error</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;html2haml doesn't support debugging expressions.&quot;</span>)
83:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000177">
                    
                    <a name="M000177"></a><b>add_expr_literal</b>(src, code)
                    
                </div>
                
                <div class="description">
                  <p>
Concatenates a Ruby expression that&#8217;s printed to the document onto
the source buffer. This uses the `<haml:silent>` tag, and may open a Ruby
block with the `<haml:block>` tag. An expression never closes a block.
</p>
<p>
@param src [String] The source buffer @param code [String] The Ruby
expression to add to the buffer
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000177_source')" id="l_M000177_source">show</a>
                        
                    </p>
                    <div id="M000177_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/haml/html/erb.rb, line 75</span>
75:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_expr_literal</span>(<span class="ruby-identifier">src</span>, <span class="ruby-identifier">code</span>)
76:         <span class="ruby-identifier">src</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">'&lt;haml:loud&gt;'</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">h</span>(<span class="ruby-identifier">code</span>) <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">'&lt;/haml:loud&gt;'</span>
77:         <span class="ruby-identifier">src</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">'&lt;haml:block&gt;'</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block_opener?</span>(<span class="ruby-identifier">code</span>)
78:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000172">
                    
                    <a name="M000172"></a><b>add_postamble</b>(src)
                    
                </div>
                
                <div class="description">
                  <p>
The ERB-to-Hamlized-<a href="../HTML.html">HTML</a> conversion has no
postamble.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000172_source')" id="l_M000172_source">show</a>
                        
                    </p>
                    <div id="M000172_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/haml/html/erb.rb, line 40</span>
40:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_postamble</span>(<span class="ruby-identifier">src</span>); <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000171">
                    
                    <a name="M000171"></a><b>add_preamble</b>(src)
                    
                </div>
                
                <div class="description">
                  <p>
The ERB-to-Hamlized-<a href="../HTML.html">HTML</a> conversion has no
preamble.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000171_source')" id="l_M000171_source">show</a>
                        
                    </p>
                    <div id="M000171_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/haml/html/erb.rb, line 37</span>
37:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_preamble</span>(<span class="ruby-identifier">src</span>); <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000176">
                    
                    <a name="M000176"></a><b>add_stmt</b>(src, code)
                    
                </div>
                
                <div class="description">
                  <p>
Concatenates a silent Ruby statement onto the source buffer. This uses the
`<haml:silent>` tag, and may close and/or open a Ruby block with the
`<haml:block>` tag.
</p>
<p>
In particular, a block is closed if this statement is some form of `end`,
opened if it&#8217;s a block opener like `do`, `if`, or `begin`, and both
closed and opened if it&#8217;s a mid-block keyword like `else` or `when`.
</p>
<p>
@param src [String] The source buffer @param code [String] The Ruby
statement to add to the buffer
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000176_source')" id="l_M000176_source">show</a>
                        
                    </p>
                    <div id="M000176_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/haml/html/erb.rb, line 61</span>
61:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_stmt</span>(<span class="ruby-identifier">src</span>, <span class="ruby-identifier">code</span>)
62:         <span class="ruby-identifier">src</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">'&lt;/haml:block&gt;'</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block_closer?</span>(<span class="ruby-identifier">code</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">mid_block?</span>(<span class="ruby-identifier">code</span>)
63:         <span class="ruby-identifier">src</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">'&lt;haml:silent&gt;'</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">h</span>(<span class="ruby-identifier">code</span>) <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">'&lt;/haml:silent&gt;'</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">code</span>.<span class="ruby-identifier">strip</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;end&quot;</span>
64:         <span class="ruby-identifier">src</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">'&lt;haml:block&gt;'</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block_opener?</span>(<span class="ruby-identifier">code</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">mid_block?</span>(<span class="ruby-identifier">code</span>)
65:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000173">
                    
                    <a name="M000173"></a><b>add_text</b>(src, text)
                    
                </div>
                
                <div class="description">
                  <p>
Concatenates the text onto the source buffer.
</p>
<p>
@param src [String] The source buffer @param text [String] The raw text to
add to the buffer
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000173_source')" id="l_M000173_source">show</a>
                        
                    </p>
                    <div id="M000173_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/haml/html/erb.rb, line 46</span>
46:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_text</span>(<span class="ruby-identifier">src</span>, <span class="ruby-identifier">text</span>)
47:         <span class="ruby-identifier">src</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">text</span>
48:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000170">
                    
                    <a name="M000170"></a><b>escaped_expr</b>(code)
                    
                </div>
                
                <div class="description">
                  <p>
`html2haml` doesn&#8217;t support HTML-escaped expressions.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000170_source')" id="l_M000170_source">show</a>
                        
                    </p>
                    <div id="M000170_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/haml/html/erb.rb, line 32</span>
32:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">escaped_expr</span>(<span class="ruby-identifier">code</span>)
33:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">Haml</span><span class="ruby-operator">::</span><span class="ruby-constant">Error</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;html2haml doesn't support escaped expressions.&quot;</span>)
34:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Private methods</div>
            
            <div class="method">
                <div class="title" id="M000184">
                    
                    <a name="M000184"></a><b>block_closer?</b>(code)
                    
                </div>
                
                <div class="description">
                  <p>
Checks if a string of Ruby code closes a block. This is always `end`
followed optionally by some method calls.
</p>
<p>
@param code [String] Ruby code to check @return [Boolean]
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000184_source')" id="l_M000184_source">show</a>
                        
                    </p>
                    <div id="M000184_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/haml/html/erb.rb, line 123</span>
123:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">block_closer?</span>(<span class="ruby-identifier">code</span>)
124:         <span class="ruby-identifier">valid_ruby?</span>(<span class="ruby-value str">&quot;begin\n&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">code</span>)
125:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000183">
                    
                    <a name="M000183"></a><b>block_opener?</b>(code)
                    
                </div>
                
                <div class="description">
                  <p>
Checks if a string of Ruby code opens a block. This could either be
something like `foo do |a|` or a keyword that requires a matching `end`
like `if`, `begin`, or `case`.
</p>
<p>
@param code [String] Ruby code to check @return [Boolean]
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000183_source')" id="l_M000183_source">show</a>
                        
                    </p>
                    <div id="M000183_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/haml/html/erb.rb, line 113</span>
113:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">block_opener?</span>(<span class="ruby-identifier">code</span>)
114:         <span class="ruby-identifier">valid_ruby?</span>(<span class="ruby-identifier">code</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;\nend&quot;</span>) <span class="ruby-operator">||</span>
115:           <span class="ruby-identifier">valid_ruby?</span>(<span class="ruby-identifier">code</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;\nwhen foo\nend&quot;</span>)
116:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000180">
                    
                    <a name="M000180"></a><b>h</b>(text)
                    
                </div>
                
                <div class="description">
                  <p>
HTML-escaped some text (in practice, always Ruby code). A utility method.
</p>
<p>
@param text [String] The text to escape @return [String] The escaped text
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000180_source')" id="l_M000180_source">show</a>
                        
                    </p>
                    <div id="M000180_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/haml/html/erb.rb, line 92</span>
92:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">h</span>(<span class="ruby-identifier">text</span>)
93:         <span class="ruby-constant">CGI</span>.<span class="ruby-identifier">escapeHTML</span>(<span class="ruby-identifier">text</span>)
94:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000185">
                    
                    <a name="M000185"></a><b>mid_block?</b>(code)
                    
                </div>
                
                <div class="description">
                  <p>
Checks if a string of Ruby code comes in the middle of a block. This could
be a keyword like `else`, `rescue`, or `when`, or even `end` with a method
call that takes a block.
</p>
<p>
@param code [String] Ruby code to check @return [Boolean]
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000185_source')" id="l_M000185_source">show</a>
                        
                    </p>
                    <div id="M000185_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/haml/html/erb.rb, line 133</span>
133:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">mid_block?</span>(<span class="ruby-identifier">code</span>)
134:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">valid_ruby?</span>(<span class="ruby-identifier">code</span>)
135:         <span class="ruby-identifier">valid_ruby?</span>(<span class="ruby-node">&quot;if foo\n#{code}\nend&quot;</span>) <span class="ruby-operator">||</span> <span class="ruby-comment cmt"># else, elsif</span>
136:           <span class="ruby-identifier">valid_ruby?</span>(<span class="ruby-node">&quot;begin\n#{code}\nend&quot;</span>) <span class="ruby-operator">||</span> <span class="ruby-comment cmt"># rescue, ensure</span>
137:           <span class="ruby-identifier">valid_ruby?</span>(<span class="ruby-node">&quot;case foo\n#{code}\nend&quot;</span>) <span class="ruby-comment cmt"># when</span>
138:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000181">
                    
                    <a name="M000181"></a><b>valid_ruby?</b>(code)
                    
                </div>
                
                <div class="description">
                  <p>
Returns whether the code is valid Ruby code on its own.
</p>
<p>
@param code [String] Ruby code to check @return [Boolean]
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000181_source')" id="l_M000181_source">show</a>
                        
                    </p>
                    <div id="M000181_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/haml/html/erb.rb, line 100</span>
100:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">valid_ruby?</span>(<span class="ruby-identifier">code</span>)
101:         <span class="ruby-constant">RubyParser</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">code</span>)
102:       <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Racc</span><span class="ruby-operator">::</span><span class="ruby-constant">ParseError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
103:         <span class="ruby-keyword kw">false</span>
104:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    