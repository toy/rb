<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>Haml::Parser</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../css/main.css" type="text/css" media="screen" />
    <script src="../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Module</span> 
            Haml::Parser 
            
        </h1>
        <ul class="files">
            
            <li><a href="../../files/lib/haml/parser_rb.html">lib/haml/parser.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>B</dt>
        <dd>
            <ul>
                
                <li><a href="#M000286">balance</a>,</li>
                
                <li><a href="#M000239">block_keyword</a>,</li>
                
                <li><a href="#M000288">block_opened?</a></li>
                
            </ul>
        </dd>
    
        <dt>C</dt>
        <dd>
            <ul>
                
                <li><a href="#M000255">close</a>,</li>
                
                <li><a href="#M000256">close_filter</a>,</li>
                
                <li><a href="#M000257">close_haml_comment</a>,</li>
                
                <li><a href="#M000258">close_silent_script</a>,</li>
                
                <li><a href="#M000274">closes_flat?</a>,</li>
                
                <li><a href="#M000252">comment</a>,</li>
                
                <li><a href="#M000282">contains_interpolation?</a></li>
                
            </ul>
        </dd>
    
        <dt>D</dt>
        <dd>
            <ul>
                
                <li><a href="#M000251">div</a>,</li>
                
                <li><a href="#M000253">doctype</a></li>
                
            </ul>
        </dd>
    
        <dt>F</dt>
        <dd>
            <ul>
                
                <li><a href="#M000254">filter</a>,</li>
                
                <li><a href="#M000289">filter_opened?</a>,</li>
                
                <li><a href="#M000290">flat?</a>,</li>
                
                <li><a href="#M000244">flat_script</a></li>
                
            </ul>
        </dd>
    
        <dt>H</dt>
        <dd>
            <ul>
                
                <li><a href="#M000246">haml_comment</a>,</li>
                
                <li><a href="#M000276">handle_multiline</a>,</li>
                
                <li><a href="#M000280">handle_ruby_multiline</a></li>
                
            </ul>
        </dd>
    
        <dt>I</dt>
        <dd>
            <ul>
                
                <li><a href="#M000277">is_multiline?</a>,</li>
                
                <li><a href="#M000281">is_ruby_multiline?</a></li>
                
            </ul>
        </dd>
    
        <dt>M</dt>
        <dd>
            <ul>
                
                <li><a href="#M000240">mid_block_keyword?</a></li>
                
            </ul>
        </dd>
    
        <dt>N</dt>
        <dd>
            <ul>
                
                <li><a href="#M000273">next_line</a></li>
                
            </ul>
        </dd>
    
        <dt>P</dt>
        <dd>
            <ul>
                
                <li><a href="#M000236">parse</a>,</li>
                
                <li><a href="#M000259">parse_class_and_id</a>,</li>
                
                <li><a href="#M000271">parse_new_attribute</a>,</li>
                
                <li><a href="#M000267">parse_new_attributes</a>,</li>
                
                <li><a href="#M000262">parse_old_attributes</a>,</li>
                
                <li><a href="#M000260">parse_static_hash</a>,</li>
                
                <li><a href="#M000261">parse_tag</a>,</li>
                
                <li><a href="#M000242">plain</a>,</li>
                
                <li><a href="#M000237">process_indent</a>,</li>
                
                <li><a href="#M000238">process_line</a>,</li>
                
                <li><a href="#M000241">push</a></li>
                
            </ul>
        </dd>
    
        <dt>R</dt>
        <dd>
            <ul>
                
                <li><a href="#M000272">raw_next_line</a></li>
                
            </ul>
        </dd>
    
        <dt>S</dt>
        <dd>
            <ul>
                
                <li><a href="#M000243">script</a>,</li>
                
                <li><a href="#M000245">silent_script</a></li>
                
            </ul>
        </dd>
    
        <dt>T</dt>
        <dd>
            <ul>
                
                <li><a href="#M000247">tag</a></li>
                
            </ul>
        </dd>
    
        <dt>U</dt>
        <dd>
            <ul>
                
                <li><a href="#M000275">un_next_line</a>,</li>
                
                <li><a href="#M000283">unescape_interpolation</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    
    <div class="sectiontitle">Included Modules</div>
    <ul>
        
        <li>
            
            <a href="../Hpricot.html">Hpricot</a>
            
            START:includes
        </li>
        
    </ul>
    

    

    
    <div class="sectiontitle">Classes and Modules</div>
    <ul>
        
        <li><span class="type">CLASS</span> <a href="Parser/Line.html">Haml::Parser::Line</a></li>
        
        <li><span class="type">CLASS</span> <a href="Parser/ParseNode.html">Haml::Parser::ParseNode</a></li>
        
    </ul>
    

    
    <div class="sectiontitle">Constants</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class="attr-name">ELEMENT</td>
            <td>=</td>
            <td class="attr-value">?%</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
Designates an XHTML/XML element.
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">DIV_CLASS</td>
            <td>=</td>
            <td class="attr-value">?.</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
Designates a `<div>` element with the given class.
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">DIV_ID</td>
            <td>=</td>
            <td class="attr-value">?#</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
Designates a `<div>` element with the given id.
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">COMMENT</td>
            <td>=</td>
            <td class="attr-value">?/</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
Designates an XHTML/XML comment.
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">DOCTYPE</td>
            <td>=</td>
            <td class="attr-value">?!</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
Designates an XHTML doctype or script that is never HTML-escaped.
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">SCRIPT</td>
            <td>=</td>
            <td class="attr-value">?=</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
Designates script, the result of which is output.
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">SANITIZE</td>
            <td>=</td>
            <td class="attr-value">?&amp;</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
Designates script that is always HTML-escaped.
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">FLAT_SCRIPT</td>
            <td>=</td>
            <td class="attr-value">?~</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
Designates script, the result of which is flattened and output.
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">SILENT_SCRIPT</td>
            <td>=</td>
            <td class="attr-value">?-</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
Designates script which is run but not output.
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">SILENT_COMMENT</td>
            <td>=</td>
            <td class="attr-value">?#</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
When following <a href="Parser.html#SILENT_SCRIPT">SILENT_SCRIPT</a>,
designates a comment that is not output.
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">ESCAPE</td>
            <td>=</td>
            <td class="attr-value">?\\</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
Designates a non-parsed line.
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">FILTER</td>
            <td>=</td>
            <td class="attr-value">?:</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
Designates a block of filtered text.
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">PLAIN_TEXT</td>
            <td>=</td>
            <td class="attr-value">-1</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
Designates a non-parsed line. Not actually a character.
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">SPECIAL_CHARACTERS</td>
            <td>=</td>
            <td class="attr-value">[       ELEMENT,       DIV_CLASS,       DIV_ID,       COMMENT,       DOCTYPE,       SCRIPT,       SANITIZE,       FLAT_SCRIPT,       SILENT_SCRIPT,       ESCAPE,       FILTER     ]</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
Keeps track of the ASCII values of the characters that begin a
specially-interpreted line.
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">MULTILINE_CHAR_VALUE</td>
            <td>=</td>
            <td class="attr-value">?|</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
The value of the character that designates that a line is part of a
multiline string.
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">MID_BLOCK_KEYWORDS</td>
            <td>=</td>
            <td class="attr-value">%w[else elsif rescue ensure end when]</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">START_BLOCK_KEYWORDS</td>
            <td>=</td>
            <td class="attr-value">%w[if begin case]</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">START_BLOCK_KEYWORD_REGEX</td>
            <td>=</td>
            <td class="attr-value">/(?:\w+(?:,\s*\w+)*\s*=\s*)?(#{START_BLOCK_KEYWORDS.join('|')})/</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
Try to parse assignments to block starters as best as possible
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">BLOCK_KEYWORD_REGEX</td>
            <td>=</td>
            <td class="attr-value">/^-\s*(?:(#{MID_BLOCK_KEYWORDS.join('|')})|#{START_BLOCK_KEYWORD_REGEX.source})\b/</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">DOCTYPE_REGEX</td>
            <td>=</td>
            <td class="attr-value">/(\d(?:\.\d)?)?[\s]*([a-z]*)\s*([^ ]+)?/i</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
The Regex that matches a Doctype command.
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">LITERAL_VALUE_REGEX</td>
            <td>=</td>
            <td class="attr-value">/:(\w*)|([&quot;'])((?![\\#]|\2).|\\.)*\2/</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
The Regex that matches a literal string or symbol value
</p>
</td>
        </tr>
        
        
    </table>
    

    

    
            <div class="sectiontitle">Class Private methods</div>
            
            <div class="method">
                <div class="title" id="M000259">
                    
                    <a name="M000259"></a><b>parse_class_and_id</b>(list)
                    
                </div>
                
                <div class="description">
                  <p>
This is a class method so it can be accessed from {Haml::Helpers}.
</p>
<p>
Iterates through the classes and ids supplied through `.` and `#` syntax,
and returns a hash with them as attributes, that can then be merged with
another attributes hash.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000259_source')" id="l_M000259_source">show</a>
                        
                    </p>
                    <div id="M000259_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/haml/parser.rb, line 432</span>
432:     <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">parse_class_and_id</span>(<span class="ruby-identifier">list</span>)
433:       <span class="ruby-identifier">attributes</span> = {}
434:       <span class="ruby-identifier">list</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/([#.])([-:_a-zA-Z0-9]+)/</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">type</span>, <span class="ruby-identifier">property</span><span class="ruby-operator">|</span>
435:         <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">type</span>
436:         <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'.'</span>
437:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">attributes</span>[<span class="ruby-value str">'class'</span>]
438:             <span class="ruby-identifier">attributes</span>[<span class="ruby-value str">'class'</span>] <span class="ruby-operator">+=</span> <span class="ruby-value str">&quot; &quot;</span>
439:           <span class="ruby-keyword kw">else</span>
440:             <span class="ruby-identifier">attributes</span>[<span class="ruby-value str">'class'</span>] = <span class="ruby-value str">&quot;&quot;</span>
441:           <span class="ruby-keyword kw">end</span>
442:           <span class="ruby-identifier">attributes</span>[<span class="ruby-value str">'class'</span>] <span class="ruby-operator">+=</span> <span class="ruby-identifier">property</span>
443:         <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'#'</span>; <span class="ruby-identifier">attributes</span>[<span class="ruby-value str">'id'</span>] = <span class="ruby-identifier">property</span>
444:         <span class="ruby-keyword kw">end</span>
445:       <span class="ruby-keyword kw">end</span>
446:       <span class="ruby-identifier">attributes</span>
447:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Private methods</div>
            
            <div class="method">
                <div class="title" id="M000286">
                    
                    <a name="M000286"></a><b>balance</b>(*args)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000286_source')" id="l_M000286_source">show</a>
                        
                    </p>
                    <div id="M000286_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/haml/parser.rb, line 693</span>
693:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">balance</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
694:       <span class="ruby-identifier">res</span> = <span class="ruby-constant">Haml</span><span class="ruby-operator">::</span><span class="ruby-constant">Shared</span>.<span class="ruby-identifier">balance</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
695:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">res</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">res</span>
696:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">SyntaxError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;Unbalanced brackets.&quot;</span>)
697:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000239">
                    
                    <a name="M000239"></a><b>block_keyword</b>(text)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000239_source')" id="l_M000239_source">show</a>
                        
                    </p>
                    <div id="M000239_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/haml/parser.rb, line 213</span>
213:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">block_keyword</span>(<span class="ruby-identifier">text</span>)
214:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">keyword</span> = <span class="ruby-identifier">text</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-constant">BLOCK_KEYWORD_REGEX</span>)[<span class="ruby-value">0</span>]
215:       <span class="ruby-identifier">keyword</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">keyword</span>[<span class="ruby-value">1</span>]
216:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000288">
                    
                    <a name="M000288"></a><b>block_opened?</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000288_source')" id="l_M000288_source">show</a>
                        
                    </p>
                    <div id="M000288_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/haml/parser.rb, line 699</span>
699:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">block_opened?</span>
700:       <span class="ruby-ivar">@next_line</span>.<span class="ruby-identifier">tabs</span> <span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@line</span>.<span class="ruby-identifier">tabs</span>
701:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000255">
                    
                    <a name="M000255"></a><b>close</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000255_source')" id="l_M000255_source">show</a>
                        
                    </p>
                    <div id="M000255_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/haml/parser.rb, line 398</span>
398:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">close</span>
399:       <span class="ruby-identifier">node</span>, <span class="ruby-ivar">@parent</span> = <span class="ruby-ivar">@parent</span>, <span class="ruby-ivar">@parent</span>.<span class="ruby-identifier">parent</span>
400:       <span class="ruby-ivar">@template_tabs</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span>
401:       <span class="ruby-identifier">send</span>(<span class="ruby-node">&quot;close_#{node.type}&quot;</span>, <span class="ruby-identifier">node</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">respond_to?</span>(<span class="ruby-node">&quot;close_#{node.type}&quot;</span>, <span class="ruby-identifier">:include_private</span>)
402:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000256">
                    
                    <a name="M000256"></a><b>close_filter</b>(_)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000256_source')" id="l_M000256_source">show</a>
                        
                    </p>
                    <div id="M000256_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/haml/parser.rb, line 404</span>
404:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">close_filter</span>(<span class="ruby-identifier">_</span>)
405:       <span class="ruby-ivar">@flat</span> = <span class="ruby-keyword kw">false</span>
406:       <span class="ruby-ivar">@flat_spaces</span> = <span class="ruby-keyword kw">nil</span>
407:       <span class="ruby-ivar">@filter_buffer</span> = <span class="ruby-keyword kw">nil</span>
408:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000257">
                    
                    <a name="M000257"></a><b>close_haml_comment</b>(_)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000257_source')" id="l_M000257_source">show</a>
                        
                    </p>
                    <div id="M000257_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/haml/parser.rb, line 410</span>
410:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">close_haml_comment</span>(<span class="ruby-identifier">_</span>)
411:       <span class="ruby-ivar">@haml_comment</span> = <span class="ruby-keyword kw">false</span>
412:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000258">
                    
                    <a name="M000258"></a><b>close_silent_script</b>(node)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000258_source')" id="l_M000258_source">show</a>
                        
                    </p>
                    <div id="M000258_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/haml/parser.rb, line 414</span>
414:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">close_silent_script</span>(<span class="ruby-identifier">node</span>)
415:       <span class="ruby-comment cmt"># Post-process case statements to normalize the nesting of &quot;when&quot; clauses</span>
416:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">node</span>.<span class="ruby-identifier">value</span>[<span class="ruby-identifier">:keyword</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;case&quot;</span>
417:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">first</span> = <span class="ruby-identifier">node</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">first</span>
418:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">first</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:silent_script</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">first</span>.<span class="ruby-identifier">value</span>[<span class="ruby-identifier">:keyword</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;when&quot;</span>
419:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">first</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">empty?</span>
420:       <span class="ruby-comment cmt"># If the case node has a &quot;when&quot; child with children, it's the</span>
421:       <span class="ruby-comment cmt"># only child. Then we want to put everything nested beneath it</span>
422:       <span class="ruby-comment cmt"># beneath the case itself (just like &quot;if&quot;).</span>
423:       <span class="ruby-identifier">node</span>.<span class="ruby-identifier">children</span> = [<span class="ruby-identifier">first</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">first</span>.<span class="ruby-identifier">children</span>]
424:       <span class="ruby-identifier">first</span>.<span class="ruby-identifier">children</span> = []
425:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000274">
                    
                    <a name="M000274"></a><b>closes_flat?</b>(line)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000274_source')" id="l_M000274_source">show</a>
                        
                    </p>
                    <div id="M000274_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/haml/parser.rb, line 629</span>
629:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">closes_flat?</span>(<span class="ruby-identifier">line</span>)
630:       <span class="ruby-identifier">line</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">line</span>.<span class="ruby-identifier">text</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">line</span>.<span class="ruby-identifier">full</span> <span class="ruby-operator">!~</span> <span class="ruby-node">/^#{@flat_spaces}/</span>
631:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000252">
                    
                    <a name="M000252"></a><b>comment</b>(line)
                    
                </div>
                
                <div class="description">
                  <p>
Renders an XHTML comment.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000252_source')" id="l_M000252_source">show</a>
                        
                    </p>
                    <div id="M000252_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/haml/parser.rb, line 365</span>
365:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">comment</span>(<span class="ruby-identifier">line</span>)
366:       <span class="ruby-identifier">conditional</span>, <span class="ruby-identifier">line</span> = <span class="ruby-identifier">balance</span>(<span class="ruby-identifier">line</span>, <span class="ruby-value">?[</span>, <span class="ruby-value">?]</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">line</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-value">?[</span>
367:       <span class="ruby-identifier">line</span>.<span class="ruby-identifier">strip!</span>
368:       <span class="ruby-identifier">conditional</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;&gt;&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">conditional</span>
369: 
370:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block_opened?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">line</span>.<span class="ruby-identifier">empty?</span>
371:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">SyntaxError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">'Illegal nesting: nesting within a tag that already has content is illegal.'</span>, <span class="ruby-ivar">@next_line</span>.<span class="ruby-identifier">index</span>)
372:       <span class="ruby-keyword kw">end</span>
373: 
374:       <span class="ruby-constant">ParseNode</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:comment</span>, <span class="ruby-ivar">@index</span>, <span class="ruby-identifier">:conditional</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">conditional</span>, <span class="ruby-identifier">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">line</span>)
375:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000282">
                    
                    <a name="M000282"></a><b>contains_interpolation?</b>(str)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000282_source')" id="l_M000282_source">show</a>
                        
                    </p>
                    <div id="M000282_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/haml/parser.rb, line 673</span>
673:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">contains_interpolation?</span>(<span class="ruby-identifier">str</span>)
674:       <span class="ruby-identifier">str</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-value str">'#{'</span>)
675:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000251">
                    
                    <a name="M000251"></a><b>div</b>(line)
                    
                </div>
                
                <div class="description">
                  <p>
Renders a line that creates an XHTML tag and has an implicit div because of
`.` or `#`.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000251_source')" id="l_M000251_source">show</a>
                        
                    </p>
                    <div id="M000251_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/haml/parser.rb, line 360</span>
360:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">div</span>(<span class="ruby-identifier">line</span>)
361:       <span class="ruby-identifier">tag</span>(<span class="ruby-value str">'%div'</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">line</span>)
362:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000253">
                    
                    <a name="M000253"></a><b>doctype</b>(line)
                    
                </div>
                
                <div class="description">
                  <p>
Renders an XHTML doctype or XML shebang.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000253_source')" id="l_M000253_source">show</a>
                        
                    </p>
                    <div id="M000253_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/haml/parser.rb, line 378</span>
378:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">doctype</span>(<span class="ruby-identifier">line</span>)
379:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">SyntaxError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;Illegal nesting: nesting within a header command is illegal.&quot;</span>, <span class="ruby-ivar">@next_line</span>.<span class="ruby-identifier">index</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block_opened?</span>
380:       <span class="ruby-identifier">version</span>, <span class="ruby-identifier">type</span>, <span class="ruby-identifier">encoding</span> = <span class="ruby-identifier">line</span>[<span class="ruby-value">3</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>].<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">downcase</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-constant">DOCTYPE_REGEX</span>)[<span class="ruby-value">0</span>]
381:       <span class="ruby-constant">ParseNode</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:doctype</span>, <span class="ruby-ivar">@index</span>, <span class="ruby-identifier">:version</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">version</span>, <span class="ruby-identifier">:type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">type</span>, <span class="ruby-identifier">:encoding</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">encoding</span>)
382:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000254">
                    
                    <a name="M000254"></a><b>filter</b>(name)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000254_source')" id="l_M000254_source">show</a>
                        
                    </p>
                    <div id="M000254_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/haml/parser.rb, line 384</span>
384:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">filter</span>(<span class="ruby-identifier">name</span>)
385:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;Invalid filter name \&quot;:#{name}\&quot;.&quot;</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">name</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/^\w+$/</span>
386: 
387:       <span class="ruby-ivar">@filter_buffer</span> = <span class="ruby-constant">String</span>.<span class="ruby-identifier">new</span>
388: 
389:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">filter_opened?</span>
390:         <span class="ruby-ivar">@flat</span> = <span class="ruby-keyword kw">true</span>
391:         <span class="ruby-comment cmt"># If we don't know the indentation by now, it'll be set in Line#tabs</span>
392:         <span class="ruby-ivar">@flat_spaces</span> = <span class="ruby-ivar">@indentation</span> <span class="ruby-operator">*</span> (<span class="ruby-ivar">@template_tabs</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@indentation</span>
393:       <span class="ruby-keyword kw">end</span>
394: 
395:       <span class="ruby-constant">ParseNode</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:filter</span>, <span class="ruby-ivar">@index</span>, <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">name</span>, <span class="ruby-identifier">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@filter_buffer</span>)
396:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000289">
                    
                    <a name="M000289"></a><b>filter_opened?</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Same semantics as block_opened?, except that block_opened? uses <a
href="Parser/Line.html#M000227">Line#tabs</a>, which doesn&#8217;t interact
well with filter lines
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000289_source')" id="l_M000289_source">show</a>
                        
                    </p>
                    <div id="M000289_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/haml/parser.rb, line 705</span>
705:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">filter_opened?</span>
706:       <span class="ruby-ivar">@next_line</span>.<span class="ruby-identifier">full</span> <span class="ruby-operator">=~</span> (<span class="ruby-ivar">@indentation</span> <span class="ruby-operator">?</span> <span class="ruby-node">/^#{@indentation * @template_tabs}/</span> <span class="ruby-operator">:</span> <span class="ruby-regexp re">/^\s/</span>)
707:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000290">
                    
                    <a name="M000290"></a><b>flat?</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000290_source')" id="l_M000290_source">show</a>
                        
                    </p>
                    <div id="M000290_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/haml/parser.rb, line 709</span>
709:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">flat?</span>
710:       <span class="ruby-ivar">@flat</span>
711:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000244">
                    
                    <a name="M000244"></a><b>flat_script</b>(text, escape_html = nil)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000244_source')" id="l_M000244_source">show</a>
                        
                    </p>
                    <div id="M000244_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/haml/parser.rb, line 249</span>
249:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">flat_script</span>(<span class="ruby-identifier">text</span>, <span class="ruby-identifier">escape_html</span> = <span class="ruby-keyword kw">nil</span>)
250:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">SyntaxError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;There's no Ruby code for ~ to evaluate.&quot;</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">text</span>.<span class="ruby-identifier">empty?</span>
251:       <span class="ruby-identifier">script</span>(<span class="ruby-identifier">text</span>, <span class="ruby-identifier">escape_html</span>, <span class="ruby-identifier">:preserve</span>)
252:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000246">
                    
                    <a name="M000246"></a><b>haml_comment</b>(text)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000246_source')" id="l_M000246_source">show</a>
                        
                    </p>
                    <div id="M000246_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/haml/parser.rb, line 275</span>
275:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">haml_comment</span>(<span class="ruby-identifier">text</span>)
276:       <span class="ruby-ivar">@haml_comment</span> = <span class="ruby-identifier">block_opened?</span>
277:       <span class="ruby-constant">ParseNode</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:haml_comment</span>, <span class="ruby-ivar">@index</span>, <span class="ruby-identifier">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">text</span>)
278:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000276">
                    
                    <a name="M000276"></a><b>handle_multiline</b>(line)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000276_source')" id="l_M000276_source">show</a>
                        
                    </p>
                    <div id="M000276_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/haml/parser.rb, line 638</span>
638:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">handle_multiline</span>(<span class="ruby-identifier">line</span>)
639:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">is_multiline?</span>(<span class="ruby-identifier">line</span>.<span class="ruby-identifier">text</span>)
640:       <span class="ruby-identifier">line</span>.<span class="ruby-identifier">text</span>.<span class="ruby-identifier">slice!</span>(<span class="ruby-value">-1</span>)
641:       <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">new_line</span> = <span class="ruby-identifier">raw_next_line</span>.<span class="ruby-identifier">first</span>
642:         <span class="ruby-keyword kw">break</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">new_line</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:eod</span>
643:         <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">new_line</span>.<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">empty?</span>
644:         <span class="ruby-keyword kw">break</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">is_multiline?</span>(<span class="ruby-identifier">new_line</span>.<span class="ruby-identifier">strip</span>)
645:         <span class="ruby-identifier">line</span>.<span class="ruby-identifier">text</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">new_line</span>.<span class="ruby-identifier">strip</span>[<span class="ruby-value">0</span><span class="ruby-operator">...</span><span class="ruby-value">-1</span>]
646:       <span class="ruby-keyword kw">end</span>
647:       <span class="ruby-identifier">un_next_line</span> <span class="ruby-identifier">new_line</span>
648:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000280">
                    
                    <a name="M000280"></a><b>handle_ruby_multiline</b>(text)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000280_source')" id="l_M000280_source">show</a>
                        
                    </p>
                    <div id="M000280_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/haml/parser.rb, line 655</span>
655:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">handle_ruby_multiline</span>(<span class="ruby-identifier">text</span>)
656:       <span class="ruby-identifier">text</span> = <span class="ruby-identifier">text</span>.<span class="ruby-identifier">rstrip</span>
657:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">text</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">is_ruby_multiline?</span>(<span class="ruby-identifier">text</span>)
658:       <span class="ruby-identifier">un_next_line</span> <span class="ruby-ivar">@next_line</span>.<span class="ruby-identifier">full</span>
659:       <span class="ruby-keyword kw">begin</span>
660:         <span class="ruby-identifier">new_line</span> = <span class="ruby-identifier">raw_next_line</span>.<span class="ruby-identifier">first</span>
661:         <span class="ruby-keyword kw">break</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">new_line</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:eod</span>
662:         <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">new_line</span>.<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">empty?</span>
663:         <span class="ruby-identifier">text</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot; &quot;</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">new_line</span>.<span class="ruby-identifier">strip</span>
664:       <span class="ruby-keyword kw">end</span> <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">is_ruby_multiline?</span>(<span class="ruby-identifier">new_line</span>.<span class="ruby-identifier">strip</span>)
665:       <span class="ruby-identifier">next_line</span>
666:       <span class="ruby-identifier">text</span>
667:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000277">
                    
                    <a name="M000277"></a><b>is_multiline?</b>(text)
                    
                </div>
                
                <div class="description">
                  <p>
Checks whether or not `line` is in a multiline sequence.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000277_source')" id="l_M000277_source">show</a>
                        
                    </p>
                    <div id="M000277_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/haml/parser.rb, line 651</span>
651:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">is_multiline?</span>(<span class="ruby-identifier">text</span>)
652:       <span class="ruby-identifier">text</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">text</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">text</span>[<span class="ruby-value">-1</span>] <span class="ruby-operator">==</span> <span class="ruby-constant">MULTILINE_CHAR_VALUE</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">text</span>[<span class="ruby-value">-2</span>] <span class="ruby-operator">==</span> <span class="ruby-value">?\s</span>
653:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000281">
                    
                    <a name="M000281"></a><b>is_ruby_multiline?</b>(text)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000281_source')" id="l_M000281_source">show</a>
                        
                    </p>
                    <div id="M000281_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/haml/parser.rb, line 669</span>
669:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">is_ruby_multiline?</span>(<span class="ruby-identifier">text</span>)
670:       <span class="ruby-identifier">text</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">text</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">text</span>[<span class="ruby-value">-1</span>] <span class="ruby-operator">==</span> <span class="ruby-value">?,</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">text</span>[<span class="ruby-value">-2</span>] <span class="ruby-operator">!=</span> <span class="ruby-value">??</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">text</span>[<span class="ruby-value">-3</span><span class="ruby-operator">..</span><span class="ruby-value">-2</span>] <span class="ruby-operator">!=</span> <span class="ruby-value str">&quot;?\\&quot;</span>
671:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000240">
                    
                    <a name="M000240"></a><b>mid_block_keyword?</b>(text)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000240_source')" id="l_M000240_source">show</a>
                        
                    </p>
                    <div id="M000240_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/haml/parser.rb, line 218</span>
218:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">mid_block_keyword?</span>(<span class="ruby-identifier">text</span>)
219:       <span class="ruby-constant">MID_BLOCK_KEYWORDS</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">block_keyword</span>(<span class="ruby-identifier">text</span>))
220:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000273">
                    
                    <a name="M000273"></a><b>next_line</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000273_source')" id="l_M000273_source">show</a>
                        
                    </p>
                    <div id="M000273_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/haml/parser.rb, line 603</span>
603:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">next_line</span>
604:       <span class="ruby-identifier">text</span>, <span class="ruby-identifier">index</span> = <span class="ruby-identifier">raw_next_line</span>
605:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">text</span>
606: 
607:       <span class="ruby-comment cmt"># :eod is a special end-of-document marker</span>
608:       <span class="ruby-identifier">line</span> =
609:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">text</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:eod</span>
610:           <span class="ruby-constant">Line</span>.<span class="ruby-identifier">new</span> <span class="ruby-value str">'-#'</span>, <span class="ruby-value str">'-#'</span>, <span class="ruby-value str">'-#'</span>, <span class="ruby-identifier">index</span>, <span class="ruby-keyword kw">self</span>, <span class="ruby-keyword kw">true</span>
611:         <span class="ruby-keyword kw">else</span>
612:           <span class="ruby-constant">Line</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">text</span>.<span class="ruby-identifier">strip</span>, <span class="ruby-identifier">text</span>.<span class="ruby-identifier">lstrip</span>.<span class="ruby-identifier">chomp</span>, <span class="ruby-identifier">text</span>, <span class="ruby-identifier">index</span>, <span class="ruby-keyword kw">self</span>, <span class="ruby-keyword kw">false</span>
613:         <span class="ruby-keyword kw">end</span>
614: 
615:       <span class="ruby-comment cmt"># `flat?' here is a little outdated,</span>
616:       <span class="ruby-comment cmt"># so we have to manually check if either the previous or current line</span>
617:       <span class="ruby-comment cmt"># closes the flat block, as well as whether a new block is opened.</span>
618:       <span class="ruby-ivar">@line</span>.<span class="ruby-identifier">tabs</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@line</span>
619:       <span class="ruby-keyword kw">unless</span> (<span class="ruby-identifier">flat?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">closes_flat?</span>(<span class="ruby-identifier">line</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">closes_flat?</span>(<span class="ruby-ivar">@line</span>)) <span class="ruby-operator">||</span>
620:           (<span class="ruby-ivar">@line</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@line</span>.<span class="ruby-identifier">text</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-value">?:</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">line</span>.<span class="ruby-identifier">full</span> <span class="ruby-operator">=~</span> <span class="ruby-node">%r[^#{@line.full[/^\s+/]}\s]</span>)
621:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">next_line</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">line</span>.<span class="ruby-identifier">text</span>.<span class="ruby-identifier">empty?</span>
622: 
623:         <span class="ruby-identifier">handle_multiline</span>(<span class="ruby-identifier">line</span>)
624:       <span class="ruby-keyword kw">end</span>
625: 
626:       <span class="ruby-ivar">@next_line</span> = <span class="ruby-identifier">line</span>
627:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000236">
                    
                    <a name="M000236"></a><b>parse</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000236_source')" id="l_M000236_source">show</a>
                        
                    </p>
                    <div id="M000236_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/haml/parser.rb, line 129</span>
129:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">parse</span>
130:       <span class="ruby-ivar">@root</span> = <span class="ruby-ivar">@parent</span> = <span class="ruby-constant">ParseNode</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:root</span>)
131:       <span class="ruby-ivar">@haml_comment</span> = <span class="ruby-keyword kw">false</span>
132:       <span class="ruby-ivar">@indentation</span> = <span class="ruby-keyword kw">nil</span>
133:       <span class="ruby-ivar">@line</span> = <span class="ruby-identifier">next_line</span>
134: 
135:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">SyntaxError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;Indenting at the beginning of the document is illegal.&quot;</span>, <span class="ruby-ivar">@line</span>.<span class="ruby-identifier">index</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@line</span>.<span class="ruby-identifier">tabs</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
136: 
137:       <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">next_line</span>
138:         <span class="ruby-identifier">process_indent</span>(<span class="ruby-ivar">@line</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@line</span>.<span class="ruby-identifier">text</span>.<span class="ruby-identifier">empty?</span>
139: 
140:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">flat?</span>
141:           <span class="ruby-identifier">text</span> = <span class="ruby-ivar">@line</span>.<span class="ruby-identifier">full</span>.<span class="ruby-identifier">dup</span>
142:           <span class="ruby-identifier">text</span> = <span class="ruby-value str">&quot;&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">text</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-node">/^#{@flat_spaces}/</span>, <span class="ruby-value str">''</span>)
143:           <span class="ruby-ivar">@filter_buffer</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;#{text}\n&quot;</span>
144:           <span class="ruby-ivar">@line</span> = <span class="ruby-ivar">@next_line</span>
145:           <span class="ruby-keyword kw">next</span>
146:         <span class="ruby-keyword kw">end</span>
147: 
148:         <span class="ruby-ivar">@tab_up</span> = <span class="ruby-keyword kw">nil</span>
149:         <span class="ruby-identifier">process_line</span>(<span class="ruby-ivar">@line</span>.<span class="ruby-identifier">text</span>, <span class="ruby-ivar">@line</span>.<span class="ruby-identifier">index</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@line</span>.<span class="ruby-identifier">text</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">||</span> <span class="ruby-ivar">@haml_comment</span>
150:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@parent</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">:haml_comment</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">block_opened?</span> <span class="ruby-operator">||</span> <span class="ruby-ivar">@tab_up</span>)
151:           <span class="ruby-ivar">@template_tabs</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
152:           <span class="ruby-ivar">@parent</span> = <span class="ruby-ivar">@parent</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">last</span>
153:         <span class="ruby-keyword kw">end</span>
154: 
155:         <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">flat?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@next_line</span>.<span class="ruby-identifier">tabs</span> <span class="ruby-operator">-</span> <span class="ruby-ivar">@line</span>.<span class="ruby-identifier">tabs</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>
156:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">SyntaxError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;The line was indented #{@next_line.tabs - @line.tabs} levels deeper than the previous line.&quot;</span>, <span class="ruby-ivar">@next_line</span>.<span class="ruby-identifier">index</span>)
157:         <span class="ruby-keyword kw">end</span>
158: 
159:         <span class="ruby-ivar">@line</span> = <span class="ruby-ivar">@next_line</span>
160:       <span class="ruby-keyword kw">end</span>
161: 
162:       <span class="ruby-comment cmt"># Close all the open tags</span>
163:       <span class="ruby-identifier">close</span> <span class="ruby-keyword kw">until</span> <span class="ruby-ivar">@parent</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:root</span>
164:       <span class="ruby-ivar">@root</span>
165:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000271">
                    
                    <a name="M000271"></a><b>parse_new_attribute</b>(scanner)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000271_source')" id="l_M000271_source">show</a>
                        
                    </p>
                    <div id="M000271_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/haml/parser.rb, line 564</span>
564:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">parse_new_attribute</span>(<span class="ruby-identifier">scanner</span>)
565:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">name</span> = <span class="ruby-identifier">scanner</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/[-:\w]+/</span>)
566:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">scanner</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\)/</span>)
567:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span>
568:       <span class="ruby-keyword kw">end</span>
569: 
570:       <span class="ruby-identifier">scanner</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\s*/</span>)
571:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">name</span>, [<span class="ruby-identifier">:static</span>, <span class="ruby-keyword kw">true</span>] <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">scanner</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/=/</span>) <span class="ruby-comment cmt">#/end</span>
572: 
573:       <span class="ruby-identifier">scanner</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\s*/</span>)
574:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">quote</span> = <span class="ruby-identifier">scanner</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/[&quot;']/</span>)
575:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">var</span> = <span class="ruby-identifier">scanner</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/(@@?|\$)?\w+/</span>)
576:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">name</span>, [<span class="ruby-identifier">:dynamic</span>, <span class="ruby-identifier">var</span>]
577:       <span class="ruby-keyword kw">end</span>
578: 
579:       <span class="ruby-identifier">re</span> = <span class="ruby-node">/((?:\\.|\#(?!\{)|[^#{quote}\\#])*)(#{quote}|#\{)/</span>
580:       <span class="ruby-identifier">content</span> = []
581:       <span class="ruby-identifier">loop</span> <span class="ruby-keyword kw">do</span>
582:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">scanner</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-identifier">re</span>)
583:         <span class="ruby-identifier">content</span> <span class="ruby-operator">&lt;&lt;</span> [<span class="ruby-identifier">:str</span>, <span class="ruby-identifier">scanner</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/\\(.)/</span>, <span class="ruby-value str">'\1'</span>)]
584:         <span class="ruby-keyword kw">break</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">scanner</span>[<span class="ruby-value">2</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">quote</span>
585:         <span class="ruby-identifier">content</span> <span class="ruby-operator">&lt;&lt;</span> [<span class="ruby-identifier">:ruby</span>, <span class="ruby-identifier">balance</span>(<span class="ruby-identifier">scanner</span>, <span class="ruby-value">?{</span>, <span class="ruby-value">?}</span>, <span class="ruby-value">1</span>).<span class="ruby-identifier">first</span>[<span class="ruby-value">0</span><span class="ruby-operator">...</span><span class="ruby-value">-1</span>]]
586:       <span class="ruby-keyword kw">end</span>
587: 
588:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">name</span>, [<span class="ruby-identifier">:static</span>, <span class="ruby-identifier">content</span>.<span class="ruby-identifier">first</span>[<span class="ruby-value">1</span>]] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">content</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span>
589:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">name</span>, [<span class="ruby-identifier">:dynamic</span>,
590:         <span class="ruby-value str">'&quot;'</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">content</span>.<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span>(<span class="ruby-identifier">t</span>, <span class="ruby-identifier">v</span>)<span class="ruby-operator">|</span> <span class="ruby-identifier">t</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:str</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">inspect_obj</span>(<span class="ruby-identifier">v</span>)[<span class="ruby-value">1</span><span class="ruby-operator">...</span><span class="ruby-value">-1</span>] <span class="ruby-operator">:</span> <span class="ruby-node">&quot;\#{#{v}}&quot;</span>}.<span class="ruby-identifier">join</span> <span class="ruby-operator">+</span> <span class="ruby-value str">'&quot;'</span>]
591:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000267">
                    
                    <a name="M000267"></a><b>parse_new_attributes</b>(line)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000267_source')" id="l_M000267_source">show</a>
                        
                    </p>
                    <div id="M000267_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/haml/parser.rb, line 523</span>
523:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">parse_new_attributes</span>(<span class="ruby-identifier">line</span>)
524:       <span class="ruby-identifier">line</span> = <span class="ruby-identifier">line</span>.<span class="ruby-identifier">dup</span>
525:       <span class="ruby-identifier">scanner</span> = <span class="ruby-constant">StringScanner</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">line</span>)
526:       <span class="ruby-identifier">last_line</span> = <span class="ruby-ivar">@index</span>
527:       <span class="ruby-identifier">attributes</span> = {}
528: 
529:       <span class="ruby-identifier">scanner</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\(\s*/</span>)
530:       <span class="ruby-identifier">loop</span> <span class="ruby-keyword kw">do</span>
531:         <span class="ruby-identifier">name</span>, <span class="ruby-identifier">value</span> = <span class="ruby-identifier">parse_new_attribute</span>(<span class="ruby-identifier">scanner</span>)
532:         <span class="ruby-keyword kw">break</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">name</span>.<span class="ruby-identifier">nil?</span>
533: 
534:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">false</span>
535:           <span class="ruby-identifier">text</span> = (<span class="ruby-constant">Haml</span><span class="ruby-operator">::</span><span class="ruby-constant">Shared</span>.<span class="ruby-identifier">balance</span>(<span class="ruby-identifier">line</span>, <span class="ruby-value">?(</span>, <span class="ruby-value">?)</span>) <span class="ruby-operator">||</span> [<span class="ruby-identifier">line</span>]).<span class="ruby-identifier">first</span>
536:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">Haml</span><span class="ruby-operator">::</span><span class="ruby-constant">SyntaxError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;Invalid attribute list: #{text.inspect}.&quot;</span>, <span class="ruby-identifier">last_line</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>)
537:         <span class="ruby-keyword kw">end</span>
538:         <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">name</span>] = <span class="ruby-identifier">value</span>
539:         <span class="ruby-identifier">scanner</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\s*/</span>)
540: 
541:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">scanner</span>.<span class="ruby-identifier">eos?</span>
542:           <span class="ruby-identifier">line</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot; &quot;</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-ivar">@next_line</span>.<span class="ruby-identifier">text</span>
543:           <span class="ruby-identifier">last_line</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
544:           <span class="ruby-identifier">next_line</span>
545:           <span class="ruby-identifier">scanner</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\s*/</span>)
546:         <span class="ruby-keyword kw">end</span>
547:       <span class="ruby-keyword kw">end</span>
548: 
549:       <span class="ruby-identifier">static_attributes</span> = {}
550:       <span class="ruby-identifier">dynamic_attributes</span> = <span class="ruby-value str">&quot;{&quot;</span>
551:       <span class="ruby-identifier">attributes</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">name</span>, (<span class="ruby-identifier">type</span>, <span class="ruby-identifier">val</span>)<span class="ruby-operator">|</span>
552:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:static</span>
553:           <span class="ruby-identifier">static_attributes</span>[<span class="ruby-identifier">name</span>] = <span class="ruby-identifier">val</span>
554:         <span class="ruby-keyword kw">else</span>
555:           <span class="ruby-identifier">dynamic_attributes</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">inspect_obj</span>(<span class="ruby-identifier">name</span>) <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot; =&gt; &quot;</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;,&quot;</span>
556:         <span class="ruby-keyword kw">end</span>
557:       <span class="ruby-keyword kw">end</span>
558:       <span class="ruby-identifier">dynamic_attributes</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;}&quot;</span>
559:       <span class="ruby-identifier">dynamic_attributes</span> = <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">dynamic_attributes</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;{}&quot;</span>
560: 
561:       <span class="ruby-keyword kw">return</span> [<span class="ruby-identifier">static_attributes</span>, <span class="ruby-identifier">dynamic_attributes</span>], <span class="ruby-identifier">scanner</span>.<span class="ruby-identifier">rest</span>, <span class="ruby-identifier">last_line</span>
562:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000262">
                    
                    <a name="M000262"></a><b>parse_old_attributes</b>(line)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000262_source')" id="l_M000262_source">show</a>
                        
                    </p>
                    <div id="M000262_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/haml/parser.rb, line 502</span>
502:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">parse_old_attributes</span>(<span class="ruby-identifier">line</span>)
503:       <span class="ruby-identifier">line</span> = <span class="ruby-identifier">line</span>.<span class="ruby-identifier">dup</span>
504:       <span class="ruby-identifier">last_line</span> = <span class="ruby-ivar">@index</span>
505: 
506:       <span class="ruby-keyword kw">begin</span>
507:         <span class="ruby-identifier">attributes_hash</span>, <span class="ruby-identifier">rest</span> = <span class="ruby-identifier">balance</span>(<span class="ruby-identifier">line</span>, <span class="ruby-value">?{</span>, <span class="ruby-value">?}</span>)
508:       <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">SyntaxError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
509:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">line</span>.<span class="ruby-identifier">strip</span>[<span class="ruby-value">-1</span>] <span class="ruby-operator">==</span> <span class="ruby-value">?,</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">e</span>.<span class="ruby-identifier">message</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;Unbalanced brackets.&quot;</span>
510:           <span class="ruby-identifier">line</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;\n&quot;</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-ivar">@next_line</span>.<span class="ruby-identifier">text</span>
511:           <span class="ruby-identifier">last_line</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
512:           <span class="ruby-identifier">next_line</span>
513:           <span class="ruby-keyword kw">retry</span>
514:         <span class="ruby-keyword kw">end</span>
515: 
516:         <span class="ruby-identifier">raise</span> <span class="ruby-identifier">e</span>
517:       <span class="ruby-keyword kw">end</span>
518: 
519:       <span class="ruby-identifier">attributes_hash</span> = <span class="ruby-identifier">attributes_hash</span>[<span class="ruby-value">1</span><span class="ruby-operator">...</span><span class="ruby-value">-1</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">attributes_hash</span>
520:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">attributes_hash</span>, <span class="ruby-identifier">rest</span>, <span class="ruby-identifier">last_line</span>
521:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000260">
                    
                    <a name="M000260"></a><b>parse_static_hash</b>(text)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000260_source')" id="l_M000260_source">show</a>
                        
                    </p>
                    <div id="M000260_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/haml/parser.rb, line 449</span>
449:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">parse_static_hash</span>(<span class="ruby-identifier">text</span>)
450:       <span class="ruby-identifier">attributes</span> = {}
451:       <span class="ruby-identifier">scanner</span> = <span class="ruby-constant">StringScanner</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">text</span>)
452:       <span class="ruby-identifier">scanner</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\s+/</span>)
453:       <span class="ruby-keyword kw">until</span> <span class="ruby-identifier">scanner</span>.<span class="ruby-identifier">eos?</span>
454:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">key</span> = <span class="ruby-identifier">scanner</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-constant">LITERAL_VALUE_REGEX</span>)
455:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">scanner</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\s*=&gt;\s*/</span>)
456:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">value</span> = <span class="ruby-identifier">scanner</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-constant">LITERAL_VALUE_REGEX</span>)
457:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">scanner</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\s*(?:,|$)\s*/</span>)
458:         <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">eval</span>(<span class="ruby-identifier">key</span>).<span class="ruby-identifier">to_s</span>] = <span class="ruby-identifier">eval</span>(<span class="ruby-identifier">value</span>).<span class="ruby-identifier">to_s</span>
459:       <span class="ruby-keyword kw">end</span>
460:       <span class="ruby-identifier">attributes</span>
461:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000261">
                    
                    <a name="M000261"></a><b>parse_tag</b>(line)
                    
                </div>
                
                <div class="description">
                  <p>
Parses a line into tag_name, attributes, attributes_hash, object_ref,
action, value
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000261_source')" id="l_M000261_source">show</a>
                        
                    </p>
                    <div id="M000261_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/haml/parser.rb, line 464</span>
464:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">parse_tag</span>(<span class="ruby-identifier">line</span>)
465:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">SyntaxError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;Invalid tag: \&quot;#{line}\&quot;.&quot;</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">line</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/%([-:\w]+)([-:\w\.\#]*)(.*)/</span>)[<span class="ruby-value">0</span>]
466: 
467:       <span class="ruby-identifier">tag_name</span>, <span class="ruby-identifier">attributes</span>, <span class="ruby-identifier">rest</span> = <span class="ruby-identifier">match</span>
468:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">SyntaxError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;Illegal element: classes and ids must have values.&quot;</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">attributes</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/[\.#](\.|#|\z)/</span>
469: 
470:       <span class="ruby-identifier">new_attributes_hash</span> = <span class="ruby-identifier">old_attributes_hash</span> = <span class="ruby-identifier">last_line</span> = <span class="ruby-keyword kw">nil</span>
471:       <span class="ruby-identifier">object_ref</span> = <span class="ruby-value str">&quot;nil&quot;</span>
472:       <span class="ruby-identifier">attributes_hashes</span> = {}
473:       <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">rest</span>
474:         <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">rest</span>[<span class="ruby-value">0</span>]
475:         <span class="ruby-keyword kw">when</span> <span class="ruby-value">?{</span>
476:           <span class="ruby-keyword kw">break</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">old_attributes_hash</span>
477:           <span class="ruby-identifier">old_attributes_hash</span>, <span class="ruby-identifier">rest</span>, <span class="ruby-identifier">last_line</span> = <span class="ruby-identifier">parse_old_attributes</span>(<span class="ruby-identifier">rest</span>)
478:           <span class="ruby-identifier">attributes_hashes</span>[<span class="ruby-identifier">:old</span>] = <span class="ruby-identifier">old_attributes_hash</span>
479:         <span class="ruby-keyword kw">when</span> <span class="ruby-value">?(</span>
480:           <span class="ruby-keyword kw">break</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">new_attributes_hash</span>
481:           <span class="ruby-identifier">new_attributes_hash</span>, <span class="ruby-identifier">rest</span>, <span class="ruby-identifier">last_line</span> = <span class="ruby-identifier">parse_new_attributes</span>(<span class="ruby-identifier">rest</span>)
482:           <span class="ruby-identifier">attributes_hashes</span>[<span class="ruby-identifier">:new</span>] = <span class="ruby-identifier">new_attributes_hash</span>
483:         <span class="ruby-keyword kw">when</span> <span class="ruby-value">?[</span>
484:           <span class="ruby-keyword kw">break</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">object_ref</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;nil&quot;</span>
485:           <span class="ruby-identifier">object_ref</span>, <span class="ruby-identifier">rest</span> = <span class="ruby-identifier">balance</span>(<span class="ruby-identifier">rest</span>, <span class="ruby-value">?[</span>, <span class="ruby-value">?]</span>)
486:         <span class="ruby-keyword kw">else</span>; <span class="ruby-keyword kw">break</span>
487:         <span class="ruby-keyword kw">end</span>
488:       <span class="ruby-keyword kw">end</span>
489: 
490:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">rest</span>
491:         <span class="ruby-identifier">nuke_whitespace</span>, <span class="ruby-identifier">action</span>, <span class="ruby-identifier">value</span> = <span class="ruby-identifier">rest</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/(&lt;&gt;|&gt;&lt;|[&gt;&lt;])?([=\/\~&amp;!])?(.*)?/</span>)[<span class="ruby-value">0</span>]
492:         <span class="ruby-identifier">nuke_whitespace</span> <span class="ruby-operator">||=</span> <span class="ruby-value str">''</span>
493:         <span class="ruby-identifier">nuke_outer_whitespace</span> = <span class="ruby-identifier">nuke_whitespace</span>.<span class="ruby-identifier">include?</span> <span class="ruby-value str">'&gt;'</span>
494:         <span class="ruby-identifier">nuke_inner_whitespace</span> = <span class="ruby-identifier">nuke_whitespace</span>.<span class="ruby-identifier">include?</span> <span class="ruby-value str">'&lt;'</span>
495:       <span class="ruby-keyword kw">end</span>
496: 
497:       <span class="ruby-identifier">value</span> = <span class="ruby-identifier">value</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">strip</span>
498:       [<span class="ruby-identifier">tag_name</span>, <span class="ruby-identifier">attributes</span>, <span class="ruby-identifier">attributes_hashes</span>, <span class="ruby-identifier">object_ref</span>, <span class="ruby-identifier">nuke_outer_whitespace</span>,
499:        <span class="ruby-identifier">nuke_inner_whitespace</span>, <span class="ruby-identifier">action</span>, <span class="ruby-identifier">value</span>, <span class="ruby-identifier">last_line</span> <span class="ruby-operator">||</span> <span class="ruby-ivar">@index</span>]
500:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000242">
                    
                    <a name="M000242"></a><b>plain</b>(text, escape_html = nil)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000242_source')" id="l_M000242_source">show</a>
                        
                    </p>
                    <div id="M000242_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/haml/parser.rb, line 227</span>
227:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">plain</span>(<span class="ruby-identifier">text</span>, <span class="ruby-identifier">escape_html</span> = <span class="ruby-keyword kw">nil</span>)
228:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block_opened?</span>
229:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">SyntaxError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;Illegal nesting: nesting within plain text is illegal.&quot;</span>, <span class="ruby-ivar">@next_line</span>.<span class="ruby-identifier">index</span>)
230:       <span class="ruby-keyword kw">end</span>
231: 
232:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">contains_interpolation?</span>(<span class="ruby-identifier">text</span>)
233:         <span class="ruby-keyword kw">return</span> <span class="ruby-constant">ParseNode</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:plain</span>, <span class="ruby-ivar">@index</span>, <span class="ruby-identifier">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">text</span>)
234:       <span class="ruby-keyword kw">end</span>
235: 
236:       <span class="ruby-identifier">escape_html</span> = <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:escape_html</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">escape_html</span>.<span class="ruby-identifier">nil?</span>
237:       <span class="ruby-identifier">script</span>(<span class="ruby-identifier">unescape_interpolation</span>(<span class="ruby-identifier">text</span>, <span class="ruby-identifier">escape_html</span>), <span class="ruby-operator">!</span><span class="ruby-identifier">:escape_html</span>)
238:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000237">
                    
                    <a name="M000237"></a><b>process_indent</b>(line)
                    
                </div>
                
                <div class="description">
                  <p>
Processes and deals with lowering indentation.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000237_source')" id="l_M000237_source">show</a>
                        
                    </p>
                    <div id="M000237_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/haml/parser.rb, line 168</span>
168:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">process_indent</span>(<span class="ruby-identifier">line</span>)
169:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">line</span>.<span class="ruby-identifier">tabs</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-ivar">@template_tabs</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@template_tabs</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
170: 
171:       <span class="ruby-identifier">to_close</span> = <span class="ruby-ivar">@template_tabs</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">line</span>.<span class="ruby-identifier">tabs</span>
172:       <span class="ruby-identifier">to_close</span>.<span class="ruby-identifier">times</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span> <span class="ruby-identifier">close</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">to_close</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">i</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">mid_block_keyword?</span>(<span class="ruby-identifier">line</span>.<span class="ruby-identifier">text</span>)}
173:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000238">
                    
                    <a name="M000238"></a><b>process_line</b>(text, index)
                    
                </div>
                
                <div class="description">
                  <p>
Processes a single line of <a href="../Haml.html">Haml</a>.
</p>
<p>
This method doesn&#8217;t return anything; it simply processes the line and
adds the appropriate code to `@precompiled`.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000238_source')" id="l_M000238_source">show</a>
                        
                    </p>
                    <div id="M000238_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/haml/parser.rb, line 179</span>
179:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">process_line</span>(<span class="ruby-identifier">text</span>, <span class="ruby-identifier">index</span>)
180:       <span class="ruby-ivar">@index</span> = <span class="ruby-identifier">index</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
181: 
182:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">text</span>[<span class="ruby-value">0</span>]
183:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">DIV_CLASS</span>; <span class="ruby-identifier">push</span> <span class="ruby-identifier">div</span>(<span class="ruby-identifier">text</span>)
184:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">DIV_ID</span>
185:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">push</span> <span class="ruby-identifier">plain</span>(<span class="ruby-identifier">text</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">text</span>[<span class="ruby-value">1</span>] <span class="ruby-operator">==</span> <span class="ruby-value">?{</span>
186:         <span class="ruby-identifier">push</span> <span class="ruby-identifier">div</span>(<span class="ruby-identifier">text</span>)
187:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">ELEMENT</span>; <span class="ruby-identifier">push</span> <span class="ruby-identifier">tag</span>(<span class="ruby-identifier">text</span>)
188:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">COMMENT</span>; <span class="ruby-identifier">push</span> <span class="ruby-identifier">comment</span>(<span class="ruby-identifier">text</span>[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>].<span class="ruby-identifier">strip</span>)
189:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">SANITIZE</span>
190:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">push</span> <span class="ruby-identifier">plain</span>(<span class="ruby-identifier">text</span>[<span class="ruby-value">3</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>].<span class="ruby-identifier">strip</span>, <span class="ruby-identifier">:escape_html</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">text</span>[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">2</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;==&quot;</span>
191:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">push</span> <span class="ruby-identifier">script</span>(<span class="ruby-identifier">text</span>[<span class="ruby-value">2</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>].<span class="ruby-identifier">strip</span>, <span class="ruby-identifier">:escape_html</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">text</span>[<span class="ruby-value">1</span>] <span class="ruby-operator">==</span> <span class="ruby-constant">SCRIPT</span>
192:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">push</span> <span class="ruby-identifier">flat_script</span>(<span class="ruby-identifier">text</span>[<span class="ruby-value">2</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>].<span class="ruby-identifier">strip</span>, <span class="ruby-identifier">:escape_html</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">text</span>[<span class="ruby-value">1</span>] <span class="ruby-operator">==</span> <span class="ruby-constant">FLAT_SCRIPT</span>
193:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">push</span> <span class="ruby-identifier">plain</span>(<span class="ruby-identifier">text</span>[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>].<span class="ruby-identifier">strip</span>, <span class="ruby-identifier">:escape_html</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">text</span>[<span class="ruby-value">1</span>] <span class="ruby-operator">==</span> <span class="ruby-value">?\s</span>
194:         <span class="ruby-identifier">push</span> <span class="ruby-identifier">plain</span>(<span class="ruby-identifier">text</span>)
195:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">SCRIPT</span>
196:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">push</span> <span class="ruby-identifier">plain</span>(<span class="ruby-identifier">text</span>[<span class="ruby-value">2</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>].<span class="ruby-identifier">strip</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">text</span>[<span class="ruby-value">1</span>] <span class="ruby-operator">==</span> <span class="ruby-constant">SCRIPT</span>
197:         <span class="ruby-identifier">push</span> <span class="ruby-identifier">script</span>(<span class="ruby-identifier">text</span>[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>])
198:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">FLAT_SCRIPT</span>; <span class="ruby-identifier">push</span> <span class="ruby-identifier">flat_script</span>(<span class="ruby-identifier">text</span>[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>])
199:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">SILENT_SCRIPT</span>; <span class="ruby-identifier">push</span> <span class="ruby-identifier">silent_script</span>(<span class="ruby-identifier">text</span>)
200:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">FILTER</span>; <span class="ruby-identifier">push</span> <span class="ruby-identifier">filter</span>(<span class="ruby-identifier">text</span>[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>].<span class="ruby-identifier">downcase</span>)
201:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">DOCTYPE</span>
202:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">push</span> <span class="ruby-identifier">doctype</span>(<span class="ruby-identifier">text</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">text</span>[<span class="ruby-value">0</span><span class="ruby-operator">...</span><span class="ruby-value">3</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">'!!!'</span>
203:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">push</span> <span class="ruby-identifier">plain</span>(<span class="ruby-identifier">text</span>[<span class="ruby-value">3</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>].<span class="ruby-identifier">strip</span>, <span class="ruby-operator">!</span><span class="ruby-identifier">:escape_html</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">text</span>[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">2</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;==&quot;</span>
204:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">push</span> <span class="ruby-identifier">script</span>(<span class="ruby-identifier">text</span>[<span class="ruby-value">2</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>].<span class="ruby-identifier">strip</span>, <span class="ruby-operator">!</span><span class="ruby-identifier">:escape_html</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">text</span>[<span class="ruby-value">1</span>] <span class="ruby-operator">==</span> <span class="ruby-constant">SCRIPT</span>
205:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">push</span> <span class="ruby-identifier">flat_script</span>(<span class="ruby-identifier">text</span>[<span class="ruby-value">2</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>].<span class="ruby-identifier">strip</span>, <span class="ruby-operator">!</span><span class="ruby-identifier">:escape_html</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">text</span>[<span class="ruby-value">1</span>] <span class="ruby-operator">==</span> <span class="ruby-constant">FLAT_SCRIPT</span>
206:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">push</span> <span class="ruby-identifier">plain</span>(<span class="ruby-identifier">text</span>[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>].<span class="ruby-identifier">strip</span>, <span class="ruby-operator">!</span><span class="ruby-identifier">:escape_html</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">text</span>[<span class="ruby-value">1</span>] <span class="ruby-operator">==</span> <span class="ruby-value">?\s</span>
207:         <span class="ruby-identifier">push</span> <span class="ruby-identifier">plain</span>(<span class="ruby-identifier">text</span>)
208:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">ESCAPE</span>; <span class="ruby-identifier">push</span> <span class="ruby-identifier">plain</span>(<span class="ruby-identifier">text</span>[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>])
209:       <span class="ruby-keyword kw">else</span>; <span class="ruby-identifier">push</span> <span class="ruby-identifier">plain</span>(<span class="ruby-identifier">text</span>)
210:       <span class="ruby-keyword kw">end</span>
211:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000241">
                    
                    <a name="M000241"></a><b>push</b>(node)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000241_source')" id="l_M000241_source">show</a>
                        
                    </p>
                    <div id="M000241_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/haml/parser.rb, line 222</span>
222:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">push</span>(<span class="ruby-identifier">node</span>)
223:       <span class="ruby-ivar">@parent</span>.<span class="ruby-identifier">children</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">node</span>
224:       <span class="ruby-identifier">node</span>.<span class="ruby-identifier">parent</span> = <span class="ruby-ivar">@parent</span>
225:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000272">
                    
                    <a name="M000272"></a><b>raw_next_line</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000272_source')" id="l_M000272_source">show</a>
                        
                    </p>
                    <div id="M000272_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/haml/parser.rb, line 593</span>
593:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">raw_next_line</span>
594:       <span class="ruby-identifier">text</span> = <span class="ruby-ivar">@template</span>.<span class="ruby-identifier">shift</span>
595:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">text</span>
596: 
597:       <span class="ruby-identifier">index</span> = <span class="ruby-ivar">@template_index</span>
598:       <span class="ruby-ivar">@template_index</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
599: 
600:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">text</span>, <span class="ruby-identifier">index</span>
601:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000243">
                    
                    <a name="M000243"></a><b>script</b>(text, escape_html = nil, preserve = false)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000243_source')" id="l_M000243_source">show</a>
                        
                    </p>
                    <div id="M000243_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/haml/parser.rb, line 240</span>
240:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">script</span>(<span class="ruby-identifier">text</span>, <span class="ruby-identifier">escape_html</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">preserve</span> = <span class="ruby-keyword kw">false</span>)
241:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">SyntaxError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;There's no Ruby code for = to evaluate.&quot;</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">text</span>.<span class="ruby-identifier">empty?</span>
242:       <span class="ruby-identifier">text</span> = <span class="ruby-identifier">handle_ruby_multiline</span>(<span class="ruby-identifier">text</span>)
243:       <span class="ruby-identifier">escape_html</span> = <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:escape_html</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">escape_html</span>.<span class="ruby-identifier">nil?</span>
244: 
245:       <span class="ruby-constant">ParseNode</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:script</span>, <span class="ruby-ivar">@index</span>, <span class="ruby-identifier">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">text</span>, <span class="ruby-identifier">:escape_html</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">escape_html</span>,
246:         <span class="ruby-identifier">:preserve</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">preserve</span>)
247:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000245">
                    
                    <a name="M000245"></a><b>silent_script</b>(text)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000245_source')" id="l_M000245_source">show</a>
                        
                    </p>
                    <div id="M000245_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/haml/parser.rb, line 254</span>
254:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">silent_script</span>(<span class="ruby-identifier">text</span>)
255:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">haml_comment</span>(<span class="ruby-identifier">text</span>[<span class="ruby-value">2</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>]) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">text</span>[<span class="ruby-value">1</span>] <span class="ruby-operator">==</span> <span class="ruby-constant">SILENT_COMMENT</span>
256: 
257:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">SyntaxError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;You don't need to use \&quot;- end\&quot; in Haml. Un-indent to close a block:\n- if foo?\n  %strong Foo!\n- else\n  Not foo.\n%p This line is un-indented, so it isn't part of the \&quot;if\&quot; block\n&quot;</span>.<span class="ruby-identifier">rstrip</span>, <span class="ruby-ivar">@index</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">text</span>[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>].<span class="ruby-identifier">strip</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;end&quot;</span>
258: 
259:       <span class="ruby-identifier">text</span> = <span class="ruby-identifier">handle_ruby_multiline</span>(<span class="ruby-identifier">text</span>)
260:       <span class="ruby-identifier">keyword</span> = <span class="ruby-identifier">block_keyword</span>(<span class="ruby-identifier">text</span>)
261: 
262:       <span class="ruby-ivar">@tab_up</span> = [<span class="ruby-value str">&quot;if&quot;</span>, <span class="ruby-value str">&quot;case&quot;</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">keyword</span>)
263:       <span class="ruby-constant">ParseNode</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:silent_script</span>, <span class="ruby-ivar">@index</span>,
264:         <span class="ruby-identifier">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">text</span>[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>], <span class="ruby-identifier">:keyword</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">keyword</span>)
265:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000247">
                    
                    <a name="M000247"></a><b>tag</b>(line)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000247_source')" id="l_M000247_source">show</a>
                        
                    </p>
                    <div id="M000247_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/haml/parser.rb, line 280</span>
280:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">tag</span>(<span class="ruby-identifier">line</span>)
281:       <span class="ruby-identifier">tag_name</span>, <span class="ruby-identifier">attributes</span>, <span class="ruby-identifier">attributes_hashes</span>, <span class="ruby-identifier">object_ref</span>, <span class="ruby-identifier">nuke_outer_whitespace</span>,
282:         <span class="ruby-identifier">nuke_inner_whitespace</span>, <span class="ruby-identifier">action</span>, <span class="ruby-identifier">value</span>, <span class="ruby-identifier">last_line</span> = <span class="ruby-identifier">parse_tag</span>(<span class="ruby-identifier">line</span>)
283: 
284:       <span class="ruby-identifier">preserve_tag</span> = <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:preserve</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">tag_name</span>)
285:       <span class="ruby-identifier">nuke_inner_whitespace</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">preserve_tag</span>
286:       <span class="ruby-identifier">preserve_tag</span> = <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:ugly</span>]
287:       <span class="ruby-identifier">escape_html</span> = (<span class="ruby-identifier">action</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'&amp;'</span> <span class="ruby-operator">||</span> (<span class="ruby-identifier">action</span> <span class="ruby-operator">!=</span> <span class="ruby-value str">'!'</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:escape_html</span>]))
288: 
289:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">action</span>
290:       <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'/'</span>; <span class="ruby-identifier">self_closing</span> = <span class="ruby-keyword kw">true</span>
291:       <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'~'</span>; <span class="ruby-identifier">parse</span> = <span class="ruby-identifier">preserve_script</span> = <span class="ruby-keyword kw">true</span>
292:       <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'='</span>
293:         <span class="ruby-identifier">parse</span> = <span class="ruby-keyword kw">true</span>
294:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">value</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-value">?=</span>
295:           <span class="ruby-identifier">value</span> = <span class="ruby-identifier">unescape_interpolation</span>(<span class="ruby-identifier">value</span>[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>].<span class="ruby-identifier">strip</span>, <span class="ruby-identifier">escape_html</span>)
296:           <span class="ruby-identifier">escape_html</span> = <span class="ruby-keyword kw">false</span>
297:         <span class="ruby-keyword kw">end</span>
298:       <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'&amp;'</span>, <span class="ruby-value str">'!'</span>
299:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">value</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-value">?=</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">value</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-value">?~</span>
300:           <span class="ruby-identifier">parse</span> = <span class="ruby-keyword kw">true</span>
301:           <span class="ruby-identifier">preserve_script</span> = (<span class="ruby-identifier">value</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-value">?~</span>)
302:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">value</span>[<span class="ruby-value">1</span>] <span class="ruby-operator">==</span> <span class="ruby-value">?=</span>
303:             <span class="ruby-identifier">value</span> = <span class="ruby-identifier">unescape_interpolation</span>(<span class="ruby-identifier">value</span>[<span class="ruby-value">2</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>].<span class="ruby-identifier">strip</span>, <span class="ruby-identifier">escape_html</span>)
304:             <span class="ruby-identifier">escape_html</span> = <span class="ruby-keyword kw">false</span>
305:           <span class="ruby-keyword kw">else</span>
306:             <span class="ruby-identifier">value</span> = <span class="ruby-identifier">value</span>[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>].<span class="ruby-identifier">strip</span>
307:           <span class="ruby-keyword kw">end</span>
308:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">contains_interpolation?</span>(<span class="ruby-identifier">value</span>)
309:           <span class="ruby-identifier">value</span> = <span class="ruby-identifier">unescape_interpolation</span>(<span class="ruby-identifier">value</span>, <span class="ruby-identifier">escape_html</span>)
310:           <span class="ruby-identifier">parse</span> = <span class="ruby-keyword kw">true</span>
311:           <span class="ruby-identifier">escape_html</span> = <span class="ruby-keyword kw">false</span>
312:         <span class="ruby-keyword kw">end</span>
313:       <span class="ruby-keyword kw">else</span>
314:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">contains_interpolation?</span>(<span class="ruby-identifier">value</span>)
315:           <span class="ruby-identifier">value</span> = <span class="ruby-identifier">unescape_interpolation</span>(<span class="ruby-identifier">value</span>, <span class="ruby-identifier">escape_html</span>)
316:           <span class="ruby-identifier">parse</span> = <span class="ruby-keyword kw">true</span>
317:           <span class="ruby-identifier">escape_html</span> = <span class="ruby-keyword kw">false</span>
318:         <span class="ruby-keyword kw">end</span>
319:       <span class="ruby-keyword kw">end</span>
320: 
321:       <span class="ruby-identifier">attributes</span> = <span class="ruby-constant">Parser</span>.<span class="ruby-identifier">parse_class_and_id</span>(<span class="ruby-identifier">attributes</span>)
322:       <span class="ruby-identifier">attributes_list</span> = []
323: 
324:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">attributes_hashes</span>[<span class="ruby-identifier">:new</span>]
325:         <span class="ruby-identifier">static_attributes</span>, <span class="ruby-identifier">attributes_hash</span> = <span class="ruby-identifier">attributes_hashes</span>[<span class="ruby-identifier">:new</span>]
326:         <span class="ruby-constant">Buffer</span>.<span class="ruby-identifier">merge_attrs</span>(<span class="ruby-identifier">attributes</span>, <span class="ruby-identifier">static_attributes</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">static_attributes</span>
327:         <span class="ruby-identifier">attributes_list</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">attributes_hash</span>
328:       <span class="ruby-keyword kw">end</span>
329: 
330:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">attributes_hashes</span>[<span class="ruby-identifier">:old</span>]
331:         <span class="ruby-identifier">static_attributes</span> = <span class="ruby-identifier">parse_static_hash</span>(<span class="ruby-identifier">attributes_hashes</span>[<span class="ruby-identifier">:old</span>])
332:         <span class="ruby-constant">Buffer</span>.<span class="ruby-identifier">merge_attrs</span>(<span class="ruby-identifier">attributes</span>, <span class="ruby-identifier">static_attributes</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">static_attributes</span>
333:         <span class="ruby-identifier">attributes_list</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">attributes_hashes</span>[<span class="ruby-identifier">:old</span>] <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">static_attributes</span> <span class="ruby-operator">||</span> <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:suppress_eval</span>]
334:       <span class="ruby-keyword kw">end</span>
335: 
336:       <span class="ruby-identifier">attributes_list</span>.<span class="ruby-identifier">compact!</span>
337: 
338:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">SyntaxError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;Illegal nesting: nesting within a self-closing tag is illegal.&quot;</span>, <span class="ruby-ivar">@next_line</span>.<span class="ruby-identifier">index</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block_opened?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">self_closing</span>
339:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">SyntaxError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;There's no Ruby code for #{action} to evaluate.&quot;</span>, <span class="ruby-identifier">last_line</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">parse</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">empty?</span>
340:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">SyntaxError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;Self-closing tags can't have content.&quot;</span>, <span class="ruby-identifier">last_line</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">self_closing</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">value</span>.<span class="ruby-identifier">empty?</span>
341: 
342:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block_opened?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">value</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">is_ruby_multiline?</span>(<span class="ruby-identifier">value</span>)
343:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">SyntaxError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;Illegal nesting: content can't be both given on the same line as %#{tag_name} and nested within it.&quot;</span>, <span class="ruby-ivar">@next_line</span>.<span class="ruby-identifier">index</span>)
344:       <span class="ruby-keyword kw">end</span>
345: 
346:       <span class="ruby-identifier">self_closing</span> <span class="ruby-operator">||=</span> <span class="ruby-operator">!</span><span class="ruby-operator">!</span>(<span class="ruby-operator">!</span><span class="ruby-identifier">block_opened?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:autoclose</span>].<span class="ruby-identifier">any?</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span> <span class="ruby-identifier">t</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">tag_name</span>})
347:       <span class="ruby-identifier">value</span> = <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">block_opened?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">self_closing</span>)
348:       <span class="ruby-identifier">value</span> = <span class="ruby-identifier">handle_ruby_multiline</span>(<span class="ruby-identifier">value</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">parse</span>
349: 
350:       <span class="ruby-constant">ParseNode</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:tag</span>, <span class="ruby-ivar">@index</span>, <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">tag_name</span>, <span class="ruby-identifier">:attributes</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">attributes</span>,
351:         <span class="ruby-identifier">:attributes_hashes</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">attributes_list</span>, <span class="ruby-identifier">:self_closing</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">self_closing</span>,
352:         <span class="ruby-identifier">:nuke_inner_whitespace</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">nuke_inner_whitespace</span>,
353:         <span class="ruby-identifier">:nuke_outer_whitespace</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">nuke_outer_whitespace</span>, <span class="ruby-identifier">:object_ref</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">object_ref</span>,
354:         <span class="ruby-identifier">:escape_html</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">escape_html</span>, <span class="ruby-identifier">:preserve_tag</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">preserve_tag</span>,
355:         <span class="ruby-identifier">:preserve_script</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">preserve_script</span>, <span class="ruby-identifier">:parse</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">parse</span>, <span class="ruby-identifier">:value</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">value</span>)
356:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000275">
                    
                    <a name="M000275"></a><b>un_next_line</b>(line)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000275_source')" id="l_M000275_source">show</a>
                        
                    </p>
                    <div id="M000275_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/haml/parser.rb, line 633</span>
633:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">un_next_line</span>(<span class="ruby-identifier">line</span>)
634:       <span class="ruby-ivar">@template</span>.<span class="ruby-identifier">unshift</span> <span class="ruby-identifier">line</span>
635:       <span class="ruby-ivar">@template_index</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span>
636:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000283">
                    
                    <a name="M000283"></a><b>unescape_interpolation</b>(str, escape_html = nil)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000283_source')" id="l_M000283_source">show</a>
                        
                    </p>
                    <div id="M000283_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/haml/parser.rb, line 677</span>
677:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">unescape_interpolation</span>(<span class="ruby-identifier">str</span>, <span class="ruby-identifier">escape_html</span> = <span class="ruby-keyword kw">nil</span>)
678:       <span class="ruby-identifier">res</span> = <span class="ruby-value str">''</span>
679:       <span class="ruby-identifier">rest</span> = <span class="ruby-constant">Haml</span><span class="ruby-operator">::</span><span class="ruby-constant">Shared</span>.<span class="ruby-identifier">handle_interpolation</span> <span class="ruby-identifier">str</span>.<span class="ruby-identifier">dump</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">scan</span><span class="ruby-operator">|</span>
680:         <span class="ruby-identifier">escapes</span> = (<span class="ruby-identifier">scan</span>[<span class="ruby-value">2</span>].<span class="ruby-identifier">size</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>) <span class="ruby-operator">/</span> <span class="ruby-value">2</span>
681:         <span class="ruby-identifier">res</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">scan</span>.<span class="ruby-identifier">matched</span>[<span class="ruby-value">0</span><span class="ruby-operator">...</span><span class="ruby-value">-3</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">escapes</span>]
682:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">escapes</span> <span class="ruby-operator">%</span> <span class="ruby-value">2</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span>
683:           <span class="ruby-identifier">res</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">'#{'</span>
684:         <span class="ruby-keyword kw">else</span>
685:           <span class="ruby-identifier">content</span> = <span class="ruby-identifier">eval</span>(<span class="ruby-value str">'&quot;'</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">balance</span>(<span class="ruby-identifier">scan</span>, <span class="ruby-value">?{</span>, <span class="ruby-value">?}</span>, <span class="ruby-value">1</span>)[<span class="ruby-value">0</span>][<span class="ruby-value">0</span><span class="ruby-operator">...</span><span class="ruby-value">-1</span>] <span class="ruby-operator">+</span> <span class="ruby-value str">'&quot;'</span>)
686:           <span class="ruby-identifier">content</span> = <span class="ruby-node">&quot;Haml::Helpers.html_escape((#{content}))&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">escape_html</span>
687:           <span class="ruby-identifier">res</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">'#{'</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">content</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;}&quot;</span><span class="ruby-comment cmt"># Use eval to get rid of string escapes</span>
688:         <span class="ruby-keyword kw">end</span>
689:       <span class="ruby-keyword kw">end</span>
690:       <span class="ruby-identifier">res</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">rest</span>
691:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    