<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>Haml::Engine</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../css/main.css" type="text/css" media="screen" />
    <script src="../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Class</span> 
            Haml::Engine 
            
                <span class="parent">&lt; 
                    
                    <a href="../Object.html">Object</a>
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../files/lib/haml/engine_rb.html">lib/haml/engine.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    
    <div class="description">
        <p>
This is the frontend for using <a href="../Haml.html">Haml</a>
programmatically. It can be directly used by the user by creating a new
instance and calling {#render} to render the template. For example:
</p>
<pre>
    template = File.read('templates/really_cool_template.haml')
    haml_engine = Haml::Engine.new(template)
    output = haml_engine.render
    puts output
</pre>

    </div>
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>D</dt>
        <dd>
            <ul>
                
                <li><a href="#M000052">def_method</a></li>
                
            </ul>
        </dd>
    
        <dt>H</dt>
        <dd>
            <ul>
                
                <li><a href="#M000037">html4?</a>,</li>
                
                <li><a href="#M000038">html5?</a>,</li>
                
                <li><a href="#M000036">html?</a></li>
                
            </ul>
        </dd>
    
        <dt>N</dt>
        <dd>
            <ul>
                
                <li><a href="#M000041">new</a></li>
                
            </ul>
        </dd>
    
        <dt>O</dt>
        <dd>
            <ul>
                
                <li><a href="#M000053">options_for_buffer</a></li>
                
            </ul>
        </dd>
    
        <dt>P</dt>
        <dd>
            <ul>
                
                <li><a href="#M000039">precompiled</a></li>
                
            </ul>
        </dd>
    
        <dt>R</dt>
        <dd>
            <ul>
                
                <li><a href="#M000044">render</a>,</li>
                
                <li><a href="#M000050">render_proc</a></li>
                
            </ul>
        </dd>
    
        <dt>S</dt>
        <dd>
            <ul>
                
                <li><a href="#M000054">set_locals</a></li>
                
            </ul>
        </dd>
    
        <dt>T</dt>
        <dd>
            <ul>
                
                <li><a href="#M000048">to_html</a></li>
                
            </ul>
        </dd>
    
        <dt>X</dt>
        <dd>
            <ul>
                
                <li><a href="#M000035">xhtml?</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    
    <div class="sectiontitle">Included Modules</div>
    <ul>
        
        <li>
            
            <a href="Filters/Textile.html">Haml::Filters::Textile</a>
            
            START:includes
        </li>
        
        <li>
            
            <a href="Filters/Textile.html">Haml::Filters::Textile</a>
            
            START:includes
        </li>
        
    </ul>
    

    

    

    

    
    <div class="sectiontitle">Attributes</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>options</td>
            <td class='attr-desc'><p>
The options hash. See {file:HAML_REFERENCE.md#haml_options the <a
href="../Haml.html">Haml</a> options documentation}.
</p>
<p>
@return [{Symbol => Object}]
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>indentation</td>
            <td class='attr-desc'><p>
The indentation used in the <a href="../Haml.html">Haml</a> document, or
`nil` if the indentation is ambiguous (for example, for a single-level
document).
</p>
<p>
@return [String]
</p></td>
        </tr>
        
    </table>
    

    
            <div class="sectiontitle">Class Public methods</div>
            
            <div class="method">
                <div class="title" id="M000041">
                    
                    <a name="M000041"></a><b>new</b>(template, options = {})
                    
                </div>
                
                <div class="description">
                  <p>
Precompiles the <a href="../Haml.html">Haml</a> template.
</p>
<p>
@param template [String] The <a href="../Haml.html">Haml</a> template
@param options [{Symbol => Object}] An options hash;
</p>
<pre>
  see {file:HAML_REFERENCE.md#haml_options the Haml options documentation}
</pre>
<p>
@raise [Haml::Error] if there&#8217;s a <a href="../Haml.html">Haml</a>
syntax error in the template
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000041_source')" id="l_M000041_source">show</a>
                        
                    </p>
                    <div id="M000041_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/haml/engine.rb, line 74</span>
 74:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">template</span>, <span class="ruby-identifier">options</span> = {})
 75:       <span class="ruby-ivar">@options</span> = {
 76:         <span class="ruby-identifier">:suppress_eval</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>,
 77:         <span class="ruby-identifier">:attr_wrapper</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;'&quot;</span>,
 78: 
 79:         <span class="ruby-comment cmt"># Don't forget to update the docs in doc-src/HAML_REFERENCE.md</span>
 80:         <span class="ruby-comment cmt"># if you update these</span>
 81:         <span class="ruby-identifier">:autoclose</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">%w[meta img link br hr input area param col base]</span>,
 82:         <span class="ruby-identifier">:preserve</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">%w[textarea pre code]</span>,
 83: 
 84:         <span class="ruby-identifier">:filename</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'(haml)'</span>,
 85:         <span class="ruby-identifier">:line</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>,
 86:         <span class="ruby-identifier">:ugly</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>,
 87:         <span class="ruby-identifier">:format</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:xhtml</span>,
 88:         <span class="ruby-identifier">:escape_html</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>,
 89:         <span class="ruby-identifier">:escape_attrs</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>,
 90:       }
 91: 
 92: 
 93:       <span class="ruby-identifier">template</span> = <span class="ruby-identifier">check_haml_encoding</span>(<span class="ruby-identifier">template</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">msg</span>, <span class="ruby-identifier">line</span><span class="ruby-operator">|</span>
 94:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">Haml</span><span class="ruby-operator">::</span><span class="ruby-constant">Error</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">msg</span>, <span class="ruby-identifier">line</span>)
 95:       <span class="ruby-keyword kw">end</span>
 96: 
 97:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">ruby1_8?</span>
 98:         <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:encoding</span>] = <span class="ruby-constant">Encoding</span>.<span class="ruby-identifier">default_internal</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">template</span>.<span class="ruby-identifier">encoding</span>
 99:         <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:encoding</span>] = <span class="ruby-value str">&quot;utf-8&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:encoding</span>].<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;US-ASCII&quot;</span>
100:       <span class="ruby-keyword kw">end</span>
101:       <span class="ruby-ivar">@options</span>.<span class="ruby-identifier">merge!</span> <span class="ruby-identifier">options</span>.<span class="ruby-identifier">reject</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">nil?</span>}
102:       <span class="ruby-ivar">@index</span> = <span class="ruby-value">0</span>
103: 
104:       <span class="ruby-keyword kw">unless</span> [<span class="ruby-identifier">:xhtml</span>, <span class="ruby-identifier">:html4</span>, <span class="ruby-identifier">:html5</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:format</span>])
105:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">Haml</span><span class="ruby-operator">::</span><span class="ruby-constant">Error</span>, <span class="ruby-node">&quot;Invalid output format #{@options[:format].inspect}&quot;</span>
106:       <span class="ruby-keyword kw">end</span>
107: 
108:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:encoding</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:encoding</span>].<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Encoding</span>)
109:         <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:encoding</span>] = <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:encoding</span>].<span class="ruby-identifier">name</span>
110:       <span class="ruby-keyword kw">end</span>
111: 
112:       <span class="ruby-comment cmt"># :eod is a special end-of-document marker</span>
113:       <span class="ruby-ivar">@template</span> = (<span class="ruby-identifier">template</span>.<span class="ruby-identifier">rstrip</span>).<span class="ruby-identifier">split</span>(<span class="ruby-regexp re">/\r\n|\r|\n/</span>) <span class="ruby-operator">+</span> [<span class="ruby-identifier">:eod</span>, <span class="ruby-identifier">:eod</span>]
114:       <span class="ruby-ivar">@template_index</span> = <span class="ruby-value">0</span>
115:       <span class="ruby-ivar">@to_close_stack</span> = []
116:       <span class="ruby-ivar">@output_tabs</span> = <span class="ruby-value">0</span>
117:       <span class="ruby-ivar">@template_tabs</span> = <span class="ruby-value">0</span>
118:       <span class="ruby-ivar">@flat</span> = <span class="ruby-keyword kw">false</span>
119:       <span class="ruby-ivar">@newlines</span> = <span class="ruby-value">0</span>
120:       <span class="ruby-ivar">@precompiled</span> = <span class="ruby-value str">''</span>
121:       <span class="ruby-ivar">@to_merge</span> = []
122:       <span class="ruby-ivar">@tab_change</span>  = <span class="ruby-value">0</span>
123: 
124:       <span class="ruby-identifier">compile</span>(<span class="ruby-identifier">parse</span>)
125:     <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Haml</span><span class="ruby-operator">::</span><span class="ruby-constant">Error</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
126:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@index</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">e</span>.<span class="ruby-identifier">line</span>
127:         <span class="ruby-identifier">e</span>.<span class="ruby-identifier">backtrace</span>.<span class="ruby-identifier">unshift</span> <span class="ruby-node">&quot;#{@options[:filename]}:#{(e.line ? e.line + 1 : @index) + @options[:line] - 1}&quot;</span>
128:       <span class="ruby-keyword kw">end</span>
129:       <span class="ruby-identifier">raise</span>
130:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M000052">
                    
                    <a name="M000052"></a><b>def_method</b>(object, name, *local_names)
                    
                </div>
                
                <div class="description">
                  <p>
Defines a method on `object` with the given name that renders the template
and returns the result as a string.
</p>
<p>
If `object` is a class or module, the method will instead by defined as an
instance method. For example:
</p>
<pre>
    t = Time.now
    Haml::Engine.new(&quot;%p\n  Today's date is\n  .date= self.to_s&quot;).def_method(t, :render)
    t.render #=&gt; &quot;&lt;p&gt;\n  Today's date is\n  &lt;div class='date'&gt;Fri Nov 23 18:28:29 -0800 2007&lt;/div&gt;\n&lt;/p&gt;\n&quot;

    Haml::Engine.new(&quot;.upcased= upcase&quot;).def_method(String, :upcased_div)
    &quot;foobar&quot;.upcased_div #=&gt; &quot;&lt;div class='upcased'&gt;FOOBAR&lt;/div&gt;\n&quot;
</pre>
<p>
The first argument of the defined method is a hash of local variable names
to values. However, due to an unfortunate Ruby quirk, the local variables
which can be assigned must be pre-declared. This is done with the
`local_names` argument. For example:
</p>
<pre>
    # This works
    obj = Object.new
    Haml::Engine.new(&quot;%p= foo&quot;).def_method(obj, :render, :foo)
    obj.render(:foo =&gt; &quot;Hello!&quot;) #=&gt; &quot;&lt;p&gt;Hello!&lt;/p&gt;&quot;

    # This doesn't
    obj = Object.new
    Haml::Engine.new(&quot;%p= foo&quot;).def_method(obj, :render)
    obj.render(:foo =&gt; &quot;Hello!&quot;) #=&gt; NameError: undefined local variable or method `foo'
</pre>
<p>
Note that <a href="../Haml.html">Haml</a> modifies the evaluation context
(either the scope object or the `self` object of the scope binding). It
extends {Haml::Helpers}, and various instance variables are set (all
prefixed with `haml_`).
</p>
<p>
@param object [<a href="../Object.html">Object</a>, Module] The object on
which to define the method @param name [String, Symbol] The name of the
method to define @param local_names [Array<Symbol>] The names of the locals
that can be passed to the proc
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000052_source')" id="l_M000052_source">show</a>
                        
                    </p>
                    <div id="M000052_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/haml/engine.rb, line 275</span>
275:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">def_method</span>(<span class="ruby-identifier">object</span>, <span class="ruby-identifier">name</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">local_names</span>)
276:       <span class="ruby-identifier">method</span> = <span class="ruby-identifier">object</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Module</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">:module_eval</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">:instance_eval</span>
277: 
278:       <span class="ruby-identifier">object</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">method</span>, <span class="ruby-node">&quot;def #{name}(_haml_locals = {}); #{precompiled_with_ambles(local_names)}; end&quot;</span>,
279:                   <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:filename</span>], <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:line</span>])
280:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000037">
                    
                    <a name="M000037"></a><b>html4?</b>()
                    
                </div>
                
                <div class="description">
                  <p>
@return [Boolean] Whether or not the format is HTML4.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000037_source')" id="l_M000037_source">show</a>
                        
                    </p>
                    <div id="M000037_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/haml/engine.rb, line 46</span>
46:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">html4?</span>
47:       <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:format</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">:html4</span>
48:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000038">
                    
                    <a name="M000038"></a><b>html5?</b>()
                    
                </div>
                
                <div class="description">
                  <p>
@return [Boolean] Whether or not the format is HTML5.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000038_source')" id="l_M000038_source">show</a>
                        
                    </p>
                    <div id="M000038_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/haml/engine.rb, line 51</span>
51:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">html5?</span>
52:       <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:format</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">:html5</span>
53:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000036">
                    
                    <a name="M000036"></a><b>html?</b>()
                    
                </div>
                
                <div class="description">
                  <p>
@return [Boolean] Whether or not the format is any flavor of <a
href="HTML.html">HTML</a>.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000036_source')" id="l_M000036_source">show</a>
                        
                    </p>
                    <div id="M000036_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/haml/engine.rb, line 41</span>
41:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">html?</span>
42:       <span class="ruby-identifier">html4?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">html5?</span>
43:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000039">
                    
                    <a name="M000039"></a><b>precompiled</b>()
                    
                </div>
                
                <div class="description">
                  <p>
The source code that is evaluated to produce the <a
href="../Haml.html">Haml</a> document.
</p>
<p>
In Ruby 1.9, this is automatically converted to the correct encoding (see
{file:HAML_REFERENCE.md#encoding-option the `:encoding` option}).
</p>
<p>
@return [String]
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000039_source')" id="l_M000039_source">show</a>
                        
                    </p>
                    <div id="M000039_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/haml/engine.rb, line 61</span>
61:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">precompiled</span>
62:       <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@precompiled</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ruby1_8?</span>
63:       <span class="ruby-identifier">encoding</span> = <span class="ruby-constant">Encoding</span>.<span class="ruby-identifier">find</span>(<span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:encoding</span>])
64:       <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@precompiled</span>.<span class="ruby-identifier">force_encoding</span>(<span class="ruby-identifier">encoding</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">encoding</span> <span class="ruby-operator">==</span> <span class="ruby-constant">Encoding</span><span class="ruby-operator">::</span><span class="ruby-constant">BINARY</span>
65:       <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@precompiled</span>.<span class="ruby-identifier">encode</span>(<span class="ruby-identifier">encoding</span>)
66:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000044">
                    
                    <a name="M000044"></a><b>render</b>(scope = Object.new, locals = {}, &amp;block)
                    
                </div>
                
                <div class="description">
                  <p>
Processes the template and returns the result as a string.
</p>
<p>
`scope` is the context in which the template is evaluated. If it&#8217;s a
`Binding` or `Proc` object, <a href="../Haml.html">Haml</a> uses it as the
second argument to `Kernel#eval`; otherwise, <a
href="../Haml.html">Haml</a> just uses its `instance_eval` context.
</p>
<p>
Note that <a href="../Haml.html">Haml</a> modifies the evaluation context
(either the scope object or the `self` object of the scope binding). It
extends {Haml::Helpers}, and various instance variables are set (all
prefixed with `haml_`). For example:
</p>
<pre>
    s = &quot;foobar&quot;
    Haml::Engine.new(&quot;%p= upcase&quot;).render(s) #=&gt; &quot;&lt;p&gt;FOOBAR&lt;/p&gt;&quot;

    # s now extends Haml::Helpers
    s.respond_to?(:html_attrs) #=&gt; true
</pre>
<p>
`locals` is a hash of local variables to make available to the template.
For example:
</p>
<pre>
    Haml::Engine.new(&quot;%p= foo&quot;).render(Object.new, :foo =&gt; &quot;Hello, world!&quot;) #=&gt; &quot;&lt;p&gt;Hello, world!&lt;/p&gt;&quot;
</pre>
<p>
If a block is passed to render, that block is run when `yield` is called
within the template.
</p>
<p>
Due to some Ruby quirks, if `scope` is a `Binding` or `Proc` object and a
block is given, the evaluation context may not be quite what the user
expects. In particular, it&#8217;s equivalent to passing
`eval(&#8220;self&#8221;, scope)` as `scope`. This won&#8217;t have an
effect in most cases, but if you&#8217;re relying on local variables
defined in the context of `scope`, they won&#8217;t work.
</p>
<p>
@param scope [Binding, Proc, Object] The context in which the template is
evaluated @param locals [{Symbol => Object}] Local variables that will be
made available
</p>
<pre>
  to the template
</pre>
<p>
@param block [to_proc] A block that can be yielded to within the template
@return [String] The rendered template
</p>

                </div>
                
                
                <div class="aka">
                    This method is also aliased as
                    
                    <a href="Engine.html#M000048">to_html</a>
                    
                </div>
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000044_source')" id="l_M000044_source">show</a>
                        
                    </p>
                    <div id="M000044_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/haml/engine.rb, line 173</span>
173:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">render</span>(<span class="ruby-identifier">scope</span> = <span class="ruby-constant">Object</span>.<span class="ruby-identifier">new</span>, <span class="ruby-identifier">locals</span> = {}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
174:       <span class="ruby-identifier">buffer</span> = <span class="ruby-constant">Haml</span><span class="ruby-operator">::</span><span class="ruby-constant">Buffer</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">scope</span>.<span class="ruby-identifier">instance_variable_get</span>(<span class="ruby-value str">'@haml_buffer'</span>), <span class="ruby-identifier">options_for_buffer</span>)
175: 
176:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Binding</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Proc</span>)
177:         <span class="ruby-identifier">scope_object</span> = <span class="ruby-identifier">eval</span>(<span class="ruby-value str">&quot;self&quot;</span>, <span class="ruby-identifier">scope</span>)
178:         <span class="ruby-identifier">scope</span> = <span class="ruby-identifier">scope_object</span>.<span class="ruby-identifier">instance_eval</span>{<span class="ruby-identifier">binding</span>} <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block_given?</span>
179:       <span class="ruby-keyword kw">else</span>
180:         <span class="ruby-identifier">scope_object</span> = <span class="ruby-identifier">scope</span>
181:         <span class="ruby-identifier">scope</span> = <span class="ruby-identifier">scope_object</span>.<span class="ruby-identifier">instance_eval</span>{<span class="ruby-identifier">binding</span>}
182:       <span class="ruby-keyword kw">end</span>
183: 
184:       <span class="ruby-identifier">set_locals</span>(<span class="ruby-identifier">locals</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">:_hamlout</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">buffer</span>, <span class="ruby-identifier">:_erbout</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">buffer</span>.<span class="ruby-identifier">buffer</span>), <span class="ruby-identifier">scope</span>, <span class="ruby-identifier">scope_object</span>)
185: 
186:       <span class="ruby-identifier">scope_object</span>.<span class="ruby-identifier">instance_eval</span> <span class="ruby-keyword kw">do</span>
187:         <span class="ruby-identifier">extend</span> <span class="ruby-constant">Haml</span><span class="ruby-operator">::</span><span class="ruby-constant">Helpers</span>
188:         <span class="ruby-ivar">@haml_buffer</span> = <span class="ruby-identifier">buffer</span>
189:       <span class="ruby-keyword kw">end</span>
190: 
191:       <span class="ruby-identifier">eval</span>(<span class="ruby-identifier">precompiled</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;;&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">precompiled_method_return_value</span>,
192:         <span class="ruby-identifier">scope</span>, <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:filename</span>], <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:line</span>])
193:     <span class="ruby-keyword kw">ensure</span>
194:       <span class="ruby-comment cmt"># Get rid of the current buffer</span>
195:       <span class="ruby-identifier">scope_object</span>.<span class="ruby-identifier">instance_eval</span> <span class="ruby-keyword kw">do</span>
196:         <span class="ruby-ivar">@haml_buffer</span> = <span class="ruby-identifier">buffer</span>.<span class="ruby-identifier">upper</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">buffer</span>
197:       <span class="ruby-keyword kw">end</span>
198:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000050">
                    
                    <a name="M000050"></a><b>render_proc</b>(scope = Object.new, *local_names)
                    
                </div>
                
                <div class="description">
                  <p>
Returns a proc that, when called, renders the template and returns the
result as a string.
</p>
<p>
`scope` works the same as it does for render.
</p>
<p>
The first argument of the returned proc is a hash of local variable names
to values. However, due to an unfortunate Ruby quirk, the local variables
which can be assigned must be pre-declared. This is done with the
`local_names` argument. For example:
</p>
<pre>
    # This works
    Haml::Engine.new(&quot;%p= foo&quot;).render_proc(Object.new, :foo).call :foo =&gt; &quot;Hello!&quot;
      #=&gt; &quot;&lt;p&gt;Hello!&lt;/p&gt;&quot;

    # This doesn't
    Haml::Engine.new(&quot;%p= foo&quot;).render_proc.call :foo =&gt; &quot;Hello!&quot;
      #=&gt; NameError: undefined local variable or method `foo'
</pre>
<p>
The proc doesn&#8217;t take a block; any yields in the template will fail.
</p>
<p>
@param scope [Binding, Proc, Object] The context in which the template is
evaluated @param local_names [Array<Symbol>] The names of the locals that
can be passed to the proc @return [Proc] The proc that will run the
template
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000050_source')" id="l_M000050_source">show</a>
                        
                    </p>
                    <div id="M000050_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/haml/engine.rb, line 225</span>
225:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">render_proc</span>(<span class="ruby-identifier">scope</span> = <span class="ruby-constant">Object</span>.<span class="ruby-identifier">new</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">local_names</span>)
226:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Binding</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Proc</span>)
227:         <span class="ruby-identifier">scope_object</span> = <span class="ruby-identifier">eval</span>(<span class="ruby-value str">&quot;self&quot;</span>, <span class="ruby-identifier">scope</span>)
228:       <span class="ruby-keyword kw">else</span>
229:         <span class="ruby-identifier">scope_object</span> = <span class="ruby-identifier">scope</span>
230:         <span class="ruby-identifier">scope</span> = <span class="ruby-identifier">scope_object</span>.<span class="ruby-identifier">instance_eval</span>{<span class="ruby-identifier">binding</span>}
231:       <span class="ruby-keyword kw">end</span>
232: 
233:       <span class="ruby-identifier">eval</span>(<span class="ruby-value str">&quot;Proc.new { |*_haml_locals| _haml_locals = _haml_locals[0] || {};&quot;</span> <span class="ruby-operator">+</span>
234:            <span class="ruby-identifier">precompiled_with_ambles</span>(<span class="ruby-identifier">local_names</span>) <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;}\n&quot;</span>, <span class="ruby-identifier">scope</span>, <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:filename</span>], <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:line</span>])
235:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000048">
                    
                    <a name="M000048"></a><b>to_html</b>(scope = Object.new, locals = {}, &amp;block)
                    
                </div>
                
                <div class="description">
                  <p>
Alias for <a href="Engine.html#M000044">render</a>
</p>

                </div>
                
                
                
            </div>
            
            <div class="method">
                <div class="title" id="M000035">
                    
                    <a name="M000035"></a><b>xhtml?</b>()
                    
                </div>
                
                <div class="description">
                  <p>
@return [Boolean] Whether or not the format is XHTML.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000035_source')" id="l_M000035_source">show</a>
                        
                    </p>
                    <div id="M000035_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/haml/engine.rb, line 36</span>
36:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">xhtml?</span>
37:       <span class="ruby-keyword kw">not</span> <span class="ruby-identifier">html?</span>
38:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Protected methods</div>
            
            <div class="method">
                <div class="title" id="M000053">
                    
                    <a name="M000053"></a><b>options_for_buffer</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Returns a subset of {#options}: those that {Haml::Buffer} cares about. All
of the values here are such that when `inspect` is called on the hash, it
can be `Kernel#eval`ed to get the same result back.
</p>
<p>
See {file:HAML_REFERENCE.md#haml_options the <a
href="../Haml.html">Haml</a> options documentation}.
</p>
<p>
@return [{Symbol => Object}] The options hash
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000053_source')" id="l_M000053_source">show</a>
                        
                    </p>
                    <div id="M000053_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/haml/engine.rb, line 291</span>
291:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">options_for_buffer</span>
292:       {
293:         <span class="ruby-identifier">:autoclose</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:autoclose</span>],
294:         <span class="ruby-identifier">:preserve</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:preserve</span>],
295:         <span class="ruby-identifier">:attr_wrapper</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:attr_wrapper</span>],
296:         <span class="ruby-identifier">:ugly</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:ugly</span>],
297:         <span class="ruby-identifier">:format</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:format</span>],
298:         <span class="ruby-identifier">:encoding</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:encoding</span>],
299:         <span class="ruby-identifier">:escape_html</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:escape_html</span>],
300:         <span class="ruby-identifier">:escape_attrs</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:escape_attrs</span>],
301:       }
302:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Private methods</div>
            
            <div class="method">
                <div class="title" id="M000054">
                    
                    <a name="M000054"></a><b>set_locals</b>(locals, scope, scope_object)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000054_source')" id="l_M000054_source">show</a>
                        
                    </p>
                    <div id="M000054_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/haml/engine.rb, line 306</span>
306:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set_locals</span>(<span class="ruby-identifier">locals</span>, <span class="ruby-identifier">scope</span>, <span class="ruby-identifier">scope_object</span>)
307:       <span class="ruby-identifier">scope_object</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">:instance_variable_set</span>, <span class="ruby-value str">'@_haml_locals'</span>, <span class="ruby-identifier">locals</span>)
308:       <span class="ruby-identifier">set_locals</span> = <span class="ruby-identifier">locals</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span><span class="ruby-operator">|</span> <span class="ruby-node">&quot;#{k} = @_haml_locals[#{k.inspect}]&quot;</span> }.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;\n&quot;</span>)
309:       <span class="ruby-identifier">eval</span>(<span class="ruby-identifier">set_locals</span>, <span class="ruby-identifier">scope</span>)
310:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    