<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>ID3v2</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen" />
    <script src="../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Class</span> 
            ID3v2 
            
                <span class="parent">&lt; 
                    
                    DelegateClass(Hash)
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../files/lib/mp3info/id3v2_rb.html">lib/mp3info/id3v2.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    
    <div class="description">
        <p>
This class can be used to decode id3v2 tags from files, like .mp3 or .ape
for example. It works like a hash, where key represents the tag name as 3
or 4 upper case letters (respectively related to 2.2 and 2.3+ tag) and
value represented as array or raw value. Written version is always 2.3.
</p>

    </div>
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>A</dt>
        <dd>
            <ul>
                
                <li><a href="#M000017">add_value_to_tag2</a></li>
                
            </ul>
        </dd>
    
        <dt>C</dt>
        <dd>
            <ul>
                
                <li><a href="#M000003">changed?</a></li>
                
            </ul>
        </dd>
    
        <dt>D</dt>
        <dd>
            <ul>
                
                <li><a href="#M000010">decode_tag</a></li>
                
            </ul>
        </dd>
    
        <dt>E</dt>
        <dd>
            <ul>
                
                <li><a href="#M000007">encode_tag</a></li>
                
            </ul>
        </dd>
    
        <dt>F</dt>
        <dd>
            <ul>
                
                <li><a href="#M000005">from_io</a></li>
                
            </ul>
        </dd>
    
        <dt>N</dt>
        <dd>
            <ul>
                
                <li><a href="#M000001">new</a></li>
                
            </ul>
        </dd>
    
        <dt>P</dt>
        <dd>
            <ul>
                
                <li><a href="#M000002">parsed?</a></li>
                
            </ul>
        </dd>
    
        <dt>R</dt>
        <dd>
            <ul>
                
                <li><a href="#M000016">read_id3v2_2_frames</a>,</li>
                
                <li><a href="#M000014">read_id3v2_3_frames</a></li>
                
            </ul>
        </dd>
    
        <dt>S</dt>
        <dd>
            <ul>
                
                <li><a href="#M000018">seek_to_v2_end</a></li>
                
            </ul>
        </dd>
    
        <dt>T</dt>
        <dd>
            <ul>
                
                <li><a href="#M000006">to_bin</a>,</li>
                
                <li><a href="#M000021">to_syncsafe</a></li>
                
            </ul>
        </dd>
    
        <dt>V</dt>
        <dd>
            <ul>
                
                <li><a href="#M000004">version</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    
    <div class="sectiontitle">Included Modules</div>
    <ul>
        
        <li>
            
            <a href="Mp3Info/Mp3FileMethods.html">Mp3Info::Mp3FileMethods</a>
            
            START:includes
        </li>
        
    </ul>
    

    

    

    
    <div class="sectiontitle">Constants</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class="attr-name">WRITE_VERSION</td>
            <td>=</td>
            <td class="attr-value">3</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
Major version used when writing tags
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">TAGS</td>
            <td>=</td>
            <td class="attr-value">{     &quot;AENC&quot; =&gt; &quot;Audio encryption&quot;,     &quot;APIC&quot; =&gt; &quot;Attached picture&quot;,     &quot;COMM&quot; =&gt; &quot;Comments&quot;,     &quot;COMR&quot; =&gt; &quot;Commercial frame&quot;,     &quot;ENCR&quot; =&gt; &quot;Encryption method registration&quot;,     &quot;EQUA&quot; =&gt; &quot;Equalization&quot;,     &quot;ETCO&quot; =&gt; &quot;Event timing codes&quot;,     &quot;GEOB&quot; =&gt; &quot;General encapsulated object&quot;,     &quot;GRID&quot; =&gt; &quot;Group identification registration&quot;,     &quot;IPLS&quot; =&gt; &quot;Involved people list&quot;,     &quot;LINK&quot; =&gt; &quot;Linked information&quot;,     &quot;MCDI&quot; =&gt; &quot;Music CD identifier&quot;,     &quot;MLLT&quot; =&gt; &quot;MPEG location lookup table&quot;,     &quot;OWNE&quot; =&gt; &quot;Ownership frame&quot;,     &quot;PRIV&quot; =&gt; &quot;Private frame&quot;,     &quot;PCNT&quot; =&gt; &quot;Play counter&quot;,     &quot;POPM&quot; =&gt; &quot;Popularimeter&quot;,     &quot;POSS&quot; =&gt; &quot;Position synchronisation frame&quot;,     &quot;RBUF&quot; =&gt; &quot;Recommended buffer size&quot;,     &quot;RVAD&quot; =&gt; &quot;Relative volume adjustment&quot;,     &quot;RVRB&quot; =&gt; &quot;Reverb&quot;,     &quot;SYLT&quot; =&gt; &quot;Synchronized lyric/text&quot;,     &quot;SYTC&quot; =&gt; &quot;Synchronized tempo codes&quot;,     &quot;TALB&quot; =&gt; &quot;Album/Movie/Show title&quot;,     &quot;TBPM&quot; =&gt; &quot;BPM (beats per minute)&quot;,     &quot;TCOM&quot; =&gt; &quot;Composer&quot;,     &quot;TCON&quot; =&gt; &quot;Content type&quot;,     &quot;TCOP&quot; =&gt; &quot;Copyright message&quot;,     &quot;TDAT&quot; =&gt; &quot;Date&quot;,     &quot;TDLY&quot; =&gt; &quot;Playlist delay&quot;,     &quot;TENC&quot; =&gt; &quot;Encoded by&quot;,     &quot;TEXT&quot; =&gt; &quot;Lyricist/Text writer&quot;,     &quot;TFLT&quot; =&gt; &quot;File type&quot;,     &quot;TIME&quot; =&gt; &quot;Time&quot;,     &quot;TIT1&quot; =&gt; &quot;Content group description&quot;,     &quot;TIT2&quot; =&gt; &quot;Title/songname/content description&quot;,     &quot;TIT3&quot; =&gt; &quot;Subtitle/Description refinement&quot;,     &quot;TKEY&quot; =&gt; &quot;Initial key&quot;,     &quot;TLAN&quot; =&gt; &quot;Language(s)&quot;,     &quot;TLEN&quot; =&gt; &quot;Length&quot;,     &quot;TMED&quot; =&gt; &quot;Media type&quot;,     &quot;TOAL&quot; =&gt; &quot;Original album/movie/show title&quot;,     &quot;TOFN&quot; =&gt; &quot;Original filename&quot;,     &quot;TOLY&quot; =&gt; &quot;Original lyricist(s)/text writer(s)&quot;,     &quot;TOPE&quot; =&gt; &quot;Original artist(s)/performer(s)&quot;,     &quot;TORY&quot; =&gt; &quot;Original release year&quot;,     &quot;TOWN&quot; =&gt; &quot;File owner/licensee&quot;,     &quot;TPE1&quot; =&gt; &quot;Lead performer(s)/Soloist(s)&quot;,     &quot;TPE2&quot; =&gt; &quot;Band/orchestra/accompaniment&quot;,     &quot;TPE3&quot; =&gt; &quot;Conductor/performer refinement&quot;,     &quot;TPE4&quot; =&gt; &quot;Interpreted, remixed, or otherwise modified by&quot;,     &quot;TPOS&quot; =&gt; &quot;Part of a set&quot;,     &quot;TPUB&quot; =&gt; &quot;Publisher&quot;,     &quot;TRCK&quot; =&gt; &quot;Track number/Position in set&quot;,     &quot;TRDA&quot; =&gt; &quot;Recording dates&quot;,     &quot;TRSN&quot; =&gt; &quot;Internet radio station name&quot;,     &quot;TRSO&quot; =&gt; &quot;Internet radio station owner&quot;,     &quot;TSIZ&quot; =&gt; &quot;Size&quot;,     &quot;TSRC&quot; =&gt; &quot;ISRC (international standard recording code)&quot;,     &quot;TSSE&quot; =&gt; &quot;Software/Hardware and settings used for encoding&quot;,     &quot;TYER&quot; =&gt; &quot;Year&quot;,     &quot;TXXX&quot; =&gt; &quot;User defined text information frame&quot;,     &quot;UFID&quot; =&gt; &quot;Unique file identifier&quot;,     &quot;USER&quot; =&gt; &quot;Terms of use&quot;,     &quot;USLT&quot; =&gt; &quot;Unsychronized lyric/text transcription&quot;,     &quot;WCOM&quot; =&gt; &quot;Commercial information&quot;,     &quot;WCOP&quot; =&gt; &quot;Copyright/Legal information&quot;,     &quot;WOAF&quot; =&gt; &quot;Official audio file webpage&quot;,     &quot;WOAR&quot; =&gt; &quot;Official artist/performer webpage&quot;,     &quot;WOAS&quot; =&gt; &quot;Official audio source webpage&quot;,     &quot;WORS&quot; =&gt; &quot;Official internet radio station homepage&quot;,     &quot;WPAY&quot; =&gt; &quot;Payment&quot;,     &quot;WPUB&quot; =&gt; &quot;Publishers official webpage&quot;,     &quot;WXXX&quot; =&gt; &quot;User defined URL link frame&quot;   }</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">TAG_MAPPING_2_2_to_2_3</td>
            <td>=</td>
            <td class="attr-value">{     &quot;BUF&quot;   =&gt; &quot;RBUF&quot;,     &quot;COM&quot;   =&gt; &quot;COMM&quot;,     &quot;CRA&quot;   =&gt; &quot;AENC&quot;,     &quot;EQU&quot;   =&gt; &quot;EQUA&quot;,     &quot;ETC&quot;   =&gt; &quot;ETCO&quot;,     &quot;GEO&quot;   =&gt; &quot;GEOB&quot;,     &quot;MCI&quot;   =&gt; &quot;MCDI&quot;,     &quot;MLL&quot;   =&gt; &quot;MLLT&quot;,     &quot;PIC&quot;   =&gt; &quot;APIC&quot;,     &quot;POP&quot;   =&gt; &quot;POPM&quot;,     &quot;REV&quot;   =&gt; &quot;RVRB&quot;,     &quot;RVA&quot;   =&gt; &quot;RVAD&quot;,     &quot;SLT&quot;   =&gt; &quot;SYLT&quot;,     &quot;STC&quot;   =&gt; &quot;SYTC&quot;,     &quot;TAL&quot;   =&gt; &quot;TALB&quot;,     &quot;TBP&quot;   =&gt; &quot;TBPM&quot;,     &quot;TCM&quot;   =&gt; &quot;TCOM&quot;,     &quot;TCO&quot;   =&gt; &quot;TCON&quot;,     &quot;TCR&quot;   =&gt; &quot;TCOP&quot;,     &quot;TDA&quot;   =&gt; &quot;TDAT&quot;,     &quot;TDY&quot;   =&gt; &quot;TDLY&quot;,     &quot;TEN&quot;   =&gt; &quot;TENC&quot;,     &quot;TFT&quot;   =&gt; &quot;TFLT&quot;,     &quot;TIM&quot;   =&gt; &quot;TIME&quot;,     &quot;TKE&quot;   =&gt; &quot;TKEY&quot;,     &quot;TLA&quot;   =&gt; &quot;TLAN&quot;,     &quot;TLE&quot;   =&gt; &quot;TLEN&quot;,     &quot;TMT&quot;   =&gt; &quot;TMED&quot;,     &quot;TOA&quot;   =&gt; &quot;TOPE&quot;,     &quot;TOF&quot;   =&gt; &quot;TOFN&quot;,     &quot;TOL&quot;   =&gt; &quot;TOLY&quot;,     &quot;TOR&quot;   =&gt; &quot;TORY&quot;,     &quot;TOT&quot;   =&gt; &quot;TOAL&quot;,     &quot;TP1&quot;   =&gt; &quot;TPE1&quot;,     &quot;TP2&quot;   =&gt; &quot;TPE2&quot;,     &quot;TP3&quot;   =&gt; &quot;TPE3&quot;,     &quot;TP4&quot;   =&gt; &quot;TPE4&quot;,     &quot;TPA&quot;   =&gt; &quot;TPOS&quot;,     &quot;TPB&quot;   =&gt; &quot;TPUB&quot;,     &quot;TRC&quot;   =&gt; &quot;TSRC&quot;,     &quot;TRD&quot;   =&gt; &quot;TRDA&quot;,     &quot;TRK&quot;   =&gt; &quot;TRCK&quot;,     &quot;TSI&quot;   =&gt; &quot;TSIZ&quot;,     &quot;TSS&quot;   =&gt; &quot;TSSE&quot;,     &quot;TT1&quot;   =&gt; &quot;TIT1&quot;,     &quot;TT2&quot;   =&gt; &quot;TIT2&quot;,     &quot;TT3&quot;   =&gt; &quot;TIT3&quot;,     &quot;TXT&quot;   =&gt; &quot;TEXT&quot;,     &quot;TXX&quot;   =&gt; &quot;TXXX&quot;,     &quot;TYE&quot;   =&gt; &quot;TYER&quot;,     &quot;UFI&quot;   =&gt; &quot;UFID&quot;,     &quot;ULT&quot;   =&gt; &quot;USLT&quot;,     &quot;WAF&quot;   =&gt; &quot;WOAF&quot;,     &quot;WAR&quot;   =&gt; &quot;WOAR&quot;,     &quot;WAS&quot;   =&gt; &quot;WOAS&quot;,     &quot;WCM&quot;   =&gt; &quot;WCOM&quot;,     &quot;WCP&quot;   =&gt; &quot;WCOP&quot;,     &quot;WPB&quot;   =&gt; &quot;WPB&quot;,     &quot;WXX&quot;   =&gt; &quot;WXXX&quot;,   }</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
Translate V2 to V3 tags
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">TEXT_ENCODINGS</td>
            <td>=</td>
            <td class="attr-value">[&quot;iso-8859-1&quot;, &quot;utf-16&quot;, &quot;utf-16be&quot;, &quot;utf-8&quot;]</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
See id3v2.4.0-structure document, at section 4.
</p>
</td>
        </tr>
        
        
    </table>
    

    
    <div class="sectiontitle">Attributes</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>io_position</td>
            <td class='attr-desc'><p>
this is the position in the file where the tag really ends
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>options</td>
            <td class='attr-desc'><p>
:<tt>lang</tt>: for writing comments
</p>
<p>
:<tt>encoding</tt>: one of the string of <tt><a
href="ID3v2.html#TEXT_ENCODINGS">TEXT_ENCODINGS</a></tt>, used as a source
and destination encoding respectively for read and write tag2 values.
</p></td>
        </tr>
        
    </table>
    

    
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M000003">
                    
                    <a name="M000003"></a><b>changed?</b>()
                    
                </div>
                
                <div class="description">
                  <p>
does this tag has been changed ?
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000003_source')" id="l_M000003_source">show</a>
                        
                    </p>
                    <div id="M000003_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/mp3info/id3v2.rb, line 207</span>
207:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">changed?</span>
208:     <span class="ruby-ivar">@hash_orig</span> <span class="ruby-operator">!=</span> <span class="ruby-ivar">@hash</span>
209:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000005">
                    
                    <a name="M000005"></a><b>from_io</b>(io)
                    
                </div>
                
                <div class="description">
                  <p>
gets id3v2 tag information from io object (must support seek() method)
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000005_source')" id="l_M000005_source">show</a>
                        
                    </p>
                    <div id="M000005_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/mp3info/id3v2.rb, line 222</span>
222:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">from_io</span>(<span class="ruby-identifier">io</span>)
223:     <span class="ruby-ivar">@io</span> = <span class="ruby-identifier">io</span>
224:     <span class="ruby-identifier">original_pos</span> = <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">pos</span>
225:     <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">extend</span>(<span class="ruby-constant">Mp3Info</span><span class="ruby-operator">::</span><span class="ruby-constant">Mp3FileMethods</span>)
226:     <span class="ruby-identifier">version_maj</span>, <span class="ruby-identifier">version_min</span>, <span class="ruby-identifier">flags</span> = <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">read</span>(<span class="ruby-value">3</span>).<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">&quot;CCB4&quot;</span>)
227:     <span class="ruby-ivar">@unsync</span>, <span class="ruby-identifier">ext_header</span>, <span class="ruby-identifier">experimental</span>, <span class="ruby-identifier">footer</span> = (<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">3</span>).<span class="ruby-identifier">collect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span> <span class="ruby-identifier">flags</span>[<span class="ruby-identifier">i</span>].<span class="ruby-identifier">chr</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'1'</span> }
228:     <span class="ruby-identifier">raise</span>(<span class="ruby-constant">ID3v2Error</span>, <span class="ruby-node">&quot;can't find version_maj ('#{version_maj}')&quot;</span>) <span class="ruby-keyword kw">unless</span> [<span class="ruby-value">2</span>, <span class="ruby-value">3</span>, <span class="ruby-value">4</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">version_maj</span>)
229:     <span class="ruby-ivar">@version_maj</span>, <span class="ruby-ivar">@version_min</span> = <span class="ruby-identifier">version_maj</span>, <span class="ruby-identifier">version_min</span>
230:     <span class="ruby-ivar">@tag_length</span> = <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">get_syncsafe</span>
231: 
232:     <span class="ruby-ivar">@parsed</span> = <span class="ruby-keyword kw">true</span>
233:     <span class="ruby-keyword kw">begin</span>
234:       <span class="ruby-keyword kw">case</span> <span class="ruby-ivar">@version_maj</span>
235:         <span class="ruby-keyword kw">when</span> <span class="ruby-value">2</span>
236:           <span class="ruby-identifier">read_id3v2_2_frames</span>
237:         <span class="ruby-keyword kw">when</span> <span class="ruby-value">3</span>, <span class="ruby-value">4</span>
238:           <span class="ruby-comment cmt"># seek past extended header if present</span>
239:           <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">seek</span>(<span class="ruby-ivar">@io</span>.<span class="ruby-identifier">get_syncsafe</span> <span class="ruby-operator">-</span> <span class="ruby-value">4</span>, <span class="ruby-constant">IO</span><span class="ruby-operator">::</span><span class="ruby-constant">SEEK_CUR</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ext_header</span>
240:           <span class="ruby-identifier">read_id3v2_3_frames</span>
241:       <span class="ruby-keyword kw">end</span>
242:     <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">ID3v2Error</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
243:       <span class="ruby-identifier">warn</span>(<span class="ruby-node">&quot;warning: id3v2 tag not fully parsed: #{e.message}&quot;</span>)
244:     <span class="ruby-keyword kw">end</span>
245:     <span class="ruby-ivar">@io_position</span> = <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">pos</span>
246:     <span class="ruby-ivar">@tag_length</span> = <span class="ruby-ivar">@io_position</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">original_pos</span>
247: 
248:     <span class="ruby-ivar">@hash_orig</span> = <span class="ruby-ivar">@hash</span>.<span class="ruby-identifier">dup</span>
249:     <span class="ruby-comment cmt">#no more reading</span>
250:     <span class="ruby-ivar">@io</span> = <span class="ruby-keyword kw">nil</span>
251:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000002">
                    
                    <a name="M000002"></a><b>parsed?</b>()
                    
                </div>
                
                <div class="description">
                  <p>
does this tag has been correctly read ?
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000002_source')" id="l_M000002_source">show</a>
                        
                    </p>
                    <div id="M000002_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/mp3info/id3v2.rb, line 202</span>
202:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">parsed?</span>
203:     <span class="ruby-ivar">@parsed</span>
204:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000006">
                    
                    <a name="M000006"></a><b>to_bin</b>()
                    
                </div>
                
                <div class="description">
                  <p>
dump tag for writing. Version is always 2.#{<a
href="ID3v2.html#WRITE_VERSION">WRITE_VERSION</a>}.0.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000006_source')" id="l_M000006_source">show</a>
                        
                    </p>
                    <div id="M000006_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/mp3info/id3v2.rb, line 254</span>
254:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">to_bin</span>
255:     <span class="ruby-comment cmt">#TODO handle of @tag2[TLEN&quot;]</span>
256:     <span class="ruby-comment cmt">#TODO add of crc</span>
257:     <span class="ruby-comment cmt">#TODO add restrictions tag</span>
258: 
259:     <span class="ruby-identifier">tag</span> = <span class="ruby-value str">&quot;&quot;</span>
260:     <span class="ruby-ivar">@hash</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
261:       <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">v</span>
262:       <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value str">&quot;empty?&quot;</span>) <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">empty?</span>
263: 
264:       <span class="ruby-comment cmt"># Automagically translate V2 to V3 tags</span>
265:       <span class="ruby-identifier">k</span> = <span class="ruby-constant">TAG_MAPPING_2_2_to_2_3</span>[<span class="ruby-identifier">k</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TAG_MAPPING_2_2_to_2_3</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">k</span>)
266: 
267:       <span class="ruby-comment cmt"># doesn't encode id3v2.2 tags, which have 3 characters</span>
268:       <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">k</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">!=</span> <span class="ruby-value">4</span>
269: 
270:       <span class="ruby-comment cmt"># Output one flag for each array element, or one only if it's not an array</span>
271:       [<span class="ruby-identifier">v</span>].<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
272:         <span class="ruby-identifier">data</span> = <span class="ruby-identifier">encode_tag</span>(<span class="ruby-identifier">k</span>, <span class="ruby-identifier">value</span>.<span class="ruby-identifier">to_s</span>, <span class="ruby-constant">WRITE_VERSION</span>)
273:         <span class="ruby-comment cmt">#data &lt;&lt; &quot;\x00&quot;*2 #End of tag</span>
274: 
275:         <span class="ruby-identifier">tag</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">k</span>[<span class="ruby-value">0</span>,<span class="ruby-value">4</span>]   <span class="ruby-comment cmt">#4 characte max for a tag's key</span>
276:         <span class="ruby-comment cmt">#tag &lt;&lt; to_syncsafe(data.size) #+1 because of the language encoding byte</span>
277:         <span class="ruby-identifier">size</span> = <span class="ruby-identifier">data</span>.<span class="ruby-identifier">size</span>
278:         <span class="ruby-keyword kw">if</span> <span class="ruby-constant">RUBY_VERSION</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value str">&quot;1.9.0&quot;</span>
279:           <span class="ruby-identifier">size</span> = <span class="ruby-identifier">data</span>.<span class="ruby-identifier">dup</span>.<span class="ruby-identifier">force_encoding</span>(<span class="ruby-value str">&quot;binary&quot;</span>).<span class="ruby-identifier">size</span>
280:         <span class="ruby-keyword kw">end</span>
281:         <span class="ruby-identifier">tag</span> <span class="ruby-operator">&lt;&lt;</span> [<span class="ruby-identifier">size</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">&quot;N&quot;</span>) <span class="ruby-comment cmt">#+1 because of the language encoding byte</span>
282:         <span class="ruby-identifier">tag</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;\x00&quot;</span><span class="ruby-operator">*</span><span class="ruby-value">2</span> <span class="ruby-comment cmt">#flags</span>
283:         <span class="ruby-identifier">tag</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">data</span>
284:       <span class="ruby-keyword kw">end</span>
285:     <span class="ruby-keyword kw">end</span>
286: 
287:     <span class="ruby-identifier">tag_str</span> = <span class="ruby-value str">&quot;ID3&quot;</span>
288:     <span class="ruby-comment cmt">#version_maj, version_min, unsync, ext_header, experimental, footer</span>
289:     <span class="ruby-identifier">tag_str</span> <span class="ruby-operator">&lt;&lt;</span> [ <span class="ruby-constant">WRITE_VERSION</span>, <span class="ruby-value">0</span>, <span class="ruby-value str">&quot;0000&quot;</span> ].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">&quot;CCB4&quot;</span>)
290:     <span class="ruby-identifier">tag_str</span> <span class="ruby-operator">&lt;&lt;</span> [<span class="ruby-identifier">to_syncsafe</span>(<span class="ruby-identifier">tag</span>.<span class="ruby-identifier">size</span>)].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">&quot;N&quot;</span>)
291:     <span class="ruby-identifier">tag_str</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">tag</span>
292:     <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;tag in binary format: #{tag_str.inspect}&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">$DEBUG</span>
293:     <span class="ruby-identifier">tag_str</span>
294:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000004">
                    
                    <a name="M000004"></a><b>version</b>()
                    
                </div>
                
                <div class="description">
                  <p>
full version of this tag (like &#8220;2.3.0&#8220;) or nil if tag was not
correctly read
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000004_source')" id="l_M000004_source">show</a>
                        
                    </p>
                    <div id="M000004_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/mp3info/id3v2.rb, line 213</span>
213:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">version</span>
214:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@version_maj</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@version_min</span>
215:       <span class="ruby-node">&quot;2.#{@version_maj}.#{@version_min}&quot;</span>
216:     <span class="ruby-keyword kw">else</span>
217:       <span class="ruby-keyword kw">nil</span>
218:     <span class="ruby-keyword kw">end</span>
219:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Private methods</div>
            
            <div class="method">
                <div class="title" id="M000017">
                    
                    <a name="M000017"></a><b>add_value_to_tag2</b>(name, size)
                    
                </div>
                
                <div class="description">
                  <p>
Add data to tag2[&#8220;name&#8221;] read lang_encoding, decode data if
unicode and create an array if the key already exists in the tag
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000017_source')" id="l_M000017_source">show</a>
                        
                    </p>
                    <div id="M000017_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/mp3info/id3v2.rb, line 398</span>
398:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_value_to_tag2</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">size</span>)
399:     <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;add_value_to_tag2&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">$DEBUG</span>
400: 
401:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">50_000_000</span>
402:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">ID3v2Error</span>, <span class="ruby-value str">&quot;tag size is &gt; 50_000_000&quot;</span>
403:     <span class="ruby-keyword kw">end</span>
404: 
405:     <span class="ruby-identifier">data_io</span> = <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">read</span>(<span class="ruby-identifier">size</span>)
406:     <span class="ruby-identifier">data</span> = <span class="ruby-identifier">decode_tag</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">data_io</span>)
407: 
408:     <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-value str">&quot;TPOS&quot;</span>] <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/(\d+)\s*\/\s*(\d+)/</span>
409:       <span class="ruby-keyword kw">self</span>[<span class="ruby-value str">&quot;disc_number&quot;</span>] = <span class="ruby-identifier">$1</span>.<span class="ruby-identifier">to_i</span>
410:       <span class="ruby-keyword kw">self</span>[<span class="ruby-value str">&quot;disc_total&quot;</span>] = <span class="ruby-identifier">$2</span>.<span class="ruby-identifier">to_i</span>
411:     <span class="ruby-keyword kw">end</span>
412: 
413:     <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">name</span>)
414:       <span class="ruby-keyword kw">unless</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">name</span>].<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>)
415:         <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">name</span>] = [ <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">name</span>] ]
416:       <span class="ruby-keyword kw">end</span>
417:       <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">name</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">data</span>
418:     <span class="ruby-keyword kw">else</span>
419:       <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">name</span>] = <span class="ruby-identifier">data</span>
420:     <span class="ruby-keyword kw">end</span>
421:     <span class="ruby-identifier">p</span> <span class="ruby-identifier">data</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">$DEBUG</span>
422:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000010">
                    
                    <a name="M000010"></a><b>decode_tag</b>(name, raw_value)
                    
                </div>
                
                <div class="description">
                  <p>
Read a tag from file and perform UNICODE translation if needed
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000010_source')" id="l_M000010_source">show</a>
                        
                    </p>
                    <div id="M000010_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/mp3info/id3v2.rb, line 329</span>
329:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">decode_tag</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">raw_value</span>)
330:     <span class="ruby-identifier">puts</span>(<span class="ruby-node">&quot;decode_tag(#{name.inspect}, #{raw_value.inspect})&quot;</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">$DEBUG</span>
331:     <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">name</span>
332:       <span class="ruby-keyword kw">when</span> <span class="ruby-regexp re">/^COM/</span>
333:         <span class="ruby-comment cmt">#FIXME improve this</span>
334:         <span class="ruby-identifier">encoding</span>, <span class="ruby-identifier">lang</span>, <span class="ruby-identifier">str</span> = <span class="ruby-identifier">raw_value</span>.<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">&quot;ca3a*&quot;</span>)
335:         <span class="ruby-identifier">out</span> = <span class="ruby-identifier">raw_value</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value">0</span>.<span class="ruby-identifier">chr</span>).<span class="ruby-identifier">last</span>
336:       <span class="ruby-keyword kw">when</span> <span class="ruby-regexp re">/^T/</span>
337:         <span class="ruby-identifier">encoding</span> = <span class="ruby-identifier">raw_value</span>.<span class="ruby-identifier">getbyte</span>(<span class="ruby-value">0</span>) <span class="ruby-comment cmt"># language encoding (see TEXT_ENCODINGS constant)</span>
338:         <span class="ruby-identifier">out</span> = <span class="ruby-identifier">raw_value</span>[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>]
339:         <span class="ruby-comment cmt"># we need to convert the string in order to match</span>
340:         <span class="ruby-comment cmt"># the requested encoding</span>
341:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">encoding</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-constant">TEXT_ENCODINGS</span>[<span class="ruby-identifier">encoding</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">out</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">encoding</span> <span class="ruby-operator">!=</span> <span class="ruby-ivar">@text_encoding_index</span>
342:           <span class="ruby-keyword kw">begin</span>
343:             <span class="ruby-identifier">out</span> = <span class="ruby-constant">Iconv</span>.<span class="ruby-identifier">iconv</span>(<span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:encoding</span>], <span class="ruby-constant">TEXT_ENCODINGS</span>[<span class="ruby-identifier">encoding</span>], <span class="ruby-identifier">out</span>).<span class="ruby-identifier">first</span>
344:           <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Iconv</span><span class="ruby-operator">::</span><span class="ruby-constant">Failure</span>
345:           <span class="ruby-keyword kw">end</span>
346:         <span class="ruby-keyword kw">end</span>
347:         <span class="ruby-comment cmt"># remove padding zeros for textual tags</span>
348:         <span class="ruby-identifier">out</span>.<span class="ruby-identifier">sub!</span>(<span class="ruby-regexp re">/\0*$/</span>, <span class="ruby-value str">''</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">out</span>.<span class="ruby-identifier">nil?</span>
349:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">out</span>
350:       <span class="ruby-keyword kw">else</span>
351:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">raw_value</span>
352:     <span class="ruby-keyword kw">end</span>
353:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000007">
                    
                    <a name="M000007"></a><b>encode_tag</b>(name, value, version)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000007_source')" id="l_M000007_source">show</a>
                        
                    </p>
                    <div id="M000007_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/mp3info/id3v2.rb, line 298</span>
298:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">encode_tag</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">value</span>, <span class="ruby-identifier">version</span>)
299:     <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;encode_tag(#{name.inspect}, #{value.inspect}, #{version})&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">$DEBUG</span>
300: 
301:     <span class="ruby-identifier">text_encoding_index</span> = <span class="ruby-ivar">@text_encoding_index</span>
302:     <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">name</span>.<span class="ruby-identifier">index</span>(<span class="ruby-value str">&quot;T&quot;</span>) <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;COMM&quot;</span> ) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">version</span> <span class="ruby-operator">==</span> <span class="ruby-value">3</span>
303:       <span class="ruby-comment cmt"># in id3v2.3 tags, there is only 2 encodings possible</span>
304:       <span class="ruby-identifier">transcoded_value</span> = <span class="ruby-identifier">value</span>
305:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">text_encoding_index</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">2</span>
306:         <span class="ruby-keyword kw">begin</span>
307:           <span class="ruby-identifier">transcoded_value</span> = <span class="ruby-constant">Iconv</span>.<span class="ruby-identifier">iconv</span>(<span class="ruby-constant">TEXT_ENCODINGS</span>[<span class="ruby-value">1</span>],
308:                                           <span class="ruby-constant">TEXT_ENCODINGS</span>[<span class="ruby-identifier">text_encoding_index</span>],
309:                                           <span class="ruby-identifier">value</span>).<span class="ruby-identifier">first</span>
310:         <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Iconv</span><span class="ruby-operator">::</span><span class="ruby-constant">Failure</span>
311:           <span class="ruby-identifier">transcoded_value</span> = <span class="ruby-identifier">value</span>
312:         <span class="ruby-keyword kw">end</span>
313:         <span class="ruby-identifier">text_encoding_index</span> = <span class="ruby-value">1</span>
314:       <span class="ruby-keyword kw">end</span>
315:     <span class="ruby-keyword kw">end</span>
316: 
317:     <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">name</span>
318:       <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;COMM&quot;</span>
319:       <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;encode COMM: enc: #{text_encoding_index}, lang: #{@options[:lang]}, str: #{transcoded_value.dump}&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">$DEBUG</span>
320:         [ <span class="ruby-identifier">text_encoding_index</span> , <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:lang</span>], <span class="ruby-value">0</span>, <span class="ruby-identifier">transcoded_value</span> ].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">&quot;ca3ca*&quot;</span>)
321:       <span class="ruby-keyword kw">when</span> <span class="ruby-regexp re">/^T/</span>
322:         <span class="ruby-identifier">text_encoding_index</span>.<span class="ruby-identifier">chr</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">transcoded_value</span>
323:       <span class="ruby-keyword kw">else</span>
324:         <span class="ruby-identifier">value</span>
325:     <span class="ruby-keyword kw">end</span>
326:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000016">
                    
                    <a name="M000016"></a><b>read_id3v2_2_frames</b>()
                    
                </div>
                
                <div class="description">
                  <p>
reads id3 ver 2.2.x frames and adds the contents to @tag2 hash NOTE: the
id3v2 header does not take padding zero&#8217;s into consideration
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000016_source')" id="l_M000016_source">show</a>
                        
                    </p>
                    <div id="M000016_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/mp3info/id3v2.rb, line 380</span>
380:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">read_id3v2_2_frames</span>
381:     <span class="ruby-identifier">loop</span> <span class="ruby-keyword kw">do</span>
382:       <span class="ruby-identifier">name</span> = <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">read</span>(<span class="ruby-value">3</span>)
383:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">name</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">name</span>.<span class="ruby-identifier">getbyte</span>(<span class="ruby-value">0</span>) <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
384:         <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">seek</span>(<span class="ruby-value">-3</span>, <span class="ruby-constant">IO</span><span class="ruby-operator">::</span><span class="ruby-constant">SEEK_CUR</span>)
385:         <span class="ruby-identifier">seek_to_v2_end</span>
386:         <span class="ruby-keyword kw">break</span>
387:       <span class="ruby-keyword kw">else</span>
388:         <span class="ruby-identifier">size</span> = (<span class="ruby-ivar">@io</span>.<span class="ruby-identifier">getbyte</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value">16</span>) <span class="ruby-operator">+</span> (<span class="ruby-ivar">@io</span>.<span class="ruby-identifier">getbyte</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value">8</span>) <span class="ruby-operator">+</span> <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">getbyte</span>
389:         <span class="ruby-identifier">add_value_to_tag2</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">size</span>)
390:         <span class="ruby-keyword kw">break</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">pos</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-ivar">@tag_length</span>
391:       <span class="ruby-keyword kw">end</span>
392:     <span class="ruby-keyword kw">end</span>
393:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000014">
                    
                    <a name="M000014"></a><b>read_id3v2_3_frames</b>()
                    
                </div>
                
                <div class="description">
                  <p>
reads id3 ver 2.3.x/2.4.x frames and adds the contents to @tag2 hash NOTE:
the id3v2 header does not take padding zero&#8217;s into consideration
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000014_source')" id="l_M000014_source">show</a>
                        
                    </p>
                    <div id="M000014_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/mp3info/id3v2.rb, line 357</span>
357:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">read_id3v2_3_frames</span>
358:     <span class="ruby-identifier">loop</span> <span class="ruby-keyword kw">do</span> <span class="ruby-comment cmt"># there are 2 ways to end the loop</span>
359:       <span class="ruby-identifier">name</span> = <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">read</span>(<span class="ruby-value">4</span>)
360:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">name</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">name</span>.<span class="ruby-identifier">getbyte</span>(<span class="ruby-value">0</span>) <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;MP3e&quot;</span> <span class="ruby-comment cmt">#bug caused by old tagging application &quot;mp3ext&quot; ( http://www.mutschler.de/mp3ext/ )</span>
361:         <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">seek</span>(<span class="ruby-value">-4</span>, <span class="ruby-constant">IO</span><span class="ruby-operator">::</span><span class="ruby-constant">SEEK_CUR</span>)    <span class="ruby-comment cmt"># 1. find a padding zero,</span>
362:         <span class="ruby-identifier">seek_to_v2_end</span>
363:         <span class="ruby-keyword kw">break</span>
364:       <span class="ruby-keyword kw">else</span>
365:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@version_maj</span> <span class="ruby-operator">==</span> <span class="ruby-value">4</span>
366:           <span class="ruby-identifier">size</span> = <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">get_syncsafe</span>
367:         <span class="ruby-keyword kw">else</span>
368:           <span class="ruby-identifier">size</span> = <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">get32bits</span>
369:         <span class="ruby-keyword kw">end</span>
370:         <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">seek</span>(<span class="ruby-value">2</span>, <span class="ruby-constant">IO</span><span class="ruby-operator">::</span><span class="ruby-constant">SEEK_CUR</span>)     <span class="ruby-comment cmt"># skip flags</span>
371:         <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;name '#{name}' size #{size}&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">$DEBUG</span>
372:         <span class="ruby-identifier">add_value_to_tag2</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">size</span>)
373:       <span class="ruby-keyword kw">end</span>
374:       <span class="ruby-keyword kw">break</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">pos</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-ivar">@tag_length</span> <span class="ruby-comment cmt"># 2. reach length from header</span>
375:     <span class="ruby-keyword kw">end</span>
376:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000018">
                    
                    <a name="M000018"></a><b>seek_to_v2_end</b>()
                    
                </div>
                
                <div class="description">
                  <p>
runs thru @file one char at a time looking for best guess of first MPEG
</p>
<pre>
 frame, which should be first 0xff byte after id3v2 padding zero's
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000018_source')" id="l_M000018_source">show</a>
                        
                    </p>
                    <div id="M000018_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/mp3info/id3v2.rb, line 426</span>
426:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">seek_to_v2_end</span>
427:     <span class="ruby-keyword kw">until</span> <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">getbyte</span> <span class="ruby-operator">==</span> <span class="ruby-value">0xff</span>
428:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">ID3v2Error</span>, <span class="ruby-value str">&quot;got EOF before finding id3v2 end&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">eof?</span>
429:     <span class="ruby-keyword kw">end</span>
430:     <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">seek</span>(<span class="ruby-value">-1</span>, <span class="ruby-constant">IO</span><span class="ruby-operator">::</span><span class="ruby-constant">SEEK_CUR</span>)
431:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000021">
                    
                    <a name="M000021"></a><b>to_syncsafe</b>(num)
                    
                </div>
                
                <div class="description">
                  <p>
convert an 32 integer to a syncsafe string
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000021_source')" id="l_M000021_source">show</a>
                        
                    </p>
                    <div id="M000021_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/mp3info/id3v2.rb, line 434</span>
434:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">to_syncsafe</span>(<span class="ruby-identifier">num</span>)
435:     ( (<span class="ruby-identifier">num</span><span class="ruby-operator">&lt;&lt;</span><span class="ruby-value">3</span>) <span class="ruby-operator">&amp;</span> <span class="ruby-value">0x7f000000</span> )  <span class="ruby-operator">+</span> ( (<span class="ruby-identifier">num</span><span class="ruby-operator">&lt;&lt;</span><span class="ruby-value">2</span>) <span class="ruby-operator">&amp;</span> <span class="ruby-value">0x7f0000</span> ) <span class="ruby-operator">+</span> ( (<span class="ruby-identifier">num</span><span class="ruby-operator">&lt;&lt;</span><span class="ruby-value">1</span>) <span class="ruby-operator">&amp;</span> <span class="ruby-value">0x7f00</span> ) <span class="ruby-operator">+</span> ( <span class="ruby-identifier">num</span> <span class="ruby-operator">&amp;</span> <span class="ruby-value">0x7f</span> )
436:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Class Public methods</div>
            
            <div class="method">
                <div class="title" id="M000001">
                    
                    <a name="M000001"></a><b>new</b>(options = {})
                    
                </div>
                
                <div class="description">
                  <p>
possible options are described above (&#8216;options&#8217; attribute) you
can access this object like an hash, with [] and []= methods special cases
are [&#8220;disc_number&#8220;] and [&#8220;disc_total&#8220;] mirroring
TPOS attribute
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000001_source')" id="l_M000001_source">show</a>
                        
                    </p>
                    <div id="M000001_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/mp3info/id3v2.rb, line 180</span>
180:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">options</span> = {})
181:     <span class="ruby-ivar">@options</span> = {
182:       <span class="ruby-identifier">:lang</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;ENG&quot;</span>,
183:       <span class="ruby-identifier">:encoding</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;iso-8859-1&quot;</span>
184:     }
185: 
186:     <span class="ruby-ivar">@options</span>.<span class="ruby-identifier">update</span>(<span class="ruby-identifier">options</span>)
187:     <span class="ruby-ivar">@text_encoding_index</span> = <span class="ruby-constant">TEXT_ENCODINGS</span>.<span class="ruby-identifier">index</span>(<span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:encoding</span>])
188: 
189:     <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@text_encoding_index</span>
190:       <span class="ruby-identifier">raise</span>(<span class="ruby-constant">ArgumentError</span>, <span class="ruby-value str">&quot;bad id3v2 text encoding specified&quot;</span>)
191:     <span class="ruby-keyword kw">end</span>
192: 
193:     <span class="ruby-ivar">@hash</span> = {}
194:     <span class="ruby-comment cmt">#TAGS.keys.each { |k| @hash[k] = nil }</span>
195:     <span class="ruby-ivar">@hash_orig</span> = {}
196:     <span class="ruby-keyword kw">super</span>(<span class="ruby-ivar">@hash</span>)
197:     <span class="ruby-ivar">@parsed</span> = <span class="ruby-keyword kw">false</span>
198:     <span class="ruby-ivar">@version_maj</span> = <span class="ruby-ivar">@version_min</span> = <span class="ruby-keyword kw">nil</span>
199:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    