<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>PhusionPassenger::Standalone::RuntimeInstaller</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../../css/main.css" type="text/css" media="screen" />
    <script src="../../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Class</span> 
            PhusionPassenger::Standalone::RuntimeInstaller 
            
                <span class="parent">&lt; 
                    
                    AbstractInstaller
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../../files/lib/phusion_passenger/standalone/runtime_installer_rb.html">lib/phusion_passenger/standalone/runtime_installer.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    
    <div class="description">
        <p>
Installs the Phusion Passenger <a href="../Standalone.html">Standalone</a>
runtime by downloading and compiling Nginx, compiling the Phusion Passenger
support binaries, and storing the results in the designated directories.
This installer is entirely non-interactive.
</p>
<p>
The following option must be given:
</p>
<ul>
<li>source_root: Path to the Phusion Passenger source root.

</li>
</ul>
<p>
If you want <a href="RuntimeInstaller.html">RuntimeInstaller</a> to compile
and install Nginx, then you must specify these options:
</p>
<ul>
<li>nginx_dir: Nginx will be installed into this directory.

</li>
<li>support_dir: See below.

</li>
<li>version (optional): The Nginx version to download. If not given then a
hardcoded version number will be used.

</li>
<li>tarball (optional): The location to the Nginx tarball. This tarball
<b>must</b> contain the Nginx version as specified by <tt>version</tt>. If
<tt>tarball</tt> is given then Nginx will not be downloaded; it will be
extracted from this tarball instead.

</li>
</ul>
<p>
If you want <a href="RuntimeInstaller.html">RuntimeInstaller</a> to compile
and install the Phusion Passenger support files, then you must specify
these:
</p>
<ul>
<li>support_dir: The support files will be installed here. Should not equal
<tt>source_root</tt>, or funny things might happen.

</li>
</ul>
<p>
Other optional options:
</p>
<ul>
<li>download_binaries: If true then <a
href="RuntimeInstaller.html">RuntimeInstaller</a> will attempt to download
precompiled Nginx binaries and precompiled Phusion Passenger support files
from the network, if they exist for the current platform. The default is
false.

</li>
<li>binaries_url_root: The URL on which to look for the aforementioned
binaries. The default points to the Phusion website.

</li>
</ul>
<p>
Please note that <a href="RuntimeInstaller.html">RuntimeInstaller</a> will
try to avoid compiling/installing things that don&#8217;t need to be
compiled/installed. This is done by checking whether some key files exist,
and concluding that something doesn&#8217;t need to be compiled/installed
if they do. This quick check is of course not perfect; if you want to force
a recompilation/reinstall then you should remove <tt>nginx_dir</tt> and
<tt>support_dir</tt> before starting this installer.
</p>

    </div>
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>A</dt>
        <dd>
            <ul>
                
                <li><a href="#M000444">after_install</a></li>
                
            </ul>
        </dd>
    
        <dt>B</dt>
        <dd>
            <ul>
                
                <li><a href="#M000443">before_install</a>,</li>
                
                <li><a href="#M000454">begin_progress_bar</a></li>
                
            </ul>
        </dd>
    
        <dt>C</dt>
        <dd>
            <ul>
                
                <li><a href="#M000451">check_whether_we_can_write_to</a>,</li>
                
                <li><a href="#M000458">copy_files</a></li>
                
            </ul>
        </dd>
    
        <dt>D</dt>
        <dd>
            <ul>
                
                <li><a href="#M000436">dependencies</a>,</li>
                
                <li><a href="#M000465">download_and_extract_nginx_binaries</a>,</li>
                
                <li><a href="#M000468">download_and_extract_nginx_sources</a>,</li>
                
                <li><a href="#M000463">download_and_extract_passenger_binaries</a></li>
                
            </ul>
        </dd>
    
        <dt>E</dt>
        <dd>
            <ul>
                
                <li><a href="#M000456">extract_tarball</a></li>
                
            </ul>
        </dd>
    
        <dt>I</dt>
        <dd>
            <ul>
                
                <li><a href="#M000438">install!</a>,</li>
                
                <li><a href="#M000474">install_nginx_from_source</a>,</li>
                
                <li><a href="#M000470">install_passenger_support_files</a></li>
                
            </ul>
        </dd>
    
        <dt>M</dt>
        <dd>
            <ul>
                
                <li><a href="#M000453">myself</a></li>
                
            </ul>
        </dd>
    
        <dt>N</dt>
        <dd>
            <ul>
                
                <li><a href="#M000445">nginx_needs_to_be_installed?</a></li>
                
            </ul>
        </dd>
    
        <dt>P</dt>
        <dd>
            <ul>
                
                <li><a href="#M000448">passenger_support_files_need_to_be_installed?</a></li>
                
            </ul>
        </dd>
    
        <dt>R</dt>
        <dd>
            <ul>
                
                <li><a href="#M000459">rake</a>,</li>
                
                <li><a href="#M000457">run_command_with_throbber</a>,</li>
                
                <li><a href="#M000460">run_rake_task!</a></li>
                
            </ul>
        </dd>
    
        <dt>S</dt>
        <dd>
            <ul>
                
                <li><a href="#M000449">should_download_binaries?</a>,</li>
                
                <li><a href="#M000455">show_possible_solutions_for_download_and_extraction_problems</a>,</li>
                
                <li><a href="#M000452">show_progress</a>,</li>
                
                <li><a href="#M000450">show_welcome_screen</a></li>
                
            </ul>
        </dd>
    
        <dt>U</dt>
        <dd>
            <ul>
                
                <li><a href="#M000437">users_guide</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    
    <div class="sectiontitle">Included Modules</div>
    <ul>
        
        <li>
            
            <a href="../Rack.html">PhusionPassenger::Rack</a>
            
            START:includes
        </li>
        
    </ul>
    

    

    

    

    

    
            <div class="sectiontitle">Instance Protected methods</div>
            
            <div class="method">
                <div class="title" id="M000444">
                    
                    <a name="M000444"></a><b>after_install</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000444_source')" id="l_M000444_source">show</a>
                        
                    </p>
                    <div id="M000444_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/phusion_passenger/standalone/runtime_installer.rb, line 172</span>
172:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">after_install</span>
173:     <span class="ruby-keyword kw">super</span>
174:     <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm_rf</span>(<span class="ruby-ivar">@working_dir</span>)
175:     <span class="ruby-ivar">@plugin</span>.<span class="ruby-identifier">call_hook</span>(<span class="ruby-identifier">:runtime_installer_cleanup</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@plugin</span>
176:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000443">
                    
                    <a name="M000443"></a><b>before_install</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000443_source')" id="l_M000443_source">show</a>
                        
                    </p>
                    <div id="M000443_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/phusion_passenger/standalone/runtime_installer.rb, line 162</span>
162:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">before_install</span>
163:     <span class="ruby-keyword kw">super</span>
164:     <span class="ruby-ivar">@plugin</span>.<span class="ruby-identifier">call_hook</span>(<span class="ruby-identifier">:runtime_installer_start</span>, <span class="ruby-keyword kw">self</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@plugin</span>
165:     <span class="ruby-ivar">@working_dir</span> = <span class="ruby-node">&quot;/tmp/#{myself}-passenger-standalone-#{Process.pid}&quot;</span>
166:     <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm_rf</span>(<span class="ruby-ivar">@working_dir</span>)
167:     <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span>(<span class="ruby-ivar">@working_dir</span>)
168:     <span class="ruby-ivar">@download_binaries</span> = <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-keyword kw">defined?</span>(<span class="ruby-ivar">@download_binaries</span>)
169:     <span class="ruby-ivar">@binaries_url_root</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">STANDALONE_BINARIES_URL_ROOT</span>
170:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000436">
                    
                    <a name="M000436"></a><b>dependencies</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000436_source')" id="l_M000436_source">show</a>
                        
                    </p>
                    <div id="M000436_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/phusion_passenger/standalone/runtime_installer.rb, line 76</span>
76:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">dependencies</span>
77:     <span class="ruby-identifier">result</span> = [
78:       <span class="ruby-constant">Dependencies</span><span class="ruby-operator">::</span><span class="ruby-constant">GCC</span>,
79:       <span class="ruby-constant">Dependencies</span><span class="ruby-operator">::</span><span class="ruby-constant">GnuMake</span>,
80:       <span class="ruby-constant">Dependencies</span><span class="ruby-operator">::</span><span class="ruby-constant">DownloadTool</span>,
81:       <span class="ruby-constant">Dependencies</span><span class="ruby-operator">::</span><span class="ruby-constant">Ruby_DevHeaders</span>,
82:       <span class="ruby-constant">Dependencies</span><span class="ruby-operator">::</span><span class="ruby-constant">Ruby_OpenSSL</span>,
83:       <span class="ruby-constant">Dependencies</span><span class="ruby-operator">::</span><span class="ruby-constant">RubyGems</span>,
84:       <span class="ruby-constant">Dependencies</span><span class="ruby-operator">::</span><span class="ruby-constant">Rake</span>,
85:       <span class="ruby-constant">Dependencies</span><span class="ruby-operator">::</span><span class="ruby-constant">Rack</span>,
86:       <span class="ruby-constant">Dependencies</span><span class="ruby-operator">::</span><span class="ruby-constant">Curl_Dev</span>,
87:       <span class="ruby-constant">Dependencies</span><span class="ruby-operator">::</span><span class="ruby-constant">OpenSSL_Dev</span>,
88:       <span class="ruby-constant">Dependencies</span><span class="ruby-operator">::</span><span class="ruby-constant">Zlib_Dev</span>,
89:       <span class="ruby-constant">Dependencies</span><span class="ruby-operator">::</span><span class="ruby-constant">Daemon_Controller</span>,
90:     ]
91:     <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Dependencies</span>.<span class="ruby-identifier">fastthread_required?</span>
92:       <span class="ruby-identifier">result</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Dependencies</span><span class="ruby-operator">::</span><span class="ruby-constant">FastThread</span>
93:     <span class="ruby-keyword kw">end</span>
94:     <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Dependencies</span>.<span class="ruby-identifier">asciidoc_required?</span>
95:       <span class="ruby-identifier">result</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Dependencies</span><span class="ruby-operator">::</span><span class="ruby-constant">AsciiDoc</span>
96:     <span class="ruby-keyword kw">end</span>
97:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">result</span>
98:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000438">
                    
                    <a name="M000438"></a><b>install!</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000438_source')" id="l_M000438_source">show</a>
                        
                    </p>
                    <div id="M000438_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/phusion_passenger/standalone/runtime_installer.rb, line 104</span>
104:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">install!</span>
105:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@support_dir</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@nginx_dir</span>
106:       <span class="ruby-identifier">show_welcome_screen</span>
107:     <span class="ruby-keyword kw">end</span>
108:     <span class="ruby-identifier">check_dependencies</span>(<span class="ruby-keyword kw">false</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">exit</span>(<span class="ruby-value">1</span>)
109:     <span class="ruby-identifier">puts</span>
110:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">passenger_support_files_need_to_be_installed?</span>
111:       <span class="ruby-identifier">check_whether_we_can_write_to</span>(<span class="ruby-ivar">@support_dir</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">exit</span>(<span class="ruby-value">1</span>)
112:     <span class="ruby-keyword kw">end</span>
113:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">nginx_needs_to_be_installed?</span>
114:       <span class="ruby-identifier">check_whether_we_can_write_to</span>(<span class="ruby-ivar">@nginx_dir</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">exit</span>(<span class="ruby-value">1</span>)
115:     <span class="ruby-keyword kw">end</span>
116:     
117:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">passenger_support_files_need_to_be_installed?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">should_download_binaries?</span>
118:       <span class="ruby-identifier">download_and_extract_passenger_binaries</span>(<span class="ruby-ivar">@support_dir</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">progress</span>, <span class="ruby-identifier">total</span><span class="ruby-operator">|</span>
119:         <span class="ruby-identifier">show_progress</span>(<span class="ruby-identifier">progress</span>, <span class="ruby-identifier">total</span>, <span class="ruby-value">1</span>, <span class="ruby-value">1</span>, <span class="ruby-value str">&quot;Extracting Passenger binaries...&quot;</span>)
120:       <span class="ruby-keyword kw">end</span>
121:       <span class="ruby-identifier">puts</span>
122:       <span class="ruby-identifier">puts</span>
123:     <span class="ruby-keyword kw">end</span>
124:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">nginx_needs_to_be_installed?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">should_download_binaries?</span>
125:       <span class="ruby-identifier">download_and_extract_nginx_binaries</span>(<span class="ruby-ivar">@nginx_dir</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">progress</span>, <span class="ruby-identifier">total</span><span class="ruby-operator">|</span>
126:         <span class="ruby-identifier">show_progress</span>(<span class="ruby-identifier">progress</span>, <span class="ruby-identifier">total</span>, <span class="ruby-value">1</span>, <span class="ruby-value">1</span>, <span class="ruby-value str">&quot;Extracting Nginx binaries...&quot;</span>)
127:       <span class="ruby-keyword kw">end</span>
128:       <span class="ruby-identifier">puts</span>
129:       <span class="ruby-identifier">puts</span>
130:     <span class="ruby-keyword kw">end</span>
131:     
132:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">nginx_needs_to_be_installed?</span>
133:       <span class="ruby-identifier">nginx_source_dir</span> = <span class="ruby-identifier">download_and_extract_nginx_sources</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">progress</span>, <span class="ruby-identifier">total</span><span class="ruby-operator">|</span>
134:         <span class="ruby-identifier">show_progress</span>(<span class="ruby-identifier">progress</span>, <span class="ruby-identifier">total</span>, <span class="ruby-value">1</span>, <span class="ruby-value">7</span>, <span class="ruby-value str">&quot;Extracting...&quot;</span>)
135:       <span class="ruby-keyword kw">end</span>
136:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">nginx_source_dir</span>.<span class="ruby-identifier">nil?</span>
137:         <span class="ruby-identifier">puts</span>
138:         <span class="ruby-identifier">show_possible_solutions_for_download_and_extraction_problems</span>
139:         <span class="ruby-identifier">exit</span>(<span class="ruby-value">1</span>)
140:       <span class="ruby-keyword kw">end</span>
141:     <span class="ruby-keyword kw">end</span>
142:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">passenger_support_files_need_to_be_installed?</span>
143:       <span class="ruby-identifier">install_passenger_support_files</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">progress</span>, <span class="ruby-identifier">total</span>, <span class="ruby-identifier">phase</span>, <span class="ruby-identifier">status_text</span><span class="ruby-operator">|</span>
144:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">phase</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span>
145:           <span class="ruby-identifier">show_progress</span>(<span class="ruby-identifier">progress</span>, <span class="ruby-identifier">total</span>, <span class="ruby-value">2</span>, <span class="ruby-value">7</span>, <span class="ruby-identifier">status_text</span>)
146:         <span class="ruby-keyword kw">else</span>
147:           <span class="ruby-identifier">show_progress</span>(<span class="ruby-identifier">progress</span>, <span class="ruby-identifier">total</span>, <span class="ruby-value">3</span><span class="ruby-operator">..</span><span class="ruby-value">5</span>, <span class="ruby-value">7</span>, <span class="ruby-identifier">status_text</span>)
148:         <span class="ruby-keyword kw">end</span>
149:       <span class="ruby-keyword kw">end</span>
150:     <span class="ruby-keyword kw">end</span>
151:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">nginx_needs_to_be_installed?</span>
152:       <span class="ruby-identifier">install_nginx_from_source</span>(<span class="ruby-identifier">nginx_source_dir</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">progress</span>, <span class="ruby-identifier">total</span>, <span class="ruby-identifier">status_text</span><span class="ruby-operator">|</span>
153:         <span class="ruby-identifier">show_progress</span>(<span class="ruby-identifier">progress</span>, <span class="ruby-identifier">total</span>, <span class="ruby-value">6</span><span class="ruby-operator">..</span><span class="ruby-value">7</span>, <span class="ruby-value">7</span>, <span class="ruby-identifier">status_text</span>)
154:       <span class="ruby-keyword kw">end</span>
155:     <span class="ruby-keyword kw">end</span>
156:     
157:     <span class="ruby-identifier">puts</span>
158:     <span class="ruby-identifier">color_puts</span> <span class="ruby-value str">&quot;&lt;green&gt;&lt;b&gt;All done!&lt;/b&gt;&lt;/green&gt;&quot;</span>
159:     <span class="ruby-identifier">puts</span>
160:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000437">
                    
                    <a name="M000437"></a><b>users_guide</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000437_source')" id="l_M000437_source">show</a>
                        
                    </p>
                    <div id="M000437_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/phusion_passenger/standalone/runtime_installer.rb, line 100</span>
100:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">users_guide</span>
101:     <span class="ruby-keyword kw">return</span> <span class="ruby-node">&quot;#{DOCDIR}/Users guide Standalone.html&quot;</span>
102:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Private methods</div>
            
            <div class="method">
                <div class="title" id="M000454">
                    
                    <a name="M000454"></a><b>begin_progress_bar</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000454_source')" id="l_M000454_source">show</a>
                        
                    </p>
                    <div id="M000454_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/phusion_passenger/standalone/runtime_installer.rb, line 237</span>
237:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">begin_progress_bar</span>
238:     <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@begun</span>
239:       <span class="ruby-ivar">@begun</span> = <span class="ruby-keyword kw">true</span>
240:       <span class="ruby-identifier">color_puts</span> <span class="ruby-value str">&quot;&lt;banner&gt;Installing Phusion Passenger Standalone...&lt;/banner&gt;&quot;</span>
241:     <span class="ruby-keyword kw">end</span>
242:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000451">
                    
                    <a name="M000451"></a><b>check_whether_we_can_write_to</b>(dir)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000451_source')" id="l_M000451_source">show</a>
                        
                    </p>
                    <div id="M000451_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/phusion_passenger/standalone/runtime_installer.rb, line 198</span>
198:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">check_whether_we_can_write_to</span>(<span class="ruby-identifier">dir</span>)
199:     <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span>(<span class="ruby-identifier">dir</span>)
200:     <span class="ruby-constant">File</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;#{dir}/__test__.txt&quot;</span>, <span class="ruby-value str">&quot;w&quot;</span>).<span class="ruby-identifier">close</span>
201:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span>
202:   <span class="ruby-keyword kw">rescue</span>
203:     <span class="ruby-identifier">new_screen</span>
204:     <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Process</span>.<span class="ruby-identifier">uid</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
205:       <span class="ruby-identifier">render_template</span> <span class="ruby-value str">'standalone/cannot_write_to_dir'</span>, <span class="ruby-identifier">:dir</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">dir</span>
206:     <span class="ruby-keyword kw">else</span>
207:       <span class="ruby-identifier">render_template</span> <span class="ruby-value str">'standalone/run_installer_as_root'</span>, <span class="ruby-identifier">:dir</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">dir</span>
208:     <span class="ruby-keyword kw">end</span>
209:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span>
210:   <span class="ruby-keyword kw">ensure</span>
211:     <span class="ruby-constant">File</span>.<span class="ruby-identifier">unlink</span>(<span class="ruby-node">&quot;#{dir}/__test__.txt&quot;</span>) <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
212:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000458">
                    
                    <a name="M000458"></a><b>copy_files</b>(files, target)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000458_source')" id="l_M000458_source">show</a>
                        
                    </p>
                    <div id="M000458_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/phusion_passenger/standalone/runtime_installer.rb, line 302</span>
302:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">copy_files</span>(<span class="ruby-identifier">files</span>, <span class="ruby-identifier">target</span>)
303:     <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span>(<span class="ruby-identifier">target</span>)
304:     <span class="ruby-identifier">files</span>.<span class="ruby-identifier">each_with_index</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">filename</span>, <span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
305:       <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">directory?</span>(<span class="ruby-identifier">filename</span>)
306:       <span class="ruby-identifier">dir</span> = <span class="ruby-node">&quot;#{target}/#{File.dirname(filename)}&quot;</span>
307:       <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">directory?</span>(<span class="ruby-identifier">dir</span>)
308:         <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span>(<span class="ruby-identifier">dir</span>)
309:       <span class="ruby-keyword kw">end</span>
310:       <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">install</span>(<span class="ruby-identifier">filename</span>, <span class="ruby-node">&quot;#{target}/#{filename}&quot;</span>, <span class="ruby-identifier">:mode</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">stat</span>(<span class="ruby-identifier">filename</span>).<span class="ruby-identifier">mode</span>)
311:       <span class="ruby-keyword kw">yield</span>(<span class="ruby-identifier">i</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">files</span>.<span class="ruby-identifier">size</span>)
312:     <span class="ruby-keyword kw">end</span>
313:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000465">
                    
                    <a name="M000465"></a><b>download_and_extract_nginx_binaries</b>(target, &amp;block)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000465_source')" id="l_M000465_source">show</a>
                        
                    </p>
                    <div id="M000465_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/phusion_passenger/standalone/runtime_installer.rb, line 362</span>
362:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">download_and_extract_nginx_binaries</span>(<span class="ruby-identifier">target</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
363:     <span class="ruby-identifier">color_puts</span> <span class="ruby-value str">&quot;&lt;banner&gt;Downloading Nginx binaries for your platform, if available...&lt;/banner&gt;&quot;</span>
364:     <span class="ruby-identifier">basename</span> = <span class="ruby-node">&quot;nginx-#{@version}.tar.gz&quot;</span>
365:     <span class="ruby-identifier">url</span>      = <span class="ruby-node">&quot;#{@binaries_url_root}/#{runtime_version_string}/#{basename}&quot;</span>
366:     <span class="ruby-identifier">tarball</span>  = <span class="ruby-node">&quot;#{@working_dir}/#{basename}&quot;</span>
367:     <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">download</span>(<span class="ruby-identifier">url</span>, <span class="ruby-identifier">tarball</span>)
368:       <span class="ruby-identifier">color_puts</span> <span class="ruby-value str">&quot;&lt;b&gt;Looks like it's not. But don't worry, the &quot;</span> <span class="ruby-operator">+</span>
369:         <span class="ruby-value str">&quot;necessary binaries will be compiled from source instead.&lt;/b&gt;&quot;</span>
370:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span>
371:     <span class="ruby-keyword kw">end</span>
372: 
373:     <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span>(<span class="ruby-identifier">target</span>)
374:     <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">chdir</span>(<span class="ruby-identifier">target</span>) <span class="ruby-keyword kw">do</span>
375:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">extract_tarball</span>(<span class="ruby-identifier">tarball</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
376:     <span class="ruby-keyword kw">end</span>
377:   <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Interrupt</span>
378:     <span class="ruby-identifier">exit</span> <span class="ruby-value">2</span>
379:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000468">
                    
                    <a name="M000468"></a><b>download_and_extract_nginx_sources</b>(&amp;block)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000468_source')" id="l_M000468_source">show</a>
                        
                    </p>
                    <div id="M000468_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/phusion_passenger/standalone/runtime_installer.rb, line 381</span>
381:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">download_and_extract_nginx_sources</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
382:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@tarball</span>
383:       <span class="ruby-identifier">tarball</span>  = <span class="ruby-ivar">@tarball</span>
384:     <span class="ruby-keyword kw">else</span>
385:       <span class="ruby-identifier">color_puts</span> <span class="ruby-value str">&quot;&lt;banner&gt;Downloading Nginx...&lt;/banner&gt;&quot;</span>
386:       <span class="ruby-identifier">basename</span> = <span class="ruby-node">&quot;nginx-#{@version}.tar.gz&quot;</span>
387:       <span class="ruby-identifier">tarball</span>  = <span class="ruby-node">&quot;#{@working_dir}/#{basename}&quot;</span>
388:       <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">download</span>(<span class="ruby-node">&quot;http://nginx.org/download/#{basename}&quot;</span>, <span class="ruby-identifier">tarball</span>)
389:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span>
390:       <span class="ruby-keyword kw">end</span>
391:     <span class="ruby-keyword kw">end</span>
392:     <span class="ruby-identifier">nginx_sources_name</span> = <span class="ruby-node">&quot;nginx-#{@version}&quot;</span>
393:     
394:     <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">chdir</span>(<span class="ruby-ivar">@working_dir</span>) <span class="ruby-keyword kw">do</span>
395:       <span class="ruby-identifier">begin_progress_bar</span>
396:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">extract_tarball</span>(<span class="ruby-identifier">tarball</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
397:         <span class="ruby-keyword kw">return</span> <span class="ruby-node">&quot;#{@working_dir}/#{nginx_sources_name}&quot;</span>
398:       <span class="ruby-keyword kw">else</span>
399:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span>
400:       <span class="ruby-keyword kw">end</span>
401:     <span class="ruby-keyword kw">end</span>
402:   <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Interrupt</span>
403:     <span class="ruby-identifier">exit</span> <span class="ruby-value">2</span>
404:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000463">
                    
                    <a name="M000463"></a><b>download_and_extract_passenger_binaries</b>(target, &amp;block)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000463_source')" id="l_M000463_source">show</a>
                        
                    </p>
                    <div id="M000463_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/phusion_passenger/standalone/runtime_installer.rb, line 344</span>
344:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">download_and_extract_passenger_binaries</span>(<span class="ruby-identifier">target</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
345:     <span class="ruby-identifier">color_puts</span> <span class="ruby-value str">&quot;&lt;banner&gt;Downloading Passenger binaries for your platform, if available...&lt;/banner&gt;&quot;</span>
346:     <span class="ruby-identifier">url</span>     = <span class="ruby-node">&quot;#{@binaries_url_root}/#{runtime_version_string}/support.tar.gz&quot;</span>
347:     <span class="ruby-identifier">tarball</span> = <span class="ruby-node">&quot;#{@working_dir}/support.tar.gz&quot;</span>
348:     <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">download</span>(<span class="ruby-identifier">url</span>, <span class="ruby-identifier">tarball</span>)
349:       <span class="ruby-identifier">color_puts</span> <span class="ruby-value str">&quot;&lt;b&gt;Looks like it's not. But don't worry, the &quot;</span> <span class="ruby-operator">+</span>
350:         <span class="ruby-value str">&quot;necessary binaries will be compiled from source instead.&lt;/b&gt;&quot;</span>
351:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span>
352:     <span class="ruby-keyword kw">end</span>
353:     
354:     <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span>(<span class="ruby-identifier">target</span>)
355:     <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">chdir</span>(<span class="ruby-identifier">target</span>) <span class="ruby-keyword kw">do</span>
356:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">extract_tarball</span>(<span class="ruby-identifier">tarball</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
357:     <span class="ruby-keyword kw">end</span>
358:   <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Interrupt</span>
359:     <span class="ruby-identifier">exit</span> <span class="ruby-value">2</span>
360:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000456">
                    
                    <a name="M000456"></a><b>extract_tarball</b>(filename)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000456_source')" id="l_M000456_source">show</a>
                        
                    </p>
                    <div id="M000456_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/phusion_passenger/standalone/runtime_installer.rb, line 250</span>
250:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">extract_tarball</span>(<span class="ruby-identifier">filename</span>)
251:     <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">filename</span>, <span class="ruby-value str">'rb'</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span>
252:       <span class="ruby-constant">IO</span>.<span class="ruby-identifier">popen</span>(<span class="ruby-value str">&quot;tar xzf -&quot;</span>, <span class="ruby-value str">&quot;w&quot;</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">io</span><span class="ruby-operator">|</span>
253:         <span class="ruby-identifier">buffer</span> = <span class="ruby-value str">''</span>
254:         <span class="ruby-identifier">total_size</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">size</span>(<span class="ruby-identifier">filename</span>)
255:         <span class="ruby-identifier">bytes_read</span> = <span class="ruby-value">0</span>
256:         <span class="ruby-keyword kw">yield</span>(<span class="ruby-identifier">bytes_read</span>, <span class="ruby-identifier">total_size</span>)
257:         <span class="ruby-keyword kw">begin</span>
258:           <span class="ruby-identifier">doing_our_io</span> = <span class="ruby-keyword kw">true</span>
259:           <span class="ruby-keyword kw">while</span> <span class="ruby-operator">!</span><span class="ruby-identifier">f</span>.<span class="ruby-identifier">eof?</span>
260:             <span class="ruby-identifier">f</span>.<span class="ruby-identifier">read</span>(<span class="ruby-value">1024</span> <span class="ruby-operator">*</span> <span class="ruby-value">8</span>, <span class="ruby-identifier">buffer</span>)
261:             <span class="ruby-identifier">io</span>.<span class="ruby-identifier">write</span>(<span class="ruby-identifier">buffer</span>)
262:             <span class="ruby-identifier">io</span>.<span class="ruby-identifier">flush</span>
263:             <span class="ruby-identifier">bytes_read</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">buffer</span>.<span class="ruby-identifier">size</span>
264:             <span class="ruby-identifier">doing_our_io</span> = <span class="ruby-keyword kw">false</span>
265:             <span class="ruby-keyword kw">yield</span>(<span class="ruby-identifier">bytes_read</span>, <span class="ruby-identifier">total_size</span>)
266:             <span class="ruby-identifier">doing_our_io</span> = <span class="ruby-keyword kw">true</span>
267:           <span class="ruby-keyword kw">end</span>
268:         <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">EPIPE</span>
269:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">doing_our_io</span>
270:             <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span>
271:           <span class="ruby-keyword kw">else</span>
272:             <span class="ruby-identifier">raise</span>
273:           <span class="ruby-keyword kw">end</span>
274:         <span class="ruby-keyword kw">end</span>
275:       <span class="ruby-keyword kw">end</span>
276:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">$?</span>.<span class="ruby-identifier">exitstatus</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
277:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span>
278:       <span class="ruby-keyword kw">end</span>
279:     <span class="ruby-keyword kw">end</span>
280:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span>
281:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000474">
                    
                    <a name="M000474"></a><b>install_nginx_from_source</b>(source_dir)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000474_source')" id="l_M000474_source">show</a>
                        
                    </p>
                    <div id="M000474_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/phusion_passenger/standalone/runtime_installer.rb, line 428</span>
428:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">install_nginx_from_source</span>(<span class="ruby-identifier">source_dir</span>)
429:     <span class="ruby-identifier">require</span> <span class="ruby-value str">'phusion_passenger/platform_info/compiler'</span>
430:     <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">chdir</span>(<span class="ruby-identifier">source_dir</span>) <span class="ruby-keyword kw">do</span>
431:       <span class="ruby-comment cmt"># RPM thinks it's being smart by scanning binaries for</span>
432:       <span class="ruby-comment cmt"># paths and refusing to create package if it detects any</span>
433:       <span class="ruby-comment cmt"># hardcoded thats that point to /usr or other important</span>
434:       <span class="ruby-comment cmt"># locations. For Phusion Passenger Standalone we do not</span>
435:       <span class="ruby-comment cmt"># care at all what the Nginx configured prefix is because</span>
436:       <span class="ruby-comment cmt"># we pass it its resource locations during runtime, so</span>
437:       <span class="ruby-comment cmt"># work around the problem by configure Nginx with prefix</span>
438:       <span class="ruby-comment cmt"># /tmp.</span>
439:       <span class="ruby-identifier">command</span> = <span class="ruby-value str">&quot;sh ./configure --prefix=/tmp &quot;</span> <span class="ruby-operator">&lt;&lt;</span>
440:         <span class="ruby-value str">&quot;--with-cc-opt='-Wno-error' &quot;</span> <span class="ruby-operator">&lt;&lt;</span>
441:         <span class="ruby-value str">&quot;--without-pcre &quot;</span> <span class="ruby-operator">&lt;&lt;</span>
442:         <span class="ruby-value str">&quot;--without-http_rewrite_module &quot;</span> <span class="ruby-operator">&lt;&lt;</span>
443:         <span class="ruby-value str">&quot;--without-http_fastcgi_module &quot;</span> <span class="ruby-operator">&lt;&lt;</span>
444:         <span class="ruby-node">&quot;'--add-module=#{@support_dir}/ext/nginx'&quot;</span>
445:       <span class="ruby-identifier">run_command_with_throbber</span>(<span class="ruby-identifier">command</span>, <span class="ruby-value str">&quot;Preparing Nginx...&quot;</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">status_text</span><span class="ruby-operator">|</span>
446:         <span class="ruby-keyword kw">yield</span>(<span class="ruby-value">0</span>, <span class="ruby-value">1</span>, <span class="ruby-identifier">status_text</span>)
447:       <span class="ruby-keyword kw">end</span>
448:       
449:       <span class="ruby-identifier">backlog</span> = <span class="ruby-value str">&quot;&quot;</span>
450:       <span class="ruby-identifier">total_lines</span> = <span class="ruby-node">`#{PlatformInfo.gnu_make} --dry-run`</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;\n&quot;</span>).<span class="ruby-identifier">size</span>
451:       <span class="ruby-constant">IO</span>.<span class="ruby-identifier">popen</span>(<span class="ruby-node">&quot;#{PlatformInfo.gnu_make} 2&gt;&amp;1&quot;</span>, <span class="ruby-value str">&quot;r&quot;</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">io</span><span class="ruby-operator">|</span>
452:         <span class="ruby-identifier">progress</span> = <span class="ruby-value">1</span>
453:         <span class="ruby-keyword kw">while</span> <span class="ruby-operator">!</span><span class="ruby-identifier">io</span>.<span class="ruby-identifier">eof?</span>
454:           <span class="ruby-identifier">line</span> = <span class="ruby-identifier">io</span>.<span class="ruby-identifier">readline</span>
455:           <span class="ruby-identifier">backlog</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">line</span>
456:           <span class="ruby-keyword kw">yield</span>(<span class="ruby-identifier">progress</span>, <span class="ruby-identifier">total_lines</span>, <span class="ruby-value str">&quot;Compiling Nginx core...&quot;</span>)
457:           <span class="ruby-identifier">progress</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
458:         <span class="ruby-keyword kw">end</span>
459:       <span class="ruby-keyword kw">end</span>
460:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">$?</span>.<span class="ruby-identifier">exitstatus</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
461:         <span class="ruby-constant">STDERR</span>.<span class="ruby-identifier">puts</span>
462:         <span class="ruby-constant">STDERR</span>.<span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;*** ERROR: unable to compile Nginx.&quot;</span>
463:         <span class="ruby-constant">STDERR</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">backlog</span>
464:         <span class="ruby-identifier">exit</span> <span class="ruby-value">1</span>
465:       <span class="ruby-keyword kw">end</span>
466:       
467:       <span class="ruby-keyword kw">yield</span>(<span class="ruby-value">1</span>, <span class="ruby-value">1</span>, <span class="ruby-value str">'Copying files...'</span>)
468:       <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">system</span>(<span class="ruby-node">&quot;mkdir -p '#{@nginx_dir}/sbin'&quot;</span>) <span class="ruby-operator">||</span>
469:          <span class="ruby-operator">!</span><span class="ruby-identifier">system</span>(<span class="ruby-node">&quot;cp -pR objs/nginx '#{@nginx_dir}/sbin/'&quot;</span>)
470:         <span class="ruby-constant">STDERR</span>.<span class="ruby-identifier">puts</span>
471:         <span class="ruby-constant">STDERR</span>.<span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;*** ERROR: unable to copy Nginx binaries.&quot;</span>
472:         <span class="ruby-identifier">exit</span> <span class="ruby-value">1</span>
473:       <span class="ruby-keyword kw">end</span>
474:     <span class="ruby-keyword kw">end</span>
475:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000470">
                    
                    <a name="M000470"></a><b>install_passenger_support_files</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000470_source')" id="l_M000470_source">show</a>
                        
                    </p>
                    <div id="M000470_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/phusion_passenger/standalone/runtime_installer.rb, line 406</span>
406:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">install_passenger_support_files</span>
407:     <span class="ruby-identifier">begin_progress_bar</span>
408:     
409:     <span class="ruby-comment cmt"># Copy Phusion Passenger sources to designated directory if necessary.</span>
410:     <span class="ruby-keyword kw">yield</span>(<span class="ruby-value">0</span>, <span class="ruby-value">1</span>, <span class="ruby-value">1</span>, <span class="ruby-value str">&quot;Preparing Phusion Passenger...&quot;</span>)
411:     <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm_rf</span>(<span class="ruby-ivar">@support_dir</span>)
412:     <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">chdir</span>(<span class="ruby-ivar">@source_root</span>) <span class="ruby-keyword kw">do</span>
413:       <span class="ruby-identifier">files</span> = <span class="ruby-node">`#{rake} package:filelist --silent`</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;\n&quot;</span>)
414:       <span class="ruby-identifier">copy_files</span>(<span class="ruby-identifier">files</span>, <span class="ruby-ivar">@support_dir</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">progress</span>, <span class="ruby-identifier">total</span><span class="ruby-operator">|</span>
415:         <span class="ruby-keyword kw">yield</span>(<span class="ruby-identifier">progress</span>, <span class="ruby-identifier">total</span>, <span class="ruby-value">1</span>, <span class="ruby-value str">&quot;Copying files...&quot;</span>)
416:       <span class="ruby-keyword kw">end</span>
417:     <span class="ruby-keyword kw">end</span>
418:     
419:     <span class="ruby-comment cmt"># Then compile it.</span>
420:     <span class="ruby-keyword kw">yield</span>(<span class="ruby-value">0</span>, <span class="ruby-value">1</span>, <span class="ruby-value">2</span>, <span class="ruby-value str">&quot;Preparing Phusion Passenger...&quot;</span>)
421:     <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">chdir</span>(<span class="ruby-ivar">@support_dir</span>) <span class="ruby-keyword kw">do</span>
422:       <span class="ruby-identifier">run_rake_task!</span>(<span class="ruby-value str">&quot;nginx RELEASE=yes&quot;</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">progress</span>, <span class="ruby-identifier">total</span><span class="ruby-operator">|</span>
423:         <span class="ruby-keyword kw">yield</span>(<span class="ruby-identifier">progress</span>, <span class="ruby-identifier">total</span>, <span class="ruby-value">2</span>, <span class="ruby-value str">&quot;Compiling Phusion Passenger...&quot;</span>)
424:       <span class="ruby-keyword kw">end</span>
425:     <span class="ruby-keyword kw">end</span>
426:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000453">
                    
                    <a name="M000453"></a><b>myself</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000453_source')" id="l_M000453_source">show</a>
                        
                    </p>
                    <div id="M000453_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/phusion_passenger/standalone/runtime_installer.rb, line 233</span>
233:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">myself</span>
234:     <span class="ruby-keyword kw">return</span> <span class="ruby-value">`whoami`</span>.<span class="ruby-identifier">strip</span>
235:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000445">
                    
                    <a name="M000445"></a><b>nginx_needs_to_be_installed?</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000445_source')" id="l_M000445_source">show</a>
                        
                    </p>
                    <div id="M000445_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/phusion_passenger/standalone/runtime_installer.rb, line 179</span>
179:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">nginx_needs_to_be_installed?</span>
180:     <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@nginx_dir</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-node">&quot;#{@nginx_dir}/sbin/nginx&quot;</span>)
181:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000448">
                    
                    <a name="M000448"></a><b>passenger_support_files_need_to_be_installed?</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000448_source')" id="l_M000448_source">show</a>
                        
                    </p>
                    <div id="M000448_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/phusion_passenger/standalone/runtime_installer.rb, line 183</span>
183:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">passenger_support_files_need_to_be_installed?</span>
184:     <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@support_dir</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-node">&quot;#{@support_dir}/Rakefile&quot;</span>)
185:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000459">
                    
                    <a name="M000459"></a><b>rake</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000459_source')" id="l_M000459_source">show</a>
                        
                    </p>
                    <div id="M000459_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/phusion_passenger/standalone/runtime_installer.rb, line 315</span>
315:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">rake</span>
316:     <span class="ruby-keyword kw">return</span> <span class="ruby-constant">PlatformInfo</span>.<span class="ruby-identifier">rake_command</span>
317:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000457">
                    
                    <a name="M000457"></a><b>run_command_with_throbber</b>(command, status_text)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000457_source')" id="l_M000457_source">show</a>
                        
                    </p>
                    <div id="M000457_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/phusion_passenger/standalone/runtime_installer.rb, line 283</span>
283:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">run_command_with_throbber</span>(<span class="ruby-identifier">command</span>, <span class="ruby-identifier">status_text</span>)
284:     <span class="ruby-identifier">backlog</span> = <span class="ruby-value str">&quot;&quot;</span>
285:     <span class="ruby-constant">IO</span>.<span class="ruby-identifier">popen</span>(<span class="ruby-node">&quot;#{command} 2&gt;&amp;1&quot;</span>, <span class="ruby-value str">&quot;r&quot;</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">io</span><span class="ruby-operator">|</span>
286:       <span class="ruby-identifier">throbbers</span> = [<span class="ruby-value str">'-'</span>, <span class="ruby-value str">'\\'</span>, <span class="ruby-value str">'|'</span>, <span class="ruby-value str">'/'</span>]
287:       <span class="ruby-identifier">index</span> = <span class="ruby-value">0</span>
288:       <span class="ruby-keyword kw">while</span> <span class="ruby-operator">!</span><span class="ruby-identifier">io</span>.<span class="ruby-identifier">eof?</span>
289:         <span class="ruby-identifier">backlog</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">io</span>.<span class="ruby-identifier">readline</span>
290:         <span class="ruby-keyword kw">yield</span>(<span class="ruby-node">&quot;#{status_text} #{throbbers[index]}&quot;</span>)
291:         <span class="ruby-identifier">index</span> = (<span class="ruby-identifier">index</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>) <span class="ruby-operator">%</span> <span class="ruby-identifier">throbbers</span>.<span class="ruby-identifier">size</span>
292:       <span class="ruby-keyword kw">end</span>
293:     <span class="ruby-keyword kw">end</span>
294:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">$?</span>.<span class="ruby-identifier">exitstatus</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
295:       <span class="ruby-constant">STDERR</span>.<span class="ruby-identifier">puts</span>
296:       <span class="ruby-constant">STDERR</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">backlog</span>
297:       <span class="ruby-constant">STDERR</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;*** ERROR: command failed: #{command}&quot;</span>
298:       <span class="ruby-identifier">exit</span> <span class="ruby-value">1</span>
299:     <span class="ruby-keyword kw">end</span>
300:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000460">
                    
                    <a name="M000460"></a><b>run_rake_task!</b>(target)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000460_source')" id="l_M000460_source">show</a>
                        
                    </p>
                    <div id="M000460_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/phusion_passenger/standalone/runtime_installer.rb, line 319</span>
319:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">run_rake_task!</span>(<span class="ruby-identifier">target</span>)
320:     <span class="ruby-identifier">total_lines</span> = <span class="ruby-node">`#{rake} #{target} --dry-run STDERR_TO_STDOUT=1`</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;\n&quot;</span>).<span class="ruby-identifier">size</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>
321:     <span class="ruby-identifier">backlog</span> = <span class="ruby-value str">&quot;&quot;</span>
322:     
323:     <span class="ruby-constant">IO</span>.<span class="ruby-identifier">popen</span>(<span class="ruby-node">&quot;#{rake} #{target} --trace STDERR_TO_STDOUT=1&quot;</span>, <span class="ruby-value str">&quot;r&quot;</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">io</span><span class="ruby-operator">|</span>
324:       <span class="ruby-identifier">progress</span> = <span class="ruby-value">1</span>
325:       <span class="ruby-keyword kw">while</span> <span class="ruby-operator">!</span><span class="ruby-identifier">io</span>.<span class="ruby-identifier">eof?</span>
326:         <span class="ruby-identifier">line</span> = <span class="ruby-identifier">io</span>.<span class="ruby-identifier">readline</span>
327:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">line</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/^\*\* /</span>
328:           <span class="ruby-keyword kw">yield</span>(<span class="ruby-identifier">progress</span>, <span class="ruby-identifier">total_lines</span>)
329:           <span class="ruby-identifier">backlog</span>.<span class="ruby-identifier">replace</span>(<span class="ruby-value str">&quot;&quot;</span>)
330:           <span class="ruby-identifier">progress</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
331:         <span class="ruby-keyword kw">else</span>
332:           <span class="ruby-identifier">backlog</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">line</span>
333:         <span class="ruby-keyword kw">end</span>
334:       <span class="ruby-keyword kw">end</span>
335:     <span class="ruby-keyword kw">end</span>
336:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">$?</span>.<span class="ruby-identifier">exitstatus</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
337:       <span class="ruby-constant">STDERR</span>.<span class="ruby-identifier">puts</span>
338:       <span class="ruby-constant">STDERR</span>.<span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;*** ERROR: the following command failed:&quot;</span>
339:       <span class="ruby-constant">STDERR</span>.<span class="ruby-identifier">puts</span>(<span class="ruby-identifier">backlog</span>)
340:       <span class="ruby-identifier">exit</span> <span class="ruby-value">1</span>
341:     <span class="ruby-keyword kw">end</span>
342:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000449">
                    
                    <a name="M000449"></a><b>should_download_binaries?</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000449_source')" id="l_M000449_source">show</a>
                        
                    </p>
                    <div id="M000449_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/phusion_passenger/standalone/runtime_installer.rb, line 187</span>
187:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">should_download_binaries?</span>
188:     <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@download_binaries</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@binaries_url_root</span>
189:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000455">
                    
                    <a name="M000455"></a><b>show_possible_solutions_for_download_and_extraction_problems</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000455_source')" id="l_M000455_source">show</a>
                        
                    </p>
                    <div id="M000455_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/phusion_passenger/standalone/runtime_installer.rb, line 244</span>
244:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">show_possible_solutions_for_download_and_extraction_problems</span>
245:     <span class="ruby-identifier">new_screen</span>
246:     <span class="ruby-identifier">render_template</span> <span class="ruby-value str">&quot;standalone/possible_solutions_for_download_and_extraction_problems&quot;</span>
247:     <span class="ruby-identifier">puts</span>
248:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000452">
                    
                    <a name="M000452"></a><b>show_progress</b>(progress, total, phase, total_phases, status_text = &quot;&quot;)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000452_source')" id="l_M000452_source">show</a>
                        
                    </p>
                    <div id="M000452_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/phusion_passenger/standalone/runtime_installer.rb, line 214</span>
214:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">show_progress</span>(<span class="ruby-identifier">progress</span>, <span class="ruby-identifier">total</span>, <span class="ruby-identifier">phase</span>, <span class="ruby-identifier">total_phases</span>, <span class="ruby-identifier">status_text</span> = <span class="ruby-value str">&quot;&quot;</span>)
215:     <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">phase</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Range</span>)
216:       <span class="ruby-identifier">phase</span> = <span class="ruby-identifier">phase</span><span class="ruby-operator">..</span><span class="ruby-identifier">phase</span>
217:     <span class="ruby-keyword kw">end</span>
218:     <span class="ruby-identifier">total_progress</span> = (<span class="ruby-identifier">phase</span>.<span class="ruby-identifier">first</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>).<span class="ruby-identifier">to_f</span> <span class="ruby-operator">/</span> <span class="ruby-identifier">total_phases</span>
219:     <span class="ruby-identifier">total_progress</span> <span class="ruby-operator">+=</span> (<span class="ruby-identifier">progress</span>.<span class="ruby-identifier">to_f</span> <span class="ruby-operator">/</span> <span class="ruby-identifier">total</span>) <span class="ruby-operator">*</span> ((<span class="ruby-identifier">phase</span>.<span class="ruby-identifier">last</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">phase</span>.<span class="ruby-identifier">first</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>).<span class="ruby-identifier">to_f</span> <span class="ruby-operator">/</span> <span class="ruby-identifier">total_phases</span>)
220:     
221:     <span class="ruby-identifier">max_width</span> = <span class="ruby-value">79</span>
222:     <span class="ruby-identifier">progress_bar_width</span> = <span class="ruby-value">45</span>
223:     <span class="ruby-identifier">text</span> = <span class="ruby-identifier">sprintf</span>(<span class="ruby-node">&quot;[%-#{progress_bar_width}s] %s&quot;</span>,
224:       <span class="ruby-value str">'*'</span> <span class="ruby-operator">*</span> (<span class="ruby-identifier">progress_bar_width</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">total_progress</span>).<span class="ruby-identifier">to_i</span>,
225:       <span class="ruby-identifier">status_text</span>)
226:     <span class="ruby-identifier">text</span> = <span class="ruby-identifier">text</span>.<span class="ruby-identifier">ljust</span>(<span class="ruby-identifier">max_width</span>)
227:     <span class="ruby-identifier">text</span> = <span class="ruby-identifier">text</span>[<span class="ruby-value">0</span> <span class="ruby-operator">..</span> <span class="ruby-identifier">max_width</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>]
228:     <span class="ruby-constant">STDOUT</span>.<span class="ruby-identifier">write</span>(<span class="ruby-node">&quot;#{text}\r&quot;</span>)
229:     <span class="ruby-constant">STDOUT</span>.<span class="ruby-identifier">flush</span>
230:     <span class="ruby-ivar">@plugin</span>.<span class="ruby-identifier">call_hook</span>(<span class="ruby-identifier">:runtime_installer_progress</span>, <span class="ruby-identifier">total_progress</span>, <span class="ruby-identifier">status_text</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@plugin</span>
231:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000450">
                    
                    <a name="M000450"></a><b>show_welcome_screen</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000450_source')" id="l_M000450_source">show</a>
                        
                    </p>
                    <div id="M000450_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/phusion_passenger/standalone/runtime_installer.rb, line 191</span>
191:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">show_welcome_screen</span>
192:     <span class="ruby-identifier">render_template</span> <span class="ruby-value str">'standalone/welcome'</span>,
193:       <span class="ruby-identifier">:version</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@version</span>,
194:       <span class="ruby-identifier">:dir</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@nginx_dir</span>
195:     <span class="ruby-identifier">puts</span>
196:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    