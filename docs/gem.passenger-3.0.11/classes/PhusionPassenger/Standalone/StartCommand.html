<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>PhusionPassenger::Standalone::StartCommand</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../../css/main.css" type="text/css" media="screen" />
    <script src="../../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Class</span> 
            PhusionPassenger::Standalone::StartCommand 
            
                <span class="parent">&lt; 
                    
                    Command
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../../files/lib/phusion_passenger/standalone/start_command_rb.html">lib/phusion_passenger/standalone/start_command.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>C</dt>
        <dd>
            <ul>
                
                <li><a href="#M000464">check_port_availability</a>,</li>
                
                <li><a href="#M000462">check_port_bind_permission_and_display_sudo_suggestion</a></li>
                
            </ul>
        </dd>
    
        <dt>D</dt>
        <dd>
            <ul>
                
                <li><a href="#M000478">daemonize</a>,</li>
                
                <li><a href="#M000488">default_group_for</a>,</li>
                
                <li><a href="#M000439">description</a></li>
                
            </ul>
        </dd>
    
        <dt>E</dt>
        <dd>
            <ul>
                
                <li><a href="#M000475">ensure_directory_exists</a>,</li>
                
                <li><a href="#M000473">ensure_nginx_installed</a></li>
                
            </ul>
        </dd>
    
        <dt>I</dt>
        <dd>
            <ul>
                
                <li><a href="#M000469">install_runtime</a></li>
                
            </ul>
        </dd>
    
        <dt>L</dt>
        <dd>
            <ul>
                
                <li><a href="#M000467">listen_url</a></li>
                
            </ul>
        </dd>
    
        <dt>N</dt>
        <dd>
            <ul>
                
                <li><a href="#M000440">new</a>,</li>
                
                <li><a href="#M000472">nginx_dir</a>,</li>
                
                <li><a href="#M000487">nginx_listen_address</a></li>
                
            </ul>
        </dd>
    
        <dt>P</dt>
        <dd>
            <ul>
                
                <li><a href="#M000447">parse_my_options</a>,</li>
                
                <li><a href="#M000471">passenger_support_files_dir</a></li>
                
            </ul>
        </dd>
    
        <dt>R</dt>
        <dd>
            <ul>
                
                <li><a href="#M000446">require_app_finder</a>,</li>
                
                <li><a href="#M000442">require_file_utils</a>,</li>
                
                <li><a href="#M000441">run</a></li>
                
            </ul>
        </dd>
    
        <dt>S</dt>
        <dd>
            <ul>
                
                <li><a href="#M000461">sanity_check_options</a>,</li>
                
                <li><a href="#M000466">should_watch_logs?</a>,</li>
                
                <li><a href="#M000477">show_intro_message</a>,</li>
                
                <li><a href="#M000476">start_nginx</a>,</li>
                
                <li><a href="#M000485">stop_nginx</a>,</li>
                
                <li><a href="#M000486">stop_threads</a></li>
                
            </ul>
        </dd>
    
        <dt>W</dt>
        <dd>
            <ul>
                
                <li><a href="#M000479">wait_on_termination_pipe</a>,</li>
                
                <li><a href="#M000482">wait_until_nginx_has_exited</a>,</li>
                
                <li><a href="#M000480">watch_log_file</a>,</li>
                
                <li><a href="#M000481">watch_log_files_in_background</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    

    

    

    

    

    
            <div class="sectiontitle">Class Public methods</div>
            
            <div class="method">
                <div class="title" id="M000439">
                    
                    <a name="M000439"></a><b>description</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000439_source')" id="l_M000439_source">show</a>
                        
                    </p>
                    <div id="M000439_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/phusion_passenger/standalone/start_command.rb, line 42</span>
42:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">description</span>
43:     <span class="ruby-keyword kw">return</span> <span class="ruby-value str">&quot;Start Phusion Passenger Standalone.&quot;</span>
44:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000440">
                    
                    <a name="M000440"></a><b>new</b>(args)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000440_source')" id="l_M000440_source">show</a>
                        
                    </p>
                    <div id="M000440_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/phusion_passenger/standalone/start_command.rb, line 46</span>
46:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">args</span>)
47:     <span class="ruby-keyword kw">super</span>(<span class="ruby-identifier">args</span>)
48:     <span class="ruby-ivar">@console_mutex</span> = <span class="ruby-constant">Mutex</span>.<span class="ruby-identifier">new</span>
49:     <span class="ruby-ivar">@termination_pipe</span> = <span class="ruby-constant">IO</span>.<span class="ruby-identifier">pipe</span>
50:     <span class="ruby-ivar">@threads</span> = []
51:     <span class="ruby-ivar">@interruptable_threads</span> = []
52:     <span class="ruby-ivar">@plugin</span> = <span class="ruby-constant">PhusionPassenger</span><span class="ruby-operator">::</span><span class="ruby-constant">Plugin</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">'standalone/start_command'</span>, <span class="ruby-keyword kw">self</span>, <span class="ruby-ivar">@options</span>)
53:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M000441">
                    
                    <a name="M000441"></a><b>run</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000441_source')" id="l_M000441_source">show</a>
                        
                    </p>
                    <div id="M000441_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/phusion_passenger/standalone/start_command.rb, line 55</span>
 55:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">run</span>
 56:     <span class="ruby-identifier">parse_my_options</span>
 57:     <span class="ruby-identifier">sanity_check_options</span>
 58:     
 59:     <span class="ruby-identifier">ensure_nginx_installed</span>
 60:     <span class="ruby-identifier">determine_various_resource_locations</span>
 61:     <span class="ruby-identifier">require_app_finder</span>
 62:     <span class="ruby-ivar">@app_finder</span> = <span class="ruby-constant">AppFinder</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@args</span>, <span class="ruby-ivar">@options</span>)
 63:     <span class="ruby-ivar">@apps</span> = <span class="ruby-ivar">@app_finder</span>.<span class="ruby-identifier">scan</span>
 64:     <span class="ruby-ivar">@plugin</span>.<span class="ruby-identifier">call_hook</span>(<span class="ruby-identifier">:found_apps</span>, <span class="ruby-ivar">@apps</span>)
 65:     
 66:     <span class="ruby-identifier">extra_controller_options</span> = {}
 67:     <span class="ruby-ivar">@plugin</span>.<span class="ruby-identifier">call_hook</span>(<span class="ruby-identifier">:before_creating_nginx_controller</span>, <span class="ruby-identifier">extra_controller_options</span>)
 68:     <span class="ruby-identifier">create_nginx_controller</span>(<span class="ruby-identifier">extra_controller_options</span>)
 69:     
 70:     <span class="ruby-keyword kw">begin</span>
 71:       <span class="ruby-identifier">start_nginx</span>
 72:       <span class="ruby-identifier">show_intro_message</span>
 73:       <span class="ruby-identifier">daemonize</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:daemonize</span>]
 74:       <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">abort_on_exception</span> = <span class="ruby-keyword kw">true</span>
 75:       <span class="ruby-ivar">@plugin</span>.<span class="ruby-identifier">call_hook</span>(<span class="ruby-identifier">:nginx_started</span>, <span class="ruby-ivar">@nginx</span>)
 76:       <span class="ruby-comment cmt">########################</span>
 77:       <span class="ruby-comment cmt">########################</span>
 78:       <span class="ruby-identifier">watch_log_files_in_background</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">should_watch_logs?</span>
 79:       <span class="ruby-identifier">wait_until_nginx_has_exited</span>
 80:     <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Interrupt</span>
 81:       <span class="ruby-identifier">stop_threads</span>
 82:       <span class="ruby-identifier">stop_nginx</span>
 83:       <span class="ruby-identifier">exit</span> <span class="ruby-value">2</span>
 84:     <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">SignalException</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">signal</span>
 85:       <span class="ruby-identifier">stop_threads</span>
 86:       <span class="ruby-identifier">stop_nginx</span>
 87:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">signal</span>.<span class="ruby-identifier">message</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'SIGINT'</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">signal</span>.<span class="ruby-identifier">message</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'SIGTERM'</span>
 88:         <span class="ruby-identifier">exit</span> <span class="ruby-value">2</span>
 89:       <span class="ruby-keyword kw">else</span>
 90:         <span class="ruby-identifier">raise</span>
 91:       <span class="ruby-keyword kw">end</span>
 92:     <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
 93:       <span class="ruby-identifier">stop_threads</span>
 94:       <span class="ruby-identifier">stop_nginx</span>
 95:       <span class="ruby-identifier">raise</span>
 96:     <span class="ruby-keyword kw">ensure</span>
 97:       <span class="ruby-identifier">stop_threads</span>
 98:     <span class="ruby-keyword kw">end</span>
 99:   <span class="ruby-keyword kw">ensure</span>
100:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@temp_dir</span>
101:       <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm_rf</span>(<span class="ruby-ivar">@temp_dir</span>) <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
102:     <span class="ruby-keyword kw">end</span>
103:     <span class="ruby-ivar">@plugin</span>.<span class="ruby-identifier">call_hook</span>(<span class="ruby-identifier">:cleanup</span>)
104:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Private methods</div>
            
            <div class="method">
                <div class="title" id="M000464">
                    
                    <a name="M000464"></a><b>check_port_availability</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000464_source')" id="l_M000464_source">show</a>
                        
                    </p>
                    <div id="M000464_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/phusion_passenger/standalone/start_command.rb, line 246</span>
246:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">check_port_availability</span>
247:     <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:socket_file</span>]
248:       <span class="ruby-keyword kw">begin</span>
249:         <span class="ruby-constant">TCPSocket</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:address</span>], <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:port</span>]).<span class="ruby-identifier">close</span>
250:         <span class="ruby-identifier">port_taken</span> = <span class="ruby-keyword kw">true</span>
251:       <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">SystemCallError</span>
252:         <span class="ruby-identifier">port_taken</span> = <span class="ruby-keyword kw">false</span>
253:       <span class="ruby-keyword kw">end</span>
254:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">port_taken</span>
255:         <span class="ruby-identifier">error</span> <span class="ruby-node">&quot;The address #{@options[:address]}:#{@options[:port]} is already &quot;</span> <span class="ruby-operator">&lt;&lt;</span>
256:               <span class="ruby-value str">&quot;in use by another process, perhaps another Phusion Passenger &quot;</span> <span class="ruby-operator">&lt;&lt;</span>
257:               <span class="ruby-value str">&quot;Standalone instance.\n\n&quot;</span> <span class="ruby-operator">&lt;&lt;</span>
258:               <span class="ruby-value str">&quot;If you want to run this Phusion Passenger Standalone instance on &quot;</span> <span class="ruby-operator">&lt;&lt;</span>
259:               <span class="ruby-value str">&quot;another port, use the -p option, like this:\n\n&quot;</span> <span class="ruby-operator">&lt;&lt;</span>
260:               <span class="ruby-node">&quot;  passenger start -p #{@options[:port] + 1}&quot;</span>
261:         <span class="ruby-identifier">exit</span> <span class="ruby-value">1</span>
262:       <span class="ruby-keyword kw">end</span>
263:     <span class="ruby-keyword kw">end</span>
264:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000462">
                    
                    <a name="M000462"></a><b>check_port_bind_permission_and_display_sudo_suggestion</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Most platforms don&#8217;t allow non-root processes to bind to a port lower
than 1024. Check whether this is the case for the current platform and if
so, tell the user that it must re-run Phusion Passenger <a
href="../Standalone.html">Standalone</a> with sudo.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000462_source')" id="l_M000462_source">show</a>
                        
                    </p>
                    <div id="M000462_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/phusion_passenger/standalone/start_command.rb, line 225</span>
225:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">check_port_bind_permission_and_display_sudo_suggestion</span>
226:     <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:socket_file</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:port</span>] <span class="ruby-operator">&lt;</span> <span class="ruby-value">1024</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-constant">Process</span>.<span class="ruby-identifier">euid</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
227:       <span class="ruby-keyword kw">begin</span>
228:         <span class="ruby-constant">TCPServer</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">'127.0.0.1'</span>, <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:port</span>]).<span class="ruby-identifier">close</span>
229:       <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">EACCES</span>
230:         <span class="ruby-identifier">require</span> <span class="ruby-value str">'phusion_passenger/platform_info/ruby'</span>
231:         <span class="ruby-identifier">myself</span> = <span class="ruby-value">`whoami`</span>.<span class="ruby-identifier">strip</span>
232:         <span class="ruby-identifier">error</span> <span class="ruby-node">&quot;Only the 'root' user can run this program on port #{@options[:port]}. &quot;</span> <span class="ruby-operator">&lt;&lt;</span>
233:               <span class="ruby-node">&quot;You are currently running as '#{myself}'. Please re-run this program &quot;</span> <span class="ruby-operator">&lt;&lt;</span>
234:               <span class="ruby-value str">&quot;with root privileges with the following command:\n\n&quot;</span> <span class="ruby-operator">&lt;&lt;</span>
235:               
236:               <span class="ruby-node">&quot;  #{PlatformInfo.ruby_sudo_command} passenger start #{@original_args.join(' ')} --user=#{myself}\n\n&quot;</span> <span class="ruby-operator">&lt;&lt;</span>
237:               
238:               <span class="ruby-value str">&quot;Don't forget the '--user' part! That will make Phusion Passenger Standalone &quot;</span> <span class="ruby-operator">&lt;&lt;</span>
239:               <span class="ruby-node">&quot;drop root privileges and switch to '#{myself}' after it has obtained &quot;</span> <span class="ruby-operator">&lt;&lt;</span>
240:               <span class="ruby-node">&quot;port #{@options[:port]}.&quot;</span>
241:         <span class="ruby-identifier">exit</span> <span class="ruby-value">1</span>
242:       <span class="ruby-keyword kw">end</span>
243:     <span class="ruby-keyword kw">end</span>
244:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000478">
                    
                    <a name="M000478"></a><b>daemonize</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000478_source')" id="l_M000478_source">show</a>
                        
                    </p>
                    <div id="M000478_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/phusion_passenger/standalone/start_command.rb, line 370</span>
370:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">daemonize</span>
371:     <span class="ruby-identifier">pid</span> = <span class="ruby-identifier">fork</span>
372:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">pid</span>
373:       <span class="ruby-comment cmt"># Parent</span>
374:       <span class="ruby-identifier">exit!</span>(<span class="ruby-value">0</span>)
375:     <span class="ruby-keyword kw">else</span>
376:       <span class="ruby-comment cmt"># Child</span>
377:       <span class="ruby-identifier">trap</span> <span class="ruby-value str">&quot;HUP&quot;</span>, <span class="ruby-value str">&quot;IGNORE&quot;</span>
378:       <span class="ruby-constant">STDIN</span>.<span class="ruby-identifier">reopen</span>(<span class="ruby-value str">&quot;/dev/null&quot;</span>, <span class="ruby-value str">&quot;r&quot;</span>)
379:       <span class="ruby-constant">STDOUT</span>.<span class="ruby-identifier">reopen</span>(<span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:log_file</span>], <span class="ruby-value str">&quot;a&quot;</span>)
380:       <span class="ruby-constant">STDERR</span>.<span class="ruby-identifier">reopen</span>(<span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:log_file</span>], <span class="ruby-value str">&quot;a&quot;</span>)
381:       <span class="ruby-constant">STDOUT</span>.<span class="ruby-identifier">sync</span> = <span class="ruby-keyword kw">true</span>
382:       <span class="ruby-constant">STDERR</span>.<span class="ruby-identifier">sync</span> = <span class="ruby-keyword kw">true</span>
383:       <span class="ruby-constant">Process</span>.<span class="ruby-identifier">setsid</span>
384:     <span class="ruby-keyword kw">end</span>
385:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000488">
                    
                    <a name="M000488"></a><b>default_group_for</b>(username)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000488_source')" id="l_M000488_source">show</a>
                        
                    </p>
                    <div id="M000488_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/phusion_passenger/standalone/start_command.rb, line 502</span>
502:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">default_group_for</span>(<span class="ruby-identifier">username</span>)
503:     <span class="ruby-identifier">user</span> = <span class="ruby-constant">Etc</span>.<span class="ruby-identifier">getpwnam</span>(<span class="ruby-identifier">username</span>)
504:     <span class="ruby-identifier">group</span> = <span class="ruby-constant">Etc</span>.<span class="ruby-identifier">getgrgid</span>(<span class="ruby-identifier">user</span>.<span class="ruby-identifier">gid</span>)
505:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">group</span>.<span class="ruby-identifier">name</span>
506:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000475">
                    
                    <a name="M000475"></a><b>ensure_directory_exists</b>(dir)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000475_source')" id="l_M000475_source">show</a>
                        
                    </p>
                    <div id="M000475_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/phusion_passenger/standalone/start_command.rb, line 325</span>
325:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">ensure_directory_exists</span>(<span class="ruby-identifier">dir</span>)
326:     <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">dir</span>)
327:       <span class="ruby-identifier">require_file_utils</span>
328:       <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span>(<span class="ruby-identifier">dir</span>)
329:     <span class="ruby-keyword kw">end</span>
330:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000473">
                    
                    <a name="M000473"></a><b>ensure_nginx_installed</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000473_source')" id="l_M000473_source">show</a>
                        
                    </p>
                    <div id="M000473_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/phusion_passenger/standalone/start_command.rb, line 305</span>
305:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">ensure_nginx_installed</span>
306:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:nginx_bin</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:nginx_bin</span>])
307:       <span class="ruby-identifier">error</span> <span class="ruby-node">&quot;The given Nginx binary '#{@options[:nginx_bin]}' does not exist.&quot;</span>
308:       <span class="ruby-identifier">exit</span> <span class="ruby-value">1</span>
309:     <span class="ruby-keyword kw">end</span>
310:     
311:     <span class="ruby-identifier">home</span>           = <span class="ruby-constant">Etc</span>.<span class="ruby-identifier">getpwuid</span>.<span class="ruby-identifier">dir</span>
312:     <span class="ruby-ivar">@runtime_dir</span>   = <span class="ruby-node">&quot;#{GLOBAL_STANDALONE_RESOURCE_DIR}/#{runtime_version_string}&quot;</span>
313:     <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-node">&quot;#{nginx_dir}/sbin/nginx&quot;</span>)
314:       <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Process</span>.<span class="ruby-identifier">euid</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
315:         <span class="ruby-identifier">install_runtime</span>
316:       <span class="ruby-keyword kw">else</span>
317:         <span class="ruby-ivar">@runtime_dir</span> = <span class="ruby-node">&quot;#{home}/#{LOCAL_STANDALONE_RESOURCE_DIR}/#{runtime_version_string}&quot;</span>
318:         <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-node">&quot;#{nginx_dir}/sbin/nginx&quot;</span>)
319:           <span class="ruby-identifier">install_runtime</span>
320:         <span class="ruby-keyword kw">end</span>
321:       <span class="ruby-keyword kw">end</span>
322:     <span class="ruby-keyword kw">end</span>
323:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000469">
                    
                    <a name="M000469"></a><b>install_runtime</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000469_source')" id="l_M000469_source">show</a>
                        
                    </p>
                    <div id="M000469_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/phusion_passenger/standalone/start_command.rb, line 284</span>
284:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">install_runtime</span>
285:     <span class="ruby-identifier">require</span> <span class="ruby-value str">'phusion_passenger/standalone/runtime_installer'</span>
286:     <span class="ruby-identifier">installer</span> = <span class="ruby-constant">RuntimeInstaller</span>.<span class="ruby-identifier">new</span>(
287:       <span class="ruby-identifier">:source_root</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">SOURCE_ROOT</span>,
288:       <span class="ruby-identifier">:support_dir</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">passenger_support_files_dir</span>,
289:       <span class="ruby-identifier">:nginx_dir</span>   =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">nginx_dir</span>,
290:       <span class="ruby-identifier">:version</span>     =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:nginx_version</span>],
291:       <span class="ruby-identifier">:tarball</span>     =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:nginx_tarball</span>],
292:       <span class="ruby-identifier">:binaries_url_root</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:binaries_url_root</span>],
293:       <span class="ruby-identifier">:plugin</span>      =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@plugin</span>)
294:     <span class="ruby-identifier">installer</span>.<span class="ruby-identifier">start</span>
295:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000467">
                    
                    <a name="M000467"></a><b>listen_url</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Returns the URL that Nginx will be listening on.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000467_source')" id="l_M000467_source">show</a>
                        
                    </p>
                    <div id="M000467_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/phusion_passenger/standalone/start_command.rb, line 271</span>
271:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">listen_url</span>
272:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:socket_file</span>]
273:       <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:socket_file</span>]
274:     <span class="ruby-keyword kw">else</span>
275:       <span class="ruby-identifier">result</span> = <span class="ruby-node">&quot;http://#{@options[:address]}&quot;</span>
276:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:port</span>] <span class="ruby-operator">!=</span> <span class="ruby-value">80</span>
277:         <span class="ruby-identifier">result</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;:#{@options[:port]}&quot;</span>
278:       <span class="ruby-keyword kw">end</span>
279:       <span class="ruby-identifier">result</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;/&quot;</span>
280:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">result</span>
281:     <span class="ruby-keyword kw">end</span>
282:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000472">
                    
                    <a name="M000472"></a><b>nginx_dir</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000472_source')" id="l_M000472_source">show</a>
                        
                    </p>
                    <div id="M000472_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/phusion_passenger/standalone/start_command.rb, line 301</span>
301:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">nginx_dir</span>
302:     <span class="ruby-keyword kw">return</span> <span class="ruby-node">&quot;#{@runtime_dir}/nginx-#{@options[:nginx_version]}&quot;</span>
303:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000487">
                    
                    <a name="M000487"></a><b>nginx_listen_address</b>(options = @options, for_ping_port = false)
                    
                </div>
                
                <div class="description">
                  <p>
Config file template helpers ####
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000487_source')" id="l_M000487_source">show</a>
                        
                    </p>
                    <div id="M000487_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/phusion_passenger/standalone/start_command.rb, line 489</span>
489:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">nginx_listen_address</span>(<span class="ruby-identifier">options</span> = <span class="ruby-ivar">@options</span>, <span class="ruby-identifier">for_ping_port</span> = <span class="ruby-keyword kw">false</span>)
490:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:socket_file</span>]
491:       <span class="ruby-keyword kw">return</span> <span class="ruby-value str">&quot;unix:&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:socket_file</span>])
492:     <span class="ruby-keyword kw">else</span>
493:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">for_ping_port</span>
494:         <span class="ruby-identifier">port</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:ping_port</span>]
495:       <span class="ruby-keyword kw">else</span>
496:         <span class="ruby-identifier">port</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:port</span>]
497:       <span class="ruby-keyword kw">end</span>
498:       <span class="ruby-keyword kw">return</span> <span class="ruby-node">&quot;#{options[:address]}:#{port}&quot;</span>
499:     <span class="ruby-keyword kw">end</span>
500:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000447">
                    
                    <a name="M000447"></a><b>parse_my_options</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000447_source')" id="l_M000447_source">show</a>
                        
                    </p>
                    <div id="M000447_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/phusion_passenger/standalone/start_command.rb, line 115</span>
115:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">parse_my_options</span>
116:     <span class="ruby-identifier">description</span> = <span class="ruby-value str">&quot;Starts Phusion Passenger Standalone and serve one or more Ruby web applications.&quot;</span>
117:     <span class="ruby-identifier">parse_options!</span>(<span class="ruby-value str">&quot;start [directory]&quot;</span>, <span class="ruby-identifier">description</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">opts</span><span class="ruby-operator">|</span>
118:       <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">&quot;-a&quot;</span>, <span class="ruby-value str">&quot;--address HOST&quot;</span>, <span class="ruby-constant">String</span>,
119:         <span class="ruby-identifier">wrap_desc</span>(<span class="ruby-node">&quot;Bind to HOST address (default: #{@options[:address]})&quot;</span>)) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
120:         <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:address</span>] = <span class="ruby-identifier">value</span>
121:         <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:tcp_explicitly_given</span>] = <span class="ruby-keyword kw">true</span>
122:       <span class="ruby-keyword kw">end</span>
123:       <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">&quot;-p&quot;</span>, <span class="ruby-value str">&quot;--port NUMBER&quot;</span>, <span class="ruby-constant">Integer</span>,
124:         <span class="ruby-identifier">wrap_desc</span>(<span class="ruby-node">&quot;Use the given port number (default: #{@options[:port]})&quot;</span>)) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
125:         <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:port</span>] = <span class="ruby-identifier">value</span>
126:         <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:tcp_explicitly_given</span>] = <span class="ruby-keyword kw">true</span>
127:       <span class="ruby-keyword kw">end</span>
128:       <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">&quot;-S&quot;</span>, <span class="ruby-value str">&quot;--socket FILE&quot;</span>, <span class="ruby-constant">String</span>,
129:         <span class="ruby-identifier">wrap_desc</span>(<span class="ruby-value str">&quot;Bind to Unix domain socket instead of TCP socket&quot;</span>)) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
130:         <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:socket_file</span>] = <span class="ruby-identifier">value</span>
131:       <span class="ruby-keyword kw">end</span>
132:       
133:       <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">separator</span> <span class="ruby-value str">&quot;&quot;</span>
134:       <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">&quot;-e&quot;</span>, <span class="ruby-value str">&quot;--environment ENV&quot;</span>, <span class="ruby-constant">String</span>,
135:         <span class="ruby-identifier">wrap_desc</span>(<span class="ruby-node">&quot;Framework environment (default: #{@options[:env]})&quot;</span>)) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
136:         <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:env</span>] = <span class="ruby-identifier">value</span>
137:       <span class="ruby-keyword kw">end</span>
138:       <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">&quot;-R&quot;</span>, <span class="ruby-value str">&quot;--rackup FILE&quot;</span>, <span class="ruby-constant">String</span>,
139:         <span class="ruby-identifier">wrap_desc</span>(<span class="ruby-value str">&quot;If Rack application detected, run this rackup file&quot;</span>)) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
140:         <span class="ruby-constant">ENV</span>[<span class="ruby-value str">&quot;RACKUP_FILE&quot;</span>] = <span class="ruby-identifier">value</span>
141:       <span class="ruby-keyword kw">end</span>
142:       <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">&quot;--max-pool-size NUMBER&quot;</span>, <span class="ruby-constant">Integer</span>,
143:         <span class="ruby-identifier">wrap_desc</span>(<span class="ruby-node">&quot;Maximum number of application processes (default: #{@options[:max_pool_size]})&quot;</span>)) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
144:         <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:max_pool_size</span>] = <span class="ruby-identifier">value</span>
145:       <span class="ruby-keyword kw">end</span>
146:       <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">&quot;--min-instances NUMBER&quot;</span>, <span class="ruby-constant">Integer</span>,
147:         <span class="ruby-identifier">wrap_desc</span>(<span class="ruby-node">&quot;Minimum number of processes per application (default: #{@options[:min_instances]})&quot;</span>)) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
148:         <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:min_instances</span>] = <span class="ruby-identifier">value</span>
149:       <span class="ruby-keyword kw">end</span>
150:       <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">&quot;--spawn-method NAME&quot;</span>, <span class="ruby-constant">String</span>,
151:         <span class="ruby-identifier">wrap_desc</span>(<span class="ruby-node">&quot;The spawn method to use (default: #{@options[:spawn_method]})&quot;</span>)) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
152:         <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:spawn_method</span>] = <span class="ruby-identifier">value</span>
153:       <span class="ruby-keyword kw">end</span>
154:       <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">&quot;--union-station-gateway HOST:PORT&quot;</span>, <span class="ruby-constant">String</span>,
155:         <span class="ruby-identifier">wrap_desc</span>(<span class="ruby-value str">&quot;Specify Union Station Gateway host and port&quot;</span>)) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
156:         <span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span> = <span class="ruby-identifier">value</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;:&quot;</span>, <span class="ruby-value">2</span>)
157:         <span class="ruby-identifier">port</span> = <span class="ruby-identifier">port</span>.<span class="ruby-identifier">to_i</span>
158:         <span class="ruby-identifier">port</span> = <span class="ruby-value">443</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">port</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
159:         <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:union_station_gateway_address</span>] = <span class="ruby-identifier">host</span>
160:         <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:union_station_gateway_port</span>] = <span class="ruby-identifier">port</span>.<span class="ruby-identifier">to_i</span>
161:       <span class="ruby-keyword kw">end</span>
162:       <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">&quot;--union-station-key KEY&quot;</span>, <span class="ruby-constant">String</span>,
163:         <span class="ruby-identifier">wrap_desc</span>(<span class="ruby-value str">&quot;Specify Union Station key&quot;</span>)) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
164:         <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:union_station_key</span>] = <span class="ruby-identifier">value</span>
165:       <span class="ruby-keyword kw">end</span>
166:       
167:       <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">separator</span> <span class="ruby-value str">&quot;&quot;</span>
168:       <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">&quot;--ping-port NUMBER&quot;</span>, <span class="ruby-constant">Integer</span>,
169:         <span class="ruby-identifier">wrap_desc</span>(<span class="ruby-value str">&quot;Use the given port number for checking whether Nginx is alive (default: same as the normal port)&quot;</span>)) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
170:         <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:ping_port</span>] = <span class="ruby-identifier">value</span>
171:       <span class="ruby-keyword kw">end</span>
172:       <span class="ruby-ivar">@plugin</span>.<span class="ruby-identifier">call_hook</span>(<span class="ruby-identifier">:parse_options</span>, <span class="ruby-identifier">opts</span>)
173:       
174:       <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">separator</span> <span class="ruby-value str">&quot;&quot;</span>
175:       <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">&quot;-d&quot;</span>, <span class="ruby-value str">&quot;--daemonize&quot;</span>,
176:         <span class="ruby-identifier">wrap_desc</span>(<span class="ruby-value str">&quot;Daemonize into the background&quot;</span>)) <span class="ruby-keyword kw">do</span>
177:         <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:daemonize</span>] = <span class="ruby-keyword kw">true</span>
178:       <span class="ruby-keyword kw">end</span>
179:       <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">&quot;--user USERNAME&quot;</span>, <span class="ruby-constant">String</span>,
180:         <span class="ruby-identifier">wrap_desc</span>(<span class="ruby-value str">&quot;User to run as. Ignored unless running as root.&quot;</span>)) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
181:         <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:user</span>] = <span class="ruby-identifier">value</span>
182:       <span class="ruby-keyword kw">end</span>
183:       <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">&quot;--log-file FILENAME&quot;</span>, <span class="ruby-constant">String</span>,
184:         <span class="ruby-identifier">wrap_desc</span>(<span class="ruby-value str">&quot;Where to write log messages (default: console, or /dev/null when daemonized)&quot;</span>)) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
185:         <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:log_file</span>] = <span class="ruby-identifier">value</span>
186:       <span class="ruby-keyword kw">end</span>
187:       <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">&quot;--pid-file FILENAME&quot;</span>, <span class="ruby-constant">String</span>,
188:         <span class="ruby-identifier">wrap_desc</span>(<span class="ruby-value str">&quot;Where to store the PID file&quot;</span>)) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
189:         <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:pid_file</span>] = <span class="ruby-identifier">value</span>
190:       <span class="ruby-keyword kw">end</span>
191:       <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">&quot;--nginx-bin FILENAME&quot;</span>, <span class="ruby-constant">String</span>,
192:         <span class="ruby-identifier">wrap_desc</span>(<span class="ruby-value str">&quot;Nginx binary to use as core&quot;</span>)) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
193:         <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:nginx_bin</span>] = <span class="ruby-identifier">value</span>
194:       <span class="ruby-keyword kw">end</span>
195:       <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">&quot;--nginx-version VERSION&quot;</span>, <span class="ruby-constant">String</span>,
196:         <span class="ruby-identifier">wrap_desc</span>(<span class="ruby-node">&quot;Nginx version to use as core (default: #{@options[:nginx_version]})&quot;</span>)) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
197:         <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:nginx_version</span>] = <span class="ruby-identifier">value</span>
198:       <span class="ruby-keyword kw">end</span>
199:       <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">&quot;--nginx-tarball FILENAME&quot;</span>, <span class="ruby-constant">String</span>,
200:         <span class="ruby-identifier">wrap_desc</span>(<span class="ruby-value str">&quot;If Nginx needs to be installed, then the given tarball will &quot;</span> <span class="ruby-operator">+</span>
201:                   <span class="ruby-value str">&quot;be used instead of downloading from the Internet&quot;</span>)) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
202:         <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:nginx_tarball</span>] = <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">value</span>)
203:       <span class="ruby-keyword kw">end</span>
204:       <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">&quot;--binaries-url-root URL&quot;</span>, <span class="ruby-constant">String</span>,
205:         <span class="ruby-identifier">wrap_desc</span>(<span class="ruby-value str">&quot;If Nginx needs to be installed, then the specified URL will be &quot;</span> <span class="ruby-operator">+</span>
206:                   <span class="ruby-value str">&quot;checked for binaries prior to a local build.&quot;</span>)) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
207:         <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:binaries_url_root</span>] = <span class="ruby-identifier">value</span>
208:       <span class="ruby-keyword kw">end</span>
209:     <span class="ruby-keyword kw">end</span>
210:     <span class="ruby-ivar">@plugin</span>.<span class="ruby-identifier">call_hook</span>(<span class="ruby-identifier">:done_parsing_options</span>)
211:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000471">
                    
                    <a name="M000471"></a><b>passenger_support_files_dir</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000471_source')" id="l_M000471_source">show</a>
                        
                    </p>
                    <div id="M000471_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/phusion_passenger/standalone/start_command.rb, line 297</span>
297:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">passenger_support_files_dir</span>
298:     <span class="ruby-keyword kw">return</span> <span class="ruby-node">&quot;#{@runtime_dir}/support&quot;</span>
299:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000446">
                    
                    <a name="M000446"></a><b>require_app_finder</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000446_source')" id="l_M000446_source">show</a>
                        
                    </p>
                    <div id="M000446_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/phusion_passenger/standalone/start_command.rb, line 111</span>
111:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">require_app_finder</span>
112:     <span class="ruby-identifier">require</span> <span class="ruby-value str">'phusion_passenger/standalone/app_finder'</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-keyword kw">defined?</span>(<span class="ruby-constant">AppFinder</span>)
113:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000442">
                    
                    <a name="M000442"></a><b>require_file_utils</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000442_source')" id="l_M000442_source">show</a>
                        
                    </p>
                    <div id="M000442_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/phusion_passenger/standalone/start_command.rb, line 107</span>
107:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">require_file_utils</span>
108:     <span class="ruby-identifier">require</span> <span class="ruby-value str">'fileutils'</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-keyword kw">defined?</span>(<span class="ruby-constant">FileUtils</span>)
109:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000461">
                    
                    <a name="M000461"></a><b>sanity_check_options</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000461_source')" id="l_M000461_source">show</a>
                        
                    </p>
                    <div id="M000461_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/phusion_passenger/standalone/start_command.rb, line 213</span>
213:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sanity_check_options</span>
214:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:tcp_explicitly_given</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:socket_file</span>]
215:       <span class="ruby-identifier">error</span> <span class="ruby-value str">&quot;You cannot specify both --address/--port and --socket. Please choose either one.&quot;</span>
216:       <span class="ruby-identifier">exit</span> <span class="ruby-value">1</span>
217:     <span class="ruby-keyword kw">end</span>
218:     <span class="ruby-identifier">check_port_bind_permission_and_display_sudo_suggestion</span>
219:     <span class="ruby-identifier">check_port_availability</span>
220:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000466">
                    
                    <a name="M000466"></a><b>should_watch_logs?</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000466_source')" id="l_M000466_source">show</a>
                        
                    </p>
                    <div id="M000466_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/phusion_passenger/standalone/start_command.rb, line 266</span>
266:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">should_watch_logs?</span>
267:     <span class="ruby-keyword kw">return</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:daemonize</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:log_file</span>] <span class="ruby-operator">!=</span> <span class="ruby-value str">&quot;/dev/null&quot;</span>
268:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000477">
                    
                    <a name="M000477"></a><b>show_intro_message</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000477_source')" id="l_M000477_source">show</a>
                        
                    </p>
                    <div id="M000477_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/phusion_passenger/standalone/start_command.rb, line 353</span>
353:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">show_intro_message</span>
354:     <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;=============== Phusion Passenger Standalone web server started ===============&quot;</span>
355:     <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;PID file: #{@options[:pid_file]}&quot;</span>
356:     <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Log file: #{@options[:log_file]}&quot;</span>
357:     <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Environment: #{@options[:env]}&quot;</span>
358:     
359:     <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Accessible via: #{listen_url}&quot;</span>
360:     
361:     <span class="ruby-identifier">puts</span>
362:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:daemonize</span>]
363:       <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;Serving in the background as a daemon.&quot;</span>
364:     <span class="ruby-keyword kw">else</span>
365:       <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;You can stop Phusion Passenger Standalone by pressing Ctrl-C.&quot;</span>
366:     <span class="ruby-keyword kw">end</span>
367:     <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;===============================================================================&quot;</span>
368:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000476">
                    
                    <a name="M000476"></a><b>start_nginx</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000476_source')" id="l_M000476_source">show</a>
                        
                    </p>
                    <div id="M000476_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/phusion_passenger/standalone/start_command.rb, line 332</span>
332:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">start_nginx</span>
333:     <span class="ruby-keyword kw">begin</span>
334:       <span class="ruby-ivar">@nginx</span>.<span class="ruby-identifier">start</span>
335:     <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">DaemonController</span><span class="ruby-operator">::</span><span class="ruby-constant">AlreadyStarted</span>
336:       <span class="ruby-keyword kw">begin</span>
337:         <span class="ruby-identifier">pid</span> = <span class="ruby-ivar">@nginx</span>.<span class="ruby-identifier">pid</span>
338:       <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">SystemCallError</span>, <span class="ruby-constant">IOError</span>
339:         <span class="ruby-identifier">pid</span> = <span class="ruby-keyword kw">nil</span>
340:       <span class="ruby-keyword kw">end</span>
341:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">pid</span>
342:         <span class="ruby-identifier">error</span> <span class="ruby-node">&quot;Phusion Passenger Standalone is already running on PID #{pid}.&quot;</span>
343:       <span class="ruby-keyword kw">else</span>
344:         <span class="ruby-identifier">error</span> <span class="ruby-value str">&quot;Phusion Passenger Standalone is already running.&quot;</span>
345:       <span class="ruby-keyword kw">end</span>
346:       <span class="ruby-identifier">exit</span> <span class="ruby-value">1</span>
347:     <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">DaemonController</span><span class="ruby-operator">::</span><span class="ruby-constant">StartError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
348:       <span class="ruby-identifier">error</span> <span class="ruby-node">&quot;Could not start Passenger Nginx core:\n#{e}&quot;</span>
349:       <span class="ruby-identifier">exit</span> <span class="ruby-value">1</span>
350:     <span class="ruby-keyword kw">end</span>
351:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000485">
                    
                    <a name="M000485"></a><b>stop_nginx</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000485_source')" id="l_M000485_source">show</a>
                        
                    </p>
                    <div id="M000485_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/phusion_passenger/standalone/start_command.rb, line 462</span>
462:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">stop_nginx</span>
463:     <span class="ruby-ivar">@console_mutex</span>.<span class="ruby-identifier">synchronize</span> <span class="ruby-keyword kw">do</span>
464:       <span class="ruby-constant">STDOUT</span>.<span class="ruby-identifier">write</span>(<span class="ruby-value str">&quot;Stopping web server...&quot;</span>)
465:       <span class="ruby-constant">STDOUT</span>.<span class="ruby-identifier">flush</span>
466:       <span class="ruby-ivar">@nginx</span>.<span class="ruby-identifier">stop</span>
467:       <span class="ruby-constant">STDOUT</span>.<span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot; done&quot;</span>
468:       <span class="ruby-constant">STDOUT</span>.<span class="ruby-identifier">flush</span>
469:     <span class="ruby-keyword kw">end</span>
470:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000486">
                    
                    <a name="M000486"></a><b>stop_threads</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000486_source')" id="l_M000486_source">show</a>
                        
                    </p>
                    <div id="M000486_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/phusion_passenger/standalone/start_command.rb, line 472</span>
472:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">stop_threads</span>
473:     <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@termination_pipe</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">closed?</span>
474:       <span class="ruby-ivar">@termination_pipe</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">write</span>(<span class="ruby-value str">&quot;x&quot;</span>)
475:       <span class="ruby-ivar">@termination_pipe</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">close</span>
476:     <span class="ruby-keyword kw">end</span>
477:     <span class="ruby-ivar">@interruptable_threads</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">thread</span><span class="ruby-operator">|</span>
478:       <span class="ruby-identifier">thread</span>.<span class="ruby-identifier">terminate</span>
479:     <span class="ruby-keyword kw">end</span>
480:     <span class="ruby-ivar">@interruptable_threads</span> = []
481:     <span class="ruby-ivar">@threads</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">thread</span><span class="ruby-operator">|</span>
482:       <span class="ruby-identifier">thread</span>.<span class="ruby-identifier">join</span>
483:     <span class="ruby-keyword kw">end</span>
484:     <span class="ruby-ivar">@threads</span> = []
485:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000479">
                    
                    <a name="M000479"></a><b>wait_on_termination_pipe</b>(timeout)
                    
                </div>
                
                <div class="description">
                  <p>
Wait until the termination pipe becomes readable (a hint for threads to
shut down), or until the timeout has been reached. Returns true if the
termination pipe became readable, false if the timeout has been reached.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000479_source')" id="l_M000479_source">show</a>
                        
                    </p>
                    <div id="M000479_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/phusion_passenger/standalone/start_command.rb, line 390</span>
390:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">wait_on_termination_pipe</span>(<span class="ruby-identifier">timeout</span>)
391:     <span class="ruby-identifier">ios</span> = <span class="ruby-identifier">select</span>([<span class="ruby-ivar">@termination_pipe</span>[<span class="ruby-value">0</span>]], <span class="ruby-keyword kw">nil</span>, <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">timeout</span>)
392:     <span class="ruby-keyword kw">return</span> <span class="ruby-operator">!</span><span class="ruby-identifier">ios</span>.<span class="ruby-identifier">nil?</span>
393:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000482">
                    
                    <a name="M000482"></a><b>wait_until_nginx_has_exited</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000482_source')" id="l_M000482_source">show</a>
                        
                    </p>
                    <div id="M000482_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/phusion_passenger/standalone/start_command.rb, line 440</span>
440:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">wait_until_nginx_has_exited</span>
441:     <span class="ruby-comment cmt"># Since Nginx is not our child process (it daemonizes or we daemonize)</span>
442:     <span class="ruby-comment cmt"># we cannot use Process.waitpid to wait for it. A busy-sleep-loop with</span>
443:     <span class="ruby-comment cmt"># Process.kill(0, pid) isn't very efficient. Instead we do this:</span>
444:     <span class="ruby-comment cmt">#</span>
445:     <span class="ruby-comment cmt"># Connect to Nginx and wait until Nginx disconnects the socket because of</span>
446:     <span class="ruby-comment cmt"># timeout. Keep doing this until we can no longer connect.</span>
447:     <span class="ruby-keyword kw">while</span> <span class="ruby-keyword kw">true</span>
448:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:socket_file</span>]
449:         <span class="ruby-identifier">socket</span> = <span class="ruby-constant">UNIXSocket</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:socket_file</span>])
450:       <span class="ruby-keyword kw">else</span>
451:         <span class="ruby-identifier">socket</span> = <span class="ruby-constant">TCPSocket</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:address</span>], <span class="ruby-identifier">nginx_ping_port</span>)
452:       <span class="ruby-keyword kw">end</span>
453:       <span class="ruby-keyword kw">begin</span>
454:         <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">read</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
455:       <span class="ruby-keyword kw">ensure</span>
456:         <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">close</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
457:       <span class="ruby-keyword kw">end</span>
458:     <span class="ruby-keyword kw">end</span>
459:   <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">ECONNREFUSED</span>, <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">ECONNRESET</span>
460:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000480">
                    
                    <a name="M000480"></a><b>watch_log_file</b>(log_file)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000480_source')" id="l_M000480_source">show</a>
                        
                    </p>
                    <div id="M000480_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/phusion_passenger/standalone/start_command.rb, line 395</span>
395:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">watch_log_file</span>(<span class="ruby-identifier">log_file</span>)
396:     <span class="ruby-keyword kw">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">log_file</span>)
397:       <span class="ruby-identifier">backward</span> = <span class="ruby-value">0</span>
398:     <span class="ruby-keyword kw">else</span>
399:       <span class="ruby-comment cmt"># tail bails out if the file doesn't exist, so wait until it exists.</span>
400:       <span class="ruby-keyword kw">while</span> <span class="ruby-operator">!</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">log_file</span>)
401:         <span class="ruby-identifier">sleep</span> <span class="ruby-value">1</span>
402:       <span class="ruby-keyword kw">end</span>
403:       <span class="ruby-identifier">backward</span> = <span class="ruby-value">10</span>
404:     <span class="ruby-keyword kw">end</span>
405:     
406:     <span class="ruby-constant">IO</span>.<span class="ruby-identifier">popen</span>(<span class="ruby-node">&quot;tail -f -n #{backward} \&quot;#{log_file}\&quot;&quot;</span>, <span class="ruby-value str">&quot;rb&quot;</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span>
407:       <span class="ruby-keyword kw">begin</span>
408:         <span class="ruby-keyword kw">while</span> <span class="ruby-keyword kw">true</span>
409:           <span class="ruby-keyword kw">begin</span>
410:             <span class="ruby-identifier">line</span> = <span class="ruby-identifier">f</span>.<span class="ruby-identifier">readline</span>
411:             <span class="ruby-ivar">@console_mutex</span>.<span class="ruby-identifier">synchronize</span> <span class="ruby-keyword kw">do</span>
412:               <span class="ruby-constant">STDOUT</span>.<span class="ruby-identifier">write</span>(<span class="ruby-identifier">line</span>)
413:               <span class="ruby-constant">STDOUT</span>.<span class="ruby-identifier">flush</span>
414:             <span class="ruby-keyword kw">end</span>
415:           <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">EOFError</span>
416:             <span class="ruby-keyword kw">break</span>
417:           <span class="ruby-keyword kw">end</span>
418:         <span class="ruby-keyword kw">end</span>
419:       <span class="ruby-keyword kw">ensure</span>
420:         <span class="ruby-constant">Process</span>.<span class="ruby-identifier">kill</span>(<span class="ruby-value str">'TERM'</span>, <span class="ruby-identifier">f</span>.<span class="ruby-identifier">pid</span>)
421:       <span class="ruby-keyword kw">end</span>
422:     <span class="ruby-keyword kw">end</span>
423:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000481">
                    
                    <a name="M000481"></a><b>watch_log_files_in_background</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000481_source')" id="l_M000481_source">show</a>
                        
                    </p>
                    <div id="M000481_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/phusion_passenger/standalone/start_command.rb, line 425</span>
425:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">watch_log_files_in_background</span>
426:     <span class="ruby-ivar">@apps</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">app</span><span class="ruby-operator">|</span>
427:       <span class="ruby-identifier">thread</span> = <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword kw">do</span>
428:         <span class="ruby-identifier">watch_log_file</span>(<span class="ruby-node">&quot;#{app[:root]}/log/#{@options[:env]}.log&quot;</span>)
429:       <span class="ruby-keyword kw">end</span>
430:       <span class="ruby-ivar">@threads</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">thread</span>
431:       <span class="ruby-ivar">@interruptable_threads</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">thread</span>
432:     <span class="ruby-keyword kw">end</span>
433:     <span class="ruby-identifier">thread</span> = <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword kw">do</span>
434:       <span class="ruby-identifier">watch_log_file</span>(<span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:log_file</span>])
435:     <span class="ruby-keyword kw">end</span>
436:     <span class="ruby-ivar">@threads</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">thread</span>
437:     <span class="ruby-ivar">@interruptable_threads</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">thread</span>
438:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    