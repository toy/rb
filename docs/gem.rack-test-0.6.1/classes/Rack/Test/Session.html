<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>Rack::Test::Session</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../../css/main.css" type="text/css" media="screen" />
    <script src="../../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Class</span> 
            Rack::Test::Session 
            
                <span class="parent">&lt; 
                    
                    Object
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../../files/lib/rack/test_rb.html">lib/rack/test.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    
    <div class="description">
        <p>
This class represents a series of requests issued to a <a
href="../../Rack.html">Rack</a> app, sharing a single cookie jar
</p>
<p>
Rack::Test::Session&#8217;s methods are most often called through <a
href="Methods.html">Rack::Test::Methods</a>, which will automatically build
a session when it&#8217;s first used.
</p>

    </div>
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>A</dt>
        <dd>
            <ul>
                
                <li><a href="#M000022">authorize</a></li>
                
            </ul>
        </dd>
    
        <dt>B</dt>
        <dd>
            <ul>
                
                <li><a href="#M000021">basic_authorize</a></li>
                
            </ul>
        </dd>
    
        <dt>D</dt>
        <dd>
            <ul>
                
                <li><a href="#M000030">default_env</a>,</li>
                
                <li><a href="#M000016">delete</a>,</li>
                
                <li><a href="#M000029">digest_auth_configured?</a>,</li>
                
                <li><a href="#M000027">digest_auth_header</a>,</li>
                
                <li><a href="#M000023">digest_authorize</a></li>
                
            </ul>
        </dd>
    
        <dt>E</dt>
        <dd>
            <ul>
                
                <li><a href="#M000025">env_for</a></li>
                
            </ul>
        </dd>
    
        <dt>F</dt>
        <dd>
            <ul>
                
                <li><a href="#M000024">follow_redirect!</a></li>
                
            </ul>
        </dd>
    
        <dt>G</dt>
        <dd>
            <ul>
                
                <li><a href="#M000013">get</a></li>
                
            </ul>
        </dd>
    
        <dt>H</dt>
        <dd>
            <ul>
                
                <li><a href="#M000018">head</a>,</li>
                
                <li><a href="#M000020">header</a>,</li>
                
                <li><a href="#M000031">headers_for_env</a></li>
                
            </ul>
        </dd>
    
        <dt>N</dt>
        <dd>
            <ul>
                
                <li><a href="#M000012">new</a></li>
                
            </ul>
        </dd>
    
        <dt>O</dt>
        <dd>
            <ul>
                
                <li><a href="#M000017">options</a></li>
                
            </ul>
        </dd>
    
        <dt>P</dt>
        <dd>
            <ul>
                
                <li><a href="#M000032">params_to_string</a>,</li>
                
                <li><a href="#M000014">post</a>,</li>
                
                <li><a href="#M000026">process_request</a>,</li>
                
                <li><a href="#M000015">put</a></li>
                
            </ul>
        </dd>
    
        <dt>R</dt>
        <dd>
            <ul>
                
                <li><a href="#M000019">request</a>,</li>
                
                <li><a href="#M000028">retry_with_digest_auth?</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    
    <div class="sectiontitle">Included Modules</div>
    <ul>
        
        <li>
            
            <a href="Utils.html">Rack::Test::Utils</a>
            
            START:includes
        </li>
        
    </ul>
    

    

    

    

    

    
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M000022">
                    
                    <a name="M000022"></a><b>authorize</b>(username, password)
                    
                </div>
                
                <div class="description">
                  <p>
Alias for <a href="Session.html#M000021">basic_authorize</a>
</p>

                </div>
                
                
                
            </div>
            
            <div class="method">
                <div class="title" id="M000021">
                    
                    <a name="M000021"></a><b>basic_authorize</b>(username, password)
                    
                </div>
                
                <div class="description">
                  <p>
Set the username and password for HTTP Basic authorization, to be included
in subsequent requests in the HTTP_AUTHORIZATION header.
</p>
<p>
Example:
</p>
<pre>
  basic_authorize &quot;bryan&quot;, &quot;secret&quot;
</pre>

                </div>
                
                
                <div class="aka">
                    This method is also aliased as
                    
                    <a href="Session.html#M000022">authorize</a>
                    
                </div>
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000021_source')" id="l_M000021_source">show</a>
                        
                    </p>
                    <div id="M000021_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rack/test.rb, line 138</span>
138:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">basic_authorize</span>(<span class="ruby-identifier">username</span>, <span class="ruby-identifier">password</span>)
139:         <span class="ruby-identifier">encoded_login</span> = [<span class="ruby-node">&quot;#{username}:#{password}&quot;</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">&quot;m*&quot;</span>)
140:         <span class="ruby-identifier">header</span>(<span class="ruby-value str">'Authorization'</span>, <span class="ruby-node">&quot;Basic #{encoded_login}&quot;</span>)
141:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000016">
                    
                    <a name="M000016"></a><b>delete</b>(uri, params = {}, env = {}, &amp;block)
                    
                </div>
                
                <div class="description">
                  <p>
Issue a DELETE request for the given URI. See <a
href="Session.html#M000013">get</a>
</p>
<p>
Example:
</p>
<pre>
  delete &quot;/&quot;
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000016_source')" id="l_M000016_source">show</a>
                        
                    </p>
                    <div id="M000016_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/rack/test.rb, line 82</span>
82:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">delete</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">params</span> = {}, <span class="ruby-identifier">env</span> = {}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
83:         <span class="ruby-identifier">env</span> = <span class="ruby-identifier">env_for</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">env</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">:method</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;DELETE&quot;</span>, <span class="ruby-identifier">:params</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>))
84:         <span class="ruby-identifier">process_request</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">env</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
85:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000023">
                    
                    <a name="M000023"></a><b>digest_authorize</b>(username, password)
                    
                </div>
                
                <div class="description">
                  <p>
Set the username and password for HTTP Digest authorization, to be included
in subsequent requests in the HTTP_AUTHORIZATION header.
</p>
<p>
Example:
</p>
<pre>
  digest_authorize &quot;bryan&quot;, &quot;secret&quot;
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000023_source')" id="l_M000023_source">show</a>
                        
                    </p>
                    <div id="M000023_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rack/test.rb, line 150</span>
150:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">digest_authorize</span>(<span class="ruby-identifier">username</span>, <span class="ruby-identifier">password</span>)
151:         <span class="ruby-ivar">@digest_username</span> = <span class="ruby-identifier">username</span>
152:         <span class="ruby-ivar">@digest_password</span> = <span class="ruby-identifier">password</span>
153:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000024">
                    
                    <a name="M000024"></a><b>follow_redirect!</b>()
                    
                </div>
                
                <div class="description">
                  <p>
<a href="../Test.html">Rack::Test</a> will not follow any redirects
automatically. This method will follow the redirect returned (including
setting the Referer header on the new request) in the last response. If the
last response was not a redirect, an error will be raised.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000024_source')" id="l_M000024_source">show</a>
                        
                    </p>
                    <div id="M000024_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rack/test.rb, line 159</span>
159:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">follow_redirect!</span>
160:         <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">last_response</span>.<span class="ruby-identifier">redirect?</span>
161:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;Last response was not a redirect. Cannot follow_redirect!&quot;</span>)
162:         <span class="ruby-keyword kw">end</span>
163: 
164:         <span class="ruby-identifier">get</span>(<span class="ruby-identifier">last_response</span>[<span class="ruby-value str">&quot;Location&quot;</span>], {}, { <span class="ruby-value str">&quot;HTTP_REFERER&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">last_request</span>.<span class="ruby-identifier">url</span> })
165:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000013">
                    
                    <a name="M000013"></a><b>get</b>(uri, params = {}, env = {}, &amp;block)
                    
                </div>
                
                <div class="description">
                  <p>
Issue a GET request for the given URI with the given params and <a
href="../../Rack.html">Rack</a> environment. Stores the issues request
object in last_request and the app&#8217;s response in last_response. Yield
last_response to a block if given.
</p>
<p>
Example:
</p>
<pre>
  get &quot;/&quot;
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000013_source')" id="l_M000013_source">show</a>
                        
                    </p>
                    <div id="M000013_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/rack/test.rb, line 55</span>
55:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">params</span> = {}, <span class="ruby-identifier">env</span> = {}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
56:         <span class="ruby-identifier">env</span> = <span class="ruby-identifier">env_for</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">env</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">:method</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;GET&quot;</span>, <span class="ruby-identifier">:params</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>))
57:         <span class="ruby-identifier">process_request</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">env</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
58:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000018">
                    
                    <a name="M000018"></a><b>head</b>(uri, params = {}, env = {}, &amp;block)
                    
                </div>
                
                <div class="description">
                  <p>
Issue a HEAD request for the given URI. See <a
href="Session.html#M000013">get</a>
</p>
<p>
Example:
</p>
<pre>
  head &quot;/&quot;
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000018_source')" id="l_M000018_source">show</a>
                        
                    </p>
                    <div id="M000018_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rack/test.rb, line 100</span>
100:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">head</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">params</span> = {}, <span class="ruby-identifier">env</span> = {}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
101:         <span class="ruby-identifier">env</span> = <span class="ruby-identifier">env_for</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">env</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">:method</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;HEAD&quot;</span>, <span class="ruby-identifier">:params</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>))
102:         <span class="ruby-identifier">process_request</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">env</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
103:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000020">
                    
                    <a name="M000020"></a><b>header</b>(name, value)
                    
                </div>
                
                <div class="description">
                  <p>
Set a header to be included on all subsequent requests through the session.
Use a value of nil to remove a previously configured header.
</p>
<p>
In accordance with the <a href="../../Rack.html">Rack</a> spec, headers
will be included in the <a href="../../Rack.html">Rack</a> environment hash
in HTTP_USER_AGENT form.
</p>
<p>
Example:
</p>
<pre>
  header &quot;User-Agent&quot;, &quot;Firefox&quot;
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000020_source')" id="l_M000020_source">show</a>
                        
                    </p>
                    <div id="M000020_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rack/test.rb, line 125</span>
125:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">header</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">value</span>)
126:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">nil?</span>
127:           <span class="ruby-ivar">@headers</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">name</span>)
128:         <span class="ruby-keyword kw">else</span>
129:           <span class="ruby-ivar">@headers</span>[<span class="ruby-identifier">name</span>] = <span class="ruby-identifier">value</span>
130:         <span class="ruby-keyword kw">end</span>
131:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000017">
                    
                    <a name="M000017"></a><b>options</b>(uri, params = {}, env = {}, &amp;block)
                    
                </div>
                
                <div class="description">
                  <p>
Issue an OPTIONS request for the given URI. See <a
href="Session.html#M000013">get</a>
</p>
<p>
Example:
</p>
<pre>
  options &quot;/&quot;
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000017_source')" id="l_M000017_source">show</a>
                        
                    </p>
                    <div id="M000017_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/rack/test.rb, line 91</span>
91:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">options</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">params</span> = {}, <span class="ruby-identifier">env</span> = {}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
92:         <span class="ruby-identifier">env</span> = <span class="ruby-identifier">env_for</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">env</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">:method</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;OPTIONS&quot;</span>, <span class="ruby-identifier">:params</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>))
93:         <span class="ruby-identifier">process_request</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">env</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
94:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000014">
                    
                    <a name="M000014"></a><b>post</b>(uri, params = {}, env = {}, &amp;block)
                    
                </div>
                
                <div class="description">
                  <p>
Issue a POST request for the given URI. See <a
href="Session.html#M000013">get</a>
</p>
<p>
Example:
</p>
<pre>
  post &quot;/signup&quot;, &quot;name&quot; =&gt; &quot;Bryan&quot;
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000014_source')" id="l_M000014_source">show</a>
                        
                    </p>
                    <div id="M000014_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/rack/test.rb, line 64</span>
64:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">post</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">params</span> = {}, <span class="ruby-identifier">env</span> = {}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
65:         <span class="ruby-identifier">env</span> = <span class="ruby-identifier">env_for</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">env</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">:method</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;POST&quot;</span>, <span class="ruby-identifier">:params</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>))
66:         <span class="ruby-identifier">process_request</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">env</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
67:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000015">
                    
                    <a name="M000015"></a><b>put</b>(uri, params = {}, env = {}, &amp;block)
                    
                </div>
                
                <div class="description">
                  <p>
Issue a PUT request for the given URI. See <a
href="Session.html#M000013">get</a>
</p>
<p>
Example:
</p>
<pre>
  put &quot;/&quot;
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000015_source')" id="l_M000015_source">show</a>
                        
                    </p>
                    <div id="M000015_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/rack/test.rb, line 73</span>
73:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">put</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">params</span> = {}, <span class="ruby-identifier">env</span> = {}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
74:         <span class="ruby-identifier">env</span> = <span class="ruby-identifier">env_for</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">env</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">:method</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;PUT&quot;</span>, <span class="ruby-identifier">:params</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>))
75:         <span class="ruby-identifier">process_request</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">env</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
76:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000019">
                    
                    <a name="M000019"></a><b>request</b>(uri, env = {}, &amp;block)
                    
                </div>
                
                <div class="description">
                  <p>
Issue a request to the <a href="../../Rack.html">Rack</a> app for the given
URI and optional <a href="../../Rack.html">Rack</a> environment. Stores the
issues request object in last_request and the app&#8217;s response in
last_response. Yield last_response to a block if given.
</p>
<p>
Example:
</p>
<pre>
  request &quot;/&quot;
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000019_source')" id="l_M000019_source">show</a>
                        
                    </p>
                    <div id="M000019_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rack/test.rb, line 112</span>
112:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">request</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">env</span> = {}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
113:         <span class="ruby-identifier">env</span> = <span class="ruby-identifier">env_for</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">env</span>)
114:         <span class="ruby-identifier">process_request</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">env</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
115:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Private methods</div>
            
            <div class="method">
                <div class="title" id="M000030">
                    
                    <a name="M000030"></a><b>default_env</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000030_source')" id="l_M000030_source">show</a>
                        
                    </p>
                    <div id="M000030_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rack/test.rb, line 262</span>
262:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">default_env</span>
263:         { <span class="ruby-value str">&quot;rack.test&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>, <span class="ruby-value str">&quot;REMOTE_ADDR&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;127.0.0.1&quot;</span> }.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">headers_for_env</span>)
264:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000029">
                    
                    <a name="M000029"></a><b>digest_auth_configured?</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000029_source')" id="l_M000029_source">show</a>
                        
                    </p>
                    <div id="M000029_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rack/test.rb, line 258</span>
258:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">digest_auth_configured?</span>
259:         <span class="ruby-ivar">@digest_username</span>
260:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000027">
                    
                    <a name="M000027"></a><b>digest_auth_header</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000027_source')" id="l_M000027_source">show</a>
                        
                    </p>
                    <div id="M000027_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rack/test.rb, line 235</span>
235:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">digest_auth_header</span>
236:         <span class="ruby-identifier">challenge</span> = <span class="ruby-identifier">last_response</span>[<span class="ruby-value str">&quot;WWW-Authenticate&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot; &quot;</span>, <span class="ruby-value">2</span>).<span class="ruby-identifier">last</span>
237:         <span class="ruby-identifier">params</span> = <span class="ruby-constant">Rack</span><span class="ruby-operator">::</span><span class="ruby-constant">Auth</span><span class="ruby-operator">::</span><span class="ruby-constant">Digest</span><span class="ruby-operator">::</span><span class="ruby-constant">Params</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">challenge</span>)
238: 
239:         <span class="ruby-identifier">params</span>.<span class="ruby-identifier">merge!</span>({
240:           <span class="ruby-value str">&quot;username&quot;</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@digest_username</span>,
241:           <span class="ruby-value str">&quot;nc&quot;</span>        =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;00000001&quot;</span>,
242:           <span class="ruby-value str">&quot;cnonce&quot;</span>    =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;nonsensenonce&quot;</span>,
243:           <span class="ruby-value str">&quot;uri&quot;</span>       =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">last_request</span>.<span class="ruby-identifier">path_info</span>,
244:           <span class="ruby-value str">&quot;method&quot;</span>    =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">last_request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-value str">&quot;REQUEST_METHOD&quot;</span>],
245:         })
246: 
247:         <span class="ruby-identifier">params</span>[<span class="ruby-value str">&quot;response&quot;</span>] = <span class="ruby-constant">MockDigestRequest</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">params</span>).<span class="ruby-identifier">response</span>(<span class="ruby-ivar">@digest_password</span>)
248: 
249:         <span class="ruby-node">&quot;Digest #{params}&quot;</span>
250:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000025">
                    
                    <a name="M000025"></a><b>env_for</b>(path, env)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000025_source')" id="l_M000025_source">show</a>
                        
                    </p>
                    <div id="M000025_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rack/test.rb, line 169</span>
169:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">env_for</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">env</span>)
170:         <span class="ruby-identifier">uri</span> = <span class="ruby-constant">URI</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">path</span>)
171:         <span class="ruby-identifier">uri</span>.<span class="ruby-identifier">path</span> = <span class="ruby-node">&quot;/#{uri.path}&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">uri</span>.<span class="ruby-identifier">path</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-value">?/</span>
172:         <span class="ruby-identifier">uri</span>.<span class="ruby-identifier">host</span> <span class="ruby-operator">||=</span> <span class="ruby-ivar">@default_host</span>
173: 
174:         <span class="ruby-identifier">env</span> = <span class="ruby-identifier">default_env</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">env</span>)
175: 
176:         <span class="ruby-identifier">env</span>[<span class="ruby-value str">&quot;HTTP_HOST&quot;</span>] <span class="ruby-operator">||=</span> [<span class="ruby-identifier">uri</span>.<span class="ruby-identifier">host</span>, <span class="ruby-identifier">uri</span>.<span class="ruby-identifier">port</span>].<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;:&quot;</span>)
177: 
178:         <span class="ruby-identifier">env</span>.<span class="ruby-identifier">update</span>(<span class="ruby-value str">&quot;HTTPS&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;on&quot;</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-constant">URI</span><span class="ruby-operator">::</span><span class="ruby-constant">HTTPS</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">uri</span>
179:         <span class="ruby-identifier">env</span>[<span class="ruby-value str">&quot;HTTP_X_REQUESTED_WITH&quot;</span>] = <span class="ruby-value str">&quot;XMLHttpRequest&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">env</span>[<span class="ruby-identifier">:xhr</span>]
180: 
181:         <span class="ruby-comment cmt"># TODO: Remove this after Rack 1.1 has been released.</span>
182:         <span class="ruby-comment cmt"># Stringifying and upcasing methods has be commit upstream</span>
183:         <span class="ruby-identifier">env</span>[<span class="ruby-value str">&quot;REQUEST_METHOD&quot;</span>] <span class="ruby-operator">||=</span> <span class="ruby-identifier">env</span>[<span class="ruby-identifier">:method</span>] <span class="ruby-operator">?</span> <span class="ruby-identifier">env</span>[<span class="ruby-identifier">:method</span>].<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">upcase</span> <span class="ruby-operator">:</span> <span class="ruby-value str">&quot;GET&quot;</span>
184: 
185:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">env</span>[<span class="ruby-value str">&quot;REQUEST_METHOD&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;GET&quot;</span>
186:           <span class="ruby-identifier">params</span> = <span class="ruby-identifier">env</span>[<span class="ruby-identifier">:params</span>] <span class="ruby-operator">||</span> {}
187:           <span class="ruby-identifier">params</span> = <span class="ruby-identifier">parse_nested_query</span>(<span class="ruby-identifier">params</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>)
188:           <span class="ruby-identifier">params</span>.<span class="ruby-identifier">update</span>(<span class="ruby-identifier">parse_nested_query</span>(<span class="ruby-identifier">uri</span>.<span class="ruby-identifier">query</span>))
189:           <span class="ruby-identifier">uri</span>.<span class="ruby-identifier">query</span> = <span class="ruby-identifier">build_nested_query</span>(<span class="ruby-identifier">params</span>)
190:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-operator">!</span><span class="ruby-identifier">env</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">:input</span>)
191:           <span class="ruby-identifier">env</span>[<span class="ruby-value str">&quot;CONTENT_TYPE&quot;</span>] <span class="ruby-operator">||=</span> <span class="ruby-value str">&quot;application/x-www-form-urlencoded&quot;</span>
192: 
193:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">env</span>[<span class="ruby-identifier">:params</span>].<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Hash</span>)
194:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">data</span> = <span class="ruby-identifier">build_multipart</span>(<span class="ruby-identifier">env</span>[<span class="ruby-identifier">:params</span>])
195:               <span class="ruby-identifier">env</span>[<span class="ruby-identifier">:input</span>] = <span class="ruby-identifier">data</span>
196:               <span class="ruby-identifier">env</span>[<span class="ruby-value str">&quot;CONTENT_LENGTH&quot;</span>] <span class="ruby-operator">||=</span> <span class="ruby-identifier">data</span>.<span class="ruby-identifier">length</span>.<span class="ruby-identifier">to_s</span>
197:               <span class="ruby-identifier">env</span>[<span class="ruby-value str">&quot;CONTENT_TYPE&quot;</span>] = <span class="ruby-node">&quot;multipart/form-data; boundary=#{MULTIPART_BOUNDARY}&quot;</span>
198:             <span class="ruby-keyword kw">else</span>
199:               <span class="ruby-identifier">env</span>[<span class="ruby-identifier">:input</span>] = <span class="ruby-identifier">params_to_string</span>(<span class="ruby-identifier">env</span>[<span class="ruby-identifier">:params</span>])
200:             <span class="ruby-keyword kw">end</span>
201:           <span class="ruby-keyword kw">else</span>
202:             <span class="ruby-identifier">env</span>[<span class="ruby-identifier">:input</span>] = <span class="ruby-identifier">env</span>[<span class="ruby-identifier">:params</span>]
203:           <span class="ruby-keyword kw">end</span>
204:         <span class="ruby-keyword kw">end</span>
205: 
206:         <span class="ruby-identifier">env</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:params</span>)
207: 
208:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">env</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">:cookie</span>)
209:           <span class="ruby-identifier">set_cookie</span>(<span class="ruby-identifier">env</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:cookie</span>), <span class="ruby-identifier">uri</span>)
210:         <span class="ruby-keyword kw">end</span>
211: 
212:         <span class="ruby-constant">Rack</span><span class="ruby-operator">::</span><span class="ruby-constant">MockRequest</span>.<span class="ruby-identifier">env_for</span>(<span class="ruby-identifier">uri</span>.<span class="ruby-identifier">to_s</span>, <span class="ruby-identifier">env</span>)
213:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000031">
                    
                    <a name="M000031"></a><b>headers_for_env</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000031_source')" id="l_M000031_source">show</a>
                        
                    </p>
                    <div id="M000031_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rack/test.rb, line 266</span>
266:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">headers_for_env</span>
267:         <span class="ruby-identifier">converted_headers</span> = {}
268: 
269:         <span class="ruby-ivar">@headers</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">name</span>, <span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
270:           <span class="ruby-identifier">env_key</span> = <span class="ruby-identifier">name</span>.<span class="ruby-identifier">upcase</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-value str">&quot;-&quot;</span>, <span class="ruby-value str">&quot;_&quot;</span>)
271:           <span class="ruby-identifier">env_key</span> = <span class="ruby-value str">&quot;HTTP_&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">env_key</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-value str">&quot;CONTENT_TYPE&quot;</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">env_key</span>
272:           <span class="ruby-identifier">converted_headers</span>[<span class="ruby-identifier">env_key</span>] = <span class="ruby-identifier">value</span>
273:         <span class="ruby-keyword kw">end</span>
274: 
275:         <span class="ruby-identifier">converted_headers</span>
276:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000032">
                    
                    <a name="M000032"></a><b>params_to_string</b>(params)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000032_source')" id="l_M000032_source">show</a>
                        
                    </p>
                    <div id="M000032_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rack/test.rb, line 278</span>
278:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">params_to_string</span>(<span class="ruby-identifier">params</span>)
279:         <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">params</span>
280:         <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Hash</span> <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">build_nested_query</span>(<span class="ruby-identifier">params</span>)
281:         <span class="ruby-keyword kw">when</span> <span class="ruby-keyword kw">nil</span>  <span class="ruby-keyword kw">then</span> <span class="ruby-value str">&quot;&quot;</span>
282:         <span class="ruby-keyword kw">else</span> <span class="ruby-identifier">params</span>
283:         <span class="ruby-keyword kw">end</span>
284:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000026">
                    
                    <a name="M000026"></a><b>process_request</b>(uri, env)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000026_source')" id="l_M000026_source">show</a>
                        
                    </p>
                    <div id="M000026_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rack/test.rb, line 215</span>
215:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">process_request</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">env</span>)
216:         <span class="ruby-identifier">uri</span> = <span class="ruby-constant">URI</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">uri</span>)
217:         <span class="ruby-identifier">uri</span>.<span class="ruby-identifier">host</span> <span class="ruby-operator">||=</span> <span class="ruby-ivar">@default_host</span>
218: 
219:         <span class="ruby-ivar">@rack_mock_session</span>.<span class="ruby-identifier">request</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">env</span>)
220: 
221:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">retry_with_digest_auth?</span>(<span class="ruby-identifier">env</span>)
222:           <span class="ruby-identifier">auth_env</span> = <span class="ruby-identifier">env</span>.<span class="ruby-identifier">merge</span>({
223:             <span class="ruby-value str">&quot;HTTP_AUTHORIZATION&quot;</span>          =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">digest_auth_header</span>,
224:             <span class="ruby-value str">&quot;rack-test.digest_auth_retry&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>
225:           })
226:           <span class="ruby-identifier">auth_env</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value str">'rack.request'</span>)
227:           <span class="ruby-identifier">process_request</span>(<span class="ruby-identifier">uri</span>.<span class="ruby-identifier">path</span>, <span class="ruby-identifier">auth_env</span>)
228:         <span class="ruby-keyword kw">else</span>
229:           <span class="ruby-keyword kw">yield</span> <span class="ruby-identifier">last_response</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block_given?</span>
230: 
231:           <span class="ruby-identifier">last_response</span>
232:         <span class="ruby-keyword kw">end</span>
233:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000028">
                    
                    <a name="M000028"></a><b>retry_with_digest_auth?</b>(env)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000028_source')" id="l_M000028_source">show</a>
                        
                    </p>
                    <div id="M000028_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rack/test.rb, line 252</span>
252:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">retry_with_digest_auth?</span>(<span class="ruby-identifier">env</span>)
253:         <span class="ruby-identifier">last_response</span>.<span class="ruby-identifier">status</span> <span class="ruby-operator">==</span> <span class="ruby-value">401</span> <span class="ruby-operator">&amp;&amp;</span>
254:         <span class="ruby-identifier">digest_auth_configured?</span> <span class="ruby-operator">&amp;&amp;</span>
255:         <span class="ruby-operator">!</span><span class="ruby-identifier">env</span>[<span class="ruby-value str">&quot;rack-test.digest_auth_retry&quot;</span>]
256:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Class Public methods</div>
            
            <div class="method">
                <div class="title" id="M000012">
                    
                    <a name="M000012"></a><b>new</b>(mock_session)
                    
                </div>
                
                <div class="description">
                  <p>
Creates a <a href="Session.html">Rack::Test::Session</a> for a given <a
href="../../Rack.html">Rack</a> app or Rack::MockSession.
</p>
<p>
Note: Generally, you won&#8217;t need to initialize a <a
href="Session.html">Rack::Test::Session</a> directly. Instead, you should
include <a href="Methods.html">Rack::Test::Methods</a> into your testing
context. (See <a href="../../../files/README_rdoc.html">README.rdoc</a> for
an example)
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000012_source')" id="l_M000012_source">show</a>
                        
                    </p>
                    <div id="M000012_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/rack/test.rb, line 36</span>
36:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">mock_session</span>)
37:         <span class="ruby-ivar">@headers</span> = {}
38: 
39:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">mock_session</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">MockSession</span>)
40:           <span class="ruby-ivar">@rack_mock_session</span> = <span class="ruby-identifier">mock_session</span>
41:         <span class="ruby-keyword kw">else</span>
42:           <span class="ruby-ivar">@rack_mock_session</span> = <span class="ruby-constant">MockSession</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">mock_session</span>)
43:         <span class="ruby-keyword kw">end</span>
44: 
45:         <span class="ruby-ivar">@default_host</span> = <span class="ruby-ivar">@rack_mock_session</span>.<span class="ruby-identifier">default_host</span>
46:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    