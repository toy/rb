<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>OpenID::AX::KeyValueMessage</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../../css/main.css" type="text/css" media="screen" />
    <script src="../../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Class</span> 
            OpenID::AX::KeyValueMessage 
            
                <span class="parent">&lt; 
                    
                    AXMessage
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../../files/lib/openid/extensions/ax_rb.html">lib/openid/extensions/ax.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    
    <div class="description">
        <p>
Abstract class that implements a message that has attribute keys and
values. It contains the common code between fetch_response and
store_request.
</p>

    </div>
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>#</dt>
        <dd>
            <ul>
                
                <li><a href="#M000231">[]</a>,</li>
                
                <li><a href="#M000218">_get_extension_kv_args</a></li>
                
            </ul>
        </dd>
    
        <dt>A</dt>
        <dd>
            <ul>
                
                <li><a href="#M000216">add_value</a></li>
                
            </ul>
        </dd>
    
        <dt>C</dt>
        <dd>
            <ul>
                
                <li><a href="#M000232">count</a></li>
                
            </ul>
        </dd>
    
        <dt>G</dt>
        <dd>
            <ul>
                
                <li><a href="#M000227">get</a>,</li>
                
                <li><a href="#M000226">get_single</a></li>
                
            </ul>
        </dd>
    
        <dt>N</dt>
        <dd>
            <ul>
                
                <li><a href="#M000215">new</a></li>
                
            </ul>
        </dd>
    
        <dt>P</dt>
        <dd>
            <ul>
                
                <li><a href="#M000222">parse_extension_args</a></li>
                
            </ul>
        </dd>
    
        <dt>S</dt>
        <dd>
            <ul>
                
                <li><a href="#M000217">set_values</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    

    

    

    

    
    <div class="sectiontitle">Attributes</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>data</td>
            <td class='attr-desc'></td>
        </tr>
        
    </table>
    

    
            <div class="sectiontitle">Class Public methods</div>
            
            <div class="method">
                <div class="title" id="M000215">
                    
                    <a name="M000215"></a><b>new</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000215_source')" id="l_M000215_source">show</a>
                        
                    </p>
                    <div id="M000215_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/openid/extensions/ax.rb, line 268</span>
268:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>
269:         <span class="ruby-keyword kw">super</span>()
270:         <span class="ruby-ivar">@mode</span> = <span class="ruby-keyword kw">nil</span>
271:         <span class="ruby-ivar">@data</span> = {}
272:         <span class="ruby-ivar">@data</span>.<span class="ruby-identifier">default</span> = []
273:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M000231">
                    
                    <a name="M000231"></a><b>[]</b>(type_uri)
                    
                </div>
                
                <div class="description">
                  <p>
retrieve the list of values for this attribute
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000231_source')" id="l_M000231_source">show</a>
                        
                    </p>
                    <div id="M000231_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/openid/extensions/ax.rb, line 370</span>
370:       <span class="ruby-keyword kw">def</span> <span class="ruby-operator">[]</span>(<span class="ruby-identifier">type_uri</span>)
371:         <span class="ruby-ivar">@data</span>[<span class="ruby-identifier">type_uri</span>]
372:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000218">
                    
                    <a name="M000218"></a><b>_get_extension_kv_args</b>(aliases = nil)
                    
                </div>
                
                <div class="description">
                  <p>
Get the extension arguments for the key/value pairs contained in this
message.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000218_source')" id="l_M000218_source">show</a>
                        
                    </p>
                    <div id="M000218_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/openid/extensions/ax.rb, line 291</span>
291:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">_get_extension_kv_args</span>(<span class="ruby-identifier">aliases</span> = <span class="ruby-keyword kw">nil</span>)
292:         <span class="ruby-identifier">aliases</span> = <span class="ruby-constant">NamespaceMap</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">aliases</span>.<span class="ruby-identifier">nil?</span>
293: 
294:         <span class="ruby-identifier">ax_args</span> = <span class="ruby-identifier">new_args</span>
295: 
296:         <span class="ruby-ivar">@data</span>.<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">type_uri</span>, <span class="ruby-identifier">values</span><span class="ruby-operator">|</span>
297:           <span class="ruby-identifier">name</span> = <span class="ruby-identifier">aliases</span>.<span class="ruby-identifier">add</span>(<span class="ruby-identifier">type_uri</span>)
298:           <span class="ruby-identifier">ax_args</span>[<span class="ruby-value str">'type.'</span><span class="ruby-operator">+</span><span class="ruby-identifier">name</span>] = <span class="ruby-identifier">type_uri</span>
299:           <span class="ruby-identifier">ax_args</span>[<span class="ruby-value str">'count.'</span><span class="ruby-operator">+</span><span class="ruby-identifier">name</span>] = <span class="ruby-identifier">values</span>.<span class="ruby-identifier">size</span>.<span class="ruby-identifier">to_s</span>
300: 
301:           <span class="ruby-identifier">values</span>.<span class="ruby-identifier">each_with_index</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">value</span>, <span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
302:             <span class="ruby-identifier">key</span> = <span class="ruby-node">&quot;value.#{name}.#{i+1}&quot;</span>
303:             <span class="ruby-identifier">ax_args</span>[<span class="ruby-identifier">key</span>] = <span class="ruby-identifier">value</span>
304:           }
305:         }
306:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">ax_args</span>
307:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000216">
                    
                    <a name="M000216"></a><b>add_value</b>(type_uri, value)
                    
                </div>
                
                <div class="description">
                  <p>
Add a single value for the given attribute type to the message. If there
are already values specified for this type, this value will be sent in
addition to the values already specified.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000216_source')" id="l_M000216_source">show</a>
                        
                    </p>
                    <div id="M000216_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/openid/extensions/ax.rb, line 279</span>
279:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_value</span>(<span class="ruby-identifier">type_uri</span>, <span class="ruby-identifier">value</span>)
280:         <span class="ruby-ivar">@data</span>[<span class="ruby-identifier">type_uri</span>] = <span class="ruby-ivar">@data</span>[<span class="ruby-identifier">type_uri</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">value</span>
281:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000232">
                    
                    <a name="M000232"></a><b>count</b>(type_uri)
                    
                </div>
                
                <div class="description">
                  <p>
get the number of responses for this attribute
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000232_source')" id="l_M000232_source">show</a>
                        
                    </p>
                    <div id="M000232_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/openid/extensions/ax.rb, line 375</span>
375:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">count</span>(<span class="ruby-identifier">type_uri</span>)
376:         <span class="ruby-ivar">@data</span>[<span class="ruby-identifier">type_uri</span>].<span class="ruby-identifier">size</span>
377:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000227">
                    
                    <a name="M000227"></a><b>get</b>(type_uri)
                    
                </div>
                
                <div class="description">
                  <p>
retrieve the list of values for this attribute
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000227_source')" id="l_M000227_source">show</a>
                        
                    </p>
                    <div id="M000227_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/openid/extensions/ax.rb, line 365</span>
365:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get</span>(<span class="ruby-identifier">type_uri</span>)
366:         <span class="ruby-ivar">@data</span>[<span class="ruby-identifier">type_uri</span>]
367:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000226">
                    
                    <a name="M000226"></a><b>get_single</b>(type_uri, default = nil)
                    
                </div>
                
                <div class="description">
                  <p>
Get a single value for an attribute. If no value was sent for this
attribute, use the supplied default. If there is more than one value for
this attribute, this method will fail.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000226_source')" id="l_M000226_source">show</a>
                        
                    </p>
                    <div id="M000226_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/openid/extensions/ax.rb, line 354</span>
354:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_single</span>(<span class="ruby-identifier">type_uri</span>, <span class="ruby-identifier">default</span> = <span class="ruby-keyword kw">nil</span>)
355:         <span class="ruby-identifier">values</span> = <span class="ruby-ivar">@data</span>[<span class="ruby-identifier">type_uri</span>]
356:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">default</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">values</span>.<span class="ruby-identifier">empty?</span>
357:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">values</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">!=</span> <span class="ruby-value">1</span>
358:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-node">&quot;More than one value present for #{type_uri.inspect}&quot;</span>
359:         <span class="ruby-keyword kw">else</span>
360:           <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">values</span>[<span class="ruby-value">0</span>]
361:         <span class="ruby-keyword kw">end</span>
362:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000222">
                    
                    <a name="M000222"></a><b>parse_extension_args</b>(ax_args)
                    
                </div>
                
                <div class="description">
                  <p>
Parse attribute exchange key/value arguments into this object.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000222_source')" id="l_M000222_source">show</a>
                        
                    </p>
                    <div id="M000222_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/openid/extensions/ax.rb, line 311</span>
311:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">parse_extension_args</span>(<span class="ruby-identifier">ax_args</span>)
312:         <span class="ruby-identifier">check_mode</span>(<span class="ruby-identifier">ax_args</span>)
313:         <span class="ruby-identifier">aliases</span> = <span class="ruby-constant">NamespaceMap</span>.<span class="ruby-identifier">new</span>
314: 
315:         <span class="ruby-identifier">ax_args</span>.<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
316:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">k</span>.<span class="ruby-identifier">index</span>(<span class="ruby-value str">'type.'</span>) <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
317:             <span class="ruby-identifier">type_uri</span> = <span class="ruby-identifier">v</span>
318:             <span class="ruby-identifier">name</span> = <span class="ruby-identifier">k</span>[<span class="ruby-value">5</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>]
319: 
320:             <span class="ruby-constant">AX</span>.<span class="ruby-identifier">check_alias</span>(<span class="ruby-identifier">name</span>)
321:             <span class="ruby-identifier">aliases</span>.<span class="ruby-identifier">add_alias</span>(<span class="ruby-identifier">type_uri</span>,<span class="ruby-identifier">name</span>)
322:           <span class="ruby-keyword kw">end</span>
323:         }
324: 
325:         <span class="ruby-identifier">aliases</span>.<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">type_uri</span>, <span class="ruby-identifier">name</span><span class="ruby-operator">|</span>
326:           <span class="ruby-identifier">count_s</span> = <span class="ruby-identifier">ax_args</span>[<span class="ruby-value str">'count.'</span><span class="ruby-operator">+</span><span class="ruby-identifier">name</span>]
327:           <span class="ruby-identifier">count</span> = <span class="ruby-identifier">count_s</span>.<span class="ruby-identifier">to_i</span>
328:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">count_s</span>.<span class="ruby-identifier">nil?</span>
329:             <span class="ruby-identifier">value</span> = <span class="ruby-identifier">ax_args</span>[<span class="ruby-value str">'value.'</span><span class="ruby-operator">+</span><span class="ruby-identifier">name</span>]
330:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">nil?</span>
331:               <span class="ruby-identifier">raise</span> <span class="ruby-constant">IndexError</span>, <span class="ruby-node">&quot;Missing #{'value.'+name} in FetchResponse&quot;</span> 
332:             <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">empty?</span>
333:               <span class="ruby-identifier">values</span> = []
334:             <span class="ruby-keyword kw">else</span>
335:               <span class="ruby-identifier">values</span> = [<span class="ruby-identifier">value</span>]
336:             <span class="ruby-keyword kw">end</span>
337:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">count_s</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
338:             <span class="ruby-identifier">values</span> = []
339:           <span class="ruby-keyword kw">else</span>
340:             <span class="ruby-identifier">values</span> = (<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-identifier">count</span>).<span class="ruby-identifier">inject</span>([]){<span class="ruby-operator">|</span><span class="ruby-identifier">l</span>,<span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
341:               <span class="ruby-identifier">key</span> = <span class="ruby-node">&quot;value.#{name}.#{i}&quot;</span>
342:               <span class="ruby-identifier">v</span> = <span class="ruby-identifier">ax_args</span>[<span class="ruby-identifier">key</span>]
343:               <span class="ruby-identifier">raise</span> <span class="ruby-constant">IndexError</span>, <span class="ruby-node">&quot;Missing #{key} in FetchResponse&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">nil?</span>
344:               <span class="ruby-identifier">l</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">v</span>
345:             }
346:           <span class="ruby-keyword kw">end</span>
347:           <span class="ruby-ivar">@data</span>[<span class="ruby-identifier">type_uri</span>] = <span class="ruby-identifier">values</span>
348:         }
349:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000217">
                    
                    <a name="M000217"></a><b>set_values</b>(type_uri, values)
                    
                </div>
                
                <div class="description">
                  <p>
Set the values for the given attribute type. This replaces any values that
have already been set for this attribute.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000217_source')" id="l_M000217_source">show</a>
                        
                    </p>
                    <div id="M000217_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/openid/extensions/ax.rb, line 285</span>
285:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set_values</span>(<span class="ruby-identifier">type_uri</span>, <span class="ruby-identifier">values</span>)
286:         <span class="ruby-ivar">@data</span>[<span class="ruby-identifier">type_uri</span>] = <span class="ruby-identifier">values</span>
287:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    