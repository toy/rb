<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>OpenID::Util</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../css/main.css" type="text/css" media="screen" />
    <script src="../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Module</span> 
            OpenID::Util 
            
        </h1>
        <ul class="files">
            
            <li><a href="../../files/lib/openid/kvform_rb.html">lib/openid/kvform.rb</a></li>
            
            <li><a href="../../files/lib/openid/util_rb.html">lib/openid/util.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>A</dt>
        <dd>
            <ul>
                
                <li><a href="#M000471">append_args</a>,</li>
                
                <li><a href="#M000465">assert</a>,</li>
                
                <li><a href="#M000476">auto_submit_html</a></li>
                
            </ul>
        </dd>
    
        <dt>D</dt>
        <dd>
            <ul>
                
                <li><a href="#M000282">dict_to_kv</a></li>
                
            </ul>
        </dd>
    
        <dt>F</dt>
        <dd>
            <ul>
                
                <li><a href="#M000467">from_base64</a></li>
                
            </ul>
        </dd>
    
        <dt>K</dt>
        <dd>
            <ul>
                
                <li><a href="#M000283">kv_to_dict</a>,</li>
                
                <li><a href="#M000280">kv_to_seq</a></li>
                
            </ul>
        </dd>
    
        <dt>L</dt>
        <dd>
            <ul>
                
                <li><a href="#M000475">log</a>,</li>
                
                <li><a href="#M000474">logger</a>,</li>
                
                <li><a href="#M000473">logger=</a></li>
                
            </ul>
        </dd>
    
        <dt>P</dt>
        <dd>
            <ul>
                
                <li><a href="#M000470">parse_query</a></li>
                
            </ul>
        </dd>
    
        <dt>S</dt>
        <dd>
            <ul>
                
                <li><a href="#M000278">seq_to_kv</a></li>
                
            </ul>
        </dd>
    
        <dt>T</dt>
        <dd>
            <ul>
                
                <li><a href="#M000466">to_base64</a></li>
                
            </ul>
        </dd>
    
        <dt>U</dt>
        <dd>
            <ul>
                
                <li><a href="#M000468">urlencode</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    

    

    

    
    <div class="sectiontitle">Constants</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class="attr-name">BASE64_CHARS</td>
            <td>=</td>
            <td class="attr-value">('ABCDEFGHIJKLMNOPQRSTUVWXYZ' \                     'abcdefghijklmnopqrstuvwxyz0123456789+/')</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">BASE64_RE</td>
            <td>=</td>
            <td class="attr-value">Regexp.compile(&quot;     \\A     ([#{BASE64_CHARS}]{4})*     ([#{BASE64_CHARS}]{2}==|      [#{BASE64_CHARS}]{3}=)?     \\Z&quot;, Regexp::EXTENDED)</td>
        </tr>
        
        
    </table>
    

    

    
            <div class="sectiontitle">Class Public methods</div>
            
            <div class="method">
                <div class="title" id="M000471">
                    
                    <a name="M000471"></a><b>append_args</b>(url, args)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000471_source')" id="l_M000471_source">show</a>
                        
                    </p>
                    <div id="M000471_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/openid/util.rb, line 62</span>
62:     <span class="ruby-keyword kw">def</span> <span class="ruby-constant">Util</span>.<span class="ruby-identifier">append_args</span>(<span class="ruby-identifier">url</span>, <span class="ruby-identifier">args</span>)
63:       <span class="ruby-identifier">url</span> = <span class="ruby-identifier">url</span>.<span class="ruby-identifier">dup</span>
64:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">url</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
65: 
66:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value str">'each_pair'</span>)
67:         <span class="ruby-identifier">args</span> = <span class="ruby-identifier">args</span>.<span class="ruby-identifier">sort</span>
68:       <span class="ruby-keyword kw">end</span>
69: 
70:       <span class="ruby-identifier">url</span> <span class="ruby-operator">&lt;&lt;</span> (<span class="ruby-identifier">url</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-value str">&quot;?&quot;</span>) <span class="ruby-operator">?</span> <span class="ruby-value str">&quot;&amp;&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-value str">&quot;?&quot;</span>)
71:       <span class="ruby-identifier">url</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Util</span>.<span class="ruby-identifier">urlencode</span>(<span class="ruby-identifier">args</span>)
72:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000465">
                    
                    <a name="M000465"></a><b>assert</b>(value, message=nil)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000465_source')" id="l_M000465_source">show</a>
                        
                    </p>
                    <div id="M000465_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/openid/util.rb, line 29</span>
29:     <span class="ruby-keyword kw">def</span> <span class="ruby-constant">Util</span>.<span class="ruby-identifier">assert</span>(<span class="ruby-identifier">value</span>, <span class="ruby-identifier">message</span>=<span class="ruby-keyword kw">nil</span>)
30:       <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">not</span> <span class="ruby-identifier">value</span>
31:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">AssertionError</span>, <span class="ruby-identifier">message</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">value</span>
32:       <span class="ruby-keyword kw">end</span>
33:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000476">
                    
                    <a name="M000476"></a><b>auto_submit_html</b>(form, title='OpenID transaction in progress')
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000476_source')" id="l_M000476_source">show</a>
                        
                    </p>
                    <div id="M000476_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/openid/util.rb, line 90</span>
 90:     <span class="ruby-keyword kw">def</span> <span class="ruby-constant">Util</span>.<span class="ruby-identifier">auto_submit_html</span>(<span class="ruby-identifier">form</span>, <span class="ruby-identifier">title</span>=<span class="ruby-value str">'OpenID transaction in progress'</span>)
 91:       <span class="ruby-keyword kw">return</span> <span class="ruby-node">&quot;
 92: &lt;html&gt;
 93: &lt;head&gt;
 94:   &lt;title&gt;#{title}&lt;/title&gt;
 95: &lt;/head&gt;
 96: &lt;body onload='document.forms[0].submit();'&gt;
 97: #{form}
 98: &lt;script&gt;
 99: var elements = document.forms[0].elements;
100: for (var i = 0; i &lt; elements.length; i++) {
101:   elements[i].style.display = \&quot;none\&quot;;
102: }
103: &lt;/script&gt;
104: &lt;/body&gt;
105: &lt;/html&gt;
106: &quot;</span>
107:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000282">
                    
                    <a name="M000282"></a><b>dict_to_kv</b>(d)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000282_source')" id="l_M000282_source">show</a>
                        
                    </p>
                    <div id="M000282_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/openid/kvform.rb, line 127</span>
127:     <span class="ruby-keyword kw">def</span> <span class="ruby-constant">Util</span>.<span class="ruby-identifier">dict_to_kv</span>(<span class="ruby-identifier">d</span>)
128:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">seq_to_kv</span>(<span class="ruby-identifier">d</span>.<span class="ruby-identifier">entries</span>.<span class="ruby-identifier">sort</span>)
129:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000467">
                    
                    <a name="M000467"></a><b>from_base64</b>(s)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000467_source')" id="l_M000467_source">show</a>
                        
                    </p>
                    <div id="M000467_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/openid/util.rb, line 39</span>
39:     <span class="ruby-keyword kw">def</span> <span class="ruby-constant">Util</span>.<span class="ruby-identifier">from_base64</span>(<span class="ruby-identifier">s</span>)
40:       <span class="ruby-identifier">without_newlines</span> = <span class="ruby-identifier">s</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/[\r\n]+/</span>, <span class="ruby-value str">''</span>)
41:       <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">BASE64_RE</span>.<span class="ruby-identifier">match</span>(<span class="ruby-identifier">without_newlines</span>)
42:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-node">&quot;Malformed input: #{s.inspect}&quot;</span>
43:       <span class="ruby-keyword kw">end</span>
44:       <span class="ruby-identifier">without_newlines</span>.<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">'m'</span>).<span class="ruby-identifier">first</span>
45:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000283">
                    
                    <a name="M000283"></a><b>kv_to_dict</b>(s)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000283_source')" id="l_M000283_source">show</a>
                        
                    </p>
                    <div id="M000283_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/openid/kvform.rb, line 131</span>
131:     <span class="ruby-keyword kw">def</span> <span class="ruby-constant">Util</span>.<span class="ruby-identifier">kv_to_dict</span>(<span class="ruby-identifier">s</span>)
132:       <span class="ruby-identifier">seq</span> = <span class="ruby-identifier">kv_to_seq</span>(<span class="ruby-identifier">s</span>)
133:       <span class="ruby-keyword kw">return</span> <span class="ruby-constant">Hash</span>[<span class="ruby-operator">*</span><span class="ruby-identifier">seq</span>.<span class="ruby-identifier">flatten</span>]
134:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000280">
                    
                    <a name="M000280"></a><b>kv_to_seq</b>(data, strict=false)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000280_source')" id="l_M000280_source">show</a>
                        
                    </p>
                    <div id="M000280_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/openid/kvform.rb, line 63</span>
 63:     <span class="ruby-keyword kw">def</span> <span class="ruby-constant">Util</span>.<span class="ruby-identifier">kv_to_seq</span>(<span class="ruby-identifier">data</span>, <span class="ruby-identifier">strict</span>=<span class="ruby-keyword kw">false</span>)
 64:       <span class="ruby-comment cmt"># After one parse, seq_to_kv and kv_to_seq are inverses, with no</span>
 65:       <span class="ruby-comment cmt"># warnings:</span>
 66:       <span class="ruby-comment cmt">#</span>
 67:       <span class="ruby-comment cmt"># seq = kv_to_seq(s)</span>
 68:       <span class="ruby-comment cmt"># seq_to_kv(kv_to_seq(seq)) == seq</span>
 69:       <span class="ruby-identifier">err</span> = <span class="ruby-identifier">lambda</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">msg</span><span class="ruby-operator">|</span>
 70:         <span class="ruby-identifier">msg</span> = <span class="ruby-node">&quot;kv_to_seq warning: #{msg}: #{data.inspect}&quot;</span>
 71:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">strict</span>
 72:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">KVFormError</span>, <span class="ruby-identifier">msg</span>
 73:         <span class="ruby-keyword kw">else</span>
 74:           <span class="ruby-constant">Util</span>.<span class="ruby-identifier">log</span>(<span class="ruby-identifier">msg</span>)
 75:         <span class="ruby-keyword kw">end</span>
 76:       }
 77: 
 78:       <span class="ruby-identifier">lines</span> = <span class="ruby-identifier">data</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;\n&quot;</span>)
 79:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">data</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
 80:         <span class="ruby-keyword kw">return</span> []
 81:       <span class="ruby-keyword kw">end</span>
 82: 
 83:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">data</span>[<span class="ruby-value">-1</span>].<span class="ruby-identifier">chr</span> <span class="ruby-operator">!=</span> <span class="ruby-value str">&quot;\n&quot;</span>
 84:         <span class="ruby-identifier">err</span>.<span class="ruby-identifier">call</span>(<span class="ruby-value str">&quot;Does not end in a newline&quot;</span>)
 85:         <span class="ruby-comment cmt"># We don't expect the last element of lines to be an empty</span>
 86:         <span class="ruby-comment cmt"># string because split() doesn't behave that way.</span>
 87:       <span class="ruby-keyword kw">end</span>
 88: 
 89:       <span class="ruby-identifier">pairs</span> = []
 90:       <span class="ruby-identifier">line_num</span> = <span class="ruby-value">0</span>
 91:       <span class="ruby-identifier">lines</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">line</span><span class="ruby-operator">|</span>
 92:         <span class="ruby-identifier">line_num</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
 93: 
 94:         <span class="ruby-comment cmt"># Ignore blank lines</span>
 95:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">line</span>.<span class="ruby-identifier">strip</span>() <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;&quot;</span>
 96:           <span class="ruby-keyword kw">next</span>
 97:         <span class="ruby-keyword kw">end</span>
 98: 
 99:         <span class="ruby-identifier">pair</span> = <span class="ruby-identifier">line</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">':'</span>, <span class="ruby-value">2</span>)
100:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">pair</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">2</span>
101:           <span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span> = <span class="ruby-identifier">pair</span>
102:           <span class="ruby-identifier">k_s</span> = <span class="ruby-identifier">k</span>.<span class="ruby-identifier">strip</span>()
103:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">k_s</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">k</span>
104:             <span class="ruby-identifier">msg</span> = <span class="ruby-node">&quot;In line #{line_num}, ignoring leading or trailing whitespace in key #{k.inspect}&quot;</span>
105:             <span class="ruby-identifier">err</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">msg</span>)
106:           <span class="ruby-keyword kw">end</span>
107: 
108:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">k_s</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
109:             <span class="ruby-identifier">err</span>.<span class="ruby-identifier">call</span>(<span class="ruby-node">&quot;In line #{line_num}, got empty key&quot;</span>)
110:           <span class="ruby-keyword kw">end</span>
111: 
112:           <span class="ruby-identifier">v_s</span> = <span class="ruby-identifier">v</span>.<span class="ruby-identifier">strip</span>()
113:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">v_s</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">v</span>
114:             <span class="ruby-identifier">msg</span> = <span class="ruby-node">&quot;In line #{line_num}, ignoring leading or trailing whitespace in value #{v.inspect}&quot;</span>
115:             <span class="ruby-identifier">err</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">msg</span>)
116:           <span class="ruby-keyword kw">end</span>
117: 
118:           <span class="ruby-identifier">pairs</span> <span class="ruby-operator">&lt;&lt;</span> [<span class="ruby-identifier">k_s</span>, <span class="ruby-identifier">v_s</span>]
119:         <span class="ruby-keyword kw">else</span>
120:           <span class="ruby-identifier">err</span>.<span class="ruby-identifier">call</span>(<span class="ruby-node">&quot;Line #{line_num} does not contain a colon&quot;</span>)
121:         <span class="ruby-keyword kw">end</span>
122:       }
123: 
124:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">pairs</span>
125:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000475">
                    
                    <a name="M000475"></a><b>log</b>(message)
                    
                </div>
                
                <div class="description">
                  <p>
change the message below to do whatever you like for logging
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000475_source')" id="l_M000475_source">show</a>
                        
                    </p>
                    <div id="M000475_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/openid/util.rb, line 86</span>
86:     <span class="ruby-keyword kw">def</span> <span class="ruby-constant">Util</span>.<span class="ruby-identifier">log</span>(<span class="ruby-identifier">message</span>)
87:       <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span>(<span class="ruby-identifier">message</span>)
88:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000474">
                    
                    <a name="M000474"></a><b>logger</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000474_source')" id="l_M000474_source">show</a>
                        
                    </p>
                    <div id="M000474_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/openid/util.rb, line 81</span>
81:     <span class="ruby-keyword kw">def</span> <span class="ruby-constant">Util</span>.<span class="ruby-identifier">logger</span>
82:       <span class="ruby-ivar">@@logger</span>
83:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000473">
                    
                    <a name="M000473"></a><b>logger=</b>(logger)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000473_source')" id="l_M000473_source">show</a>
                        
                    </p>
                    <div id="M000473_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/openid/util.rb, line 77</span>
77:     <span class="ruby-keyword kw">def</span> <span class="ruby-constant">Util</span>.<span class="ruby-identifier">logger=</span>(<span class="ruby-identifier">logger</span>)
78:       <span class="ruby-ivar">@@logger</span> = <span class="ruby-identifier">logger</span>
79:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000470">
                    
                    <a name="M000470"></a><b>parse_query</b>(qs)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000470_source')" id="l_M000470_source">show</a>
                        
                    </p>
                    <div id="M000470_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/openid/util.rb, line 56</span>
56:     <span class="ruby-keyword kw">def</span> <span class="ruby-constant">Util</span>.<span class="ruby-identifier">parse_query</span>(<span class="ruby-identifier">qs</span>)
57:       <span class="ruby-identifier">query</span> = {}
58:       <span class="ruby-constant">CGI</span><span class="ruby-operator">::</span><span class="ruby-identifier">parse</span>(<span class="ruby-identifier">qs</span>).<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">query</span>[<span class="ruby-identifier">k</span>] = <span class="ruby-identifier">v</span>[<span class="ruby-value">0</span>]}
59:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">query</span>
60:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000278">
                    
                    <a name="M000278"></a><b>seq_to_kv</b>(seq, strict=false)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000278_source')" id="l_M000278_source">show</a>
                        
                    </p>
                    <div id="M000278_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/openid/kvform.rb, line 9</span>
 9:     <span class="ruby-keyword kw">def</span> <span class="ruby-constant">Util</span>.<span class="ruby-identifier">seq_to_kv</span>(<span class="ruby-identifier">seq</span>, <span class="ruby-identifier">strict</span>=<span class="ruby-keyword kw">false</span>)
10:       <span class="ruby-comment cmt"># Represent a sequence of pairs of strings as newline-terminated</span>
11:       <span class="ruby-comment cmt"># key:value pairs. The pairs are generated in the order given.</span>
12:       <span class="ruby-comment cmt">#</span>
13:       <span class="ruby-comment cmt"># @param seq: The pairs</span>
14:       <span class="ruby-comment cmt">#</span>
15:       <span class="ruby-comment cmt"># returns a string representation of the sequence</span>
16:       <span class="ruby-identifier">err</span> = <span class="ruby-identifier">lambda</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">msg</span><span class="ruby-operator">|</span>
17:         <span class="ruby-identifier">msg</span> = <span class="ruby-node">&quot;seq_to_kv warning: #{msg}: #{seq.inspect}&quot;</span>
18:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">strict</span>
19:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">KVFormError</span>, <span class="ruby-identifier">msg</span>
20:         <span class="ruby-keyword kw">else</span>
21:           <span class="ruby-constant">Util</span>.<span class="ruby-identifier">log</span>(<span class="ruby-identifier">msg</span>)
22:         <span class="ruby-keyword kw">end</span>
23:       }
24: 
25:       <span class="ruby-identifier">lines</span> = []
26:       <span class="ruby-identifier">seq</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
27:         <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">k</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>)
28:           <span class="ruby-identifier">err</span>.<span class="ruby-identifier">call</span>(<span class="ruby-node">&quot;Converting key to string: #{k.inspect}&quot;</span>)
29:           <span class="ruby-identifier">k</span> = <span class="ruby-identifier">k</span>.<span class="ruby-identifier">to_s</span>
30:         <span class="ruby-keyword kw">end</span>
31: 
32:         <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">k</span>.<span class="ruby-identifier">index</span>(<span class="ruby-value str">&quot;\n&quot;</span>).<span class="ruby-identifier">nil?</span>
33:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">KVFormError</span>, <span class="ruby-node">&quot;Invalid input for seq_to_kv: key contains newline: #{k.inspect}&quot;</span>
34:         <span class="ruby-keyword kw">end</span>
35: 
36:         <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">k</span>.<span class="ruby-identifier">index</span>(<span class="ruby-value str">&quot;:&quot;</span>).<span class="ruby-identifier">nil?</span>
37:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">KVFormError</span>, <span class="ruby-node">&quot;Invalid input for seq_to_kv: key contains colon: #{k.inspect}&quot;</span>
38:         <span class="ruby-keyword kw">end</span>
39: 
40:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">k</span>.<span class="ruby-identifier">strip</span>() <span class="ruby-operator">!=</span> <span class="ruby-identifier">k</span>
41:           <span class="ruby-identifier">err</span>.<span class="ruby-identifier">call</span>(<span class="ruby-node">&quot;Key has whitespace at beginning or end: #{k.inspect}&quot;</span>)
42:         <span class="ruby-keyword kw">end</span>
43: 
44:         <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">v</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>)
45:           <span class="ruby-identifier">err</span>.<span class="ruby-identifier">call</span>(<span class="ruby-node">&quot;Converting value to string: #{v.inspect}&quot;</span>)
46:           <span class="ruby-identifier">v</span> = <span class="ruby-identifier">v</span>.<span class="ruby-identifier">to_s</span>
47:         <span class="ruby-keyword kw">end</span>
48: 
49:         <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">v</span>.<span class="ruby-identifier">index</span>(<span class="ruby-value str">&quot;\n&quot;</span>).<span class="ruby-identifier">nil?</span>
50:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">KVFormError</span>, <span class="ruby-node">&quot;Invalid input for seq_to_kv: value contains newline: #{v.inspect}&quot;</span>
51:         <span class="ruby-keyword kw">end</span>
52: 
53:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">strip</span>() <span class="ruby-operator">!=</span> <span class="ruby-identifier">v</span>
54:           <span class="ruby-identifier">err</span>.<span class="ruby-identifier">call</span>(<span class="ruby-node">&quot;Value has whitespace at beginning or end: #{v.inspect}&quot;</span>)
55:         <span class="ruby-keyword kw">end</span>
56: 
57:         <span class="ruby-identifier">lines</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">k</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;:&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">v</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;\n&quot;</span>
58:       }
59: 
60:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">lines</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;&quot;</span>)
61:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000466">
                    
                    <a name="M000466"></a><b>to_base64</b>(s)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000466_source')" id="l_M000466_source">show</a>
                        
                    </p>
                    <div id="M000466_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/openid/util.rb, line 35</span>
35:     <span class="ruby-keyword kw">def</span> <span class="ruby-constant">Util</span>.<span class="ruby-identifier">to_base64</span>(<span class="ruby-identifier">s</span>)
36:       [<span class="ruby-identifier">s</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'m'</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-value str">&quot;\n&quot;</span>, <span class="ruby-value str">&quot;&quot;</span>)
37:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000468">
                    
                    <a name="M000468"></a><b>urlencode</b>(args)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000468_source')" id="l_M000468_source">show</a>
                        
                    </p>
                    <div id="M000468_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/openid/util.rb, line 47</span>
47:     <span class="ruby-keyword kw">def</span> <span class="ruby-constant">Util</span>.<span class="ruby-identifier">urlencode</span>(<span class="ruby-identifier">args</span>)
48:       <span class="ruby-identifier">a</span> = []
49:       <span class="ruby-identifier">args</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">val</span><span class="ruby-operator">|</span>
50:         <span class="ruby-identifier">val</span> = <span class="ruby-value str">''</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">val</span>
51:         <span class="ruby-identifier">a</span> <span class="ruby-operator">&lt;&lt;</span> (<span class="ruby-constant">CGI</span><span class="ruby-operator">::</span><span class="ruby-identifier">escape</span>(<span class="ruby-identifier">key</span>) <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;=&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-constant">CGI</span><span class="ruby-operator">::</span><span class="ruby-identifier">escape</span>(<span class="ruby-identifier">val</span>))
52:       <span class="ruby-keyword kw">end</span>
53:       <span class="ruby-identifier">a</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;&amp;&quot;</span>)
54:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    