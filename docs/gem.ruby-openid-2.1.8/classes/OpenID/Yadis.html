<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>OpenID::Yadis</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../css/main.css" type="text/css" media="screen" />
    <script src="../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Module</span> 
            OpenID::Yadis 
            
        </h1>
        <ul class="files">
            
            <li><a href="../../files/lib/openid/yadis/accept_rb.html">lib/openid/yadis/accept.rb</a></li>
            
            <li><a href="../../files/lib/openid/yadis/constants_rb.html">lib/openid/yadis/constants.rb</a></li>
            
            <li><a href="../../files/lib/openid/yadis/filters_rb.html">lib/openid/yadis/filters.rb</a></li>
            
            <li><a href="../../files/lib/openid/yadis/discovery_rb.html">lib/openid/yadis/discovery.rb</a></li>
            
            <li><a href="../../files/lib/openid/yadis/parsehtml_rb.html">lib/openid/yadis/parsehtml.rb</a></li>
            
            <li><a href="../../files/lib/openid/yadis/services_rb.html">lib/openid/yadis/services.rb</a></li>
            
            <li><a href="../../files/lib/openid/yadis/xrds_rb.html">lib/openid/yadis/xrds.rb</a></li>
            
            <li><a href="../../files/lib/openid/yadis/xri_rb.html">lib/openid/yadis/xri.rb</a></li>
            
            <li><a href="../../files/lib/openid/yadis/xrires_rb.html">lib/openid/yadis/xrires.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>A</dt>
        <dd>
            <ul>
                
                <li><a href="#M000515">apply_filter</a></li>
                
            </ul>
        </dd>
    
        <dt>D</dt>
        <dd>
            <ul>
                
                <li><a href="#M000487">discover</a></li>
                
            </ul>
        </dd>
    
        <dt>E</dt>
        <dd>
            <ul>
                
                <li><a href="#M000528">each_service</a>,</li>
                
                <li><a href="#M000531">expand_service</a></li>
                
            </ul>
        </dd>
    
        <dt>G</dt>
        <dd>
            <ul>
                
                <li><a href="#M000469">generate_accept_header</a>,</li>
                
                <li><a href="#M000478">get_acceptable</a>,</li>
                
                <li><a href="#M000517">get_canonical_id</a>,</li>
                
                <li><a href="#M000514">get_service_endpoints</a>,</li>
                
                <li><a href="#M000527">get_yadis_xrd</a></li>
                
            </ul>
        </dd>
    
        <dt>H</dt>
        <dd>
            <ul>
                
                <li><a href="#M000500">html_yadis_location</a></li>
                
            </ul>
        </dd>
    
        <dt>I</dt>
        <dd>
            <ul>
                
                <li><a href="#M000526">is_xrds?</a></li>
                
            </ul>
        </dd>
    
        <dt>M</dt>
        <dd>
            <ul>
                
                <li><a href="#M000494">make_filter</a>,</li>
                
                <li><a href="#M000477">match_types</a>,</li>
                
                <li><a href="#M000495">mk_compound_filter</a></li>
                
            </ul>
        </dd>
    
        <dt>P</dt>
        <dd>
            <ul>
                
                <li><a href="#M000524">parseXRDS</a>,</li>
                
                <li><a href="#M000472">parse_accept_header</a>,</li>
                
                <li><a href="#M000532">prio_sort</a></li>
                
            </ul>
        </dd>
    
        <dt>S</dt>
        <dd>
            <ul>
                
                <li><a href="#M000530">services</a></li>
                
            </ul>
        </dd>
    
        <dt>W</dt>
        <dd>
            <ul>
                
                <li><a href="#M000491">where_is_yadis?</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    

    

    
    <div class="sectiontitle">Classes and Modules</div>
    <ul>
        
        <li><span class="type">MODULE</span> <a href="Yadis/XRI.html">OpenID::Yadis::XRI</a></li>
        
        <li><span class="type">CLASS</span> <a href="Yadis/BasicServiceEndpoint.html">OpenID::Yadis::BasicServiceEndpoint</a></li>
        
        <li><span class="type">CLASS</span> <a href="Yadis/CompoundFilter.html">OpenID::Yadis::CompoundFilter</a></li>
        
        <li><span class="type">CLASS</span> <a href="Yadis/DiscoveryResult.html">OpenID::Yadis::DiscoveryResult</a></li>
        
        <li><span class="type">CLASS</span> <a href="Yadis/TransformFilterMaker.html">OpenID::Yadis::TransformFilterMaker</a></li>
        
        <li><span class="type">CLASS</span> <a href="Yadis/XRDSError.html">OpenID::Yadis::XRDSError</a></li>
        
        <li><span class="type">CLASS</span> <a href="Yadis/XRDSFraud.html">OpenID::Yadis::XRDSFraud</a></li>
        
    </ul>
    

    
    <div class="sectiontitle">Constants</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class="attr-name">YADIS_HEADER_NAME</td>
            <td>=</td>
            <td class="attr-value">'X-XRDS-Location'</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">YADIS_CONTENT_TYPE</td>
            <td>=</td>
            <td class="attr-value">'application/xrds+xml'</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">YADIS_ACCEPT_HEADER</td>
            <td>=</td>
            <td class="attr-value">generate_accept_header(                                                  ['text/html', 0.3],                                                  ['application/xhtml+xml', 0.5],                                                  [YADIS_CONTENT_TYPE, 1.0]                                                  )</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
A value suitable for using as an accept header when performing YADIS
discovery, unless the application has special requirements
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">XRD_NS_2_0</td>
            <td>=</td>
            <td class="attr-value">'xri://$xrd*($v*2.0)'</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">XRDS_NS</td>
            <td>=</td>
            <td class="attr-value">'xri://$xrds'</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">XRDS_NAMESPACES</td>
            <td>=</td>
            <td class="attr-value">{       'xrds' =&gt; XRDS_NS,       'xrd' =&gt; XRD_NS_2_0,     }</td>
        </tr>
        
        
    </table>
    

    

    
            <div class="sectiontitle">Class Public methods</div>
            
            <div class="method">
                <div class="title" id="M000515">
                    
                    <a name="M000515"></a><b>apply_filter</b>(normalized_uri, xrd_data, flt=nil)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000515_source')" id="l_M000515_source">show</a>
                        
                    </p>
                    <div id="M000515_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/openid/yadis/services.rb, line 27</span>
27:     <span class="ruby-keyword kw">def</span> <span class="ruby-constant">Yadis</span>.<span class="ruby-identifier">apply_filter</span>(<span class="ruby-identifier">normalized_uri</span>, <span class="ruby-identifier">xrd_data</span>, <span class="ruby-identifier">flt</span>=<span class="ruby-keyword kw">nil</span>)
28:       <span class="ruby-comment cmt"># Generate an iterable of endpoint objects given this input data,</span>
29:       <span class="ruby-comment cmt"># presumably from the result of performing the Yadis protocol.</span>
30: 
31:       <span class="ruby-identifier">flt</span> = <span class="ruby-constant">Yadis</span>.<span class="ruby-identifier">make_filter</span>(<span class="ruby-identifier">flt</span>)
32:       <span class="ruby-identifier">et</span> = <span class="ruby-constant">Yadis</span>.<span class="ruby-identifier">parseXRDS</span>(<span class="ruby-identifier">xrd_data</span>)
33: 
34:       <span class="ruby-identifier">endpoints</span> = []
35:       <span class="ruby-identifier">each_service</span>(<span class="ruby-identifier">et</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">service_element</span><span class="ruby-operator">|</span>
36:         <span class="ruby-identifier">endpoints</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">flt</span>.<span class="ruby-identifier">get_service_endpoints</span>(<span class="ruby-identifier">normalized_uri</span>, <span class="ruby-identifier">service_element</span>)
37:       }
38: 
39:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">endpoints</span>
40:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000487">
                    
                    <a name="M000487"></a><b>discover</b>(uri)
                    
                </div>
                
                <div class="description">
                  <p>
Discover services for a given URI.
</p>
<p>
uri: The identity URI as a well-formed http or https URI. The
well-formedness and the protocol are not checked, but the results of this
function are undefined if those properties do not hold.
</p>
<p>
returns a <a href="Yadis/DiscoveryResult.html">DiscoveryResult</a> object
</p>
<p>
Raises <a href="DiscoveryFailure.html">DiscoveryFailure</a> when the HTTP
response does not have a 200 code.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000487_source')" id="l_M000487_source">show</a>
                        
                    </p>
                    <div id="M000487_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/openid/yadis/discovery.rb, line 74</span>
 74:     <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">discover</span>(<span class="ruby-identifier">uri</span>)
 75:       <span class="ruby-identifier">result</span> = <span class="ruby-constant">DiscoveryResult</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">uri</span>)
 76:       <span class="ruby-keyword kw">begin</span>
 77:         <span class="ruby-identifier">resp</span> = <span class="ruby-constant">OpenID</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-keyword kw">nil</span>, {<span class="ruby-value str">'Accept'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">YADIS_ACCEPT_HEADER</span>})
 78:       <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Exception</span>
 79:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">DiscoveryFailure</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;Failed to fetch identity URL #{uri} : #{$!}&quot;</span>, <span class="ruby-identifier">$!</span>)
 80:       <span class="ruby-keyword kw">end</span>
 81:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">resp</span>.<span class="ruby-identifier">code</span> <span class="ruby-operator">!=</span> <span class="ruby-value str">&quot;200&quot;</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">resp</span>.<span class="ruby-identifier">code</span> <span class="ruby-operator">!=</span> <span class="ruby-value str">&quot;206&quot;</span>
 82:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">DiscoveryFailure</span>.<span class="ruby-identifier">new</span>(
 83:                 <span class="ruby-value str">&quot;HTTP Response status from identity URL host is not \&quot;200\&quot;.&quot;</span>\
 84:                 <span class="ruby-node">&quot;Got status #{resp.code.inspect} for #{resp.final_url}&quot;</span>, <span class="ruby-identifier">resp</span>)
 85:       <span class="ruby-keyword kw">end</span>
 86: 
 87:       <span class="ruby-comment cmt"># Note the URL after following redirects</span>
 88:       <span class="ruby-identifier">result</span>.<span class="ruby-identifier">normalized_uri</span> = <span class="ruby-identifier">resp</span>.<span class="ruby-identifier">final_url</span>
 89: 
 90:       <span class="ruby-comment cmt"># Attempt to find out where to go to discover the document or if</span>
 91:       <span class="ruby-comment cmt"># we already have it</span>
 92:       <span class="ruby-identifier">result</span>.<span class="ruby-identifier">content_type</span> = <span class="ruby-identifier">resp</span>[<span class="ruby-value str">'content-type'</span>]
 93: 
 94:       <span class="ruby-identifier">result</span>.<span class="ruby-identifier">xrds_uri</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">where_is_yadis?</span>(<span class="ruby-identifier">resp</span>)
 95: 
 96:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">result</span>.<span class="ruby-identifier">xrds_uri</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">result</span>.<span class="ruby-identifier">used_yadis_location?</span>
 97:         <span class="ruby-keyword kw">begin</span>
 98:           <span class="ruby-identifier">resp</span> = <span class="ruby-constant">OpenID</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-identifier">result</span>.<span class="ruby-identifier">xrds_uri</span>)
 99:         <span class="ruby-keyword kw">rescue</span>
100:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">DiscoveryFailure</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;Failed to fetch Yadis URL #{result.xrds_uri} : #{$!}&quot;</span>, <span class="ruby-identifier">$!</span>)
101:         <span class="ruby-keyword kw">end</span>
102:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">resp</span>.<span class="ruby-identifier">code</span> <span class="ruby-operator">!=</span> <span class="ruby-value str">&quot;200&quot;</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">resp</span>.<span class="ruby-identifier">code</span> <span class="ruby-operator">!=</span> <span class="ruby-value str">&quot;206&quot;</span>
103:             <span class="ruby-identifier">exc</span> = <span class="ruby-constant">DiscoveryFailure</span>.<span class="ruby-identifier">new</span>(
104:                     <span class="ruby-value str">&quot;HTTP Response status from Yadis host is not \&quot;200\&quot;. &quot;</span> <span class="ruby-operator">+</span>
105:                                        <span class="ruby-node">&quot;Got status #{resp.code.inspect} for #{resp.final_url}&quot;</span>, <span class="ruby-identifier">resp</span>)
106:             <span class="ruby-identifier">exc</span>.<span class="ruby-identifier">identity_url</span> = <span class="ruby-identifier">result</span>.<span class="ruby-identifier">normalized_uri</span>
107:             <span class="ruby-identifier">raise</span> <span class="ruby-identifier">exc</span>
108:         <span class="ruby-keyword kw">end</span>
109: 
110:         <span class="ruby-identifier">result</span>.<span class="ruby-identifier">content_type</span> = <span class="ruby-identifier">resp</span>[<span class="ruby-value str">'content-type'</span>]
111:       <span class="ruby-keyword kw">end</span>
112: 
113:       <span class="ruby-identifier">result</span>.<span class="ruby-identifier">response_text</span> = <span class="ruby-identifier">resp</span>.<span class="ruby-identifier">body</span>
114:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">result</span>
115:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000528">
                    
                    <a name="M000528"></a><b>each_service</b>(xrds_tree, &amp;block)
                    
                </div>
                
                <div class="description">
                  <p>
aka iterServices in Python
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000528_source')" id="l_M000528_source">show</a>
                        
                    </p>
                    <div id="M000528_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/openid/yadis/xrds.rb, line 125</span>
125:     <span class="ruby-keyword kw">def</span> <span class="ruby-constant">Yadis</span><span class="ruby-operator">::</span><span class="ruby-identifier">each_service</span>(<span class="ruby-identifier">xrds_tree</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
126:       <span class="ruby-identifier">xrd</span> = <span class="ruby-identifier">get_yadis_xrd</span>(<span class="ruby-identifier">xrds_tree</span>)
127:       <span class="ruby-identifier">xrd</span>.<span class="ruby-identifier">each_element</span>(<span class="ruby-value str">'Service'</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
128:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000531">
                    
                    <a name="M000531"></a><b>expand_service</b>(service_element)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000531_source')" id="l_M000531_source">show</a>
                        
                    </p>
                    <div id="M000531_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/openid/yadis/xrds.rb, line 138</span>
138:     <span class="ruby-keyword kw">def</span> <span class="ruby-constant">Yadis</span><span class="ruby-operator">::</span><span class="ruby-identifier">expand_service</span>(<span class="ruby-identifier">service_element</span>)
139:       <span class="ruby-identifier">es</span> = <span class="ruby-identifier">service_element</span>.<span class="ruby-identifier">elements</span>
140:       <span class="ruby-identifier">uris</span> = <span class="ruby-identifier">es</span>.<span class="ruby-identifier">each</span>(<span class="ruby-value str">'URI'</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">u</span><span class="ruby-operator">|</span> }
141:       <span class="ruby-identifier">uris</span> = <span class="ruby-identifier">prio_sort</span>(<span class="ruby-identifier">uris</span>)
142:       <span class="ruby-identifier">types</span> = <span class="ruby-identifier">es</span>.<span class="ruby-identifier">each</span>(<span class="ruby-value str">'Type/text()'</span>)
143:       <span class="ruby-comment cmt"># REXML::Text objects are not strings.</span>
144:       <span class="ruby-identifier">types</span> = <span class="ruby-identifier">types</span>.<span class="ruby-identifier">collect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span> <span class="ruby-identifier">t</span>.<span class="ruby-identifier">to_s</span> }
145:       <span class="ruby-identifier">uris</span>.<span class="ruby-identifier">collect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">uri</span><span class="ruby-operator">|</span> [<span class="ruby-identifier">types</span>, <span class="ruby-identifier">uri</span>.<span class="ruby-identifier">text</span>, <span class="ruby-identifier">service_element</span>] }
146:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000469">
                    
                    <a name="M000469"></a><b>generate_accept_header</b>(*elements)
                    
                </div>
                
                <div class="description">
                  <p>
Generate an accept header value
</p>
<dl>
<dt>str or (str, float)</dt><dd>-> str

</dd>
</dl>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000469_source')" id="l_M000469_source">show</a>
                        
                    </p>
                    <div id="M000469_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/openid/yadis/accept.rb, line 8</span>
 8:     <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">generate_accept_header</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">elements</span>)
 9:       <span class="ruby-identifier">parts</span> = []
10:       <span class="ruby-identifier">elements</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">element</span><span class="ruby-operator">|</span>
11:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">element</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>)
12:           <span class="ruby-identifier">qs</span> = <span class="ruby-value str">&quot;1.0&quot;</span>
13:           <span class="ruby-identifier">mtype</span> = <span class="ruby-identifier">element</span>
14:         <span class="ruby-keyword kw">else</span>
15:           <span class="ruby-identifier">mtype</span>, <span class="ruby-identifier">q</span> = <span class="ruby-identifier">element</span>
16:           <span class="ruby-identifier">q</span> = <span class="ruby-identifier">q</span>.<span class="ruby-identifier">to_f</span>
17:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">q</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">q</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-value">0</span>
18:             <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;Invalid preference factor: #{q}&quot;</span>)
19:           <span class="ruby-keyword kw">end</span>
20:           <span class="ruby-identifier">qs</span> = <span class="ruby-identifier">sprintf</span>(<span class="ruby-value str">&quot;%0.1f&quot;</span>, <span class="ruby-identifier">q</span>)
21:         <span class="ruby-keyword kw">end</span>
22: 
23:         <span class="ruby-identifier">parts</span> <span class="ruby-operator">&lt;&lt;</span> [<span class="ruby-identifier">qs</span>, <span class="ruby-identifier">mtype</span>]
24:       }
25: 
26:       <span class="ruby-identifier">parts</span>.<span class="ruby-identifier">sort!</span>
27:       <span class="ruby-identifier">chunks</span> = []
28:       <span class="ruby-identifier">parts</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">q</span>, <span class="ruby-identifier">mtype</span><span class="ruby-operator">|</span>
29:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">q</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'1.0'</span>
30:           <span class="ruby-identifier">chunks</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">mtype</span>
31:         <span class="ruby-keyword kw">else</span>
32:           <span class="ruby-identifier">chunks</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">sprintf</span>(<span class="ruby-value str">&quot;%s; q=%s&quot;</span>, <span class="ruby-identifier">mtype</span>, <span class="ruby-identifier">q</span>)
33:         <span class="ruby-keyword kw">end</span>
34:       }
35: 
36:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">chunks</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">', '</span>)
37:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000478">
                    
                    <a name="M000478"></a><b>get_acceptable</b>(accept_header, have_types)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000478_source')" id="l_M000478_source">show</a>
                        
                    </p>
                    <div id="M000478_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/openid/yadis/accept.rb, line 132</span>
132:     <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">get_acceptable</span>(<span class="ruby-identifier">accept_header</span>, <span class="ruby-identifier">have_types</span>)
133:       <span class="ruby-comment cmt"># Parse the accept header and return a list of available types</span>
134:       <span class="ruby-comment cmt"># in preferred order. If a type is unacceptable, it will not be</span>
135:       <span class="ruby-comment cmt"># in the resulting list.</span>
136:       <span class="ruby-comment cmt">#</span>
137:       <span class="ruby-comment cmt"># This is a convenience wrapper around matchTypes and</span>
138:       <span class="ruby-comment cmt"># parse_accept_header</span>
139:       <span class="ruby-comment cmt">#</span>
140:       <span class="ruby-comment cmt"># (str, [str]) -&gt; [str]</span>
141:       <span class="ruby-identifier">accepted</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">parse_accept_header</span>(<span class="ruby-identifier">accept_header</span>)
142:       <span class="ruby-identifier">preferred</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">match_types</span>(<span class="ruby-identifier">accepted</span>, <span class="ruby-identifier">have_types</span>)
143:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">preferred</span>.<span class="ruby-identifier">collect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">mtype</span>, <span class="ruby-identifier">_</span><span class="ruby-operator">|</span> <span class="ruby-identifier">mtype</span> }
144:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000517">
                    
                    <a name="M000517"></a><b>get_canonical_id</b>(iname, xrd_tree)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000517_source')" id="l_M000517_source">show</a>
                        
                    </p>
                    <div id="M000517_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/openid/yadis/xrds.rb, line 25</span>
25:     <span class="ruby-keyword kw">def</span> <span class="ruby-constant">Yadis</span><span class="ruby-operator">::</span><span class="ruby-identifier">get_canonical_id</span>(<span class="ruby-identifier">iname</span>, <span class="ruby-identifier">xrd_tree</span>)
26:       <span class="ruby-comment cmt"># Return the CanonicalID from this XRDS document.</span>
27:       <span class="ruby-comment cmt">#</span>
28:       <span class="ruby-comment cmt"># @param iname: the XRI being resolved.</span>
29:       <span class="ruby-comment cmt"># @type iname: unicode</span>
30:       <span class="ruby-comment cmt">#</span>
31:       <span class="ruby-comment cmt"># @param xrd_tree: The XRDS output from the resolver.</span>
32:       <span class="ruby-comment cmt">#</span>
33:       <span class="ruby-comment cmt"># @returns: The XRI CanonicalID or None.</span>
34:       <span class="ruby-comment cmt"># @returntype: unicode or None</span>
35: 
36:       <span class="ruby-identifier">xrd_list</span> = []
37:       <span class="ruby-constant">REXML</span><span class="ruby-operator">::</span><span class="ruby-constant">XPath</span><span class="ruby-operator">::</span><span class="ruby-identifier">match</span>(<span class="ruby-identifier">xrd_tree</span>.<span class="ruby-identifier">root</span>, <span class="ruby-value str">'/xrds:XRDS/xrd:XRD'</span>, <span class="ruby-constant">XRDS_NAMESPACES</span>).<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">el</span><span class="ruby-operator">|</span>
38:         <span class="ruby-identifier">xrd_list</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">el</span>
39:       }
40: 
41:       <span class="ruby-identifier">xrd_list</span>.<span class="ruby-identifier">reverse!</span>
42: 
43:       <span class="ruby-identifier">cid_elements</span> = []
44: 
45:       <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">xrd_list</span>.<span class="ruby-identifier">empty?</span>
46:         <span class="ruby-identifier">xrd_list</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">elements</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">e</span><span class="ruby-operator">|</span>
47:           <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">e</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value str">'name'</span>)
48:             <span class="ruby-keyword kw">next</span>
49:           <span class="ruby-keyword kw">end</span>
50:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">e</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'CanonicalID'</span>
51:             <span class="ruby-identifier">cid_elements</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">e</span>
52:           <span class="ruby-keyword kw">end</span>
53:         }
54:       <span class="ruby-keyword kw">end</span>
55: 
56:       <span class="ruby-identifier">cid_element</span> = <span class="ruby-identifier">cid_elements</span>[<span class="ruby-value">0</span>]
57: 
58:       <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">cid_element</span>
59:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span>
60:       <span class="ruby-keyword kw">end</span>
61: 
62:       <span class="ruby-identifier">canonicalID</span> = <span class="ruby-constant">XRI</span>.<span class="ruby-identifier">make_xri</span>(<span class="ruby-identifier">cid_element</span>.<span class="ruby-identifier">text</span>)
63: 
64:       <span class="ruby-identifier">childID</span> = <span class="ruby-identifier">canonicalID</span>.<span class="ruby-identifier">downcase</span>
65: 
66:       <span class="ruby-identifier">xrd_list</span>[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>].<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">xrd</span><span class="ruby-operator">|</span>
67:         <span class="ruby-identifier">parent_sought</span> = <span class="ruby-identifier">childID</span>[<span class="ruby-value">0</span><span class="ruby-operator">...</span><span class="ruby-identifier">childID</span>.<span class="ruby-identifier">rindex</span>(<span class="ruby-value str">'!'</span>)]
68: 
69:         <span class="ruby-identifier">parent</span> = <span class="ruby-constant">XRI</span>.<span class="ruby-identifier">make_xri</span>(<span class="ruby-identifier">xrd</span>.<span class="ruby-identifier">elements</span>[<span class="ruby-value str">&quot;CanonicalID&quot;</span>].<span class="ruby-identifier">text</span>)
70: 
71:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">parent_sought</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">parent</span>.<span class="ruby-identifier">downcase</span>
72:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">XRDSFraud</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">sprintf</span>(<span class="ruby-value str">&quot;%s can not come from %s&quot;</span>, <span class="ruby-identifier">parent_sought</span>,
73:                                       <span class="ruby-identifier">parent</span>))
74:         <span class="ruby-keyword kw">end</span>
75: 
76:         <span class="ruby-identifier">childID</span> = <span class="ruby-identifier">parent_sought</span>
77:       }
78: 
79:       <span class="ruby-identifier">root</span> = <span class="ruby-constant">XRI</span>.<span class="ruby-identifier">root_authority</span>(<span class="ruby-identifier">iname</span>)
80:       <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">not</span> <span class="ruby-constant">XRI</span>.<span class="ruby-identifier">provider_is_authoritative</span>(<span class="ruby-identifier">root</span>, <span class="ruby-identifier">childID</span>)
81:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">XRDSFraud</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">sprintf</span>(<span class="ruby-value str">&quot;%s can not come from root %s&quot;</span>, <span class="ruby-identifier">childID</span>, <span class="ruby-identifier">root</span>))
82:       <span class="ruby-keyword kw">end</span>
83: 
84:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">canonicalID</span>
85:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000514">
                    
                    <a name="M000514"></a><b>get_service_endpoints</b>(input_url, flt=nil)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000514_source')" id="l_M000514_source">show</a>
                        
                    </p>
                    <div id="M000514_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/openid/yadis/services.rb, line 8</span>
 8:     <span class="ruby-keyword kw">def</span> <span class="ruby-constant">Yadis</span>.<span class="ruby-identifier">get_service_endpoints</span>(<span class="ruby-identifier">input_url</span>, <span class="ruby-identifier">flt</span>=<span class="ruby-keyword kw">nil</span>)
 9:       <span class="ruby-comment cmt"># Perform the Yadis protocol on the input URL and return an</span>
10:       <span class="ruby-comment cmt"># iterable of resulting endpoint objects.</span>
11:       <span class="ruby-comment cmt">#</span>
12:       <span class="ruby-comment cmt"># @param flt: A filter object or something that is convertable</span>
13:       <span class="ruby-comment cmt"># to a filter object (using mkFilter) that will be used to</span>
14:       <span class="ruby-comment cmt"># generate endpoint objects. This defaults to generating</span>
15:       <span class="ruby-comment cmt"># BasicEndpoint objects.</span>
16:       <span class="ruby-identifier">result</span> = <span class="ruby-constant">Yadis</span>.<span class="ruby-identifier">discover</span>(<span class="ruby-identifier">input_url</span>)
17:       <span class="ruby-keyword kw">begin</span>
18:         <span class="ruby-identifier">endpoints</span> = <span class="ruby-constant">Yadis</span>.<span class="ruby-identifier">apply_filter</span>(<span class="ruby-identifier">result</span>.<span class="ruby-identifier">normalized_uri</span>,
19:                                        <span class="ruby-identifier">result</span>.<span class="ruby-identifier">response_text</span>, <span class="ruby-identifier">flt</span>)
20:       <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">XRDSError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">err</span>
21:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">DiscoveryFailure</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">err</span>.<span class="ruby-identifier">to_s</span>, <span class="ruby-keyword kw">nil</span>)
22:       <span class="ruby-keyword kw">end</span>
23: 
24:       <span class="ruby-keyword kw">return</span> [<span class="ruby-identifier">result</span>.<span class="ruby-identifier">normalized_uri</span>, <span class="ruby-identifier">endpoints</span>]
25:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000527">
                    
                    <a name="M000527"></a><b>get_yadis_xrd</b>(xrds_tree)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000527_source')" id="l_M000527_source">show</a>
                        
                    </p>
                    <div id="M000527_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/openid/yadis/xrds.rb, line 115</span>
115:     <span class="ruby-keyword kw">def</span> <span class="ruby-constant">Yadis</span><span class="ruby-operator">::</span><span class="ruby-identifier">get_yadis_xrd</span>(<span class="ruby-identifier">xrds_tree</span>)
116:       <span class="ruby-constant">REXML</span><span class="ruby-operator">::</span><span class="ruby-constant">XPath</span>.<span class="ruby-identifier">each</span>(<span class="ruby-identifier">xrds_tree</span>.<span class="ruby-identifier">root</span>,
117:                         <span class="ruby-value str">'/xrds:XRDS/xrd:XRD[last()]'</span>,
118:                         <span class="ruby-constant">XRDS_NAMESPACES</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">el</span><span class="ruby-operator">|</span>
119:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">el</span>
120:       }
121:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">XRDSError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;No XRD element found.&quot;</span>)
122:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000500">
                    
                    <a name="M000500"></a><b>html_yadis_location</b>(html)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000500_source')" id="l_M000500_source">show</a>
                        
                    </p>
                    <div id="M000500_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/openid/yadis/parsehtml.rb, line 6</span>
 6:     <span class="ruby-keyword kw">def</span> <span class="ruby-constant">Yadis</span>.<span class="ruby-identifier">html_yadis_location</span>(<span class="ruby-identifier">html</span>)
 7:       <span class="ruby-identifier">parser</span> = <span class="ruby-constant">HTMLTokenizer</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">html</span>)
 8: 
 9:       <span class="ruby-comment cmt"># to keep track of whether or not we are in the head element</span>
10:       <span class="ruby-identifier">in_head</span> = <span class="ruby-keyword kw">false</span>
11: 
12:       <span class="ruby-keyword kw">begin</span>
13:         <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">el</span> = <span class="ruby-identifier">parser</span>.<span class="ruby-identifier">getTag</span>(<span class="ruby-value str">'head'</span>, <span class="ruby-value str">'/head'</span>, <span class="ruby-value str">'meta'</span>, <span class="ruby-value str">'body'</span>, <span class="ruby-value str">'/body'</span>,
14:                                  <span class="ruby-value str">'html'</span>, <span class="ruby-value str">'script'</span>)
15: 
16:           <span class="ruby-comment cmt"># we are leaving head or have reached body, so we bail</span>
17:           <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">if</span> [<span class="ruby-value str">'/head'</span>, <span class="ruby-value str">'body'</span>, <span class="ruby-value str">'/body'</span>].<span class="ruby-identifier">member?</span>(<span class="ruby-identifier">el</span>.<span class="ruby-identifier">tag_name</span>)
18: 
19:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">el</span>.<span class="ruby-identifier">tag_name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'head'</span>
20:             <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">el</span>.<span class="ruby-identifier">to_s</span>[<span class="ruby-value">-2</span>] <span class="ruby-operator">==</span> <span class="ruby-value">?/</span> <span class="ruby-comment cmt"># tag ends with a /: a short tag</span>
21:               <span class="ruby-identifier">in_head</span> = <span class="ruby-keyword kw">true</span>
22:             <span class="ruby-keyword kw">end</span>
23:           <span class="ruby-keyword kw">end</span>
24:           <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">in_head</span>
25: 
26:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">el</span>.<span class="ruby-identifier">tag_name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'script'</span>
27:             <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">el</span>.<span class="ruby-identifier">to_s</span>[<span class="ruby-value">-2</span>] <span class="ruby-operator">==</span> <span class="ruby-value">?/</span> <span class="ruby-comment cmt"># tag ends with a /: a short tag</span>
28:               <span class="ruby-identifier">parser</span>.<span class="ruby-identifier">getTag</span>(<span class="ruby-value str">'/script'</span>)
29:             <span class="ruby-keyword kw">end</span>
30:           <span class="ruby-keyword kw">end</span>
31: 
32:           <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">el</span>.<span class="ruby-identifier">tag_name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'html'</span>
33: 
34:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">el</span>.<span class="ruby-identifier">tag_name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'meta'</span> <span class="ruby-keyword kw">and</span> (<span class="ruby-identifier">equiv</span> = <span class="ruby-identifier">el</span>.<span class="ruby-identifier">attr_hash</span>[<span class="ruby-value str">'http-equiv'</span>])
35:             <span class="ruby-keyword kw">if</span> [<span class="ruby-value str">'x-xrds-location'</span>,<span class="ruby-value str">'x-yadis-location'</span>].<span class="ruby-identifier">member?</span>(<span class="ruby-identifier">equiv</span>.<span class="ruby-identifier">downcase</span>) <span class="ruby-operator">&amp;&amp;</span>
36:                 <span class="ruby-identifier">el</span>.<span class="ruby-identifier">attr_hash</span>.<span class="ruby-identifier">member?</span>(<span class="ruby-value str">'content'</span>)
37:               <span class="ruby-keyword kw">return</span> <span class="ruby-constant">CGI</span><span class="ruby-operator">::</span><span class="ruby-identifier">unescapeHTML</span>(<span class="ruby-identifier">el</span>.<span class="ruby-identifier">attr_hash</span>[<span class="ruby-value str">'content'</span>])
38:             <span class="ruby-keyword kw">end</span>
39:           <span class="ruby-keyword kw">end</span>
40:         <span class="ruby-keyword kw">end</span>
41:       <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">HTMLTokenizerError</span> <span class="ruby-comment cmt"># just stop parsing if there's an error</span>
42:       <span class="ruby-keyword kw">end</span>
43:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000526">
                    
                    <a name="M000526"></a><b>is_xrds?</b>(xrds_tree)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000526_source')" id="l_M000526_source">show</a>
                        
                    </p>
                    <div id="M000526_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/openid/yadis/xrds.rb, line 108</span>
108:     <span class="ruby-keyword kw">def</span> <span class="ruby-constant">Yadis</span><span class="ruby-operator">::</span><span class="ruby-identifier">is_xrds?</span>(<span class="ruby-identifier">xrds_tree</span>)
109:       <span class="ruby-identifier">xrds_root</span> = <span class="ruby-identifier">xrds_tree</span>.<span class="ruby-identifier">root</span>
110:       <span class="ruby-keyword kw">return</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">xrds_root</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">and</span>
111:         <span class="ruby-identifier">xrds_root</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'XRDS'</span> <span class="ruby-keyword kw">and</span>
112:         <span class="ruby-identifier">xrds_root</span>.<span class="ruby-identifier">namespace</span> <span class="ruby-operator">==</span> <span class="ruby-constant">XRDS_NS</span>)
113:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000494">
                    
                    <a name="M000494"></a><b>make_filter</b>(parts)
                    
                </div>
                
                <div class="description">
                  <p>
Convert a filter-convertable thing into a filter
</p>
<p>
parts should be a filter, an endpoint, a callable, or a list of any of
these.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000494_source')" id="l_M000494_source">show</a>
                        
                    </p>
                    <div id="M000494_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/openid/yadis/filters.rb, line 145</span>
145:     <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">make_filter</span>(<span class="ruby-identifier">parts</span>)
146:       <span class="ruby-comment cmt"># Convert the parts into a list, and pass to mk_compound_filter</span>
147:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">parts</span>.<span class="ruby-identifier">nil?</span>
148:         <span class="ruby-identifier">parts</span> = [<span class="ruby-constant">BasicServiceEndpoint</span>]
149:       <span class="ruby-keyword kw">end</span>
150: 
151:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">parts</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>)
152:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">mk_compound_filter</span>(<span class="ruby-identifier">parts</span>)
153:       <span class="ruby-keyword kw">else</span>
154:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">mk_compound_filter</span>([<span class="ruby-identifier">parts</span>])
155:       <span class="ruby-keyword kw">end</span>
156:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000477">
                    
                    <a name="M000477"></a><b>match_types</b>(accept_types, have_types)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000477_source')" id="l_M000477_source">show</a>
                        
                    </p>
                    <div id="M000477_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/openid/yadis/accept.rb, line 80</span>
 80:     <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">match_types</span>(<span class="ruby-identifier">accept_types</span>, <span class="ruby-identifier">have_types</span>)
 81:       <span class="ruby-comment cmt"># Given the result of parsing an Accept: header, and the</span>
 82:       <span class="ruby-comment cmt"># available MIME types, return the acceptable types with their</span>
 83:       <span class="ruby-comment cmt"># quality markdowns.</span>
 84:       <span class="ruby-comment cmt">#</span>
 85:       <span class="ruby-comment cmt"># For example:</span>
 86:       <span class="ruby-comment cmt">#</span>
 87:       <span class="ruby-comment cmt"># &gt;&gt;&gt; acceptable = parse_accept_header('text/html, text/plain; q=0.5')</span>
 88:       <span class="ruby-comment cmt"># &gt;&gt;&gt; matchTypes(acceptable, ['text/plain', 'text/html', 'image/jpeg'])</span>
 89:       <span class="ruby-comment cmt"># [('text/html', 1.0), ('text/plain', 0.5)]</span>
 90:       <span class="ruby-comment cmt">#</span>
 91:       <span class="ruby-comment cmt"># Type signature: ([(str, str, float)], [str]) -&gt; [(str, float)]</span>
 92:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">accept_types</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">accept_types</span> <span class="ruby-operator">==</span> []
 93:         <span class="ruby-comment cmt"># Accept all of them</span>
 94:         <span class="ruby-identifier">default</span> = <span class="ruby-value">1</span>
 95:       <span class="ruby-keyword kw">else</span>
 96:         <span class="ruby-identifier">default</span> = <span class="ruby-value">0</span>
 97:       <span class="ruby-keyword kw">end</span>
 98: 
 99:       <span class="ruby-identifier">match_main</span> = {}
100:       <span class="ruby-identifier">match_sub</span> = {}
101:       <span class="ruby-identifier">accept_types</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">main</span>, <span class="ruby-identifier">sub</span>, <span class="ruby-identifier">q</span><span class="ruby-operator">|</span>
102:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">main</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'*'</span>
103:           <span class="ruby-identifier">default</span> = [<span class="ruby-identifier">default</span>, <span class="ruby-identifier">q</span>].<span class="ruby-identifier">max</span>
104:           <span class="ruby-keyword kw">next</span>
105:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">sub</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'*'</span>
106:           <span class="ruby-identifier">match_main</span>[<span class="ruby-identifier">main</span>] = [<span class="ruby-identifier">match_main</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-identifier">main</span>, <span class="ruby-value">0</span>), <span class="ruby-identifier">q</span>].<span class="ruby-identifier">max</span>
107:         <span class="ruby-keyword kw">else</span>
108:           <span class="ruby-identifier">match_sub</span>[[<span class="ruby-identifier">main</span>, <span class="ruby-identifier">sub</span>]] = [<span class="ruby-identifier">match_sub</span>.<span class="ruby-identifier">fetch</span>([<span class="ruby-identifier">main</span>, <span class="ruby-identifier">sub</span>], <span class="ruby-value">0</span>), <span class="ruby-identifier">q</span>].<span class="ruby-identifier">max</span>
109:         <span class="ruby-keyword kw">end</span>
110:       }
111: 
112:       <span class="ruby-identifier">accepted_list</span> = []
113:       <span class="ruby-identifier">order_maintainer</span> = <span class="ruby-value">0</span>
114:       <span class="ruby-identifier">have_types</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">mtype</span><span class="ruby-operator">|</span>
115:         <span class="ruby-identifier">main</span>, <span class="ruby-identifier">sub</span> = <span class="ruby-identifier">mtype</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">'/'</span>, <span class="ruby-value">2</span>)
116:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">match_sub</span>.<span class="ruby-identifier">member?</span>([<span class="ruby-identifier">main</span>, <span class="ruby-identifier">sub</span>])
117:           <span class="ruby-identifier">q</span> = <span class="ruby-identifier">match_sub</span>[[<span class="ruby-identifier">main</span>, <span class="ruby-identifier">sub</span>]]
118:         <span class="ruby-keyword kw">else</span>
119:           <span class="ruby-identifier">q</span> = <span class="ruby-identifier">match_main</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-identifier">main</span>, <span class="ruby-identifier">default</span>)
120:         <span class="ruby-keyword kw">end</span>
121: 
122:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">q</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
123:           <span class="ruby-identifier">accepted_list</span> <span class="ruby-operator">&lt;&lt;</span> [<span class="ruby-value">1</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">q</span>, <span class="ruby-identifier">order_maintainer</span>, <span class="ruby-identifier">q</span>, <span class="ruby-identifier">mtype</span>]
124:           <span class="ruby-identifier">order_maintainer</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
125:         <span class="ruby-keyword kw">end</span>
126:       }
127: 
128:       <span class="ruby-identifier">accepted_list</span>.<span class="ruby-identifier">sort!</span>
129:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">accepted_list</span>.<span class="ruby-identifier">collect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">_</span>, <span class="ruby-identifier">_</span>, <span class="ruby-identifier">q</span>, <span class="ruby-identifier">mtype</span><span class="ruby-operator">|</span> [<span class="ruby-identifier">mtype</span>, <span class="ruby-identifier">q</span>] }
130:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000495">
                    
                    <a name="M000495"></a><b>mk_compound_filter</b>(parts)
                    
                </div>
                
                <div class="description">
                  <p>
Create a filter out of a list of filter-like things
</p>
<p>
Used by <a href="Yadis.html#M000494">make_filter</a>
</p>
<p>
parts should be a list of things that can be passed to <a
href="Yadis.html#M000494">make_filter</a>
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000495_source')" id="l_M000495_source">show</a>
                        
                    </p>
                    <div id="M000495_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/openid/yadis/filters.rb, line 163</span>
163:     <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">mk_compound_filter</span>(<span class="ruby-identifier">parts</span>)
164: 
165:       <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">parts</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value str">'each'</span>)
166:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">TypeError</span>, <span class="ruby-node">&quot;#{parts.inspect} is not iterable&quot;</span>
167:       <span class="ruby-keyword kw">end</span>
168: 
169:       <span class="ruby-comment cmt"># Separate into a list of callables and a list of filter objects</span>
170:       <span class="ruby-identifier">transformers</span> = []
171:       <span class="ruby-identifier">filters</span> = []
172:       <span class="ruby-identifier">parts</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">subfilter</span><span class="ruby-operator">|</span>
173:         <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">subfilter</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>)
174:           <span class="ruby-comment cmt"># If it's not an iterable</span>
175:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">subfilter</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value str">'get_service_endpoints'</span>)
176:             <span class="ruby-comment cmt"># It's a full filter</span>
177:             <span class="ruby-identifier">filters</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">subfilter</span>
178:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">subfilter</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value str">'from_basic_service_endpoint'</span>)
179:             <span class="ruby-comment cmt"># It's an endpoint object, so put its endpoint conversion</span>
180:             <span class="ruby-comment cmt"># attribute into the list of endpoint transformers</span>
181:             <span class="ruby-identifier">transformers</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">subfilter</span>.<span class="ruby-identifier">method</span>(<span class="ruby-value str">'from_basic_service_endpoint'</span>)
182:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">subfilter</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value str">'call'</span>)
183:             <span class="ruby-comment cmt"># It's a proc, so add it to the list of endpoint</span>
184:             <span class="ruby-comment cmt"># transformers</span>
185:             <span class="ruby-identifier">transformers</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">subfilter</span>
186:           <span class="ruby-keyword kw">else</span>
187:             <span class="ruby-identifier">raise</span> <span class="ruby-ivar">@@filter_type_error</span>
188:           <span class="ruby-keyword kw">end</span>
189:         <span class="ruby-keyword kw">else</span>
190:           <span class="ruby-identifier">filters</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">mk_compound_filter</span>(<span class="ruby-identifier">subfilter</span>)
191:         <span class="ruby-keyword kw">end</span>
192:       }
193: 
194:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">transformers</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
195:         <span class="ruby-identifier">filters</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">TransformFilterMaker</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">transformers</span>)
196:       <span class="ruby-keyword kw">end</span>
197: 
198:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">filters</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span>
199:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">filters</span>[<span class="ruby-value">0</span>]
200:       <span class="ruby-keyword kw">else</span>
201:         <span class="ruby-keyword kw">return</span> <span class="ruby-constant">CompoundFilter</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">filters</span>)
202:       <span class="ruby-keyword kw">end</span>
203:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000524">
                    
                    <a name="M000524"></a><b>parseXRDS</b>(text)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000524_source')" id="l_M000524_source">show</a>
                        
                    </p>
                    <div id="M000524_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/openid/yadis/xrds.rb, line 90</span>
 90:     <span class="ruby-keyword kw">def</span> <span class="ruby-constant">Yadis</span><span class="ruby-operator">::</span><span class="ruby-identifier">parseXRDS</span>(<span class="ruby-identifier">text</span>)
 91:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">text</span>.<span class="ruby-identifier">nil?</span>
 92:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">XRDSError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;Not an XRDS document.&quot;</span>)
 93:       <span class="ruby-keyword kw">end</span>
 94: 
 95:       <span class="ruby-keyword kw">begin</span>
 96:         <span class="ruby-identifier">d</span> = <span class="ruby-constant">REXML</span><span class="ruby-operator">::</span><span class="ruby-constant">Document</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">text</span>)
 97:       <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">RuntimeError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">why</span>
 98:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">XRDSError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;Not an XRDS document. Failed to parse XML.&quot;</span>)
 99:       <span class="ruby-keyword kw">end</span>
100: 
101:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">is_xrds?</span>(<span class="ruby-identifier">d</span>)
102:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">d</span>
103:       <span class="ruby-keyword kw">else</span>
104:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">XRDSError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;Not an XRDS document.&quot;</span>)
105:       <span class="ruby-keyword kw">end</span>
106:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000472">
                    
                    <a name="M000472"></a><b>parse_accept_header</b>(value)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000472_source')" id="l_M000472_source">show</a>
                        
                    </p>
                    <div id="M000472_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/openid/yadis/accept.rb, line 39</span>
39:     <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">parse_accept_header</span>(<span class="ruby-identifier">value</span>)
40:       <span class="ruby-comment cmt"># Parse an accept header, ignoring any accept-extensions</span>
41:       <span class="ruby-comment cmt">#</span>
42:       <span class="ruby-comment cmt"># returns a list of tuples containing main MIME type, MIME</span>
43:       <span class="ruby-comment cmt"># subtype, and quality markdown.</span>
44:       <span class="ruby-comment cmt">#</span>
45:       <span class="ruby-comment cmt"># str -&gt; [(str, str, float)]</span>
46:       <span class="ruby-identifier">chunks</span> = <span class="ruby-identifier">value</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">','</span>, <span class="ruby-value">-1</span>).<span class="ruby-identifier">collect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">strip</span> }
47:       <span class="ruby-identifier">accept</span> = []
48:       <span class="ruby-identifier">chunks</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">chunk</span><span class="ruby-operator">|</span>
49:         <span class="ruby-identifier">parts</span> = <span class="ruby-identifier">chunk</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;;&quot;</span>, <span class="ruby-value">-1</span>).<span class="ruby-identifier">collect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">strip</span> }
50: 
51:         <span class="ruby-identifier">mtype</span> = <span class="ruby-identifier">parts</span>.<span class="ruby-identifier">shift</span>
52:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">mtype</span>.<span class="ruby-identifier">index</span>(<span class="ruby-value str">'/'</span>).<span class="ruby-identifier">nil?</span>
53:           <span class="ruby-comment cmt"># This is not a MIME type, so ignore the bad data</span>
54:           <span class="ruby-keyword kw">next</span>
55:         <span class="ruby-keyword kw">end</span>
56: 
57:         <span class="ruby-identifier">main</span>, <span class="ruby-identifier">sub</span> = <span class="ruby-identifier">mtype</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">'/'</span>, <span class="ruby-value">2</span>)
58: 
59:         <span class="ruby-identifier">q</span> = <span class="ruby-keyword kw">nil</span>
60:         <span class="ruby-identifier">parts</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">ext</span><span class="ruby-operator">|</span>
61:           <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">ext</span>.<span class="ruby-identifier">index</span>(<span class="ruby-value str">'='</span>).<span class="ruby-identifier">nil?</span>
62:             <span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span> = <span class="ruby-identifier">ext</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">'='</span>, <span class="ruby-value">2</span>)
63:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">k</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'q'</span>
64:               <span class="ruby-identifier">q</span> = <span class="ruby-identifier">v</span>.<span class="ruby-identifier">to_f</span>
65:             <span class="ruby-keyword kw">end</span>
66:           <span class="ruby-keyword kw">end</span>
67:         }
68: 
69:         <span class="ruby-identifier">q</span> = <span class="ruby-value">1.0</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">q</span>.<span class="ruby-identifier">nil?</span>
70: 
71:         <span class="ruby-identifier">accept</span> <span class="ruby-operator">&lt;&lt;</span> [<span class="ruby-identifier">q</span>, <span class="ruby-identifier">main</span>, <span class="ruby-identifier">sub</span>]
72:       }
73: 
74:       <span class="ruby-identifier">accept</span>.<span class="ruby-identifier">sort!</span>
75:       <span class="ruby-identifier">accept</span>.<span class="ruby-identifier">reverse!</span>
76: 
77:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">accept</span>.<span class="ruby-identifier">collect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">q</span>, <span class="ruby-identifier">main</span>, <span class="ruby-identifier">sub</span><span class="ruby-operator">|</span> [<span class="ruby-identifier">main</span>, <span class="ruby-identifier">sub</span>, <span class="ruby-identifier">q</span>] }
78:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000532">
                    
                    <a name="M000532"></a><b>prio_sort</b>(elements)
                    
                </div>
                
                <div class="description">
                  <p>
Sort a list of elements that have priority attributes.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000532_source')" id="l_M000532_source">show</a>
                        
                    </p>
                    <div id="M000532_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/openid/yadis/xrds.rb, line 149</span>
149:     <span class="ruby-keyword kw">def</span> <span class="ruby-constant">Yadis</span><span class="ruby-operator">::</span><span class="ruby-identifier">prio_sort</span>(<span class="ruby-identifier">elements</span>)
150:       <span class="ruby-identifier">elements</span>.<span class="ruby-identifier">sort</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">a</span>,<span class="ruby-identifier">b</span><span class="ruby-operator">|</span>
151:         <span class="ruby-identifier">a</span>.<span class="ruby-identifier">attribute</span>(<span class="ruby-value str">'priority'</span>).<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">&lt;=&gt;</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">attribute</span>(<span class="ruby-value str">'priority'</span>).<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">to_i</span>
152:       }
153:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000530">
                    
                    <a name="M000530"></a><b>services</b>(xrds_tree)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000530_source')" id="l_M000530_source">show</a>
                        
                    </p>
                    <div id="M000530_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/openid/yadis/xrds.rb, line 130</span>
130:     <span class="ruby-keyword kw">def</span> <span class="ruby-constant">Yadis</span><span class="ruby-operator">::</span><span class="ruby-identifier">services</span>(<span class="ruby-identifier">xrds_tree</span>)
131:       <span class="ruby-identifier">s</span> = []
132:       <span class="ruby-identifier">each_service</span>(<span class="ruby-identifier">xrds_tree</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">service</span><span class="ruby-operator">|</span>
133:         <span class="ruby-identifier">s</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">service</span>
134:       }
135:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">s</span>
136:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000491">
                    
                    <a name="M000491"></a><b>where_is_yadis?</b>(resp)
                    
                </div>
                
                <div class="description">
                  <p>
Given a <a href="HTTPResponse.html">HTTPResponse</a>, return the location
of the <a href="Yadis.html">Yadis</a> document.
</p>
<p>
May be the URL just retrieved, another URL, or None, if I can&#8217;t find
any.
</p>
<p>
[non-blocking]
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000491_source')" id="l_M000491_source">show</a>
                        
                    </p>
                    <div id="M000491_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/openid/yadis/discovery.rb, line 124</span>
124:     <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">where_is_yadis?</span>(<span class="ruby-identifier">resp</span>)
125:       <span class="ruby-comment cmt"># Attempt to find out where to go to discover the document or if</span>
126:       <span class="ruby-comment cmt"># we already have it</span>
127:       <span class="ruby-identifier">content_type</span> = <span class="ruby-identifier">resp</span>[<span class="ruby-value str">'content-type'</span>]
128: 
129:       <span class="ruby-comment cmt"># According to the spec, the content-type header must be an</span>
130:       <span class="ruby-comment cmt"># exact match, or else we have to look for an indirection.</span>
131:       <span class="ruby-keyword kw">if</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">content_type</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">and</span> <span class="ruby-operator">!</span><span class="ruby-identifier">content_type</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-keyword kw">and</span>
132:           <span class="ruby-identifier">content_type</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">';'</span>, <span class="ruby-value">2</span>)[<span class="ruby-value">0</span>].<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span> <span class="ruby-constant">YADIS_CONTENT_TYPE</span>)
133:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">resp</span>.<span class="ruby-identifier">final_url</span>
134:       <span class="ruby-keyword kw">else</span>
135:         <span class="ruby-comment cmt"># Try the header</span>
136:         <span class="ruby-identifier">yadis_loc</span> = <span class="ruby-identifier">resp</span>[<span class="ruby-constant">YADIS_HEADER_NAME</span>.<span class="ruby-identifier">downcase</span>]
137: 
138:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">yadis_loc</span>.<span class="ruby-identifier">nil?</span>
139:           <span class="ruby-comment cmt"># Parse as HTML if the header is missing.</span>
140:           <span class="ruby-comment cmt">#</span>
141:           <span class="ruby-comment cmt"># XXX: do we want to do something with content-type, like</span>
142:           <span class="ruby-comment cmt"># have a whitelist or a blacklist (for detecting that it's</span>
143:           <span class="ruby-comment cmt"># HTML)?</span>
144:           <span class="ruby-identifier">yadis_loc</span> = <span class="ruby-constant">Yadis</span>.<span class="ruby-identifier">html_yadis_location</span>(<span class="ruby-identifier">resp</span>.<span class="ruby-identifier">body</span>)
145:         <span class="ruby-keyword kw">end</span>
146:       <span class="ruby-keyword kw">end</span>
147: 
148:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">yadis_loc</span>
149:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    