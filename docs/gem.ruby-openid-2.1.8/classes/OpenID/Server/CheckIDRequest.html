<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>OpenID::Server::CheckIDRequest</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../../css/main.css" type="text/css" media="screen" />
    <script src="../../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Class</span> 
            OpenID::Server::CheckIDRequest 
            
                <span class="parent">&lt; 
                    
                    OpenIDRequest
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../../files/lib/openid/server_rb.html">lib/openid/server.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    
    <div class="description">
        <p>
A request to confirm the identity of a user.
</p>
<p>
This class handles requests for openid modes <tt>checkid_immediate</tt> and
<tt>checkid_setup</tt> .
</p>

    </div>
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>A</dt>
        <dd>
            <ul>
                
                <li><a href="#M000365">answer</a></li>
                
            </ul>
        </dd>
    
        <dt>C</dt>
        <dd>
            <ul>
                
                <li><a href="#M000374">cancel_url</a></li>
                
            </ul>
        </dd>
    
        <dt>E</dt>
        <dd>
            <ul>
                
                <li><a href="#M000373">encode_to_url</a></li>
                
            </ul>
        </dd>
    
        <dt>F</dt>
        <dd>
            <ul>
                
                <li><a href="#M000355">from_message</a></li>
                
            </ul>
        </dd>
    
        <dt>I</dt>
        <dd>
            <ul>
                
                <li><a href="#M000362">id_select</a></li>
                
            </ul>
        </dd>
    
        <dt>N</dt>
        <dd>
            <ul>
                
                <li><a href="#M000352">new</a></li>
                
            </ul>
        </dd>
    
        <dt>R</dt>
        <dd>
            <ul>
                
                <li><a href="#M000364">return_to_verified</a></li>
                
            </ul>
        </dd>
    
        <dt>T</dt>
        <dd>
            <ul>
                
                <li><a href="#M000375">to_s</a>,</li>
                
                <li><a href="#M000363">trust_root_valid</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    

    

    

    

    
    <div class="sectiontitle">Attributes</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>assoc_handle</td>
            <td class='attr-desc'><p>
Provided in smart mode requests, a handle for a previously established
association. nil for dumb mode requests.
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>immediate</td>
            <td class='attr-desc'><p>
Is this an immediate-mode request?
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>return_to</td>
            <td class='attr-desc'><p>
The URL to send the user agent back to to reply to this request.
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>identity</td>
            <td class='attr-desc'><p>
The OP-local identifier being checked.
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>claimed_id</td>
            <td class='attr-desc'><p>
The claimed identifier. Not present in <a
href="../../OpenID.html">OpenID</a> 1.x messages.
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>trust_root</td>
            <td class='attr-desc'><p>
This URL identifies the party making the request, and the user will use
that to make her decision about what answer she trusts them to have.
Referred to as &#8220;realm&#8221; in <a
href="../../OpenID.html">OpenID</a> 2.0.
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>mode</td>
            <td class='attr-desc'><table>
<tr><td valign="top">mode:</td><td><tt>checkid_immediate</tt> or <tt>checkid_setup</tt>

</td></tr>
</table></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>op_endpoint</td>
            <td class='attr-desc'></td>
        </tr>
        
    </table>
    

    
            <div class="sectiontitle">Class Public methods</div>
            
            <div class="method">
                <div class="title" id="M000355">
                    
                    <a name="M000355"></a><b>from_message</b>(message, op_endpoint)
                    
                </div>
                
                <div class="description">
                  <p>
Construct me from an <a href="../../OpenID.html">OpenID</a> message.
</p>
<table>
<tr><td valign="top">message:</td><td>An <a href="../../OpenID.html">OpenID</a> checkid_* request <a
href="../Message.html">Message</a>

</td></tr>
<tr><td valign="top"><a href="CheckIDRequest.html#op_endpoint">op_endpoint</a>:</td><td>The endpoint URL of the server that this message was sent to.

</td></tr>
</table>
<p>
Raises:
</p>
<table>
<tr><td valign="top">ProtocolError:</td><td>When not all required parameters are present in the message.

</td></tr>
<tr><td valign="top">MalformedReturnURL:</td><td>When the <tt><a href="CheckIDRequest.html#return_to">return_to</a></tt> URL
is not a URL.

</td></tr>
<tr><td valign="top">UntrustedReturnURL:</td><td>When the <tt><a href="CheckIDRequest.html#return_to">return_to</a></tt> URL
is outside the <tt><a
href="CheckIDRequest.html#trust_root">trust_root</a></tt>.

</td></tr>
</table>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000355_source')" id="l_M000355_source">show</a>
                        
                    </p>
                    <div id="M000355_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/openid/server.rb, line 490</span>
490:       <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">from_message</span>(<span class="ruby-identifier">message</span>, <span class="ruby-identifier">op_endpoint</span>)
491:         <span class="ruby-identifier">obj</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">allocate</span>
492:         <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">message</span> = <span class="ruby-identifier">message</span>
493:         <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">op_endpoint</span> = <span class="ruby-identifier">op_endpoint</span>
494:         <span class="ruby-identifier">mode</span> = <span class="ruby-identifier">message</span>.<span class="ruby-identifier">get_arg</span>(<span class="ruby-constant">OPENID_NS</span>, <span class="ruby-value str">'mode'</span>)
495:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">mode</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;checkid_immediate&quot;</span>
496:           <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">immediate</span> = <span class="ruby-keyword kw">true</span>
497:           <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">mode</span> = <span class="ruby-value str">&quot;checkid_immediate&quot;</span>
498:         <span class="ruby-keyword kw">else</span>
499:           <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">immediate</span> = <span class="ruby-keyword kw">false</span>
500:           <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">mode</span> = <span class="ruby-value str">&quot;checkid_setup&quot;</span>
501:         <span class="ruby-keyword kw">end</span>
502: 
503:         <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">return_to</span> = <span class="ruby-identifier">message</span>.<span class="ruby-identifier">get_arg</span>(<span class="ruby-constant">OPENID_NS</span>, <span class="ruby-value str">'return_to'</span>)
504:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">message</span>.<span class="ruby-identifier">is_openid1</span> <span class="ruby-keyword kw">and</span> <span class="ruby-operator">!</span><span class="ruby-identifier">obj</span>.<span class="ruby-identifier">return_to</span>
505:           <span class="ruby-identifier">msg</span> = <span class="ruby-identifier">sprintf</span>(<span class="ruby-value str">&quot;Missing required field 'return_to' from %s&quot;</span>,
506:                         <span class="ruby-identifier">message</span>)
507:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">ProtocolError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">message</span>, <span class="ruby-identifier">msg</span>)
508:         <span class="ruby-keyword kw">end</span>
509: 
510:         <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">identity</span> = <span class="ruby-identifier">message</span>.<span class="ruby-identifier">get_arg</span>(<span class="ruby-constant">OPENID_NS</span>, <span class="ruby-value str">'identity'</span>)
511:         <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">claimed_id</span> = <span class="ruby-identifier">message</span>.<span class="ruby-identifier">get_arg</span>(<span class="ruby-constant">OPENID_NS</span>, <span class="ruby-value str">'claimed_id'</span>)
512:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">message</span>.<span class="ruby-identifier">is_openid1</span>()
513:           <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">obj</span>.<span class="ruby-identifier">identity</span>
514:             <span class="ruby-identifier">s</span> = <span class="ruby-value str">&quot;OpenID 1 message did not contain openid.identity&quot;</span>
515:             <span class="ruby-identifier">raise</span> <span class="ruby-constant">ProtocolError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">message</span>, <span class="ruby-identifier">s</span>)
516:           <span class="ruby-keyword kw">end</span>
517:         <span class="ruby-keyword kw">else</span>
518:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">identity</span> <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">not</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">claimed_id</span>
519:             <span class="ruby-identifier">s</span> = (<span class="ruby-value str">&quot;OpenID 2.0 message contained openid.identity but not &quot;</span> <span class="ruby-operator">+</span>
520:                  <span class="ruby-value str">&quot;claimed_id&quot;</span>)
521:             <span class="ruby-identifier">raise</span> <span class="ruby-constant">ProtocolError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">message</span>, <span class="ruby-identifier">s</span>)
522:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">claimed_id</span> <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">not</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">identity</span>
523:             <span class="ruby-identifier">s</span> = (<span class="ruby-value str">&quot;OpenID 2.0 message contained openid.claimed_id but not &quot;</span> <span class="ruby-operator">+</span>
524:                  <span class="ruby-value str">&quot;identity&quot;</span>)
525:             <span class="ruby-identifier">raise</span> <span class="ruby-constant">ProtocolError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">message</span>, <span class="ruby-identifier">s</span>)
526:           <span class="ruby-keyword kw">end</span>
527:         <span class="ruby-keyword kw">end</span>
528: 
529:         <span class="ruby-comment cmt"># There's a case for making self.trust_root be a TrustRoot</span>
530:         <span class="ruby-comment cmt"># here.  But if TrustRoot isn't currently part of the &quot;public&quot;</span>
531:         <span class="ruby-comment cmt"># API, I'm not sure it's worth doing.</span>
532:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">message</span>.<span class="ruby-identifier">is_openid1</span>
533:           <span class="ruby-identifier">trust_root_param</span> = <span class="ruby-value str">'trust_root'</span>
534:         <span class="ruby-keyword kw">else</span>
535:           <span class="ruby-identifier">trust_root_param</span> = <span class="ruby-value str">'realm'</span>
536:         <span class="ruby-keyword kw">end</span>
537:         <span class="ruby-identifier">trust_root</span> = <span class="ruby-identifier">message</span>.<span class="ruby-identifier">get_arg</span>(<span class="ruby-constant">OPENID_NS</span>, <span class="ruby-identifier">trust_root_param</span>)
538:         <span class="ruby-identifier">trust_root</span> = <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">return_to</span> <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">trust_root</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">trust_root</span>.<span class="ruby-identifier">empty?</span>)
539:         <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">trust_root</span> = <span class="ruby-identifier">trust_root</span>
540: 
541:         <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">message</span>.<span class="ruby-identifier">is_openid1</span> <span class="ruby-keyword kw">and</span> <span class="ruby-operator">!</span><span class="ruby-identifier">obj</span>.<span class="ruby-identifier">return_to</span> <span class="ruby-keyword kw">and</span> <span class="ruby-operator">!</span><span class="ruby-identifier">obj</span>.<span class="ruby-identifier">trust_root</span>
542:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">ProtocolError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">message</span>, <span class="ruby-value str">&quot;openid.realm required when &quot;</span> <span class="ruby-operator">+</span>
543:                                   <span class="ruby-value str">&quot;openid.return_to absent&quot;</span>)
544:         <span class="ruby-keyword kw">end</span>
545: 
546:         <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">assoc_handle</span> = <span class="ruby-identifier">message</span>.<span class="ruby-identifier">get_arg</span>(<span class="ruby-constant">OPENID_NS</span>, <span class="ruby-value str">'assoc_handle'</span>)
547: 
548:         <span class="ruby-comment cmt"># Using TrustRoot.parse here is a bit misleading, as we're not</span>
549:         <span class="ruby-comment cmt"># parsing return_to as a trust root at all.  However, valid</span>
550:         <span class="ruby-comment cmt"># URLs are valid trust roots, so we can use this to get an</span>
551:         <span class="ruby-comment cmt"># idea if it is a valid URL.  Not all trust roots are valid</span>
552:         <span class="ruby-comment cmt"># return_to URLs, however (particularly ones with wildcards),</span>
553:         <span class="ruby-comment cmt"># so this is still a little sketchy.</span>
554:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">return_to</span> <span class="ruby-keyword kw">and</span> \
555:           <span class="ruby-operator">!</span><span class="ruby-constant">TrustRoot</span><span class="ruby-operator">::</span><span class="ruby-constant">TrustRoot</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">obj</span>.<span class="ruby-identifier">return_to</span>)
556:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">MalformedReturnURL</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">message</span>, <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">return_to</span>)
557:         <span class="ruby-keyword kw">end</span>
558: 
559:         <span class="ruby-comment cmt"># I first thought that checking to see if the return_to is</span>
560:         <span class="ruby-comment cmt"># within the trust_root is premature here, a</span>
561:         <span class="ruby-comment cmt"># logic-not-decoding thing.  But it was argued that this is</span>
562:         <span class="ruby-comment cmt"># really part of data validation.  A request with an invalid</span>
563:         <span class="ruby-comment cmt"># trust_root/return_to is broken regardless of application,</span>
564:         <span class="ruby-comment cmt"># right?</span>
565:         <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">obj</span>.<span class="ruby-identifier">trust_root_valid</span>()
566:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">UntrustedReturnURL</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">message</span>, <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">return_to</span>, <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">trust_root</span>)
567:         <span class="ruby-keyword kw">end</span>
568: 
569:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">obj</span>
570:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000352">
                    
                    <a name="M000352"></a><b>new</b>(identity, return_to, op_endpoint, trust_root=nil, immediate=false, assoc_handle=nil, claimed_id=nil)
                    
                </div>
                
                <div class="description">
                  <p>
These parameters are assigned directly as attributes, see the <a
href="CheckIDRequest.html">CheckIDRequest</a> class documentation for their
descriptions.
</p>
<p>
Raises <a href="MalformedReturnURL.html">MalformedReturnURL</a> when the
<tt><a href="CheckIDRequest.html#return_to">return_to</a></tt> URL is not a
URL.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000352_source')" id="l_M000352_source">show</a>
                        
                    </p>
                    <div id="M000352_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/openid/server.rb, line 447</span>
447:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">identity</span>, <span class="ruby-identifier">return_to</span>, <span class="ruby-identifier">op_endpoint</span>, <span class="ruby-identifier">trust_root</span>=<span class="ruby-keyword kw">nil</span>,
448:                      <span class="ruby-identifier">immediate</span>=<span class="ruby-keyword kw">false</span>, <span class="ruby-identifier">assoc_handle</span>=<span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">claimed_id</span>=<span class="ruby-keyword kw">nil</span>)
449:         <span class="ruby-ivar">@assoc_handle</span> = <span class="ruby-identifier">assoc_handle</span>
450:         <span class="ruby-ivar">@identity</span> = <span class="ruby-identifier">identity</span>
451:         <span class="ruby-ivar">@claimed_id</span> = (<span class="ruby-identifier">claimed_id</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">identity</span>)
452:         <span class="ruby-ivar">@return_to</span> = <span class="ruby-identifier">return_to</span>
453:         <span class="ruby-ivar">@trust_root</span> = (<span class="ruby-identifier">trust_root</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">return_to</span>)
454:         <span class="ruby-ivar">@op_endpoint</span> = <span class="ruby-identifier">op_endpoint</span>
455:         <span class="ruby-ivar">@message</span> = <span class="ruby-keyword kw">nil</span>
456: 
457:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">immediate</span>
458:           <span class="ruby-ivar">@immediate</span> = <span class="ruby-keyword kw">true</span>
459:           <span class="ruby-ivar">@mode</span> = <span class="ruby-value str">&quot;checkid_immediate&quot;</span>
460:         <span class="ruby-keyword kw">else</span>
461:           <span class="ruby-ivar">@immediate</span> = <span class="ruby-keyword kw">false</span>
462:           <span class="ruby-ivar">@mode</span> = <span class="ruby-value str">&quot;checkid_setup&quot;</span>
463:         <span class="ruby-keyword kw">end</span>
464: 
465:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@return_to</span> <span class="ruby-keyword kw">and</span>
466:             <span class="ruby-operator">!</span><span class="ruby-constant">TrustRoot</span><span class="ruby-operator">::</span><span class="ruby-constant">TrustRoot</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-ivar">@return_to</span>)
467:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">MalformedReturnURL</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword kw">nil</span>, <span class="ruby-ivar">@return_to</span>)
468:         <span class="ruby-keyword kw">end</span>
469: 
470:         <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">trust_root_valid</span>()
471:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">UntrustedReturnURL</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword kw">nil</span>, <span class="ruby-ivar">@return_to</span>, <span class="ruby-ivar">@trust_root</span>)
472:         <span class="ruby-keyword kw">end</span>
473:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M000365">
                    
                    <a name="M000365"></a><b>answer</b>(allow, server_url=nil, identity=nil, claimed_id=nil)
                    
                </div>
                
                <div class="description">
                  <p>
Respond to this request.
</p>
<table>
<tr><td valign="top">allow:</td><td>Allow this user to claim this identity, and allow the consumer to have this
information?

</td></tr>
<tr><td valign="top">server_url:</td><td>DEPRECATED. Passing <a
href="CheckIDRequest.html#op_endpoint">op_endpoint</a> to the <a
href="Server.html">Server</a> constructor makes this optional.

<p>
When an <a href="../../OpenID.html">OpenID</a> 1.x immediate mode request
does not succeed, it gets back a URL where the request may be carried out
in a not-so-immediate fashion. Pass my URL in here (the fully qualified
address of this server&#8217;s endpoint, i.e. <tt><a
href="http://example.com/server">example.com/server</a></tt>), and I will
use it as a base for the URL for a new request.
</p>
<p>
Optional for requests where <a
href="CheckIDRequest.html">CheckIDRequest</a>.immediate is false or
<tt>allow</tt> is true.
</p>
</td></tr>
<tr><td valign="top">identity:</td><td>The OP-local identifier to answer with. Only for use when the relying party
requested identifier selection.

</td></tr>
<tr><td valign="top"><a href="CheckIDRequest.html#claimed_id">claimed_id</a>:</td><td>The claimed identifier to answer with, for use with identifier selection in
the case where the claimed identifier and the OP-local identifier differ,
i.e. when the <a href="CheckIDRequest.html#claimed_id">claimed_id</a> uses
delegation.

<p>
If <tt>identity</tt> is provided but this is not, <tt><a
href="CheckIDRequest.html#claimed_id">claimed_id</a></tt> will default to
the value of <tt>identity</tt>. When answering requests that did not ask
for identifier selection, the response <tt><a
href="CheckIDRequest.html#claimed_id">claimed_id</a></tt> will default to
that of the request.
</p>
<p>
This parameter is new in <a href="../../OpenID.html">OpenID</a> 2.0.
</p>
</td></tr>
</table>
<p>
Returns an <a href="OpenIDResponse.html">OpenIDResponse</a> object
containing a <a href="../../OpenID.html">OpenID</a> id_res message.
</p>
<p>
Raises <a href="NoReturnToError.html">NoReturnToError</a> if the <a
href="CheckIDRequest.html#return_to">return_to</a> is missing.
</p>
<p>
Version 2.0 deprecates <tt>server_url</tt> and adds <tt><a
href="CheckIDRequest.html#claimed_id">claimed_id</a></tt>.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000365_source')" id="l_M000365_source">show</a>
                        
                    </p>
                    <div id="M000365_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/openid/server.rb, line 657</span>
657:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">answer</span>(<span class="ruby-identifier">allow</span>, <span class="ruby-identifier">server_url</span>=<span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">identity</span>=<span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">claimed_id</span>=<span class="ruby-keyword kw">nil</span>)
658:         <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@return_to</span>
659:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">NoReturnToError</span>
660:         <span class="ruby-keyword kw">end</span>
661: 
662:         <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">server_url</span>
663:           <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@message</span>.<span class="ruby-identifier">is_openid2</span> <span class="ruby-keyword kw">and</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@op_endpoint</span>
664:             <span class="ruby-comment cmt"># In other words, that warning I raised in</span>
665:             <span class="ruby-comment cmt"># Server.__init__?  You should pay attention to it now.</span>
666:             <span class="ruby-identifier">raise</span> <span class="ruby-constant">RuntimeError</span>, (<span class="ruby-node">&quot;#{self} should be constructed with &quot;</span>\
667:                                  <span class="ruby-value str">&quot;op_endpoint to respond to OpenID 2.0 &quot;</span>\
668:                                  <span class="ruby-value str">&quot;messages.&quot;</span>)
669:           <span class="ruby-keyword kw">end</span>
670: 
671:           <span class="ruby-identifier">server_url</span> = <span class="ruby-ivar">@op_endpoint</span>
672:         <span class="ruby-keyword kw">end</span>
673: 
674:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">allow</span>
675:           <span class="ruby-identifier">mode</span> = <span class="ruby-value str">'id_res'</span>
676:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-ivar">@message</span>.<span class="ruby-identifier">is_openid1</span>
677:           <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@immediate</span>
678:             <span class="ruby-identifier">mode</span> = <span class="ruby-value str">'id_res'</span>
679:           <span class="ruby-keyword kw">else</span>
680:             <span class="ruby-identifier">mode</span> = <span class="ruby-value str">'cancel'</span>
681:           <span class="ruby-keyword kw">end</span>
682:         <span class="ruby-keyword kw">else</span>
683:           <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@immediate</span>
684:             <span class="ruby-identifier">mode</span> = <span class="ruby-value str">'setup_needed'</span>
685:           <span class="ruby-keyword kw">else</span>
686:             <span class="ruby-identifier">mode</span> = <span class="ruby-value str">'cancel'</span>
687:           <span class="ruby-keyword kw">end</span>
688:         <span class="ruby-keyword kw">end</span>
689: 
690:         <span class="ruby-identifier">response</span> = <span class="ruby-constant">OpenIDResponse</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword kw">self</span>)
691: 
692:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">claimed_id</span> <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@message</span>.<span class="ruby-identifier">is_openid1</span>
693:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">VersionError</span>, (<span class="ruby-value str">&quot;claimed_id is new in OpenID 2.0 and not &quot;</span>\
694:                                <span class="ruby-node">&quot;available for #{@message.get_openid_namespace}&quot;</span>)
695:         <span class="ruby-keyword kw">end</span>
696: 
697:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">identity</span> <span class="ruby-keyword kw">and</span> <span class="ruby-operator">!</span><span class="ruby-identifier">claimed_id</span>
698:           <span class="ruby-identifier">claimed_id</span> = <span class="ruby-identifier">identity</span>
699:         <span class="ruby-keyword kw">end</span>
700: 
701:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">allow</span>
702:           <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@identity</span> <span class="ruby-operator">==</span> <span class="ruby-constant">IDENTIFIER_SELECT</span>
703:             <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">identity</span>
704:               <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, (<span class="ruby-value str">&quot;This request uses IdP-driven &quot;</span>\
705:                                     <span class="ruby-value str">&quot;identifier selection.You must supply &quot;</span>\
706:                                     <span class="ruby-value str">&quot;an identifier in the response.&quot;</span>)
707:             <span class="ruby-keyword kw">end</span>
708: 
709:             <span class="ruby-identifier">response_identity</span> = <span class="ruby-identifier">identity</span>
710:             <span class="ruby-identifier">response_claimed_id</span> = <span class="ruby-identifier">claimed_id</span>
711: 
712:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-ivar">@identity</span>
713:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">identity</span> <span class="ruby-keyword kw">and</span> (<span class="ruby-ivar">@identity</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">identity</span>)
714:               <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, (<span class="ruby-node">&quot;Request was for identity #{@identity}, &quot;</span>\
715:                                     <span class="ruby-node">&quot;cannot reply with identity #{identity}&quot;</span>)
716:             <span class="ruby-keyword kw">end</span>
717: 
718:             <span class="ruby-identifier">response_identity</span> = <span class="ruby-ivar">@identity</span>
719:             <span class="ruby-identifier">response_claimed_id</span> = <span class="ruby-ivar">@claimed_id</span>
720:           <span class="ruby-keyword kw">else</span>
721:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">identity</span>
722:               <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, (<span class="ruby-value str">&quot;This request specified no identity &quot;</span>\
723:                                     <span class="ruby-node">&quot;and you supplied #{identity}&quot;</span>)
724:             <span class="ruby-keyword kw">end</span>
725:             <span class="ruby-identifier">response_identity</span> = <span class="ruby-keyword kw">nil</span>
726:           <span class="ruby-keyword kw">end</span>
727: 
728:           <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@message</span>.<span class="ruby-identifier">is_openid1</span> <span class="ruby-keyword kw">and</span> <span class="ruby-operator">!</span><span class="ruby-identifier">response_identity</span>
729:             <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, (<span class="ruby-value str">&quot;Request was an OpenID 1 request, so &quot;</span>\
730:                                   <span class="ruby-value str">&quot;response must include an identifier.&quot;</span>)
731:           <span class="ruby-keyword kw">end</span>
732: 
733:           <span class="ruby-identifier">response</span>.<span class="ruby-identifier">fields</span>.<span class="ruby-identifier">update_args</span>(<span class="ruby-constant">OPENID_NS</span>, {
734:                 <span class="ruby-value str">'mode'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">mode</span>,
735:                 <span class="ruby-value str">'op_endpoint'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">server_url</span>,
736:                 <span class="ruby-value str">'return_to'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@return_to</span>,
737:                 <span class="ruby-value str">'response_nonce'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Nonce</span>.<span class="ruby-identifier">mk_nonce</span>(),
738:                 })
739: 
740:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">response_identity</span>
741:             <span class="ruby-identifier">response</span>.<span class="ruby-identifier">fields</span>.<span class="ruby-identifier">set_arg</span>(<span class="ruby-constant">OPENID_NS</span>, <span class="ruby-value str">'identity'</span>, <span class="ruby-identifier">response_identity</span>)
742:             <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@message</span>.<span class="ruby-identifier">is_openid2</span>
743:               <span class="ruby-identifier">response</span>.<span class="ruby-identifier">fields</span>.<span class="ruby-identifier">set_arg</span>(<span class="ruby-constant">OPENID_NS</span>,
744:                                       <span class="ruby-value str">'claimed_id'</span>, <span class="ruby-identifier">response_claimed_id</span>)
745:             <span class="ruby-keyword kw">end</span>
746:           <span class="ruby-keyword kw">end</span>
747:         <span class="ruby-keyword kw">else</span>
748:           <span class="ruby-identifier">response</span>.<span class="ruby-identifier">fields</span>.<span class="ruby-identifier">set_arg</span>(<span class="ruby-constant">OPENID_NS</span>, <span class="ruby-value str">'mode'</span>, <span class="ruby-identifier">mode</span>)
749:           <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@immediate</span>
750:             <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@message</span>.<span class="ruby-identifier">is_openid1</span> <span class="ruby-keyword kw">and</span> <span class="ruby-operator">!</span><span class="ruby-identifier">server_url</span>
751:               <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, (<span class="ruby-value str">&quot;setup_url is required for allow=false &quot;</span>\
752:                                     <span class="ruby-value str">&quot;in OpenID 1.x immediate mode.&quot;</span>)
753:             <span class="ruby-keyword kw">end</span>
754: 
755:             <span class="ruby-comment cmt"># Make a new request just like me, but with</span>
756:             <span class="ruby-comment cmt"># immediate=false.</span>
757:             <span class="ruby-identifier">setup_request</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@identity</span>, <span class="ruby-ivar">@return_to</span>,
758:                                            <span class="ruby-ivar">@op_endpoint</span>, <span class="ruby-ivar">@trust_root</span>, <span class="ruby-keyword kw">false</span>,
759:                                            <span class="ruby-ivar">@assoc_handle</span>, <span class="ruby-ivar">@claimed_id</span>)
760:             <span class="ruby-identifier">setup_request</span>.<span class="ruby-identifier">message</span> = <span class="ruby-constant">Message</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@message</span>.<span class="ruby-identifier">get_openid_namespace</span>)
761:             <span class="ruby-identifier">setup_url</span> = <span class="ruby-identifier">setup_request</span>.<span class="ruby-identifier">encode_to_url</span>(<span class="ruby-identifier">server_url</span>)
762:             <span class="ruby-identifier">response</span>.<span class="ruby-identifier">fields</span>.<span class="ruby-identifier">set_arg</span>(<span class="ruby-constant">OPENID_NS</span>, <span class="ruby-value str">'user_setup_url'</span>, <span class="ruby-identifier">setup_url</span>)
763:           <span class="ruby-keyword kw">end</span>
764:         <span class="ruby-keyword kw">end</span>
765: 
766:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">response</span>
767:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000374">
                    
                    <a name="M000374"></a><b>cancel_url</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000374_source')" id="l_M000374_source">show</a>
                        
                    </p>
                    <div id="M000374_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/openid/server.rb, line 804</span>
804:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">cancel_url</span>
805:         <span class="ruby-comment cmt"># Get the URL to cancel this request.</span>
806:         <span class="ruby-comment cmt">#</span>
807:         <span class="ruby-comment cmt"># Useful for creating a &quot;Cancel&quot; button on a web form so that</span>
808:         <span class="ruby-comment cmt"># operation can be carried out directly without another trip</span>
809:         <span class="ruby-comment cmt"># through the server.</span>
810:         <span class="ruby-comment cmt">#</span>
811:         <span class="ruby-comment cmt"># (Except you may want to make another trip through the</span>
812:         <span class="ruby-comment cmt"># server so that it knows that the user did make a decision.)</span>
813:         <span class="ruby-comment cmt">#</span>
814:         <span class="ruby-comment cmt"># Returns a URL as a string.</span>
815:         <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@return_to</span>
816:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">NoReturnToError</span>
817:         <span class="ruby-keyword kw">end</span>
818: 
819:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@immediate</span>
820:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;Cancel is not an appropriate response to &quot;</span> <span class="ruby-operator">+</span>
821:                                   <span class="ruby-value str">&quot;immediate mode requests.&quot;</span>)
822:         <span class="ruby-keyword kw">end</span>
823: 
824:         <span class="ruby-identifier">response</span> = <span class="ruby-constant">Message</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@message</span>.<span class="ruby-identifier">get_openid_namespace</span>)
825:         <span class="ruby-identifier">response</span>.<span class="ruby-identifier">set_arg</span>(<span class="ruby-constant">OPENID_NS</span>, <span class="ruby-value str">'mode'</span>, <span class="ruby-value str">'cancel'</span>)
826:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">response</span>.<span class="ruby-identifier">to_url</span>(<span class="ruby-ivar">@return_to</span>)
827:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000373">
                    
                    <a name="M000373"></a><b>encode_to_url</b>(server_url)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000373_source')" id="l_M000373_source">show</a>
                        
                    </p>
                    <div id="M000373_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/openid/server.rb, line 769</span>
769:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">encode_to_url</span>(<span class="ruby-identifier">server_url</span>)
770:         <span class="ruby-comment cmt"># Encode this request as a URL to GET.</span>
771:         <span class="ruby-comment cmt">#</span>
772:         <span class="ruby-comment cmt"># server_url:: The URL of the OpenID server to make this</span>
773:         <span class="ruby-comment cmt">#              request of.</span>
774:         <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@return_to</span>
775:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">NoReturnToError</span>
776:         <span class="ruby-keyword kw">end</span>
777: 
778:         <span class="ruby-comment cmt"># Imported from the alternate reality where these classes are</span>
779:         <span class="ruby-comment cmt"># used in both the client and server code, so Requests are</span>
780:         <span class="ruby-comment cmt"># Encodable too.  That's right, code imported from alternate</span>
781:         <span class="ruby-comment cmt"># realities all for the love of you, id_res/user_setup_url.</span>
782:         <span class="ruby-identifier">q</span> = {<span class="ruby-value str">'mode'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@mode</span>,
783:              <span class="ruby-value str">'identity'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@identity</span>,
784:              <span class="ruby-value str">'claimed_id'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@claimed_id</span>,
785:              <span class="ruby-value str">'return_to'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@return_to</span>}
786: 
787:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@trust_root</span>
788:           <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@message</span>.<span class="ruby-identifier">is_openid1</span>
789:             <span class="ruby-identifier">q</span>[<span class="ruby-value str">'trust_root'</span>] = <span class="ruby-ivar">@trust_root</span>
790:           <span class="ruby-keyword kw">else</span>
791:             <span class="ruby-identifier">q</span>[<span class="ruby-value str">'realm'</span>] = <span class="ruby-ivar">@trust_root</span>
792:           <span class="ruby-keyword kw">end</span>
793:         <span class="ruby-keyword kw">end</span>
794: 
795:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@assoc_handle</span>
796:           <span class="ruby-identifier">q</span>[<span class="ruby-value str">'assoc_handle'</span>] = <span class="ruby-ivar">@assoc_handle</span>
797:         <span class="ruby-keyword kw">end</span>
798: 
799:         <span class="ruby-identifier">response</span> = <span class="ruby-constant">Message</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@message</span>.<span class="ruby-identifier">get_openid_namespace</span>)
800:         <span class="ruby-identifier">response</span>.<span class="ruby-identifier">update_args</span>(<span class="ruby-ivar">@message</span>.<span class="ruby-identifier">get_openid_namespace</span>, <span class="ruby-identifier">q</span>)
801:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">response</span>.<span class="ruby-identifier">to_url</span>(<span class="ruby-identifier">server_url</span>)
802:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000362">
                    
                    <a name="M000362"></a><b>id_select</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Is the identifier to be selected by the IDP?
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000362_source')" id="l_M000362_source">show</a>
                        
                    </p>
                    <div id="M000362_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/openid/server.rb, line 573</span>
573:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">id_select</span>
574:         <span class="ruby-comment cmt"># So IDPs don't have to import the constant</span>
575:         <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@identity</span> <span class="ruby-operator">==</span> <span class="ruby-constant">IDENTIFIER_SELECT</span>
576:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000364">
                    
                    <a name="M000364"></a><b>return_to_verified</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Does the relying party publish the <a
href="CheckIDRequest.html#return_to">return_to</a> URL for this response
under the realm? It is up to the provider to set a policy for what kinds of
realms should be allowed. This <a
href="CheckIDRequest.html#return_to">return_to</a> URL verification reduces
vulnerability to data-theft attacks based on open proxies,
corss-site-scripting, or open redirectors.
</p>
<p>
This check should only be performed after making sure that the <a
href="CheckIDRequest.html#return_to">return_to</a> URL matches the realm.
</p>
<p>
Raises <a href="../DiscoveryFailure.html">DiscoveryFailure</a> if the realm
URL does not support <a href="../Yadis.html">Yadis</a> discovery (and so
does not support the verification process).
</p>
<p>
Returns true if the realm publishes a document with the <a
href="CheckIDRequest.html#return_to">return_to</a> URL listed
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000364_source')" id="l_M000364_source">show</a>
                        
                    </p>
                    <div id="M000364_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/openid/server.rb, line 612</span>
612:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">return_to_verified</span>
613:         <span class="ruby-keyword kw">return</span> <span class="ruby-constant">TrustRoot</span>.<span class="ruby-identifier">verify_return_to</span>(<span class="ruby-ivar">@trust_root</span>, <span class="ruby-ivar">@return_to</span>)
614:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000375">
                    
                    <a name="M000375"></a><b>to_s</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000375_source')" id="l_M000375_source">show</a>
                        
                    </p>
                    <div id="M000375_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/openid/server.rb, line 829</span>
829:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">to_s</span>
830:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">sprintf</span>(<span class="ruby-value str">'&lt;%s id:%s im:%s tr:%s ah:%s&gt;'</span>, <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>,
831:                        <span class="ruby-ivar">@identity</span>,
832:                        <span class="ruby-ivar">@immediate</span>,
833:                        <span class="ruby-ivar">@trust_root</span>,
834:                        <span class="ruby-ivar">@assoc_handle</span>)
835:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000363">
                    
                    <a name="M000363"></a><b>trust_root_valid</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Is my <a href="CheckIDRequest.html#return_to">return_to</a> under my <a
href="CheckIDRequest.html#trust_root">trust_root</a>?
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000363_source')" id="l_M000363_source">show</a>
                        
                    </p>
                    <div id="M000363_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/openid/server.rb, line 579</span>
579:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">trust_root_valid</span>
580:         <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@trust_root</span>
581:           <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span>
582:         <span class="ruby-keyword kw">end</span>
583: 
584:         <span class="ruby-identifier">tr</span> = <span class="ruby-constant">TrustRoot</span><span class="ruby-operator">::</span><span class="ruby-constant">TrustRoot</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-ivar">@trust_root</span>)
585:         <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">tr</span>
586:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">MalformedTrustRoot</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@message</span>, <span class="ruby-ivar">@trust_root</span>)
587:         <span class="ruby-keyword kw">end</span>
588: 
589:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@return_to</span>
590:           <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">tr</span>.<span class="ruby-identifier">validate_url</span>(<span class="ruby-ivar">@return_to</span>)
591:         <span class="ruby-keyword kw">else</span>
592:           <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span>
593:         <span class="ruby-keyword kw">end</span>
594:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    