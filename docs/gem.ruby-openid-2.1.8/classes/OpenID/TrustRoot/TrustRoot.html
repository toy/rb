<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>OpenID::TrustRoot::TrustRoot</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../../css/main.css" type="text/css" media="screen" />
    <script src="../../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Class</span> 
            OpenID::TrustRoot::TrustRoot 
            
                <span class="parent">&lt; 
                    
                    Object
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../../files/lib/openid/trustroot_rb.html">lib/openid/trustroot.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>#</dt>
        <dd>
            <ul>
                
                <li><a href="#M000453">_build_path</a>,</li>
                
                <li><a href="#M000454">_parse_url</a></li>
                
            </ul>
        </dd>
    
        <dt>B</dt>
        <dd>
            <ul>
                
                <li><a href="#M000459">build_discovery_url</a></li>
                
            </ul>
        </dd>
    
        <dt>C</dt>
        <dd>
            <ul>
                
                <li><a href="#M000456">check_sanity</a>,</li>
                
                <li><a href="#M000458">check_url</a></li>
                
            </ul>
        </dd>
    
        <dt>N</dt>
        <dd>
            <ul>
                
                <li><a href="#M000461">new</a></li>
                
            </ul>
        </dd>
    
        <dt>P</dt>
        <dd>
            <ul>
                
                <li><a href="#M000455">parse</a></li>
                
            </ul>
        </dd>
    
        <dt>S</dt>
        <dd>
            <ul>
                
                <li><a href="#M000463">sane?</a></li>
                
            </ul>
        </dd>
    
        <dt>V</dt>
        <dd>
            <ul>
                
                <li><a href="#M000464">validate_url</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    

    

    

    

    
    <div class="sectiontitle">Attributes</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>unparsed</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>proto</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>wildcard</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>host</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>port</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>path</td>
            <td class='attr-desc'></td>
        </tr>
        
    </table>
    

    
            <div class="sectiontitle">Class Public methods</div>
            
            <div class="method">
                <div class="title" id="M000453">
                    
                    <a name="M000453"></a><b>_build_path</b>(path, query=nil, frag=nil)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000453_source')" id="l_M000453_source">show</a>
                        
                    </p>
                    <div id="M000453_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/openid/trustroot.rb, line 156</span>
156:       <span class="ruby-keyword kw">def</span> <span class="ruby-constant">TrustRoot</span>.<span class="ruby-identifier">_build_path</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">query</span>=<span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">frag</span>=<span class="ruby-keyword kw">nil</span>)
157:         <span class="ruby-identifier">s</span> = <span class="ruby-identifier">path</span>.<span class="ruby-identifier">dup</span>
158: 
159:         <span class="ruby-identifier">frag</span> = <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">frag</span> <span class="ruby-operator">==</span> <span class="ruby-value str">''</span>
160:         <span class="ruby-identifier">query</span> = <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">query</span> <span class="ruby-operator">==</span> <span class="ruby-value str">''</span>
161: 
162:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">query</span>
163:           <span class="ruby-identifier">s</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;?&quot;</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">query</span>
164:         <span class="ruby-keyword kw">end</span>
165: 
166:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">frag</span>
167:           <span class="ruby-identifier">s</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;#&quot;</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">frag</span>
168:         <span class="ruby-keyword kw">end</span>
169: 
170:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">s</span>
171:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000454">
                    
                    <a name="M000454"></a><b>_parse_url</b>(url)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000454_source')" id="l_M000454_source">show</a>
                        
                    </p>
                    <div id="M000454_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/openid/trustroot.rb, line 173</span>
173:       <span class="ruby-keyword kw">def</span> <span class="ruby-constant">TrustRoot</span>.<span class="ruby-identifier">_parse_url</span>(<span class="ruby-identifier">url</span>)
174:         <span class="ruby-keyword kw">begin</span>
175:           <span class="ruby-identifier">url</span> = <span class="ruby-constant">URINorm</span>.<span class="ruby-identifier">urinorm</span>(<span class="ruby-identifier">url</span>)
176:         <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">URI</span><span class="ruby-operator">::</span><span class="ruby-constant">InvalidURIError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">err</span>
177:           <span class="ruby-keyword kw">nil</span>
178:         <span class="ruby-keyword kw">end</span>
179: 
180:         <span class="ruby-keyword kw">begin</span>
181:           <span class="ruby-identifier">parsed</span> = <span class="ruby-constant">URI</span><span class="ruby-operator">::</span><span class="ruby-identifier">parse</span>(<span class="ruby-identifier">url</span>)
182:         <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">URI</span><span class="ruby-operator">::</span><span class="ruby-constant">InvalidURIError</span>
183:           <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span>
184:         <span class="ruby-keyword kw">end</span>
185: 
186:         <span class="ruby-identifier">path</span> = <span class="ruby-constant">TrustRoot</span>.<span class="ruby-identifier">_build_path</span>(<span class="ruby-identifier">parsed</span>.<span class="ruby-identifier">path</span>,
187:                                      <span class="ruby-identifier">parsed</span>.<span class="ruby-identifier">query</span>,
188:                                      <span class="ruby-identifier">parsed</span>.<span class="ruby-identifier">fragment</span>)
189: 
190:         <span class="ruby-keyword kw">return</span> [<span class="ruby-identifier">parsed</span>.<span class="ruby-identifier">scheme</span> <span class="ruby-operator">||</span> <span class="ruby-value str">''</span>, <span class="ruby-identifier">parsed</span>.<span class="ruby-identifier">host</span> <span class="ruby-operator">||</span> <span class="ruby-value str">''</span>,
191:                 <span class="ruby-identifier">parsed</span>.<span class="ruby-identifier">port</span> <span class="ruby-operator">||</span> <span class="ruby-value str">''</span>, <span class="ruby-identifier">path</span> <span class="ruby-operator">||</span> <span class="ruby-value str">''</span>]
192:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000456">
                    
                    <a name="M000456"></a><b>check_sanity</b>(trust_root_string)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000456_source')" id="l_M000456_source">show</a>
                        
                    </p>
                    <div id="M000456_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/openid/trustroot.rb, line 223</span>
223:       <span class="ruby-keyword kw">def</span> <span class="ruby-constant">TrustRoot</span>.<span class="ruby-identifier">check_sanity</span>(<span class="ruby-identifier">trust_root_string</span>)
224:         <span class="ruby-identifier">trust_root</span> = <span class="ruby-constant">TrustRoot</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">trust_root_string</span>)
225:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">trust_root</span>.<span class="ruby-identifier">nil?</span>
226:           <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span>
227:         <span class="ruby-keyword kw">else</span>
228:           <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">trust_root</span>.<span class="ruby-identifier">sane?</span>
229:         <span class="ruby-keyword kw">end</span>
230:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000458">
                    
                    <a name="M000458"></a><b>check_url</b>(trust_root, url)
                    
                </div>
                
                <div class="description">
                  <p>
quick func for validating a url against a trust root. See the <a
href="TrustRoot.html">TrustRoot</a> class if you need more control.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000458_source')" id="l_M000458_source">show</a>
                        
                    </p>
                    <div id="M000458_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/openid/trustroot.rb, line 234</span>
234:       <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">check_url</span>(<span class="ruby-identifier">trust_root</span>, <span class="ruby-identifier">url</span>)
235:         <span class="ruby-identifier">tr</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">trust_root</span>)
236:         <span class="ruby-keyword kw">return</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">tr</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">tr</span>.<span class="ruby-identifier">validate_url</span>(<span class="ruby-identifier">url</span>))
237:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000461">
                    
                    <a name="M000461"></a><b>new</b>(unparsed, proto, wildcard, host, port, path)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000461_source')" id="l_M000461_source">show</a>
                        
                    </p>
                    <div id="M000461_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/openid/trustroot.rb, line 260</span>
260:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">unparsed</span>, <span class="ruby-identifier">proto</span>, <span class="ruby-identifier">wildcard</span>, <span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>, <span class="ruby-identifier">path</span>)
261:         <span class="ruby-ivar">@unparsed</span> = <span class="ruby-identifier">unparsed</span>
262:         <span class="ruby-ivar">@proto</span> = <span class="ruby-identifier">proto</span>
263:         <span class="ruby-ivar">@wildcard</span> = <span class="ruby-identifier">wildcard</span>
264:         <span class="ruby-ivar">@host</span> = <span class="ruby-identifier">host</span>
265:         <span class="ruby-ivar">@port</span> = <span class="ruby-identifier">port</span>
266:         <span class="ruby-ivar">@path</span> = <span class="ruby-identifier">path</span>
267:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000455">
                    
                    <a name="M000455"></a><b>parse</b>(trust_root)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000455_source')" id="l_M000455_source">show</a>
                        
                    </p>
                    <div id="M000455_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/openid/trustroot.rb, line 194</span>
194:       <span class="ruby-keyword kw">def</span> <span class="ruby-constant">TrustRoot</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">trust_root</span>)
195:         <span class="ruby-identifier">trust_root</span> = <span class="ruby-identifier">trust_root</span>.<span class="ruby-identifier">dup</span>
196:         <span class="ruby-identifier">unparsed</span> = <span class="ruby-identifier">trust_root</span>.<span class="ruby-identifier">dup</span>
197: 
198:         <span class="ruby-comment cmt"># look for wildcard</span>
199:         <span class="ruby-identifier">wildcard</span> = (<span class="ruby-keyword kw">not</span> <span class="ruby-identifier">trust_root</span>.<span class="ruby-identifier">index</span>(<span class="ruby-value str">'://*.'</span>).<span class="ruby-identifier">nil?</span>)
200:         <span class="ruby-identifier">trust_root</span>.<span class="ruby-identifier">sub!</span>(<span class="ruby-value str">'*.'</span>, <span class="ruby-value str">''</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">wildcard</span>
201: 
202:         <span class="ruby-comment cmt"># handle http://*/ case</span>
203:         <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">not</span> <span class="ruby-identifier">wildcard</span> <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@@empty_re</span>.<span class="ruby-identifier">match</span>(<span class="ruby-identifier">trust_root</span>)
204:           <span class="ruby-identifier">proto</span> = <span class="ruby-identifier">trust_root</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">':'</span>)[<span class="ruby-value">0</span>]
205:           <span class="ruby-identifier">port</span> = <span class="ruby-identifier">proto</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'http'</span> <span class="ruby-operator">?</span> <span class="ruby-value">80</span> <span class="ruby-operator">:</span> <span class="ruby-value">443</span>
206:           <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">new</span>(<span class="ruby-identifier">unparsed</span>, <span class="ruby-identifier">proto</span>, <span class="ruby-keyword kw">true</span>, <span class="ruby-value str">''</span>, <span class="ruby-identifier">port</span>, <span class="ruby-value str">'/'</span>)
207:         <span class="ruby-keyword kw">end</span>
208: 
209:         <span class="ruby-identifier">parts</span> = <span class="ruby-constant">TrustRoot</span>.<span class="ruby-identifier">_parse_url</span>(<span class="ruby-identifier">trust_root</span>)
210:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">parts</span>.<span class="ruby-identifier">nil?</span>
211: 
212:         <span class="ruby-identifier">proto</span>, <span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>, <span class="ruby-identifier">path</span> = <span class="ruby-identifier">parts</span>
213: 
214:         <span class="ruby-comment cmt"># check for URI fragment</span>
215:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">path</span> <span class="ruby-keyword kw">and</span> <span class="ruby-operator">!</span><span class="ruby-identifier">path</span>.<span class="ruby-identifier">index</span>(<span class="ruby-value str">'#'</span>).<span class="ruby-identifier">nil?</span>
216:           <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span>
217:         <span class="ruby-keyword kw">end</span>
218: 
219:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">unless</span> [<span class="ruby-value str">'http'</span>, <span class="ruby-value str">'https'</span>].<span class="ruby-identifier">member?</span>(<span class="ruby-identifier">proto</span>)
220:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">new</span>(<span class="ruby-identifier">unparsed</span>, <span class="ruby-identifier">proto</span>, <span class="ruby-identifier">wildcard</span>, <span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>, <span class="ruby-identifier">path</span>)
221:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M000459">
                    
                    <a name="M000459"></a><b>build_discovery_url</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Return a discovery URL for this realm.
</p>
<p>
This function does not check to make sure that the realm is valid. Its
behaviour on invalid inputs is undefined.
</p>
<table>
<tr><td valign="top">return_to:</td><td>The relying party return URL of the <a href="../../OpenID.html">OpenID</a>

</td></tr>
</table>
<p>
authentication request
</p>
<p>
Returns the URL upon which relying party discovery should be run in order
to verify the return_to URL
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000459_source')" id="l_M000459_source">show</a>
                        
                    </p>
                    <div id="M000459_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/openid/trustroot.rb, line 249</span>
249:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">build_discovery_url</span>
250:         <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">wildcard</span>
251:           <span class="ruby-comment cmt"># Use &quot;www.&quot; in place of the star</span>
252:           <span class="ruby-identifier">www_domain</span> = <span class="ruby-value str">'www.'</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@host</span>
253:           <span class="ruby-identifier">port</span> = (<span class="ruby-operator">!</span><span class="ruby-ivar">@port</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">and</span> <span class="ruby-operator">!</span>[<span class="ruby-value">80</span>, <span class="ruby-value">443</span>].<span class="ruby-identifier">member?</span>(<span class="ruby-ivar">@port</span>)) <span class="ruby-operator">?</span> (<span class="ruby-value str">&quot;:&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@port</span>.<span class="ruby-identifier">to_s</span>) <span class="ruby-operator">:</span> <span class="ruby-value str">''</span>
254:           <span class="ruby-keyword kw">return</span> <span class="ruby-node">&quot;#{@proto}://#{www_domain}#{port}#{@path}&quot;</span>
255:         <span class="ruby-keyword kw">else</span>
256:           <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@unparsed</span>
257:         <span class="ruby-keyword kw">end</span>
258:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000463">
                    
                    <a name="M000463"></a><b>sane?</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000463_source')" id="l_M000463_source">show</a>
                        
                    </p>
                    <div id="M000463_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/openid/trustroot.rb, line 269</span>
269:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sane?</span>
270:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@host</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'localhost'</span>
271: 
272:         <span class="ruby-identifier">host_parts</span> = <span class="ruby-ivar">@host</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">'.'</span>)
273: 
274:         <span class="ruby-comment cmt"># a note: ruby string split does not put an empty string at</span>
275:         <span class="ruby-comment cmt"># the end of the list if the split element is last.  for</span>
276:         <span class="ruby-comment cmt"># example, 'foo.com.'.split('.') =&gt; ['foo','com'].  Mentioned</span>
277:         <span class="ruby-comment cmt"># because the python code differs here.</span>
278: 
279:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">host_parts</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
280: 
281:         <span class="ruby-comment cmt"># no adjacent dots</span>
282:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">host_parts</span>.<span class="ruby-identifier">member?</span>(<span class="ruby-value str">''</span>)
283: 
284:         <span class="ruby-comment cmt"># last part must be a tld</span>
285:         <span class="ruby-identifier">tld</span> = <span class="ruby-identifier">host_parts</span>[<span class="ruby-value">-1</span>]
286:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">TOP_LEVEL_DOMAINS</span>.<span class="ruby-identifier">member?</span>(<span class="ruby-identifier">tld</span>)
287: 
288:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">host_parts</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span>
289: 
290:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@wildcard</span>
291:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">tld</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">2</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">host_parts</span>[<span class="ruby-value">-2</span>].<span class="ruby-identifier">length</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-value">3</span>
292:             <span class="ruby-comment cmt"># It's a 2-letter tld with a short second to last segment</span>
293:             <span class="ruby-comment cmt"># so there needs to be more than two segments specified</span>
294:             <span class="ruby-comment cmt"># (e.g. *.co.uk is insane)</span>
295:             <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">host_parts</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">2</span>
296:           <span class="ruby-keyword kw">end</span>
297:         <span class="ruby-keyword kw">end</span>
298: 
299:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span>
300:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000464">
                    
                    <a name="M000464"></a><b>validate_url</b>(url)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000464_source')" id="l_M000464_source">show</a>
                        
                    </p>
                    <div id="M000464_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/openid/trustroot.rb, line 302</span>
302:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">validate_url</span>(<span class="ruby-identifier">url</span>)
303:         <span class="ruby-identifier">parts</span> = <span class="ruby-constant">TrustRoot</span>.<span class="ruby-identifier">_parse_url</span>(<span class="ruby-identifier">url</span>)
304:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">parts</span>.<span class="ruby-identifier">nil?</span>
305: 
306:         <span class="ruby-identifier">proto</span>, <span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>, <span class="ruby-identifier">path</span> = <span class="ruby-identifier">parts</span>
307: 
308:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">proto</span> <span class="ruby-operator">==</span> <span class="ruby-ivar">@proto</span>
309:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">port</span> <span class="ruby-operator">==</span> <span class="ruby-ivar">@port</span>
310:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">host</span>.<span class="ruby-identifier">index</span>(<span class="ruby-value str">'*'</span>).<span class="ruby-identifier">nil?</span>
311: 
312:         <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@wildcard</span>
313:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">host</span> <span class="ruby-operator">!=</span> <span class="ruby-ivar">@host</span>
314:             <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span>
315:           <span class="ruby-keyword kw">end</span>
316:         <span class="ruby-keyword kw">elsif</span> ((<span class="ruby-ivar">@host</span> <span class="ruby-operator">!=</span> <span class="ruby-value str">''</span>) <span class="ruby-keyword kw">and</span>
317:                (<span class="ruby-operator">!</span><span class="ruby-identifier">host</span>.<span class="ruby-identifier">ends_with?</span>(<span class="ruby-value str">'.'</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@host</span>)) <span class="ruby-keyword kw">and</span>
318:                (<span class="ruby-identifier">host</span> <span class="ruby-operator">!=</span> <span class="ruby-ivar">@host</span>))
319:           <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span>
320:         <span class="ruby-keyword kw">end</span>
321: 
322:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">path</span> <span class="ruby-operator">!=</span> <span class="ruby-ivar">@path</span>
323:           <span class="ruby-identifier">path_len</span> = <span class="ruby-ivar">@path</span>.<span class="ruby-identifier">length</span>
324:           <span class="ruby-identifier">trust_prefix</span> = <span class="ruby-ivar">@path</span>[<span class="ruby-value">0</span><span class="ruby-operator">...</span><span class="ruby-identifier">path_len</span>]
325:           <span class="ruby-identifier">url_prefix</span> = <span class="ruby-identifier">path</span>[<span class="ruby-value">0</span><span class="ruby-operator">...</span><span class="ruby-identifier">path_len</span>]
326: 
327:           <span class="ruby-comment cmt"># must be equal up to the length of the path, at least</span>
328:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">trust_prefix</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">url_prefix</span>
329:             <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span>
330:           <span class="ruby-keyword kw">end</span>
331: 
332:           <span class="ruby-comment cmt"># These characters must be on the boundary between the end</span>
333:           <span class="ruby-comment cmt"># of the trust root's path and the start of the URL's path.</span>
334:           <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@path</span>.<span class="ruby-identifier">index</span>(<span class="ruby-value str">'?'</span>).<span class="ruby-identifier">nil?</span>
335:             <span class="ruby-identifier">allowed</span> = <span class="ruby-value str">'&amp;'</span>
336:           <span class="ruby-keyword kw">else</span>
337:             <span class="ruby-identifier">allowed</span> = <span class="ruby-value str">'?/'</span>
338:           <span class="ruby-keyword kw">end</span>
339: 
340:           <span class="ruby-keyword kw">return</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">allowed</span>.<span class="ruby-identifier">index</span>(<span class="ruby-ivar">@path</span>[<span class="ruby-value">-1</span>]).<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">or</span>
341:                   <span class="ruby-operator">!</span><span class="ruby-identifier">allowed</span>.<span class="ruby-identifier">index</span>(<span class="ruby-identifier">path</span>[<span class="ruby-identifier">path_len</span>]).<span class="ruby-identifier">nil?</span>)
342:         <span class="ruby-keyword kw">end</span>
343: 
344:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span>
345:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    