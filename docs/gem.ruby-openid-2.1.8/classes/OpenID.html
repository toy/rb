<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>OpenID</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen" />
    <script src="../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Module</span> 
            OpenID 
            
        </h1>
        <ul class="files">
            
            <li><a href="../files/lib/openid/association_rb.html">lib/openid/association.rb</a></li>
            
            <li><a href="../files/lib/openid/consumer/associationmanager_rb.html">lib/openid/consumer/associationmanager.rb</a></li>
            
            <li><a href="../files/lib/openid/consumer/checkid_request_rb.html">lib/openid/consumer/checkid_request.rb</a></li>
            
            <li><a href="../files/lib/openid/consumer/discovery_manager_rb.html">lib/openid/consumer/discovery_manager.rb</a></li>
            
            <li><a href="../files/lib/openid/consumer/discovery_rb.html">lib/openid/consumer/discovery.rb</a></li>
            
            <li><a href="../files/lib/openid/consumer/html_parse_rb.html">lib/openid/consumer/html_parse.rb</a></li>
            
            <li><a href="../files/lib/openid/consumer/idres_rb.html">lib/openid/consumer/idres.rb</a></li>
            
            <li><a href="../files/lib/openid/consumer/responses_rb.html">lib/openid/consumer/responses.rb</a></li>
            
            <li><a href="../files/lib/openid/consumer_rb.html">lib/openid/consumer.rb</a></li>
            
            <li><a href="../files/lib/openid/cryptutil_rb.html">lib/openid/cryptutil.rb</a></li>
            
            <li><a href="../files/lib/openid/dh_rb.html">lib/openid/dh.rb</a></li>
            
            <li><a href="../files/lib/openid/extension_rb.html">lib/openid/extension.rb</a></li>
            
            <li><a href="../files/lib/openid/extensions/ax_rb.html">lib/openid/extensions/ax.rb</a></li>
            
            <li><a href="../files/lib/openid/extensions/oauth_rb.html">lib/openid/extensions/oauth.rb</a></li>
            
            <li><a href="../files/lib/openid/extensions/pape_rb.html">lib/openid/extensions/pape.rb</a></li>
            
            <li><a href="../files/lib/openid/extensions/sreg_rb.html">lib/openid/extensions/sreg.rb</a></li>
            
            <li><a href="../files/lib/openid/fetchers_rb.html">lib/openid/fetchers.rb</a></li>
            
            <li><a href="../files/lib/openid/kvform_rb.html">lib/openid/kvform.rb</a></li>
            
            <li><a href="../files/lib/openid/kvpost_rb.html">lib/openid/kvpost.rb</a></li>
            
            <li><a href="../files/lib/openid/message_rb.html">lib/openid/message.rb</a></li>
            
            <li><a href="../files/lib/openid/protocolerror_rb.html">lib/openid/protocolerror.rb</a></li>
            
            <li><a href="../files/lib/openid/server_rb.html">lib/openid/server.rb</a></li>
            
            <li><a href="../files/lib/openid/store/filesystem_rb.html">lib/openid/store/filesystem.rb</a></li>
            
            <li><a href="../files/lib/openid/store/interface_rb.html">lib/openid/store/interface.rb</a></li>
            
            <li><a href="../files/lib/openid/store/memcache_rb.html">lib/openid/store/memcache.rb</a></li>
            
            <li><a href="../files/lib/openid/store/memory_rb.html">lib/openid/store/memory.rb</a></li>
            
            <li><a href="../files/lib/openid/store/nonce_rb.html">lib/openid/store/nonce.rb</a></li>
            
            <li><a href="../files/lib/openid/trustroot_rb.html">lib/openid/trustroot.rb</a></li>
            
            <li><a href="../files/lib/openid/urinorm_rb.html">lib/openid/urinorm.rb</a></li>
            
            <li><a href="../files/lib/openid/util_rb.html">lib/openid/util.rb</a></li>
            
            <li><a href="../files/lib/openid/yadis/accept_rb.html">lib/openid/yadis/accept.rb</a></li>
            
            <li><a href="../files/lib/openid/yadis/constants_rb.html">lib/openid/yadis/constants.rb</a></li>
            
            <li><a href="../files/lib/openid/yadis/discovery_rb.html">lib/openid/yadis/discovery.rb</a></li>
            
            <li><a href="../files/lib/openid/yadis/filters_rb.html">lib/openid/yadis/filters.rb</a></li>
            
            <li><a href="../files/lib/openid/yadis/parsehtml_rb.html">lib/openid/yadis/parsehtml.rb</a></li>
            
            <li><a href="../files/lib/openid/yadis/services_rb.html">lib/openid/yadis/services.rb</a></li>
            
            <li><a href="../files/lib/openid/yadis/xrds_rb.html">lib/openid/yadis/xrds.rb</a></li>
            
            <li><a href="../files/lib/openid/yadis/xri_rb.html">lib/openid/yadis/xri.rb</a></li>
            
            <li><a href="../files/lib/openid/yadis/xrires_rb.html">lib/openid/yadis/xrires.rb</a></li>
            
            <li><a href="../files/lib/openid_rb.html">lib/openid.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    
    <div class="description">
        <p>
See <a href="OpenID/Consumer.html">OpenID::Consumer</a> or <a
href="OpenID/Server.html">OpenID::Server</a> modules, as well as the store
classes
</p>
<hr size="1"></hr><hr size="1"></hr><p>
Copyright 2006-2007 JanRain, Inc.
</p>
<p>
Licensed under the Apache License, Version 2.0 (the &#8220;License&#8221;);
you may not use this file except in compliance with the License. You may
obtain a copy of the License at
</p>
<pre>
  http://www.apache.org/licenses/LICENSE-2.0
</pre>
<p>
Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an &#8220;AS IS&#8221;
BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or
implied. See the License for the specific language governing permissions
and limitations under the License.
</p>

    </div>
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>A</dt>
        <dd>
            <ul>
                
                <li><a href="#M000098">arrange_by_type</a></li>
                
            </ul>
        </dd>
    
        <dt>B</dt>
        <dd>
            <ul>
                
                <li><a href="#M000097">best_matching_service</a></li>
                
            </ul>
        </dd>
    
        <dt>C</dt>
        <dd>
            <ul>
                
                <li><a href="#M000245">check_sreg_field_name</a></li>
                
            </ul>
        </dd>
    
        <dt>D</dt>
        <dd>
            <ul>
                
                <li><a href="#M000107">discover</a>,</li>
                
                <li><a href="#M000105">discover_no_yadis</a>,</li>
                
                <li><a href="#M000106">discover_uri</a>,</li>
                
                <li><a href="#M000104">discover_xri</a>,</li>
                
                <li><a href="#M000103">discover_yadis</a></li>
                
            </ul>
        </dd>
    
        <dt>F</dt>
        <dd>
            <ul>
                
                <li><a href="#M000269">fetch</a>,</li>
                
                <li><a href="#M000270">fetcher</a>,</li>
                
                <li><a href="#M000271">fetcher=</a>,</li>
                
                <li><a href="#M000272">fetcher_use_env_http_proxy</a>,</li>
                
                <li><a href="#M000102">find_first_href</a>,</li>
                
                <li><a href="#M000100">find_links_rel</a>,</li>
                
                <li><a href="#M000090">find_op_local_identifier</a></li>
                
            </ul>
        </dd>
    
        <dt>G</dt>
        <dd>
            <ul>
                
                <li><a href="#M000101">get_op_or_user_services</a>,</li>
                
                <li><a href="#M000015">get_secret_size</a>,</li>
                
                <li><a href="#M000247">get_sreg_ns</a></li>
                
            </ul>
        </dd>
    
        <dt>L</dt>
        <dd>
            <ul>
                
                <li><a href="#M000099">link_has_rel</a></li>
                
            </ul>
        </dd>
    
        <dt>M</dt>
        <dd>
            <ul>
                
                <li><a href="#M000287">make_kv_post</a></li>
                
            </ul>
        </dd>
    
        <dt>N</dt>
        <dd>
            <ul>
                
                <li><a href="#M000095">normalize_url</a>,</li>
                
                <li><a href="#M000094">normalize_xri</a></li>
                
            </ul>
        </dd>
    
        <dt>O</dt>
        <dd>
            <ul>
                
                <li><a href="#M000091">openid_unescape</a></li>
                
            </ul>
        </dd>
    
        <dt>P</dt>
        <dd>
            <ul>
                
                <li><a href="#M000093">parse_link_attrs</a></li>
                
            </ul>
        </dd>
    
        <dt>R</dt>
        <dd>
            <ul>
                
                <li><a href="#M000096">rel_matches</a></li>
                
            </ul>
        </dd>
    
        <dt>S</dt>
        <dd>
            <ul>
                
                <li><a href="#M000246">supports_sreg?</a></li>
                
            </ul>
        </dd>
    
        <dt>U</dt>
        <dd>
            <ul>
                
                <li><a href="#M000092">unescape_hash</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    

    

    
    <div class="sectiontitle">Classes and Modules</div>
    <ul>
        
        <li><span class="type">MODULE</span> <a href="OpenID/AX.html">OpenID::AX</a></li>
        
        <li><span class="type">MODULE</span> <a href="OpenID/CryptUtil.html">OpenID::CryptUtil</a></li>
        
        <li><span class="type">MODULE</span> <a href="OpenID/Nonce.html">OpenID::Nonce</a></li>
        
        <li><span class="type">MODULE</span> <a href="OpenID/OAuth.html">OpenID::OAuth</a></li>
        
        <li><span class="type">MODULE</span> <a href="OpenID/PAPE.html">OpenID::PAPE</a></li>
        
        <li><span class="type">MODULE</span> <a href="OpenID/SReg.html">OpenID::SReg</a></li>
        
        <li><span class="type">MODULE</span> <a href="OpenID/Server.html">OpenID::Server</a></li>
        
        <li><span class="type">MODULE</span> <a href="OpenID/Store.html">OpenID::Store</a></li>
        
        <li><span class="type">MODULE</span> <a href="OpenID/TrustRoot.html">OpenID::TrustRoot</a></li>
        
        <li><span class="type">MODULE</span> <a href="OpenID/URINorm.html">OpenID::URINorm</a></li>
        
        <li><span class="type">MODULE</span> <a href="OpenID/Util.html">OpenID::Util</a></li>
        
        <li><span class="type">MODULE</span> <a href="OpenID/Yadis.html">OpenID::Yadis</a></li>
        
        <li><span class="type">CLASS</span> <a href="OpenID/AssertionError.html">OpenID::AssertionError</a></li>
        
        <li><span class="type">CLASS</span> <a href="OpenID/Association.html">OpenID::Association</a></li>
        
        <li><span class="type">CLASS</span> <a href="OpenID/AssociationNegotiator.html">OpenID::AssociationNegotiator</a></li>
        
        <li><span class="type">CLASS</span> <a href="OpenID/Consumer.html">OpenID::Consumer</a></li>
        
        <li><span class="type">CLASS</span> <a href="OpenID/DiffieHellman.html">OpenID::DiffieHellman</a></li>
        
        <li><span class="type">CLASS</span> <a href="OpenID/DiscoveryFailure.html">OpenID::DiscoveryFailure</a></li>
        
        <li><span class="type">CLASS</span> <a href="OpenID/Extension.html">OpenID::Extension</a></li>
        
        <li><span class="type">CLASS</span> <a href="OpenID/FetchingError.html">OpenID::FetchingError</a></li>
        
        <li><span class="type">CLASS</span> <a href="OpenID/HTTPRedirectLimitReached.html">OpenID::HTTPRedirectLimitReached</a></li>
        
        <li><span class="type">CLASS</span> <a href="OpenID/HTTPResponse.html">OpenID::HTTPResponse</a></li>
        
        <li><span class="type">CLASS</span> <a href="OpenID/HTTPStatusError.html">OpenID::HTTPStatusError</a></li>
        
        <li><span class="type">CLASS</span> <a href="OpenID/InvalidOpenIDNamespace.html">OpenID::InvalidOpenIDNamespace</a></li>
        
        <li><span class="type">CLASS</span> <a href="OpenID/KVFormError.html">OpenID::KVFormError</a></li>
        
        <li><span class="type">CLASS</span> <a href="OpenID/KVPostNetworkError.html">OpenID::KVPostNetworkError</a></li>
        
        <li><span class="type">CLASS</span> <a href="OpenID/Message.html">OpenID::Message</a></li>
        
        <li><span class="type">CLASS</span> <a href="OpenID/NamespaceAliasRegistrationError.html">OpenID::NamespaceAliasRegistrationError</a></li>
        
        <li><span class="type">CLASS</span> <a href="OpenID/NamespaceMap.html">OpenID::NamespaceMap</a></li>
        
        <li><span class="type">CLASS</span> <a href="OpenID/OpenIDError.html">OpenID::OpenIDError</a></li>
        
        <li><span class="type">CLASS</span> <a href="OpenID/OpenIDServiceEndpoint.html">OpenID::OpenIDServiceEndpoint</a></li>
        
        <li><span class="type">CLASS</span> <a href="OpenID/ProtocolError.html">OpenID::ProtocolError</a></li>
        
        <li><span class="type">CLASS</span> <a href="OpenID/RealmVerificationRedirected.html">OpenID::RealmVerificationRedirected</a></li>
        
        <li><span class="type">CLASS</span> <a href="OpenID/SSLFetchingError.html">OpenID::SSLFetchingError</a></li>
        
        <li><span class="type">CLASS</span> <a href="OpenID/ServerError.html">OpenID::ServerError</a></li>
        
        <li><span class="type">CLASS</span> <a href="OpenID/StandardFetcher.html">OpenID::StandardFetcher</a></li>
        
        <li><span class="type">CLASS</span> <a href="OpenID/TypeURIMismatch.html">OpenID::TypeURIMismatch</a></li>
        
        <li><span class="type">CLASS</span> <a href="OpenID/UndefinedOpenIDNamespace.html">OpenID::UndefinedOpenIDNamespace</a></li>
        
    </ul>
    

    
    <div class="sectiontitle">Constants</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class="attr-name">DefaultNegotiator</td>
            <td>=</td>
            <td class="attr-value">AssociationNegotiator.new([['HMAC-SHA1', 'DH-SHA1'],                                ['HMAC-SHA1', 'no-encryption'],                                ['HMAC-SHA256', 'DH-SHA256'],                                ['HMAC-SHA256', 'no-encryption']])</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">EncryptedNegotiator</td>
            <td>=</td>
            <td class="attr-value">AssociationNegotiator.new([['HMAC-SHA1', 'DH-SHA1'],                                ['HMAC-SHA256', 'DH-SHA256']])</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">OPENID_1_0_NS</td>
            <td>=</td>
            <td class="attr-value">'http://openid.net/xmlns/1.0'</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">OPENID_IDP_2_0_TYPE</td>
            <td>=</td>
            <td class="attr-value">'http://specs.openid.net/auth/2.0/server'</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">OPENID_2_0_TYPE</td>
            <td>=</td>
            <td class="attr-value">'http://specs.openid.net/auth/2.0/signon'</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">OPENID_1_1_TYPE</td>
            <td>=</td>
            <td class="attr-value">'http://openid.net/signon/1.1'</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">OPENID_1_0_TYPE</td>
            <td>=</td>
            <td class="attr-value">'http://openid.net/signon/1.0'</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">OPENID_1_0_MESSAGE_NS</td>
            <td>=</td>
            <td class="attr-value">OPENID1_NS</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">OPENID_2_0_MESSAGE_NS</td>
            <td>=</td>
            <td class="attr-value">OPENID2_NS</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">REMOVED_RE</td>
            <td>=</td>
            <td class="attr-value">/     # Comments     &lt;!--.*?--&gt;      # CDATA blocks   | &lt;!\[CDATA\[.*?\]\]&gt;      # script blocks   | &lt;script\b      # make sure script is not an XML namespace     (?!:)      [^&gt;]*&gt;.*?&lt;\/script&gt;    /mix</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
Stuff to remove before we start looking for tags
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">IDENTIFIER_SELECT</td>
            <td>=</td>
            <td class="attr-value">'http://specs.openid.net/auth/2.0/identifier_select'</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">SREG_URI</td>
            <td>=</td>
            <td class="attr-value">'http://openid.net/sreg/1.0'</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
URI for Simple Registration extension, the only commonly deployed <a
href="OpenID.html">OpenID</a> 1.x extension, and so a special case.
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">OPENID1_NS</td>
            <td>=</td>
            <td class="attr-value">'http://openid.net/signon/1.0'</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
The <a href="OpenID.html">OpenID</a> 1.x namespace URIs
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">OPENID11_NS</td>
            <td>=</td>
            <td class="attr-value">'http://openid.net/signon/1.1'</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">OPENID1_NAMESPACES</td>
            <td>=</td>
            <td class="attr-value">[OPENID1_NS, OPENID11_NS]</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">OPENID2_NS</td>
            <td>=</td>
            <td class="attr-value">'http://specs.openid.net/auth/2.0'</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
The <a href="OpenID.html">OpenID</a> 2.0 namespace URI
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">NULL_NAMESPACE</td>
            <td>=</td>
            <td class="attr-value">:null_namespace</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
The namespace consisting of pairs with keys that are prefixed with
&#8220;openid.&#8221; but not in another namespace.
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">OPENID_NS</td>
            <td>=</td>
            <td class="attr-value">:openid_namespace</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
The null namespace, when it is an allowed <a href="OpenID.html">OpenID</a>
namespace
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">BARE_NS</td>
            <td>=</td>
            <td class="attr-value">:bare_namespace</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
The top-level namespace, excluding all pairs with keys that start with
&#8220;openid.&#8220;
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">OPENID1_URL_LIMIT</td>
            <td>=</td>
            <td class="attr-value">2047</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
Limit, in bytes, of identity provider and return_to URLs, including
response payload. See <a href="OpenID.html">OpenID</a> 1.1 specification,
Appendix D.
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">OPENID_PROTOCOL_FIELDS</td>
            <td>=</td>
            <td class="attr-value">[                             'ns', 'mode', 'error', 'return_to',                             'contact', 'reference', 'signed',                             'assoc_type', 'session_type',                             'dh_modulus', 'dh_gen',                             'dh_consumer_public', 'claimed_id',                             'identity', 'realm', 'invalidate_handle',                             'op_endpoint', 'response_nonce', 'sig',                             'assoc_handle', 'trust_root', 'openid',                            ]</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
All <a href="OpenID.html">OpenID</a> protocol fields. Used to check
namespace aliases.
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">NO_DEFAULT</td>
            <td>=</td>
            <td class="attr-value">:no_default</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
Sentinel used for <a href="OpenID/Message.html">Message</a> implementation
to indicate that getArg should raise an exception instead of returning a
default.
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">VERSION</td>
            <td>=</td>
            <td class="attr-value">&quot;2.1.8&quot;</td>
        </tr>
        
        
    </table>
    

    

    
            <div class="sectiontitle">Class Public methods</div>
            
            <div class="method">
                <div class="title" id="M000098">
                    
                    <a name="M000098"></a><b>arrange_by_type</b>(service_list, preferred_types)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000098_source')" id="l_M000098_source">show</a>
                        
                    </p>
                    <div id="M000098_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/openid/consumer/discovery.rb, line 329</span>
329:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">arrange_by_type</span>(<span class="ruby-identifier">service_list</span>, <span class="ruby-identifier">preferred_types</span>)
330:     <span class="ruby-comment cmt"># Rearrange service_list in a new list so services are ordered by</span>
331:     <span class="ruby-comment cmt"># types listed in preferred_types.  Return the new list.</span>
332: 
333:     <span class="ruby-comment cmt"># Build a list with the service elements in tuples whose</span>
334:     <span class="ruby-comment cmt"># comparison will prefer the one with the best matching service</span>
335:     <span class="ruby-identifier">prio_services</span> = []
336: 
337:     <span class="ruby-identifier">service_list</span>.<span class="ruby-identifier">each_with_index</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">s</span>, <span class="ruby-identifier">index</span><span class="ruby-operator">|</span>
338:       <span class="ruby-identifier">prio_services</span> <span class="ruby-operator">&lt;&lt;</span> [<span class="ruby-identifier">best_matching_service</span>(<span class="ruby-identifier">s</span>, <span class="ruby-identifier">preferred_types</span>), <span class="ruby-identifier">index</span>, <span class="ruby-identifier">s</span>]
339:     }
340: 
341:     <span class="ruby-identifier">prio_services</span>.<span class="ruby-identifier">sort!</span>
342: 
343:     <span class="ruby-comment cmt"># Now that the services are sorted by priority, remove the sort</span>
344:     <span class="ruby-comment cmt"># keys from the list.</span>
345:     (<span class="ruby-value">0</span><span class="ruby-operator">...</span><span class="ruby-identifier">prio_services</span>.<span class="ruby-identifier">length</span>).<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
346:       <span class="ruby-identifier">prio_services</span>[<span class="ruby-identifier">i</span>] = <span class="ruby-identifier">prio_services</span>[<span class="ruby-identifier">i</span>][<span class="ruby-value">2</span>]
347:     }
348: 
349:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">prio_services</span>
350:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000097">
                    
                    <a name="M000097"></a><b>best_matching_service</b>(service, preferred_types)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000097_source')" id="l_M000097_source">show</a>
                        
                    </p>
                    <div id="M000097_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/openid/consumer/discovery.rb, line 312</span>
312:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">best_matching_service</span>(<span class="ruby-identifier">service</span>, <span class="ruby-identifier">preferred_types</span>)
313:     <span class="ruby-comment cmt"># Return the index of the first matching type, or something higher</span>
314:     <span class="ruby-comment cmt"># if no type matches.</span>
315:     <span class="ruby-comment cmt">#</span>
316:     <span class="ruby-comment cmt"># This provides an ordering in which service elements that contain</span>
317:     <span class="ruby-comment cmt"># a type that comes earlier in the preferred types list come</span>
318:     <span class="ruby-comment cmt"># before service elements that come later. If a service element</span>
319:     <span class="ruby-comment cmt"># has more than one type, the most preferred one wins.</span>
320:     <span class="ruby-identifier">preferred_types</span>.<span class="ruby-identifier">each_with_index</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">value</span>, <span class="ruby-identifier">index</span><span class="ruby-operator">|</span>
321:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">service</span>.<span class="ruby-identifier">type_uris</span>.<span class="ruby-identifier">member?</span>(<span class="ruby-identifier">value</span>)
322:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">index</span>
323:       <span class="ruby-keyword kw">end</span>
324:     }
325: 
326:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">preferred_types</span>.<span class="ruby-identifier">length</span>
327:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000245">
                    
                    <a name="M000245"></a><b>check_sreg_field_name</b>(fieldname)
                    
                </div>
                
                <div class="description">
                  <p>
raise ArgumentError if fieldname is not in the defined sreg fields
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000245_source')" id="l_M000245_source">show</a>
                        
                    </p>
                    <div id="M000245_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/openid/extensions/sreg.rb, line 30</span>
30:     <span class="ruby-keyword kw">def</span> <span class="ruby-constant">OpenID</span>.<span class="ruby-identifier">check_sreg_field_name</span>(<span class="ruby-identifier">fieldname</span>)
31:       <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">DATA_FIELDS</span>.<span class="ruby-identifier">member?</span> <span class="ruby-identifier">fieldname</span>
32:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-node">&quot;#{fieldname} is not a defined simple registration field&quot;</span>
33:       <span class="ruby-keyword kw">end</span>
34:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000107">
                    
                    <a name="M000107"></a><b>discover</b>(identifier)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000107_source')" id="l_M000107_source">show</a>
                        
                    </p>
                    <div id="M000107_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/openid/consumer/discovery.rb, line 490</span>
490:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">discover</span>(<span class="ruby-identifier">identifier</span>)
491:     <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Yadis</span><span class="ruby-operator">::</span><span class="ruby-constant">XRI</span><span class="ruby-operator">::</span><span class="ruby-identifier">identifier_scheme</span>(<span class="ruby-identifier">identifier</span>) <span class="ruby-operator">==</span> <span class="ruby-identifier">:xri</span>
492:       <span class="ruby-identifier">normalized_identifier</span>, <span class="ruby-identifier">services</span> = <span class="ruby-identifier">discover_xri</span>(<span class="ruby-identifier">identifier</span>)
493:     <span class="ruby-keyword kw">else</span>
494:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">discover_uri</span>(<span class="ruby-identifier">identifier</span>)
495:     <span class="ruby-keyword kw">end</span>
496:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000105">
                    
                    <a name="M000105"></a><b>discover_no_yadis</b>(uri)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000105_source')" id="l_M000105_source">show</a>
                        
                    </p>
                    <div id="M000105_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/openid/consumer/discovery.rb, line 451</span>
451:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">discover_no_yadis</span>(<span class="ruby-identifier">uri</span>)
452:     <span class="ruby-identifier">http_resp</span> = <span class="ruby-constant">OpenID</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-identifier">uri</span>)
453:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">http_resp</span>.<span class="ruby-identifier">code</span> <span class="ruby-operator">!=</span> <span class="ruby-value str">&quot;200&quot;</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">http_resp</span>.<span class="ruby-identifier">code</span> <span class="ruby-operator">!=</span> <span class="ruby-value str">&quot;206&quot;</span>
454:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">DiscoveryFailure</span>.<span class="ruby-identifier">new</span>(
455:         <span class="ruby-value str">&quot;HTTP Response status from identity URL host is not \&quot;200\&quot;. &quot;</span>\
456:         <span class="ruby-node">&quot;Got status #{http_resp.code.inspect}&quot;</span>, <span class="ruby-identifier">http_resp</span>)
457:     <span class="ruby-keyword kw">end</span>
458: 
459:     <span class="ruby-identifier">claimed_id</span> = <span class="ruby-identifier">http_resp</span>.<span class="ruby-identifier">final_url</span>
460:     <span class="ruby-identifier">openid_services</span> = <span class="ruby-constant">OpenIDServiceEndpoint</span>.<span class="ruby-identifier">from_html</span>(
461:         <span class="ruby-identifier">claimed_id</span>, <span class="ruby-identifier">http_resp</span>.<span class="ruby-identifier">body</span>)
462:     <span class="ruby-keyword kw">return</span> [<span class="ruby-identifier">claimed_id</span>, <span class="ruby-identifier">openid_services</span>]
463:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000106">
                    
                    <a name="M000106"></a><b>discover_uri</b>(uri)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000106_source')" id="l_M000106_source">show</a>
                        
                    </p>
                    <div id="M000106_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/openid/consumer/discovery.rb, line 465</span>
465:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">discover_uri</span>(<span class="ruby-identifier">uri</span>)
466:     <span class="ruby-comment cmt"># Hack to work around URI parsing for URls with *no* scheme.</span>
467:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">uri</span>.<span class="ruby-identifier">index</span>(<span class="ruby-value str">&quot;://&quot;</span>).<span class="ruby-identifier">nil?</span>
468:       <span class="ruby-identifier">uri</span> = <span class="ruby-value str">'http://'</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">uri</span>
469:     <span class="ruby-keyword kw">end</span>
470: 
471:     <span class="ruby-keyword kw">begin</span>
472:       <span class="ruby-identifier">parsed</span> = <span class="ruby-constant">URI</span><span class="ruby-operator">::</span><span class="ruby-identifier">parse</span>(<span class="ruby-identifier">uri</span>)
473:     <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">URI</span><span class="ruby-operator">::</span><span class="ruby-constant">InvalidURIError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">why</span>
474:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">DiscoveryFailure</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;URI is not valid: #{why.message}&quot;</span>, <span class="ruby-keyword kw">nil</span>)
475:     <span class="ruby-keyword kw">end</span>
476: 
477:     <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">parsed</span>.<span class="ruby-identifier">scheme</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">and</span> <span class="ruby-operator">!</span><span class="ruby-identifier">parsed</span>.<span class="ruby-identifier">scheme</span>.<span class="ruby-identifier">empty?</span>
478:       <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span>[<span class="ruby-value str">'http'</span>, <span class="ruby-value str">'https'</span>].<span class="ruby-identifier">member?</span>(<span class="ruby-identifier">parsed</span>.<span class="ruby-identifier">scheme</span>)
479:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">DiscoveryFailure</span>.<span class="ruby-identifier">new</span>(
480:                 <span class="ruby-node">&quot;URI scheme #{parsed.scheme} is not HTTP or HTTPS&quot;</span>, <span class="ruby-keyword kw">nil</span>)
481:       <span class="ruby-keyword kw">end</span>
482:     <span class="ruby-keyword kw">end</span>
483: 
484:     <span class="ruby-identifier">uri</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">normalize_url</span>(<span class="ruby-identifier">uri</span>)
485:     <span class="ruby-identifier">claimed_id</span>, <span class="ruby-identifier">openid_services</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">discover_yadis</span>(<span class="ruby-identifier">uri</span>)
486:     <span class="ruby-identifier">claimed_id</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">normalize_url</span>(<span class="ruby-identifier">claimed_id</span>)
487:     <span class="ruby-keyword kw">return</span> [<span class="ruby-identifier">claimed_id</span>, <span class="ruby-identifier">openid_services</span>]
488:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000104">
                    
                    <a name="M000104"></a><b>discover_xri</b>(iname)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000104_source')" id="l_M000104_source">show</a>
                        
                    </p>
                    <div id="M000104_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/openid/consumer/discovery.rb, line 419</span>
419:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">discover_xri</span>(<span class="ruby-identifier">iname</span>)
420:     <span class="ruby-identifier">endpoints</span> = []
421:     <span class="ruby-identifier">iname</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">normalize_xri</span>(<span class="ruby-identifier">iname</span>)
422: 
423:     <span class="ruby-keyword kw">begin</span>
424:       <span class="ruby-identifier">canonical_id</span>, <span class="ruby-identifier">services</span> = <span class="ruby-constant">Yadis</span><span class="ruby-operator">::</span><span class="ruby-constant">XRI</span><span class="ruby-operator">::</span><span class="ruby-constant">ProxyResolver</span>.<span class="ruby-identifier">new</span>().<span class="ruby-identifier">query</span>( <span class="ruby-identifier">iname</span> )
425: 
426:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">canonical_id</span>.<span class="ruby-identifier">nil?</span>
427:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">Yadis</span><span class="ruby-operator">::</span><span class="ruby-constant">XRDSError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">sprintf</span>(<span class="ruby-value str">'No CanonicalID found for XRI %s'</span>, <span class="ruby-identifier">iname</span>))
428:       <span class="ruby-keyword kw">end</span>
429: 
430:       <span class="ruby-identifier">flt</span> = <span class="ruby-constant">Yadis</span>.<span class="ruby-identifier">make_filter</span>(<span class="ruby-constant">OpenIDServiceEndpoint</span>)
431: 
432:       <span class="ruby-identifier">services</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">service_element</span><span class="ruby-operator">|</span>
433:         <span class="ruby-identifier">endpoints</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">flt</span>.<span class="ruby-identifier">get_service_endpoints</span>(<span class="ruby-identifier">iname</span>, <span class="ruby-identifier">service_element</span>)
434:       }
435:     <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Yadis</span><span class="ruby-operator">::</span><span class="ruby-constant">XRDSError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">why</span>
436:       <span class="ruby-constant">Util</span>.<span class="ruby-identifier">log</span>(<span class="ruby-value str">'xrds error on '</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">iname</span> <span class="ruby-operator">+</span> <span class="ruby-value str">': '</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">why</span>.<span class="ruby-identifier">to_s</span>)
437:     <span class="ruby-keyword kw">end</span>
438: 
439:     <span class="ruby-identifier">endpoints</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">endpoint</span><span class="ruby-operator">|</span>
440:       <span class="ruby-comment cmt"># Is there a way to pass this through the filter to the endpoint</span>
441:       <span class="ruby-comment cmt"># constructor instead of tacking it on after?</span>
442:       <span class="ruby-identifier">endpoint</span>.<span class="ruby-identifier">canonical_id</span> = <span class="ruby-identifier">canonical_id</span>
443:       <span class="ruby-identifier">endpoint</span>.<span class="ruby-identifier">claimed_id</span> = <span class="ruby-identifier">canonical_id</span>
444:       <span class="ruby-identifier">endpoint</span>.<span class="ruby-identifier">display_identifier</span> = <span class="ruby-identifier">iname</span>
445:     }
446: 
447:     <span class="ruby-comment cmt"># FIXME: returned xri should probably be in some normal form</span>
448:     <span class="ruby-keyword kw">return</span> [<span class="ruby-identifier">iname</span>, <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">get_op_or_user_services</span>(<span class="ruby-identifier">endpoints</span>)]
449:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000103">
                    
                    <a name="M000103"></a><b>discover_yadis</b>(uri)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000103_source')" id="l_M000103_source">show</a>
                        
                    </p>
                    <div id="M000103_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/openid/consumer/discovery.rb, line 373</span>
373:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">discover_yadis</span>(<span class="ruby-identifier">uri</span>)
374:     <span class="ruby-comment cmt"># Discover OpenID services for a URI. Tries Yadis and falls back</span>
375:     <span class="ruby-comment cmt"># on old-style &lt;link rel='...'&gt; discovery if Yadis fails.</span>
376:     <span class="ruby-comment cmt">#</span>
377:     <span class="ruby-comment cmt"># @param uri: normalized identity URL</span>
378:     <span class="ruby-comment cmt"># @type uri: str</span>
379:     <span class="ruby-comment cmt"># </span>
380:     <span class="ruby-comment cmt"># @return: (claimed_id, services)</span>
381:     <span class="ruby-comment cmt"># @rtype: (str, list(OpenIDServiceEndpoint))</span>
382:     <span class="ruby-comment cmt">#</span>
383:     <span class="ruby-comment cmt"># @raises DiscoveryFailure: when discovery fails.</span>
384: 
385:     <span class="ruby-comment cmt"># Might raise a yadis.discover.DiscoveryFailure if no document</span>
386:     <span class="ruby-comment cmt"># came back for that URI at all.  I don't think falling back to</span>
387:     <span class="ruby-comment cmt"># OpenID 1.0 discovery on the same URL will help, so don't bother</span>
388:     <span class="ruby-comment cmt"># to catch it.</span>
389:     <span class="ruby-identifier">response</span> = <span class="ruby-constant">Yadis</span>.<span class="ruby-identifier">discover</span>(<span class="ruby-identifier">uri</span>)
390: 
391:     <span class="ruby-identifier">yadis_url</span> = <span class="ruby-identifier">response</span>.<span class="ruby-identifier">normalized_uri</span>
392:     <span class="ruby-identifier">body</span> = <span class="ruby-identifier">response</span>.<span class="ruby-identifier">response_text</span>
393: 
394:     <span class="ruby-keyword kw">begin</span>
395:       <span class="ruby-identifier">openid_services</span> = <span class="ruby-constant">OpenIDServiceEndpoint</span>.<span class="ruby-identifier">from_xrds</span>(<span class="ruby-identifier">yadis_url</span>, <span class="ruby-identifier">body</span>)
396:     <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Yadis</span><span class="ruby-operator">::</span><span class="ruby-constant">XRDSError</span>
397:       <span class="ruby-comment cmt"># Does not parse as a Yadis XRDS file</span>
398:       <span class="ruby-identifier">openid_services</span> = []
399:     <span class="ruby-keyword kw">end</span>
400: 
401:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">openid_services</span>.<span class="ruby-identifier">empty?</span>
402:       <span class="ruby-comment cmt"># Either not an XRDS or there are no OpenID services.</span>
403: 
404:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">response</span>.<span class="ruby-identifier">is_xrds</span>
405:         <span class="ruby-comment cmt"># if we got the Yadis content-type or followed the Yadis</span>
406:         <span class="ruby-comment cmt"># header, re-fetch the document without following the Yadis</span>
407:         <span class="ruby-comment cmt"># header, with no Accept header.</span>
408:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">discover_no_yadis</span>(<span class="ruby-identifier">uri</span>)
409:       <span class="ruby-keyword kw">end</span>
410: 
411:       <span class="ruby-comment cmt"># Try to parse the response as HTML.</span>
412:       <span class="ruby-comment cmt"># &lt;link rel=&quot;...&quot;&gt;</span>
413:       <span class="ruby-identifier">openid_services</span> = <span class="ruby-constant">OpenIDServiceEndpoint</span>.<span class="ruby-identifier">from_html</span>(<span class="ruby-identifier">yadis_url</span>, <span class="ruby-identifier">body</span>)
414:     <span class="ruby-keyword kw">end</span>
415: 
416:     <span class="ruby-keyword kw">return</span> [<span class="ruby-identifier">yadis_url</span>, <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">get_op_or_user_services</span>(<span class="ruby-identifier">openid_services</span>)]
417:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000269">
                    
                    <a name="M000269"></a><b>fetch</b>(url, body=nil, headers=nil, redirect_limit=StandardFetcher::REDIRECT_LIMIT)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000269_source')" id="l_M000269_source">show</a>
                        
                    </p>
                    <div id="M000269_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/openid/fetchers.rb, line 87</span>
87:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-identifier">url</span>, <span class="ruby-identifier">body</span>=<span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">headers</span>=<span class="ruby-keyword kw">nil</span>,
88:                  <span class="ruby-identifier">redirect_limit</span>=<span class="ruby-constant">StandardFetcher</span><span class="ruby-operator">::</span><span class="ruby-constant">REDIRECT_LIMIT</span>)
89:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">fetcher</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-identifier">url</span>, <span class="ruby-identifier">body</span>, <span class="ruby-identifier">headers</span>, <span class="ruby-identifier">redirect_limit</span>)
90:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000270">
                    
                    <a name="M000270"></a><b>fetcher</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000270_source')" id="l_M000270_source">show</a>
                        
                    </p>
                    <div id="M000270_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/openid/fetchers.rb, line 92</span>
92:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">fetcher</span>
93:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@fetcher</span>.<span class="ruby-identifier">nil?</span>
94:       <span class="ruby-ivar">@fetcher</span> = <span class="ruby-constant">StandardFetcher</span>.<span class="ruby-identifier">new</span>
95:     <span class="ruby-keyword kw">end</span>
96: 
97:     <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@fetcher</span>
98:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000271">
                    
                    <a name="M000271"></a><b>fetcher=</b>(fetcher)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000271_source')" id="l_M000271_source">show</a>
                        
                    </p>
                    <div id="M000271_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/openid/fetchers.rb, line 100</span>
100:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">fetcher=</span>(<span class="ruby-identifier">fetcher</span>)
101:     <span class="ruby-ivar">@fetcher</span> = <span class="ruby-identifier">fetcher</span>
102:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000272">
                    
                    <a name="M000272"></a><b>fetcher_use_env_http_proxy</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Set the default fetcher to use the HTTP proxy defined in the environment
variable &#8216;http_proxy&#8217;.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000272_source')" id="l_M000272_source">show</a>
                        
                    </p>
                    <div id="M000272_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/openid/fetchers.rb, line 106</span>
106:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">fetcher_use_env_http_proxy</span>
107:     <span class="ruby-identifier">proxy_string</span> = <span class="ruby-constant">ENV</span>[<span class="ruby-value str">'http_proxy'</span>]
108:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">proxy_string</span>
109: 
110:     <span class="ruby-identifier">proxy_uri</span> = <span class="ruby-constant">URI</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">proxy_string</span>)
111:     <span class="ruby-ivar">@fetcher</span> = <span class="ruby-constant">StandardFetcher</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">proxy_uri</span>.<span class="ruby-identifier">host</span>, <span class="ruby-identifier">proxy_uri</span>.<span class="ruby-identifier">port</span>,
112:                                    <span class="ruby-identifier">proxy_uri</span>.<span class="ruby-identifier">user</span>, <span class="ruby-identifier">proxy_uri</span>.<span class="ruby-identifier">password</span>)
113:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000102">
                    
                    <a name="M000102"></a><b>find_first_href</b>(link_attrs_list, target_rel)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000102_source')" id="l_M000102_source">show</a>
                        
                    </p>
                    <div id="M000102_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/openid/consumer/html_parse.rb, line 120</span>
120:   <span class="ruby-keyword kw">def</span> <span class="ruby-constant">OpenID</span>.<span class="ruby-identifier">find_first_href</span>(<span class="ruby-identifier">link_attrs_list</span>, <span class="ruby-identifier">target_rel</span>)
121:     <span class="ruby-comment cmt"># Return the value of the href attribute for the first link tag in</span>
122:     <span class="ruby-comment cmt"># the list that has target_rel as a relationship.</span>
123: 
124:     <span class="ruby-comment cmt"># XXX: TESTME</span>
125:     <span class="ruby-identifier">matches</span> = <span class="ruby-identifier">find_links_rel</span>(<span class="ruby-identifier">link_attrs_list</span>, <span class="ruby-identifier">target_rel</span>)
126:     <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">matches</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">matches</span>.<span class="ruby-identifier">empty?</span>
127:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span>
128:     <span class="ruby-keyword kw">end</span>
129: 
130:     <span class="ruby-identifier">first</span> = <span class="ruby-identifier">matches</span>[<span class="ruby-value">0</span>]
131:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">first</span>[<span class="ruby-value str">'href'</span>]
132:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000100">
                    
                    <a name="M000100"></a><b>find_links_rel</b>(link_attrs_list, target_rel)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000100_source')" id="l_M000100_source">show</a>
                        
                    </p>
                    <div id="M000100_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/openid/consumer/html_parse.rb, line 103</span>
103:   <span class="ruby-keyword kw">def</span> <span class="ruby-constant">OpenID</span>.<span class="ruby-identifier">find_links_rel</span>(<span class="ruby-identifier">link_attrs_list</span>, <span class="ruby-identifier">target_rel</span>)
104:     <span class="ruby-comment cmt"># Filter the list of link attributes on whether it has target_rel</span>
105:     <span class="ruby-comment cmt"># as a relationship.</span>
106: 
107:     <span class="ruby-comment cmt"># XXX: TESTME</span>
108:     <span class="ruby-identifier">matchesTarget</span> = <span class="ruby-identifier">lambda</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">attrs</span><span class="ruby-operator">|</span> <span class="ruby-identifier">link_has_rel</span>(<span class="ruby-identifier">attrs</span>, <span class="ruby-identifier">target_rel</span>) }
109:     <span class="ruby-identifier">result</span> = []
110: 
111:     <span class="ruby-identifier">link_attrs_list</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">item</span><span class="ruby-operator">|</span>
112:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">matchesTarget</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">item</span>)
113:         <span class="ruby-identifier">result</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">item</span>
114:       <span class="ruby-keyword kw">end</span>
115:     }
116: 
117:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">result</span>
118:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000090">
                    
                    <a name="M000090"></a><b>find_op_local_identifier</b>(service_element, type_uris)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000090_source')" id="l_M000090_source">show</a>
                        
                    </p>
                    <div id="M000090_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/openid/consumer/discovery.rb, line 243</span>
243:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">find_op_local_identifier</span>(<span class="ruby-identifier">service_element</span>, <span class="ruby-identifier">type_uris</span>)
244:     <span class="ruby-comment cmt"># Find the OP-Local Identifier for this xrd:Service element.</span>
245:     <span class="ruby-comment cmt">#</span>
246:     <span class="ruby-comment cmt"># This considers openid:Delegate to be a synonym for xrd:LocalID</span>
247:     <span class="ruby-comment cmt"># if both OpenID 1.X and OpenID 2.0 types are present. If only</span>
248:     <span class="ruby-comment cmt"># OpenID 1.X is present, it returns the value of</span>
249:     <span class="ruby-comment cmt"># openid:Delegate. If only OpenID 2.0 is present, it returns the</span>
250:     <span class="ruby-comment cmt"># value of xrd:LocalID. If there is more than one LocalID tag and</span>
251:     <span class="ruby-comment cmt"># the values are different, it raises a DiscoveryFailure. This is</span>
252:     <span class="ruby-comment cmt"># also triggered when the xrd:LocalID and openid:Delegate tags are</span>
253:     <span class="ruby-comment cmt"># different.</span>
254: 
255:     <span class="ruby-comment cmt"># XXX: Test this function on its own!</span>
256: 
257:     <span class="ruby-comment cmt"># Build the list of tags that could contain the OP-Local</span>
258:     <span class="ruby-comment cmt"># Identifier</span>
259:     <span class="ruby-identifier">local_id_tags</span> = []
260:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">type_uris</span>.<span class="ruby-identifier">member?</span>(<span class="ruby-constant">OPENID_1_1_TYPE</span>) <span class="ruby-keyword kw">or</span>
261:         <span class="ruby-identifier">type_uris</span>.<span class="ruby-identifier">member?</span>(<span class="ruby-constant">OPENID_1_0_TYPE</span>)
262:       <span class="ruby-comment cmt"># local_id_tags &lt;&lt; Yadis::nsTag(OPENID_1_0_NS, 'openid', 'Delegate')</span>
263:       <span class="ruby-identifier">service_element</span>.<span class="ruby-identifier">add_namespace</span>(<span class="ruby-value str">'openid'</span>, <span class="ruby-constant">OPENID_1_0_NS</span>)
264:       <span class="ruby-identifier">local_id_tags</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;openid:Delegate&quot;</span>
265:     <span class="ruby-keyword kw">end</span>
266: 
267:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">type_uris</span>.<span class="ruby-identifier">member?</span>(<span class="ruby-constant">OPENID_2_0_TYPE</span>)
268:       <span class="ruby-comment cmt"># local_id_tags.append(Yadis::nsTag(XRD_NS_2_0, 'xrd', 'LocalID'))</span>
269:       <span class="ruby-identifier">service_element</span>.<span class="ruby-identifier">add_namespace</span>(<span class="ruby-value str">'xrd'</span>, <span class="ruby-constant">Yadis</span><span class="ruby-operator">::</span><span class="ruby-constant">XRD_NS_2_0</span>)
270:       <span class="ruby-identifier">local_id_tags</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;xrd:LocalID&quot;</span>
271:     <span class="ruby-keyword kw">end</span>
272: 
273:     <span class="ruby-comment cmt"># Walk through all the matching tags and make sure that they all</span>
274:     <span class="ruby-comment cmt"># have the same value</span>
275:     <span class="ruby-identifier">local_id</span> = <span class="ruby-keyword kw">nil</span>
276:     <span class="ruby-identifier">local_id_tags</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">local_id_tag</span><span class="ruby-operator">|</span>
277:       <span class="ruby-identifier">service_element</span>.<span class="ruby-identifier">each_element</span>(<span class="ruby-identifier">local_id_tag</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">local_id_element</span><span class="ruby-operator">|</span>
278:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">local_id</span>.<span class="ruby-identifier">nil?</span>
279:           <span class="ruby-identifier">local_id</span> = <span class="ruby-identifier">local_id_element</span>.<span class="ruby-identifier">text</span>
280:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">local_id</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">local_id_element</span>.<span class="ruby-identifier">text</span>
281:           <span class="ruby-identifier">format</span> = <span class="ruby-value str">'More than one %s tag found in one service element'</span>
282:           <span class="ruby-identifier">message</span> = <span class="ruby-identifier">sprintf</span>(<span class="ruby-identifier">format</span>, <span class="ruby-identifier">local_id_tag</span>)
283:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">DiscoveryFailure</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">message</span>, <span class="ruby-keyword kw">nil</span>)
284:         <span class="ruby-keyword kw">end</span>
285:       }
286:     }
287: 
288:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">local_id</span>
289:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000101">
                    
                    <a name="M000101"></a><b>get_op_or_user_services</b>(openid_services)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000101_source')" id="l_M000101_source">show</a>
                        
                    </p>
                    <div id="M000101_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/openid/consumer/discovery.rb, line 352</span>
352:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">get_op_or_user_services</span>(<span class="ruby-identifier">openid_services</span>)
353:     <span class="ruby-comment cmt"># Extract OP Identifier services.  If none found, return the rest,</span>
354:     <span class="ruby-comment cmt"># sorted with most preferred first according to</span>
355:     <span class="ruby-comment cmt"># OpenIDServiceEndpoint.openid_type_uris.</span>
356:     <span class="ruby-comment cmt">#</span>
357:     <span class="ruby-comment cmt"># openid_services is a list of OpenIDServiceEndpoint objects.</span>
358:     <span class="ruby-comment cmt">#</span>
359:     <span class="ruby-comment cmt"># Returns a list of OpenIDServiceEndpoint objects.</span>
360: 
361:     <span class="ruby-identifier">op_services</span> = <span class="ruby-identifier">arrange_by_type</span>(<span class="ruby-identifier">openid_services</span>, [<span class="ruby-constant">OPENID_IDP_2_0_TYPE</span>])
362: 
363:     <span class="ruby-identifier">openid_services</span> = <span class="ruby-identifier">arrange_by_type</span>(<span class="ruby-identifier">openid_services</span>,
364:                                       <span class="ruby-constant">OpenIDServiceEndpoint</span><span class="ruby-operator">::</span><span class="ruby-constant">OPENID_TYPE_URIS</span>)
365: 
366:     <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">op_services</span>.<span class="ruby-identifier">empty?</span>
367:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">op_services</span>
368:     <span class="ruby-keyword kw">else</span>
369:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">openid_services</span>
370:     <span class="ruby-keyword kw">end</span>
371:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000015">
                    
                    <a name="M000015"></a><b>get_secret_size</b>(assoc_type)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000015_source')" id="l_M000015_source">show</a>
                        
                    </p>
                    <div id="M000015_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/openid/association.rb, line 8</span>
 8:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">get_secret_size</span>(<span class="ruby-identifier">assoc_type</span>)
 9:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">assoc_type</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'HMAC-SHA1'</span>
10:       <span class="ruby-keyword kw">return</span> <span class="ruby-value">20</span>
11:     <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">assoc_type</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'HMAC-SHA256'</span>
12:       <span class="ruby-keyword kw">return</span> <span class="ruby-value">32</span>
13:     <span class="ruby-keyword kw">else</span>
14:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>(<span class="ruby-node">&quot;Unsupported association type: #{assoc_type}&quot;</span>)
15:     <span class="ruby-keyword kw">end</span>
16:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000247">
                    
                    <a name="M000247"></a><b>get_sreg_ns</b>(message)
                    
                </div>
                
                <div class="description">
                  <p>
Extract the simple registration namespace URI from the given <a
href="OpenID.html">OpenID</a> message. Handles <a
href="OpenID.html">OpenID</a> 1 and 2, as well as both sreg namespace URIs
found in the wild, as well as missing namespace definitions (for <a
href="OpenID.html">OpenID</a> 1)
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000247_source')" id="l_M000247_source">show</a>
                        
                    </p>
                    <div id="M000247_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/openid/extensions/sreg.rb, line 45</span>
45:     <span class="ruby-keyword kw">def</span> <span class="ruby-constant">OpenID</span>.<span class="ruby-identifier">get_sreg_ns</span>(<span class="ruby-identifier">message</span>)
46:       [<span class="ruby-constant">NS_URI_1_1</span>, <span class="ruby-constant">NS_URI_1_0</span>].<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">ns</span><span class="ruby-operator">|</span>
47:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">message</span>.<span class="ruby-identifier">namespaces</span>.<span class="ruby-identifier">get_alias</span>(<span class="ruby-identifier">ns</span>)
48:           <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">ns</span>
49:         <span class="ruby-keyword kw">end</span>
50:       }
51:       <span class="ruby-comment cmt"># try to add an alias, since we didn't find one</span>
52:       <span class="ruby-identifier">ns</span> = <span class="ruby-constant">NS_URI_1_1</span>
53:       <span class="ruby-keyword kw">begin</span>
54:         <span class="ruby-identifier">message</span>.<span class="ruby-identifier">namespaces</span>.<span class="ruby-identifier">add_alias</span>(<span class="ruby-identifier">ns</span>, <span class="ruby-value str">'sreg'</span>)
55:       <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">IndexError</span>
56:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">NamespaceError</span>
57:       <span class="ruby-keyword kw">end</span>
58:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">ns</span>
59:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000099">
                    
                    <a name="M000099"></a><b>link_has_rel</b>(link_attrs, target_rel)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000099_source')" id="l_M000099_source">show</a>
                        
                    </p>
                    <div id="M000099_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/openid/consumer/html_parse.rb, line 95</span>
 95:   <span class="ruby-keyword kw">def</span> <span class="ruby-constant">OpenID</span>.<span class="ruby-identifier">link_has_rel</span>(<span class="ruby-identifier">link_attrs</span>, <span class="ruby-identifier">target_rel</span>)
 96:     <span class="ruby-comment cmt"># Does this link have target_rel as a relationship?</span>
 97: 
 98:     <span class="ruby-comment cmt"># XXX: TESTME</span>
 99:     <span class="ruby-identifier">rel_attr</span> = <span class="ruby-identifier">link_attrs</span>[<span class="ruby-value str">'rel'</span>]
100:     <span class="ruby-keyword kw">return</span> (<span class="ruby-identifier">rel_attr</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">rel_matches</span>(<span class="ruby-identifier">rel_attr</span>, <span class="ruby-identifier">target_rel</span>))
101:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000287">
                    
                    <a name="M000287"></a><b>make_kv_post</b>(request_message, server_url)
                    
                </div>
                
                <div class="description">
                  <p>
Send the message to the server via HTTP POST and receive and parse a
response in KV Form
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000287_source')" id="l_M000287_source">show</a>
                        
                    </p>
                    <div id="M000287_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/openid/kvpost.rb, line 50</span>
50:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">make_kv_post</span>(<span class="ruby-identifier">request_message</span>, <span class="ruby-identifier">server_url</span>)
51:     <span class="ruby-keyword kw">begin</span>
52:       <span class="ruby-identifier">http_response</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-identifier">server_url</span>, <span class="ruby-identifier">request_message</span>.<span class="ruby-identifier">to_url_encoded</span>)
53:     <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Exception</span>
54:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">KVPostNetworkError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;Unable to contact OpenID server: #{$!.to_s}&quot;</span>)
55:     <span class="ruby-keyword kw">end</span>
56:     <span class="ruby-keyword kw">return</span> <span class="ruby-constant">Message</span>.<span class="ruby-identifier">from_http_response</span>(<span class="ruby-identifier">http_response</span>, <span class="ruby-identifier">server_url</span>)
57:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000095">
                    
                    <a name="M000095"></a><b>normalize_url</b>(url)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000095_source')" id="l_M000095_source">show</a>
                        
                    </p>
                    <div id="M000095_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/openid/consumer/discovery.rb, line 298</span>
298:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">normalize_url</span>(<span class="ruby-identifier">url</span>)
299:     <span class="ruby-comment cmt"># Normalize a URL, converting normalization failures to</span>
300:     <span class="ruby-comment cmt"># DiscoveryFailure</span>
301:     <span class="ruby-keyword kw">begin</span>
302:       <span class="ruby-identifier">normalized</span> = <span class="ruby-constant">URINorm</span>.<span class="ruby-identifier">urinorm</span>(<span class="ruby-identifier">url</span>)
303:     <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">URI</span><span class="ruby-operator">::</span><span class="ruby-constant">Error</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">why</span>
304:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">DiscoveryFailure</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;Error normalizing #{url}: #{why.message}&quot;</span>, <span class="ruby-keyword kw">nil</span>)
305:     <span class="ruby-keyword kw">else</span>
306:       <span class="ruby-identifier">defragged</span> = <span class="ruby-constant">URI</span><span class="ruby-operator">::</span><span class="ruby-identifier">parse</span>(<span class="ruby-identifier">normalized</span>)
307:       <span class="ruby-identifier">defragged</span>.<span class="ruby-identifier">fragment</span> = <span class="ruby-keyword kw">nil</span>
308:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">defragged</span>.<span class="ruby-identifier">normalize</span>.<span class="ruby-identifier">to_s</span>
309:     <span class="ruby-keyword kw">end</span>
310:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000094">
                    
                    <a name="M000094"></a><b>normalize_xri</b>(xri)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000094_source')" id="l_M000094_source">show</a>
                        
                    </p>
                    <div id="M000094_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/openid/consumer/discovery.rb, line 291</span>
291:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">normalize_xri</span>(<span class="ruby-identifier">xri</span>)
292:     <span class="ruby-comment cmt"># Normalize an XRI, stripping its scheme if present</span>
293:     <span class="ruby-identifier">m</span> = <span class="ruby-regexp re">/^xri:\/\/(.*)/</span>.<span class="ruby-identifier">match</span>(<span class="ruby-identifier">xri</span>)
294:     <span class="ruby-identifier">xri</span> = <span class="ruby-identifier">m</span>[<span class="ruby-value">1</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">m</span>
295:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">xri</span>
296:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000091">
                    
                    <a name="M000091"></a><b>openid_unescape</b>(s)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000091_source')" id="l_M000091_source">show</a>
                        
                    </p>
                    <div id="M000091_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/openid/consumer/html_parse.rb, line 23</span>
23:   <span class="ruby-keyword kw">def</span> <span class="ruby-constant">OpenID</span>.<span class="ruby-identifier">openid_unescape</span>(<span class="ruby-identifier">s</span>)
24:     <span class="ruby-identifier">s</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-value str">'&amp;amp;'</span>,<span class="ruby-value str">'&amp;'</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-value str">'&amp;lt;'</span>,<span class="ruby-value str">'&lt;'</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-value str">'&amp;gt;'</span>,<span class="ruby-value str">'&gt;'</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-value str">'&amp;quot;'</span>,<span class="ruby-value str">'&quot;'</span>)
25:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000093">
                    
                    <a name="M000093"></a><b>parse_link_attrs</b>(html)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000093_source')" id="l_M000093_source">show</a>
                        
                    </p>
                    <div id="M000093_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/openid/consumer/html_parse.rb, line 36</span>
36:   <span class="ruby-keyword kw">def</span> <span class="ruby-constant">OpenID</span>.<span class="ruby-identifier">parse_link_attrs</span>(<span class="ruby-identifier">html</span>)
37:     <span class="ruby-identifier">stripped</span> = <span class="ruby-identifier">html</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-constant">REMOVED_RE</span>,<span class="ruby-value str">''</span>)
38:     <span class="ruby-identifier">parser</span> = <span class="ruby-constant">HTMLTokenizer</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">stripped</span>)
39: 
40:     <span class="ruby-identifier">links</span> = []
41:     <span class="ruby-comment cmt"># to keep track of whether or not we are in the head element</span>
42:     <span class="ruby-identifier">in_head</span> = <span class="ruby-keyword kw">false</span>
43:     <span class="ruby-identifier">in_html</span> = <span class="ruby-keyword kw">false</span>
44:     <span class="ruby-identifier">saw_head</span> = <span class="ruby-keyword kw">false</span>
45: 
46:     <span class="ruby-keyword kw">begin</span>
47:       <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">el</span> = <span class="ruby-identifier">parser</span>.<span class="ruby-identifier">getTag</span>(<span class="ruby-value str">'head'</span>, <span class="ruby-value str">'/head'</span>, <span class="ruby-value str">'link'</span>, <span class="ruby-value str">'body'</span>, <span class="ruby-value str">'/body'</span>, 
48:                                <span class="ruby-value str">'html'</span>, <span class="ruby-value str">'/html'</span>)
49:         
50:         <span class="ruby-comment cmt"># we are leaving head or have reached body, so we bail</span>
51:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">links</span> <span class="ruby-keyword kw">if</span> [<span class="ruby-value str">'/head'</span>, <span class="ruby-value str">'body'</span>, <span class="ruby-value str">'/body'</span>, <span class="ruby-value str">'/html'</span>].<span class="ruby-identifier">member?</span>(<span class="ruby-identifier">el</span>.<span class="ruby-identifier">tag_name</span>)
52: 
53:         <span class="ruby-comment cmt"># enforce html &gt; head &gt; link</span>
54:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">el</span>.<span class="ruby-identifier">tag_name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'html'</span>
55:           <span class="ruby-identifier">in_html</span> = <span class="ruby-keyword kw">true</span>
56:         <span class="ruby-keyword kw">end</span>
57:         <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">in_html</span>
58:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">el</span>.<span class="ruby-identifier">tag_name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'head'</span>
59:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">saw_head</span>
60:             <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">links</span> <span class="ruby-comment cmt">#only allow one head</span>
61:           <span class="ruby-keyword kw">end</span>
62:           <span class="ruby-identifier">saw_head</span> = <span class="ruby-keyword kw">true</span>
63:           <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">el</span>.<span class="ruby-identifier">to_s</span>[<span class="ruby-value">-2</span>] <span class="ruby-operator">==</span> <span class="ruby-value">47</span> <span class="ruby-comment cmt"># tag ends with a /: a short tag</span>
64:             <span class="ruby-identifier">in_head</span> = <span class="ruby-keyword kw">true</span>
65:           <span class="ruby-keyword kw">end</span>
66:         <span class="ruby-keyword kw">end</span>
67:         <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">in_head</span>
68: 
69:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">links</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">el</span>.<span class="ruby-identifier">tag_name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'html'</span>
70: 
71:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">el</span>.<span class="ruby-identifier">tag_name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'link'</span>
72:           <span class="ruby-identifier">links</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">unescape_hash</span>(<span class="ruby-identifier">el</span>.<span class="ruby-identifier">attr_hash</span>)
73:         <span class="ruby-keyword kw">end</span>
74:         
75:       <span class="ruby-keyword kw">end</span>
76:     <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Exception</span> <span class="ruby-comment cmt"># just stop parsing if there's an error</span>
77:     <span class="ruby-keyword kw">end</span>
78:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">links</span>
79:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000096">
                    
                    <a name="M000096"></a><b>rel_matches</b>(rel_attr, target_rel)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000096_source')" id="l_M000096_source">show</a>
                        
                    </p>
                    <div id="M000096_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/openid/consumer/html_parse.rb, line 81</span>
81:   <span class="ruby-keyword kw">def</span> <span class="ruby-constant">OpenID</span>.<span class="ruby-identifier">rel_matches</span>(<span class="ruby-identifier">rel_attr</span>, <span class="ruby-identifier">target_rel</span>)
82:     <span class="ruby-comment cmt"># Does this target_rel appear in the rel_str?</span>
83:     <span class="ruby-comment cmt"># XXX: TESTME</span>
84:     <span class="ruby-identifier">rels</span> = <span class="ruby-identifier">rel_attr</span>.<span class="ruby-identifier">strip</span>().<span class="ruby-identifier">split</span>()
85:     <span class="ruby-identifier">rels</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">rel</span><span class="ruby-operator">|</span>
86:       <span class="ruby-identifier">rel</span> = <span class="ruby-identifier">rel</span>.<span class="ruby-identifier">downcase</span>
87:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">rel</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">target_rel</span>
88:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span>
89:       <span class="ruby-keyword kw">end</span>
90:     }
91: 
92:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span>
93:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000246">
                    
                    <a name="M000246"></a><b>supports_sreg?</b>(endpoint)
                    
                </div>
                
                <div class="description">
                  <p>
Does the given endpoint advertise support for simple registration?
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000246_source')" id="l_M000246_source">show</a>
                        
                    </p>
                    <div id="M000246_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/openid/extensions/sreg.rb, line 37</span>
37:     <span class="ruby-keyword kw">def</span> <span class="ruby-constant">OpenID</span>.<span class="ruby-identifier">supports_sreg?</span>(<span class="ruby-identifier">endpoint</span>)
38:       <span class="ruby-identifier">endpoint</span>.<span class="ruby-identifier">uses_extension</span>(<span class="ruby-constant">NS_URI_1_1</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">endpoint</span>.<span class="ruby-identifier">uses_extension</span>(<span class="ruby-constant">NS_URI_1_0</span>)
39:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000092">
                    
                    <a name="M000092"></a><b>unescape_hash</b>(h)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000092_source')" id="l_M000092_source">show</a>
                        
                    </p>
                    <div id="M000092_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/openid/consumer/html_parse.rb, line 27</span>
27:   <span class="ruby-keyword kw">def</span> <span class="ruby-constant">OpenID</span>.<span class="ruby-identifier">unescape_hash</span>(<span class="ruby-identifier">h</span>)
28:     <span class="ruby-identifier">newh</span> = {}
29:     <span class="ruby-identifier">h</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
30:       <span class="ruby-identifier">newh</span>[<span class="ruby-identifier">k</span>]=<span class="ruby-identifier">openid_unescape</span>(<span class="ruby-identifier">v</span>)
31:     }
32:     <span class="ruby-identifier">newh</span>
33:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    