<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>ThinkingSphinx::Association</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../css/main.css" type="text/css" media="screen" />
    <script src="../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Class</span> 
            ThinkingSphinx::Association 
            
                <span class="parent">&lt; 
                    
                    <a href="../Object.html">Object</a>
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../files/lib/thinking_sphinx/association_rb.html">lib/thinking_sphinx/association.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    
    <div class="description">
        <p>
<a href="Association.html">Association</a> tracks a specific reflection and
join to reference data that isn&#8217;t in the base model. Very much an
internal class for Thinking Sphinx - perhaps because I feel it&#8217;s not
as strong (or simple) as most of the rest.
</p>

    </div>
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>A</dt>
        <dd>
            <ul>
                
                <li><a href="#M000142">ancestors</a>,</li>
                
                <li><a href="#M000134">arel_join</a></li>
                
            </ul>
        </dd>
    
        <dt>C</dt>
        <dd>
            <ul>
                
                <li><a href="#M000151">casted_options</a>,</li>
                
                <li><a href="#M000127">children</a>,</li>
                
                <li><a href="#M000126">children</a></li>
                
            </ul>
        </dd>
    
        <dt>D</dt>
        <dd>
            <ul>
                
                <li><a href="#M000149">depolymorphic_reflection</a></li>
                
            </ul>
        </dd>
    
        <dt>F</dt>
        <dd>
            <ul>
                
                <li><a href="#M000154">foreign_type</a></li>
                
            </ul>
        </dd>
    
        <dt>H</dt>
        <dd>
            <ul>
                
                <li><a href="#M000143">has_column?</a></li>
                
            </ul>
        </dd>
    
        <dt>I</dt>
        <dd>
            <ul>
                
                <li><a href="#M000141">is_many?</a></li>
                
            </ul>
        </dd>
    
        <dt>J</dt>
        <dd>
            <ul>
                
                <li><a href="#M000152">join_association_class</a>,</li>
                
                <li><a href="#M000153">join_parent</a>,</li>
                
                <li><a href="#M000133">join_to</a></li>
                
            </ul>
        </dd>
    
        <dt>N</dt>
        <dd>
            <ul>
                
                <li><a href="#M000121">new</a></li>
                
            </ul>
        </dd>
    
        <dt>P</dt>
        <dd>
            <ul>
                
                <li><a href="#M000150">polymorphic_classes</a>,</li>
                
                <li><a href="#M000144">primary_key_from_reflection</a></li>
                
            </ul>
        </dd>
    
        <dt>Q</dt>
        <dd>
            <ul>
                
                <li><a href="#M000157">quoted_alias</a></li>
                
            </ul>
        </dd>
    
        <dt>R</dt>
        <dd>
            <ul>
                
                <li><a href="#M000156">rewrite_condition</a>,</li>
                
                <li><a href="#M000155">rewrite_conditions</a></li>
                
            </ul>
        </dd>
    
        <dt>T</dt>
        <dd>
            <ul>
                
                <li><a href="#M000147">table</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    

    

    

    

    
    <div class="sectiontitle">Attributes</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>parent</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>reflection</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>join</td>
            <td class='attr-desc'></td>
        </tr>
        
    </table>
    

    
            <div class="sectiontitle">Class Public methods</div>
            
            <div class="method">
                <div class="title" id="M000127">
                    
                    <a name="M000127"></a><b>children</b>(klass, assoc, parent=nil)
                    
                </div>
                
                <div class="description">
                  <p>
Get the children associations for a given class, association name and
parent association. Much like the instance method of the same name, it will
return an empty array if no associations have the name, and only have
multiple association instances if the underlying relationship is
polymorphic.
</p>
<pre>
  Association.children(User, :pages, user_association)
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000127_source')" id="l_M000127_source">show</a>
                        
                    </p>
                    <div id="M000127_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/thinking_sphinx/association.rb, line 40</span>
40:     <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">children</span>(<span class="ruby-identifier">klass</span>, <span class="ruby-identifier">assoc</span>, <span class="ruby-identifier">parent</span>=<span class="ruby-keyword kw">nil</span>)
41:       <span class="ruby-identifier">ref</span> = <span class="ruby-identifier">klass</span>.<span class="ruby-identifier">reflect_on_association</span>(<span class="ruby-identifier">assoc</span>)
42:       
43:       <span class="ruby-keyword kw">return</span> [] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ref</span>.<span class="ruby-identifier">nil?</span>
44:       <span class="ruby-keyword kw">return</span> [<span class="ruby-constant">Association</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">parent</span>, <span class="ruby-identifier">ref</span>)] <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">ref</span>.<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:polymorphic</span>]
45:       
46:       <span class="ruby-comment cmt"># association is polymorphic - create associations for each</span>
47:       <span class="ruby-comment cmt"># non-polymorphic reflection.</span>
48:       <span class="ruby-identifier">polymorphic_classes</span>(<span class="ruby-identifier">ref</span>).<span class="ruby-identifier">collect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">poly_class</span><span class="ruby-operator">|</span>
49:         <span class="ruby-constant">Association</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">parent</span>, <span class="ruby-identifier">depolymorphic_reflection</span>(<span class="ruby-identifier">ref</span>, <span class="ruby-identifier">klass</span>, <span class="ruby-identifier">poly_class</span>)
50:       }
51:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000121">
                    
                    <a name="M000121"></a><b>new</b>(parent, reflection)
                    
                </div>
                
                <div class="description">
                  <p>
Create a new association by passing in the parent association, and the
corresponding reflection instance. If there is no parent, pass in nil.
</p>
<pre>
  top   = Association.new nil, top_reflection
  child = Association.new top, child_reflection
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000121_source')" id="l_M000121_source">show</a>
                        
                    </p>
                    <div id="M000121_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/thinking_sphinx/association.rb, line 15</span>
15:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">parent</span>, <span class="ruby-identifier">reflection</span>)
16:       <span class="ruby-ivar">@parent</span>, <span class="ruby-ivar">@reflection</span> = <span class="ruby-identifier">parent</span>, <span class="ruby-identifier">reflection</span>
17:       <span class="ruby-ivar">@children</span> = {}
18:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Class Private methods</div>
            
            <div class="method">
                <div class="title" id="M000151">
                    
                    <a name="M000151"></a><b>casted_options</b>(klass, ref)
                    
                </div>
                
                <div class="description">
                  <p>
Returns a new set of options for an association that mimics an existing
polymorphic relationship for a specific class. It adds a condition to
filter by the appropriate object.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000151_source')" id="l_M000151_source">show</a>
                        
                    </p>
                    <div id="M000151_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/thinking_sphinx/association.rb, line 153</span>
153:     <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">casted_options</span>(<span class="ruby-identifier">klass</span>, <span class="ruby-identifier">ref</span>)
154:       <span class="ruby-identifier">options</span> = <span class="ruby-identifier">ref</span>.<span class="ruby-identifier">options</span>.<span class="ruby-identifier">clone</span>
155:       <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:polymorphic</span>]   = <span class="ruby-keyword kw">nil</span>
156:       <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:class_name</span>]    = <span class="ruby-identifier">klass</span>.<span class="ruby-identifier">name</span>
157:       <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:foreign_key</span>] <span class="ruby-operator">||=</span> <span class="ruby-node">&quot;#{ref.name}_id&quot;</span>
158:       
159:       <span class="ruby-identifier">quoted_foreign_type</span> = <span class="ruby-identifier">klass</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">quote_column_name</span> <span class="ruby-identifier">foreign_type</span>(<span class="ruby-identifier">ref</span>)
160:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:conditions</span>]
161:       <span class="ruby-keyword kw">when</span> <span class="ruby-keyword kw">nil</span>
162:         <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:conditions</span>] = <span class="ruby-node">&quot;::ts_join_alias::.#{quoted_foreign_type} = '#{klass.name}'&quot;</span>
163:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Array</span>
164:         <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:conditions</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;::ts_join_alias::.#{quoted_foreign_type} = '#{klass.name}'&quot;</span>
165:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Hash</span>
166:         <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:conditions</span>].<span class="ruby-identifier">merge!</span>(<span class="ruby-identifier">foreign_type</span>(<span class="ruby-identifier">ref</span>) =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">klass</span>.<span class="ruby-identifier">name</span>)
167:       <span class="ruby-keyword kw">else</span>
168:         <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:conditions</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot; AND ::ts_join_alias::.#{quoted_foreign_type} = '#{klass.name}'&quot;</span>
169:       <span class="ruby-keyword kw">end</span>
170:       
171:       <span class="ruby-identifier">options</span>
172:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000149">
                    
                    <a name="M000149"></a><b>depolymorphic_reflection</b>(reflection, source_class, poly_class)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000149_source')" id="l_M000149_source">show</a>
                        
                    </p>
                    <div id="M000149_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/thinking_sphinx/association.rb, line 124</span>
124:     <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">depolymorphic_reflection</span>(<span class="ruby-identifier">reflection</span>, <span class="ruby-identifier">source_class</span>, <span class="ruby-identifier">poly_class</span>)
125:       <span class="ruby-identifier">name</span> = <span class="ruby-node">&quot;#{reflection.name}_#{poly_class.name}&quot;</span>.<span class="ruby-identifier">to_sym</span>
126:       
127:       <span class="ruby-identifier">source_class</span>.<span class="ruby-identifier">reflections</span>[<span class="ruby-identifier">name</span>] <span class="ruby-operator">||=</span>
128:         <span class="ruby-operator">::</span><span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Reflection</span><span class="ruby-operator">::</span><span class="ruby-constant">AssociationReflection</span>.<span class="ruby-identifier">new</span>(
129:           <span class="ruby-identifier">reflection</span>.<span class="ruby-identifier">macro</span>, <span class="ruby-identifier">name</span>, <span class="ruby-identifier">casted_options</span>(<span class="ruby-identifier">poly_class</span>, <span class="ruby-identifier">reflection</span>),
130:           <span class="ruby-identifier">reflection</span>.<span class="ruby-identifier">active_record</span>
131:         )
132:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000154">
                    
                    <a name="M000154"></a><b>foreign_type</b>(ref)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000154_source')" id="l_M000154_source">show</a>
                        
                    </p>
                    <div id="M000154_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/thinking_sphinx/association.rb, line 190</span>
190:     <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">foreign_type</span>(<span class="ruby-identifier">ref</span>)
191:       <span class="ruby-keyword kw">if</span> <span class="ruby-constant">ThinkingSphinx</span>.<span class="ruby-identifier">rails_3_1?</span>
192:         <span class="ruby-identifier">ref</span>.<span class="ruby-identifier">foreign_type</span>
193:       <span class="ruby-keyword kw">else</span>
194:         <span class="ruby-identifier">ref</span>.<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:foreign_type</span>]
195:       <span class="ruby-keyword kw">end</span>
196:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000150">
                    
                    <a name="M000150"></a><b>polymorphic_classes</b>(ref)
                    
                </div>
                
                <div class="description">
                  <p>
Returns all the objects that could be currently instantiated from a
polymorphic association. This is pretty damn fast if there&#8217;s an index
on the foreign type column - but if there isn&#8217;t, it can take a while
if you have a lot of data.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000150_source')" id="l_M000150_source">show</a>
                        
                    </p>
                    <div id="M000150_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/thinking_sphinx/association.rb, line 139</span>
139:     <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">polymorphic_classes</span>(<span class="ruby-identifier">ref</span>)
140:       <span class="ruby-identifier">ref</span>.<span class="ruby-identifier">active_record</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">select_all</span>(
141:         <span class="ruby-node">&quot;SELECT DISTINCT #{foreign_type(ref)} &quot;</span> <span class="ruby-operator">+</span>
142:         <span class="ruby-node">&quot;FROM #{ref.active_record.table_name} &quot;</span> <span class="ruby-operator">+</span>
143:         <span class="ruby-node">&quot;WHERE #{foreign_type(ref)} IS NOT NULL&quot;</span>
144:       ).<span class="ruby-identifier">collect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">row</span><span class="ruby-operator">|</span>
145:         <span class="ruby-identifier">row</span>[<span class="ruby-identifier">foreign_type</span>(<span class="ruby-identifier">ref</span>)].<span class="ruby-identifier">constantize</span>
146:       }
147:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M000142">
                    
                    <a name="M000142"></a><b>ancestors</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Returns an array of all the associations that lead to this one - starting
with the top level all the way to the current association object.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000142_source')" id="l_M000142_source">show</a>
                        
                    </p>
                    <div id="M000142_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/thinking_sphinx/association.rb, line 86</span>
86:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">ancestors</span>
87:       (<span class="ruby-identifier">parent</span> <span class="ruby-value">? </span><span class="ruby-identifier">parent</span>.<span class="ruby-identifier">ancestors</span> <span class="ruby-operator">:</span> []) <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-keyword kw">self</span>
88:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000134">
                    
                    <a name="M000134"></a><b>arel_join</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000134_source')" id="l_M000134_source">show</a>
                        
                    </p>
                    <div id="M000134_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/thinking_sphinx/association.rb, line 64</span>
64:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">arel_join</span>
65:       <span class="ruby-ivar">@join</span>.<span class="ruby-identifier">join_type</span> = <span class="ruby-constant">Arel</span><span class="ruby-operator">::</span><span class="ruby-constant">OuterJoin</span>
66:       <span class="ruby-identifier">rewrite_conditions</span>
67:       
68:       <span class="ruby-ivar">@join</span>
69:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000126">
                    
                    <a name="M000126"></a><b>children</b>(assoc)
                    
                </div>
                
                <div class="description">
                  <p>
Get the children associations for a given association name. The only time
that there&#8217;ll actually be more than one association is when the
relationship is polymorphic. To keep things simple though, it will always
be an Array that gets returned (an empty one if no matches).
</p>
<pre>
  # where pages is an association on the class tied to the reflection.
  association.children(:pages)
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000126_source')" id="l_M000126_source">show</a>
                        
                    </p>
                    <div id="M000126_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/thinking_sphinx/association.rb, line 28</span>
28:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">children</span>(<span class="ruby-identifier">assoc</span>)
29:       <span class="ruby-ivar">@children</span>[<span class="ruby-identifier">assoc</span>] <span class="ruby-operator">||=</span> <span class="ruby-constant">Association</span>.<span class="ruby-identifier">children</span>(<span class="ruby-ivar">@reflection</span>.<span class="ruby-identifier">klass</span>, <span class="ruby-identifier">assoc</span>, <span class="ruby-keyword kw">self</span>)
30:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000143">
                    
                    <a name="M000143"></a><b>has_column?</b>(column)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000143_source')" id="l_M000143_source">show</a>
                        
                    </p>
                    <div id="M000143_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/thinking_sphinx/association.rb, line 90</span>
90:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">has_column?</span>(<span class="ruby-identifier">column</span>)
91:       <span class="ruby-ivar">@reflection</span>.<span class="ruby-identifier">klass</span>.<span class="ruby-identifier">column_names</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">column</span>.<span class="ruby-identifier">to_s</span>)
92:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000141">
                    
                    <a name="M000141"></a><b>is_many?</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Returns true if the association - or a parent - is a has_many or
has_and_belongs_to_many.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000141_source')" id="l_M000141_source">show</a>
                        
                    </p>
                    <div id="M000141_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/thinking_sphinx/association.rb, line 74</span>
74:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">is_many?</span>
75:       <span class="ruby-keyword kw">case</span> <span class="ruby-ivar">@reflection</span>.<span class="ruby-identifier">macro</span>
76:       <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:has_many</span>, <span class="ruby-identifier">:has_and_belongs_to_many</span>
77:         <span class="ruby-keyword kw">true</span>
78:       <span class="ruby-keyword kw">else</span>
79:         <span class="ruby-ivar">@parent</span> <span class="ruby-operator">?</span> <span class="ruby-ivar">@parent</span>.<span class="ruby-identifier">is_many?</span> <span class="ruby-operator">:</span> <span class="ruby-keyword kw">false</span>
80:       <span class="ruby-keyword kw">end</span>
81:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000133">
                    
                    <a name="M000133"></a><b>join_to</b>(base_join)
                    
                </div>
                
                <div class="description">
                  <p>
Link up the join for this model from a base join - and set parent
associations&#8217; joins recursively.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000133_source')" id="l_M000133_source">show</a>
                        
                    </p>
                    <div id="M000133_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/thinking_sphinx/association.rb, line 56</span>
56:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">join_to</span>(<span class="ruby-identifier">base_join</span>)
57:       <span class="ruby-identifier">parent</span>.<span class="ruby-identifier">join_to</span>(<span class="ruby-identifier">base_join</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">parent</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">parent</span>.<span class="ruby-identifier">join</span>.<span class="ruby-identifier">nil?</span>
58:       
59:       <span class="ruby-ivar">@join</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">join_association_class</span>.<span class="ruby-identifier">new</span>(
60:         <span class="ruby-ivar">@reflection</span>, <span class="ruby-identifier">base_join</span>, <span class="ruby-identifier">parent</span> <span class="ruby-value">? </span><span class="ruby-identifier">parent</span>.<span class="ruby-identifier">join</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">join_parent</span>(<span class="ruby-identifier">base_join</span>)
61:       )
62:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000144">
                    
                    <a name="M000144"></a><b>primary_key_from_reflection</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000144_source')" id="l_M000144_source">show</a>
                        
                    </p>
                    <div id="M000144_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/thinking_sphinx/association.rb, line 94</span>
 94:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">primary_key_from_reflection</span>
 95:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@reflection</span>.<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:through</span>]
 96:         <span class="ruby-keyword kw">if</span> <span class="ruby-constant">ThinkingSphinx</span>.<span class="ruby-identifier">rails_3_1?</span>
 97:           <span class="ruby-ivar">@reflection</span>.<span class="ruby-identifier">source_reflection</span>.<span class="ruby-identifier">foreign_key</span>
 98:         <span class="ruby-keyword kw">else</span>
 99:           <span class="ruby-ivar">@reflection</span>.<span class="ruby-identifier">source_reflection</span>.<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:foreign_key</span>] <span class="ruby-operator">||</span>
100:           <span class="ruby-ivar">@reflection</span>.<span class="ruby-identifier">source_reflection</span>.<span class="ruby-identifier">primary_key_name</span>
101:         <span class="ruby-keyword kw">end</span>
102:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-ivar">@reflection</span>.<span class="ruby-identifier">macro</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:has_and_belongs_to_many</span>
103:         <span class="ruby-ivar">@reflection</span>.<span class="ruby-identifier">association_foreign_key</span>
104:       <span class="ruby-keyword kw">else</span>
105:         <span class="ruby-keyword kw">nil</span>
106:       <span class="ruby-keyword kw">end</span>
107:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000147">
                    
                    <a name="M000147"></a><b>table</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000147_source')" id="l_M000147_source">show</a>
                        
                    </p>
                    <div id="M000147_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/thinking_sphinx/association.rb, line 109</span>
109:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">table</span>
110:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@reflection</span>.<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:through</span>] <span class="ruby-operator">||</span>
111:         <span class="ruby-ivar">@reflection</span>.<span class="ruby-identifier">macro</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:has_and_belongs_to_many</span>
112:         <span class="ruby-keyword kw">if</span> <span class="ruby-constant">ThinkingSphinx</span>.<span class="ruby-identifier">rails_3_1?</span>
113:           <span class="ruby-ivar">@join</span>.<span class="ruby-identifier">tables</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">name</span>
114:         <span class="ruby-keyword kw">else</span>
115:           <span class="ruby-ivar">@join</span>.<span class="ruby-identifier">aliased_join_table_name</span>
116:         <span class="ruby-keyword kw">end</span>
117:       <span class="ruby-keyword kw">else</span>
118:         <span class="ruby-ivar">@join</span>.<span class="ruby-identifier">aliased_table_name</span>
119:       <span class="ruby-keyword kw">end</span>
120:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Private methods</div>
            
            <div class="method">
                <div class="title" id="M000152">
                    
                    <a name="M000152"></a><b>join_association_class</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000152_source')" id="l_M000152_source">show</a>
                        
                    </p>
                    <div id="M000152_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/thinking_sphinx/association.rb, line 174</span>
174:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">join_association_class</span>
175:       <span class="ruby-keyword kw">if</span> <span class="ruby-constant">ThinkingSphinx</span>.<span class="ruby-identifier">rails_3_1?</span>
176:         <span class="ruby-operator">::</span><span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Associations</span><span class="ruby-operator">::</span><span class="ruby-constant">JoinDependency</span><span class="ruby-operator">::</span><span class="ruby-constant">JoinAssociation</span>
177:       <span class="ruby-keyword kw">else</span>
178:         <span class="ruby-operator">::</span><span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Associations</span><span class="ruby-operator">::</span><span class="ruby-constant">ClassMethods</span><span class="ruby-operator">::</span><span class="ruby-constant">JoinDependency</span><span class="ruby-operator">::</span><span class="ruby-constant">JoinAssociation</span>
179:       <span class="ruby-keyword kw">end</span>
180:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000153">
                    
                    <a name="M000153"></a><b>join_parent</b>(join)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000153_source')" id="l_M000153_source">show</a>
                        
                    </p>
                    <div id="M000153_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/thinking_sphinx/association.rb, line 182</span>
182:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">join_parent</span>(<span class="ruby-identifier">join</span>)
183:       <span class="ruby-keyword kw">if</span> <span class="ruby-constant">ThinkingSphinx</span>.<span class="ruby-identifier">rails_3_1?</span>
184:         <span class="ruby-identifier">join</span>.<span class="ruby-identifier">join_parts</span>.<span class="ruby-identifier">first</span>
185:       <span class="ruby-keyword kw">else</span>
186:         <span class="ruby-identifier">join</span>.<span class="ruby-identifier">joins</span>.<span class="ruby-identifier">first</span>
187:       <span class="ruby-keyword kw">end</span>
188:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000157">
                    
                    <a name="M000157"></a><b>quoted_alias</b>(join)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000157_source')" id="l_M000157_source">show</a>
                        
                    </p>
                    <div id="M000157_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/thinking_sphinx/association.rb, line 224</span>
224:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">quoted_alias</span>(<span class="ruby-identifier">join</span>)
225:       <span class="ruby-ivar">@reflection</span>.<span class="ruby-identifier">klass</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">quote_table_name</span>(
226:         <span class="ruby-identifier">join</span>.<span class="ruby-identifier">aliased_table_name</span>
227:       )
228:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000156">
                    
                    <a name="M000156"></a><b>rewrite_condition</b>(condition)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000156_source')" id="l_M000156_source">show</a>
                        
                    </p>
                    <div id="M000156_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/thinking_sphinx/association.rb, line 211</span>
211:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">rewrite_condition</span>(<span class="ruby-identifier">condition</span>)
212:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">condition</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">condition</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>)
213:       
214:       <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">defined?</span>(<span class="ruby-constant">ActsAsTaggableOn</span>) <span class="ruby-operator">&amp;&amp;</span>
215:         <span class="ruby-ivar">@reflection</span>.<span class="ruby-identifier">klass</span> <span class="ruby-operator">==</span> <span class="ruby-constant">ActsAsTaggableOn</span><span class="ruby-operator">::</span><span class="ruby-constant">Tagging</span> <span class="ruby-operator">&amp;&amp;</span>
216:         <span class="ruby-ivar">@reflection</span>.<span class="ruby-identifier">name</span>.<span class="ruby-identifier">to_s</span>[<span class="ruby-regexp re">/_taggings$/</span>]
217:         <span class="ruby-identifier">condition</span>.<span class="ruby-identifier">gsub!</span> <span class="ruby-regexp re">/taggings\.tag_id = tags\.id AND/</span>, <span class="ruby-value str">&quot;&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-constant">ThinkingSphinx</span>.<span class="ruby-identifier">rails_3_1?</span>
218:         <span class="ruby-identifier">condition</span> = <span class="ruby-identifier">condition</span>.<span class="ruby-identifier">gsub</span> <span class="ruby-regexp re">/taggings\./</span>, <span class="ruby-node">&quot;#{quoted_alias @join}.&quot;</span>
219:       <span class="ruby-keyword kw">end</span>
220:       
221:       <span class="ruby-identifier">condition</span>.<span class="ruby-identifier">gsub</span> <span class="ruby-regexp re">/::ts_join_alias::/</span>, <span class="ruby-identifier">quoted_alias</span>(<span class="ruby-ivar">@join</span>.<span class="ruby-identifier">parent</span>)
222:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000155">
                    
                    <a name="M000155"></a><b>rewrite_conditions</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000155_source')" id="l_M000155_source">show</a>
                        
                    </p>
                    <div id="M000155_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/thinking_sphinx/association.rb, line 198</span>
198:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">rewrite_conditions</span>
199:       <span class="ruby-ivar">@join</span>.<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:conditions</span>] = <span class="ruby-keyword kw">case</span> <span class="ruby-ivar">@join</span>.<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:conditions</span>]
200:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">String</span>
201:         <span class="ruby-identifier">rewrite_condition</span> <span class="ruby-ivar">@join</span>.<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:conditions</span>]
202:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Array</span>
203:         <span class="ruby-ivar">@join</span>.<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:conditions</span>].<span class="ruby-identifier">collect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">condition</span><span class="ruby-operator">|</span>
204:           <span class="ruby-identifier">rewrite_condition</span> <span class="ruby-identifier">condition</span>
205:         }
206:       <span class="ruby-keyword kw">else</span>
207:         <span class="ruby-ivar">@join</span>.<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:conditions</span>]
208:       <span class="ruby-keyword kw">end</span>
209:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    