<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>ThinkingSphinx::Attribute</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../css/main.css" type="text/css" media="screen" />
    <script src="../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Class</span> 
            ThinkingSphinx::Attribute 
            
                <span class="parent">&lt; 
                    
                    <a href="Property.html">ThinkingSphinx::Property</a>
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../files/lib/thinking_sphinx/attribute_rb.html">lib/thinking_sphinx/attribute.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    
    <div class="description">
        <p>
Attributes - eternally useful when it comes to filtering, sorting or
grouping. This class isn&#8217;t really useful to you unless you&#8217;re
hacking around with the internals of Thinking Sphinx - but hey, don&#8217;t
let that stop you.
</p>
<p>
One key thing to remember - if you&#8217;re using the attribute manually to
generate SQL statements, you&#8217;ll need to set the base model, and all
the associations. Which can get messy. Use Index.link!, it really helps.
</p>

    </div>
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>A</dt>
        <dd>
            <ul>
                
                <li><a href="#M000173">all_datetimes?</a>,</li>
                
                <li><a href="#M000172">all_ints?</a>,</li>
                
                <li><a href="#M000197">all_of_type?</a>,</li>
                
                <li><a href="#M000174">all_strings?</a>,</li>
                
                <li><a href="#M000186">association_joins</a></li>
                
            </ul>
        </dd>
    
        <dt>B</dt>
        <dd>
            <ul>
                
                <li><a href="#M000185">base_association_for_mva</a></li>
                
            </ul>
        </dd>
    
        <dt>C</dt>
        <dd>
            <ul>
                
                <li><a href="#M000196">column_from_db</a>,</li>
                
                <li><a href="#M000163">config_value</a></li>
                
            </ul>
        </dd>
    
        <dt>E</dt>
        <dd>
            <ul>
                
                <li><a href="#M000184">end_association_for_mva</a></li>
                
            </ul>
        </dd>
    
        <dt>F</dt>
        <dd>
            <ul>
                
                <li><a href="#M000183">foreign_key_for_mva</a></li>
                
            </ul>
        </dd>
    
        <dt>I</dt>
        <dd>
            <ul>
                
                <li><a href="#M000162">include_as_association?</a>,</li>
                
                <li><a href="#M000199">insensitive?</a>,</li>
                
                <li><a href="#M000195">integer_type_from_db</a>,</li>
                
                <li><a href="#M000191">is_many_datetimes?</a>,</li>
                
                <li><a href="#M000190">is_many_ints?</a>,</li>
                
                <li><a href="#M000192">is_many_strings?</a></li>
                
            </ul>
        </dd>
    
        <dt>L</dt>
        <dd>
            <ul>
                
                <li><a href="#M000171">live_value</a></li>
                
            </ul>
        </dd>
    
        <dt>N</dt>
        <dd>
            <ul>
                
                <li><a href="#M000159">new</a></li>
                
            </ul>
        </dd>
    
        <dt>P</dt>
        <dd>
            <ul>
                
                <li><a href="#M000182">primary_key_for_mva</a></li>
                
            </ul>
        </dd>
    
        <dt>Q</dt>
        <dd>
            <ul>
                
                <li><a href="#M000178">query</a>,</li>
                
                <li><a href="#M000179">query_clause</a>,</li>
                
                <li><a href="#M000180">query_delta</a></li>
                
            </ul>
        </dd>
    
        <dt>R</dt>
        <dd>
            <ul>
                
                <li><a href="#M000181">range_query</a></li>
                
            </ul>
        </dd>
    
        <dt>S</dt>
        <dd>
            <ul>
                
                <li><a href="#M000177">source_value</a>,</li>
                
                <li><a href="#M000198">sphinx_value</a></li>
                
            </ul>
        </dd>
    
        <dt>T</dt>
        <dd>
            <ul>
                
                <li><a href="#M000160">to_select_sql</a>,</li>
                
                <li><a href="#M000193">translated_type_from_database</a>,</li>
                
                <li><a href="#M000164">type</a>,</li>
                
                <li><a href="#M000194">type_from_database</a>,</li>
                
                <li><a href="#M000161">type_to_config</a></li>
                
            </ul>
        </dd>
    
        <dt>U</dt>
        <dd>
            <ul>
                
                <li><a href="#M000165">updatable?</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    

    

    

    
    <div class="sectiontitle">Constants</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class="attr-name">SphinxTypeMappings</td>
            <td>=</td>
            <td class="attr-value">{       :multi     =&gt; :sql_attr_multi,       :datetime  =&gt; :sql_attr_timestamp,       :string    =&gt; :sql_attr_str2ordinal,       :float     =&gt; :sql_attr_float,       :boolean   =&gt; :sql_attr_bool,       :integer   =&gt; :sql_attr_uint,       :bigint    =&gt; :sql_attr_bigint,       :wordcount =&gt; :sql_attr_str2wordcount     }</td>
        </tr>
        
        
    </table>
    

    
    <div class="sectiontitle">Attributes</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>query_source</td>
            <td class='attr-desc'></td>
        </tr>
        
    </table>
    

    
            <div class="sectiontitle">Class Public methods</div>
            
            <div class="method">
                <div class="title" id="M000159">
                    
                    <a name="M000159"></a><b>new</b>(source, columns, options = {})
                    
                </div>
                
                <div class="description">
                  <p>
To create a new attribute, you&#8217;ll need to pass in either a single
Column or an array of them, and some (optional) options.
</p>
<p>
Valid options are:
</p>
<ul>
<li>:as => :alias_name

</li>
<li>:type => :attribute_type

</li>
<li>:source => :field, :query, :ranged_query

</li>
</ul>
<p>
Alias is only required in three circumstances: when there&#8217;s another
attribute or field with the same name, when the column name is
&#8216;id&#8217;, or when there&#8217;s more than one column.
</p>
<p>
Type is not required, unless you want to force a column to be a certain
type (but keep in mind the value will not be CASTed in the SQL statements).
The only time you really need to use this is when the type can&#8217;t be
figured out by the column - ie: when not actually using a database column
as your source.
</p>
<p>
<a href="Source.html">Source</a> is only used for multi-value attributes
(MVA). By default this will use a left-join and a group_concat to obtain
the values. For better performance during indexing it can be beneficial to
let Sphinx use a separate query to retrieve all document,value-pairs.
Either :query or :ranged_query will enable this feature, where
:ranged_query will cause the query to be executed incremental.
</p>
<p>
Example usage:
</p>
<pre>
  Attribute.new(
    Column.new(:created_at)
  )

  Attribute.new(
    Column.new(:posts, :id),
    :as =&gt; :post_ids
  )

  Attribute.new(
    Column.new(:posts, :id),
    :as =&gt; :post_ids,
    :source =&gt; :ranged_query
  )

  Attribute.new(
    [Column.new(:pages, :id), Column.new(:articles, :id)],
    :as =&gt; :content_ids
  )

  Attribute.new(
    Column.new(&quot;NOW()&quot;),
    :as   =&gt; :indexed_at,
    :type =&gt; :datetime
  )
</pre>
<p>
If you&#8217;re creating attributes for latitude and longitude, don&#8217;t
forget that Sphinx expects these values to be in radians.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000159_source')" id="l_M000159_source">show</a>
                        
                    </p>
                    <div id="M000159_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/thinking_sphinx/attribute.rb, line 81</span>
81:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">source</span>, <span class="ruby-identifier">columns</span>, <span class="ruby-identifier">options</span> = {})
82:       <span class="ruby-keyword kw">super</span>
83: 
84:       <span class="ruby-ivar">@type</span>           = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:type</span>]
85:       <span class="ruby-ivar">@query_source</span>   = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:source</span>]
86:       <span class="ruby-ivar">@crc</span>            = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:crc</span>]
87:       <span class="ruby-ivar">@all_ints</span>       = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:all_ints</span>]
88: 
89:       <span class="ruby-ivar">@type</span>         <span class="ruby-operator">||=</span> <span class="ruby-identifier">:multi</span>    <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@query_source</span>.<span class="ruby-identifier">nil?</span>
90:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@type</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:string</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@crc</span>
91:         <span class="ruby-ivar">@type</span> = <span class="ruby-identifier">is_many?</span> <span class="ruby-value">? </span><span class="ruby-operator">:</span><span class="ruby-identifier">multi</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">:integer</span>
92:       <span class="ruby-keyword kw">end</span>
93: 
94:       <span class="ruby-identifier">source</span>.<span class="ruby-identifier">attributes</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-keyword kw">self</span>
95:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M000173">
                    
                    <a name="M000173"></a><b>all_datetimes?</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000173_source')" id="l_M000173_source">show</a>
                        
                    </p>
                    <div id="M000173_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/thinking_sphinx/attribute.rb, line 201</span>
201:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">all_datetimes?</span>
202:       <span class="ruby-identifier">all_of_type?</span>(<span class="ruby-identifier">:datetime</span>, <span class="ruby-identifier">:date</span>, <span class="ruby-identifier">:timestamp</span>)
203:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000172">
                    
                    <a name="M000172"></a><b>all_ints?</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000172_source')" id="l_M000172_source">show</a>
                        
                    </p>
                    <div id="M000172_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/thinking_sphinx/attribute.rb, line 197</span>
197:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">all_ints?</span>
198:       <span class="ruby-ivar">@all_ints</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">all_of_type?</span>(<span class="ruby-identifier">:integer</span>)
199:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000174">
                    
                    <a name="M000174"></a><b>all_strings?</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000174_source')" id="l_M000174_source">show</a>
                        
                    </p>
                    <div id="M000174_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/thinking_sphinx/attribute.rb, line 205</span>
205:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">all_strings?</span>
206:       <span class="ruby-identifier">all_of_type?</span>(<span class="ruby-identifier">:string</span>, <span class="ruby-identifier">:text</span>)
207:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000163">
                    
                    <a name="M000163"></a><b>config_value</b>(offset = nil, delta = false)
                    
                </div>
                
                <div class="description">
                  <p>
Returns the configuration value that should be used for the attribute.
Special case is the multi-valued attribute that needs some extra
configuration.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000163_source')" id="l_M000163_source">show</a>
                        
                    </p>
                    <div id="M000163_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/thinking_sphinx/attribute.rb, line 144</span>
144:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">config_value</span>(<span class="ruby-identifier">offset</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">delta</span> = <span class="ruby-keyword kw">false</span>)
145:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:multi</span>
146:         <span class="ruby-identifier">multi_config</span> = <span class="ruby-identifier">include_as_association?</span> <span class="ruby-value">? </span><span class="ruby-value str">&quot;field&quot;</span> <span class="ruby-operator">:</span>
147:           <span class="ruby-identifier">source_value</span>(<span class="ruby-identifier">offset</span>, <span class="ruby-identifier">delta</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/\s+/</span><span class="ruby-identifier">m</span>, <span class="ruby-value str">&quot; &quot;</span>).<span class="ruby-identifier">strip</span>
148:         <span class="ruby-node">&quot;uint #{unique_name} from #{multi_config}&quot;</span>
149:       <span class="ruby-keyword kw">else</span>
150:         <span class="ruby-identifier">unique_name</span>
151:       <span class="ruby-keyword kw">end</span>
152:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000162">
                    
                    <a name="M000162"></a><b>include_as_association?</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000162_source')" id="l_M000162_source">show</a>
                        
                    </p>
                    <div id="M000162_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/thinking_sphinx/attribute.rb, line 135</span>
135:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">include_as_association?</span>
136:       <span class="ruby-operator">!</span> (<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:multi</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">query_source</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:query</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">query_source</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:ranged_query</span>))
137:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000171">
                    
                    <a name="M000171"></a><b>live_value</b>(instance)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000171_source')" id="l_M000171_source">show</a>
                        
                    </p>
                    <div id="M000171_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/thinking_sphinx/attribute.rb, line 186</span>
186:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">live_value</span>(<span class="ruby-identifier">instance</span>)
187:       <span class="ruby-identifier">object</span> = <span class="ruby-identifier">instance</span>
188:       <span class="ruby-identifier">column</span> = <span class="ruby-ivar">@columns</span>.<span class="ruby-identifier">first</span>
189:       <span class="ruby-identifier">column</span>.<span class="ruby-identifier">__stack</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">method</span><span class="ruby-operator">|</span>
190:         <span class="ruby-identifier">object</span> = <span class="ruby-identifier">object</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">method</span>)
191:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">sphinx_value</span>(<span class="ruby-keyword kw">nil</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">object</span>.<span class="ruby-identifier">nil?</span>
192:       }
193: 
194:       <span class="ruby-identifier">sphinx_value</span> <span class="ruby-identifier">object</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">column</span>.<span class="ruby-identifier">__name</span>)
195:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000160">
                    
                    <a name="M000160"></a><b>to_select_sql</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Get the part of the SELECT clause related to this attribute. Don&#8217;t
forget to set your model and associations first though.
</p>
<p>
This will concatenate strings and arrays of integers, and convert datetimes
to timestamps, as needed.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000160_source')" id="l_M000160_source">show</a>
                        
                    </p>
                    <div id="M000160_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/thinking_sphinx/attribute.rb, line 103</span>
103:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">to_select_sql</span>
104:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">include_as_association?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">available?</span>
105: 
106:       <span class="ruby-identifier">separator</span> = <span class="ruby-identifier">all_ints?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">all_datetimes?</span> <span class="ruby-operator">||</span> <span class="ruby-ivar">@crc</span> <span class="ruby-operator">?</span> <span class="ruby-value str">','</span> <span class="ruby-operator">:</span> <span class="ruby-value str">' '</span>
107: 
108:       <span class="ruby-identifier">clause</span> = <span class="ruby-identifier">columns_with_prefixes</span>.<span class="ruby-identifier">collect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">column</span><span class="ruby-operator">|</span>
109:         <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">type</span>
110:         <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:string</span>
111:           <span class="ruby-identifier">adapter</span>.<span class="ruby-identifier">convert_nulls</span>(<span class="ruby-identifier">column</span>)
112:         <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:datetime</span>
113:           <span class="ruby-identifier">adapter</span>.<span class="ruby-identifier">cast_to_datetime</span>(<span class="ruby-identifier">column</span>)
114:         <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:multi</span>
115:           <span class="ruby-identifier">column</span> = <span class="ruby-identifier">adapter</span>.<span class="ruby-identifier">cast_to_datetime</span>(<span class="ruby-identifier">column</span>)   <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">is_many_datetimes?</span>
116:           <span class="ruby-identifier">column</span> = <span class="ruby-identifier">adapter</span>.<span class="ruby-identifier">convert_nulls</span>(<span class="ruby-identifier">column</span>, <span class="ruby-value str">'0'</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">is_many_ints?</span>
117:           <span class="ruby-identifier">column</span>
118:         <span class="ruby-keyword kw">else</span>
119:           <span class="ruby-identifier">column</span>
120:         <span class="ruby-keyword kw">end</span>
121:       }.<span class="ruby-identifier">join</span>(<span class="ruby-value str">', '</span>)
122: 
123:       <span class="ruby-identifier">clause</span> = <span class="ruby-identifier">adapter</span>.<span class="ruby-identifier">crc</span>(<span class="ruby-identifier">clause</span>)                          <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@crc</span>
124:       <span class="ruby-identifier">clause</span> = <span class="ruby-identifier">adapter</span>.<span class="ruby-identifier">concatenate</span>(<span class="ruby-identifier">clause</span>, <span class="ruby-identifier">separator</span>)       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">concat_ws?</span>
125:       <span class="ruby-identifier">clause</span> = <span class="ruby-identifier">adapter</span>.<span class="ruby-identifier">group_concatenate</span>(<span class="ruby-identifier">clause</span>, <span class="ruby-identifier">separator</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">is_many?</span>
126:       <span class="ruby-identifier">clause</span> = <span class="ruby-identifier">adapter</span>.<span class="ruby-identifier">downcase</span>(<span class="ruby-identifier">clause</span>)                     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">insensitive?</span>
127: 
128:       <span class="ruby-node">&quot;#{clause} AS #{quote_column(unique_name)}&quot;</span>
129:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000164">
                    
                    <a name="M000164"></a><b>type</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Returns the type of the column. If that&#8217;s not already set, it returns
:multi if there&#8217;s the possibility of more than one value, :string if
there&#8217;s more than one association, otherwise it figures out what the
actual column&#8217;s datatype is and returns that.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000164_source')" id="l_M000164_source">show</a>
                        
                    </p>
                    <div id="M000164_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/thinking_sphinx/attribute.rb, line 159</span>
159:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">type</span>
160:       <span class="ruby-ivar">@type</span> <span class="ruby-operator">||=</span> <span class="ruby-keyword kw">begin</span>
161:         <span class="ruby-identifier">base_type</span> = <span class="ruby-keyword kw">case</span>
162:         <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">is_many?</span>, <span class="ruby-identifier">is_many_ints?</span>
163:           <span class="ruby-identifier">:multi</span>
164:         <span class="ruby-keyword kw">when</span> <span class="ruby-ivar">@associations</span>.<span class="ruby-identifier">values</span>.<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>
165:           <span class="ruby-identifier">:string</span>
166:         <span class="ruby-keyword kw">else</span>
167:           <span class="ruby-identifier">translated_type_from_database</span>
168:         <span class="ruby-keyword kw">end</span>
169: 
170:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">base_type</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:string</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@crc</span>
171:           <span class="ruby-identifier">base_type</span> = <span class="ruby-identifier">:integer</span>
172:         <span class="ruby-keyword kw">else</span>
173:           <span class="ruby-ivar">@crc</span> = <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">base_type</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:multi</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">is_many_strings?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@crc</span>
174:         <span class="ruby-keyword kw">end</span>
175: 
176:         <span class="ruby-identifier">base_type</span>
177:       <span class="ruby-keyword kw">end</span>
178:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000161">
                    
                    <a name="M000161"></a><b>type_to_config</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000161_source')" id="l_M000161_source">show</a>
                        
                    </p>
                    <div id="M000161_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/thinking_sphinx/attribute.rb, line 131</span>
131:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">type_to_config</span>
132:       <span class="ruby-constant">SphinxTypeMappings</span>[<span class="ruby-identifier">type</span>]
133:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000165">
                    
                    <a name="M000165"></a><b>updatable?</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000165_source')" id="l_M000165_source">show</a>
                        
                    </p>
                    <div id="M000165_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/thinking_sphinx/attribute.rb, line 180</span>
180:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">updatable?</span>
181:       [<span class="ruby-identifier">:integer</span>, <span class="ruby-identifier">:datetime</span>, <span class="ruby-identifier">:boolean</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">type</span>) <span class="ruby-operator">&amp;&amp;</span>
182:       <span class="ruby-identifier">unique_name</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">:sphinx_internal_id</span> <span class="ruby-operator">&amp;&amp;</span>
183:       <span class="ruby-operator">!</span><span class="ruby-identifier">is_string?</span>
184:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Private methods</div>
            
            <div class="method">
                <div class="title" id="M000197">
                    
                    <a name="M000197"></a><b>all_of_type?</b>(*column_types)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000197_source')" id="l_M000197_source">show</a>
                        
                    </p>
                    <div id="M000197_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/thinking_sphinx/attribute.rb, line 375</span>
375:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">all_of_type?</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">column_types</span>)
376:       <span class="ruby-ivar">@columns</span>.<span class="ruby-identifier">all?</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">col</span><span class="ruby-operator">|</span>
377:         <span class="ruby-identifier">klasses</span> = <span class="ruby-ivar">@associations</span>[<span class="ruby-identifier">col</span>].<span class="ruby-identifier">empty?</span> <span class="ruby-value">? </span>[<span class="ruby-ivar">@model</span>] <span class="ruby-operator">:</span>
378:           <span class="ruby-ivar">@associations</span>[<span class="ruby-identifier">col</span>].<span class="ruby-identifier">collect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">assoc</span><span class="ruby-operator">|</span> <span class="ruby-identifier">assoc</span>.<span class="ruby-identifier">reflection</span>.<span class="ruby-identifier">klass</span> }
379:         <span class="ruby-identifier">klasses</span>.<span class="ruby-identifier">all?</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">klass</span><span class="ruby-operator">|</span>
380:           <span class="ruby-identifier">column</span> = <span class="ruby-identifier">klass</span>.<span class="ruby-identifier">columns</span>.<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">column</span><span class="ruby-operator">|</span> <span class="ruby-identifier">column</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">col</span>.<span class="ruby-identifier">__name</span>.<span class="ruby-identifier">to_s</span> }
381:           <span class="ruby-operator">!</span><span class="ruby-identifier">column</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">column_types</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">column</span>.<span class="ruby-identifier">type</span>)
382:         }
383:       }
384:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000186">
                    
                    <a name="M000186"></a><b>association_joins</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000186_source')" id="l_M000186_source">show</a>
                        
                    </p>
                    <div id="M000186_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/thinking_sphinx/attribute.rb, line 303</span>
303:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">association_joins</span>
304:       <span class="ruby-identifier">joins</span> = []
305:       <span class="ruby-identifier">assoc</span> = <span class="ruby-identifier">end_association_for_mva</span>
306:       <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">assoc</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">base_association_for_mva</span>
307:         <span class="ruby-identifier">joins</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">assoc</span>.<span class="ruby-identifier">join</span>
308:         <span class="ruby-identifier">assoc</span> = <span class="ruby-identifier">assoc</span>.<span class="ruby-identifier">parent</span>
309:       <span class="ruby-keyword kw">end</span>
310: 
311:       <span class="ruby-identifier">joins</span>
312:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000185">
                    
                    <a name="M000185"></a><b>base_association_for_mva</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000185_source')" id="l_M000185_source">show</a>
                        
                    </p>
                    <div id="M000185_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/thinking_sphinx/attribute.rb, line 292</span>
292:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">base_association_for_mva</span>
293:       <span class="ruby-ivar">@first_association_for_mva</span> <span class="ruby-operator">||=</span> <span class="ruby-keyword kw">begin</span>
294:         <span class="ruby-identifier">assoc</span> = <span class="ruby-identifier">end_association_for_mva</span>
295:         <span class="ruby-keyword kw">while</span> <span class="ruby-operator">!</span><span class="ruby-identifier">assoc</span>.<span class="ruby-identifier">parent</span>.<span class="ruby-identifier">nil?</span>
296:           <span class="ruby-identifier">assoc</span> = <span class="ruby-identifier">assoc</span>.<span class="ruby-identifier">parent</span>
297:         <span class="ruby-keyword kw">end</span>
298: 
299:         <span class="ruby-identifier">assoc</span>
300:       <span class="ruby-keyword kw">end</span>
301:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000196">
                    
                    <a name="M000196"></a><b>column_from_db</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000196_source')" id="l_M000196_source">show</a>
                        
                    </p>
                    <div id="M000196_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/thinking_sphinx/attribute.rb, line 366</span>
366:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">column_from_db</span>
367:       <span class="ruby-identifier">klass</span> = <span class="ruby-ivar">@associations</span>.<span class="ruby-identifier">values</span>.<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">first</span> <span class="ruby-value">?
368: </span>        <span class="ruby-ivar">@associations</span>.<span class="ruby-identifier">values</span>.<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">reflection</span>.<span class="ruby-identifier">klass</span> <span class="ruby-operator">:</span> <span class="ruby-ivar">@model</span>
369: 
370:       <span class="ruby-identifier">klass</span>.<span class="ruby-identifier">columns</span>.<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">col</span><span class="ruby-operator">|</span>
371:         <span class="ruby-ivar">@columns</span>.<span class="ruby-identifier">collect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">__name</span>.<span class="ruby-identifier">to_s</span> }.<span class="ruby-identifier">include?</span> <span class="ruby-identifier">col</span>.<span class="ruby-identifier">name</span>
372:       }
373:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000184">
                    
                    <a name="M000184"></a><b>end_association_for_mva</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000184_source')" id="l_M000184_source">show</a>
                        
                    </p>
                    <div id="M000184_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/thinking_sphinx/attribute.rb, line 286</span>
286:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">end_association_for_mva</span>
287:       <span class="ruby-ivar">@association_for_mva</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">associations</span>[<span class="ruby-identifier">columns</span>.<span class="ruby-identifier">first</span>].<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">assoc</span><span class="ruby-operator">|</span>
288:         <span class="ruby-identifier">assoc</span>.<span class="ruby-identifier">has_column?</span>(<span class="ruby-identifier">columns</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">__name</span>)
289:       }
290:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000183">
                    
                    <a name="M000183"></a><b>foreign_key_for_mva</b>(assoc)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000183_source')" id="l_M000183_source">show</a>
                        
                    </p>
                    <div id="M000183_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/thinking_sphinx/attribute.rb, line 274</span>
274:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">foreign_key_for_mva</span>(<span class="ruby-identifier">assoc</span>)
275:       <span class="ruby-keyword kw">if</span> <span class="ruby-constant">ThinkingSphinx</span>.<span class="ruby-identifier">rails_3_1?</span>
276:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">assoc</span>.<span class="ruby-identifier">reflection</span>.<span class="ruby-identifier">through_reflection</span>
277:           <span class="ruby-identifier">quote_with_table</span> <span class="ruby-identifier">assoc</span>.<span class="ruby-identifier">table</span>, <span class="ruby-identifier">assoc</span>.<span class="ruby-identifier">reflection</span>.<span class="ruby-identifier">through_reflection</span>.<span class="ruby-identifier">foreign_key</span>
278:         <span class="ruby-keyword kw">else</span>
279:           <span class="ruby-identifier">quote_with_table</span> <span class="ruby-identifier">assoc</span>.<span class="ruby-identifier">table</span>, <span class="ruby-identifier">assoc</span>.<span class="ruby-identifier">reflection</span>.<span class="ruby-identifier">foreign_key</span>
280:         <span class="ruby-keyword kw">end</span>
281:       <span class="ruby-keyword kw">else</span>
282:         <span class="ruby-identifier">quote_with_table</span> <span class="ruby-identifier">assoc</span>.<span class="ruby-identifier">table</span>, <span class="ruby-identifier">assoc</span>.<span class="ruby-identifier">reflection</span>.<span class="ruby-identifier">primary_key_name</span>
283:       <span class="ruby-keyword kw">end</span>
284:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000199">
                    
                    <a name="M000199"></a><b>insensitive?</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000199_source')" id="l_M000199_source">show</a>
                        
                    </p>
                    <div id="M000199_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/thinking_sphinx/attribute.rb, line 403</span>
403:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">insensitive?</span>
404:       <span class="ruby-ivar">@sortable</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:insensitive</span>
405:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000195">
                    
                    <a name="M000195"></a><b>integer_type_from_db</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000195_source')" id="l_M000195_source">show</a>
                        
                    </p>
                    <div id="M000195_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/thinking_sphinx/attribute.rb, line 354</span>
354:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">integer_type_from_db</span>
355:       <span class="ruby-identifier">column</span> = <span class="ruby-identifier">column_from_db</span>
356:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">column</span>.<span class="ruby-identifier">nil?</span>
357: 
358:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">column</span>.<span class="ruby-identifier">sql_type</span>
359:       <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">adapter</span>.<span class="ruby-identifier">bigint_pattern</span>
360:         <span class="ruby-identifier">:bigint</span>
361:       <span class="ruby-keyword kw">else</span>
362:         <span class="ruby-identifier">:integer</span>
363:       <span class="ruby-keyword kw">end</span>
364:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000191">
                    
                    <a name="M000191"></a><b>is_many_datetimes?</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000191_source')" id="l_M000191_source">show</a>
                        
                    </p>
                    <div id="M000191_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/thinking_sphinx/attribute.rb, line 318</span>
318:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">is_many_datetimes?</span>
319:       <span class="ruby-identifier">is_many?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">all_datetimes?</span>
320:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000190">
                    
                    <a name="M000190"></a><b>is_many_ints?</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000190_source')" id="l_M000190_source">show</a>
                        
                    </p>
                    <div id="M000190_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/thinking_sphinx/attribute.rb, line 314</span>
314:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">is_many_ints?</span>
315:       <span class="ruby-identifier">concat_ws?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">all_ints?</span>
316:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000192">
                    
                    <a name="M000192"></a><b>is_many_strings?</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000192_source')" id="l_M000192_source">show</a>
                        
                    </p>
                    <div id="M000192_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/thinking_sphinx/attribute.rb, line 322</span>
322:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">is_many_strings?</span>
323:       <span class="ruby-identifier">is_many?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">all_strings?</span>
324:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000182">
                    
                    <a name="M000182"></a><b>primary_key_for_mva</b>(assoc)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000182_source')" id="l_M000182_source">show</a>
                        
                    </p>
                    <div id="M000182_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/thinking_sphinx/attribute.rb, line 268</span>
268:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">primary_key_for_mva</span>(<span class="ruby-identifier">assoc</span>)
269:       <span class="ruby-identifier">quote_with_table</span>(
270:         <span class="ruby-identifier">assoc</span>.<span class="ruby-identifier">table</span>, <span class="ruby-identifier">assoc</span>.<span class="ruby-identifier">primary_key_from_reflection</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">columns</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">__name</span>
271:       )
272:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000178">
                    
                    <a name="M000178"></a><b>query</b>(offset)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000178_source')" id="l_M000178_source">show</a>
                        
                    </p>
                    <div id="M000178_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/thinking_sphinx/attribute.rb, line 228</span>
228:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">query</span>(<span class="ruby-identifier">offset</span>)
229:       <span class="ruby-identifier">base_assoc</span> = <span class="ruby-identifier">base_association_for_mva</span>
230:       <span class="ruby-identifier">end_assoc</span>  = <span class="ruby-identifier">end_association_for_mva</span>
231:       <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;Could not determine SQL for MVA&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">base_assoc</span>.<span class="ruby-identifier">nil?</span>
232: 
233:       <span class="ruby-identifier">relation</span> = <span class="ruby-operator">::</span><span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Relation</span>.<span class="ruby-identifier">new</span>(
234:         <span class="ruby-identifier">base_assoc</span>.<span class="ruby-identifier">reflection</span>.<span class="ruby-identifier">klass</span>, <span class="ruby-constant">Arel</span><span class="ruby-operator">::</span><span class="ruby-constant">Table</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">base_assoc</span>.<span class="ruby-identifier">table</span>)
235:       )
236: 
237:       <span class="ruby-identifier">association_joins</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">join</span><span class="ruby-operator">|</span>
238:         <span class="ruby-identifier">join</span>.<span class="ruby-identifier">join_type</span> = <span class="ruby-constant">Arel</span><span class="ruby-operator">::</span><span class="ruby-constant">OuterJoin</span>
239:         <span class="ruby-identifier">relation</span> = <span class="ruby-identifier">relation</span>.<span class="ruby-identifier">joins</span>(<span class="ruby-identifier">join</span>)
240:       <span class="ruby-keyword kw">end</span>
241: 
242:       <span class="ruby-identifier">relation</span> = <span class="ruby-identifier">relation</span>.<span class="ruby-identifier">select</span> <span class="ruby-node">&quot;#{foreign_key_for_mva base_assoc} #{ThinkingSphinx.unique_id_expression(adapter, offset)} AS #{quote_column('id')}, #{primary_key_for_mva(end_assoc)} AS #{quote_column(unique_name)}&quot;</span>
243: 
244:       <span class="ruby-identifier">relation</span>.<span class="ruby-identifier">to_sql</span>
245:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000179">
                    
                    <a name="M000179"></a><b>query_clause</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000179_source')" id="l_M000179_source">show</a>
                        
                    </p>
                    <div id="M000179_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/thinking_sphinx/attribute.rb, line 247</span>
247:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">query_clause</span>
248:       <span class="ruby-identifier">foreign_key</span> = <span class="ruby-identifier">foreign_key_for_mva</span> <span class="ruby-identifier">base_association_for_mva</span>
249:       <span class="ruby-node">&quot; WHERE #{foreign_key} &gt;= $start AND #{foreign_key} &lt;= $end&quot;</span>
250:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000180">
                    
                    <a name="M000180"></a><b>query_delta</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000180_source')" id="l_M000180_source">show</a>
                        
                    </p>
                    <div id="M000180_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/thinking_sphinx/attribute.rb, line 252</span>
252:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">query_delta</span>
253:       <span class="ruby-identifier">foreign_key</span> = <span class="ruby-identifier">foreign_key_for_mva</span> <span class="ruby-identifier">base_association_for_mva</span>
254:       <span class="ruby-value str">&quot;\#{foreign_key} IN (SELECT \#{quote_column model.primary_key}\nFROM \#{model.quoted_table_name}\nWHERE \#{@source.index.delta_object.clause(model, true)})\n&quot;</span>
255:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000181">
                    
                    <a name="M000181"></a><b>range_query</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000181_source')" id="l_M000181_source">show</a>
                        
                    </p>
                    <div id="M000181_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/thinking_sphinx/attribute.rb, line 262</span>
262:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">range_query</span>
263:       <span class="ruby-identifier">assoc</span>       = <span class="ruby-identifier">base_association_for_mva</span>
264:       <span class="ruby-identifier">foreign_key</span> = <span class="ruby-identifier">foreign_key_for_mva</span> <span class="ruby-identifier">assoc</span>
265:       <span class="ruby-node">&quot;SELECT MIN(#{foreign_key}), MAX(#{foreign_key}) FROM #{quote_table_name assoc.table}&quot;</span>
266:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000177">
                    
                    <a name="M000177"></a><b>source_value</b>(offset, delta)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000177_source')" id="l_M000177_source">show</a>
                        
                    </p>
                    <div id="M000177_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/thinking_sphinx/attribute.rb, line 211</span>
211:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">source_value</span>(<span class="ruby-identifier">offset</span>, <span class="ruby-identifier">delta</span>)
212:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">is_string?</span>
213:         <span class="ruby-keyword kw">return</span> <span class="ruby-node">&quot;#{query_source.to_s.dasherize}; #{columns.first.__name}&quot;</span>
214:       <span class="ruby-keyword kw">end</span>
215: 
216:       <span class="ruby-identifier">query</span> = <span class="ruby-identifier">query</span>(<span class="ruby-identifier">offset</span>)
217: 
218:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">query_source</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:ranged_query</span>
219:         <span class="ruby-identifier">query</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">query_clause</span>
220:         <span class="ruby-identifier">query</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot; AND #{query_delta.strip}&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">delta</span>
221:         <span class="ruby-node">&quot;ranged-query; #{query}; #{range_query}&quot;</span>
222:       <span class="ruby-keyword kw">else</span>
223:         <span class="ruby-identifier">query</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot; WHERE #{query_delta.strip}&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">delta</span>
224:         <span class="ruby-node">&quot;query; #{query}&quot;</span>
225:       <span class="ruby-keyword kw">end</span>
226:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000198">
                    
                    <a name="M000198"></a><b>sphinx_value</b>(value)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000198_source')" id="l_M000198_source">show</a>
                        
                    </p>
                    <div id="M000198_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/thinking_sphinx/attribute.rb, line 386</span>
386:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sphinx_value</span>(<span class="ruby-identifier">value</span>)
387:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">value</span>
388:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">TrueClass</span>
389:         <span class="ruby-value">1</span>
390:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">FalseClass</span>, <span class="ruby-constant">NilClass</span>
391:         <span class="ruby-value">0</span>
392:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Time</span>
393:         <span class="ruby-identifier">value</span>.<span class="ruby-identifier">to_i</span>
394:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Date</span>
395:         <span class="ruby-identifier">value</span>.<span class="ruby-identifier">to_time</span>.<span class="ruby-identifier">to_i</span>
396:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">String</span>
397:         <span class="ruby-identifier">value</span>.<span class="ruby-identifier">to_crc32</span>
398:       <span class="ruby-keyword kw">else</span>
399:         <span class="ruby-identifier">value</span>
400:       <span class="ruby-keyword kw">end</span>
401:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000193">
                    
                    <a name="M000193"></a><b>translated_type_from_database</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000193_source')" id="l_M000193_source">show</a>
                        
                    </p>
                    <div id="M000193_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/thinking_sphinx/attribute.rb, line 326</span>
326:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">translated_type_from_database</span>
327:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">type_from_db</span> = <span class="ruby-identifier">type_from_database</span>
328:       <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:integer</span>
329:         <span class="ruby-identifier">integer_type_from_db</span>
330:       <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:datetime</span>, <span class="ruby-identifier">:string</span>, <span class="ruby-identifier">:float</span>, <span class="ruby-identifier">:boolean</span>
331:         <span class="ruby-identifier">type_from_db</span>
332:       <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:decimal</span>
333:         <span class="ruby-identifier">:float</span>
334:       <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:timestamp</span>, <span class="ruby-identifier">:date</span>
335:         <span class="ruby-identifier">:datetime</span>
336:       <span class="ruby-keyword kw">else</span>
337:         <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;\nCannot automatically map attribute \#{unique_name} in \#{@model.name} to an\nequivalent Sphinx type (integer, float, boolean, datetime, string as ordinal).\nYou could try to explicitly convert the column's value in your define_index\nblock:\nhas \&quot;CAST(column AS INT)\&quot;, :type =&gt; :integer, :as =&gt; :column\n&quot;</span>
338:       <span class="ruby-keyword kw">end</span>
339:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000194">
                    
                    <a name="M000194"></a><b>type_from_database</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000194_source')" id="l_M000194_source">show</a>
                        
                    </p>
                    <div id="M000194_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/thinking_sphinx/attribute.rb, line 349</span>
349:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">type_from_database</span>
350:       <span class="ruby-identifier">column</span> = <span class="ruby-identifier">column_from_db</span>
351:       <span class="ruby-identifier">column</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-value">? </span><span class="ruby-keyword kw">nil</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">column</span>.<span class="ruby-identifier">type</span>
352:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    