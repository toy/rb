<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>Net::SSH::Authentication::KeyManager</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../../../css/main.css" type="text/css" media="screen" />
    <script src="../../../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Class</span> 
            Net::SSH::Authentication::KeyManager 
            
                <span class="parent">&lt; 
                    
                    Object
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../../../files/lib/net/ssh/authentication/key_manager_rb.html">lib/net/ssh/authentication/key_manager.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    
    <div class="description">
        <p>
This class encapsulates all operations done by clients on a user&#8217;s
private keys. In practice, the client should never need a reference to a
private key; instead, they grab a list of &#8220;identities&#8221; (public
keys) that are available from the <a href="KeyManager.html">KeyManager</a>,
and then use the <a href="KeyManager.html">KeyManager</a> to do various
private key operations using those identities.
</p>
<p>
The <a href="KeyManager.html">KeyManager</a> also uses the <a
href="Agent.html">Agent</a> class to encapsulate the ssh-agent. Thus, from
a client&#8217;s perspective it is completely hidden whether an identity
comes from the ssh-agent or from a file on disk.
</p>

    </div>
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>A</dt>
        <dd>
            <ul>
                
                <li><a href="#M000018">add</a>,</li>
                
                <li><a href="#M000019">add_key_data</a>,</li>
                
                <li><a href="#M000025">agent</a></li>
                
            </ul>
        </dd>
    
        <dt>C</dt>
        <dd>
            <ul>
                
                <li><a href="#M000017">clear!</a></li>
                
            </ul>
        </dd>
    
        <dt>E</dt>
        <dd>
            <ul>
                
                <li><a href="#M000021">each_identity</a></li>
                
            </ul>
        </dd>
    
        <dt>F</dt>
        <dd>
            <ul>
                
                <li><a href="#M000020">finish</a></li>
                
            </ul>
        </dd>
    
        <dt>L</dt>
        <dd>
            <ul>
                
                <li><a href="#M000031">load_identities</a></li>
                
            </ul>
        </dd>
    
        <dt>N</dt>
        <dd>
            <ul>
                
                <li><a href="#M000013">new</a></li>
                
            </ul>
        </dd>
    
        <dt>P</dt>
        <dd>
            <ul>
                
                <li><a href="#M000030">prepare_identities_from_data</a>,</li>
                
                <li><a href="#M000026">prepare_identities_from_files</a>,</li>
                
                <li><a href="#M000033">process_identity_loading_error</a></li>
                
            </ul>
        </dd>
    
        <dt>S</dt>
        <dd>
            <ul>
                
                <li><a href="#M000022">sign</a></li>
                
            </ul>
        </dd>
    
        <dt>U</dt>
        <dd>
            <ul>
                
                <li><a href="#M000024">use_agent=</a>,</li>
                
                <li><a href="#M000023">use_agent?</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    
    <div class="sectiontitle">Included Modules</div>
    <ul>
        
        <li>
            
            <a href="../PromptMethods/Termios.html">Net::SSH::PromptMethods::Termios</a>
            
            START:includes
        </li>
        
    </ul>
    

    

    

    

    
    <div class="sectiontitle">Attributes</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>key_files</td>
            <td class='attr-desc'><p>
The list of user key files that will be examined
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>key_data</td>
            <td class='attr-desc'><p>
The list of user key data that will be examined
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>known_identities</td>
            <td class='attr-desc'><p>
The map of loaded identities
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>options</td>
            <td class='attr-desc'><p>
The map of options that were passed to the key-manager
</p></td>
        </tr>
        
    </table>
    

    
            <div class="sectiontitle">Class Public methods</div>
            
            <div class="method">
                <div class="title" id="M000013">
                    
                    <a name="M000013"></a><b>new</b>(logger, options={})
                    
                </div>
                
                <div class="description">
                  <p>
Create a new <a href="KeyManager.html">KeyManager</a>. By default, the
manager will use the ssh-agent (if it is running).
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000013_source')" id="l_M000013_source">show</a>
                        
                    </p>
                    <div id="M000013_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/net/ssh/authentication/key_manager.rb, line 41</span>
41:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">logger</span>, <span class="ruby-identifier">options</span>={})
42:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">logger</span> = <span class="ruby-identifier">logger</span>
43:           <span class="ruby-ivar">@key_files</span> = []
44:           <span class="ruby-ivar">@key_data</span> = []
45:           <span class="ruby-ivar">@use_agent</span> = <span class="ruby-keyword kw">true</span>
46:           <span class="ruby-ivar">@known_identities</span> = {}
47:           <span class="ruby-ivar">@agent</span> = <span class="ruby-keyword kw">nil</span>
48:           <span class="ruby-ivar">@options</span> = <span class="ruby-identifier">options</span>
49:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M000018">
                    
                    <a name="M000018"></a><b>add</b>(key_file)
                    
                </div>
                
                <div class="description">
                  <p>
Add the given key_file to the list of key files that will be used.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000018_source')" id="l_M000018_source">show</a>
                        
                    </p>
                    <div id="M000018_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/net/ssh/authentication/key_manager.rb, line 63</span>
63:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add</span>(<span class="ruby-identifier">key_file</span>)
64:           <span class="ruby-identifier">key_files</span>.<span class="ruby-identifier">push</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">key_file</span>)).<span class="ruby-identifier">uniq!</span>
65:           <span class="ruby-keyword kw">self</span>
66:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000019">
                    
                    <a name="M000019"></a><b>add_key_data</b>(key_data_)
                    
                </div>
                
                <div class="description">
                  <p>
Add the given key_file to the list of keys that will be used.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000019_source')" id="l_M000019_source">show</a>
                        
                    </p>
                    <div id="M000019_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/net/ssh/authentication/key_manager.rb, line 69</span>
69:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_key_data</span>(<span class="ruby-identifier">key_data_</span>)
70:           <span class="ruby-identifier">key_data</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">key_data_</span>).<span class="ruby-identifier">uniq!</span>
71:           <span class="ruby-keyword kw">self</span>
72:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000025">
                    
                    <a name="M000025"></a><b>agent</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Returns an <a href="Agent.html">Agent</a> instance to use for communicating
with an <a href="../../SSH.html">SSH</a> agent process. Returns nil if use
of an <a href="../../SSH.html">SSH</a> agent has been disabled, or if the
agent is otherwise not available.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000025_source')" id="l_M000025_source">show</a>
                        
                    </p>
                    <div id="M000025_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/net/ssh/authentication/key_manager.rb, line 176</span>
176:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">agent</span>
177:           <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">use_agent?</span>
178:           <span class="ruby-ivar">@agent</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">Agent</span>.<span class="ruby-identifier">connect</span>(<span class="ruby-identifier">logger</span>)
179:         <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">AgentNotAvailable</span>
180:           <span class="ruby-ivar">@use_agent</span> = <span class="ruby-keyword kw">false</span>
181:           <span class="ruby-keyword kw">nil</span>
182:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000017">
                    
                    <a name="M000017"></a><b>clear!</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Clear all knowledge of any loaded user keys. This also clears the list of
default identity files that are to be loaded, thus making it appropriate to
use if a client wishes to NOT use the default identity files.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000017_source')" id="l_M000017_source">show</a>
                        
                    </p>
                    <div id="M000017_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/net/ssh/authentication/key_manager.rb, line 55</span>
55:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">clear!</span>
56:           <span class="ruby-identifier">key_files</span>.<span class="ruby-identifier">clear</span>
57:           <span class="ruby-identifier">key_data</span>.<span class="ruby-identifier">clear</span>
58:           <span class="ruby-identifier">known_identities</span>.<span class="ruby-identifier">clear</span>
59:           <span class="ruby-keyword kw">self</span>
60:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000021">
                    
                    <a name="M000021"></a><b>each_identity</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Iterates over all available identities (public keys) known to this manager.
As it finds one, it will then yield it to the caller. The origin of the
identities may be from files on disk or from an ssh-agent. Note that
identities from an ssh-agent are always listed first in the array, with
other identities coming after.
</p>
<p>
If key manager was created with :keys_only option, any identity from
ssh-agent will be ignored unless it present in <a
href="KeyManager.html#key_files">key_files</a> or key_data.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000021_source')" id="l_M000021_source">show</a>
                        
                    </p>
                    <div id="M000021_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/net/ssh/authentication/key_manager.rb, line 97</span>
 97:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">each_identity</span>
 98:           <span class="ruby-identifier">prepared_identities</span> = <span class="ruby-identifier">prepare_identities_from_files</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">prepare_identities_from_data</span>
 99: 
100:           <span class="ruby-identifier">user_identities</span> = <span class="ruby-identifier">load_identities</span>(<span class="ruby-identifier">prepared_identities</span>, <span class="ruby-keyword kw">false</span>)
101: 
102:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">agent</span>
103:             <span class="ruby-identifier">agent</span>.<span class="ruby-identifier">identities</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span><span class="ruby-operator">|</span>
104:               <span class="ruby-identifier">corresponding_user_identity</span> = <span class="ruby-identifier">user_identities</span>.<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">identity</span><span class="ruby-operator">|</span>
105:                 <span class="ruby-identifier">identity</span>[<span class="ruby-identifier">:public_key</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">identity</span>[<span class="ruby-identifier">:public_key</span>].<span class="ruby-identifier">to_pem</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">key</span>.<span class="ruby-identifier">to_pem</span>
106:               }
107:               <span class="ruby-identifier">user_identities</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">corresponding_user_identity</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">corresponding_user_identity</span>
108: 
109:               <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">options</span>[<span class="ruby-identifier">:keys_only</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">corresponding_user_identity</span>
110:                 <span class="ruby-identifier">known_identities</span>[<span class="ruby-identifier">key</span>] = { <span class="ruby-identifier">:from</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:agent</span> }
111:                 <span class="ruby-keyword kw">yield</span> <span class="ruby-identifier">key</span>
112:               <span class="ruby-keyword kw">end</span>
113:             <span class="ruby-keyword kw">end</span>
114:           <span class="ruby-keyword kw">end</span>
115: 
116:           <span class="ruby-identifier">user_identities</span> = <span class="ruby-identifier">load_identities</span>(<span class="ruby-identifier">user_identities</span>, <span class="ruby-keyword kw">true</span>)
117: 
118:           <span class="ruby-identifier">user_identities</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">identity</span><span class="ruby-operator">|</span>
119:             <span class="ruby-identifier">key</span> = <span class="ruby-identifier">identity</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:public_key</span>)
120:             <span class="ruby-identifier">known_identities</span>[<span class="ruby-identifier">key</span>] = <span class="ruby-identifier">identity</span>
121:             <span class="ruby-keyword kw">yield</span> <span class="ruby-identifier">key</span>
122:           <span class="ruby-keyword kw">end</span>
123: 
124:           <span class="ruby-keyword kw">self</span>
125:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000020">
                    
                    <a name="M000020"></a><b>finish</b>()
                    
                </div>
                
                <div class="description">
                  <p>
This is used as a hint to the <a href="KeyManager.html">KeyManager</a>
indicating that the agent connection is no longer needed. Any other open
resources may be closed at this time.
</p>
<p>
Calling this does NOT indicate that the <a
href="KeyManager.html">KeyManager</a> will no longer be used. Identities
may still be requested and operations done on loaded identities, in which
case, the agent will be automatically reconnected. This method simply
allows the client connection to be closed when it will not be used in the
immediate future.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000020_source')" id="l_M000020_source">show</a>
                        
                    </p>
                    <div id="M000020_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/net/ssh/authentication/key_manager.rb, line 83</span>
83:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">finish</span>
84:           <span class="ruby-ivar">@agent</span>.<span class="ruby-identifier">close</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@agent</span>
85:           <span class="ruby-ivar">@agent</span> = <span class="ruby-keyword kw">nil</span>
86:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000022">
                    
                    <a name="M000022"></a><b>sign</b>(identity, data)
                    
                </div>
                
                <div class="description">
                  <p>
Sign the given data, using the corresponding private key of the given
identity. If the identity was originally obtained from an ssh-agent, then
the ssh-agent will be used to sign the data, otherwise the private key for
the identity will be loaded from disk (if it hasn&#8217;t been loaded
already) and will then be used to sign the data.
</p>
<p>
Regardless of the identity&#8217;s origin or who does the signing, this
will always return the signature in an SSH2-specified &#8220;signature
blob&#8221; format.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000022_source')" id="l_M000022_source">show</a>
                        
                    </p>
                    <div id="M000022_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/net/ssh/authentication/key_manager.rb, line 136</span>
136:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sign</span>(<span class="ruby-identifier">identity</span>, <span class="ruby-identifier">data</span>)
137:           <span class="ruby-identifier">info</span> = <span class="ruby-identifier">known_identities</span>[<span class="ruby-identifier">identity</span>] <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">raise</span> <span class="ruby-constant">KeyManagerError</span>, <span class="ruby-value str">&quot;the given identity is unknown to the key manager&quot;</span>
138: 
139:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">info</span>[<span class="ruby-identifier">:key</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">info</span>[<span class="ruby-identifier">:from</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">:file</span>
140:             <span class="ruby-keyword kw">begin</span>
141:               <span class="ruby-identifier">info</span>[<span class="ruby-identifier">:key</span>] = <span class="ruby-constant">KeyFactory</span>.<span class="ruby-identifier">load_private_key</span>(<span class="ruby-identifier">info</span>[<span class="ruby-identifier">:file</span>], <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:passphrase</span>], <span class="ruby-keyword kw">true</span>)
142:             <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Exception</span>, <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">OpenSSLError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span> 
143:               <span class="ruby-identifier">raise</span> <span class="ruby-constant">KeyManagerError</span>, <span class="ruby-node">&quot;the given identity is known, but the private key could not be loaded: #{e.class} (#{e.message})&quot;</span>
144:             <span class="ruby-keyword kw">end</span>
145:           <span class="ruby-keyword kw">end</span>
146: 
147:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">info</span>[<span class="ruby-identifier">:key</span>]
148:             <span class="ruby-keyword kw">return</span> <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">SSH</span><span class="ruby-operator">::</span><span class="ruby-constant">Buffer</span>.<span class="ruby-identifier">from</span>(<span class="ruby-identifier">:string</span>, <span class="ruby-identifier">identity</span>.<span class="ruby-identifier">ssh_type</span>,
149:               <span class="ruby-identifier">:string</span>, <span class="ruby-identifier">info</span>[<span class="ruby-identifier">:key</span>].<span class="ruby-identifier">ssh_do_sign</span>(<span class="ruby-identifier">data</span>.<span class="ruby-identifier">to_s</span>)).<span class="ruby-identifier">to_s</span>
150:           <span class="ruby-keyword kw">end</span>
151: 
152:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">info</span>[<span class="ruby-identifier">:from</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">:agent</span>
153:             <span class="ruby-identifier">raise</span> <span class="ruby-constant">KeyManagerError</span>, <span class="ruby-value str">&quot;the agent is no longer available&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">agent</span>
154:             <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">agent</span>.<span class="ruby-identifier">sign</span>(<span class="ruby-identifier">identity</span>, <span class="ruby-identifier">data</span>.<span class="ruby-identifier">to_s</span>)
155:           <span class="ruby-keyword kw">end</span>
156: 
157:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">KeyManagerError</span>, <span class="ruby-node">&quot;[BUG] can't determine identity origin (#{info.inspect})&quot;</span>
158:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000024">
                    
                    <a name="M000024"></a><b>use_agent=</b>(use_agent)
                    
                </div>
                
                <div class="description">
                  <p>
Toggles whether the ssh-agent will be used or not. If true, an attempt will
be made to use the ssh-agent. If false, any existing connection to an agent
is closed and the agent will not be used.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000024_source')" id="l_M000024_source">show</a>
                        
                    </p>
                    <div id="M000024_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/net/ssh/authentication/key_manager.rb, line 168</span>
168:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">use_agent=</span>(<span class="ruby-identifier">use_agent</span>)
169:           <span class="ruby-identifier">finish</span> <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">use_agent</span>
170:           <span class="ruby-ivar">@use_agent</span> = <span class="ruby-identifier">use_agent</span>
171:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000023">
                    
                    <a name="M000023"></a><b>use_agent?</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Identifies whether the ssh-agent will be used or not.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000023_source')" id="l_M000023_source">show</a>
                        
                    </p>
                    <div id="M000023_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/net/ssh/authentication/key_manager.rb, line 161</span>
161:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">use_agent?</span>
162:           <span class="ruby-ivar">@use_agent</span>
163:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Private methods</div>
            
            <div class="method">
                <div class="title" id="M000031">
                    
                    <a name="M000031"></a><b>load_identities</b>(identities, ask_passphrase)
                    
                </div>
                
                <div class="description">
                  <p>
Load prepared identities. Private key decryption errors ignored if
passphrase was not prompted.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000031_source')" id="l_M000031_source">show</a>
                        
                    </p>
                    <div id="M000031_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/net/ssh/authentication/key_manager.rb, line 206</span>
206:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">load_identities</span>(<span class="ruby-identifier">identities</span>, <span class="ruby-identifier">ask_passphrase</span>)
207:           <span class="ruby-identifier">identities</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">identity</span><span class="ruby-operator">|</span>
208:             <span class="ruby-keyword kw">begin</span>
209:               <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">identity</span>[<span class="ruby-identifier">:load_from</span>]
210:               <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:pubkey_file</span>
211:                 <span class="ruby-identifier">key</span> = <span class="ruby-constant">KeyFactory</span>.<span class="ruby-identifier">load_public_key</span>(<span class="ruby-identifier">identity</span>[<span class="ruby-identifier">:file</span>] <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;.pub&quot;</span>)
212:                 { <span class="ruby-identifier">:public_key</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">key</span>, <span class="ruby-identifier">:from</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:file</span>, <span class="ruby-identifier">:file</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">identity</span>[<span class="ruby-identifier">:file</span>] }
213:               <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:privkey_file</span>
214:                 <span class="ruby-identifier">private_key</span> = <span class="ruby-constant">KeyFactory</span>.<span class="ruby-identifier">load_private_key</span>(<span class="ruby-identifier">identity</span>[<span class="ruby-identifier">:file</span>], <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:passphrase</span>], <span class="ruby-identifier">ask_passphrase</span>)
215:                 <span class="ruby-identifier">key</span> = <span class="ruby-identifier">private_key</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">:public_key</span>)
216:                 { <span class="ruby-identifier">:public_key</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">key</span>, <span class="ruby-identifier">:from</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:file</span>, <span class="ruby-identifier">:file</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">identity</span>[<span class="ruby-identifier">:file</span>], <span class="ruby-identifier">:key</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">private_key</span> }
217:               <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:data</span>
218:                 <span class="ruby-identifier">private_key</span> = <span class="ruby-constant">KeyFactory</span>.<span class="ruby-identifier">load_data_private_key</span>(<span class="ruby-identifier">identity</span>[<span class="ruby-identifier">:data</span>], <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:passphrase</span>], <span class="ruby-identifier">ask_passphrase</span>)
219:                 <span class="ruby-identifier">key</span> = <span class="ruby-identifier">private_key</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">:public_key</span>)
220:                 { <span class="ruby-identifier">:public_key</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">key</span>, <span class="ruby-identifier">:from</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:key_data</span>, <span class="ruby-identifier">:data</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">identity</span>[<span class="ruby-identifier">:data</span>], <span class="ruby-identifier">:key</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">private_key</span> }
221:               <span class="ruby-keyword kw">else</span>
222:                 <span class="ruby-identifier">identity</span>
223:               <span class="ruby-keyword kw">end</span>
224: 
225:             <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">PKey</span><span class="ruby-operator">::</span><span class="ruby-constant">RSAError</span>, <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">PKey</span><span class="ruby-operator">::</span><span class="ruby-constant">DSAError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
226:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ask_passphrase</span>
227:                 <span class="ruby-identifier">process_identity_loading_error</span>(<span class="ruby-identifier">identity</span>, <span class="ruby-identifier">e</span>)
228:                 <span class="ruby-keyword kw">nil</span>
229:               <span class="ruby-keyword kw">else</span>
230:                 <span class="ruby-identifier">identity</span>
231:               <span class="ruby-keyword kw">end</span>
232:             <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
233:               <span class="ruby-identifier">process_identity_loading_error</span>(<span class="ruby-identifier">identity</span>, <span class="ruby-identifier">e</span>)
234:               <span class="ruby-keyword kw">nil</span>
235:             <span class="ruby-keyword kw">end</span>
236:           <span class="ruby-keyword kw">end</span>.<span class="ruby-identifier">compact</span>
237:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000030">
                    
                    <a name="M000030"></a><b>prepare_identities_from_data</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Prepared identities from user <a
href="KeyManager.html#key_data">key_data</a>, preserving their order and
sources.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000030_source')" id="l_M000030_source">show</a>
                        
                    </p>
                    <div id="M000030_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/net/ssh/authentication/key_manager.rb, line 199</span>
199:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">prepare_identities_from_data</span>
200:           <span class="ruby-identifier">key_data</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">data</span><span class="ruby-operator">|</span>
201:             { <span class="ruby-identifier">:load_from</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:data</span>, <span class="ruby-identifier">:data</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">data</span> }
202:           <span class="ruby-keyword kw">end</span>
203:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000026">
                    
                    <a name="M000026"></a><b>prepare_identities_from_files</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Prepares identities from user <a
href="KeyManager.html#key_files">key_files</a> for loading, preserving
their order and sources.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000026_source')" id="l_M000026_source">show</a>
                        
                    </p>
                    <div id="M000026_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/net/ssh/authentication/key_manager.rb, line 187</span>
187:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">prepare_identities_from_files</span>
188:           <span class="ruby-identifier">key_files</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span>
189:             <span class="ruby-identifier">public_key_file</span> = <span class="ruby-identifier">file</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;.pub&quot;</span>
190:             <span class="ruby-keyword kw">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">readable?</span>(<span class="ruby-identifier">public_key_file</span>)
191:               { <span class="ruby-identifier">:load_from</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:pubkey_file</span>, <span class="ruby-identifier">:file</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">file</span> }
192:             <span class="ruby-keyword kw">elsif</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">readable?</span>(<span class="ruby-identifier">file</span>)
193:               { <span class="ruby-identifier">:load_from</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:privkey_file</span>, <span class="ruby-identifier">:file</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">file</span> }
194:             <span class="ruby-keyword kw">end</span>
195:           <span class="ruby-keyword kw">end</span>.<span class="ruby-identifier">compact</span>
196:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000033">
                    
                    <a name="M000033"></a><b>process_identity_loading_error</b>(identity, e)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000033_source')" id="l_M000033_source">show</a>
                        
                    </p>
                    <div id="M000033_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/net/ssh/authentication/key_manager.rb, line 239</span>
239:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">process_identity_loading_error</span>(<span class="ruby-identifier">identity</span>, <span class="ruby-identifier">e</span>)
240:           <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">identity</span>[<span class="ruby-identifier">:load_from</span>]
241:           <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:pubkey_file</span>
242:             <span class="ruby-identifier">error</span> { <span class="ruby-node">&quot;could not load public key file `#{identity[:file]}': #{e.class} (#{e.message})&quot;</span> }
243:           <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:privkey_file</span>
244:             <span class="ruby-identifier">error</span> { <span class="ruby-node">&quot;could not load private key file `#{identity[:file]}': #{e.class} (#{e.message})&quot;</span> }
245:           <span class="ruby-keyword kw">else</span>
246:             <span class="ruby-identifier">raise</span> <span class="ruby-identifier">e</span>
247:           <span class="ruby-keyword kw">end</span>
248:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    