<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>Net::SSH::Transport::Algorithms</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../../../css/main.css" type="text/css" media="screen" />
    <script src="../../../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Class</span> 
            Net::SSH::Transport::Algorithms 
            
                <span class="parent">&lt; 
                    
                    Object
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../../../files/lib/net/ssh/transport/algorithms_rb.html">lib/net/ssh/transport/algorithms.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    
    <div class="description">
        <p>
Implements the higher-level logic behind an <a
href="../../SSH.html">SSH</a> key-exchange. It handles both the initial
exchange, as well as subsequent re-exchanges (as needed). It also
encapsulates the negotiation of the algorithms, and provides a single point
of access to the negotiated algorithms.
</p>
<p>
You will never instantiate or reference this directly. It is used
internally by the transport layer.
</p>

    </div>
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>#</dt>
        <dd>
            <ul>
                
                <li><a href="#M000310">[]</a></li>
                
            </ul>
        </dd>
    
        <dt>A</dt>
        <dd>
            <ul>
                
                <li><a href="#M000309">accept_kexinit</a>,</li>
                
                <li><a href="#M000312">allow?</a>,</li>
                
                <li><a href="#M000306">allowed_packet?</a></li>
                
            </ul>
        </dd>
    
        <dt>B</dt>
        <dd>
            <ul>
                
                <li><a href="#M000321">build_client_algorithm_packet</a></li>
                
            </ul>
        </dd>
    
        <dt>E</dt>
        <dd>
            <ul>
                
                <li><a href="#M000325">exchange_keys</a></li>
                
            </ul>
        </dd>
    
        <dt>I</dt>
        <dd>
            <ul>
                
                <li><a href="#M000313">initialized?</a></li>
                
            </ul>
        </dd>
    
        <dt>K</dt>
        <dd>
            <ul>
                
                <li><a href="#M000324">kex_byte_requirement</a></li>
                
            </ul>
        </dd>
    
        <dt>N</dt>
        <dd>
            <ul>
                
                <li><a href="#M000323">negotiate</a>,</li>
                
                <li><a href="#M000322">negotiate_algorithms</a>,</li>
                
                <li><a href="#M000307">new</a>,</li>
                
                <li><a href="#M000327">normalize_compression_name</a></li>
                
            </ul>
        </dd>
    
        <dt>P</dt>
        <dd>
            <ul>
                
                <li><a href="#M000320">parse_server_algorithm_packet</a>,</li>
                
                <li><a href="#M000311">pending?</a>,</li>
                
                <li><a href="#M000317">prepare_preferred_algorithms!</a>,</li>
                
                <li><a href="#M000315">proceed!</a></li>
                
            </ul>
        </dd>
    
        <dt>R</dt>
        <dd>
            <ul>
                
                <li><a href="#M000308">rekey!</a></li>
                
            </ul>
        </dd>
    
        <dt>S</dt>
        <dd>
            <ul>
                
                <li><a href="#M000314">send_kexinit</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    
    <div class="sectiontitle">Included Modules</div>
    <ul>
        
        <li>
            
            <a href="../Authentication/Pageant.html">Net::SSH::Authentication::Pageant</a>
            
            START:includes
        </li>
        
        <li>
            
            <a href="../PromptMethods/Termios.html">Net::SSH::PromptMethods::Termios</a>
            
            START:includes
        </li>
        
    </ul>
    

    

    

    
    <div class="sectiontitle">Constants</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class="attr-name">ALGORITHMS</td>
            <td>=</td>
            <td class="attr-value">{       :host_key    =&gt; %w(ssh-rsa ssh-dss),       :kex         =&gt; %w(diffie-hellman-group-exchange-sha1                          diffie-hellman-group1-sha1                          diffie-hellman-group-exchange-sha256),       :encryption  =&gt; %w(aes128-cbc 3des-cbc blowfish-cbc cast128-cbc                          aes192-cbc aes256-cbc rijndael-cbc@lysator.liu.se                          idea-cbc none arcfour128 arcfour256),       :hmac        =&gt; %w(hmac-sha1 hmac-md5 hmac-sha1-96 hmac-md5-96                          hmac-sha2-256 hmac-sha2-512 hmac-sha2-256-96                          hmac-sha2-512-96 none),       :compression =&gt; %w(none zlib@openssh.com zlib),       :language    =&gt; %w()      }</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
Define the default algorithms, in order of preference, supported by <a
href="../../SSH.html">Net::SSH</a>.
</p>
</td>
        </tr>
        
        
    </table>
    

    
    <div class="sectiontitle">Attributes</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>session</td>
            <td class='attr-desc'><p>
The underlying transport layer session that supports this object
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>options</td>
            <td class='attr-desc'><p>
The hash of options used to initialize this object
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>kex</td>
            <td class='attr-desc'><p>
The kex algorithm to use settled on between the client and server.
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>host_key</td>
            <td class='attr-desc'><p>
The type of host key that will be used for this session.
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>encryption_client</td>
            <td class='attr-desc'><p>
The type of the cipher to use to encrypt packets sent from the client to
the server.
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>encryption_server</td>
            <td class='attr-desc'><p>
The type of the cipher to use to decrypt packets arriving from the server.
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>hmac_client</td>
            <td class='attr-desc'><p>
The type of <a href="HMAC.html">HMAC</a> to use to sign packets sent by the
client.
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>hmac_server</td>
            <td class='attr-desc'><p>
The type of <a href="HMAC.html">HMAC</a> to use to validate packets
arriving from the server.
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>compression_client</td>
            <td class='attr-desc'><p>
The type of compression to use to compress packets being sent by the
client.
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>compression_server</td>
            <td class='attr-desc'><p>
The type of compression to use to decompress packets arriving from the
server.
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>language_client</td>
            <td class='attr-desc'><p>
The language that will be used in messages sent by the client.
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>language_server</td>
            <td class='attr-desc'><p>
The language that will be used in messages sent from the server.
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>algorithms</td>
            <td class='attr-desc'><p>
The hash of algorithms preferred by the client, which will be told to the
server during algorithm negotiation.
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>session_id</td>
            <td class='attr-desc'><p>
The session-id for this session, as decided during the initial key
exchange.
</p></td>
        </tr>
        
    </table>
    

    
            <div class="sectiontitle">Class Public methods</div>
            
            <div class="method">
                <div class="title" id="M000306">
                    
                    <a name="M000306"></a><b>allowed_packet?</b>(packet)
                    
                </div>
                
                <div class="description">
                  <p>
Returns true if the given packet can be processed during a key-exchange.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000306_source')" id="l_M000306_source">show</a>
                        
                    </p>
                    <div id="M000306_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/net/ssh/transport/algorithms.rb, line 84</span>
84:     <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">allowed_packet?</span>(<span class="ruby-identifier">packet</span>)
85:       ( <span class="ruby-value">1</span><span class="ruby-operator">..</span> <span class="ruby-value">4</span>).<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">packet</span>.<span class="ruby-identifier">type</span>) <span class="ruby-operator">||</span>
86:       ( <span class="ruby-value">6</span><span class="ruby-operator">..</span><span class="ruby-value">19</span>).<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">packet</span>.<span class="ruby-identifier">type</span>) <span class="ruby-operator">||</span>
87:       (<span class="ruby-value">21</span><span class="ruby-operator">..</span><span class="ruby-value">49</span>).<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">packet</span>.<span class="ruby-identifier">type</span>)
88:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000307">
                    
                    <a name="M000307"></a><b>new</b>(session, options={})
                    
                </div>
                
                <div class="description">
                  <p>
Instantiates a new <a href="Algorithms.html">Algorithms</a> object, and
prepares the hash of preferred algorithms based on the options parameter
and the <a href="Algorithms.html#ALGORITHMS">ALGORITHMS</a> constant.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000307_source')" id="l_M000307_source">show</a>
                        
                    </p>
                    <div id="M000307_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/net/ssh/transport/algorithms.rb, line 92</span>
 92:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">session</span>, <span class="ruby-identifier">options</span>={})
 93:       <span class="ruby-ivar">@session</span> = <span class="ruby-identifier">session</span>
 94:       <span class="ruby-ivar">@logger</span> = <span class="ruby-identifier">session</span>.<span class="ruby-identifier">logger</span>
 95:       <span class="ruby-ivar">@options</span> = <span class="ruby-identifier">options</span>
 96:       <span class="ruby-ivar">@algorithms</span> = {}
 97:       <span class="ruby-ivar">@pending</span> = <span class="ruby-ivar">@initialized</span> = <span class="ruby-keyword kw">false</span>
 98:       <span class="ruby-ivar">@client_packet</span> = <span class="ruby-ivar">@server_packet</span> = <span class="ruby-keyword kw">nil</span>
 99:       <span class="ruby-identifier">prepare_preferred_algorithms!</span>
100:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M000310">
                    
                    <a name="M000310"></a><b>[]</b>(key)
                    
                </div>
                
                <div class="description">
                  <p>
A convenience method for accessing the list of preferred types for a
specific algorithm (see <a
href="Algorithms.html#algorithms">algorithms</a>).
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000310_source')" id="l_M000310_source">show</a>
                        
                    </p>
                    <div id="M000310_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/net/ssh/transport/algorithms.rb, line 129</span>
129:     <span class="ruby-keyword kw">def</span> <span class="ruby-operator">[]</span>(<span class="ruby-identifier">key</span>)
130:       <span class="ruby-identifier">algorithms</span>[<span class="ruby-identifier">key</span>]
131:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000309">
                    
                    <a name="M000309"></a><b>accept_kexinit</b>(packet)
                    
                </div>
                
                <div class="description">
                  <p>
Called by the transport layer when a KEXINIT packet is recieved, indicating
that the server wants to exchange keys. This can be spontaneous, or it can
be in response to a client-initiated rekey request (see <a
href="Algorithms.html#M000308">rekey!</a>). Either way, this will block
until the key exchange completes.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000309_source')" id="l_M000309_source">show</a>
                        
                    </p>
                    <div id="M000309_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/net/ssh/transport/algorithms.rb, line 116</span>
116:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">accept_kexinit</span>(<span class="ruby-identifier">packet</span>)
117:       <span class="ruby-identifier">info</span> { <span class="ruby-value str">&quot;got KEXINIT from server&quot;</span> }
118:       <span class="ruby-ivar">@server_data</span> = <span class="ruby-identifier">parse_server_algorithm_packet</span>(<span class="ruby-identifier">packet</span>)
119:       <span class="ruby-ivar">@server_packet</span> = <span class="ruby-ivar">@server_data</span>[<span class="ruby-identifier">:raw</span>]
120:       <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">pending?</span>
121:         <span class="ruby-identifier">send_kexinit</span>
122:       <span class="ruby-keyword kw">else</span>
123:         <span class="ruby-identifier">proceed!</span>
124:       <span class="ruby-keyword kw">end</span>
125:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000312">
                    
                    <a name="M000312"></a><b>allow?</b>(packet)
                    
                </div>
                
                <div class="description">
                  <p>
Returns true if no exchange is pending, and otherwise returns true or false
depending on whether the given packet is of a type that is allowed during a
key exchange.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000312_source')" id="l_M000312_source">show</a>
                        
                    </p>
                    <div id="M000312_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/net/ssh/transport/algorithms.rb, line 145</span>
145:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">allow?</span>(<span class="ruby-identifier">packet</span>)
146:       <span class="ruby-operator">!</span><span class="ruby-identifier">pending?</span> <span class="ruby-operator">||</span> <span class="ruby-constant">Algorithms</span>.<span class="ruby-identifier">allowed_packet?</span>(<span class="ruby-identifier">packet</span>)
147:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000313">
                    
                    <a name="M000313"></a><b>initialized?</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Returns true if the algorithms have been negotiated at all.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000313_source')" id="l_M000313_source">show</a>
                        
                    </p>
                    <div id="M000313_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/net/ssh/transport/algorithms.rb, line 150</span>
150:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialized?</span>
151:       <span class="ruby-ivar">@initialized</span>
152:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000311">
                    
                    <a name="M000311"></a><b>pending?</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Returns <tt>true</tt> if a key-exchange is pending. This will be true from
the moment either the client or server requests the key exchange, until the
exchange completes. While an exchange is pending, only a limited number of
packets are allowed, so event processing essentially stops during this
period.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000311_source')" id="l_M000311_source">show</a>
                        
                    </p>
                    <div id="M000311_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/net/ssh/transport/algorithms.rb, line 138</span>
138:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">pending?</span>
139:       <span class="ruby-ivar">@pending</span>
140:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000308">
                    
                    <a name="M000308"></a><b>rekey!</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Request a rekey operation. This will return immediately, and does not
actually perform the rekey operation. It does cause the session to change
state, however&#8212;until the key exchange finishes, no new packets will
be processed.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000308_source')" id="l_M000308_source">show</a>
                        
                    </p>
                    <div id="M000308_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/net/ssh/transport/algorithms.rb, line 106</span>
106:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">rekey!</span>
107:       <span class="ruby-ivar">@client_packet</span> = <span class="ruby-ivar">@server_packet</span> = <span class="ruby-keyword kw">nil</span>
108:       <span class="ruby-ivar">@initialized</span> = <span class="ruby-keyword kw">false</span>
109:       <span class="ruby-identifier">send_kexinit</span>
110:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Private methods</div>
            
            <div class="method">
                <div class="title" id="M000321">
                    
                    <a name="M000321"></a><b>build_client_algorithm_packet</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Given the <a href="Algorithms.html#algorithms">algorithms</a> map of
preferred algorithm types, this constructs a KEXINIT packet to send to the
server. It does not actually send it, it simply builds the packet and
returns it.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000321_source')" id="l_M000321_source">show</a>
                        
                    </p>
                    <div id="M000321_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/net/ssh/transport/algorithms.rb, line 253</span>
253:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">build_client_algorithm_packet</span>
254:         <span class="ruby-identifier">kex</span>         = <span class="ruby-identifier">algorithms</span>[<span class="ruby-identifier">:kex</span>        ].<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;,&quot;</span>)
255:         <span class="ruby-identifier">host_key</span>    = <span class="ruby-identifier">algorithms</span>[<span class="ruby-identifier">:host_key</span>   ].<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;,&quot;</span>)
256:         <span class="ruby-identifier">encryption</span>  = <span class="ruby-identifier">algorithms</span>[<span class="ruby-identifier">:encryption</span> ].<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;,&quot;</span>)
257:         <span class="ruby-identifier">hmac</span>        = <span class="ruby-identifier">algorithms</span>[<span class="ruby-identifier">:hmac</span>       ].<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;,&quot;</span>)
258:         <span class="ruby-identifier">compression</span> = <span class="ruby-identifier">algorithms</span>[<span class="ruby-identifier">:compression</span>].<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;,&quot;</span>)
259:         <span class="ruby-identifier">language</span>    = <span class="ruby-identifier">algorithms</span>[<span class="ruby-identifier">:language</span>   ].<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;,&quot;</span>)
260: 
261:         <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">SSH</span><span class="ruby-operator">::</span><span class="ruby-constant">Buffer</span>.<span class="ruby-identifier">from</span>(<span class="ruby-identifier">:byte</span>, <span class="ruby-constant">KEXINIT</span>,
262:           <span class="ruby-identifier">:long</span>, [<span class="ruby-identifier">rand</span>(<span class="ruby-value">0x</span><span class="ruby-constant">FFFFFFFF</span>), <span class="ruby-identifier">rand</span>(<span class="ruby-value">0x</span><span class="ruby-constant">FFFFFFFF</span>), <span class="ruby-identifier">rand</span>(<span class="ruby-value">0x</span><span class="ruby-constant">FFFFFFFF</span>), <span class="ruby-identifier">rand</span>(<span class="ruby-value">0x</span><span class="ruby-constant">FFFFFFFF</span>)],
263:           <span class="ruby-identifier">:string</span>, [<span class="ruby-identifier">kex</span>, <span class="ruby-identifier">host_key</span>, <span class="ruby-identifier">encryption</span>, <span class="ruby-identifier">encryption</span>, <span class="ruby-identifier">hmac</span>, <span class="ruby-identifier">hmac</span>],
264:           <span class="ruby-identifier">:string</span>, [<span class="ruby-identifier">compression</span>, <span class="ruby-identifier">compression</span>, <span class="ruby-identifier">language</span>, <span class="ruby-identifier">language</span>],
265:           <span class="ruby-identifier">:bool</span>, <span class="ruby-keyword kw">false</span>, <span class="ruby-identifier">:long</span>, <span class="ruby-value">0</span>)
266:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000325">
                    
                    <a name="M000325"></a><b>exchange_keys</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Instantiates one of the <a href="Kex.html">Transport::Kex</a> classes
(based on the negotiated kex algorithm), and uses it to exchange keys.
Then, the ciphers and HMACs are initialized and fed to the transport layer,
to be used in further communication with the server.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000325_source')" id="l_M000325_source">show</a>
                        
                    </p>
                    <div id="M000325_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/net/ssh/transport/algorithms.rb, line 324</span>
324:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">exchange_keys</span>
325:         <span class="ruby-identifier">debug</span> { <span class="ruby-value str">&quot;exchanging keys&quot;</span> }
326: 
327:         <span class="ruby-identifier">algorithm</span> = <span class="ruby-constant">Kex</span><span class="ruby-operator">::</span><span class="ruby-constant">MAP</span>[<span class="ruby-identifier">kex</span>].<span class="ruby-identifier">new</span>(<span class="ruby-keyword kw">self</span>, <span class="ruby-identifier">session</span>,
328:           <span class="ruby-identifier">:client_version_string</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">SSH</span><span class="ruby-operator">::</span><span class="ruby-constant">Transport</span><span class="ruby-operator">::</span><span class="ruby-constant">ServerVersion</span><span class="ruby-operator">::</span><span class="ruby-constant">PROTO_VERSION</span>,
329:           <span class="ruby-identifier">:server_version_string</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">session</span>.<span class="ruby-identifier">server_version</span>.<span class="ruby-identifier">version</span>,
330:           <span class="ruby-identifier">:server_algorithm_packet</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@server_packet</span>,
331:           <span class="ruby-identifier">:client_algorithm_packet</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@client_packet</span>,
332:           <span class="ruby-identifier">:need_bytes</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">kex_byte_requirement</span>,
333:           <span class="ruby-identifier">:logger</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">logger</span>)
334:         <span class="ruby-identifier">result</span> = <span class="ruby-identifier">algorithm</span>.<span class="ruby-identifier">exchange_keys</span>
335: 
336:         <span class="ruby-identifier">secret</span>   = <span class="ruby-identifier">result</span>[<span class="ruby-identifier">:shared_secret</span>].<span class="ruby-identifier">to_ssh</span>
337:         <span class="ruby-identifier">hash</span>     = <span class="ruby-identifier">result</span>[<span class="ruby-identifier">:session_id</span>]
338:         <span class="ruby-identifier">digester</span> = <span class="ruby-identifier">result</span>[<span class="ruby-identifier">:hashing_algorithm</span>]
339: 
340:         <span class="ruby-ivar">@session_id</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">hash</span>
341: 
342:         <span class="ruby-identifier">key</span> = <span class="ruby-constant">Proc</span>.<span class="ruby-identifier">new</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">salt</span><span class="ruby-operator">|</span> <span class="ruby-identifier">digester</span>.<span class="ruby-identifier">digest</span>(<span class="ruby-identifier">secret</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">hash</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">salt</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@session_id</span>) }
343:         
344:         <span class="ruby-identifier">iv_client</span> = <span class="ruby-identifier">key</span>[<span class="ruby-value str">&quot;A&quot;</span>]
345:         <span class="ruby-identifier">iv_server</span> = <span class="ruby-identifier">key</span>[<span class="ruby-value str">&quot;B&quot;</span>]
346:         <span class="ruby-identifier">key_client</span> = <span class="ruby-identifier">key</span>[<span class="ruby-value str">&quot;C&quot;</span>]
347:         <span class="ruby-identifier">key_server</span> = <span class="ruby-identifier">key</span>[<span class="ruby-value str">&quot;D&quot;</span>]
348:         <span class="ruby-identifier">mac_key_client</span> = <span class="ruby-identifier">key</span>[<span class="ruby-value str">&quot;E&quot;</span>]
349:         <span class="ruby-identifier">mac_key_server</span> = <span class="ruby-identifier">key</span>[<span class="ruby-value str">&quot;F&quot;</span>]
350: 
351:         <span class="ruby-identifier">parameters</span> = { <span class="ruby-identifier">:shared</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">secret</span>, <span class="ruby-identifier">:hash</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">hash</span>, <span class="ruby-identifier">:digester</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">digester</span> }
352:         
353:         <span class="ruby-identifier">cipher_client</span> = <span class="ruby-constant">CipherFactory</span>.<span class="ruby-identifier">get</span>(<span class="ruby-identifier">encryption_client</span>, <span class="ruby-identifier">parameters</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">:iv</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">iv_client</span>, <span class="ruby-identifier">:key</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">key_client</span>, <span class="ruby-identifier">:encrypt</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>))
354:         <span class="ruby-identifier">cipher_server</span> = <span class="ruby-constant">CipherFactory</span>.<span class="ruby-identifier">get</span>(<span class="ruby-identifier">encryption_server</span>, <span class="ruby-identifier">parameters</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">:iv</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">iv_server</span>, <span class="ruby-identifier">:key</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">key_server</span>, <span class="ruby-identifier">:decrypt</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>))
355: 
356:         <span class="ruby-identifier">mac_client</span> = <span class="ruby-constant">HMAC</span>.<span class="ruby-identifier">get</span>(<span class="ruby-identifier">hmac_client</span>, <span class="ruby-identifier">mac_key_client</span>, <span class="ruby-identifier">parameters</span>)
357:         <span class="ruby-identifier">mac_server</span> = <span class="ruby-constant">HMAC</span>.<span class="ruby-identifier">get</span>(<span class="ruby-identifier">hmac_server</span>, <span class="ruby-identifier">mac_key_server</span>, <span class="ruby-identifier">parameters</span>)
358: 
359:         <span class="ruby-identifier">session</span>.<span class="ruby-identifier">configure_client</span> <span class="ruby-identifier">:cipher</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">cipher_client</span>, <span class="ruby-identifier">:hmac</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">mac_client</span>,
360:           <span class="ruby-identifier">:compression</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">normalize_compression_name</span>(<span class="ruby-identifier">compression_client</span>),
361:           <span class="ruby-identifier">:compression_level</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:compression_level</span>],
362:           <span class="ruby-identifier">:rekey_limit</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:rekey_limit</span>],
363:           <span class="ruby-identifier">:max_packets</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:rekey_packet_limit</span>],
364:           <span class="ruby-identifier">:max_blocks</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:rekey_blocks_limit</span>]
365: 
366:         <span class="ruby-identifier">session</span>.<span class="ruby-identifier">configure_server</span> <span class="ruby-identifier">:cipher</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">cipher_server</span>, <span class="ruby-identifier">:hmac</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">mac_server</span>,
367:           <span class="ruby-identifier">:compression</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">normalize_compression_name</span>(<span class="ruby-identifier">compression_server</span>),
368:           <span class="ruby-identifier">:rekey_limit</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:rekey_limit</span>],
369:           <span class="ruby-identifier">:max_packets</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:rekey_packet_limit</span>],
370:           <span class="ruby-identifier">:max_blocks</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:rekey_blocks_limit</span>]
371: 
372:         <span class="ruby-ivar">@initialized</span> = <span class="ruby-keyword kw">true</span>
373:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000324">
                    
                    <a name="M000324"></a><b>kex_byte_requirement</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Considers the sizes of the keys and block-sizes for the selected ciphers,
and the lengths of the hmacs, and returns the largest as the byte
requirement for the key-exchange algorithm.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000324_source')" id="l_M000324_source">show</a>
                        
                    </p>
                    <div id="M000324_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/net/ssh/transport/algorithms.rb, line 308</span>
308:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">kex_byte_requirement</span>
309:         <span class="ruby-identifier">sizes</span> = [<span class="ruby-value">8</span>] <span class="ruby-comment cmt"># require at least 8 bytes</span>
310: 
311:         <span class="ruby-identifier">sizes</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-constant">CipherFactory</span>.<span class="ruby-identifier">get_lengths</span>(<span class="ruby-identifier">encryption_client</span>))
312:         <span class="ruby-identifier">sizes</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-constant">CipherFactory</span>.<span class="ruby-identifier">get_lengths</span>(<span class="ruby-identifier">encryption_server</span>))
313: 
314:         <span class="ruby-identifier">sizes</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">HMAC</span>.<span class="ruby-identifier">key_length</span>(<span class="ruby-identifier">hmac_client</span>)
315:         <span class="ruby-identifier">sizes</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">HMAC</span>.<span class="ruby-identifier">key_length</span>(<span class="ruby-identifier">hmac_server</span>)
316: 
317:         <span class="ruby-identifier">sizes</span>.<span class="ruby-identifier">max</span>
318:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000323">
                    
                    <a name="M000323"></a><b>negotiate</b>(algorithm)
                    
                </div>
                
                <div class="description">
                  <p>
Negotiates a single algorithm based on the preferences reported by the
server and those set by the client. This is called by <a
href="Algorithms.html#M000322">negotiate_algorithms</a>.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000323_source')" id="l_M000323_source">show</a>
                        
                    </p>
                    <div id="M000323_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/net/ssh/transport/algorithms.rb, line 295</span>
295:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">negotiate</span>(<span class="ruby-identifier">algorithm</span>)
296:         <span class="ruby-identifier">match</span> = <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">algorithm</span>].<span class="ruby-identifier">find</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">item</span><span class="ruby-operator">|</span> <span class="ruby-ivar">@server_data</span>[<span class="ruby-identifier">algorithm</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">item</span>) }
297: 
298:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">match</span>.<span class="ruby-identifier">nil?</span>
299:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">SSH</span><span class="ruby-operator">::</span><span class="ruby-constant">Exception</span>, <span class="ruby-node">&quot;could not settle on #{algorithm} algorithm&quot;</span>
300:         <span class="ruby-keyword kw">end</span>
301: 
302:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">match</span>
303:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000322">
                    
                    <a name="M000322"></a><b>negotiate_algorithms</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Given the parsed server KEX packet, and the client&#8217;s preferred
algorithm lists in <a href="Algorithms.html#algorithms">algorithms</a>,
determine which preferred algorithms each has in common and set those as
the selected algorithms. If, for any algorithm, no type can be settled on,
an exception is raised.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000322_source')" id="l_M000322_source">show</a>
                        
                    </p>
                    <div id="M000322_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/net/ssh/transport/algorithms.rb, line 272</span>
272:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">negotiate_algorithms</span>
273:         <span class="ruby-ivar">@kex</span>                = <span class="ruby-identifier">negotiate</span>(<span class="ruby-identifier">:kex</span>)
274:         <span class="ruby-ivar">@host_key</span>           = <span class="ruby-identifier">negotiate</span>(<span class="ruby-identifier">:host_key</span>)
275:         <span class="ruby-ivar">@encryption_client</span>  = <span class="ruby-identifier">negotiate</span>(<span class="ruby-identifier">:encryption_client</span>)
276:         <span class="ruby-ivar">@encryption_server</span>  = <span class="ruby-identifier">negotiate</span>(<span class="ruby-identifier">:encryption_server</span>)
277:         <span class="ruby-ivar">@hmac_client</span>        = <span class="ruby-identifier">negotiate</span>(<span class="ruby-identifier">:hmac_client</span>)
278:         <span class="ruby-ivar">@hmac_server</span>        = <span class="ruby-identifier">negotiate</span>(<span class="ruby-identifier">:hmac_server</span>)
279:         <span class="ruby-ivar">@compression_client</span> = <span class="ruby-identifier">negotiate</span>(<span class="ruby-identifier">:compression_client</span>)
280:         <span class="ruby-ivar">@compression_server</span> = <span class="ruby-identifier">negotiate</span>(<span class="ruby-identifier">:compression_server</span>)
281:         <span class="ruby-ivar">@language_client</span>    = <span class="ruby-identifier">negotiate</span>(<span class="ruby-identifier">:language_client</span>) <span class="ruby-keyword kw">rescue</span> <span class="ruby-value str">&quot;&quot;</span>
282:         <span class="ruby-ivar">@language_server</span>    = <span class="ruby-identifier">negotiate</span>(<span class="ruby-identifier">:language_server</span>) <span class="ruby-keyword kw">rescue</span> <span class="ruby-value str">&quot;&quot;</span>
283: 
284:         <span class="ruby-identifier">debug</span> <span class="ruby-keyword kw">do</span>
285:           <span class="ruby-value str">&quot;negotiated:\n&quot;</span> <span class="ruby-operator">+</span>
286:             [<span class="ruby-identifier">:kex</span>, <span class="ruby-identifier">:host_key</span>, <span class="ruby-identifier">:encryption_server</span>, <span class="ruby-identifier">:encryption_client</span>, <span class="ruby-identifier">:hmac_client</span>, <span class="ruby-identifier">:hmac_server</span>, <span class="ruby-identifier">:compression_client</span>, <span class="ruby-identifier">:compression_server</span>, <span class="ruby-identifier">:language_client</span>, <span class="ruby-identifier">:language_server</span>].<span class="ruby-identifier">map</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span><span class="ruby-operator">|</span>
287:               <span class="ruby-node">&quot;* #{key}: #{instance_variable_get(&quot;@#{key}&quot;)}&quot;</span>
288:             <span class="ruby-keyword kw">end</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;\n&quot;</span>)
289:         <span class="ruby-keyword kw">end</span>
290:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000327">
                    
                    <a name="M000327"></a><b>normalize_compression_name</b>(name)
                    
                </div>
                
                <div class="description">
                  <p>
Given the <a href="../../SSH.html">SSH</a> name for some compression
algorithm, return a normalized name as a symbol.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000327_source')" id="l_M000327_source">show</a>
                        
                    </p>
                    <div id="M000327_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/net/ssh/transport/algorithms.rb, line 377</span>
377:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">normalize_compression_name</span>(<span class="ruby-identifier">name</span>)
378:         <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">name</span>
379:         <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;none&quot;</span>             <span class="ruby-keyword kw">then</span> <span class="ruby-keyword kw">false</span>
380:         <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;zlib&quot;</span>             <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">:standard</span>
381:         <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;zlib@openssh.com&quot;</span> <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">:delayed</span>
382:         <span class="ruby-keyword kw">else</span> <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-node">&quot;unknown compression type `#{name}'&quot;</span>
383:         <span class="ruby-keyword kw">end</span>
384:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000320">
                    
                    <a name="M000320"></a><b>parse_server_algorithm_packet</b>(packet)
                    
                </div>
                
                <div class="description">
                  <p>
Parses a KEXINIT packet from the server.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000320_source')" id="l_M000320_source">show</a>
                        
                    </p>
                    <div id="M000320_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/net/ssh/transport/algorithms.rb, line 226</span>
226:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">parse_server_algorithm_packet</span>(<span class="ruby-identifier">packet</span>)
227:         <span class="ruby-identifier">data</span> = { <span class="ruby-identifier">:raw</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">packet</span>.<span class="ruby-identifier">content</span> }
228: 
229:         <span class="ruby-identifier">packet</span>.<span class="ruby-identifier">read</span>(<span class="ruby-value">16</span>) <span class="ruby-comment cmt"># skip the cookie value</span>
230: 
231:         <span class="ruby-identifier">data</span>[<span class="ruby-identifier">:kex</span>]                = <span class="ruby-identifier">packet</span>.<span class="ruby-identifier">read_string</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp re">/,/</span>)
232:         <span class="ruby-identifier">data</span>[<span class="ruby-identifier">:host_key</span>]           = <span class="ruby-identifier">packet</span>.<span class="ruby-identifier">read_string</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp re">/,/</span>)
233:         <span class="ruby-identifier">data</span>[<span class="ruby-identifier">:encryption_client</span>]  = <span class="ruby-identifier">packet</span>.<span class="ruby-identifier">read_string</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp re">/,/</span>)
234:         <span class="ruby-identifier">data</span>[<span class="ruby-identifier">:encryption_server</span>]  = <span class="ruby-identifier">packet</span>.<span class="ruby-identifier">read_string</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp re">/,/</span>)
235:         <span class="ruby-identifier">data</span>[<span class="ruby-identifier">:hmac_client</span>]        = <span class="ruby-identifier">packet</span>.<span class="ruby-identifier">read_string</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp re">/,/</span>)
236:         <span class="ruby-identifier">data</span>[<span class="ruby-identifier">:hmac_server</span>]        = <span class="ruby-identifier">packet</span>.<span class="ruby-identifier">read_string</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp re">/,/</span>)
237:         <span class="ruby-identifier">data</span>[<span class="ruby-identifier">:compression_client</span>] = <span class="ruby-identifier">packet</span>.<span class="ruby-identifier">read_string</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp re">/,/</span>)
238:         <span class="ruby-identifier">data</span>[<span class="ruby-identifier">:compression_server</span>] = <span class="ruby-identifier">packet</span>.<span class="ruby-identifier">read_string</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp re">/,/</span>)
239:         <span class="ruby-identifier">data</span>[<span class="ruby-identifier">:language_client</span>]    = <span class="ruby-identifier">packet</span>.<span class="ruby-identifier">read_string</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp re">/,/</span>)
240:         <span class="ruby-identifier">data</span>[<span class="ruby-identifier">:language_server</span>]    = <span class="ruby-identifier">packet</span>.<span class="ruby-identifier">read_string</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp re">/,/</span>)
241: 
242:         <span class="ruby-comment cmt"># TODO: if first_kex_packet_follows, we need to try to skip the</span>
243:         <span class="ruby-comment cmt"># actual kexinit stuff and try to guess what the server is doing...</span>
244:         <span class="ruby-comment cmt"># need to read more about this scenario.</span>
245:         <span class="ruby-identifier">first_kex_packet_follows</span> = <span class="ruby-identifier">packet</span>.<span class="ruby-identifier">read_bool</span>
246: 
247:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">data</span>
248:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000317">
                    
                    <a name="M000317"></a><b>prepare_preferred_algorithms!</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Prepares the list of preferred algorithms, based on the options hash that
was given when the object was constructed, and the <a
href="Algorithms.html#ALGORITHMS">ALGORITHMS</a> constant. Also, when
determining the <a href="Algorithms.html#host_key">host_key</a> type to
use, the known hosts files are examined to see if the host has ever sent a
<a href="Algorithms.html#host_key">host_key</a> before, and if so, that key
type is used as the preferred type for communicating with this server.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000317_source')" id="l_M000317_source">show</a>
                        
                    </p>
                    <div id="M000317_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/net/ssh/transport/algorithms.rb, line 185</span>
185:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">prepare_preferred_algorithms!</span>
186:         <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:compression</span>] = <span class="ruby-node">%w(zlib@openssh.com zlib)</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:compression</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">true</span>
187: 
188:         <span class="ruby-constant">ALGORITHMS</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">algorithm</span>, <span class="ruby-identifier">list</span><span class="ruby-operator">|</span>
189:           <span class="ruby-identifier">algorithms</span>[<span class="ruby-identifier">algorithm</span>] = <span class="ruby-identifier">list</span>.<span class="ruby-identifier">dup</span>
190: 
191:           <span class="ruby-comment cmt"># apply the preferred algorithm order, if any</span>
192:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">algorithm</span>]
193:             <span class="ruby-identifier">algorithms</span>[<span class="ruby-identifier">algorithm</span>] = <span class="ruby-constant">Array</span>(<span class="ruby-identifier">options</span>[<span class="ruby-identifier">algorithm</span>]).<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">uniq</span>
194:             <span class="ruby-identifier">invalid</span> = <span class="ruby-identifier">algorithms</span>[<span class="ruby-identifier">algorithm</span>].<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">name</span><span class="ruby-operator">|</span> <span class="ruby-operator">!</span><span class="ruby-constant">ALGORITHMS</span>[<span class="ruby-identifier">algorithm</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">name</span>) }
195:             <span class="ruby-identifier">raise</span> <span class="ruby-constant">NotImplementedError</span>, <span class="ruby-node">&quot;unsupported #{algorithm} algorithm: `#{invalid}'&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">invalid</span>
196: 
197:             <span class="ruby-comment cmt"># make sure all of our supported algorithms are tacked onto the</span>
198:             <span class="ruby-comment cmt"># end, so that if the user tries to give a list of which none are</span>
199:             <span class="ruby-comment cmt"># supported, we can still proceed.</span>
200:             <span class="ruby-identifier">list</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">name</span><span class="ruby-operator">|</span> <span class="ruby-identifier">algorithms</span>[<span class="ruby-identifier">algorithm</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">name</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">algorithms</span>[<span class="ruby-identifier">algorithm</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">name</span>) }
201:           <span class="ruby-keyword kw">end</span>
202:         <span class="ruby-keyword kw">end</span>
203: 
204:         <span class="ruby-comment cmt"># for convention, make sure our list has the same keys as the server</span>
205:         <span class="ruby-comment cmt"># list</span>
206: 
207:         <span class="ruby-identifier">algorithms</span>[<span class="ruby-identifier">:encryption_client</span> ] = <span class="ruby-identifier">algorithms</span>[<span class="ruby-identifier">:encryption_server</span> ] = <span class="ruby-identifier">algorithms</span>[<span class="ruby-identifier">:encryption</span>]
208:         <span class="ruby-identifier">algorithms</span>[<span class="ruby-identifier">:hmac_client</span>       ] = <span class="ruby-identifier">algorithms</span>[<span class="ruby-identifier">:hmac_server</span>       ] = <span class="ruby-identifier">algorithms</span>[<span class="ruby-identifier">:hmac</span>]
209:         <span class="ruby-identifier">algorithms</span>[<span class="ruby-identifier">:compression_client</span>] = <span class="ruby-identifier">algorithms</span>[<span class="ruby-identifier">:compression_server</span>] = <span class="ruby-identifier">algorithms</span>[<span class="ruby-identifier">:compression</span>]
210:         <span class="ruby-identifier">algorithms</span>[<span class="ruby-identifier">:language_client</span>   ] = <span class="ruby-identifier">algorithms</span>[<span class="ruby-identifier">:language_server</span>   ] = <span class="ruby-identifier">algorithms</span>[<span class="ruby-identifier">:language</span>]
211: 
212:         <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">options</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-identifier">:host_key</span>)
213:           <span class="ruby-comment cmt"># make sure the host keys are specified in preference order, where any</span>
214:           <span class="ruby-comment cmt"># existing known key for the host has preference.</span>
215: 
216:           <span class="ruby-identifier">existing_keys</span> = <span class="ruby-constant">KnownHosts</span>.<span class="ruby-identifier">search_for</span>(<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:host_key_alias</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">session</span>.<span class="ruby-identifier">host_as_string</span>, <span class="ruby-identifier">options</span>)
217:           <span class="ruby-identifier">host_keys</span> = <span class="ruby-identifier">existing_keys</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">key</span><span class="ruby-operator">|</span> <span class="ruby-identifier">key</span>.<span class="ruby-identifier">ssh_type</span> }.<span class="ruby-identifier">uniq</span>
218:           <span class="ruby-identifier">algorithms</span>[<span class="ruby-identifier">:host_key</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">name</span><span class="ruby-operator">|</span>
219:             <span class="ruby-identifier">host_keys</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">name</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">host_keys</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">name</span>)
220:           <span class="ruby-keyword kw">end</span>
221:           <span class="ruby-identifier">algorithms</span>[<span class="ruby-identifier">:host_key</span>] = <span class="ruby-identifier">host_keys</span>
222:         <span class="ruby-keyword kw">end</span>
223:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000315">
                    
                    <a name="M000315"></a><b>proceed!</b>()
                    
                </div>
                
                <div class="description">
                  <p>
After both client and server have sent their KEXINIT packets, this will do
the algorithm negotiation and key exchange. Once both finish, the object
leaves the pending state and the method returns.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000315_source')" id="l_M000315_source">show</a>
                        
                    </p>
                    <div id="M000315_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/net/ssh/transport/algorithms.rb, line 172</span>
172:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">proceed!</span>
173:         <span class="ruby-identifier">info</span> { <span class="ruby-value str">&quot;negotiating algorithms&quot;</span> }
174:         <span class="ruby-identifier">negotiate_algorithms</span>
175:         <span class="ruby-identifier">exchange_keys</span>
176:         <span class="ruby-ivar">@pending</span> = <span class="ruby-keyword kw">false</span>
177:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000314">
                    
                    <a name="M000314"></a><b>send_kexinit</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Sends a KEXINIT packet to the server. If a server KEXINIT has already been
received, this will then invoke <a
href="Algorithms.html#M000315">proceed!</a> to proceed with the key
exchange, otherwise it returns immediately (but sets the object to the
pending state).
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000314_source')" id="l_M000314_source">show</a>
                        
                    </p>
                    <div id="M000314_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/net/ssh/transport/algorithms.rb, line 160</span>
160:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">send_kexinit</span>
161:         <span class="ruby-identifier">info</span> { <span class="ruby-value str">&quot;sending KEXINIT&quot;</span> }
162:         <span class="ruby-ivar">@pending</span> = <span class="ruby-keyword kw">true</span>
163:         <span class="ruby-identifier">packet</span> = <span class="ruby-identifier">build_client_algorithm_packet</span>
164:         <span class="ruby-ivar">@client_packet</span> = <span class="ruby-identifier">packet</span>.<span class="ruby-identifier">to_s</span>
165:         <span class="ruby-identifier">session</span>.<span class="ruby-identifier">send_message</span>(<span class="ruby-identifier">packet</span>)
166:         <span class="ruby-identifier">proceed!</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@server_packet</span>
167:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    