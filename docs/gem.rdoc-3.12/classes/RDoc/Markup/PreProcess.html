<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>RDoc::Markup::PreProcess</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../../css/main.css" type="text/css" media="screen" />
    <script src="../../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Class</span> 
            RDoc::Markup::PreProcess 
            
                <span class="parent">&lt; 
                    
                    <a href="../../Object.html">Object</a>
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../../files/lib/rdoc/markup/pre_process_rb.html">lib/rdoc/markup/pre_process.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    
    <div class="description">
        <p>
Handle common directives that can occur in a block of text:
</p>
<pre>
  \:include: filename
</pre>
<p>
Directives can be escaped by preceding them with a backslash.
</p>
<p>
<a href="../RDoc.html">RDoc</a> plugin authors can register additional
directives to be handled by using RDoc::Markup::PreProcess::register.
</p>
<p>
Any directive that is not built-in to <a href="../RDoc.html">RDoc</a>
(including those registered via plugins) will be stored in the metadata
hash on the <a href="../CodeObject.html">CodeObject</a> the comment is
attached to. See RDoc::Markup@Directives for the list of built-in
directives.
</p>

    </div>
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>F</dt>
        <dd>
            <ul>
                
                <li><a href="#M000387">find_include_file</a></li>
                
            </ul>
        </dd>
    
        <dt>H</dt>
        <dd>
            <ul>
                
                <li><a href="#M000380">handle</a>,</li>
                
                <li><a href="#M000382">handle_directive</a></li>
                
            </ul>
        </dd>
    
        <dt>I</dt>
        <dd>
            <ul>
                
                <li><a href="#M000386">include_file</a></li>
                
            </ul>
        </dd>
    
        <dt>N</dt>
        <dd>
            <ul>
                
                <li><a href="#M000379">new</a></li>
                
            </ul>
        </dd>
    
        <dt>P</dt>
        <dd>
            <ul>
                
                <li><a href="#M000374">post_process</a>,</li>
                
                <li><a href="#M000375">post_processors</a></li>
                
            </ul>
        </dd>
    
        <dt>R</dt>
        <dd>
            <ul>
                
                <li><a href="#M000376">register</a>,</li>
                
                <li><a href="#M000377">registered</a>,</li>
                
                <li><a href="#M000378">reset</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    

    

    

    

    
    <div class="sectiontitle">Attributes</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>options</td>
            <td class='attr-desc'><p>
An <a href="../Options.html">RDoc::Options</a> instance that will be filled
in with overrides from directives
</p></td>
        </tr>
        
    </table>
    

    
            <div class="sectiontitle">Class Public methods</div>
            
            <div class="method">
                <div class="title" id="M000379">
                    
                    <a name="M000379"></a><b>new</b>(input_file_name, include_path)
                    
                </div>
                
                <div class="description">
                  <p>
Creates a new pre-processor for <tt>input_file_name</tt> that will look for
included files in <tt>include_path</tt>
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000379_source')" id="l_M000379_source">show</a>
                        
                    </p>
                    <div id="M000379_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/rdoc/markup/pre_process.rb, line 77</span>
77:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">input_file_name</span>, <span class="ruby-identifier">include_path</span>)
78:     <span class="ruby-ivar">@input_file_name</span> = <span class="ruby-identifier">input_file_name</span>
79:     <span class="ruby-ivar">@include_path</span> = <span class="ruby-identifier">include_path</span>
80:     <span class="ruby-ivar">@options</span> = <span class="ruby-keyword kw">nil</span>
81:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000374">
                    
                    <a name="M000374"></a><b>post_process</b>(&amp;block)
                    
                </div>
                
                <div class="description">
                  <p>
Adds a post-process handler for directives. The handler will be called with
the result <a href="../Comment.html">RDoc::Comment</a> (or text String) and
the code object for the comment (if any).
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000374_source')" id="l_M000374_source">show</a>
                        
                    </p>
                    <div id="M000374_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/rdoc/markup/pre_process.rb, line 29</span>
29:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">post_process</span> <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>
30:     <span class="ruby-ivar">@post_processors</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">block</span>
31:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000375">
                    
                    <a name="M000375"></a><b>post_processors</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Registered post-processors
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000375_source')" id="l_M000375_source">show</a>
                        
                    </p>
                    <div id="M000375_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/rdoc/markup/pre_process.rb, line 36</span>
36:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">post_processors</span>
37:     <span class="ruby-ivar">@post_processors</span>
38:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000376">
                    
                    <a name="M000376"></a><b>register</b>(directive, &amp;block)
                    
                </div>
                
                <div class="description">
                  <p>
Registers <tt>directive</tt> as one handled by <a
href="../RDoc.html">RDoc</a>. If a block is given the directive will be
replaced by the result of the block, otherwise the directive will be
removed from the processed text.
</p>
<p>
The block will be called with the directive name and the directive
parameter:
</p>
<pre>
  RDoc::Markup::PreProcess.register 'my-directive' do |directive, param|
    # replace text, etc.
  end
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000376_source')" id="l_M000376_source">show</a>
                        
                    </p>
                    <div id="M000376_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/rdoc/markup/pre_process.rb, line 52</span>
52:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">register</span> <span class="ruby-identifier">directive</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>
53:     <span class="ruby-ivar">@registered</span>[<span class="ruby-identifier">directive</span>] = <span class="ruby-identifier">block</span>
54:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000377">
                    
                    <a name="M000377"></a><b>registered</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Registered directives
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000377_source')" id="l_M000377_source">show</a>
                        
                    </p>
                    <div id="M000377_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/rdoc/markup/pre_process.rb, line 59</span>
59:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">registered</span>
60:     <span class="ruby-ivar">@registered</span>
61:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000378">
                    
                    <a name="M000378"></a><b>reset</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Clears all registered directives and post-processors
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000378_source')" id="l_M000378_source">show</a>
                        
                    </p>
                    <div id="M000378_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/rdoc/markup/pre_process.rb, line 66</span>
66:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">reset</span>
67:     <span class="ruby-ivar">@post_processors</span> = []
68:     <span class="ruby-ivar">@registered</span> = {}
69:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M000387">
                    
                    <a name="M000387"></a><b>find_include_file</b>(name)
                    
                </div>
                
                <div class="description">
                  <p>
Look for the given file in the directory containing the current file, and
then in each of the directories specified in the RDOC_INCLUDE path
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000387_source')" id="l_M000387_source">show</a>
                        
                    </p>
                    <div id="M000387_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rdoc/markup/pre_process.rb, line 282</span>
282:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">find_include_file</span>(<span class="ruby-identifier">name</span>)
283:     <span class="ruby-identifier">to_search</span> = [<span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-ivar">@input_file_name</span>)].<span class="ruby-identifier">concat</span> <span class="ruby-ivar">@include_path</span>
284:     <span class="ruby-identifier">to_search</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">dir</span><span class="ruby-operator">|</span>
285:       <span class="ruby-identifier">full_name</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">dir</span>, <span class="ruby-identifier">name</span>)
286:       <span class="ruby-identifier">stat</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">stat</span>(<span class="ruby-identifier">full_name</span>) <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">next</span>
287:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">full_name</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">stat</span>.<span class="ruby-identifier">readable?</span>
288:     <span class="ruby-keyword kw">end</span>
289:     <span class="ruby-keyword kw">nil</span>
290:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000380">
                    
                    <a name="M000380"></a><b>handle</b>(text, code_object = nil, &amp;block)
                    
                </div>
                
                <div class="description">
                  <p>
Look for directives in the given <tt>text</tt>.
</p>
<p>
<a href="../Options.html">Options</a> that we don&#8217;t handle are
yielded. If the block returns false the directive is restored to the text.
If the block returns nil or no block was given the directive is handled
according to the registered directives. If a String was returned the
directive is replaced with the string.
</p>
<p>
If no matching directive was registered the directive is restored to the
text.
</p>
<p>
If <tt>code_object</tt> is given and the directive is unknown then the
directive&#8217;s parameter is set as metadata on the <tt>code_object</tt>.
See <a href="../CodeObject.html#metadata">RDoc::CodeObject#metadata</a> for
details.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000380_source')" id="l_M000380_source">show</a>
                        
                    </p>
                    <div id="M000380_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rdoc/markup/pre_process.rb, line 98</span>
 98:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">handle</span> <span class="ruby-identifier">text</span>, <span class="ruby-identifier">code_object</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>
 99:     <span class="ruby-keyword kw">if</span> <span class="ruby-constant">RDoc</span><span class="ruby-operator">::</span><span class="ruby-constant">Comment</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">text</span> <span class="ruby-keyword kw">then</span>
100:       <span class="ruby-identifier">comment</span> = <span class="ruby-identifier">text</span>
101:       <span class="ruby-identifier">text</span> = <span class="ruby-identifier">text</span>.<span class="ruby-identifier">text</span>
102:     <span class="ruby-keyword kw">end</span>
103: 
104:     <span class="ruby-identifier">encoding</span> = <span class="ruby-identifier">text</span>.<span class="ruby-identifier">encoding</span> <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">defined?</span>(<span class="ruby-constant">Encoding</span>)
105: 
106:     <span class="ruby-comment cmt"># regexp helper (square brackets for optional)</span>
107:     <span class="ruby-comment cmt"># $1      $2  $3        $4      $5</span>
108:     <span class="ruby-comment cmt"># [prefix][\]:directive:[spaces][param]newline</span>
109:     <span class="ruby-identifier">text</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">/^([ \t]*(?:#|\/?\*)?[ \t]*)(\\?):(\w+):([ \t]*)(.+)?(\r?\n|$)/</span>) <span class="ruby-keyword kw">do</span>
110:       <span class="ruby-comment cmt"># skip something like ':toto::'</span>
111:       <span class="ruby-keyword kw">next</span> <span class="ruby-identifier">$&amp;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">$4</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">$5</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">$5</span>[<span class="ruby-value">0</span>, <span class="ruby-value">1</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">':'</span>
112: 
113:       <span class="ruby-comment cmt"># skip if escaped</span>
114:       <span class="ruby-keyword kw">next</span> <span class="ruby-value str">&quot;#$1:#$3:#$4#$5\n&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">$2</span>.<span class="ruby-identifier">empty?</span>
115: 
116:       <span class="ruby-comment cmt"># This is not in handle_directive because I didn't want to pass another</span>
117:       <span class="ruby-comment cmt"># argument into it</span>
118:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">comment</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">$3</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'markup'</span> <span class="ruby-keyword kw">then</span>
119:         <span class="ruby-keyword kw">next</span> <span class="ruby-node">&quot;#{$1.strip}\n&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">$5</span>
120:         <span class="ruby-identifier">comment</span>.<span class="ruby-identifier">format</span> = <span class="ruby-identifier">$5</span>.<span class="ruby-identifier">downcase</span>
121:         <span class="ruby-keyword kw">next</span> <span class="ruby-node">&quot;#{$1.strip}\n&quot;</span>
122:       <span class="ruby-keyword kw">end</span>
123: 
124:       <span class="ruby-identifier">handle_directive</span> <span class="ruby-identifier">$1</span>, <span class="ruby-identifier">$3</span>, <span class="ruby-identifier">$5</span>, <span class="ruby-identifier">code_object</span>, <span class="ruby-identifier">encoding</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>
125:     <span class="ruby-keyword kw">end</span>
126: 
127:     <span class="ruby-identifier">comment</span> = <span class="ruby-identifier">text</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">comment</span>
128: 
129:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">post_processors</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">handler</span><span class="ruby-operator">|</span>
130:       <span class="ruby-identifier">handler</span>.<span class="ruby-identifier">call</span> <span class="ruby-identifier">comment</span>, <span class="ruby-identifier">code_object</span>
131:     <span class="ruby-keyword kw">end</span>
132: 
133:     <span class="ruby-identifier">text</span>
134:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000382">
                    
                    <a name="M000382"></a><b>handle_directive</b>(prefix, directive, param, code_object = nil, encoding = nil)
                    
                </div>
                
                <div class="description">
                  <p>
Performs the actions described by <tt>directive</tt> and its parameter
<tt>param</tt>.
</p>
<p>
<tt>code_object</tt> is used for directives that operate on a class or
module. <tt>prefix</tt> is used to ensure the replacement for handled
directives is correct. <tt>encoding</tt> is used for the <tt>include</tt>
directive.
</p>
<p>
For a list of directives in <a href="../RDoc.html">RDoc</a> see <a
href="../Markup.html">RDoc::Markup</a>.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000382_source')" id="l_M000382_source">show</a>
                        
                    </p>
                    <div id="M000382_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rdoc/markup/pre_process.rb, line 147</span>
147:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">handle_directive</span> <span class="ruby-identifier">prefix</span>, <span class="ruby-identifier">directive</span>, <span class="ruby-identifier">param</span>, <span class="ruby-identifier">code_object</span> = <span class="ruby-keyword kw">nil</span>,
148:                        <span class="ruby-identifier">encoding</span> = <span class="ruby-keyword kw">nil</span>
149:     <span class="ruby-identifier">blankline</span> = <span class="ruby-node">&quot;#{prefix.strip}\n&quot;</span>
150:     <span class="ruby-identifier">directive</span> = <span class="ruby-identifier">directive</span>.<span class="ruby-identifier">downcase</span>
151: 
152:     <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">directive</span>
153:     <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'arg'</span>, <span class="ruby-value str">'args'</span> <span class="ruby-keyword kw">then</span>
154:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">blankline</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">code_object</span>
155: 
156:       <span class="ruby-identifier">code_object</span>.<span class="ruby-identifier">params</span> = <span class="ruby-identifier">param</span>
157: 
158:       <span class="ruby-identifier">blankline</span>
159:     <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'category'</span> <span class="ruby-keyword kw">then</span>
160:       <span class="ruby-keyword kw">if</span> <span class="ruby-constant">RDoc</span><span class="ruby-operator">::</span><span class="ruby-constant">Context</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">code_object</span> <span class="ruby-keyword kw">then</span>
161:         <span class="ruby-identifier">section</span> = <span class="ruby-identifier">code_object</span>.<span class="ruby-identifier">add_section</span> <span class="ruby-identifier">param</span>
162:         <span class="ruby-identifier">code_object</span>.<span class="ruby-identifier">temporary_section</span> = <span class="ruby-identifier">section</span>
163:       <span class="ruby-keyword kw">end</span>
164: 
165:       <span class="ruby-identifier">blankline</span> <span class="ruby-comment cmt"># ignore category if we're not on an RDoc::Context</span>
166:     <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'doc'</span> <span class="ruby-keyword kw">then</span>
167:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">blankline</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">code_object</span>
168:       <span class="ruby-identifier">code_object</span>.<span class="ruby-identifier">document_self</span> = <span class="ruby-keyword kw">true</span>
169:       <span class="ruby-identifier">code_object</span>.<span class="ruby-identifier">force_documentation</span> = <span class="ruby-keyword kw">true</span>
170: 
171:       <span class="ruby-identifier">blankline</span>
172:     <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'enddoc'</span> <span class="ruby-keyword kw">then</span>
173:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">blankline</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">code_object</span>
174:       <span class="ruby-identifier">code_object</span>.<span class="ruby-identifier">done_documenting</span> = <span class="ruby-keyword kw">true</span>
175: 
176:       <span class="ruby-identifier">blankline</span>
177:     <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'include'</span> <span class="ruby-keyword kw">then</span>
178:       <span class="ruby-identifier">filename</span> = <span class="ruby-identifier">param</span>.<span class="ruby-identifier">split</span>.<span class="ruby-identifier">first</span>
179:       <span class="ruby-identifier">include_file</span> <span class="ruby-identifier">filename</span>, <span class="ruby-identifier">prefix</span>, <span class="ruby-identifier">encoding</span>
180:     <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'main'</span> <span class="ruby-keyword kw">then</span>
181:       <span class="ruby-ivar">@options</span>.<span class="ruby-identifier">main_page</span> = <span class="ruby-identifier">param</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@options</span>.<span class="ruby-identifier">respond_to?</span> <span class="ruby-identifier">:main_page</span>
182: 
183:       <span class="ruby-identifier">blankline</span>
184:     <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'nodoc'</span> <span class="ruby-keyword kw">then</span>
185:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">blankline</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">code_object</span>
186:       <span class="ruby-identifier">code_object</span>.<span class="ruby-identifier">document_self</span> = <span class="ruby-keyword kw">nil</span> <span class="ruby-comment cmt"># notify nodoc</span>
187:       <span class="ruby-identifier">code_object</span>.<span class="ruby-identifier">document_children</span> = <span class="ruby-identifier">param</span> <span class="ruby-operator">!~</span> <span class="ruby-regexp re">/all/i</span>
188: 
189:       <span class="ruby-identifier">blankline</span>
190:     <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'notnew'</span>, <span class="ruby-value str">'not_new'</span>, <span class="ruby-value str">'not-new'</span> <span class="ruby-keyword kw">then</span>
191:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">blankline</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">RDoc</span><span class="ruby-operator">::</span><span class="ruby-constant">AnyMethod</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">code_object</span>
192: 
193:       <span class="ruby-identifier">code_object</span>.<span class="ruby-identifier">dont_rename_initialize</span> = <span class="ruby-keyword kw">true</span>
194: 
195:       <span class="ruby-identifier">blankline</span>
196:     <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'startdoc'</span> <span class="ruby-keyword kw">then</span>
197:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">blankline</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">code_object</span>
198: 
199:       <span class="ruby-identifier">code_object</span>.<span class="ruby-identifier">start_doc</span>
200:       <span class="ruby-identifier">code_object</span>.<span class="ruby-identifier">force_documentation</span> = <span class="ruby-keyword kw">true</span>
201: 
202:       <span class="ruby-identifier">blankline</span>
203:     <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'stopdoc'</span> <span class="ruby-keyword kw">then</span>
204:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">blankline</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">code_object</span>
205: 
206:       <span class="ruby-identifier">code_object</span>.<span class="ruby-identifier">stop_doc</span>
207: 
208:       <span class="ruby-identifier">blankline</span>
209:     <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'title'</span> <span class="ruby-keyword kw">then</span>
210:       <span class="ruby-ivar">@options</span>.<span class="ruby-identifier">default_title</span> = <span class="ruby-identifier">param</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@options</span>.<span class="ruby-identifier">respond_to?</span> <span class="ruby-identifier">:default_title=</span>
211: 
212:       <span class="ruby-identifier">blankline</span>
213:     <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'yield'</span>, <span class="ruby-value str">'yields'</span> <span class="ruby-keyword kw">then</span>
214:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">blankline</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">code_object</span>
215:       <span class="ruby-comment cmt"># remove parameter &amp;block</span>
216:       <span class="ruby-identifier">code_object</span>.<span class="ruby-identifier">params</span>.<span class="ruby-identifier">sub!</span>(<span class="ruby-regexp re">/,?\s*&amp;\w+/</span>, <span class="ruby-value str">''</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">code_object</span>.<span class="ruby-identifier">params</span>
217: 
218:       <span class="ruby-identifier">code_object</span>.<span class="ruby-identifier">block_params</span> = <span class="ruby-identifier">param</span>
219: 
220:       <span class="ruby-identifier">blankline</span>
221:     <span class="ruby-keyword kw">else</span>
222:       <span class="ruby-identifier">result</span> = <span class="ruby-keyword kw">yield</span> <span class="ruby-identifier">directive</span>, <span class="ruby-identifier">param</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block_given?</span>
223: 
224:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">result</span>
225:       <span class="ruby-keyword kw">when</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">then</span>
226:         <span class="ruby-identifier">code_object</span>.<span class="ruby-identifier">metadata</span>[<span class="ruby-identifier">directive</span>] = <span class="ruby-identifier">param</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">code_object</span>
227: 
228:         <span class="ruby-keyword kw">if</span> <span class="ruby-constant">RDoc</span><span class="ruby-operator">::</span><span class="ruby-constant">Markup</span><span class="ruby-operator">::</span><span class="ruby-constant">PreProcess</span>.<span class="ruby-identifier">registered</span>.<span class="ruby-identifier">include?</span> <span class="ruby-identifier">directive</span> <span class="ruby-keyword kw">then</span>
229:           <span class="ruby-identifier">handler</span> = <span class="ruby-constant">RDoc</span><span class="ruby-operator">::</span><span class="ruby-constant">Markup</span><span class="ruby-operator">::</span><span class="ruby-constant">PreProcess</span>.<span class="ruby-identifier">registered</span>[<span class="ruby-identifier">directive</span>]
230:           <span class="ruby-identifier">result</span> = <span class="ruby-identifier">handler</span>.<span class="ruby-identifier">call</span> <span class="ruby-identifier">directive</span>, <span class="ruby-identifier">param</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">handler</span>
231:         <span class="ruby-keyword kw">else</span>
232:           <span class="ruby-identifier">result</span> = <span class="ruby-node">&quot;#{prefix}:#{directive}: #{param}\n&quot;</span>
233:         <span class="ruby-keyword kw">end</span>
234:       <span class="ruby-keyword kw">when</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">then</span>
235:         <span class="ruby-identifier">result</span> = <span class="ruby-node">&quot;#{prefix}:#{directive}: #{param}\n&quot;</span>
236:       <span class="ruby-keyword kw">end</span>
237: 
238:       <span class="ruby-identifier">result</span>
239:     <span class="ruby-keyword kw">end</span>
240:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000386">
                    
                    <a name="M000386"></a><b>include_file</b>(name, indent, encoding)
                    
                </div>
                
                <div class="description">
                  <p>
Handles the <tt>:include: <em>filename</em></tt> directive.
</p>
<p>
If the first line of the included file starts with &#8217;#&#8217;, and
contains an encoding information in the form &#8216;coding:&#8217; or
&#8216;coding=&#8217;, it is removed.
</p>
<p>
If all lines in the included file start with a &#8217;#&#8217;, this
leading &#8217;#&#8217; is removed before inclusion. The included content
is indented like the <tt>:include:</tt> directive.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000386_source')" id="l_M000386_source">show</a>
                        
                    </p>
                    <div id="M000386_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rdoc/markup/pre_process.rb, line 257</span>
257:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">include_file</span> <span class="ruby-identifier">name</span>, <span class="ruby-identifier">indent</span>, <span class="ruby-identifier">encoding</span>
258:     <span class="ruby-identifier">full_name</span> = <span class="ruby-identifier">find_include_file</span> <span class="ruby-identifier">name</span>
259: 
260:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">full_name</span> <span class="ruby-keyword kw">then</span>
261:       <span class="ruby-identifier">warn</span> <span class="ruby-node">&quot;Couldn't find file to include '#{name}' from #{@input_file_name}&quot;</span>
262:       <span class="ruby-keyword kw">return</span> <span class="ruby-value str">''</span>
263:     <span class="ruby-keyword kw">end</span>
264: 
265:     <span class="ruby-identifier">content</span> = <span class="ruby-constant">RDoc</span><span class="ruby-operator">::</span><span class="ruby-constant">Encoding</span>.<span class="ruby-identifier">read_file</span> <span class="ruby-identifier">full_name</span>, <span class="ruby-identifier">encoding</span>, <span class="ruby-keyword kw">true</span>
266: 
267:     <span class="ruby-comment cmt"># strip magic comment</span>
268:     <span class="ruby-identifier">content</span> = <span class="ruby-identifier">content</span>.<span class="ruby-identifier">sub</span>(<span class="ruby-regexp re">/\A# .*coding[=:].*$/</span>, <span class="ruby-value str">''</span>).<span class="ruby-identifier">lstrip</span>
269: 
270:     <span class="ruby-comment cmt"># strip leading '#'s, but only if all lines start with them</span>
271:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">content</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/^[^#]/</span> <span class="ruby-keyword kw">then</span>
272:       <span class="ruby-identifier">content</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/^/</span>, <span class="ruby-identifier">indent</span>)
273:     <span class="ruby-keyword kw">else</span>
274:       <span class="ruby-identifier">content</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/^#?/</span>, <span class="ruby-identifier">indent</span>)
275:     <span class="ruby-keyword kw">end</span>
276:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    