<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>Tilt::Template</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../css/main.css" type="text/css" media="screen" />
    <script src="../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Class</span> 
            Tilt::Template 
            
                <span class="parent">&lt; 
                    
                    Object
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../files/lib/tilt/template_rb.html">lib/tilt/template.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    
    <div class="description">
        <p>
Base class for template implementations. Subclasses must implement the <a
href="Template.html#M000116">prepare</a> method and one of the <a
href="Template.html#M000117">evaluate</a> or <a
href="Template.html#M000121">precompiled_template</a> methods.
</p>

    </div>
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>B</dt>
        <dd>
            <ul>
                
                <li><a href="#M000107">basename</a></li>
                
            </ul>
        </dd>
    
        <dt>C</dt>
        <dd>
            <ul>
                
                <li><a href="#M000119">cached_evaluate</a>,</li>
                
                <li><a href="#M000118">cached_evaluate</a>,</li>
                
                <li><a href="#M000138">compile_template_method</a>,</li>
                
                <li><a href="#M000134">compile_template_method</a>,</li>
                
                <li><a href="#M000124">compiled_method</a></li>
                
            </ul>
        </dd>
    
        <dt>E</dt>
        <dd>
            <ul>
                
                <li><a href="#M000109">eval_file</a>,</li>
                
                <li><a href="#M000117">evaluate</a>,</li>
                
                <li><a href="#M000128">evaluate_source</a>,</li>
                
                <li><a href="#M000129">evaluate_source</a>,</li>
                
                <li><a href="#M000137">extract_magic_comment</a></li>
                
            </ul>
        </dd>
    
        <dt>I</dt>
        <dd>
            <ul>
                
                <li><a href="#M000114">initialize_engine</a></li>
                
            </ul>
        </dd>
    
        <dt>N</dt>
        <dd>
            <ul>
                
                <li><a href="#M000108">name</a>,</li>
                
                <li><a href="#M000105">new</a></li>
                
            </ul>
        </dd>
    
        <dt>P</dt>
        <dd>
            <ul>
                
                <li><a href="#M000120">precompiled</a>,</li>
                
                <li><a href="#M000123">precompiled_postamble</a>,</li>
                
                <li><a href="#M000122">precompiled_preamble</a>,</li>
                
                <li><a href="#M000121">precompiled_template</a>,</li>
                
                <li><a href="#M000116">prepare</a></li>
                
            </ul>
        </dd>
    
        <dt>R</dt>
        <dd>
            <ul>
                
                <li><a href="#M000106">render</a>,</li>
                
                <li><a href="#M000115">require_template_library</a></li>
                
            </ul>
        </dd>
    
        <dt>U</dt>
        <dd>
            <ul>
                
                <li><a href="#M000135">unbind_compiled_method</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    

    

    

    

    
    <div class="sectiontitle">Attributes</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>data</td>
            <td class='attr-desc'><p>
<a href="Template.html">Template</a> source; loaded from a file or given
directly.
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>file</td>
            <td class='attr-desc'><p>
The name of the file where the template data was loaded from.
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>line</td>
            <td class='attr-desc'><p>
The line number in <a href="Template.html#file">file</a> where template
data was loaded from.
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>options</td>
            <td class='attr-desc'><p>
A Hash of template engine specific options. This is passed directly to the
underlying engine and is not used by the generic template interface.
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>engine_initialized</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>default_mime_type</td>
            <td class='attr-desc'></td>
        </tr>
        
    </table>
    

    
            <div class="sectiontitle">Class Public methods</div>
            
            <div class="method">
                <div class="title" id="M000105">
                    
                    <a name="M000105"></a><b>new</b>(file=nil, line=1, options={}, &amp;block)
                    
                </div>
                
                <div class="description">
                  <p>
Create a new template with the file, line, and options specified. By
default, template data is read from the file. When a block is given, it
should read template data and return as a String. When file is nil, a block
is required.
</p>
<p>
All arguments are optional.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000105_source')" id="l_M000105_source">show</a>
                        
                    </p>
                    <div id="M000105_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/tilt/template.rb, line 38</span>
38:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">file</span>=<span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">line</span>=<span class="ruby-value">1</span>, <span class="ruby-identifier">options</span>={}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
39:       <span class="ruby-ivar">@file</span>, <span class="ruby-ivar">@line</span>, <span class="ruby-ivar">@options</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-value">1</span>, {}
40: 
41:       [<span class="ruby-identifier">options</span>, <span class="ruby-identifier">line</span>, <span class="ruby-identifier">file</span>].<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">arg</span><span class="ruby-operator">|</span>
42:         <span class="ruby-keyword kw">case</span>
43:         <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">arg</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:to_str</span>)  ; <span class="ruby-ivar">@file</span> = <span class="ruby-identifier">arg</span>.<span class="ruby-identifier">to_str</span>
44:         <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">arg</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:to_int</span>)  ; <span class="ruby-ivar">@line</span> = <span class="ruby-identifier">arg</span>.<span class="ruby-identifier">to_int</span>
45:         <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">arg</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:to_hash</span>) ; <span class="ruby-ivar">@options</span> = <span class="ruby-identifier">arg</span>.<span class="ruby-identifier">to_hash</span>.<span class="ruby-identifier">dup</span>
46:         <span class="ruby-keyword kw">else</span> <span class="ruby-identifier">raise</span> <span class="ruby-constant">TypeError</span>
47:         <span class="ruby-keyword kw">end</span>
48:       <span class="ruby-keyword kw">end</span>
49: 
50:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-value str">&quot;file or block required&quot;</span> <span class="ruby-keyword kw">if</span> (<span class="ruby-ivar">@file</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">block</span>).<span class="ruby-identifier">nil?</span>
51: 
52:       <span class="ruby-comment cmt"># call the initialize_engine method if this is the very first time</span>
53:       <span class="ruby-comment cmt"># an instance of this class has been created.</span>
54:       <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">engine_initialized?</span>
55:         <span class="ruby-identifier">initialize_engine</span>
56:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">engine_initialized</span> = <span class="ruby-keyword kw">true</span>
57:       <span class="ruby-keyword kw">end</span>
58: 
59:       <span class="ruby-comment cmt"># used to hold compiled template methods</span>
60:       <span class="ruby-ivar">@compiled_method</span> = {}
61: 
62:       <span class="ruby-comment cmt"># used on 1.9 to set the encoding if it is not set elsewhere (like a magic comment)</span>
63:       <span class="ruby-comment cmt"># currently only used if template compiles to ruby</span>
64:       <span class="ruby-ivar">@default_encoding</span> = <span class="ruby-ivar">@options</span>.<span class="ruby-identifier">delete</span> <span class="ruby-identifier">:default_encoding</span>
65: 
66:       <span class="ruby-comment cmt"># load template data and prepare (uses binread to avoid encoding issues)</span>
67:       <span class="ruby-ivar">@reader</span> = <span class="ruby-identifier">block</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">lambda</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:binread</span>) <span class="ruby-operator">?</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">binread</span>(<span class="ruby-ivar">@file</span>) <span class="ruby-operator">:</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span>(<span class="ruby-ivar">@file</span>) }
68:       <span class="ruby-ivar">@data</span> = <span class="ruby-ivar">@reader</span>.<span class="ruby-identifier">call</span>(<span class="ruby-keyword kw">self</span>)
69:       <span class="ruby-identifier">prepare</span>
70:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Class Protected methods</div>
            
            <div class="method">
                <div class="title" id="M000119">
                    
                    <a name="M000119"></a><b>cached_evaluate</b>(scope, locals, &amp;block)
                    
                </div>
                
                <div class="description">
                  <p>
Redefine itself to use method compilation the next time:
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000119_source')" id="l_M000119_source">show</a>
                        
                    </p>
                    <div id="M000119_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/tilt/template.rb, line 138</span>
138:       <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">cached_evaluate</span>(<span class="ruby-identifier">scope</span>, <span class="ruby-identifier">locals</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
139:         <span class="ruby-identifier">method</span> = <span class="ruby-identifier">compiled_method</span>(<span class="ruby-identifier">locals</span>.<span class="ruby-identifier">keys</span>)
140:         <span class="ruby-identifier">method</span>.<span class="ruby-identifier">bind</span>(<span class="ruby-identifier">scope</span>).<span class="ruby-identifier">call</span>(<span class="ruby-identifier">locals</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
141:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M000107">
                    
                    <a name="M000107"></a><b>basename</b>(suffix='')
                    
                </div>
                
                <div class="description">
                  <p>
The basename of the template file.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000107_source')" id="l_M000107_source">show</a>
                        
                    </p>
                    <div id="M000107_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/tilt/template.rb, line 80</span>
80:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">basename</span>(<span class="ruby-identifier">suffix</span>=<span class="ruby-value str">''</span>)
81:       <span class="ruby-constant">File</span>.<span class="ruby-identifier">basename</span>(<span class="ruby-identifier">file</span>, <span class="ruby-identifier">suffix</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">file</span>
82:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000109">
                    
                    <a name="M000109"></a><b>eval_file</b>()
                    
                </div>
                
                <div class="description">
                  <p>
The filename used in backtraces to describe the template.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000109_source')" id="l_M000109_source">show</a>
                        
                    </p>
                    <div id="M000109_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/tilt/template.rb, line 90</span>
90:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">eval_file</span>
91:       <span class="ruby-identifier">file</span> <span class="ruby-operator">||</span> <span class="ruby-value str">'(__TEMPLATE__)'</span>
92:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000108">
                    
                    <a name="M000108"></a><b>name</b>()
                    
                </div>
                
                <div class="description">
                  <p>
The template file&#8217;s basename with all extensions chomped off.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000108_source')" id="l_M000108_source">show</a>
                        
                    </p>
                    <div id="M000108_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/tilt/template.rb, line 85</span>
85:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">name</span>
86:       <span class="ruby-identifier">basename</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">'.'</span>, <span class="ruby-value">2</span>).<span class="ruby-identifier">first</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">basename</span>
87:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000106">
                    
                    <a name="M000106"></a><b>render</b>(scope=Object.new, locals={}, &amp;block)
                    
                </div>
                
                <div class="description">
                  <p>
Render the template in the given scope with the locals specified. If a
block is given, it is typically available within the template via
<tt>yield</tt>.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000106_source')" id="l_M000106_source">show</a>
                        
                    </p>
                    <div id="M000106_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/tilt/template.rb, line 75</span>
75:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">render</span>(<span class="ruby-identifier">scope</span>=<span class="ruby-constant">Object</span>.<span class="ruby-identifier">new</span>, <span class="ruby-identifier">locals</span>={}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
76:       <span class="ruby-identifier">evaluate</span> <span class="ruby-identifier">scope</span>, <span class="ruby-identifier">locals</span> <span class="ruby-operator">||</span> {}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>
77:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Protected methods</div>
            
            <div class="method">
                <div class="title" id="M000118">
                    
                    <a name="M000118"></a><b>cached_evaluate</b>(scope, locals, &amp;block)
                    
                </div>
                
                <div class="description">
                  <p>
Process the template and return the result. The first time this method is
called, the template source is evaluated with instance_eval. On the
sequential method calls it will compile the template to an unbound method
which will lead to better performance. In any case, template executation is
guaranteed to be performed in the scope object with the locals specified
and with support for yielding to the block.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000118_source')" id="l_M000118_source">show</a>
                        
                    </p>
                    <div id="M000118_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/tilt/template.rb, line 136</span>
136:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">cached_evaluate</span>(<span class="ruby-identifier">scope</span>, <span class="ruby-identifier">locals</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
137:       <span class="ruby-comment cmt"># Redefine itself to use method compilation the next time:</span>
138:       <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">cached_evaluate</span>(<span class="ruby-identifier">scope</span>, <span class="ruby-identifier">locals</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
139:         <span class="ruby-identifier">method</span> = <span class="ruby-identifier">compiled_method</span>(<span class="ruby-identifier">locals</span>.<span class="ruby-identifier">keys</span>)
140:         <span class="ruby-identifier">method</span>.<span class="ruby-identifier">bind</span>(<span class="ruby-identifier">scope</span>).<span class="ruby-identifier">call</span>(<span class="ruby-identifier">locals</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
141:       <span class="ruby-keyword kw">end</span>
142: 
143:       <span class="ruby-comment cmt"># Use instance_eval the first time:</span>
144:       <span class="ruby-identifier">evaluate_source</span>(<span class="ruby-identifier">scope</span>, <span class="ruby-identifier">locals</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
145:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000124">
                    
                    <a name="M000124"></a><b>compiled_method</b>(locals_keys)
                    
                </div>
                
                <div class="description">
                  <p>
The compiled method for the locals keys provided.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000124_source')" id="l_M000124_source">show</a>
                        
                    </p>
                    <div id="M000124_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/tilt/template.rb, line 200</span>
200:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">compiled_method</span>(<span class="ruby-identifier">locals_keys</span>)
201:       <span class="ruby-ivar">@compiled_method</span>[<span class="ruby-identifier">locals_keys</span>] <span class="ruby-operator">||=</span>
202:         <span class="ruby-identifier">compile_template_method</span>(<span class="ruby-identifier">locals_keys</span>)
203:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000117">
                    
                    <a name="M000117"></a><b>evaluate</b>(scope, locals, &amp;block)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000117_source')" id="l_M000117_source">show</a>
                        
                    </p>
                    <div id="M000117_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/tilt/template.rb, line 126</span>
126:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">evaluate</span>(<span class="ruby-identifier">scope</span>, <span class="ruby-identifier">locals</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
127:       <span class="ruby-identifier">cached_evaluate</span>(<span class="ruby-identifier">scope</span>, <span class="ruby-identifier">locals</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
128:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000114">
                    
                    <a name="M000114"></a><b>initialize_engine</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Called once and only once for each template subclass the first time the
template class is initialized. This should be used to require the
underlying template library and perform any initial setup.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000114_source')" id="l_M000114_source">show</a>
                        
                    </p>
                    <div id="M000114_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/tilt/template.rb, line 98</span>
98:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize_engine</span>
99:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000120">
                    
                    <a name="M000120"></a><b>precompiled</b>(locals)
                    
                </div>
                
                <div class="description">
                  <p>
Generates all template source by combining the preamble, template, and
postamble and returns a two-tuple of the form: [source, offset], where
source is the string containing (Ruby) source code for the template and
offset is the integer line offset where line reporting should begin.
</p>
<p>
<a href="Template.html">Template</a> subclasses may override this method
when they need complete control over source generation or want to adjust
the default line offset. In most cases, overriding the <a
href="Template.html#M000121">precompiled_template</a> method is easier and
more appropriate.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000120_source')" id="l_M000120_source">show</a>
                        
                    </p>
                    <div id="M000120_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/tilt/template.rb, line 156</span>
156:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">precompiled</span>(<span class="ruby-identifier">locals</span>)
157:       <span class="ruby-identifier">preamble</span> = <span class="ruby-identifier">precompiled_preamble</span>(<span class="ruby-identifier">locals</span>)
158:       <span class="ruby-identifier">template</span> = <span class="ruby-identifier">precompiled_template</span>(<span class="ruby-identifier">locals</span>)
159:       <span class="ruby-identifier">magic_comment</span> = <span class="ruby-identifier">extract_magic_comment</span>(<span class="ruby-identifier">template</span>)
160:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">magic_comment</span>
161:         <span class="ruby-comment cmt"># Magic comment e.g. &quot;# coding: utf-8&quot; has to be in the first line.</span>
162:         <span class="ruby-comment cmt"># So we copy the magic comment to the first line.</span>
163:         <span class="ruby-identifier">preamble</span> = <span class="ruby-identifier">magic_comment</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;\n&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">preamble</span>
164:       <span class="ruby-keyword kw">end</span>
165:       <span class="ruby-identifier">parts</span> = [
166:         <span class="ruby-identifier">preamble</span>,
167:         <span class="ruby-identifier">template</span>,
168:         <span class="ruby-identifier">precompiled_postamble</span>(<span class="ruby-identifier">locals</span>)
169:       ]
170:       [<span class="ruby-identifier">parts</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;\n&quot;</span>), <span class="ruby-identifier">preamble</span>.<span class="ruby-identifier">count</span>(<span class="ruby-value str">&quot;\n&quot;</span>) <span class="ruby-operator">+</span> <span class="ruby-value">1</span>]
171:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000123">
                    
                    <a name="M000123"></a><b>precompiled_postamble</b>(locals)
                    
                </div>
                
                <div class="description">
                  <p>
Generates postamble code for the precompiled template source. The string
returned from this method is appended to the precompiled template source.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000123_source')" id="l_M000123_source">show</a>
                        
                    </p>
                    <div id="M000123_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/tilt/template.rb, line 195</span>
195:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">precompiled_postamble</span>(<span class="ruby-identifier">locals</span>)
196:       <span class="ruby-value str">''</span>
197:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000122">
                    
                    <a name="M000122"></a><b>precompiled_preamble</b>(locals)
                    
                </div>
                
                <div class="description">
                  <p>
Generates preamble code for initializing template state, and performing
locals assignment. The default implementation performs locals assignment
only. Lines included in the preamble are subtracted from the source line
offset, so adding code to the preamble does not effect line reporting in
Kernel::caller and backtraces.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000122_source')" id="l_M000122_source">show</a>
                        
                    </p>
                    <div id="M000122_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/tilt/template.rb, line 188</span>
188:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">precompiled_preamble</span>(<span class="ruby-identifier">locals</span>)
189:       <span class="ruby-identifier">locals</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-node">&quot;#{k} = locals[#{k.inspect}]&quot;</span> }.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;\n&quot;</span>)
190:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000121">
                    
                    <a name="M000121"></a><b>precompiled_template</b>(locals)
                    
                </div>
                
                <div class="description">
                  <p>
A string containing the (Ruby) source code for the template. The default <a
href="Template.html#M000117">Template#evaluate</a> implementation requires
either this method or the <a href="Template.html#M000120">precompiled</a>
method be overridden. When defined, the base <a
href="Template.html">Template</a> guarantees correct file/line handling,
locals support, custom scopes, and support for template compilation when
the scope object allows it.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000121_source')" id="l_M000121_source">show</a>
                        
                    </p>
                    <div id="M000121_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/tilt/template.rb, line 179</span>
179:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">precompiled_template</span>(<span class="ruby-identifier">locals</span>)
180:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">NotImplementedError</span>
181:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000116">
                    
                    <a name="M000116"></a><b>prepare</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Do whatever preparation is necessary to setup the underlying template
engine. Called immediately after template data is loaded. Instance
variables set in this method are available when <a
href="Template.html#M000117">evaluate</a> is called.
</p>
<p>
Subclasses must provide an implementation of this method.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000116_source')" id="l_M000116_source">show</a>
                        
                    </p>
                    <div id="M000116_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/tilt/template.rb, line 116</span>
116:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">prepare</span>
117:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:compile!</span>)
118:         <span class="ruby-comment cmt"># backward compat with tilt &lt; 0.6; just in case</span>
119:         <span class="ruby-identifier">warn</span> <span class="ruby-value str">'Tilt::Template#compile! is deprecated; implement #prepare instead.'</span>
120:         <span class="ruby-identifier">compile!</span>
121:       <span class="ruby-keyword kw">else</span>
122:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">NotImplementedError</span>
123:       <span class="ruby-keyword kw">end</span>
124:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000115">
                    
                    <a name="M000115"></a><b>require_template_library</b>(name)
                    
                </div>
                
                <div class="description">
                  <p>
Like Kernel::require but issues a warning urging a manual require when
running under a threaded environment.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000115_source')" id="l_M000115_source">show</a>
                        
                    </p>
                    <div id="M000115_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/tilt/template.rb, line 103</span>
103:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">require_template_library</span>(<span class="ruby-identifier">name</span>)
104:       <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">list</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>
105:         <span class="ruby-identifier">warn</span> <span class="ruby-node">&quot;WARN: tilt autoloading '#{name}' in a non thread-safe way; &quot;</span> <span class="ruby-operator">+</span>
106:              <span class="ruby-node">&quot;explicit require '#{name}' suggested.&quot;</span>
107:       <span class="ruby-keyword kw">end</span>
108:       <span class="ruby-identifier">require</span> <span class="ruby-identifier">name</span>
109:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Private methods</div>
            
            <div class="method">
                <div class="title" id="M000134">
                    
                    <a name="M000134"></a><b>compile_template_method</b>(locals)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000134_source')" id="l_M000134_source">show</a>
                        
                    </p>
                    <div id="M000134_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/tilt/template.rb, line 229</span>
229:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">compile_template_method</span>(<span class="ruby-identifier">locals</span>)
230:       <span class="ruby-identifier">source</span>, <span class="ruby-identifier">offset</span> = <span class="ruby-identifier">precompiled</span>(<span class="ruby-identifier">locals</span>)
231:       <span class="ruby-identifier">offset</span> <span class="ruby-operator">+=</span> <span class="ruby-value">5</span>
232:       <span class="ruby-identifier">method_name</span> = <span class="ruby-node">&quot;__tilt_#{Thread.current.object_id.abs}&quot;</span>
233:       <span class="ruby-constant">Object</span>.<span class="ruby-identifier">class_eval</span> <span class="ruby-value str">&quot;\#{extract_magic_comment source}\nTOPOBJECT.class_eval do\ndef \#{method_name}(locals)\nThread.current[:tilt_vars] = [self, locals]\nclass &lt;&lt; self\nthis, locals = Thread.current[:tilt_vars]\nthis.instance_eval do\n\#{source}\nend\nend\nend\nend\n&quot;</span>, <span class="ruby-identifier">eval_file</span>, <span class="ruby-identifier">line</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">offset</span>
234:       <span class="ruby-identifier">unbind_compiled_method</span>(<span class="ruby-identifier">method_name</span>)
235:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000138">
                    
                    <a name="M000138"></a><b>compile_template_method</b>(locals)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000138_source')" id="l_M000138_source">show</a>
                        
                    </p>
                    <div id="M000138_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/tilt/template.rb, line 271</span>
271:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">compile_template_method</span>(<span class="ruby-identifier">locals</span>)
272:         <span class="ruby-identifier">source</span>, <span class="ruby-identifier">offset</span> = <span class="ruby-identifier">precompiled</span>(<span class="ruby-identifier">locals</span>)
273:         <span class="ruby-identifier">offset</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
274:         <span class="ruby-identifier">method_name</span> = <span class="ruby-node">&quot;__tilt_#{Thread.current.object_id}&quot;</span>
275:         <span class="ruby-constant">Object</span>.<span class="ruby-identifier">class_eval</span> <span class="ruby-value str">&quot;TOPOBJECT.class_eval do\ndef \#{method_name}(locals)\n\#{source}\nend\nend\n&quot;</span>, <span class="ruby-identifier">eval_file</span>, <span class="ruby-identifier">line</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">offset</span>
276:         <span class="ruby-identifier">unbind_compiled_method</span>(<span class="ruby-identifier">method_name</span>)
277:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000128">
                    
                    <a name="M000128"></a><b>evaluate_source</b>(scope, locals, &amp;block)
                    
                </div>
                
                <div class="description">
                  <p>
Evaluate the template source in the context of the scope object.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000128_source')" id="l_M000128_source">show</a>
                        
                    </p>
                    <div id="M000128_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/tilt/template.rb, line 207</span>
207:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">evaluate_source</span>(<span class="ruby-identifier">scope</span>, <span class="ruby-identifier">locals</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
208:       <span class="ruby-identifier">source</span>, <span class="ruby-identifier">offset</span> = <span class="ruby-identifier">precompiled</span>(<span class="ruby-identifier">locals</span>)
209:       <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">instance_eval</span>(<span class="ruby-identifier">source</span>, <span class="ruby-identifier">eval_file</span>, <span class="ruby-identifier">line</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">offset</span>)
210:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000129">
                    
                    <a name="M000129"></a><b>evaluate_source</b>(scope, locals, &amp;block)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000129_source')" id="l_M000129_source">show</a>
                        
                    </p>
                    <div id="M000129_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/tilt/template.rb, line 222</span>
222:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">evaluate_source</span>(<span class="ruby-identifier">scope</span>, <span class="ruby-identifier">locals</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
223:         <span class="ruby-identifier">source</span>, <span class="ruby-identifier">offset</span> = <span class="ruby-identifier">precompiled</span>(<span class="ruby-identifier">locals</span>)
224:         <span class="ruby-identifier">file</span>, <span class="ruby-identifier">lineno</span> = <span class="ruby-identifier">eval_file</span>, (<span class="ruby-identifier">line</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">offset</span>)
225:         <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">instance_eval</span> { <span class="ruby-constant">Kernel</span><span class="ruby-operator">::</span><span class="ruby-identifier">eval</span>(<span class="ruby-identifier">source</span>, <span class="ruby-identifier">binding</span>, <span class="ruby-identifier">file</span>, <span class="ruby-identifier">lineno</span>) }
226:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000137">
                    
                    <a name="M000137"></a><b>extract_magic_comment</b>(script)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000137_source')" id="l_M000137_source">show</a>
                        
                    </p>
                    <div id="M000137_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/tilt/template.rb, line 257</span>
257:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">extract_magic_comment</span>(<span class="ruby-identifier">script</span>)
258:       <span class="ruby-identifier">comment</span> = <span class="ruby-identifier">script</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-regexp re">/\A[ \t]*\#.*coding\s*[=:]\s*([[:alnum:]\-_]+).*$/</span>)
259:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">comment</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">comment</span> <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">not</span> <span class="ruby-node">%w[ascii-8bit binary]</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">$1</span>.<span class="ruby-identifier">downcase</span>)
260:       <span class="ruby-node">&quot;# coding: #{@default_encoding}&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@default_encoding</span>
261:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000135">
                    
                    <a name="M000135"></a><b>unbind_compiled_method</b>(method_name)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000135_source')" id="l_M000135_source">show</a>
                        
                    </p>
                    <div id="M000135_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/tilt/template.rb, line 251</span>
251:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">unbind_compiled_method</span>(<span class="ruby-identifier">method_name</span>)
252:       <span class="ruby-identifier">method</span> = <span class="ruby-constant">TOPOBJECT</span>.<span class="ruby-identifier">instance_method</span>(<span class="ruby-identifier">method_name</span>)
253:       <span class="ruby-constant">TOPOBJECT</span>.<span class="ruby-identifier">class_eval</span> { <span class="ruby-identifier">remove_method</span>(<span class="ruby-identifier">method_name</span>) }
254:       <span class="ruby-identifier">method</span>
255:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    