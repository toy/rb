<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>SQLite3::Database</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../css/main.css" type="text/css" media="screen" />
    <script src="../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Class</span> 
            SQLite3::Database 
            
                <span class="parent">&lt; 
                    
                    Object
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../files/ext/sqlite3/sqlite3_c.html">ext/sqlite3/sqlite3.c</a></li>
            
            <li><a href="../../files/lib/sqlite3/database_rb.html">lib/sqlite3/database.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    
    <div class="description">
        <p>
The <a href="Database.html">Database</a> class encapsulates a single
connection to a <a href="../SQLite3.html">SQLite3</a> database. Its usage
is very straightforward:
</p>
<pre>
  require 'sqlite3'

  SQLite3::Database.new( &quot;data.db&quot; ) do |db|
    db.execute( &quot;select * from table&quot; ) do |row|
      p row
    end
  end
</pre>
<p>
It wraps the lower-level methods provides by the selected driver, and
includes the <a href="Pragmas.html">Pragmas</a> module for access to
various pragma convenience methods.
</p>
<p>
The <a href="Database.html">Database</a> class provides type translation
services as well, by which the <a href="../SQLite3.html">SQLite3</a> data
types (which are all represented as strings) may be converted into their
corresponding types (as defined in the schemas for their tables). This
translation only occurs when querying data from the
database&#8212;insertions and updates are all still typeless.
</p>
<p>
Furthermore, the <a href="Database.html">Database</a> class has been
designed to work well with the ArrayFields module from Ara Howard. If you
require the ArrayFields module before performing a query, and if you have
not enabled results as hashes, then the results will all be indexible by
field name.
</p>

    </div>
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>A</dt>
        <dd>
            <ul>
                
                <li><a href="#M000045">authorizer</a>,</li>
                
                <li><a href="#M000033">authorizer=</a></li>
                
            </ul>
        </dd>
    
        <dt>B</dt>
        <dd>
            <ul>
                
                <li><a href="#M000034">busy_handler</a>,</li>
                
                <li><a href="#M000065">busy_timeout</a>,</li>
                
                <li><a href="#M000035">busy_timeout=</a></li>
                
            </ul>
        </dd>
    
        <dt>C</dt>
        <dd>
            <ul>
                
                <li><a href="#M000032">changes</a>,</li>
                
                <li><a href="#M000021">close</a>,</li>
                
                <li><a href="#M000022">closed?</a>,</li>
                
                <li><a href="#M000020">collation</a>,</li>
                
                <li><a href="#M000103">commit</a>,</li>
                
                <li><a href="#M000031">complete?</a>,</li>
                
                <li><a href="#M000073">create_aggregate</a>,</li>
                
                <li><a href="#M000090">create_aggregate_handler</a>,</li>
                
                <li><a href="#M000066">create_function</a></li>
                
            </ul>
        </dd>
    
        <dt>D</dt>
        <dd>
            <ul>
                
                <li><a href="#M000027">define_aggregator</a>,</li>
                
                <li><a href="#M000026">define_function</a></li>
                
            </ul>
        </dd>
    
        <dt>E</dt>
        <dd>
            <ul>
                
                <li><a href="#M000038">enable_load_extension</a>,</li>
                
                <li><a href="#M000039">encoding</a>,</li>
                
                <li><a href="#M000030">errcode</a>,</li>
                
                <li><a href="#M000029">errmsg</a>,</li>
                
                <li><a href="#M000047">execute</a>,</li>
                
                <li><a href="#M000048">execute2</a>,</li>
                
                <li><a href="#M000051">execute_batch</a></li>
                
            </ul>
        </dd>
    
        <dt>F</dt>
        <dd>
            <ul>
                
                <li><a href="#M000087">finalize</a>,</li>
                
                <li><a href="#M000099">finalize</a>,</li>
                
                <li><a href="#M000080">finalize</a></li>
                
            </ul>
        </dd>
    
        <dt>G</dt>
        <dd>
            <ul>
                
                <li><a href="#M000058">get_first_row</a>,</li>
                
                <li><a href="#M000059">get_first_value</a></li>
                
            </ul>
        </dd>
    
        <dt>I</dt>
        <dd>
            <ul>
                
                <li><a href="#M000028">interrupt</a></li>
                
            </ul>
        </dd>
    
        <dt>L</dt>
        <dd>
            <ul>
                
                <li><a href="#M000025">last_insert_row_id</a>,</li>
                
                <li><a href="#M000037">load_extension</a></li>
                
            </ul>
        </dd>
    
        <dt>N</dt>
        <dd>
            <ul>
                
                <li><a href="#M000019">new</a>,</li>
                
                <li><a href="#M000097">new</a></li>
                
            </ul>
        </dd>
    
        <dt>O</dt>
        <dd>
            <ul>
                
                <li><a href="#M000112">ordered_map_for</a></li>
                
            </ul>
        </dd>
    
        <dt>P</dt>
        <dd>
            <ul>
                
                <li><a href="#M000046">prepare</a></li>
                
            </ul>
        </dd>
    
        <dt>Q</dt>
        <dd>
            <ul>
                
                <li><a href="#M000055">query</a>,</li>
                
                <li><a href="#M000042">quote</a></li>
                
            </ul>
        </dd>
    
        <dt>R</dt>
        <dd>
            <ul>
                
                <li><a href="#M000105">readonly?</a>,</li>
                
                <li><a href="#M000104">rollback</a></li>
                
            </ul>
        </dd>
    
        <dt>S</dt>
        <dd>
            <ul>
                
                <li><a href="#M000098">step</a>,</li>
                
                <li><a href="#M000079">step</a>,</li>
                
                <li><a href="#M000081">step</a></li>
                
            </ul>
        </dd>
    
        <dt>T</dt>
        <dd>
            <ul>
                
                <li><a href="#M000023">total_changes</a>,</li>
                
                <li><a href="#M000024">trace</a>,</li>
                
                <li><a href="#M000101">transaction</a>,</li>
                
                <li><a href="#M000036">transaction_active?</a>,</li>
                
                <li><a href="#M000044">translator</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    
    <div class="sectiontitle">Included Modules</div>
    <ul>
        
        <li>
            
            <a href="../SQLite3.html">SQLite3</a>
            
            START:includes
        </li>
        
    </ul>
    

    

    
    <div class="sectiontitle">Classes and Modules</div>
    <ul>
        
        <li><span class="type">CLASS</span> <a href="Database/FunctionProxy.html">SQLite3::Database::FunctionProxy</a></li>
        
    </ul>
    

    

    
    <div class="sectiontitle">Attributes</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>collations</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>results_as_hash</td>
            <td class='attr-desc'><p>
A boolean that indicates whether rows in result sets should be returned as
hashes or not. By default, rows are returned as arrays.
</p></td>
        </tr>
        
    </table>
    

    
            <div class="sectiontitle">Class Public methods</div>
            
            <div class="method">
                <div class="title" id="M000080">
                    
                    <a name="M000080"></a><b>finalize</b>( &amp;block )
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000080_source')" id="l_M000080_source">show</a>
                        
                    </p>
                    <div id="M000080_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/sqlite3/database.rb, line 376</span>
376:         <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">finalize</span>( <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span> )
377:           <span class="ruby-identifier">define_method</span>(<span class="ruby-identifier">:finalize</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
378:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000019">
                    
                    <a name="M000019"></a><b> SQLite3::Database.new(file, options = {})
</b>
                    
                </div>
                
                <div class="description">
                  <p>
Create a new <a href="Database.html">Database</a> object that opens the
given file. If utf16 is <tt>true</tt>, the filename is interpreted as a
UTF-16 encoded string.
</p>
<p>
By default, the new database will return result rows as arrays (<a
href="Database.html#results_as_hash">results_as_hash</a>) and has type
translation disabled (type_translation=).
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000019_source')" id="l_M000019_source">show</a>
                        
                    </p>
                    <div id="M000019_source" class="dyn-source">
                        <pre>static VALUE initialize(int argc, VALUE *argv, VALUE self)
{
  sqlite3RubyPtr ctx;
  VALUE file;
  VALUE opts;
  VALUE zvfs;
  int mode = SQLITE_OPEN_READWRITE | SQLITE_OPEN_CREATE;
  int status;

  Data_Get_Struct(self, sqlite3Ruby, ctx);

  rb_scan_args(argc, argv, &quot;12&quot;, &amp;file, &amp;opts, &amp;zvfs);
#if defined StringValueCStr
  StringValuePtr(file);
  rb_check_safe_obj(file);
#else
  Check_SafeStr(file);
#endif
  if(NIL_P(opts)) opts = rb_hash_new();
  else Check_Type(opts, T_HASH);

#ifdef HAVE_RUBY_ENCODING_H
  if(UTF16_LE_P(file)) {
    status = sqlite3_open16(utf16_string_value_ptr(file), &amp;ctx-&gt;db);
  } else {
#endif

    if(Qtrue == rb_hash_aref(opts, sym_utf16)) {
      status = sqlite3_open16(utf16_string_value_ptr(file), &amp;ctx-&gt;db);
    } else {

#ifdef HAVE_RUBY_ENCODING_H
      if(!UTF8_P(file)) {
        file = rb_str_export_to_enc(file, rb_utf8_encoding());
      }
#endif

      if (Qtrue == rb_hash_aref(opts, ID2SYM(rb_intern(&quot;readonly&quot;)))) {
        mode = SQLITE_OPEN_READONLY;
      }
      status = sqlite3_open_v2(
          StringValuePtr(file),
          &amp;ctx-&gt;db,
          mode,
          NIL_P(zvfs) ? NULL : StringValuePtr(zvfs)
      );
    }

#ifdef HAVE_RUBY_ENCODING_H
  }
#endif

  CHECK(ctx-&gt;db, status)

  rb_iv_set(self, &quot;@tracefunc&quot;, Qnil);
  rb_iv_set(self, &quot;@authorizer&quot;, Qnil);
  rb_iv_set(self, &quot;@encoding&quot;, Qnil);
  rb_iv_set(self, &quot;@busy_handler&quot;, Qnil);
  rb_iv_set(self, &quot;@collations&quot;, rb_hash_new());
  rb_iv_set(self, &quot;@functions&quot;, rb_hash_new());
  rb_iv_set(self, &quot;@results_as_hash&quot;, rb_hash_aref(opts, sym_results_as_hash));
  rb_iv_set(self, &quot;@type_translation&quot;, rb_hash_aref(opts, sym_type_translation));
  rb_iv_set(self, &quot;@readonly&quot;, mode == SQLITE_OPEN_READONLY ? Qtrue : Qfalse);

  if(rb_block_given_p()) {
    rb_yield(self);
    rb_funcall(self, rb_intern(&quot;close&quot;), 0);
  }

  return self;
}</pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000097">
                    
                    <a name="M000097"></a><b>new</b>(handler)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000097_source')" id="l_M000097_source">show</a>
                        
                    </p>
                    <div id="M000097_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/sqlite3/database.rb, line 454</span>
454:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span> <span class="ruby-identifier">handler</span>
455:           <span class="ruby-ivar">@handler</span>  = <span class="ruby-identifier">handler</span>
456:           <span class="ruby-ivar">@fp</span>       = <span class="ruby-constant">FunctionProxy</span>.<span class="ruby-identifier">new</span>
457:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000042">
                    
                    <a name="M000042"></a><b>quote</b>( string )
                    
                </div>
                
                <div class="description">
                  <p>
Quotes the given string, making it safe to use in an SQL statement. It
replaces all instances of the single-quote character with two single-quote
characters. The modified string is returned.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000042_source')" id="l_M000042_source">show</a>
                        
                    </p>
                    <div id="M000042_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/sqlite3/database.rb, line 47</span>
47:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">quote</span>( <span class="ruby-identifier">string</span> )
48:         <span class="ruby-identifier">string</span>.<span class="ruby-identifier">gsub</span>( <span class="ruby-regexp re">/'/</span>, <span class="ruby-value str">&quot;''&quot;</span> )
49:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000079">
                    
                    <a name="M000079"></a><b>step</b>( &amp;block )
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000079_source')" id="l_M000079_source">show</a>
                        
                    </p>
                    <div id="M000079_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/sqlite3/database.rb, line 372</span>
372:         <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">step</span>( <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span> )
373:           <span class="ruby-identifier">define_method</span>(<span class="ruby-identifier">:step</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
374:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M000045">
                    
                    <a name="M000045"></a><b>authorizer</b>( &amp;block )
                    
                </div>
                
                <div class="description">
                  <p>
Installs (or removes) a block that will be invoked for every access to the
database. If the block returns 0 (or <tt>nil</tt>), the statement is
allowed to proceed. Returning 1 causes an authorization error to occur, and
returning 2 causes the access to be silently denied.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000045_source')" id="l_M000045_source">show</a>
                        
                    </p>
                    <div id="M000045_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/sqlite3/database.rb, line 82</span>
82:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">authorizer</span>( <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span> )
83:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">authorizer</span> = <span class="ruby-identifier">block</span>
84:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000033">
                    
                    <a name="M000033"></a><b> set_authorizer = auth
</b>
                    
                </div>
                
                <div class="description">
                  <p>
Set the authorizer for this database. <tt>auth</tt> must respond to
<tt>call</tt>, and <tt>call</tt> must take 5 arguments.
</p>
<p>
Installs (or removes) a block that will be invoked for every access to the
database. If the block returns 0 (or <tt>true</tt>), the statement is
allowed to proceed. Returning 1 or false causes an authorization error to
occur, and returning 2 or nil causes the access to be silently denied.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000033_source')" id="l_M000033_source">show</a>
                        
                    </p>
                    <div id="M000033_source" class="dyn-source">
                        <pre>static VALUE set_authorizer(VALUE self, VALUE authorizer)
{
  sqlite3RubyPtr ctx;
  int status;

  Data_Get_Struct(self, sqlite3Ruby, ctx);
  REQUIRE_OPEN_DB(ctx);

  status = sqlite3_set_authorizer(
      ctx-&gt;db, NIL_P(authorizer) ? NULL : rb_sqlite3_auth, (void *)self
  );

  CHECK(ctx-&gt;db, status);

  rb_iv_set(self, &quot;@authorizer&quot;, authorizer);

  return self;
}</pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000034">
                    
                    <a name="M000034"></a><b>busy_handler { |count| ... }
busy_handler(Class.new { def call count; end }.new)
</b>
                    
                </div>
                
                <div class="description">
                  <p>
Register a busy handler with this database instance. When a requested
resource is busy, this handler will be invoked. If the handler returns
<tt>false</tt>, the operation will be aborted; otherwise, the resource will
be requested again.
</p>
<p>
The handler will be invoked with the name of the resource that was busy,
and the number of times it has been retried.
</p>
<p>
See also the mutually exclusive <a
href="Database.html#M000065">busy_timeout</a>.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000034_source')" id="l_M000034_source">show</a>
                        
                    </p>
                    <div id="M000034_source" class="dyn-source">
                        <pre>static VALUE busy_handler(int argc, VALUE *argv, VALUE self)
{
  sqlite3RubyPtr ctx;
  VALUE block;
  int status;

  Data_Get_Struct(self, sqlite3Ruby, ctx);
  REQUIRE_OPEN_DB(ctx);

  rb_scan_args(argc, argv, &quot;01&quot;, &amp;block);

  if(NIL_P(block) &amp;&amp; rb_block_given_p()) block = rb_block_proc();

  rb_iv_set(self, &quot;@busy_handler&quot;, block);

  status = sqlite3_busy_handler(
      ctx-&gt;db, NIL_P(block) ? NULL : rb_sqlite3_busy_handler, (void *)self);

  CHECK(ctx-&gt;db, status);

  return self;
}</pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000065">
                    
                    <a name="M000065"></a><b>busy_timeout</b>(p1)
                    
                </div>
                
                <div class="description">
                  <p>
Alias for <a href="Database.html#M000035">busy_timeout=</a>
</p>

                </div>
                
                
                
            </div>
            
            <div class="method">
                <div class="title" id="M000035">
                    
                    <a name="M000035"></a><b> db.busy_timeout = ms
</b>
                    
                </div>
                
                <div class="description">
                  <p>
Indicates that if a request for a resource terminates because that resource
is busy, SQLite should sleep and retry for up to the indicated number of
milliseconds. By default, SQLite does not retry busy resources. To restore
the default behavior, send 0 as the <tt>ms</tt> parameter.
</p>
<p>
See also the mutually exclusive <a
href="Database.html#M000034">busy_handler</a>.
</p>

                </div>
                
                
                <div class="aka">
                    This method is also aliased as
                    
                    <a href="Database.html#M000065">busy_timeout</a>
                    
                </div>
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000035_source')" id="l_M000035_source">show</a>
                        
                    </p>
                    <div id="M000035_source" class="dyn-source">
                        <pre>static VALUE set_busy_timeout(VALUE self, VALUE timeout)
{
  sqlite3RubyPtr ctx;
  Data_Get_Struct(self, sqlite3Ruby, ctx);
  REQUIRE_OPEN_DB(ctx);

  CHECK(ctx-&gt;db, sqlite3_busy_timeout(ctx-&gt;db, (int)NUM2INT(timeout)));

  return self;
}</pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000032">
                    
                    <a name="M000032"></a><b> changes
</b>
                    
                </div>
                
                <div class="description">
                  <p>
Returns the number of changes made to this database instance by the last
operation performed. Note that a &#8220;delete from table&#8221; without a
where clause will not affect this value.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000032_source')" id="l_M000032_source">show</a>
                        
                    </p>
                    <div id="M000032_source" class="dyn-source">
                        <pre>static VALUE changes(VALUE self)
{
  sqlite3RubyPtr ctx;
  Data_Get_Struct(self, sqlite3Ruby, ctx);
  REQUIRE_OPEN_DB(ctx);

  return INT2NUM(sqlite3_changes(ctx-&gt;db));
}</pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000021">
                    
                    <a name="M000021"></a><b> db.close
</b>
                    
                </div>
                
                <div class="description">
                  <p>
Closes this database.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000021_source')" id="l_M000021_source">show</a>
                        
                    </p>
                    <div id="M000021_source" class="dyn-source">
                        <pre>static VALUE sqlite3_rb_close(VALUE self)
{
  sqlite3RubyPtr ctx;
  sqlite3 * db;
  Data_Get_Struct(self, sqlite3Ruby, ctx);

  db = ctx-&gt;db;
  CHECK(db, sqlite3_close(ctx-&gt;db));

  ctx-&gt;db = NULL;

  return self;
}</pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000022">
                    
                    <a name="M000022"></a><b> db.closed?
</b>
                    
                </div>
                
                <div class="description">
                  <p>
Returns <tt>true</tt> if this database instance has been closed (see <a
href="Database.html#M000021">close</a>).
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000022_source')" id="l_M000022_source">show</a>
                        
                    </p>
                    <div id="M000022_source" class="dyn-source">
                        <pre>static VALUE closed_p(VALUE self)
{
  sqlite3RubyPtr ctx;
  Data_Get_Struct(self, sqlite3Ruby, ctx);

  if(!ctx-&gt;db) return Qtrue;

  return Qfalse;
}</pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000020">
                    
                    <a name="M000020"></a><b> db.collation(name, comparator)
</b>
                    
                </div>
                
                <div class="description">
                  <p>
Add a collation with name <tt>name</tt>, and a <tt>comparator</tt> object.
The <tt>comparator</tt> object should implement a method called
&#8220;compare&#8221; that takes two parameters and returns an integer less
than, equal to, or greater than 0.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000020_source')" id="l_M000020_source">show</a>
                        
                    </p>
                    <div id="M000020_source" class="dyn-source">
                        <pre>static VALUE collation(VALUE self, VALUE name, VALUE comparator)
{
  sqlite3RubyPtr ctx;
  Data_Get_Struct(self, sqlite3Ruby, ctx);
  REQUIRE_OPEN_DB(ctx);

  CHECK(ctx-&gt;db, sqlite3_create_collation_v2(
        ctx-&gt;db,
        StringValuePtr(name),
        SQLITE_UTF8,
        (void *)comparator,
        NIL_P(comparator) ? NULL : rb_comparator_func,
        NULL));

  /* Make sure our comparator doesn't get garbage collected. */
  rb_hash_aset(rb_iv_get(self, &quot;@collations&quot;), name, comparator);

  return self;
}</pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000103">
                    
                    <a name="M000103"></a><b>commit</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Commits the current transaction. If there is no current transaction, this
will cause an error to be raised. This returns <tt>true</tt>, in order to
allow it to be used in idioms like <tt>abort? and rollback or commit</tt>.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000103_source')" id="l_M000103_source">show</a>
                        
                    </p>
                    <div id="M000103_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/sqlite3/database.rb, line 510</span>
510:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">commit</span>
511:       <span class="ruby-identifier">execute</span> <span class="ruby-value str">&quot;commit transaction&quot;</span>
512:       <span class="ruby-keyword kw">true</span>
513:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000031">
                    
                    <a name="M000031"></a><b> complete?(sql)
</b>
                    
                </div>
                
                <div class="description">
                  <p>
Return <tt>true</tt> if the string is a valid (ie, parsable) SQL statement,
and <tt>false</tt> otherwise.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000031_source')" id="l_M000031_source">show</a>
                        
                    </p>
                    <div id="M000031_source" class="dyn-source">
                        <pre>static VALUE complete_p(VALUE UNUSED(self), VALUE sql)
{
  if(sqlite3_complete(StringValuePtr(sql)))
    return Qtrue;

  return Qfalse;
}</pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000073">
                    
                    <a name="M000073"></a><b>create_aggregate</b>( name, arity, step=nil, finalize=nil, text_rep=Constants::TextRep::ANY, &amp;block )
                    
                </div>
                
                <div class="description">
                  <p>
Creates a new aggregate function for use in SQL statements. Aggregate
functions are functions that apply over every row in the result set,
instead of over just a single row. (A very common aggregate function is the
&#8220;count&#8221; function, for determining the number of rows that match
a query.)
</p>
<p>
The new function will be added as <tt>name</tt>, with the given
<tt>arity</tt>. (For variable arity functions, use -1 for the arity.)
</p>
<p>
The <tt>step</tt> parameter must be a proc object that accepts as its first
parameter a <a href="Database/FunctionProxy.html">FunctionProxy</a>
instance (representing the function invocation), with any subsequent
parameters (up to the function&#8217;s arity). The <tt>step</tt> callback
will be invoked once for each row of the result set.
</p>
<p>
The <tt>finalize</tt> parameter must be a <tt>proc</tt> object that accepts
only a single parameter, the <a
href="Database/FunctionProxy.html">FunctionProxy</a> instance representing
the current function invocation. It should invoke FunctionProxy#result= to
store the result of the function.
</p>
<p>
Example:
</p>
<pre>
  db.create_aggregate( &quot;lengths&quot;, 1 ) do
    step do |func, value|
      func[ :total ] ||= 0
      func[ :total ] += ( value ? value.length : 0 )
    end

    finalize do |func|
      func.result = func[ :total ] || 0
    end
  end

  puts db.get_first_value( &quot;select lengths(name) from table&quot; )
</pre>
<p>
See also <a href="Database.html#M000090">create_aggregate_handler</a> for a
more object-oriented approach to aggregate functions.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000073_source')" id="l_M000073_source">show</a>
                        
                    </p>
                    <div id="M000073_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/sqlite3/database.rb, line 368</span>
368:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create_aggregate</span>( <span class="ruby-identifier">name</span>, <span class="ruby-identifier">arity</span>, <span class="ruby-identifier">step</span>=<span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">finalize</span>=<span class="ruby-keyword kw">nil</span>,
369:       <span class="ruby-identifier">text_rep</span>=<span class="ruby-constant">Constants</span><span class="ruby-operator">::</span><span class="ruby-constant">TextRep</span><span class="ruby-operator">::</span><span class="ruby-constant">ANY</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span> )
370: 
371:       <span class="ruby-identifier">factory</span> = <span class="ruby-constant">Class</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword kw">do</span>
372:         <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">step</span>( <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span> )
373:           <span class="ruby-identifier">define_method</span>(<span class="ruby-identifier">:step</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
374:         <span class="ruby-keyword kw">end</span>
375: 
376:         <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">finalize</span>( <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span> )
377:           <span class="ruby-identifier">define_method</span>(<span class="ruby-identifier">:finalize</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
378:         <span class="ruby-keyword kw">end</span>
379:       <span class="ruby-keyword kw">end</span>
380: 
381:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block_given?</span>
382:         <span class="ruby-identifier">factory</span>.<span class="ruby-identifier">instance_eval</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
383:       <span class="ruby-keyword kw">else</span>
384:         <span class="ruby-identifier">factory</span>.<span class="ruby-identifier">class_eval</span> <span class="ruby-keyword kw">do</span>
385:           <span class="ruby-identifier">define_method</span>(<span class="ruby-identifier">:step</span>, <span class="ruby-identifier">step</span>)
386:           <span class="ruby-identifier">define_method</span>(<span class="ruby-identifier">:finalize</span>, <span class="ruby-identifier">finalize</span>)
387:         <span class="ruby-keyword kw">end</span>
388:       <span class="ruby-keyword kw">end</span>
389: 
390:       <span class="ruby-identifier">proxy</span> = <span class="ruby-identifier">factory</span>.<span class="ruby-identifier">new</span>
391:       <span class="ruby-identifier">proxy</span>.<span class="ruby-identifier">extend</span>(<span class="ruby-constant">Module</span>.<span class="ruby-identifier">new</span> {
392:         <span class="ruby-identifier">attr_accessor</span> <span class="ruby-identifier">:ctx</span>
393: 
394:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">step</span>( <span class="ruby-operator">*</span><span class="ruby-identifier">args</span> )
395:           <span class="ruby-keyword kw">super</span>(<span class="ruby-ivar">@ctx</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
396:         <span class="ruby-keyword kw">end</span>
397: 
398:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">finalize</span>
399:           <span class="ruby-keyword kw">super</span>(<span class="ruby-ivar">@ctx</span>)
400:         <span class="ruby-keyword kw">end</span>
401:       })
402:       <span class="ruby-identifier">proxy</span>.<span class="ruby-identifier">ctx</span> = <span class="ruby-constant">FunctionProxy</span>.<span class="ruby-identifier">new</span>
403:       <span class="ruby-identifier">define_aggregator</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">proxy</span>)
404:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000090">
                    
                    <a name="M000090"></a><b>create_aggregate_handler</b>( handler )
                    
                </div>
                
                <div class="description">
                  <p>
This is another approach to creating an aggregate function (see <a
href="Database.html#M000073">create_aggregate</a>). Instead of explicitly
specifying the name, callbacks, arity, and type, you specify a factory
object (the &#8220;handler&#8221;) that knows how to obtain all of that
information. The handler should respond to the following messages:
</p>
<table>
<tr><td valign="top"><tt>arity</tt>:</td><td>corresponds to the <tt>arity</tt> parameter of <a
href="Database.html#M000073">create_aggregate</a>. This message is
optional, and if the handler does not respond to it, the function will have
an arity of -1.

</td></tr>
<tr><td valign="top"><tt>name</tt>:</td><td>this is the name of the function. The handler <em>must</em> implement this
message.

</td></tr>
<tr><td valign="top"><tt>new</tt>:</td><td>this must be implemented by the handler. It should return a new instance of
the object that will handle a specific invocation of the function.

</td></tr>
</table>
<p>
The handler instance (the object returned by the <tt>new</tt> message,
described above), must respond to the following messages:
</p>
<table>
<tr><td valign="top"><tt>step</tt>:</td><td>this is the method that will be called for each step of the aggregate
function&#8217;s evaluation. It should implement the same signature as the
<tt>step</tt> callback for <a
href="Database.html#M000073">create_aggregate</a>.

</td></tr>
<tr><td valign="top"><tt>finalize</tt>:</td><td>this is the method that will be called to finalize the aggregate
function&#8217;s evaluation. It should implement the same signature as the
<tt>finalize</tt> callback for <a
href="Database.html#M000073">create_aggregate</a>.

</td></tr>
</table>
<p>
Example:
</p>
<pre>
  class LengthsAggregateHandler
    def self.arity; 1; end

    def initialize
      @total = 0
    end

    def step( ctx, name )
      @total += ( name ? name.length : 0 )
    end

    def finalize( ctx )
      ctx.result = @total
    end
  end

  db.create_aggregate_handler( LengthsAggregateHandler )
  puts db.get_first_value( &quot;select lengths(name) from A&quot; )
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000090_source')" id="l_M000090_source">show</a>
                        
                    </p>
                    <div id="M000090_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/sqlite3/database.rb, line 452</span>
452:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create_aggregate_handler</span>( <span class="ruby-identifier">handler</span> )
453:       <span class="ruby-identifier">proxy</span> = <span class="ruby-constant">Class</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword kw">do</span>
454:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span> <span class="ruby-identifier">handler</span>
455:           <span class="ruby-ivar">@handler</span>  = <span class="ruby-identifier">handler</span>
456:           <span class="ruby-ivar">@fp</span>       = <span class="ruby-constant">FunctionProxy</span>.<span class="ruby-identifier">new</span>
457:         <span class="ruby-keyword kw">end</span>
458: 
459:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">step</span>( <span class="ruby-operator">*</span><span class="ruby-identifier">args</span> )
460:           <span class="ruby-ivar">@handler</span>.<span class="ruby-identifier">step</span>(<span class="ruby-ivar">@fp</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
461:         <span class="ruby-keyword kw">end</span>
462: 
463:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">finalize</span>
464:           <span class="ruby-ivar">@handler</span>.<span class="ruby-identifier">finalize</span> <span class="ruby-ivar">@fp</span>
465:           <span class="ruby-ivar">@fp</span>.<span class="ruby-identifier">result</span>
466:         <span class="ruby-keyword kw">end</span>
467:       <span class="ruby-keyword kw">end</span>
468:       <span class="ruby-identifier">define_aggregator</span>(<span class="ruby-identifier">handler</span>.<span class="ruby-identifier">name</span>, <span class="ruby-identifier">proxy</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">handler</span>.<span class="ruby-identifier">new</span>))
469:       <span class="ruby-keyword kw">self</span>
470:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000066">
                    
                    <a name="M000066"></a><b>create_function</b>(name, arity, text_rep=Constants::TextRep::ANY, &amp;block)
                    
                </div>
                
                <div class="description">
                  <p>
Creates a new function for use in SQL statements. It will be added as
<tt>name</tt>, with the given <tt>arity</tt>. (For variable arity
functions, use -1 for the arity.)
</p>
<p>
The block should accept at least one parameter&#8212;the <a
href="Database/FunctionProxy.html">FunctionProxy</a> instance that wraps
this function invocation&#8212;and any other arguments it needs (up to its
arity).
</p>
<p>
The block does not return a value directly. Instead, it will invoke the
FunctionProxy#result= method on the <tt>func</tt> parameter and indicate
the return value that way.
</p>
<p>
Example:
</p>
<pre>
  db.create_function( &quot;maim&quot;, 1 ) do |func, value|
    if value.nil?
      func.result = nil
    else
      func.result = value.split(//).sort.join
    end
  end

  puts db.get_first_value( &quot;select maim(name) from table&quot; )
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000066_source')" id="l_M000066_source">show</a>
                        
                    </p>
                    <div id="M000066_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/sqlite3/database.rb, line 323</span>
323:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create_function</span> <span class="ruby-identifier">name</span>, <span class="ruby-identifier">arity</span>, <span class="ruby-identifier">text_rep</span>=<span class="ruby-constant">Constants</span><span class="ruby-operator">::</span><span class="ruby-constant">TextRep</span><span class="ruby-operator">::</span><span class="ruby-constant">ANY</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>
324:       <span class="ruby-identifier">define_function</span>(<span class="ruby-identifier">name</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-operator">*</span><span class="ruby-identifier">args</span><span class="ruby-operator">|</span>
325:         <span class="ruby-identifier">fp</span> = <span class="ruby-constant">FunctionProxy</span>.<span class="ruby-identifier">new</span>
326:         <span class="ruby-identifier">block</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">fp</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
327:         <span class="ruby-identifier">fp</span>.<span class="ruby-identifier">result</span>
328:       <span class="ruby-keyword kw">end</span>
329:       <span class="ruby-keyword kw">self</span>
330:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000027">
                    
                    <a name="M000027"></a><b> define_aggregator(name, aggregator)
</b>
                    
                </div>
                
                <div class="description">
                  <p>
Define an aggregate function named <tt>name</tt> using the object
<tt>aggregator</tt>. <tt>aggregator</tt> must respond to <tt>step</tt> and
<tt>finalize</tt>. <tt>step</tt> will be called with row information and
<tt>finalize</tt> must return the return value for the aggregator function.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000027_source')" id="l_M000027_source">show</a>
                        
                    </p>
                    <div id="M000027_source" class="dyn-source">
                        <pre>static VALUE define_aggregator(VALUE self, VALUE name, VALUE aggregator)
{
  sqlite3RubyPtr ctx;
  int arity, status;

  Data_Get_Struct(self, sqlite3Ruby, ctx);
  REQUIRE_OPEN_DB(ctx);

  arity = sqlite3_obj_method_arity(aggregator, rb_intern(&quot;step&quot;));

  status = sqlite3_create_function(
    ctx-&gt;db,
    StringValuePtr(name),
    arity,
    SQLITE_UTF8,
    (void *)aggregator,
    NULL,
    rb_sqlite3_step,
    rb_sqlite3_final
  );

  rb_iv_set(self, &quot;@agregator&quot;, aggregator);

  CHECK(ctx-&gt;db, status);

  return self;
}</pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000026">
                    
                    <a name="M000026"></a><b> define_function(name) { |args,...| }
</b>
                    
                </div>
                
                <div class="description">
                  <p>
Define a function named <tt>name</tt> with <tt>args</tt>. The arity of the
block will be used as the arity for the function defined.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000026_source')" id="l_M000026_source">show</a>
                        
                    </p>
                    <div id="M000026_source" class="dyn-source">
                        <pre>static VALUE define_function(VALUE self, VALUE name)
{
  sqlite3RubyPtr ctx;
  VALUE block;
  int status;

  Data_Get_Struct(self, sqlite3Ruby, ctx);
  REQUIRE_OPEN_DB(ctx);

  block = rb_block_proc();

  status = sqlite3_create_function(
    ctx-&gt;db,
    StringValuePtr(name),
    rb_proc_arity(block),
    SQLITE_UTF8,
    (void *)block,
    rb_sqlite3_func,
    NULL,
    NULL
  );

  CHECK(ctx-&gt;db, status);

  rb_hash_aset(rb_iv_get(self, &quot;@functions&quot;), name, block);

  return self;
}</pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000038">
                    
                    <a name="M000038"></a><b> db.enable_load_extension(onoff)
</b>
                    
                </div>
                
                <div class="description">
                  <p>
Enable or disable extension loading.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000038_source')" id="l_M000038_source">show</a>
                        
                    </p>
                    <div id="M000038_source" class="dyn-source">
                        <pre>static VALUE enable_load_extension(VALUE self, VALUE onoff)
{
  sqlite3RubyPtr ctx;
  Data_Get_Struct(self, sqlite3Ruby, ctx);
  REQUIRE_OPEN_DB(ctx);

  CHECK(ctx-&gt;db, sqlite3_enable_load_extension(ctx-&gt;db, (int)NUM2INT(onoff)));

  return self;
}</pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000039">
                    
                    <a name="M000039"></a><b> db.encoding
</b>
                    
                </div>
                
                <div class="description">
                  <p>
Fetch the encoding set on this database
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000039_source')" id="l_M000039_source">show</a>
                        
                    </p>
                    <div id="M000039_source" class="dyn-source">
                        <pre>static VALUE db_encoding(VALUE self)
{
  sqlite3RubyPtr ctx;
  VALUE enc;

  Data_Get_Struct(self, sqlite3Ruby, ctx);
  REQUIRE_OPEN_DB(ctx);

  enc = rb_iv_get(self, &quot;@encoding&quot;);

  if(NIL_P(enc)) {
    sqlite3_exec(ctx-&gt;db, &quot;PRAGMA encoding&quot;, enc_cb, (void *)self, NULL);
  }

  return rb_iv_get(self, &quot;@encoding&quot;);
}</pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000030">
                    
                    <a name="M000030"></a><b> errcode
</b>
                    
                </div>
                
                <div class="description">
                  <p>
Return an integer representing the last error to have occurred with this
database.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000030_source')" id="l_M000030_source">show</a>
                        
                    </p>
                    <div id="M000030_source" class="dyn-source">
                        <pre>static VALUE errcode_(VALUE self)
{
  sqlite3RubyPtr ctx;
  Data_Get_Struct(self, sqlite3Ruby, ctx);
  REQUIRE_OPEN_DB(ctx);

  return INT2NUM((long)sqlite3_errcode(ctx-&gt;db));
}</pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000029">
                    
                    <a name="M000029"></a><b> errmsg
</b>
                    
                </div>
                
                <div class="description">
                  <p>
Return a string describing the last error to have occurred with this
database.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000029_source')" id="l_M000029_source">show</a>
                        
                    </p>
                    <div id="M000029_source" class="dyn-source">
                        <pre>static VALUE errmsg(VALUE self)
{
  sqlite3RubyPtr ctx;
  Data_Get_Struct(self, sqlite3Ruby, ctx);
  REQUIRE_OPEN_DB(ctx);

  return rb_str_new2(sqlite3_errmsg(ctx-&gt;db));
}</pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000047">
                    
                    <a name="M000047"></a><b>execute</b>(sql, bind_vars = [], *args, &amp;block)
                    
                </div>
                
                <div class="description">
                  <p>
Executes the given SQL statement. If additional parameters are given, they
are treated as bind variables, and are bound to the placeholders in the
query.
</p>
<p>
Note that if any of the values passed to this are hashes, then the
key/value pairs are each bound separately, with the key being used as the
name of the placeholder to bind the value to.
</p>
<p>
The block is optional. If given, it will be invoked for each row returned
by the query. Otherwise, any results are accumulated into an array and
returned wholesale.
</p>
<p>
See also <a href="Database.html#M000048">execute2</a>, <a
href="Database.html#M000055">query</a>, and <a
href="Database.html#M000051">execute_batch</a> for additional ways of
executing statements.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000047_source')" id="l_M000047_source">show</a>
                        
                    </p>
                    <div id="M000047_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/sqlite3/database.rb, line 116</span>
116:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">execute</span> <span class="ruby-identifier">sql</span>, <span class="ruby-identifier">bind_vars</span> = [], <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>
117:       <span class="ruby-comment cmt"># FIXME: This is a terrible hack and should be removed but is required</span>
118:       <span class="ruby-comment cmt"># for older versions of rails</span>
119:       <span class="ruby-identifier">hack</span> = <span class="ruby-constant">Object</span>.<span class="ruby-identifier">const_defined?</span>(<span class="ruby-identifier">:ActiveRecord</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">sql</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/^PRAGMA index_list/</span>
120: 
121:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">bind_vars</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-operator">!</span><span class="ruby-identifier">args</span>.<span class="ruby-identifier">empty?</span>
122:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">empty?</span>
123:           <span class="ruby-identifier">bind_vars</span> = []
124:         <span class="ruby-keyword kw">else</span>
125:           <span class="ruby-identifier">bind_vars</span> = [<span class="ruby-identifier">bind_vars</span>] <span class="ruby-operator">+</span> <span class="ruby-identifier">args</span>
126:         <span class="ruby-keyword kw">end</span>
127: 
128:         <span class="ruby-identifier">warn</span>(<span class="ruby-value str">&quot;\#{caller[0]} is calling SQLite3::Database#execute with nil or multiple bind params\nwithout using an array.  Please switch to passing bind parameters as an array.\nSupport for bind parameters as *args will be removed in 2.0.0.\n&quot;</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">$VERBOSE</span>
129:       <span class="ruby-keyword kw">end</span>
130: 
131:       <span class="ruby-identifier">prepare</span>( <span class="ruby-identifier">sql</span> ) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">stmt</span><span class="ruby-operator">|</span>
132:         <span class="ruby-identifier">stmt</span>.<span class="ruby-identifier">bind_params</span>(<span class="ruby-identifier">bind_vars</span>)
133:         <span class="ruby-identifier">columns</span> = <span class="ruby-identifier">stmt</span>.<span class="ruby-identifier">columns</span>
134:         <span class="ruby-identifier">stmt</span>    = <span class="ruby-constant">ResultSet</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword kw">self</span>, <span class="ruby-identifier">stmt</span>).<span class="ruby-identifier">to_a</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">type_translation</span>
135: 
136:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block_given?</span>
137:           <span class="ruby-identifier">stmt</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">row</span><span class="ruby-operator">|</span>
138:             <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@results_as_hash</span>
139:               <span class="ruby-keyword kw">yield</span> <span class="ruby-identifier">type_translation</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">row</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">ordered_map_for</span>(<span class="ruby-identifier">columns</span>, <span class="ruby-identifier">row</span>)
140:             <span class="ruby-keyword kw">else</span>
141:               <span class="ruby-keyword kw">yield</span> <span class="ruby-identifier">row</span>
142:             <span class="ruby-keyword kw">end</span>
143:           <span class="ruby-keyword kw">end</span>
144:         <span class="ruby-keyword kw">else</span>
145:           <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@results_as_hash</span>
146:             <span class="ruby-identifier">stmt</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">row</span><span class="ruby-operator">|</span>
147:               <span class="ruby-identifier">h</span> = <span class="ruby-identifier">type_translation</span> <span class="ruby-value">? </span><span class="ruby-identifier">row</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">ordered_map_for</span>(<span class="ruby-identifier">columns</span>, <span class="ruby-identifier">row</span>)
148: 
149:               <span class="ruby-comment cmt"># FIXME UGH TERRIBLE HACK!</span>
150:               <span class="ruby-identifier">h</span>[<span class="ruby-value str">'unique'</span>] = <span class="ruby-identifier">h</span>[<span class="ruby-value str">'unique'</span>].<span class="ruby-identifier">to_s</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">hack</span>
151: 
152:               <span class="ruby-identifier">h</span>
153:             }
154:           <span class="ruby-keyword kw">else</span>
155:             <span class="ruby-identifier">stmt</span>.<span class="ruby-identifier">to_a</span>
156:           <span class="ruby-keyword kw">end</span>
157:         <span class="ruby-keyword kw">end</span>
158:       <span class="ruby-keyword kw">end</span>
159:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000048">
                    
                    <a name="M000048"></a><b>execute2</b>( sql, *bind_vars )
                    
                </div>
                
                <div class="description">
                  <p>
Executes the given SQL statement, exactly as with <a
href="Database.html#M000047">execute</a>. However, the first row returned
(either via the block, or in the returned array) is always the names of the
columns. Subsequent rows correspond to the data from the result set.
</p>
<p>
Thus, even if the query itself returns no rows, this method will always
return at least one row&#8212;the names of the columns.
</p>
<p>
See also <a href="Database.html#M000047">execute</a>, <a
href="Database.html#M000055">query</a>, and <a
href="Database.html#M000051">execute_batch</a> for additional ways of
executing statements.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000048_source')" id="l_M000048_source">show</a>
                        
                    </p>
                    <div id="M000048_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/sqlite3/database.rb, line 176</span>
176:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">execute2</span>( <span class="ruby-identifier">sql</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">bind_vars</span> )
177:       <span class="ruby-identifier">prepare</span>( <span class="ruby-identifier">sql</span> ) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">stmt</span><span class="ruby-operator">|</span>
178:         <span class="ruby-identifier">result</span> = <span class="ruby-identifier">stmt</span>.<span class="ruby-identifier">execute</span>( <span class="ruby-operator">*</span><span class="ruby-identifier">bind_vars</span> )
179:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block_given?</span>
180:           <span class="ruby-keyword kw">yield</span> <span class="ruby-identifier">stmt</span>.<span class="ruby-identifier">columns</span>
181:           <span class="ruby-identifier">result</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">row</span><span class="ruby-operator">|</span> <span class="ruby-keyword kw">yield</span> <span class="ruby-identifier">row</span> }
182:         <span class="ruby-keyword kw">else</span>
183:           <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">result</span>.<span class="ruby-identifier">inject</span>( [ <span class="ruby-identifier">stmt</span>.<span class="ruby-identifier">columns</span> ] ) { <span class="ruby-operator">|</span><span class="ruby-identifier">arr</span>,<span class="ruby-identifier">row</span><span class="ruby-operator">|</span>
184:             <span class="ruby-identifier">arr</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">row</span>; <span class="ruby-identifier">arr</span> }
185:         <span class="ruby-keyword kw">end</span>
186:       <span class="ruby-keyword kw">end</span>
187:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000051">
                    
                    <a name="M000051"></a><b>execute_batch</b>( sql, bind_vars = [], *args )
                    
                </div>
                
                <div class="description">
                  <p>
Executes all SQL statements in the given string. By contrast, the other
means of executing queries will only execute the first statement in the
string, ignoring all subsequent statements. This will execute each one in
turn. The same bind parameters, if given, will be applied to each
statement.
</p>
<p>
This always returns <tt>nil</tt>, making it unsuitable for queries that
return rows.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000051_source')" id="l_M000051_source">show</a>
                        
                    </p>
                    <div id="M000051_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/sqlite3/database.rb, line 197</span>
197:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">execute_batch</span>( <span class="ruby-identifier">sql</span>, <span class="ruby-identifier">bind_vars</span> = [], <span class="ruby-operator">*</span><span class="ruby-identifier">args</span> )
198:       <span class="ruby-comment cmt"># FIXME: remove this stuff later</span>
199:       <span class="ruby-keyword kw">unless</span> [<span class="ruby-constant">Array</span>, <span class="ruby-constant">Hash</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">bind_vars</span>.<span class="ruby-identifier">class</span>)
200:         <span class="ruby-identifier">bind_vars</span> = [<span class="ruby-identifier">bind_vars</span>]
201:         <span class="ruby-identifier">warn</span>(<span class="ruby-value str">&quot;\#{caller[0]} is calling SQLite3::Database#execute_batch with bind parameters\nthat are not a list of a hash.  Please switch to passing bind parameters as an\narray or hash. Support for this behavior will be removed in version 2.0.0.\n&quot;</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">$VERBOSE</span>
202:       <span class="ruby-keyword kw">end</span>
203: 
204:       <span class="ruby-comment cmt"># FIXME: remove this stuff later</span>
205:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">bind_vars</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-operator">!</span><span class="ruby-identifier">args</span>.<span class="ruby-identifier">empty?</span>
206:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">empty?</span>
207:           <span class="ruby-identifier">bind_vars</span> = []
208:         <span class="ruby-keyword kw">else</span>
209:           <span class="ruby-identifier">bind_vars</span> = [<span class="ruby-keyword kw">nil</span>] <span class="ruby-operator">+</span> <span class="ruby-identifier">args</span>
210:         <span class="ruby-keyword kw">end</span>
211: 
212:         <span class="ruby-identifier">warn</span>(<span class="ruby-value str">&quot;\#{caller[0]} is calling SQLite3::Database#execute_batch with nil or multiple bind params\nwithout using an array.  Please switch to passing bind parameters as an array.\nSupport for this behavior will be removed in version 2.0.0.\n&quot;</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">$VERBOSE</span>
213:       <span class="ruby-keyword kw">end</span>
214: 
215:       <span class="ruby-identifier">sql</span> = <span class="ruby-identifier">sql</span>.<span class="ruby-identifier">strip</span>
216:       <span class="ruby-keyword kw">until</span> <span class="ruby-identifier">sql</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-keyword kw">do</span>
217:         <span class="ruby-identifier">prepare</span>( <span class="ruby-identifier">sql</span> ) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">stmt</span><span class="ruby-operator">|</span>
218:           <span class="ruby-comment cmt"># FIXME: this should probably use sqlite3's api for batch execution</span>
219:           <span class="ruby-comment cmt"># This implementation requires stepping over the results.</span>
220:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">bind_vars</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">stmt</span>.<span class="ruby-identifier">bind_parameter_count</span>
221:             <span class="ruby-identifier">stmt</span>.<span class="ruby-identifier">bind_params</span>(<span class="ruby-identifier">bind_vars</span>)
222:           <span class="ruby-keyword kw">end</span>
223:           <span class="ruby-identifier">stmt</span>.<span class="ruby-identifier">step</span>
224:           <span class="ruby-identifier">sql</span> = <span class="ruby-identifier">stmt</span>.<span class="ruby-identifier">remainder</span>.<span class="ruby-identifier">strip</span>
225:         <span class="ruby-keyword kw">end</span>
226:       <span class="ruby-keyword kw">end</span>
227:       <span class="ruby-keyword kw">nil</span>
228:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000087">
                    
                    <a name="M000087"></a><b>finalize</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000087_source')" id="l_M000087_source">show</a>
                        
                    </p>
                    <div id="M000087_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/sqlite3/database.rb, line 398</span>
398:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">finalize</span>
399:           <span class="ruby-keyword kw">super</span>(<span class="ruby-ivar">@ctx</span>)
400:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000099">
                    
                    <a name="M000099"></a><b>finalize</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000099_source')" id="l_M000099_source">show</a>
                        
                    </p>
                    <div id="M000099_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/sqlite3/database.rb, line 463</span>
463:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">finalize</span>
464:           <span class="ruby-ivar">@handler</span>.<span class="ruby-identifier">finalize</span> <span class="ruby-ivar">@fp</span>
465:           <span class="ruby-ivar">@fp</span>.<span class="ruby-identifier">result</span>
466:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000058">
                    
                    <a name="M000058"></a><b>get_first_row</b>( sql, *bind_vars )
                    
                </div>
                
                <div class="description">
                  <p>
A convenience method for obtaining the first row of a result set, and
discarding all others. It is otherwise identical to <a
href="Database.html#M000047">execute</a>.
</p>
<p>
See also <a href="Database.html#M000059">get_first_value</a>.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000058_source')" id="l_M000058_source">show</a>
                        
                    </p>
                    <div id="M000058_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/sqlite3/database.rb, line 284</span>
284:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_first_row</span>( <span class="ruby-identifier">sql</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">bind_vars</span> )
285:       <span class="ruby-identifier">execute</span>( <span class="ruby-identifier">sql</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">bind_vars</span> ).<span class="ruby-identifier">first</span>
286:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000059">
                    
                    <a name="M000059"></a><b>get_first_value</b>( sql, *bind_vars )
                    
                </div>
                
                <div class="description">
                  <p>
A convenience method for obtaining the first value of the first row of a
result set, and discarding all other values and rows. It is otherwise
identical to <a href="Database.html#M000047">execute</a>.
</p>
<p>
See also <a href="Database.html#M000058">get_first_row</a>.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000059_source')" id="l_M000059_source">show</a>
                        
                    </p>
                    <div id="M000059_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/sqlite3/database.rb, line 293</span>
293:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_first_value</span>( <span class="ruby-identifier">sql</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">bind_vars</span> )
294:       <span class="ruby-identifier">execute</span>( <span class="ruby-identifier">sql</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">bind_vars</span> ) { <span class="ruby-operator">|</span><span class="ruby-identifier">row</span><span class="ruby-operator">|</span> <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">row</span>[<span class="ruby-value">0</span>] }
295:       <span class="ruby-keyword kw">nil</span>
296:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000028">
                    
                    <a name="M000028"></a><b> interrupt
</b>
                    
                </div>
                
                <div class="description">
                  <p>
Interrupts the currently executing operation, causing it to abort.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000028_source')" id="l_M000028_source">show</a>
                        
                    </p>
                    <div id="M000028_source" class="dyn-source">
                        <pre>static VALUE interrupt(VALUE self)
{
  sqlite3RubyPtr ctx;
  Data_Get_Struct(self, sqlite3Ruby, ctx);
  REQUIRE_OPEN_DB(ctx);

  sqlite3_interrupt(ctx-&gt;db);

  return self;
}</pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000025">
                    
                    <a name="M000025"></a><b> last_insert_row_id
</b>
                    
                </div>
                
                <div class="description">
                  <p>
Obtains the unique row ID of the last row to be inserted by this <a
href="Database.html">Database</a> instance.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000025_source')" id="l_M000025_source">show</a>
                        
                    </p>
                    <div id="M000025_source" class="dyn-source">
                        <pre>static VALUE last_insert_row_id(VALUE self)
{
  sqlite3RubyPtr ctx;
  Data_Get_Struct(self, sqlite3Ruby, ctx);
  REQUIRE_OPEN_DB(ctx);

  return LL2NUM(sqlite3_last_insert_rowid(ctx-&gt;db));
}</pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000037">
                    
                    <a name="M000037"></a><b> db.load_extension(file)
</b>
                    
                </div>
                
                <div class="description">
                  <p>
Loads an SQLite extension library from the named file. Extension loading
must be enabled using db.enable_load_extension(1) prior to calling this
API.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000037_source')" id="l_M000037_source">show</a>
                        
                    </p>
                    <div id="M000037_source" class="dyn-source">
                        <pre>static VALUE load_extension(VALUE self, VALUE file)
{
  sqlite3RubyPtr ctx;
  int status;
  char *errMsg;
  VALUE errexp;
  Data_Get_Struct(self, sqlite3Ruby, ctx);
  REQUIRE_OPEN_DB(ctx);

  status = sqlite3_load_extension(ctx-&gt;db, RSTRING_PTR(file), 0, &amp;errMsg);
  if (status != SQLITE_OK)
  {
    errexp = rb_exc_new2(rb_eRuntimeError, errMsg);
    sqlite3_free(errMsg);
    rb_exc_raise(errexp);
  }

  return self;
}</pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000046">
                    
                    <a name="M000046"></a><b>prepare</b>(sql)
                    
                </div>
                
                <div class="description">
                  <p>
Returns a <a href="Statement.html">Statement</a> object representing the
given SQL. This does not execute the statement; it merely prepares the
statement for execution.
</p>
<p>
The <a href="Statement.html">Statement</a> can then be executed using <a
href="Statement.html#M000119">Statement#execute</a>.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000046_source')" id="l_M000046_source">show</a>
                        
                    </p>
                    <div id="M000046_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/sqlite3/database.rb, line 91</span>
 91:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">prepare</span> <span class="ruby-identifier">sql</span>
 92:       <span class="ruby-identifier">stmt</span> = <span class="ruby-constant">SQLite3</span><span class="ruby-operator">::</span><span class="ruby-constant">Statement</span>.<span class="ruby-identifier">new</span>( <span class="ruby-keyword kw">self</span>, <span class="ruby-identifier">sql</span> )
 93:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">stmt</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">block_given?</span>
 94: 
 95:       <span class="ruby-keyword kw">begin</span>
 96:         <span class="ruby-keyword kw">yield</span> <span class="ruby-identifier">stmt</span>
 97:       <span class="ruby-keyword kw">ensure</span>
 98:         <span class="ruby-identifier">stmt</span>.<span class="ruby-identifier">close</span>
 99:       <span class="ruby-keyword kw">end</span>
100:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000055">
                    
                    <a name="M000055"></a><b>query</b>( sql, bind_vars = [], *args )
                    
                </div>
                
                <div class="description">
                  <p>
This is a convenience method for creating a statement, binding paramters to
it, and calling execute:
</p>
<pre>
  result = db.query( &quot;select * from foo where a=?&quot;, 5 )
  # is the same as
  result = db.prepare( &quot;select * from foo where a=?&quot; ).execute( 5 )
</pre>
<p>
You must be sure to call <tt>close</tt> on the <a
href="ResultSet.html">ResultSet</a> instance that is returned, or you could
have problems with locks on the table. If called with a block,
<tt>close</tt> will be invoked implicitly when the block terminates.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000055_source')" id="l_M000055_source">show</a>
                        
                    </p>
                    <div id="M000055_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/sqlite3/database.rb, line 251</span>
251:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">query</span>( <span class="ruby-identifier">sql</span>, <span class="ruby-identifier">bind_vars</span> = [], <span class="ruby-operator">*</span><span class="ruby-identifier">args</span> )
252: 
253:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">bind_vars</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-operator">!</span><span class="ruby-identifier">args</span>.<span class="ruby-identifier">empty?</span>
254:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">empty?</span>
255:           <span class="ruby-identifier">bind_vars</span> = []
256:         <span class="ruby-keyword kw">else</span>
257:           <span class="ruby-identifier">bind_vars</span> = [<span class="ruby-keyword kw">nil</span>] <span class="ruby-operator">+</span> <span class="ruby-identifier">args</span>
258:         <span class="ruby-keyword kw">end</span>
259: 
260:         <span class="ruby-identifier">warn</span>(<span class="ruby-value str">&quot;\#{caller[0]} is calling SQLite3::Database#query with nil or multiple bind params\nwithout using an array.  Please switch to passing bind parameters as an array.\nSupport for this will be removed in version 2.0.0.\n&quot;</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">$VERBOSE</span>
261:       <span class="ruby-keyword kw">end</span>
262: 
263:       <span class="ruby-identifier">result</span> = <span class="ruby-identifier">prepare</span>( <span class="ruby-identifier">sql</span> ).<span class="ruby-identifier">execute</span>( <span class="ruby-identifier">bind_vars</span> )
264:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block_given?</span>
265:         <span class="ruby-keyword kw">begin</span>
266:           <span class="ruby-keyword kw">yield</span> <span class="ruby-identifier">result</span>
267:         <span class="ruby-keyword kw">ensure</span>
268:           <span class="ruby-identifier">result</span>.<span class="ruby-identifier">close</span>
269:         <span class="ruby-keyword kw">end</span>
270:       <span class="ruby-keyword kw">else</span>
271:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">result</span>
272:       <span class="ruby-keyword kw">end</span>
273:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000105">
                    
                    <a name="M000105"></a><b>readonly?</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Returns <tt>true</tt> if the database has been open in readonly mode A
helper to check before performing any operation
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000105_source')" id="l_M000105_source">show</a>
                        
                    </p>
                    <div id="M000105_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/sqlite3/database.rb, line 526</span>
526:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">readonly?</span>
527:       <span class="ruby-ivar">@readonly</span>
528:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000104">
                    
                    <a name="M000104"></a><b>rollback</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Rolls the current transaction back. If there is no current transaction,
this will cause an error to be raised. This returns <tt>true</tt>, in order
to allow it to be used in idioms like <tt>abort? and rollback or
commit</tt>.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000104_source')" id="l_M000104_source">show</a>
                        
                    </p>
                    <div id="M000104_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/sqlite3/database.rb, line 519</span>
519:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">rollback</span>
520:       <span class="ruby-identifier">execute</span> <span class="ruby-value str">&quot;rollback transaction&quot;</span>
521:       <span class="ruby-keyword kw">true</span>
522:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000081">
                    
                    <a name="M000081"></a><b>step</b>( *args )
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000081_source')" id="l_M000081_source">show</a>
                        
                    </p>
                    <div id="M000081_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/sqlite3/database.rb, line 394</span>
394:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">step</span>( <span class="ruby-operator">*</span><span class="ruby-identifier">args</span> )
395:           <span class="ruby-keyword kw">super</span>(<span class="ruby-ivar">@ctx</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
396:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000098">
                    
                    <a name="M000098"></a><b>step</b>( *args )
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000098_source')" id="l_M000098_source">show</a>
                        
                    </p>
                    <div id="M000098_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/sqlite3/database.rb, line 459</span>
459:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">step</span>( <span class="ruby-operator">*</span><span class="ruby-identifier">args</span> )
460:           <span class="ruby-ivar">@handler</span>.<span class="ruby-identifier">step</span>(<span class="ruby-ivar">@fp</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
461:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000023">
                    
                    <a name="M000023"></a><b> total_changes
</b>
                    
                </div>
                
                <div class="description">
                  <p>
Returns the total number of changes made to this database instance since it
was opened.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000023_source')" id="l_M000023_source">show</a>
                        
                    </p>
                    <div id="M000023_source" class="dyn-source">
                        <pre>static VALUE total_changes(VALUE self)
{
  sqlite3RubyPtr ctx;
  Data_Get_Struct(self, sqlite3Ruby, ctx);
  REQUIRE_OPEN_DB(ctx);

  return INT2NUM((long)sqlite3_total_changes(ctx-&gt;db));
}</pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000024">
                    
                    <a name="M000024"></a><b>trace { |sql| ... }
trace(Class.new { def call sql; end }.new)
</b>
                    
                </div>
                
                <div class="description">
                  <p>
Installs (or removes) a block that will be invoked for every SQL statement
executed. The block receives one parameter: the SQL statement executed. If
the block is <tt>nil</tt>, any existing tracer will be uninstalled.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000024_source')" id="l_M000024_source">show</a>
                        
                    </p>
                    <div id="M000024_source" class="dyn-source">
                        <pre>static VALUE trace(int argc, VALUE *argv, VALUE self)
{
  sqlite3RubyPtr ctx;
  VALUE block;

  Data_Get_Struct(self, sqlite3Ruby, ctx);
  REQUIRE_OPEN_DB(ctx);

  rb_scan_args(argc, argv, &quot;01&quot;, &amp;block);

  if(NIL_P(block) &amp;&amp; rb_block_given_p()) block = rb_block_proc();

  rb_iv_set(self, &quot;@tracefunc&quot;, block);

  sqlite3_trace(ctx-&gt;db, NIL_P(block) ? NULL : tracefunc, (void *)self);

  return self;
}</pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000101">
                    
                    <a name="M000101"></a><b>transaction</b>( mode = :deferred )
                    
                </div>
                
                <div class="description">
                  <p>
Begins a new transaction. Note that nested transactions are not allowed by
SQLite, so attempting to nest a transaction will result in a runtime
exception.
</p>
<p>
The <tt>mode</tt> parameter may be either <tt>:deferred</tt> (the default),
<tt>:immediate</tt>, or <tt>:exclusive</tt>.
</p>
<p>
If a block is given, the database instance is yielded to it, and the
transaction is committed when the block terminates. If the block raises an
exception, a rollback will be performed instead. Note that if a block is
given, <a href="Database.html#M000103">commit</a> and <a
href="Database.html#M000104">rollback</a> should never be called explicitly
or you&#8217;ll get an error when the block terminates.
</p>
<p>
If a block is not given, it is the caller&#8217;s responsibility to end the
transaction explicitly, either by calling <a
href="Database.html#M000103">commit</a>, or by calling <a
href="Database.html#M000104">rollback</a>.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000101_source')" id="l_M000101_source">show</a>
                        
                    </p>
                    <div id="M000101_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/sqlite3/database.rb, line 488</span>
488:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">transaction</span>( <span class="ruby-identifier">mode</span> = <span class="ruby-identifier">:deferred</span> )
489:       <span class="ruby-identifier">execute</span> <span class="ruby-node">&quot;begin #{mode.to_s} transaction&quot;</span>
490: 
491:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block_given?</span>
492:         <span class="ruby-identifier">abort</span> = <span class="ruby-keyword kw">false</span>
493:         <span class="ruby-keyword kw">begin</span>
494:           <span class="ruby-keyword kw">yield</span> <span class="ruby-keyword kw">self</span>
495:         <span class="ruby-keyword kw">rescue</span> <span class="ruby-operator">::</span><span class="ruby-constant">Object</span>
496:           <span class="ruby-identifier">abort</span> = <span class="ruby-keyword kw">true</span>
497:           <span class="ruby-identifier">raise</span>
498:         <span class="ruby-keyword kw">ensure</span>
499:           <span class="ruby-identifier">abort</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">rollback</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">commit</span>
500:         <span class="ruby-keyword kw">end</span>
501:       <span class="ruby-keyword kw">end</span>
502: 
503:       <span class="ruby-keyword kw">true</span>
504:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000036">
                    
                    <a name="M000036"></a><b> db.transaction_active?
</b>
                    
                </div>
                
                <div class="description">
                  <p>
Returns <tt>true</tt> if there is a transaction active, and <tt>false</tt>
otherwise.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000036_source')" id="l_M000036_source">show</a>
                        
                    </p>
                    <div id="M000036_source" class="dyn-source">
                        <pre>static VALUE transaction_active_p(VALUE self)
{
  sqlite3RubyPtr ctx;
  Data_Get_Struct(self, sqlite3Ruby, ctx);
  REQUIRE_OPEN_DB(ctx);

  return sqlite3_get_autocommit(ctx-&gt;db) ? Qfalse : Qtrue;
}</pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000044">
                    
                    <a name="M000044"></a><b>translator</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Return the type translator employed by this database instance. Each
database instance has its own type translator; this allows for different
type handlers to be installed in each instance without affecting other
instances. Furthermore, the translators are instantiated lazily, so that if
a database does not use type translation, it will not be burdened by the
overhead of a useless type translator. (See the <a
href="Translator.html">Translator</a> class.)
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000044_source')" id="l_M000044_source">show</a>
                        
                    </p>
                    <div id="M000044_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/sqlite3/database.rb, line 74</span>
74:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">translator</span>
75:       <span class="ruby-ivar">@translator</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">Translator</span>.<span class="ruby-identifier">new</span>
76:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Private methods</div>
            
            <div class="method">
                <div class="title" id="M000112">
                    
                    <a name="M000112"></a><b>ordered_map_for</b>(columns, row)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000112_source')" id="l_M000112_source">show</a>
                        
                    </p>
                    <div id="M000112_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/sqlite3/database.rb, line 578</span>
578:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">ordered_map_for</span> <span class="ruby-identifier">columns</span>, <span class="ruby-identifier">row</span>
579:       <span class="ruby-identifier">h</span> = <span class="ruby-constant">Hash</span>[<span class="ruby-operator">*</span><span class="ruby-identifier">columns</span>.<span class="ruby-identifier">zip</span>(<span class="ruby-identifier">row</span>).<span class="ruby-identifier">flatten</span>]
580:       <span class="ruby-identifier">row</span>.<span class="ruby-identifier">each_with_index</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">r</span>, <span class="ruby-identifier">i</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">i</span>] = <span class="ruby-identifier">r</span> }
581:       <span class="ruby-identifier">h</span>
582:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    