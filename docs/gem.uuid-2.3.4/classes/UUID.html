<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>UUID</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen" />
    <script src="../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Class</span> 
            UUID 
            
                <span class="parent">&lt; 
                    
                    Object
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../files/lib/uuid_rb.html">lib/uuid.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    
    <div class="description">
        <h1>Generating UUIDs</h1>
<p>
Call <a href="UUID.html#M000001">generate</a> to generate a new <a
href="UUID.html">UUID</a>. The method returns a string in one of three
formats. The default format is 36 characters long, and contains the 32
hexadecimal octets and hyphens separating the various value parts. The
<tt>:compact</tt> format omits the hyphens, while the <tt>:urn</tt> format
adds the <tt>:urn:uuid</tt> prefix.
</p>
<p>
For example:
</p>
<pre>
  uuid = UUID.new

  10.times do
    p uuid.generate
  end
</pre>
<h1>UUIDs in Brief</h1>
<p>
<a href="UUID.html">UUID</a> (universally unique identifier) are guaranteed
to be unique across time and space.
</p>
<p>
A <a href="UUID.html">UUID</a> is 128 bit long, and consists of a 60-bit
time value, a 16-bit sequence number and a 48-bit node identifier.
</p>
<p>
The time value is taken from the system clock, and is monotonically
incrementing. However, since it is possible to set the system clock
backward, a sequence number is added. The sequence number is incremented
each time the <a href="UUID.html">UUID</a> generator is started. The
combination guarantees that identifiers created on the same machine are
unique with a high degree of probability.
</p>
<p>
Note that due to the structure of the <a href="UUID.html">UUID</a> and the
use of sequence number, there is no guarantee that <a
href="UUID.html">UUID</a> values themselves are monotonically incrementing.
The <a href="UUID.html">UUID</a> value cannot itself be used to sort based
on order of creation.
</p>
<p>
To guarantee that UUIDs are unique across all machines in the network, the
IEEE 802 MAC address of the machine&#8217;s network interface card is used
as the node identifier.
</p>
<p>
For more information see <a href="http://www.ietf.org/rfc/rfc4122.txt">RFC
4122</a>.
</p>

    </div>
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>G</dt>
        <dd>
            <ul>
                
                <li><a href="#M000011">generate</a>,</li>
                
                <li><a href="#M000001">generate</a>,</li>
                
                <li><a href="#M000002">generator</a></li>
                
            </ul>
        </dd>
    
        <dt>I</dt>
        <dd>
            <ul>
                
                <li><a href="#M000008">iee_mac_address</a>,</li>
                
                <li><a href="#M000013">inspect</a></li>
                
            </ul>
        </dd>
    
        <dt>M</dt>
        <dd>
            <ul>
                
                <li><a href="#M000009">mac_address</a>,</li>
                
                <li><a href="#M000000">mode</a></li>
                
            </ul>
        </dd>
    
        <dt>N</dt>
        <dd>
            <ul>
                
                <li><a href="#M000010">new</a>,</li>
                
                <li><a href="#M000012">next_sequence</a></li>
                
            </ul>
        </dd>
    
        <dt>O</dt>
        <dd>
            <ul>
                
                <li><a href="#M000014">open_lock</a></li>
                
            </ul>
        </dd>
    
        <dt>P</dt>
        <dd>
            <ul>
                
                <li><a href="#M000007">pseudo_mac_address</a></li>
                
            </ul>
        </dd>
    
        <dt>R</dt>
        <dd>
            <ul>
                
                <li><a href="#M000015">read_state</a></li>
                
            </ul>
        </dd>
    
        <dt>S</dt>
        <dd>
            <ul>
                
                <li><a href="#M000003">server=</a>,</li>
                
                <li><a href="#M000004">state_file</a>,</li>
                
                <li><a href="#M000005">state_file=</a></li>
                
            </ul>
        </dd>
    
        <dt>V</dt>
        <dd>
            <ul>
                
                <li><a href="#M000006">validate</a></li>
                
            </ul>
        </dd>
    
        <dt>W</dt>
        <dd>
            <ul>
                
                <li><a href="#M000016">write_state</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    

    

    
    <div class="sectiontitle">Classes and Modules</div>
    <ul>
        
        <li><span class="type">MODULE</span> <a href="UUID/Version.html">UUID::Version</a></li>
        
        <li><span class="type">CLASS</span> <a href="UUID/Client.html">UUID::Client</a></li>
        
        <li><span class="type">CLASS</span> <a href="UUID/Server.html">UUID::Server</a></li>
        
    </ul>
    

    
    <div class="sectiontitle">Constants</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class="attr-name">VERSION</td>
            <td>=</td>
            <td class="attr-value">Version::STRING</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">CLOCK_MULTIPLIER</td>
            <td>=</td>
            <td class="attr-value">10000000</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
Clock multiplier. Converts Time (resolution: seconds) to <a
href="UUID.html">UUID</a> clock (resolution: 10ns)
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">CLOCK_GAPS</td>
            <td>=</td>
            <td class="attr-value">100000</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
Clock gap is the number of ticks (resolution: 10ns) between two Ruby Time
ticks.
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">VERSION_CLOCK</td>
            <td>=</td>
            <td class="attr-value">0x0100</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
<a href="UUID/Version.html">Version</a> number stamped into the <a
href="UUID.html">UUID</a> to identify it as time-based.
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">FORMATS</td>
            <td>=</td>
            <td class="attr-value">{     :compact =&gt; '%08x%04x%04x%04x%012x',     :default =&gt; '%08x-%04x-%04x-%04x-%012x',     :urn     =&gt; 'urn:uuid:%08x-%04x-%04x-%04x-%012x',   }</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
Formats supported by the <a href="UUID.html">UUID</a> generator.
</p>
<table>
<tr><td valign="top"><tt>:default</tt>:</td><td>Produces 36 characters, including hyphens separating the <a
href="UUID.html">UUID</a> value parts

</td></tr>
<tr><td valign="top"><tt>:compact</tt>:</td><td>Produces a 32 digits (hexadecimal) value with no hyphens

</td></tr>
<tr><td valign="top"><tt>:urn</tt>:</td><td>Adds the prefix <tt>urn:uuid:</tt> to the default format

</td></tr>
</table>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">STATE_FILE_FORMAT</td>
            <td>=</td>
            <td class="attr-value">'SLLQ'</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
MAC address (48 bits), sequence number and last clock
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">SOCKET_NAME</td>
            <td>=</td>
            <td class="attr-value">&quot;/var/lib/uuid.sock&quot;</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
You don&#8217;t have to use this, it&#8217;s just a good default.
</p>
</td>
        </tr>
        
        
    </table>
    

    

    
            <div class="sectiontitle">Class Public methods</div>
            
            <div class="method">
                <div class="title" id="M000001">
                    
                    <a name="M000001"></a><b>generate</b>(format = :default)
                    
                </div>
                
                <div class="description">
                  <p>
Generates a new <a href="UUID.html">UUID</a> string using <tt>format</tt>.
See <a href="UUID.html#FORMATS">FORMATS</a> for a list of supported
formats.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000001_source')" id="l_M000001_source">show</a>
                        
                    </p>
                    <div id="M000001_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/uuid.rb, line 120</span>
120:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">generate</span>(<span class="ruby-identifier">format</span> = <span class="ruby-identifier">:default</span>)
121:     <span class="ruby-ivar">@uuid</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">new</span>
122:     <span class="ruby-ivar">@uuid</span>.<span class="ruby-identifier">generate</span> <span class="ruby-identifier">format</span>
123:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000002">
                    
                    <a name="M000002"></a><b>generator</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Returns the <a href="UUID.html">UUID</a> generator used by generate. Useful
if you need to mess with it, e.g. force next sequence when forking (e.g.
Unicorn, Resque):
</p>
<p>
after_fork do
</p>
<pre>
  UUID.generator.next_sequence
</pre>
<p>
end
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000002_source')" id="l_M000002_source">show</a>
                        
                    </p>
                    <div id="M000002_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/uuid.rb, line 132</span>
132:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">generator</span>
133:     <span class="ruby-ivar">@uuid</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">new</span>
134:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000000">
                    
                    <a name="M000000"></a><b>mode</b>()
                    
                </div>
                
                <div class="description">
                  <p>
The access mode of the state file. Set it with state_file.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000000_source')" id="l_M000000_source">show</a>
                        
                    </p>
                    <div id="M000000_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/uuid.rb, line 112</span>
112:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">mode</span>
113:     <span class="ruby-ivar">@mode</span>
114:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000010">
                    
                    <a name="M000010"></a><b>new</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Create a new <a href="UUID.html">UUID</a> generator. You really only need
to do this once.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000010_source')" id="l_M000010_source">show</a>
                        
                    </p>
                    <div id="M000010_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/uuid.rb, line 249</span>
249:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>
250:     <span class="ruby-ivar">@drift</span> = <span class="ruby-value">0</span>
251:     <span class="ruby-ivar">@last_clock</span> = (<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">to_f</span> <span class="ruby-operator">*</span> <span class="ruby-constant">CLOCK_MULTIPLIER</span>).<span class="ruby-identifier">to_i</span>
252:     <span class="ruby-ivar">@mutex</span> = <span class="ruby-constant">Mutex</span>.<span class="ruby-identifier">new</span>
253: 
254:     <span class="ruby-identifier">state_file</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">state_file</span>
255:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">state_file</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">size?</span>(<span class="ruby-identifier">state_file</span>) <span class="ruby-keyword kw">then</span>
256:       <span class="ruby-identifier">next_sequence</span>
257:     <span class="ruby-keyword kw">else</span>
258:       <span class="ruby-ivar">@mac</span> = <span class="ruby-identifier">mac_address</span>
259:       <span class="ruby-identifier">fail</span> <span class="ruby-node">&quot;Cannot determine MAC address from any available interface, tried with #{mac_address}&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@mac</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
260:       <span class="ruby-ivar">@sequence</span> = <span class="ruby-identifier">rand</span> <span class="ruby-value">0x10000</span>
261: 
262:       <span class="ruby-comment cmt"># Ensure the mode is respected, even with a restrictive umask</span>
263:       <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">state_file</span>, <span class="ruby-value str">'w'</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span> <span class="ruby-identifier">f</span>.<span class="ruby-identifier">chmod</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">mode</span>) } <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">state_file</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-identifier">state_file</span>)
264: 
265:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">state_file</span>
266:         <span class="ruby-identifier">open_lock</span> <span class="ruby-value str">'wb'</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">io</span><span class="ruby-operator">|</span>
267:           <span class="ruby-identifier">write_state</span> <span class="ruby-identifier">io</span>
268:         <span class="ruby-keyword kw">end</span>
269:       <span class="ruby-keyword kw">end</span>
270:     <span class="ruby-keyword kw">end</span>
271:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000003">
                    
                    <a name="M000003"></a><b>server=</b>(address)
                    
                </div>
                
                <div class="description">
                  <p>
Call this to use a <a href="UUID.html">UUID</a> <a
href="UUID/Server.html">Server</a>. Expects address to bind to (<a
href="UUID.html#SOCKET_NAME">SOCKET_NAME</a> is a good default)
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000003_source')" id="l_M000003_source">show</a>
                        
                    </p>
                    <div id="M000003_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/uuid.rb, line 139</span>
139:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">server=</span>(<span class="ruby-identifier">address</span>)
140:     <span class="ruby-ivar">@uuid</span> = <span class="ruby-constant">Client</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">address</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">Client</span> <span class="ruby-operator">===</span> <span class="ruby-ivar">@uuid</span>
141:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000004">
                    
                    <a name="M000004"></a><b>state_file</b>(mode = 0644)
                    
                </div>
                
                <div class="description">
                  <p>
Creates an empty state file in /var/tmp/ruby-uuid or the windows common
application data directory using mode 0644. Call with a different mode
before creating a <a href="UUID.html">UUID</a> generator if you want to
open access beyond your user by default.
</p>
<p>
If the default state dir is not writable, <a href="UUID.html">UUID</a>
falls back to ~/.ruby-uuid.
</p>
<p>
State files are not portable across machines.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000004_source')" id="l_M000004_source">show</a>
                        
                    </p>
                    <div id="M000004_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/uuid.rb, line 152</span>
152:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">state_file</span>(<span class="ruby-identifier">mode</span> = <span class="ruby-value">0644</span>)
153:     <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@state_file</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@state_file</span>.<span class="ruby-identifier">nil?</span>
154: 
155:     <span class="ruby-ivar">@mode</span> = <span class="ruby-identifier">mode</span>
156: 
157:     <span class="ruby-keyword kw">begin</span>
158:       <span class="ruby-identifier">require</span> <span class="ruby-value str">'Win32API'</span>
159: 
160:       <span class="ruby-identifier">csidl_common_appdata</span> = <span class="ruby-value">0x0023</span>
161:       <span class="ruby-identifier">path</span> = <span class="ruby-value">0</span>.<span class="ruby-identifier">chr</span> <span class="ruby-operator">*</span> <span class="ruby-value">260</span>
162:       <span class="ruby-identifier">get_folder_path</span> = <span class="ruby-constant">Win32API</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">'shell32'</span>, <span class="ruby-value str">'SHGetFolderPath'</span>, <span class="ruby-value str">'LLLLP'</span>, <span class="ruby-value str">'L'</span>)
163:       <span class="ruby-identifier">get_folder_path</span>.<span class="ruby-identifier">call</span> <span class="ruby-value">0</span>, <span class="ruby-identifier">csidl_common_appdata</span>, <span class="ruby-value">0</span>, <span class="ruby-value">1</span>, <span class="ruby-identifier">path</span>
164: 
165:       <span class="ruby-identifier">state_dir</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">path</span>.<span class="ruby-identifier">strip</span>)
166:     <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">LoadError</span>
167:       <span class="ruby-identifier">state_dir</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">''</span>, <span class="ruby-value str">'var'</span>, <span class="ruby-value str">'tmp'</span>)
168:     <span class="ruby-keyword kw">end</span>
169: 
170:     <span class="ruby-ivar">@state_file</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">state_dir</span>, <span class="ruby-value str">'ruby-uuid'</span>)
171: 
172:     <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">writable?</span>(<span class="ruby-identifier">state_dir</span>) <span class="ruby-operator">||</span> (<span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-ivar">@state_file</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">writable?</span>(<span class="ruby-ivar">@state_file</span>)) <span class="ruby-keyword kw">then</span>
173:       <span class="ruby-ivar">@state_file</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-value str">'.ruby-uuid'</span>, <span class="ruby-value str">'~'</span>)
174:     <span class="ruby-keyword kw">end</span>
175: 
176:     <span class="ruby-ivar">@state_file</span>
177:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000005">
                    
                    <a name="M000005"></a><b>state_file=</b>(path)
                    
                </div>
                
                <div class="description">
                  <p>
Specify the path of the state file. Use this if you need a different
location for your state file.
</p>
<p>
Set to false if your system cannot use a state file (e.g. many shared
hosts).
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000005_source')" id="l_M000005_source">show</a>
                        
                    </p>
                    <div id="M000005_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/uuid.rb, line 185</span>
185:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">state_file=</span>(<span class="ruby-identifier">path</span>)
186:     <span class="ruby-ivar">@state_file</span> = <span class="ruby-identifier">path</span>
187:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000006">
                    
                    <a name="M000006"></a><b>validate</b>(uuid)
                    
                </div>
                
                <div class="description">
                  <p>
Returns true if <tt>uuid</tt> is in compact, default or urn formats. Does
not validate the layout (RFC 4122 section 4) of the <a
href="UUID.html">UUID</a>.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000006_source')" id="l_M000006_source">show</a>
                        
                    </p>
                    <div id="M000006_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/uuid.rb, line 192</span>
192:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">validate</span>(<span class="ruby-identifier">uuid</span>)
193:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">uuid</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/\A[\da-f]{32}\z/i</span>
194:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">if</span>
195:       <span class="ruby-identifier">uuid</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/\A(urn:uuid:)?[\da-f]{8}-([\da-f]{4}-){3}[\da-f]{12}\z/i</span>
196:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M000011">
                    
                    <a name="M000011"></a><b>generate</b>(format = :default)
                    
                </div>
                
                <div class="description">
                  <p>
Generates a new <a href="UUID.html">UUID</a> string using <tt>format</tt>.
See <a href="UUID.html#FORMATS">FORMATS</a> for a list of supported
formats.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000011_source')" id="l_M000011_source">show</a>
                        
                    </p>
                    <div id="M000011_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/uuid.rb, line 276</span>
276:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">generate</span>(<span class="ruby-identifier">format</span> = <span class="ruby-identifier">:default</span>)
277:     <span class="ruby-identifier">template</span> = <span class="ruby-constant">FORMATS</span>[<span class="ruby-identifier">format</span>]
278: 
279:     <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-node">&quot;invalid UUID format #{format.inspect}&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">template</span>
280: 
281:     <span class="ruby-comment cmt"># The clock must be monotonically increasing. The clock resolution is at</span>
282:     <span class="ruby-comment cmt"># best 100 ns (UUID spec), but practically may be lower (on my setup,</span>
283:     <span class="ruby-comment cmt"># around 1ms). If this method is called too fast, we don't have a</span>
284:     <span class="ruby-comment cmt"># monotonically increasing clock, so the solution is to just wait.</span>
285:     <span class="ruby-comment cmt">#</span>
286:     <span class="ruby-comment cmt"># It is possible for the clock to be adjusted backwards, in which case we</span>
287:     <span class="ruby-comment cmt"># would end up blocking for a long time. When backward clock is detected,</span>
288:     <span class="ruby-comment cmt"># we prevent duplicates by asking for a new sequence number and continue</span>
289:     <span class="ruby-comment cmt"># with the new clock.</span>
290: 
291:     <span class="ruby-identifier">clock</span> = <span class="ruby-ivar">@mutex</span>.<span class="ruby-identifier">synchronize</span> <span class="ruby-keyword kw">do</span>
292:       <span class="ruby-identifier">clock</span> = (<span class="ruby-constant">Time</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">to_f</span> <span class="ruby-operator">*</span> <span class="ruby-constant">CLOCK_MULTIPLIER</span>).<span class="ruby-identifier">to_i</span> <span class="ruby-operator">&amp;</span> <span class="ruby-value">0x</span><span class="ruby-constant">FFFFFFFFFFFFFFF0</span>
293: 
294:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">clock</span> <span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@last_clock</span> <span class="ruby-keyword kw">then</span>
295:         <span class="ruby-ivar">@drift</span> = <span class="ruby-value">0</span>
296:         <span class="ruby-ivar">@last_clock</span> = <span class="ruby-identifier">clock</span>
297:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">clock</span> <span class="ruby-operator">==</span> <span class="ruby-ivar">@last_clock</span> <span class="ruby-keyword kw">then</span>
298:         <span class="ruby-identifier">drift</span> = <span class="ruby-ivar">@drift</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
299: 
300:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">drift</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">10000</span> <span class="ruby-keyword kw">then</span>
301:           <span class="ruby-ivar">@last_clock</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
302:         <span class="ruby-keyword kw">else</span>
303:           <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">pass</span>
304:           <span class="ruby-keyword kw">nil</span>
305:         <span class="ruby-keyword kw">end</span>
306:       <span class="ruby-keyword kw">else</span>
307:         <span class="ruby-identifier">next_sequence</span>
308:         <span class="ruby-ivar">@last_clock</span> = <span class="ruby-identifier">clock</span>
309:       <span class="ruby-keyword kw">end</span>
310:     <span class="ruby-keyword kw">end</span> <span class="ruby-keyword kw">until</span> <span class="ruby-identifier">clock</span>
311: 
312:     <span class="ruby-identifier">template</span> <span class="ruby-operator">%</span> [
313:         <span class="ruby-identifier">clock</span>        <span class="ruby-operator">&amp;</span> <span class="ruby-value">0x</span><span class="ruby-constant">FFFFFFFF</span>,
314:        (<span class="ruby-identifier">clock</span> <span class="ruby-operator">&gt;&gt;</span> <span class="ruby-value">32</span>) <span class="ruby-operator">&amp;</span> <span class="ruby-value">0x</span><span class="ruby-constant">FFFF</span>,
315:       ((<span class="ruby-identifier">clock</span> <span class="ruby-operator">&gt;&gt;</span> <span class="ruby-value">48</span>) <span class="ruby-operator">&amp;</span> <span class="ruby-value">0x</span><span class="ruby-constant">FFFF</span> <span class="ruby-operator">|</span> <span class="ruby-constant">VERSION_CLOCK</span>),
316:       <span class="ruby-ivar">@sequence</span>      <span class="ruby-operator">&amp;</span> <span class="ruby-value">0x</span><span class="ruby-constant">FFFF</span>,
317:       <span class="ruby-ivar">@mac</span>           <span class="ruby-operator">&amp;</span> <span class="ruby-value">0x</span><span class="ruby-constant">FFFFFFFFFFFF</span>
318:     ]
319:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000008">
                    
                    <a name="M000008"></a><b>iee_mac_address</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Uses system calls to get a mac address
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000008_source')" id="l_M000008_source">show</a>
                        
                    </p>
                    <div id="M000008_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/uuid.rb, line 231</span>
231:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">iee_mac_address</span>
232:     <span class="ruby-keyword kw">begin</span>
233:       <span class="ruby-constant">Mac</span>.<span class="ruby-identifier">addr</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/:|-/</span>, <span class="ruby-value str">''</span>).<span class="ruby-identifier">hex</span> <span class="ruby-operator">&amp;</span> <span class="ruby-value">0x7</span><span class="ruby-constant">FFFFFFFFFFF</span>
234:     <span class="ruby-keyword kw">rescue</span>
235:       <span class="ruby-value">0</span> 
236:     <span class="ruby-keyword kw">end</span>
237:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000013">
                    
                    <a name="M000013"></a><b>inspect</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000013_source')" id="l_M000013_source">show</a>
                        
                    </p>
                    <div id="M000013_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/uuid.rb, line 347</span>
347:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">inspect</span>
348:     <span class="ruby-identifier">mac</span> = (<span class="ruby-value str">&quot;%012x&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-ivar">@mac</span>).<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/[0-9a-f]{2}/</span>).<span class="ruby-identifier">join</span>(<span class="ruby-value str">':'</span>)
349:     <span class="ruby-node">&quot;MAC: #{mac}  Sequence: #{@sequence}&quot;</span>
350:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000009">
                    
                    <a name="M000009"></a><b>mac_address</b>()
                    
                </div>
                
                <div class="description">
                  <p>
return <a href="UUID.html#M000008">iee_mac_address</a> if available, <a
href="UUID.html#M000007">pseudo_mac_address</a> otherwise
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000009_source')" id="l_M000009_source">show</a>
                        
                    </p>
                    <div id="M000009_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/uuid.rb, line 242</span>
242:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">mac_address</span>
243:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">iee_mac_address</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">iee_mac_address</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
244:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">pseudo_mac_address</span>
245:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000012">
                    
                    <a name="M000012"></a><b>next_sequence</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Updates the state file with a new sequence number.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000012_source')" id="l_M000012_source">show</a>
                        
                    </p>
                    <div id="M000012_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/uuid.rb, line 323</span>
323:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">next_sequence</span>
324:     <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">state_file</span>
325:       <span class="ruby-identifier">open_lock</span> <span class="ruby-value str">'rb+'</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">io</span><span class="ruby-operator">|</span>
326:         <span class="ruby-ivar">@mac</span>, <span class="ruby-ivar">@sequence</span>, <span class="ruby-ivar">@last_clock</span> = <span class="ruby-identifier">read_state</span>(<span class="ruby-identifier">io</span>)
327: 
328:         <span class="ruby-identifier">io</span>.<span class="ruby-identifier">rewind</span>
329:         <span class="ruby-identifier">io</span>.<span class="ruby-identifier">truncate</span> <span class="ruby-value">0</span>
330: 
331:         <span class="ruby-ivar">@sequence</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
332: 
333:         <span class="ruby-identifier">write_state</span> <span class="ruby-identifier">io</span>
334:       <span class="ruby-keyword kw">end</span>
335:     <span class="ruby-keyword kw">else</span>
336:       <span class="ruby-ivar">@sequence</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
337:     <span class="ruby-keyword kw">end</span>
338:   <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">ENOENT</span>
339:     <span class="ruby-identifier">open_lock</span> <span class="ruby-value str">'w'</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">io</span><span class="ruby-operator">|</span>
340:       <span class="ruby-identifier">write_state</span> <span class="ruby-identifier">io</span>
341:     <span class="ruby-keyword kw">end</span>
342:   <span class="ruby-keyword kw">ensure</span>
343:     <span class="ruby-ivar">@last_clock</span> = (<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">to_f</span> <span class="ruby-operator">*</span> <span class="ruby-constant">CLOCK_MULTIPLIER</span>).<span class="ruby-identifier">to_i</span>
344:     <span class="ruby-ivar">@drift</span> = <span class="ruby-value">0</span>
345:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000007">
                    
                    <a name="M000007"></a><b>pseudo_mac_address</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Generate a pseudo MAC address because we have no pure-ruby way to know the
MAC address of the NIC this system uses. Note that cheating with pseudo
arresses here is completely legal: see Section 4.5 of RFC4122 for details.
</p>
<p>
This implementation is shamelessly stolen from
</p>
<pre>
 https://github.com/spectra/ruby-uuid/blob/master/uuid.rb
</pre>
<p>
Thanks spectra.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000007_source')" id="l_M000007_source">show</a>
                        
                    </p>
                    <div id="M000007_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/uuid.rb, line 208</span>
208:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">pseudo_mac_address</span>
209:     <span class="ruby-identifier">sha1</span> = <span class="ruby-operator">::</span><span class="ruby-constant">Digest</span><span class="ruby-operator">::</span><span class="ruby-constant">SHA1</span>.<span class="ruby-identifier">new</span>
210:     <span class="ruby-value">256</span>.<span class="ruby-identifier">times</span> <span class="ruby-keyword kw">do</span>
211:       <span class="ruby-identifier">r</span> = [<span class="ruby-identifier">rand</span>(<span class="ruby-value">0x100000000</span>)].<span class="ruby-identifier">pack</span> <span class="ruby-value str">&quot;N&quot;</span>
212:       <span class="ruby-identifier">sha1</span>.<span class="ruby-identifier">update</span> <span class="ruby-identifier">r</span>
213:     <span class="ruby-keyword kw">end</span>
214:     <span class="ruby-identifier">str</span> = <span class="ruby-identifier">sha1</span>.<span class="ruby-identifier">digest</span>
215:     <span class="ruby-identifier">r</span> = <span class="ruby-identifier">rand</span> <span class="ruby-value">14</span> <span class="ruby-comment cmt"># 20-6</span>
216:     <span class="ruby-identifier">node</span> = <span class="ruby-identifier">str</span>[<span class="ruby-identifier">r</span>, <span class="ruby-value">6</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">str</span>
217:     <span class="ruby-keyword kw">if</span> <span class="ruby-constant">RUBY_VERSION</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value str">&quot;1.9.0&quot;</span>
218:       <span class="ruby-identifier">nnode</span> = <span class="ruby-identifier">node</span>.<span class="ruby-identifier">bytes</span>.<span class="ruby-identifier">to_a</span>
219:       <span class="ruby-identifier">nnode</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">|=</span> <span class="ruby-value">0x01</span>
220:       <span class="ruby-identifier">node</span> = <span class="ruby-value str">''</span>
221:       <span class="ruby-identifier">nnode</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span> <span class="ruby-identifier">node</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">chr</span> }
222:     <span class="ruby-keyword kw">else</span>
223:       <span class="ruby-identifier">node</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">|=</span> <span class="ruby-value">0x01</span> <span class="ruby-comment cmt"># multicast bit</span>
224:     <span class="ruby-keyword kw">end</span>
225:     <span class="ruby-identifier">node</span>.<span class="ruby-identifier">bytes</span>.<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">b</span><span class="ruby-operator">|</span><span class="ruby-identifier">b</span>.<span class="ruby-identifier">to_s</span>(<span class="ruby-value">16</span>)}.<span class="ruby-identifier">join</span>.<span class="ruby-identifier">hex</span> <span class="ruby-operator">&amp;</span> <span class="ruby-value">0x7</span><span class="ruby-constant">FFFFFFFFFFF</span>
226:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Protected methods</div>
            
            <div class="method">
                <div class="title" id="M000014">
                    
                    <a name="M000014"></a><b>open_lock</b>(mode)
                    
                </div>
                
                <div class="description">
                  <p>
Open the state file with an exclusive lock and access mode <tt>mode</tt>.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000014_source')" id="l_M000014_source">show</a>
                        
                    </p>
                    <div id="M000014_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/uuid.rb, line 356</span>
356:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">open_lock</span>(<span class="ruby-identifier">mode</span>)
357:     <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">state_file</span>, <span class="ruby-identifier">mode</span>, <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">mode</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">io</span><span class="ruby-operator">|</span>
358:       <span class="ruby-keyword kw">begin</span>
359:         <span class="ruby-identifier">io</span>.<span class="ruby-identifier">flock</span> <span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">LOCK_EX</span>
360:         <span class="ruby-keyword kw">yield</span> <span class="ruby-identifier">io</span>
361:       <span class="ruby-keyword kw">ensure</span>
362:         <span class="ruby-identifier">io</span>.<span class="ruby-identifier">flock</span> <span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">LOCK_UN</span>
363:       <span class="ruby-keyword kw">end</span>
364:     <span class="ruby-keyword kw">end</span>
365:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000015">
                    
                    <a name="M000015"></a><b>read_state</b>(io)
                    
                </div>
                
                <div class="description">
                  <p>
Read the state from <tt>io</tt>
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000015_source')" id="l_M000015_source">show</a>
                        
                    </p>
                    <div id="M000015_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/uuid.rb, line 369</span>
369:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">read_state</span>(<span class="ruby-identifier">io</span>)
370:     <span class="ruby-identifier">mac1</span>, <span class="ruby-identifier">mac2</span>, <span class="ruby-identifier">seq</span>, <span class="ruby-identifier">last_clock</span> = <span class="ruby-identifier">io</span>.<span class="ruby-identifier">read</span>(<span class="ruby-value">32</span>).<span class="ruby-identifier">unpack</span>(<span class="ruby-constant">STATE_FILE_FORMAT</span>)
371:     <span class="ruby-identifier">mac</span> = (<span class="ruby-identifier">mac1</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value">32</span>) <span class="ruby-operator">+</span> <span class="ruby-identifier">mac2</span>
372: 
373:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">mac</span>, <span class="ruby-identifier">seq</span>, <span class="ruby-identifier">last_clock</span>
374:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000016">
                    
                    <a name="M000016"></a><b>write_state</b>(io)
                    
                </div>
                
                <div class="description">
                  <p>
Write that state to <tt>io</tt>
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000016_source')" id="l_M000016_source">show</a>
                        
                    </p>
                    <div id="M000016_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/uuid.rb, line 379</span>
379:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">write_state</span>(<span class="ruby-identifier">io</span>)
380:     <span class="ruby-identifier">mac2</span> =  <span class="ruby-ivar">@mac</span>        <span class="ruby-operator">&amp;</span> <span class="ruby-value">0xffffffff</span>
381:     <span class="ruby-identifier">mac1</span> = (<span class="ruby-ivar">@mac</span> <span class="ruby-operator">&gt;&gt;</span> <span class="ruby-value">32</span>) <span class="ruby-operator">&amp;</span> <span class="ruby-value">0xffff</span>
382: 
383:     <span class="ruby-identifier">io</span>.<span class="ruby-identifier">write</span> [<span class="ruby-identifier">mac1</span>, <span class="ruby-identifier">mac2</span>, <span class="ruby-ivar">@sequence</span>, <span class="ruby-ivar">@last_clock</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-constant">STATE_FILE_FORMAT</span>)
384:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    