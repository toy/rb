<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>HTTPClient::OAuth</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../css/main.css" type="text/css" media="screen" />
    <script src="../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Class</span> 
            HTTPClient::OAuth 
            
                <span class="parent">&lt; 
                    
                    Object
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../files/lib/httpclient/auth_rb.html">lib/httpclient/auth.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    
    <div class="description">
        <p>
Authentication filter for handling <a href="OAuth.html">OAuth</a>
negotiation. Used in <a href="WWWAuth.html">WWWAuth</a>.
</p>
<p>
CAUTION: This impl only support &#8216;7 Accessing Protected
Resources&#8217; in <a href="OAuth.html">OAuth</a> Core 1.0 spec for now.
You need to obtain Access token and Access secret by yourself.
</p>
<p>
CAUTION: This impl does NOT support <a href="OAuth.html">OAuth</a> Request
Body Hash spec for now. <a
href="http://oauth.googlecode.com/svn/spec/ext/body_hash/1.0/oauth-bodyhash.html">oauth.googlecode.com/svn/spec/ext/body_hash/1.0/oauth-bodyhash.html</a>
</p>

    </div>
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>C</dt>
        <dd>
            <ul>
                
                <li><a href="#M000051">calc_cred</a>,</li>
                
                <li><a href="#M000050">challenge</a>,</li>
                
                <li><a href="#M000056">create_base_string</a></li>
                
            </ul>
        </dd>
    
        <dt>E</dt>
        <dd>
            <ul>
                
                <li><a href="#M000053">encode_header</a>,</li>
                
                <li><a href="#M000054">encode_param</a>,</li>
                
                <li><a href="#M000042">escape</a></li>
                
            </ul>
        </dd>
    
        <dt>G</dt>
        <dd>
            <ul>
                
                <li><a href="#M000052">generate_nonce</a>,</li>
                
                <li><a href="#M000049">get</a>,</li>
                
                <li><a href="#M000048">get_config</a></li>
                
            </ul>
        </dd>
    
        <dt>N</dt>
        <dd>
            <ul>
                
                <li><a href="#M000043">new</a></li>
                
            </ul>
        </dd>
    
        <dt>R</dt>
        <dd>
            <ul>
                
                <li><a href="#M000044">reset_challenge</a></li>
                
            </ul>
        </dd>
    
        <dt>S</dt>
        <dd>
            <ul>
                
                <li><a href="#M000045">set</a>,</li>
                
                <li><a href="#M000046">set?</a>,</li>
                
                <li><a href="#M000047">set_config</a>,</li>
                
                <li><a href="#M000055">sign</a>,</li>
                
                <li><a href="#M000057">sign_hmac_sha1</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    
    <div class="sectiontitle">Included Modules</div>
    <ul>
        
        <li>
            
            <a href="Util.html">HTTPClient::Util</a>
            
            START:includes
        </li>
        
    </ul>
    

    

    
    <div class="sectiontitle">Classes and Modules</div>
    <ul>
        
        <li><span class="type">CLASS</span> <a href="OAuth/Config.html">HTTPClient::OAuth::Config</a></li>
        
    </ul>
    

    

    
    <div class="sectiontitle">Attributes</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>scheme</td>
            <td class='attr-desc'><p>
Authentication scheme.
</p></td>
        </tr>
        
    </table>
    

    
            <div class="sectiontitle">Class Public methods</div>
            
            <div class="method">
                <div class="title" id="M000043">
                    
                    <a name="M000043"></a><b>new</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Creates new <a href="DigestAuth.html">DigestAuth</a> filter.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000043_source')" id="l_M000043_source">show</a>
                        
                    </p>
                    <div id="M000043_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/httpclient/auth.rb, line 671</span>
671:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>
672:       <span class="ruby-ivar">@config</span> = <span class="ruby-keyword kw">nil</span> <span class="ruby-comment cmt"># common config</span>
673:       <span class="ruby-ivar">@auth</span> = {} <span class="ruby-comment cmt"># configs for each site</span>
674:       <span class="ruby-ivar">@challengeable</span> = {}
675:       <span class="ruby-ivar">@nonce_count</span> = <span class="ruby-value">0</span>
676:       <span class="ruby-ivar">@signature_handler</span> = {
677:         <span class="ruby-value str">'HMAC-SHA1'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">method</span>(<span class="ruby-identifier">:sign_hmac_sha1</span>)
678:       }
679:       <span class="ruby-ivar">@scheme</span> = <span class="ruby-value str">&quot;OAuth&quot;</span>
680:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M000050">
                    
                    <a name="M000050"></a><b>challenge</b>(uri, param_str = nil)
                    
                </div>
                
                <div class="description">
                  <p>
Challenge handler: remember URL for response.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000050_source')" id="l_M000050_source">show</a>
                        
                    </p>
                    <div id="M000050_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/httpclient/auth.rb, line 736</span>
736:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">challenge</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">param_str</span> = <span class="ruby-keyword kw">nil</span>)
737:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">uri</span>.<span class="ruby-identifier">nil?</span>
738:         <span class="ruby-ivar">@challengeable</span>[<span class="ruby-keyword kw">nil</span>] = <span class="ruby-keyword kw">true</span>
739:       <span class="ruby-keyword kw">else</span>
740:         <span class="ruby-ivar">@challengeable</span>[<span class="ruby-identifier">urify</span>(<span class="ruby-identifier">uri</span>)] = <span class="ruby-keyword kw">true</span>
741:       <span class="ruby-keyword kw">end</span>
742:       <span class="ruby-keyword kw">true</span>
743:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000042">
                    
                    <a name="M000042"></a><b>escape</b>(str)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000042_source')" id="l_M000042_source">show</a>
                        
                    </p>
                    <div id="M000042_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/httpclient/auth.rb, line 666</span>
666:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">escape</span>(<span class="ruby-identifier">str</span>)
667:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">escape</span>(<span class="ruby-identifier">str</span>)
668:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000049">
                    
                    <a name="M000049"></a><b>get</b>(req)
                    
                </div>
                
                <div class="description">
                  <p>
Response handler: returns credential. It sends cred only when a given uri
is;
</p>
<ul>
<li>child page of challengeable(got *Authenticate before) uri and,

</li>
<li>child page of defined credential

</li>
</ul>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000049_source')" id="l_M000049_source">show</a>
                        
                    </p>
                    <div id="M000049_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/httpclient/auth.rb, line 725</span>
725:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get</span>(<span class="ruby-identifier">req</span>)
726:       <span class="ruby-identifier">target_uri</span> = <span class="ruby-identifier">req</span>.<span class="ruby-identifier">header</span>.<span class="ruby-identifier">request_uri</span>
727:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@challengeable</span>[<span class="ruby-keyword kw">nil</span>] <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@challengeable</span>.<span class="ruby-identifier">find</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">uri</span>, <span class="ruby-identifier">ok</span><span class="ruby-operator">|</span>
728:         <span class="ruby-constant">Util</span>.<span class="ruby-identifier">uri_part_of</span>(<span class="ruby-identifier">target_uri</span>, <span class="ruby-identifier">uri</span>) <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">ok</span>
729:       }
730:       <span class="ruby-identifier">config</span> = <span class="ruby-identifier">get_config</span>(<span class="ruby-identifier">target_uri</span>) <span class="ruby-operator">||</span> <span class="ruby-ivar">@config</span>
731:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">config</span>
732:       <span class="ruby-identifier">calc_cred</span>(<span class="ruby-identifier">req</span>, <span class="ruby-identifier">config</span>)
733:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000048">
                    
                    <a name="M000048"></a><b>get_config</b>(uri = nil)
                    
                </div>
                
                <div class="description">
                  <p>
Get authentication credential.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000048_source')" id="l_M000048_source">show</a>
                        
                    </p>
                    <div id="M000048_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/httpclient/auth.rb, line 710</span>
710:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_config</span>(<span class="ruby-identifier">uri</span> = <span class="ruby-keyword kw">nil</span>)
711:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">uri</span>.<span class="ruby-identifier">nil?</span>
712:         <span class="ruby-ivar">@config</span>
713:       <span class="ruby-keyword kw">else</span>
714:         <span class="ruby-identifier">uri</span> = <span class="ruby-identifier">urify</span>(<span class="ruby-identifier">uri</span>)
715:         <span class="ruby-constant">Util</span>.<span class="ruby-identifier">hash_find_value</span>(<span class="ruby-ivar">@auth</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">cand_uri</span>, <span class="ruby-identifier">cred</span><span class="ruby-operator">|</span>
716:           <span class="ruby-constant">Util</span>.<span class="ruby-identifier">uri_part_of</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">cand_uri</span>)
717:         }
718:       <span class="ruby-keyword kw">end</span>
719:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000044">
                    
                    <a name="M000044"></a><b>reset_challenge</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Resets challenge state. Do not send &#8217;*Authorization&#8217; header
until the server sends &#8217;*Authentication&#8217; again.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000044_source')" id="l_M000044_source">show</a>
                        
                    </p>
                    <div id="M000044_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/httpclient/auth.rb, line 684</span>
684:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">reset_challenge</span>
685:       <span class="ruby-ivar">@challengeable</span>.<span class="ruby-identifier">clear</span>
686:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000045">
                    
                    <a name="M000045"></a><b>set</b>(*args)
                    
                </div>
                
                <div class="description">
                  <p>
Set authentication credential. You cannot set <a
href="OAuth.html">OAuth</a> config via <a
href="WWWAuth.html#M000005">WWWAuth#set_auth</a>. Use OAuth#config=
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000045_source')" id="l_M000045_source">show</a>
                        
                    </p>
                    <div id="M000045_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/httpclient/auth.rb, line 690</span>
690:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
691:       <span class="ruby-comment cmt"># not supported</span>
692:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000046">
                    
                    <a name="M000046"></a><b>set?</b>()
                    
                </div>
                
                <div class="description">
                  <p>
have we marked this as set - ie that it&#8217;s valid to use in this
context?
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000046_source')" id="l_M000046_source">show</a>
                        
                    </p>
                    <div id="M000046_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/httpclient/auth.rb, line 695</span>
695:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set?</span>
696:       <span class="ruby-keyword kw">true</span>
697:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000047">
                    
                    <a name="M000047"></a><b>set_config</b>(uri, config)
                    
                </div>
                
                <div class="description">
                  <p>
Set authentication credential.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000047_source')" id="l_M000047_source">show</a>
                        
                    </p>
                    <div id="M000047_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/httpclient/auth.rb, line 700</span>
700:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set_config</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">config</span>)
701:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">uri</span>.<span class="ruby-identifier">nil?</span>
702:         <span class="ruby-ivar">@config</span> = <span class="ruby-identifier">config</span>
703:       <span class="ruby-keyword kw">else</span>
704:         <span class="ruby-identifier">uri</span> = <span class="ruby-constant">Util</span>.<span class="ruby-identifier">uri_dirname</span>(<span class="ruby-identifier">urify</span>(<span class="ruby-identifier">uri</span>))
705:         <span class="ruby-ivar">@auth</span>[<span class="ruby-identifier">uri</span>] = <span class="ruby-identifier">config</span>
706:       <span class="ruby-keyword kw">end</span>
707:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Private methods</div>
            
            <div class="method">
                <div class="title" id="M000051">
                    
                    <a name="M000051"></a><b>calc_cred</b>(req, config)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000051_source')" id="l_M000051_source">show</a>
                        
                    </p>
                    <div id="M000051_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/httpclient/auth.rb, line 747</span>
747:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">calc_cred</span>(<span class="ruby-identifier">req</span>, <span class="ruby-identifier">config</span>)
748:       <span class="ruby-identifier">header</span> = {}
749:       <span class="ruby-identifier">header</span>[<span class="ruby-value str">'oauth_consumer_key'</span>] = <span class="ruby-identifier">config</span>.<span class="ruby-identifier">consumer_key</span>
750:       <span class="ruby-identifier">header</span>[<span class="ruby-value str">'oauth_token'</span>] = <span class="ruby-identifier">config</span>.<span class="ruby-identifier">token</span>
751:       <span class="ruby-identifier">header</span>[<span class="ruby-value str">'oauth_signature_method'</span>] = <span class="ruby-identifier">config</span>.<span class="ruby-identifier">signature_method</span>
752:       <span class="ruby-identifier">header</span>[<span class="ruby-value str">'oauth_timestamp'</span>] = <span class="ruby-identifier">config</span>.<span class="ruby-identifier">debug_timestamp</span> <span class="ruby-operator">||</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">to_i</span>.<span class="ruby-identifier">to_s</span>
753:       <span class="ruby-identifier">header</span>[<span class="ruby-value str">'oauth_nonce'</span>] = <span class="ruby-identifier">config</span>.<span class="ruby-identifier">debug_nonce</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">generate_nonce</span>()
754:       <span class="ruby-identifier">header</span>[<span class="ruby-value str">'oauth_version'</span>] = <span class="ruby-identifier">config</span>.<span class="ruby-identifier">version</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">config</span>.<span class="ruby-identifier">version</span>
755:       <span class="ruby-identifier">header</span>[<span class="ruby-value str">'oauth_callback'</span>] = <span class="ruby-identifier">config</span>.<span class="ruby-identifier">callback</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">config</span>.<span class="ruby-identifier">callback</span>
756:       <span class="ruby-identifier">header</span>[<span class="ruby-value str">'oauth_verifier'</span>] = <span class="ruby-identifier">config</span>.<span class="ruby-identifier">verifier</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">config</span>.<span class="ruby-identifier">verifier</span>
757:       <span class="ruby-identifier">header</span>[<span class="ruby-value str">'oauth_session_handle'</span>] = <span class="ruby-identifier">config</span>.<span class="ruby-identifier">session_handle</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">config</span>.<span class="ruby-identifier">session_handle</span>
758:       <span class="ruby-identifier">signature</span> = <span class="ruby-identifier">sign</span>(<span class="ruby-identifier">config</span>, <span class="ruby-identifier">header</span>, <span class="ruby-identifier">req</span>)
759:       <span class="ruby-identifier">header</span>[<span class="ruby-value str">'oauth_signature'</span>] = <span class="ruby-identifier">signature</span>
760:       <span class="ruby-comment cmt"># no need to do but we should sort for easier to test.</span>
761:       <span class="ruby-identifier">str</span> = <span class="ruby-identifier">header</span>.<span class="ruby-identifier">sort_by</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">k</span> }.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">encode_header</span>(<span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span>) }.<span class="ruby-identifier">join</span>(<span class="ruby-value str">', '</span>)
762:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">config</span>.<span class="ruby-identifier">realm</span>
763:         <span class="ruby-identifier">str</span> = <span class="ruby-node">%Q(realm=&quot;#{config.realm}&quot;, )</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">str</span>
764:       <span class="ruby-keyword kw">end</span>
765:       <span class="ruby-identifier">str</span>
766:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000056">
                    
                    <a name="M000056"></a><b>create_base_string</b>(config, header, req)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000056_source')" id="l_M000056_source">show</a>
                        
                    </p>
                    <div id="M000056_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/httpclient/auth.rb, line 796</span>
796:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create_base_string</span>(<span class="ruby-identifier">config</span>, <span class="ruby-identifier">header</span>, <span class="ruby-identifier">req</span>)
797:       <span class="ruby-identifier">params</span> = <span class="ruby-identifier">encode_param</span>(<span class="ruby-identifier">header</span>)
798:       <span class="ruby-identifier">query</span> = <span class="ruby-identifier">req</span>.<span class="ruby-identifier">header</span>.<span class="ruby-identifier">request_query</span>
799:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">query</span> <span class="ruby-keyword kw">and</span> <span class="ruby-constant">HTTP</span><span class="ruby-operator">::</span><span class="ruby-constant">Message</span>.<span class="ruby-identifier">multiparam_query?</span>(<span class="ruby-identifier">query</span>)
800:         <span class="ruby-identifier">params</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">encode_param</span>(<span class="ruby-identifier">query</span>)
801:       <span class="ruby-keyword kw">end</span>
802:       <span class="ruby-comment cmt"># captures HTTP Message body only for 'application/x-www-form-urlencoded'</span>
803:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">req</span>.<span class="ruby-identifier">header</span>.<span class="ruby-identifier">contenttype</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'application/x-www-form-urlencoded'</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">req</span>.<span class="ruby-identifier">http_body</span>.<span class="ruby-identifier">size</span>
804:         <span class="ruby-identifier">params</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">encode_param</span>(<span class="ruby-constant">HTTP</span><span class="ruby-operator">::</span><span class="ruby-constant">Message</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">req</span>.<span class="ruby-identifier">http_body</span>.<span class="ruby-identifier">content</span>))
805:       <span class="ruby-keyword kw">end</span>
806:       <span class="ruby-identifier">uri</span> = <span class="ruby-identifier">req</span>.<span class="ruby-identifier">header</span>.<span class="ruby-identifier">request_uri</span>
807:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">uri</span>.<span class="ruby-identifier">query</span>
808:         <span class="ruby-identifier">params</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">encode_param</span>(<span class="ruby-constant">HTTP</span><span class="ruby-operator">::</span><span class="ruby-constant">Message</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">uri</span>.<span class="ruby-identifier">query</span>))
809:       <span class="ruby-keyword kw">end</span>
810:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">uri</span>.<span class="ruby-identifier">port</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">uri</span>.<span class="ruby-identifier">default_port</span>
811:         <span class="ruby-identifier">request_url</span> = <span class="ruby-node">&quot;#{uri.scheme.downcase}://#{uri.host}#{uri.path}&quot;</span>
812:       <span class="ruby-keyword kw">else</span>
813:         <span class="ruby-identifier">request_url</span> = <span class="ruby-node">&quot;#{uri.scheme.downcase}://#{uri.host}:#{uri.port}#{uri.path}&quot;</span>
814:       <span class="ruby-keyword kw">end</span>
815:       [<span class="ruby-identifier">req</span>.<span class="ruby-identifier">header</span>.<span class="ruby-identifier">request_method</span>.<span class="ruby-identifier">upcase</span>, <span class="ruby-identifier">request_url</span>, <span class="ruby-identifier">params</span>.<span class="ruby-identifier">sort</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">'&amp;'</span>)].<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">e</span><span class="ruby-operator">|</span>
816:         <span class="ruby-identifier">escape</span>(<span class="ruby-identifier">e</span>)
817:       }.<span class="ruby-identifier">join</span>(<span class="ruby-value str">'&amp;'</span>)
818:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000053">
                    
                    <a name="M000053"></a><b>encode_header</b>(k, v)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000053_source')" id="l_M000053_source">show</a>
                        
                    </p>
                    <div id="M000053_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/httpclient/auth.rb, line 775</span>
775:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">encode_header</span>(<span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span>)
776:       <span class="ruby-node">%Q(#{escape(k.to_s)}=&quot;#{escape(v.to_s)}&quot;)</span>
777:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000054">
                    
                    <a name="M000054"></a><b>encode_param</b>(params)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000054_source')" id="l_M000054_source">show</a>
                        
                    </p>
                    <div id="M000054_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/httpclient/auth.rb, line 779</span>
779:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">encode_param</span>(<span class="ruby-identifier">params</span>)
780:       <span class="ruby-identifier">params</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
781:         [<span class="ruby-identifier">v</span>].<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">vv</span><span class="ruby-operator">|</span>
782:           <span class="ruby-node">%Q(#{escape(k.to_s)}=#{escape(vv.to_s)})</span>
783:         }
784:       }.<span class="ruby-identifier">flatten</span>
785:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000052">
                    
                    <a name="M000052"></a><b>generate_nonce</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000052_source')" id="l_M000052_source">show</a>
                        
                    </p>
                    <div id="M000052_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/httpclient/auth.rb, line 768</span>
768:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">generate_nonce</span>
769:       <span class="ruby-ivar">@nonce_count</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
770:       <span class="ruby-identifier">now</span> = <span class="ruby-value str">&quot;%012d&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">to_i</span>
771:       <span class="ruby-identifier">pk</span> = <span class="ruby-constant">Digest</span><span class="ruby-operator">::</span><span class="ruby-constant">MD5</span>.<span class="ruby-identifier">hexdigest</span>([<span class="ruby-ivar">@nonce_count</span>.<span class="ruby-identifier">to_s</span>, <span class="ruby-identifier">now</span>, <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">__id__</span>, <span class="ruby-constant">Process</span>.<span class="ruby-identifier">pid</span>, <span class="ruby-identifier">rand</span>(<span class="ruby-value">65535</span>)].<span class="ruby-identifier">join</span>)[<span class="ruby-value">0</span>, <span class="ruby-value">32</span>]
772:       [<span class="ruby-identifier">now</span> <span class="ruby-operator">+</span> <span class="ruby-value str">':'</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">pk</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'m*'</span>).<span class="ruby-identifier">chop</span>
773:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000055">
                    
                    <a name="M000055"></a><b>sign</b>(config, header, req)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000055_source')" id="l_M000055_source">show</a>
                        
                    </p>
                    <div id="M000055_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/httpclient/auth.rb, line 787</span>
787:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sign</span>(<span class="ruby-identifier">config</span>, <span class="ruby-identifier">header</span>, <span class="ruby-identifier">req</span>)
788:       <span class="ruby-identifier">base_string</span> = <span class="ruby-identifier">create_base_string</span>(<span class="ruby-identifier">config</span>, <span class="ruby-identifier">header</span>, <span class="ruby-identifier">req</span>)
789:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">handler</span> = <span class="ruby-identifier">config</span>.<span class="ruby-identifier">signature_handler</span>[<span class="ruby-identifier">config</span>.<span class="ruby-identifier">signature_method</span>] <span class="ruby-operator">||</span> <span class="ruby-ivar">@signature_handler</span>[<span class="ruby-identifier">config</span>.<span class="ruby-identifier">signature_method</span>.<span class="ruby-identifier">to_s</span>]
790:         <span class="ruby-identifier">handler</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">config</span>, <span class="ruby-identifier">base_string</span>)
791:       <span class="ruby-keyword kw">else</span>
792:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">ConfigurationError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;Unknown OAuth signature method: #{config.signature_method}&quot;</span>)
793:       <span class="ruby-keyword kw">end</span>
794:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000057">
                    
                    <a name="M000057"></a><b>sign_hmac_sha1</b>(config, base_string)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000057_source')" id="l_M000057_source">show</a>
                        
                    </p>
                    <div id="M000057_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/httpclient/auth.rb, line 820</span>
820:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sign_hmac_sha1</span>(<span class="ruby-identifier">config</span>, <span class="ruby-identifier">base_string</span>)
821:       <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">SSLEnabled</span>
822:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">ConfigurationError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;openssl required for OAuth implementation&quot;</span>)
823:       <span class="ruby-keyword kw">end</span>
824:       <span class="ruby-identifier">key</span> = [<span class="ruby-identifier">escape</span>(<span class="ruby-identifier">config</span>.<span class="ruby-identifier">consumer_secret</span>.<span class="ruby-identifier">to_s</span>), <span class="ruby-identifier">escape</span>(<span class="ruby-identifier">config</span>.<span class="ruby-identifier">secret</span>.<span class="ruby-identifier">to_s</span>)].<span class="ruby-identifier">join</span>(<span class="ruby-value str">'&amp;'</span>)
825:       <span class="ruby-identifier">digester</span> = <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">Digest</span><span class="ruby-operator">::</span><span class="ruby-constant">SHA1</span>.<span class="ruby-identifier">new</span>
826:       [<span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">HMAC</span>.<span class="ruby-identifier">digest</span>(<span class="ruby-identifier">digester</span>, <span class="ruby-identifier">key</span>, <span class="ruby-identifier">base_string</span>)].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'m*'</span>).<span class="ruby-identifier">chomp</span>
827:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    