<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>DRb::DRbTCPSocket</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../css/main.css" type="text/css" media="screen" />
    <script src="../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Class</span> 
            DRb::DRbTCPSocket 
            
                <span class="parent">&lt; 
                    
                    <a href="../Object.html">Object</a>
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../files/lib/drb/drb_rb.html">lib/drb/drb.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    
    <div class="description">
        <p>
The default drb protocol.
</p>
<p>
Communicates over a TCP socket.
</p>

    </div>
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>A</dt>
        <dd>
            <ul>
                
                <li><a href="#M001770">accept</a>,</li>
                
                <li><a href="#M001771">alive?</a></li>
                
            </ul>
        </dd>
    
        <dt>C</dt>
        <dd>
            <ul>
                
                <li><a href="#M001769">close</a></li>
                
            </ul>
        </dd>
    
        <dt>G</dt>
        <dd>
            <ul>
                
                <li><a href="#M001757">getservername</a></li>
                
            </ul>
        </dd>
    
        <dt>N</dt>
        <dd>
            <ul>
                
                <li><a href="#M001761">new</a></li>
                
            </ul>
        </dd>
    
        <dt>O</dt>
        <dd>
            <ul>
                
                <li><a href="#M001756">open</a>,</li>
                
                <li><a href="#M001759">open_server</a>,</li>
                
                <li><a href="#M001758">open_server_inaddr_any</a></li>
                
            </ul>
        </dd>
    
        <dt>P</dt>
        <dd>
            <ul>
                
                <li><a href="#M001753">parse_uri</a>,</li>
                
                <li><a href="#M001762">peeraddr</a></li>
                
            </ul>
        </dd>
    
        <dt>R</dt>
        <dd>
            <ul>
                
                <li><a href="#M001767">recv_reply</a>,</li>
                
                <li><a href="#M001765">recv_request</a></li>
                
            </ul>
        </dd>
    
        <dt>S</dt>
        <dd>
            <ul>
                
                <li><a href="#M001766">send_reply</a>,</li>
                
                <li><a href="#M001764">send_request</a>,</li>
                
                <li><a href="#M001763">stream</a></li>
                
            </ul>
        </dd>
    
        <dt>U</dt>
        <dd>
            <ul>
                
                <li><a href="#M001760">uri_option</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    

    

    

    

    
    <div class="sectiontitle">Attributes</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>uri</td>
            <td class='attr-desc'><p>
Get the <a href="../URI.html">URI</a> that we are connected to.
</p></td>
        </tr>
        
    </table>
    

    
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M001770">
                    
                    <a name="M001770"></a><b>accept</b>()
                    
                </div>
                
                <div class="description">
                  <p>
On the server side, for an instance returned by <a
href="DRbTCPSocket.html#M001759">open_server</a>, accept a client
connection and return a new instance to handle the server&#8217;s side of
this client-server session.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001770_source')" id="l_M001770_source">show</a>
                        
                    </p>
                    <div id="M001770_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/drb/drb.rb, line 939</span>
939:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">accept</span>
940:       <span class="ruby-keyword kw">while</span> <span class="ruby-keyword kw">true</span>
941:   <span class="ruby-identifier">s</span> = <span class="ruby-ivar">@socket</span>.<span class="ruby-identifier">accept</span>
942:   <span class="ruby-keyword kw">break</span> <span class="ruby-keyword kw">if</span> (<span class="ruby-ivar">@acl</span> <span class="ruby-operator">?</span> <span class="ruby-ivar">@acl</span>.<span class="ruby-identifier">allow_socket?</span>(<span class="ruby-identifier">s</span>) <span class="ruby-operator">:</span> <span class="ruby-keyword kw">true</span>) 
943:   <span class="ruby-identifier">s</span>.<span class="ruby-identifier">close</span>
944:       <span class="ruby-keyword kw">end</span>
945:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@config</span>[<span class="ruby-identifier">:tcp_original_host</span>].<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
946:         <span class="ruby-identifier">uri</span> = <span class="ruby-node">&quot;druby://#{s.addr[3]}:#{@config[:tcp_port]}&quot;</span>
947:       <span class="ruby-keyword kw">else</span>
948:         <span class="ruby-identifier">uri</span> = <span class="ruby-ivar">@uri</span>
949:       <span class="ruby-keyword kw">end</span>
950:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">s</span>, <span class="ruby-ivar">@config</span>)
951:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001771">
                    
                    <a name="M001771"></a><b>alive?</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Check to see if this connection is alive.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001771_source')" id="l_M001771_source">show</a>
                        
                    </p>
                    <div id="M001771_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/drb/drb.rb, line 954</span>
954:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">alive?</span>
955:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@socket</span>
956:       <span class="ruby-keyword kw">if</span> <span class="ruby-constant">IO</span>.<span class="ruby-identifier">select</span>([<span class="ruby-ivar">@socket</span>], <span class="ruby-keyword kw">nil</span>, <span class="ruby-keyword kw">nil</span>, <span class="ruby-value">0</span>)
957:   <span class="ruby-identifier">close</span>
958:   <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span>
959:       <span class="ruby-keyword kw">end</span>
960:       <span class="ruby-keyword kw">true</span>
961:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001769">
                    
                    <a name="M001769"></a><b>close</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Close the connection.
</p>
<p>
If this is an instance returned by <a
href="DRbTCPSocket.html#M001759">open_server</a>, then this stops listening
for new connections altogether. If this is an instance returned by <a
href="DRbTCPSocket.html#M001756">open</a> or by <a
href="DRbTCPSocket.html#M001770">accept</a>, then it closes this particular
client-server session.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001769_source')" id="l_M001769_source">show</a>
                        
                    </p>
                    <div id="M001769_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/drb/drb.rb, line 929</span>
929:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">close</span>
930:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@socket</span>
931:   <span class="ruby-ivar">@socket</span>.<span class="ruby-identifier">close</span>
932:   <span class="ruby-ivar">@socket</span> = <span class="ruby-keyword kw">nil</span>
933:       <span class="ruby-keyword kw">end</span>
934:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001762">
                    
                    <a name="M001762"></a><b>peeraddr</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Get the address of our TCP peer (the other end of the socket we are bound
to.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001762_source')" id="l_M001762_source">show</a>
                        
                    </p>
                    <div id="M001762_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/drb/drb.rb, line 894</span>
894:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">peeraddr</span>
895:       <span class="ruby-ivar">@socket</span>.<span class="ruby-identifier">peeraddr</span>
896:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001767">
                    
                    <a name="M001767"></a><b>recv_reply</b>()
                    
                </div>
                
                <div class="description">
                  <p>
On the client side, receive a reply from the server.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001767_source')" id="l_M001767_source">show</a>
                        
                    </p>
                    <div id="M001767_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/drb/drb.rb, line 917</span>
917:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">recv_reply</span>
918:       <span class="ruby-ivar">@msg</span>.<span class="ruby-identifier">recv_reply</span>(<span class="ruby-identifier">stream</span>)
919:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001765">
                    
                    <a name="M001765"></a><b>recv_request</b>()
                    
                </div>
                
                <div class="description">
                  <p>
On the server side, receive a request from the client.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001765_source')" id="l_M001765_source">show</a>
                        
                    </p>
                    <div id="M001765_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/drb/drb.rb, line 907</span>
907:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">recv_request</span>
908:       <span class="ruby-ivar">@msg</span>.<span class="ruby-identifier">recv_request</span>(<span class="ruby-identifier">stream</span>)
909:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001766">
                    
                    <a name="M001766"></a><b>send_reply</b>(succ, result)
                    
                </div>
                
                <div class="description">
                  <p>
On the server side, send a reply to the client.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001766_source')" id="l_M001766_source">show</a>
                        
                    </p>
                    <div id="M001766_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/drb/drb.rb, line 912</span>
912:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">send_reply</span>(<span class="ruby-identifier">succ</span>, <span class="ruby-identifier">result</span>)
913:       <span class="ruby-ivar">@msg</span>.<span class="ruby-identifier">send_reply</span>(<span class="ruby-identifier">stream</span>, <span class="ruby-identifier">succ</span>, <span class="ruby-identifier">result</span>)
914:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001764">
                    
                    <a name="M001764"></a><b>send_request</b>(ref, msg_id, arg, b)
                    
                </div>
                
                <div class="description">
                  <p>
On the client side, send a request to the server.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001764_source')" id="l_M001764_source">show</a>
                        
                    </p>
                    <div id="M001764_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/drb/drb.rb, line 902</span>
902:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">send_request</span>(<span class="ruby-identifier">ref</span>, <span class="ruby-identifier">msg_id</span>, <span class="ruby-identifier">arg</span>, <span class="ruby-identifier">b</span>)
903:       <span class="ruby-ivar">@msg</span>.<span class="ruby-identifier">send_request</span>(<span class="ruby-identifier">stream</span>, <span class="ruby-identifier">ref</span>, <span class="ruby-identifier">msg_id</span>, <span class="ruby-identifier">arg</span>, <span class="ruby-identifier">b</span>)
904:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001763">
                    
                    <a name="M001763"></a><b>stream</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Get the socket.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001763_source')" id="l_M001763_source">show</a>
                        
                    </p>
                    <div id="M001763_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/drb/drb.rb, line 899</span>
899:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">stream</span>; <span class="ruby-ivar">@socket</span>; <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Class Public methods</div>
            
            <div class="method">
                <div class="title" id="M001757">
                    
                    <a name="M001757"></a><b>getservername</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001757_source')" id="l_M001757_source">show</a>
                        
                    </p>
                    <div id="M001757_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/drb/drb.rb, line 830</span>
830:     <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">getservername</span>
831:       <span class="ruby-identifier">host</span> = <span class="ruby-constant">Socket</span><span class="ruby-operator">::</span><span class="ruby-identifier">gethostname</span>
832:       <span class="ruby-keyword kw">begin</span>
833:         <span class="ruby-constant">Socket</span><span class="ruby-operator">::</span><span class="ruby-identifier">gethostbyname</span>(<span class="ruby-identifier">host</span>)[<span class="ruby-value">0</span>]
834:       <span class="ruby-keyword kw">rescue</span>
835:         <span class="ruby-value str">'localhost'</span>
836:       <span class="ruby-keyword kw">end</span>
837:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001761">
                    
                    <a name="M001761"></a><b>new</b>(uri, soc, config={})
                    
                </div>
                
                <div class="description">
                  <p>
Create a new <a href="DRbTCPSocket.html">DRbTCPSocket</a> instance.
</p>
<p>
<tt>uri</tt> is the <a href="../URI.html">URI</a> we are connected to.
<tt>soc</tt> is the tcp socket we are bound to. <tt>config</tt> is our
configuration.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001761_source')" id="l_M001761_source">show</a>
                        
                    </p>
                    <div id="M001761_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/drb/drb.rb, line 880</span>
880:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">soc</span>, <span class="ruby-identifier">config</span>={})
881:       <span class="ruby-ivar">@uri</span> = <span class="ruby-identifier">uri</span>
882:       <span class="ruby-ivar">@socket</span> = <span class="ruby-identifier">soc</span>
883:       <span class="ruby-ivar">@config</span> = <span class="ruby-identifier">config</span>
884:       <span class="ruby-ivar">@acl</span> = <span class="ruby-identifier">config</span>[<span class="ruby-identifier">:tcp_acl</span>]
885:       <span class="ruby-ivar">@msg</span> = <span class="ruby-constant">DRbMessage</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">config</span>)
886:       <span class="ruby-identifier">set_sockopt</span>(<span class="ruby-ivar">@socket</span>)
887:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001756">
                    
                    <a name="M001756"></a><b>open</b>(uri, config)
                    
                </div>
                
                <div class="description">
                  <p>
Open a client connection to <tt>uri</tt> using configuration
<tt>config</tt>.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001756_source')" id="l_M001756_source">show</a>
                        
                    </p>
                    <div id="M001756_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/drb/drb.rb, line 822</span>
822:     <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">config</span>)
823:       <span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>, <span class="ruby-identifier">option</span> = <span class="ruby-identifier">parse_uri</span>(<span class="ruby-identifier">uri</span>)
824:       <span class="ruby-identifier">host</span>.<span class="ruby-identifier">untaint</span>
825:       <span class="ruby-identifier">port</span>.<span class="ruby-identifier">untaint</span>
826:       <span class="ruby-identifier">soc</span> = <span class="ruby-constant">TCPSocket</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>)
827:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">soc</span>, <span class="ruby-identifier">config</span>)
828:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001759">
                    
                    <a name="M001759"></a><b>open_server</b>(uri, config)
                    
                </div>
                
                <div class="description">
                  <p>
Open a server listening for connections at <tt>uri</tt> using configuration
<tt>config</tt>.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001759_source')" id="l_M001759_source">show</a>
                        
                    </p>
                    <div id="M001759_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/drb/drb.rb, line 853</span>
853:     <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">open_server</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">config</span>)
854:       <span class="ruby-identifier">uri</span> = <span class="ruby-value str">'druby://:0'</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">uri</span>
855:       <span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>, <span class="ruby-identifier">opt</span> = <span class="ruby-identifier">parse_uri</span>(<span class="ruby-identifier">uri</span>)
856:       <span class="ruby-identifier">config</span> = {<span class="ruby-identifier">:tcp_original_host</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">host</span>}.<span class="ruby-identifier">update</span>(<span class="ruby-identifier">config</span>)
857:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">host</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
858:         <span class="ruby-identifier">host</span> = <span class="ruby-identifier">getservername</span>
859:         <span class="ruby-identifier">soc</span> = <span class="ruby-identifier">open_server_inaddr_any</span>(<span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>)
860:       <span class="ruby-keyword kw">else</span>
861:   <span class="ruby-identifier">soc</span> = <span class="ruby-constant">TCPServer</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>)
862:       <span class="ruby-keyword kw">end</span>
863:       <span class="ruby-identifier">port</span> = <span class="ruby-identifier">soc</span>.<span class="ruby-identifier">addr</span>[<span class="ruby-value">1</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">port</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
864:       <span class="ruby-identifier">config</span>[<span class="ruby-identifier">:tcp_port</span>] = <span class="ruby-identifier">port</span>
865:       <span class="ruby-identifier">uri</span> = <span class="ruby-node">&quot;druby://#{host}:#{port}&quot;</span>
866:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">soc</span>, <span class="ruby-identifier">config</span>)
867:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001758">
                    
                    <a name="M001758"></a><b>open_server_inaddr_any</b>(host, port)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001758_source')" id="l_M001758_source">show</a>
                        
                    </p>
                    <div id="M001758_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/drb/drb.rb, line 839</span>
839:     <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">open_server_inaddr_any</span>(<span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>)
840:       <span class="ruby-identifier">infos</span> = <span class="ruby-constant">Socket</span><span class="ruby-operator">::</span><span class="ruby-identifier">getaddrinfo</span>(<span class="ruby-identifier">host</span>, <span class="ruby-keyword kw">nil</span>, 
841:                                   <span class="ruby-constant">Socket</span><span class="ruby-operator">::</span><span class="ruby-constant">AF_UNSPEC</span>,
842:                                   <span class="ruby-constant">Socket</span><span class="ruby-operator">::</span><span class="ruby-constant">SOCK_STREAM</span>, 
843:                                   <span class="ruby-value">0</span>,
844:                                   <span class="ruby-constant">Socket</span><span class="ruby-operator">::</span><span class="ruby-constant">AI_PASSIVE</span>)
845:       <span class="ruby-identifier">families</span> = <span class="ruby-constant">Hash</span>[<span class="ruby-operator">*</span><span class="ruby-identifier">infos</span>.<span class="ruby-identifier">collect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">af</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">_</span><span class="ruby-operator">|</span> <span class="ruby-identifier">af</span> }.<span class="ruby-identifier">uniq</span>.<span class="ruby-identifier">zip</span>([]).<span class="ruby-identifier">flatten</span>]
846:       <span class="ruby-keyword kw">return</span> <span class="ruby-constant">TCPServer</span>.<span class="ruby-identifier">open</span>(<span class="ruby-value str">'0.0.0.0'</span>, <span class="ruby-identifier">port</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">families</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-value str">'AF_INET'</span>)
847:       <span class="ruby-keyword kw">return</span> <span class="ruby-constant">TCPServer</span>.<span class="ruby-identifier">open</span>(<span class="ruby-value str">'::'</span>, <span class="ruby-identifier">port</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">families</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-value str">'AF_INET6'</span>)
848:       <span class="ruby-keyword kw">return</span> <span class="ruby-constant">TCPServer</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">port</span>)
849:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001760">
                    
                    <a name="M001760"></a><b>uri_option</b>(uri, config)
                    
                </div>
                
                <div class="description">
                  <p>
Parse <tt>uri</tt> into a [uri, option] pair.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001760_source')" id="l_M001760_source">show</a>
                        
                    </p>
                    <div id="M001760_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/drb/drb.rb, line 870</span>
870:     <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">uri_option</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">config</span>)
871:       <span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>, <span class="ruby-identifier">option</span> = <span class="ruby-identifier">parse_uri</span>(<span class="ruby-identifier">uri</span>)
872:       <span class="ruby-keyword kw">return</span> <span class="ruby-node">&quot;druby://#{host}:#{port}&quot;</span>, <span class="ruby-identifier">option</span>
873:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Class Private methods</div>
            
            <div class="method">
                <div class="title" id="M001753">
                    
                    <a name="M001753"></a><b>parse_uri</b>(uri)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001753_source')" id="l_M001753_source">show</a>
                        
                    </p>
                    <div id="M001753_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/drb/drb.rb, line 807</span>
807:     <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">parse_uri</span>(<span class="ruby-identifier">uri</span>)
808:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">uri</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/^druby:\/\/(.*?):(\d+)(\?(.*))?$/</span>
809:   <span class="ruby-identifier">host</span> = <span class="ruby-identifier">$1</span>
810:   <span class="ruby-identifier">port</span> = <span class="ruby-identifier">$2</span>.<span class="ruby-identifier">to_i</span>
811:   <span class="ruby-identifier">option</span> = <span class="ruby-identifier">$4</span>
812:   [<span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>, <span class="ruby-identifier">option</span>]
813:       <span class="ruby-keyword kw">else</span>
814:   <span class="ruby-identifier">raise</span>(<span class="ruby-constant">DRbBadScheme</span>, <span class="ruby-identifier">uri</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">uri</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/^druby:/</span>
815:   <span class="ruby-identifier">raise</span>(<span class="ruby-constant">DRbBadURI</span>, <span class="ruby-value str">'can\'t parse uri:'</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">uri</span>)
816:       <span class="ruby-keyword kw">end</span>
817:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    