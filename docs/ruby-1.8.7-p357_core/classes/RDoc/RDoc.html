<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>RDoc::RDoc</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../css/main.css" type="text/css" media="screen" />
    <script src="../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Class</span> 
            RDoc::RDoc 
            
                <span class="parent">&lt; 
                    
                    <a href="../Object.html">Object</a>
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../files/lib/rdoc/rdoc_rb.html">lib/rdoc/rdoc.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    
    <div class="description">
        <p>
Encapsulate the production of rdoc documentation. Basically you can use
this as you would invoke rdoc from the command line:
</p>
<pre>
   rdoc = RDoc::RDoc.new
   rdoc.document(args)
</pre>
<p>
where <em>args</em> is an array of strings, each corresponding to an
argument you&#8217;d give rdoc on the command line. See rdoc/rdoc.rb for
details.
</p>

    </div>
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>D</dt>
        <dd>
            <ul>
                
                <li><a href="#M003968">document</a></li>
                
            </ul>
        </dd>
    
        <dt>E</dt>
        <dd>
            <ul>
                
                <li><a href="#M003952">error</a>,</li>
                
                <li><a href="#M004137">extract_sections</a></li>
                
            </ul>
        </dd>
    
        <dt>F</dt>
        <dd>
            <ul>
                
                <li><a href="#M004136">find_comment</a></li>
                
            </ul>
        </dd>
    
        <dt>G</dt>
        <dd>
            <ul>
                
                <li><a href="#M004135">gets</a></li>
                
            </ul>
        </dd>
    
        <dt>L</dt>
        <dd>
            <ul>
                
                <li><a href="#M003963">list_files_in_directory</a></li>
                
            </ul>
        </dd>
    
        <dt>N</dt>
        <dd>
            <ul>
                
                <li><a href="#M004138">no_comment</a>,</li>
                
                <li><a href="#M003961">normalized_file_list</a></li>
                
            </ul>
        </dd>
    
        <dt>O</dt>
        <dd>
            <ul>
                
                <li><a href="#M003957">output_flag_file</a></li>
                
            </ul>
        </dd>
    
        <dt>P</dt>
        <dd>
            <ul>
                
                <li><a href="#M003958">parse_dot_doc_file</a>,</li>
                
                <li><a href="#M003965">parse_files</a></li>
                
            </ul>
        </dd>
    
        <dt>S</dt>
        <dd>
            <ul>
                
                <li><a href="#M003954">setup_output_dir</a></li>
                
            </ul>
        </dd>
    
        <dt>U</dt>
        <dd>
            <ul>
                
                <li><a href="#M003956">update_output_dir</a>,</li>
                
                <li><a href="#M004131">usage</a>,</li>
                
                <li><a href="#M004132">usage_no_exit</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    

    

    

    
    <div class="sectiontitle">Constants</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class="attr-name">Generator</td>
            <td>=</td>
            <td class="attr-value">Struct.new(:file_name, :class_name, :key)</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
This is the list of output generators that we support
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">GENERATORS</td>
            <td>=</td>
            <td class="attr-value">{}</td>
        </tr>
        
        
    </table>
    

    

    
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M003968">
                    
                    <a name="M003968"></a><b>document</b>(argv)
                    
                </div>
                
                <div class="description">
                  <p>
Format up one or more files according to the given arguments. For
simplicity, <em>argv</em> is an array of strings, equivalent to the strings
that would be passed on the command line. (This isn&#8217;t a coincidence,
as we <em>do</em> pass in ARGV when running interactively). For a list of
options, see rdoc/rdoc.rb. By default, output will be stored in a directory
called <tt>doc</tt> below the current directory, so make sure you&#8217;re
somewhere writable before invoking.
</p>
<p>
Throws: <a href="RDocError.html">RDocError</a> on error
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M003968_source')" id="l_M003968_source">show</a>
                        
                    </p>
                    <div id="M003968_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rdoc/rdoc.rb, line 249</span>
249:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">document</span>(<span class="ruby-identifier">argv</span>)
250: 
251:       <span class="ruby-constant">TopLevel</span><span class="ruby-operator">::</span><span class="ruby-identifier">reset</span>
252: 
253:       <span class="ruby-ivar">@stats</span> = <span class="ruby-constant">Stats</span>.<span class="ruby-identifier">new</span>
254: 
255:       <span class="ruby-identifier">options</span> = <span class="ruby-constant">Options</span>.<span class="ruby-identifier">instance</span>
256:       <span class="ruby-identifier">options</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">argv</span>, <span class="ruby-constant">GENERATORS</span>)
257: 
258:       <span class="ruby-ivar">@last_created</span> = <span class="ruby-keyword kw">nil</span>
259:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">options</span>.<span class="ruby-identifier">all_one_file</span>
260:         <span class="ruby-ivar">@last_created</span> = <span class="ruby-identifier">setup_output_dir</span>(<span class="ruby-identifier">options</span>.<span class="ruby-identifier">op_dir</span>, <span class="ruby-identifier">options</span>.<span class="ruby-identifier">force_update</span>)
261:       <span class="ruby-keyword kw">end</span>
262:       <span class="ruby-identifier">start_time</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
263: 
264:       <span class="ruby-identifier">file_info</span> = <span class="ruby-identifier">parse_files</span>(<span class="ruby-identifier">options</span>)
265: 
266:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">file_info</span>.<span class="ruby-identifier">empty?</span>
267:         <span class="ruby-identifier">$stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;\nNo newer files.&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">options</span>.<span class="ruby-identifier">quiet</span>
268:       <span class="ruby-keyword kw">else</span>
269:         <span class="ruby-identifier">gen</span> = <span class="ruby-identifier">options</span>.<span class="ruby-identifier">generator</span>
270: 
271:         <span class="ruby-identifier">$stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;\nGenerating #{gen.key.upcase}...&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">options</span>.<span class="ruby-identifier">quiet</span>
272: 
273:         <span class="ruby-identifier">require</span> <span class="ruby-identifier">gen</span>.<span class="ruby-identifier">file_name</span>
274: 
275:         <span class="ruby-identifier">gen_class</span> = <span class="ruby-constant">Generators</span>.<span class="ruby-identifier">const_get</span>(<span class="ruby-identifier">gen</span>.<span class="ruby-identifier">class_name</span>)
276:         <span class="ruby-identifier">gen</span> = <span class="ruby-identifier">gen_class</span>.<span class="ruby-identifier">for</span>(<span class="ruby-identifier">options</span>)
277: 
278:         <span class="ruby-identifier">pwd</span> = <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">pwd</span>
279: 
280:         <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">chdir</span>(<span class="ruby-identifier">options</span>.<span class="ruby-identifier">op_dir</span>)  <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">options</span>.<span class="ruby-identifier">all_one_file</span>
281: 
282:         <span class="ruby-keyword kw">begin</span>
283:           <span class="ruby-constant">Diagram</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">file_info</span>, <span class="ruby-identifier">options</span>).<span class="ruby-identifier">draw</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>.<span class="ruby-identifier">diagram</span>
284:           <span class="ruby-identifier">gen</span>.<span class="ruby-identifier">generate</span>(<span class="ruby-identifier">file_info</span>)
285:           <span class="ruby-identifier">update_output_dir</span>(<span class="ruby-value str">&quot;.&quot;</span>, <span class="ruby-identifier">start_time</span>)
286:         <span class="ruby-keyword kw">ensure</span>
287:           <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">chdir</span>(<span class="ruby-identifier">pwd</span>)
288:         <span class="ruby-keyword kw">end</span>
289:       <span class="ruby-keyword kw">end</span>
290: 
291:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">options</span>.<span class="ruby-identifier">quiet</span>
292:         <span class="ruby-identifier">puts</span>
293:         <span class="ruby-ivar">@stats</span>.<span class="ruby-identifier">print</span>
294:       <span class="ruby-keyword kw">end</span>
295:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Private methods</div>
            
            <div class="method">
                <div class="title" id="M003952">
                    
                    <a name="M003952"></a><b>error</b>(msg)
                    
                </div>
                
                <div class="description">
                  <p>
Report an error message and exit
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M003952_source')" id="l_M003952_source">show</a>
                        
                    </p>
                    <div id="M003952_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rdoc/rdoc.rb, line 100</span>
100:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">error</span>(<span class="ruby-identifier">msg</span>)
101:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">RDocError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">msg</span>)
102:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M003963">
                    
                    <a name="M003963"></a><b>list_files_in_directory</b>(dir, options)
                    
                </div>
                
                <div class="description">
                  <p>
Return a list of the files to be processed in a directory. We know that
this directory doesn&#8217;t have a .document file, so we&#8217;re looking
for real files. However we may well contain subdirectories which must be
tested for .document files
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M003963_source')" id="l_M003963_source">show</a>
                        
                    </p>
                    <div id="M003963_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rdoc/rdoc.rb, line 202</span>
202:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">list_files_in_directory</span>(<span class="ruby-identifier">dir</span>, <span class="ruby-identifier">options</span>)
203:       <span class="ruby-identifier">normalized_file_list</span>(<span class="ruby-identifier">options</span>, <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">glob</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">dir</span>, <span class="ruby-value str">&quot;*&quot;</span>)), <span class="ruby-keyword kw">false</span>, <span class="ruby-identifier">options</span>.<span class="ruby-identifier">exclude</span>)
204:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M003961">
                    
                    <a name="M003961"></a><b>normalized_file_list</b>(options, relative_files, force_doc = false, exclude_pattern=nil)
                    
                </div>
                
                <div class="description">
                  <p>
Given a list of files and directories, create a list of all the Ruby files
they contain.
</p>
<p>
If <tt>force_doc</tt> is true, we always add the given files. If false,
only add files that we guarantee we can parse It is true when looking at
files given on the command line, false when recursing through
subdirectories.
</p>
<p>
The effect of this is that if you want a file with a non- standard
extension parsed, you must name it explicity.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M003961_source')" id="l_M003961_source">show</a>
                        
                    </p>
                    <div id="M003961_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rdoc/rdoc.rb, line 172</span>
172:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">normalized_file_list</span>(<span class="ruby-identifier">options</span>, <span class="ruby-identifier">relative_files</span>, <span class="ruby-identifier">force_doc</span> = <span class="ruby-keyword kw">false</span>, <span class="ruby-identifier">exclude_pattern</span>=<span class="ruby-keyword kw">nil</span>)
173:       <span class="ruby-identifier">file_list</span> = []
174: 
175:       <span class="ruby-identifier">relative_files</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">rel_file_name</span><span class="ruby-operator">|</span>
176:         <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">exclude_pattern</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">exclude_pattern</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">rel_file_name</span>
177:         <span class="ruby-identifier">stat</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">stat</span>(<span class="ruby-identifier">rel_file_name</span>)
178:         <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">type</span> = <span class="ruby-identifier">stat</span>.<span class="ruby-identifier">ftype</span>
179:         <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;file&quot;</span>
180:           <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@last_created</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">stat</span>.<span class="ruby-identifier">mtime</span> <span class="ruby-operator">&lt;</span> <span class="ruby-ivar">@last_created</span>
181:           <span class="ruby-identifier">file_list</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">rel_file_name</span>.<span class="ruby-identifier">sub</span>(<span class="ruby-regexp re">/^\.\//</span>, <span class="ruby-value str">''</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">force_doc</span> <span class="ruby-operator">||</span> <span class="ruby-constant">ParserFactory</span>.<span class="ruby-identifier">can_parse</span>(<span class="ruby-identifier">rel_file_name</span>)
182:         <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;directory&quot;</span>
183:           <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">rel_file_name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;CVS&quot;</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">rel_file_name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;.svn&quot;</span>
184:           <span class="ruby-identifier">dot_doc</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">rel_file_name</span>, <span class="ruby-constant">DOT_DOC_FILENAME</span>)
185:           <span class="ruby-keyword kw">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">file?</span>(<span class="ruby-identifier">dot_doc</span>)
186:             <span class="ruby-identifier">file_list</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-identifier">parse_dot_doc_file</span>(<span class="ruby-identifier">rel_file_name</span>, <span class="ruby-identifier">dot_doc</span>, <span class="ruby-identifier">options</span>))
187:           <span class="ruby-keyword kw">else</span>
188:             <span class="ruby-identifier">file_list</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-identifier">list_files_in_directory</span>(<span class="ruby-identifier">rel_file_name</span>, <span class="ruby-identifier">options</span>))
189:           <span class="ruby-keyword kw">end</span>
190:         <span class="ruby-keyword kw">else</span>
191:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">RDocError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;I can't deal with a #{type} #{rel_file_name}&quot;</span>)
192:         <span class="ruby-keyword kw">end</span>
193:       <span class="ruby-keyword kw">end</span>
194:       <span class="ruby-identifier">file_list</span>
195:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M003957">
                    
                    <a name="M003957"></a><b>output_flag_file</b>(op_dir)
                    
                </div>
                
                <div class="description">
                  <p>
Return the path name of the flag file in an output directory.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M003957_source')" id="l_M003957_source">show</a>
                        
                    </p>
                    <div id="M003957_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rdoc/rdoc.rb, line 139</span>
139:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">output_flag_file</span>(<span class="ruby-identifier">op_dir</span>)
140:       <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">op_dir</span>, <span class="ruby-value str">&quot;created.rid&quot;</span>)
141:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M003958">
                    
                    <a name="M003958"></a><b>parse_dot_doc_file</b>(in_dir, filename, options)
                    
                </div>
                
                <div class="description">
                  <p>
The .document file contains a list of file and directory name patterns,
representing candidates for documentation. It may also contain comments
(starting with &#8217;#&#8217;)
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M003958_source')" id="l_M003958_source">show</a>
                        
                    </p>
                    <div id="M003958_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rdoc/rdoc.rb, line 146</span>
146:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">parse_dot_doc_file</span>(<span class="ruby-identifier">in_dir</span>, <span class="ruby-identifier">filename</span>, <span class="ruby-identifier">options</span>)
147:       <span class="ruby-comment cmt"># read and strip comments</span>
148:       <span class="ruby-identifier">patterns</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span>(<span class="ruby-identifier">filename</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/#.*/</span>, <span class="ruby-value str">''</span>)
149: 
150:       <span class="ruby-identifier">result</span> = []
151: 
152:       <span class="ruby-identifier">patterns</span>.<span class="ruby-identifier">split</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">patt</span><span class="ruby-operator">|</span>
153:         <span class="ruby-identifier">candidates</span> = <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">glob</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">in_dir</span>, <span class="ruby-identifier">patt</span>))
154:         <span class="ruby-identifier">result</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-identifier">normalized_file_list</span>(<span class="ruby-identifier">options</span>,  <span class="ruby-identifier">candidates</span>))
155:       <span class="ruby-keyword kw">end</span>
156:       <span class="ruby-identifier">result</span>
157:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M003965">
                    
                    <a name="M003965"></a><b>parse_files</b>(options)
                    
                </div>
                
                <div class="description">
                  <p>
Parse each file on the command line, recursively entering directories
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M003965_source')" id="l_M003965_source">show</a>
                        
                    </p>
                    <div id="M003965_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rdoc/rdoc.rb, line 210</span>
210:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">parse_files</span>(<span class="ruby-identifier">options</span>)
211:  
212:       <span class="ruby-identifier">file_info</span> = []
213: 
214:       <span class="ruby-identifier">files</span> = <span class="ruby-identifier">options</span>.<span class="ruby-identifier">files</span>
215:       <span class="ruby-identifier">files</span> = [<span class="ruby-value str">&quot;.&quot;</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">files</span>.<span class="ruby-identifier">empty?</span>
216: 
217:       <span class="ruby-identifier">file_list</span> = <span class="ruby-identifier">normalized_file_list</span>(<span class="ruby-identifier">options</span>, <span class="ruby-identifier">files</span>, <span class="ruby-keyword kw">true</span>)
218: 
219:       <span class="ruby-identifier">file_list</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">fn</span><span class="ruby-operator">|</span>
220:         <span class="ruby-identifier">$stderr</span>.<span class="ruby-identifier">printf</span>(<span class="ruby-value str">&quot;\n%35s: &quot;</span>, <span class="ruby-constant">File</span>.<span class="ruby-identifier">basename</span>(<span class="ruby-identifier">fn</span>)) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">options</span>.<span class="ruby-identifier">quiet</span>
221:         
222:         <span class="ruby-identifier">content</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">fn</span>, <span class="ruby-value str">&quot;r&quot;</span>) {<span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span> <span class="ruby-identifier">f</span>.<span class="ruby-identifier">read</span>}
223: 
224:         <span class="ruby-identifier">top_level</span> = <span class="ruby-constant">TopLevel</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">fn</span>)
225:         <span class="ruby-identifier">parser</span> = <span class="ruby-constant">ParserFactory</span>.<span class="ruby-identifier">parser_for</span>(<span class="ruby-identifier">top_level</span>, <span class="ruby-identifier">fn</span>, <span class="ruby-identifier">content</span>, <span class="ruby-identifier">options</span>, <span class="ruby-ivar">@stats</span>)
226:         <span class="ruby-identifier">file_info</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">parser</span>.<span class="ruby-identifier">scan</span>
227:         <span class="ruby-ivar">@stats</span>.<span class="ruby-identifier">num_files</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
228:       <span class="ruby-keyword kw">end</span>
229: 
230:       <span class="ruby-identifier">file_info</span>
231:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M003954">
                    
                    <a name="M003954"></a><b>setup_output_dir</b>(op_dir, force)
                    
                </div>
                
                <div class="description">
                  <p>
Create an output dir if it doesn&#8217;t exist. If it does exist, but
doesn&#8217;t contain the flag file <tt>created.rid</tt> then we refuse to
use it, as we may clobber some manually generated documentation
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M003954_source')" id="l_M003954_source">show</a>
                        
                    </p>
                    <div id="M003954_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rdoc/rdoc.rb, line 110</span>
110:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">setup_output_dir</span>(<span class="ruby-identifier">op_dir</span>, <span class="ruby-identifier">force</span>)
111:       <span class="ruby-identifier">flag_file</span> = <span class="ruby-identifier">output_flag_file</span>(<span class="ruby-identifier">op_dir</span>)
112:       <span class="ruby-keyword kw">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">op_dir</span>)
113:         <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">directory?</span>(<span class="ruby-identifier">op_dir</span>)
114:           <span class="ruby-identifier">error</span> <span class="ruby-node">&quot;'#{op_dir}' exists, and is not a directory&quot;</span> 
115:         <span class="ruby-keyword kw">end</span>
116:         <span class="ruby-keyword kw">begin</span>
117:           <span class="ruby-identifier">created</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span>(<span class="ruby-identifier">flag_file</span>)
118:         <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">SystemCallError</span>
119:           <span class="ruby-identifier">error</span> <span class="ruby-node">&quot;\nDirectory #{op_dir} already exists, but it looks like it\n&quot;</span> <span class="ruby-operator">+</span>
120:             <span class="ruby-value str">&quot;isn't an RDoc directory. Because RDoc doesn't want to risk\n&quot;</span> <span class="ruby-operator">+</span>
121:             <span class="ruby-value str">&quot;destroying any of your existing files, you'll need to\n&quot;</span> <span class="ruby-operator">+</span>
122:             <span class="ruby-value str">&quot;specify a different output directory name (using the\n&quot;</span> <span class="ruby-operator">+</span>
123:             <span class="ruby-value str">&quot;--op &lt;dir&gt; option).\n\n&quot;</span>
124:         <span class="ruby-keyword kw">else</span>
125:           <span class="ruby-identifier">last</span> = (<span class="ruby-constant">Time</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">created</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">force</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>)
126:         <span class="ruby-keyword kw">end</span>
127:       <span class="ruby-keyword kw">else</span>
128:         <span class="ruby-constant">File</span>.<span class="ruby-identifier">makedirs</span>(<span class="ruby-identifier">op_dir</span>)
129:       <span class="ruby-keyword kw">end</span>
130:       <span class="ruby-identifier">last</span>
131:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M003956">
                    
                    <a name="M003956"></a><b>update_output_dir</b>(op_dir, time)
                    
                </div>
                
                <div class="description">
                  <p>
Update the flag file in an output directory.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M003956_source')" id="l_M003956_source">show</a>
                        
                    </p>
                    <div id="M003956_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rdoc/rdoc.rb, line 134</span>
134:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update_output_dir</span>(<span class="ruby-identifier">op_dir</span>, <span class="ruby-identifier">time</span>)
135:       <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">output_flag_file</span>(<span class="ruby-identifier">op_dir</span>), <span class="ruby-value str">&quot;w&quot;</span>) {<span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span> <span class="ruby-identifier">f</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">time</span>.<span class="ruby-identifier">rfc2822</span> }
136:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Class Public methods</div>
            
            <div class="method">
                <div class="title" id="M004137">
                    
                    <a name="M004137"></a><b>extract_sections</b>(flow, sections)
                    
                </div>
                
                <div class="description">
                  <p>
Given an array of flow items and an array of section names, extract those
sections from the flow which have headings corresponding to a section name
in the list. Return them in the order of names in the <tt>sections</tt>
array.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M004137_source')" id="l_M004137_source">show</a>
                        
                    </p>
                    <div id="M004137_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rdoc/usage.rb, line 165</span>
165:   <span class="ruby-keyword kw">def</span> <span class="ruby-constant">RDoc</span>.<span class="ruby-identifier">extract_sections</span>(<span class="ruby-identifier">flow</span>, <span class="ruby-identifier">sections</span>)
166:     <span class="ruby-identifier">result</span> = []
167:     <span class="ruby-identifier">sections</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">name</span><span class="ruby-operator">|</span>
168:       <span class="ruby-identifier">name</span> = <span class="ruby-identifier">name</span>.<span class="ruby-identifier">downcase</span>
169:       <span class="ruby-identifier">copy_upto_level</span> = <span class="ruby-keyword kw">nil</span>
170: 
171:       <span class="ruby-identifier">flow</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">item</span><span class="ruby-operator">|</span>
172:         <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">item</span>
173:         <span class="ruby-keyword kw">when</span> <span class="ruby-constant">SM</span><span class="ruby-operator">::</span><span class="ruby-constant">Flow</span><span class="ruby-operator">::</span><span class="ruby-constant">H</span>
174:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">copy_upto_level</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">item</span>.<span class="ruby-identifier">level</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">copy_upto_level</span>
175:             <span class="ruby-identifier">copy_upto_level</span> = <span class="ruby-keyword kw">nil</span>
176:           <span class="ruby-keyword kw">else</span>
177:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">item</span>.<span class="ruby-identifier">text</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">name</span>
178:               <span class="ruby-identifier">result</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">item</span>
179:               <span class="ruby-identifier">copy_upto_level</span> = <span class="ruby-identifier">item</span>.<span class="ruby-identifier">level</span>
180:             <span class="ruby-keyword kw">end</span>
181:           <span class="ruby-keyword kw">end</span>
182:         <span class="ruby-keyword kw">else</span>
183:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">copy_upto_level</span>
184:             <span class="ruby-identifier">result</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">item</span>
185:           <span class="ruby-keyword kw">end</span>
186:         <span class="ruby-keyword kw">end</span>
187:       <span class="ruby-keyword kw">end</span>
188:     <span class="ruby-keyword kw">end</span>
189:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">result</span>.<span class="ruby-identifier">empty?</span>
190:       <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Note to developer: requested section(s) [#{sections.join(', ')}] &quot;</span> <span class="ruby-operator">+</span>
191:            <span class="ruby-value str">&quot;not found&quot;</span>
192:       <span class="ruby-identifier">result</span> = <span class="ruby-identifier">flow</span>
193:     <span class="ruby-keyword kw">end</span>
194:     <span class="ruby-identifier">result</span>
195:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M004136">
                    
                    <a name="M004136"></a><b>find_comment</b>(file)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M004136_source')" id="l_M004136_source">show</a>
                        
                    </p>
                    <div id="M004136_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rdoc/usage.rb, line 141</span>
141:   <span class="ruby-keyword kw">def</span> <span class="ruby-constant">RDoc</span>.<span class="ruby-identifier">find_comment</span>(<span class="ruby-identifier">file</span>)
142:     <span class="ruby-identifier">catch</span>(<span class="ruby-identifier">:exit</span>) <span class="ruby-keyword kw">do</span>
143:       <span class="ruby-comment cmt"># skip leading blank lines</span>
144:       <span class="ruby-value">0</span> <span class="ruby-keyword kw">while</span> (<span class="ruby-identifier">line</span> = <span class="ruby-identifier">gets</span>(<span class="ruby-identifier">file</span>)) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">line</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/^\s*$/</span>)
145: 
146:       <span class="ruby-identifier">comment</span> = []
147:       <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">line</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">line</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/^\s*#/</span>
148:         <span class="ruby-identifier">comment</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">line</span>
149:         <span class="ruby-identifier">line</span> = <span class="ruby-identifier">gets</span>(<span class="ruby-identifier">file</span>)
150:       <span class="ruby-keyword kw">end</span>
151: 
152:       <span class="ruby-value">0</span> <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">line</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">line</span> = <span class="ruby-identifier">gets</span>(<span class="ruby-identifier">file</span>))
153:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">no_comment</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">comment</span>.<span class="ruby-identifier">empty?</span>
154:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">comment</span>.<span class="ruby-identifier">join</span>
155:     <span class="ruby-keyword kw">end</span>
156:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M004135">
                    
                    <a name="M004135"></a><b>gets</b>(file)
                    
                </div>
                
                <div class="description">
                  <p>
<a href="../Find.html">Find</a> the first comment in the file (that
isn&#8217;t a shebang line) If the file doesn&#8217;t start with a comment,
report the fact and return empty string
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M004135_source')" id="l_M004135_source">show</a>
                        
                    </p>
                    <div id="M004135_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rdoc/usage.rb, line 133</span>
133:   <span class="ruby-keyword kw">def</span> <span class="ruby-constant">RDoc</span>.<span class="ruby-identifier">gets</span>(<span class="ruby-identifier">file</span>)
134:     <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">line</span> = <span class="ruby-identifier">file</span>.<span class="ruby-identifier">gets</span>) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">line</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/^#!/</span>) <span class="ruby-comment cmt"># shebang</span>
135:       <span class="ruby-identifier">throw</span> <span class="ruby-identifier">:exit</span>, <span class="ruby-identifier">find_comment</span>(<span class="ruby-identifier">file</span>)
136:     <span class="ruby-keyword kw">else</span>
137:       <span class="ruby-identifier">line</span>
138:     <span class="ruby-keyword kw">end</span>
139:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M004138">
                    
                    <a name="M004138"></a><b>no_comment</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Report the fact that no doc comment count be found
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M004138_source')" id="l_M004138_source">show</a>
                        
                    </p>
                    <div id="M004138_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rdoc/usage.rb, line 199</span>
199:   <span class="ruby-keyword kw">def</span> <span class="ruby-constant">RDoc</span>.<span class="ruby-identifier">no_comment</span>
200:     <span class="ruby-identifier">$stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;No usage information available for this program&quot;</span>
201:     <span class="ruby-value str">&quot;&quot;</span>
202:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M004131">
                    
                    <a name="M004131"></a><b>usage</b>(*args)
                    
                </div>
                
                <div class="description">
                  <p>
Display usage information from the comment at the top of the file. <a
href="../String.html">String</a> arguments identify specific sections of
the comment to display. An optional integer first argument specifies the
exit status (defaults to 0)
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M004131_source')" id="l_M004131_source">show</a>
                        
                    </p>
                    <div id="M004131_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/rdoc/usage.rb, line 81</span>
81:   <span class="ruby-keyword kw">def</span> <span class="ruby-constant">RDoc</span>.<span class="ruby-identifier">usage</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
82:     <span class="ruby-identifier">exit_code</span> = <span class="ruby-value">0</span>
83: 
84:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
85:       <span class="ruby-identifier">status</span> = <span class="ruby-identifier">args</span>[<span class="ruby-value">0</span>]
86:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">status</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:to_int</span>)
87:         <span class="ruby-identifier">exit_code</span> = <span class="ruby-identifier">status</span>.<span class="ruby-identifier">to_int</span>
88:         <span class="ruby-identifier">args</span>.<span class="ruby-identifier">shift</span>
89:       <span class="ruby-keyword kw">end</span>
90:     <span class="ruby-keyword kw">end</span>
91: 
92:     <span class="ruby-comment cmt"># display the usage and exit with the given code</span>
93:     <span class="ruby-identifier">usage_no_exit</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
94:     <span class="ruby-identifier">exit</span>(<span class="ruby-identifier">exit_code</span>)
95:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M004132">
                    
                    <a name="M004132"></a><b>usage_no_exit</b>(*args)
                    
                </div>
                
                <div class="description">
                  <p>
Display usage
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M004132_source')" id="l_M004132_source">show</a>
                        
                    </p>
                    <div id="M004132_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rdoc/usage.rb, line 98</span>
 98:   <span class="ruby-keyword kw">def</span> <span class="ruby-constant">RDoc</span>.<span class="ruby-identifier">usage_no_exit</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
 99:     <span class="ruby-identifier">main_program_file</span> = <span class="ruby-identifier">caller</span>[<span class="ruby-value">-1</span>].<span class="ruby-identifier">sub</span>(<span class="ruby-regexp re">/:\d+$/</span>, <span class="ruby-value str">''</span>)
100:     <span class="ruby-identifier">comment</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">main_program_file</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span>
101:       <span class="ruby-identifier">find_comment</span>(<span class="ruby-identifier">file</span>)
102:     <span class="ruby-keyword kw">end</span>
103: 
104:     <span class="ruby-identifier">comment</span> = <span class="ruby-identifier">comment</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/^\s*#/</span>, <span class="ruby-value str">''</span>)
105: 
106:     <span class="ruby-identifier">markup</span> = <span class="ruby-constant">SM</span><span class="ruby-operator">::</span><span class="ruby-constant">SimpleMarkup</span>.<span class="ruby-identifier">new</span>
107:     <span class="ruby-identifier">flow_convertor</span> = <span class="ruby-constant">SM</span><span class="ruby-operator">::</span><span class="ruby-constant">ToFlow</span>.<span class="ruby-identifier">new</span>
108:     
109:     <span class="ruby-identifier">flow</span> = <span class="ruby-identifier">markup</span>.<span class="ruby-identifier">convert</span>(<span class="ruby-identifier">comment</span>, <span class="ruby-identifier">flow_convertor</span>)
110: 
111:     <span class="ruby-identifier">format</span> = <span class="ruby-value str">&quot;plain&quot;</span>
112: 
113:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">empty?</span>
114:       <span class="ruby-identifier">flow</span> = <span class="ruby-identifier">extract_sections</span>(<span class="ruby-identifier">flow</span>, <span class="ruby-identifier">args</span>)
115:     <span class="ruby-keyword kw">end</span>
116: 
117:     <span class="ruby-identifier">options</span> = <span class="ruby-constant">RI</span><span class="ruby-operator">::</span><span class="ruby-constant">Options</span>.<span class="ruby-identifier">instance</span>
118:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ENV</span>[<span class="ruby-value str">&quot;RI&quot;</span>]
119:       <span class="ruby-identifier">options</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">args</span>.<span class="ruby-identifier">split</span>)
120:     <span class="ruby-keyword kw">end</span>
121:     <span class="ruby-identifier">formatter</span> = <span class="ruby-identifier">options</span>.<span class="ruby-identifier">formatter</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">options</span>, <span class="ruby-value str">&quot;&quot;</span>)
122:     <span class="ruby-identifier">formatter</span>.<span class="ruby-identifier">display_flow</span>(<span class="ruby-identifier">flow</span>)
123:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    