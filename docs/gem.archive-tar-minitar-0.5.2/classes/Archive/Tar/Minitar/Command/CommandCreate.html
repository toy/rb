<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>Archive::Tar::Minitar::Command::CommandCreate</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../../../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../../../../css/main.css" type="text/css" media="screen" />
    <script src="../../../../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Class</span> 
            Archive::Tar::Minitar::Command::CommandCreate 
            
                <span class="parent">&lt; 
                    
                    CommandPattern
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../../../../files/lib/archive/tar/minitar/command_rb.html">lib/archive/tar/minitar/command.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>A</dt>
        <dd>
            <ul>
                
                <li><a href="#M000047">altname</a></li>
                
            </ul>
        </dd>
    
        <dt>C</dt>
        <dd>
            <ul>
                
                <li><a href="#M000048">call</a></li>
                
            </ul>
        </dd>
    
        <dt>H</dt>
        <dd>
            <ul>
                
                <li><a href="#M000054">help</a></li>
                
            </ul>
        </dd>
    
        <dt>N</dt>
        <dd>
            <ul>
                
                <li><a href="#M000046">name</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    

    

    

    

    

    
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M000047">
                    
                    <a name="M000047"></a><b>altname</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000047_source')" id="l_M000047_source">show</a>
                        
                    </p>
                    <div id="M000047_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/archive/tar/minitar/command.rb, line 365</span>
365:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">altname</span>
366:       <span class="ruby-value str">&quot;cr&quot;</span>
367:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000048">
                    
                    <a name="M000048"></a><b>call</b>(args, opts = {}, ioe = {})
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000048_source')" id="l_M000048_source">show</a>
                        
                    </p>
                    <div id="M000048_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/archive/tar/minitar/command.rb, line 369</span>
369:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">call</span>(<span class="ruby-identifier">args</span>, <span class="ruby-identifier">opts</span> = {}, <span class="ruby-identifier">ioe</span> = {})
370:       <span class="ruby-identifier">argv</span>    = []
371: 
372:       <span class="ruby-keyword kw">while</span> (<span class="ruby-identifier">arg</span> = <span class="ruby-identifier">args</span>.<span class="ruby-identifier">shift</span>)
373:         <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">arg</span>
374:         <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'--compress'</span>, <span class="ruby-value str">'-z'</span>
375:           <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:compress</span>] = <span class="ruby-keyword kw">true</span>
376:         <span class="ruby-keyword kw">else</span>
377:           <span class="ruby-identifier">argv</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">arg</span>
378:         <span class="ruby-keyword kw">end</span>
379:       <span class="ruby-keyword kw">end</span>
380: 
381:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">argv</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">2</span>
382:         <span class="ruby-identifier">ioe</span>[<span class="ruby-identifier">:output</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;Not enough arguments.\n\n&quot;</span>
383:         <span class="ruby-constant">CommandPattern</span>[<span class="ruby-value str">&quot;help&quot;</span>][[<span class="ruby-value str">&quot;create&quot;</span>]]
384:         <span class="ruby-keyword kw">return</span> <span class="ruby-value">255</span>
385:       <span class="ruby-keyword kw">end</span>
386: 
387:       <span class="ruby-identifier">output</span> = <span class="ruby-identifier">argv</span>.<span class="ruby-identifier">shift</span>
388:       <span class="ruby-keyword kw">if</span> <span class="ruby-value str">'-'</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">output</span>
389:         <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:name</span>] = <span class="ruby-value str">&quot;STDOUT&quot;</span>
390:         <span class="ruby-identifier">output</span> = <span class="ruby-identifier">ioe</span>[<span class="ruby-identifier">:output</span>]
391:         <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:output</span>] = <span class="ruby-identifier">ioe</span>[<span class="ruby-identifier">:error</span>]
392:       <span class="ruby-keyword kw">else</span>
393:         <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:name</span>] = <span class="ruby-identifier">output</span>
394:         <span class="ruby-identifier">output</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">output</span>, <span class="ruby-value str">&quot;wb&quot;</span>)
395:         <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:output</span>] = <span class="ruby-identifier">ioe</span>[<span class="ruby-identifier">:output</span>]
396:       <span class="ruby-keyword kw">end</span>
397: 
398:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:name</span>] <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/\.tar\.gz$|\.tgz$/</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:compress</span>]
399:         <span class="ruby-identifier">output</span> = <span class="ruby-constant">Zlib</span><span class="ruby-operator">::</span><span class="ruby-constant">GzipWriter</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">output</span>)
400:       <span class="ruby-keyword kw">end</span>
401: 
402:       <span class="ruby-identifier">files</span> = []
403:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">argv</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-value str">&quot;--&quot;</span>)
404:           <span class="ruby-comment cmt"># Read stdin for the list of files.</span>
405:         <span class="ruby-identifier">files</span> = <span class="ruby-value str">&quot;&quot;</span>
406:         <span class="ruby-identifier">files</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">ioe</span>[<span class="ruby-identifier">:input</span>].<span class="ruby-identifier">read</span> <span class="ruby-keyword kw">while</span> <span class="ruby-keyword kw">not</span> <span class="ruby-identifier">ioe</span>[<span class="ruby-identifier">:input</span>].<span class="ruby-identifier">eof?</span>
407:         <span class="ruby-identifier">files</span> = <span class="ruby-identifier">files</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp re">/\r\n|\n|\r/</span>)
408:         <span class="ruby-identifier">args</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value str">&quot;--&quot;</span>)
409:       <span class="ruby-keyword kw">end</span>
410: 
411:       <span class="ruby-identifier">files</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">argv</span>.<span class="ruby-identifier">to_a</span>
412:       <span class="ruby-identifier">files</span>.<span class="ruby-identifier">flatten!</span>
413: 
414:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:verbose</span>]
415:         <span class="ruby-identifier">watcher</span> = <span class="ruby-identifier">lambda</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">action</span>, <span class="ruby-identifier">name</span>, <span class="ruby-identifier">stats</span><span class="ruby-operator">|</span>
416:           <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:output</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;#{name}\n&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">action</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:dir</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">action</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:file_done</span>
417:         <span class="ruby-keyword kw">end</span>
418:         <span class="ruby-identifier">finisher</span> = <span class="ruby-identifier">lambda</span> { <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:output</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;\n&quot;</span> }
419:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:progress</span>]
420:         <span class="ruby-identifier">progress</span> = <span class="ruby-constant">ProgressBar</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:name</span>], <span class="ruby-value">1</span>)
421:         <span class="ruby-identifier">watcher</span> = <span class="ruby-identifier">lambda</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">action</span>, <span class="ruby-identifier">name</span>, <span class="ruby-identifier">stats</span><span class="ruby-operator">|</span>
422:           <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">action</span>
423:           <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:file_start</span>, <span class="ruby-identifier">:dir</span>
424:             <span class="ruby-identifier">progress</span>.<span class="ruby-identifier">title</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">basename</span>(<span class="ruby-identifier">name</span>)
425:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">action</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:dir</span>
426:               <span class="ruby-identifier">progress</span>.<span class="ruby-identifier">total</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
427:               <span class="ruby-identifier">progress</span>.<span class="ruby-identifier">inc</span>
428:             <span class="ruby-keyword kw">else</span>
429:               <span class="ruby-identifier">progress</span>.<span class="ruby-identifier">total</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">stats</span>[<span class="ruby-identifier">:size</span>]
430:             <span class="ruby-keyword kw">end</span>
431:           <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:file_progress</span>
432:             <span class="ruby-identifier">progress</span>.<span class="ruby-identifier">inc</span>(<span class="ruby-identifier">stats</span>[<span class="ruby-identifier">:currinc</span>])
433:           <span class="ruby-keyword kw">end</span>
434:         <span class="ruby-keyword kw">end</span>
435:         <span class="ruby-identifier">finisher</span> = <span class="ruby-identifier">lambda</span> <span class="ruby-keyword kw">do</span>
436:           <span class="ruby-identifier">progress</span>.<span class="ruby-identifier">title</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:name</span>]
437:           <span class="ruby-identifier">progress</span>.<span class="ruby-identifier">finish</span>
438:         <span class="ruby-keyword kw">end</span>
439:       <span class="ruby-keyword kw">else</span>
440:         <span class="ruby-identifier">watcher</span> = <span class="ruby-keyword kw">nil</span>
441:         <span class="ruby-identifier">finisher</span> = <span class="ruby-identifier">lambda</span> { }
442:       <span class="ruby-keyword kw">end</span>
443: 
444:       <span class="ruby-constant">Archive</span><span class="ruby-operator">::</span><span class="ruby-constant">Tar</span><span class="ruby-operator">::</span><span class="ruby-constant">Minitar</span>.<span class="ruby-identifier">pack</span>(<span class="ruby-identifier">files</span>, <span class="ruby-identifier">output</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">watcher</span>)
445:       <span class="ruby-identifier">finisher</span>.<span class="ruby-identifier">call</span>
446:       <span class="ruby-value">0</span>
447:     <span class="ruby-keyword kw">ensure</span>
448:       <span class="ruby-identifier">output</span>.<span class="ruby-identifier">close</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">output</span> <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">not</span> <span class="ruby-identifier">output</span>.<span class="ruby-identifier">closed?</span>
449:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000054">
                    
                    <a name="M000054"></a><b>help</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000054_source')" id="l_M000054_source">show</a>
                        
                    </p>
                    <div id="M000054_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/archive/tar/minitar/command.rb, line 451</span>
451:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">help</span>
452:       <span class="ruby-identifier">help</span> = <span class="ruby-value str">&quot;minitar create [OPTIONS] &lt;tarfile|-&gt; &lt;file|directory|--&gt;+\n\nCreates a new tarfile. If the tarfile is named .tar.gz or .tgz, then it\nwill be compressed automatically. If the tarfile is \&quot;-\&quot;, then it will be\noutput to standard output (stdout) so that minitar may be piped.\n\nThe files or directories that will be packed into the tarfile are\nspecified after the name of the tarfile itself. Directories will be\nprocessed recursively. If the token \&quot;--\&quot; is found in the list of files\nto be packed, additional filenames will be read from standard input\n(stdin). If any file is not found, the packaging will be halted.\n\ncreate Options:\n--compress, -z  Compresses the tarfile with gzip.\n\n&quot;</span>
453:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000046">
                    
                    <a name="M000046"></a><b>name</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000046_source')" id="l_M000046_source">show</a>
                        
                    </p>
                    <div id="M000046_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/archive/tar/minitar/command.rb, line 361</span>
361:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">name</span>
362:       <span class="ruby-value str">&quot;create&quot;</span>
363:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    