<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>Archive::Tar::Minitar::Command::CommandExtract</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../../../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../../../../css/main.css" type="text/css" media="screen" />
    <script src="../../../../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Class</span> 
            Archive::Tar::Minitar::Command::CommandExtract 
            
                <span class="parent">&lt; 
                    
                    CommandPattern
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../../../../files/lib/archive/tar/minitar/command_rb.html">lib/archive/tar/minitar/command.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>A</dt>
        <dd>
            <ul>
                
                <li><a href="#M000058">altname</a></li>
                
            </ul>
        </dd>
    
        <dt>C</dt>
        <dd>
            <ul>
                
                <li><a href="#M000059">call</a></li>
                
            </ul>
        </dd>
    
        <dt>H</dt>
        <dd>
            <ul>
                
                <li><a href="#M000065">help</a></li>
                
            </ul>
        </dd>
    
        <dt>N</dt>
        <dd>
            <ul>
                
                <li><a href="#M000057">name</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    

    

    

    

    

    
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M000058">
                    
                    <a name="M000058"></a><b>altname</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000058_source')" id="l_M000058_source">show</a>
                        
                    </p>
                    <div id="M000058_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/archive/tar/minitar/command.rb, line 478</span>
478:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">altname</span>
479:       <span class="ruby-value str">&quot;ex&quot;</span>
480:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000059">
                    
                    <a name="M000059"></a><b>call</b>(args, opts = {}, ioe = {})
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000059_source')" id="l_M000059_source">show</a>
                        
                    </p>
                    <div id="M000059_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/archive/tar/minitar/command.rb, line 482</span>
482:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">call</span>(<span class="ruby-identifier">args</span>, <span class="ruby-identifier">opts</span> = {}, <span class="ruby-identifier">ioe</span> = {})
483:       <span class="ruby-identifier">argv</span>    = []
484:       <span class="ruby-identifier">output</span>  = <span class="ruby-keyword kw">nil</span>
485:       <span class="ruby-identifier">dest</span>    = <span class="ruby-value str">&quot;.&quot;</span>
486:       <span class="ruby-identifier">files</span>   = []
487: 
488:       <span class="ruby-keyword kw">while</span> (<span class="ruby-identifier">arg</span> = <span class="ruby-identifier">args</span>.<span class="ruby-identifier">shift</span>)
489:         <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">arg</span>
490:         <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'--uncompress'</span>, <span class="ruby-value str">'-z'</span>
491:           <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:uncompress</span>] = <span class="ruby-keyword kw">true</span>
492:         <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'--pipe'</span>
493:           <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:output</span>] = <span class="ruby-identifier">ioe</span>[<span class="ruby-identifier">:error</span>]
494:           <span class="ruby-identifier">output</span> = <span class="ruby-identifier">ioe</span>[<span class="ruby-identifier">:output</span>]
495:         <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'--output'</span>, <span class="ruby-value str">'-o'</span>
496:           <span class="ruby-identifier">dest</span> = <span class="ruby-identifier">args</span>.<span class="ruby-identifier">shift</span>
497:         <span class="ruby-keyword kw">else</span>
498:           <span class="ruby-identifier">argv</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">arg</span>
499:         <span class="ruby-keyword kw">end</span>
500:       <span class="ruby-keyword kw">end</span>
501: 
502:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">argv</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">1</span>
503:         <span class="ruby-identifier">ioe</span>[<span class="ruby-identifier">:output</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;Not enough arguments.\n\n&quot;</span>
504:         <span class="ruby-constant">CommandPattern</span>[<span class="ruby-value str">&quot;help&quot;</span>][[<span class="ruby-value str">&quot;extract&quot;</span>]]
505:         <span class="ruby-keyword kw">return</span> <span class="ruby-value">255</span>
506:       <span class="ruby-keyword kw">end</span>
507: 
508:       <span class="ruby-identifier">input</span> = <span class="ruby-identifier">argv</span>.<span class="ruby-identifier">shift</span>
509:       <span class="ruby-keyword kw">if</span> <span class="ruby-value str">'-'</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">input</span>
510:         <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:name</span>] = <span class="ruby-value str">&quot;STDIN&quot;</span>
511:         <span class="ruby-identifier">input</span> = <span class="ruby-identifier">ioe</span>[<span class="ruby-identifier">:input</span>]
512:       <span class="ruby-keyword kw">else</span>
513:         <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:name</span>] = <span class="ruby-identifier">input</span>
514:         <span class="ruby-identifier">input</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">input</span>, <span class="ruby-value str">&quot;rb&quot;</span>)
515:       <span class="ruby-keyword kw">end</span>
516: 
517:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:name</span>] <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/\.tar\.gz$|\.tgz$/</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:uncompress</span>]
518:         <span class="ruby-identifier">input</span> = <span class="ruby-constant">Zlib</span><span class="ruby-operator">::</span><span class="ruby-constant">GzipReader</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">input</span>)
519:       <span class="ruby-keyword kw">end</span>
520: 
521:       <span class="ruby-identifier">files</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">argv</span>.<span class="ruby-identifier">to_a</span>
522:       <span class="ruby-identifier">files</span>.<span class="ruby-identifier">flatten!</span>
523: 
524:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:verbose</span>]
525:         <span class="ruby-identifier">watcher</span> = <span class="ruby-identifier">lambda</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">action</span>, <span class="ruby-identifier">name</span>, <span class="ruby-identifier">stats</span><span class="ruby-operator">|</span>
526:           <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:output</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;#{name}\n&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">action</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:dir</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">action</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:file_done</span>
527:         <span class="ruby-keyword kw">end</span>
528:         <span class="ruby-identifier">finisher</span> = <span class="ruby-identifier">lambda</span> { <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:output</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;\n&quot;</span> }
529:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:progress</span>]
530:         <span class="ruby-identifier">progress</span> = <span class="ruby-constant">ProgressBar</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:name</span>], <span class="ruby-value">1</span>)
531:         <span class="ruby-identifier">watcher</span> = <span class="ruby-identifier">lambda</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">action</span>, <span class="ruby-identifier">name</span>, <span class="ruby-identifier">stats</span><span class="ruby-operator">|</span>
532:           <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">action</span>
533:           <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:file_start</span>, <span class="ruby-identifier">:dir</span>
534:             <span class="ruby-identifier">progress</span>.<span class="ruby-identifier">title</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">basename</span>(<span class="ruby-identifier">name</span>)
535:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">action</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:dir</span>
536:               <span class="ruby-identifier">progress</span>.<span class="ruby-identifier">total</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
537:               <span class="ruby-identifier">progress</span>.<span class="ruby-identifier">inc</span>
538:             <span class="ruby-keyword kw">else</span>
539:               <span class="ruby-identifier">progress</span>.<span class="ruby-identifier">total</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">stats</span>[<span class="ruby-identifier">:entry</span>].<span class="ruby-identifier">size</span>
540:             <span class="ruby-keyword kw">end</span>
541:           <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:file_progress</span>
542:             <span class="ruby-identifier">progress</span>.<span class="ruby-identifier">inc</span>(<span class="ruby-identifier">stats</span>[<span class="ruby-identifier">:currinc</span>])
543:           <span class="ruby-keyword kw">end</span>
544:         <span class="ruby-keyword kw">end</span>
545:         <span class="ruby-identifier">finisher</span> = <span class="ruby-identifier">lambda</span> <span class="ruby-keyword kw">do</span>
546:           <span class="ruby-identifier">progress</span>.<span class="ruby-identifier">title</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:name</span>]
547:           <span class="ruby-identifier">progress</span>.<span class="ruby-identifier">finish</span>
548:         <span class="ruby-keyword kw">end</span>
549:       <span class="ruby-keyword kw">else</span>
550:         <span class="ruby-identifier">watcher</span> = <span class="ruby-keyword kw">nil</span>
551:         <span class="ruby-identifier">finisher</span> = <span class="ruby-identifier">lambda</span> { }
552:       <span class="ruby-keyword kw">end</span>
553: 
554:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">output</span>.<span class="ruby-identifier">nil?</span>
555:         <span class="ruby-constant">Archive</span><span class="ruby-operator">::</span><span class="ruby-constant">Tar</span><span class="ruby-operator">::</span><span class="ruby-constant">Minitar</span>.<span class="ruby-identifier">unpack</span>(<span class="ruby-identifier">input</span>, <span class="ruby-identifier">dest</span>, <span class="ruby-identifier">files</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">watcher</span>)
556:         <span class="ruby-identifier">finisher</span>.<span class="ruby-identifier">call</span>
557:       <span class="ruby-keyword kw">else</span>
558:         <span class="ruby-constant">Archive</span><span class="ruby-operator">::</span><span class="ruby-constant">Tar</span><span class="ruby-operator">::</span><span class="ruby-constant">Minitar</span><span class="ruby-operator">::</span><span class="ruby-constant">Input</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">input</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">inp</span><span class="ruby-operator">|</span>
559:           <span class="ruby-identifier">inp</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">entry</span><span class="ruby-operator">|</span>
560:             <span class="ruby-identifier">stats</span> = {
561:               <span class="ruby-identifier">:mode</span>     =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">mode</span>,
562:               <span class="ruby-identifier">:mtime</span>    =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">mtime</span>,
563:               <span class="ruby-identifier">:size</span>     =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">size</span>,
564:               <span class="ruby-identifier">:gid</span>      =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">gid</span>,
565:               <span class="ruby-identifier">:uid</span>      =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">uid</span>,
566:               <span class="ruby-identifier">:current</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>,
567:               <span class="ruby-identifier">:currinc</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>,
568:               <span class="ruby-identifier">:entry</span>    =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">entry</span>
569:             }
570: 
571:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">files</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">files</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">entry</span>.<span class="ruby-identifier">full_name</span>)
572:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">directory?</span>
573:                 <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Directory: #{entry.full_name}&quot;</span>
574:                 <span class="ruby-identifier">watcher</span>[<span class="ruby-identifier">:dir</span>, <span class="ruby-identifier">dest</span>, <span class="ruby-identifier">stats</span>] <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">watcher</span>.<span class="ruby-identifier">nil?</span>
575:               <span class="ruby-keyword kw">else</span>
576:                 <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;File: #{entry.full_name}&quot;</span>
577:                 <span class="ruby-identifier">watcher</span>[<span class="ruby-identifier">:file_start</span>, <span class="ruby-identifier">destfile</span>, <span class="ruby-identifier">stats</span>] <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">watcher</span>.<span class="ruby-identifier">nil?</span>
578:                 <span class="ruby-identifier">loop</span> <span class="ruby-keyword kw">do</span>
579:                   <span class="ruby-identifier">data</span> = <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">read</span>(<span class="ruby-value">4096</span>)
580:                   <span class="ruby-keyword kw">break</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">data</span>
581:                   <span class="ruby-identifier">stats</span>[<span class="ruby-identifier">:currinc</span>] = <span class="ruby-identifier">output</span>.<span class="ruby-identifier">write</span>(<span class="ruby-identifier">data</span>)
582:                   <span class="ruby-identifier">stats</span>[<span class="ruby-identifier">:current</span>] <span class="ruby-operator">+=</span> <span class="ruby-identifier">stats</span>[<span class="ruby-identifier">:currinc</span>]
583: 
584:                   <span class="ruby-identifier">watcher</span>[<span class="ruby-identifier">:file_progress</span>, <span class="ruby-identifier">name</span>, <span class="ruby-identifier">stats</span>] <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">watcher</span>.<span class="ruby-identifier">nil?</span>
585:                 <span class="ruby-keyword kw">end</span>
586:                 <span class="ruby-identifier">watcher</span>[<span class="ruby-identifier">:file_done</span>, <span class="ruby-identifier">name</span>, <span class="ruby-identifier">stats</span>] <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">watcher</span>.<span class="ruby-identifier">nil?</span>
587:               <span class="ruby-keyword kw">end</span>
588:             <span class="ruby-keyword kw">end</span>
589:           <span class="ruby-keyword kw">end</span>
590:         <span class="ruby-keyword kw">end</span>
591:       <span class="ruby-keyword kw">end</span>
592: 
593:       <span class="ruby-value">0</span>
594:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000065">
                    
                    <a name="M000065"></a><b>help</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000065_source')" id="l_M000065_source">show</a>
                        
                    </p>
                    <div id="M000065_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/archive/tar/minitar/command.rb, line 596</span>
596:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">help</span>
597:       <span class="ruby-identifier">help</span> = <span class="ruby-value str">&quot;minitar extract [OPTIONS] &lt;tarfile|-&gt; [&lt;file&gt;+]\n\nExtracts files from an existing tarfile. If the tarfile is named .tar.gz\nor .tgz, then it will be uncompressed automatically. If the tarfile is\n\&quot;-\&quot;, then it will be read from standard input (stdin) so that minitar\nmay be piped.\n\nThe files or directories that will be extracted from the tarfile are\nspecified after the name of the tarfile itself. Directories will be\nprocessed recursively. Files must be specified in full. A file\n\&quot;foo/bar/baz.txt\&quot; cannot simply be specified by specifying \&quot;baz.txt\&quot;.\nAny file not found will simply be skipped and an error will be reported.\n\nextract Options:\n--uncompress, -z  Uncompresses the tarfile with gzip.\n--pipe            Emits the extracted files to STDOUT for piping.\n--output, -o      Extracts the files to the specified directory.\n\n&quot;</span>
598:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000057">
                    
                    <a name="M000057"></a><b>name</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000057_source')" id="l_M000057_source">show</a>
                        
                    </p>
                    <div id="M000057_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/archive/tar/minitar/command.rb, line 474</span>
474:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">name</span>
475:       <span class="ruby-value str">&quot;extract&quot;</span>
476:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    