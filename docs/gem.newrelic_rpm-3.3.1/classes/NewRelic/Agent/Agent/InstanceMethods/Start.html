<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>NewRelic::Agent::Agent::InstanceMethods::Start</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../../../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../../../../css/main.css" type="text/css" media="screen" />
    <script src="../../../../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Module</span> 
            NewRelic::Agent::Agent::InstanceMethods::Start 
            
        </h1>
        <ul class="files">
            
            <li><a href="../../../../../files/lib/new_relic/agent/agent_rb.html">lib/new_relic/agent/agent.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    
    <div class="description">
        <p>
Herein lies the corpse of the former &#8216;start&#8217; method. May
it&#8217;s unmatched flog score rest in pieces.
</p>

    </div>
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>A</dt>
        <dd>
            <ul>
                
                <li><a href="#M000041">already_started?</a></li>
                
            </ul>
        </dd>
    
        <dt>C</dt>
        <dd>
            <ul>
                
                <li><a href="#M000063">check_config_and_start_agent</a>,</li>
                
                <li><a href="#M000046">connect_in_foreground</a>,</li>
                
                <li><a href="#M000061">correct_license_length</a></li>
                
            </ul>
        </dd>
    
        <dt>D</dt>
        <dd>
            <ul>
                
                <li><a href="#M000042">disabled?</a></li>
                
            </ul>
        </dd>
    
        <dt>H</dt>
        <dd>
            <ul>
                
                <li><a href="#M000060">has_correct_license_key?</a>,</li>
                
                <li><a href="#M000059">has_license_key?</a></li>
                
            </ul>
        </dd>
    
        <dt>I</dt>
        <dd>
            <ul>
                
                <li><a href="#M000052">install_exit_handler</a></li>
                
            </ul>
        </dd>
    
        <dt>L</dt>
        <dd>
            <ul>
                
                <li><a href="#M000045">log_app_names</a>,</li>
                
                <li><a href="#M000044">log_dispatcher</a>,</li>
                
                <li><a href="#M000056">log_if</a>,</li>
                
                <li><a href="#M000057">log_unless</a>,</li>
                
                <li><a href="#M000055">log_version_and_pid</a></li>
                
            </ul>
        </dd>
    
        <dt>M</dt>
        <dd>
            <ul>
                
                <li><a href="#M000058">monitoring?</a></li>
                
            </ul>
        </dd>
    
        <dt>N</dt>
        <dd>
            <ul>
                
                <li><a href="#M000053">notify_log_file_location</a></li>
                
            </ul>
        </dd>
    
        <dt>U</dt>
        <dd>
            <ul>
                
                <li><a href="#M000062">using_forking_dispatcher?</a>,</li>
                
                <li><a href="#M000049">using_sinatra?</a></li>
                
            </ul>
        </dd>
    
        <dt>W</dt>
        <dd>
            <ul>
                
                <li><a href="#M000050">weird_ruby?</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    

    

    

    

    

    
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M000041">
                    
                    <a name="M000041"></a><b>already_started?</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Check whether we have already started, which is an error condition
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000041_source')" id="l_M000041_source">show</a>
                        
                    </p>
                    <div id="M000041_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/new_relic/agent/agent.rb, line 285</span>
285:           <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">already_started?</span>
286:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">started?</span>
287:               <span class="ruby-identifier">control</span>.<span class="ruby-identifier">log!</span>(<span class="ruby-value str">&quot;Agent Started Already!&quot;</span>, <span class="ruby-identifier">:error</span>)
288:               <span class="ruby-keyword kw">true</span>
289:             <span class="ruby-keyword kw">end</span>
290:           <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000063">
                    
                    <a name="M000063"></a><b>check_config_and_start_agent</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Sanity-check the agent configuration and start the agent, setting up the
worker thread and the exit handler to shut down the agent
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000063_source')" id="l_M000063_source">show</a>
                        
                    </p>
                    <div id="M000063_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/new_relic/agent/agent.rb, line 413</span>
413:           <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">check_config_and_start_agent</span>
414:             <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">monitoring?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">has_correct_license_key?</span>
415:             <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">using_forking_dispatcher?</span>
416:             <span class="ruby-identifier">connect_in_foreground</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">control</span>.<span class="ruby-identifier">sync_startup</span>
417:             <span class="ruby-identifier">start_worker_thread</span>
418:             <span class="ruby-identifier">install_exit_handler</span>
419:           <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000046">
                    
                    <a name="M000046"></a><b>connect_in_foreground</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Connecting in the foreground blocks further startup of the agent until we
have a connection - useful in cases where you&#8217;re trying to log a
very-short-running process and want to get statistics from before a server
connection (typically 20 seconds) exists
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000046_source')" id="l_M000046_source">show</a>
                        
                    </p>
                    <div id="M000046_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/new_relic/agent/agent.rb, line 318</span>
318:           <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">connect_in_foreground</span>
319:             <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Agent</span>.<span class="ruby-identifier">disable_all_tracing</span> { <span class="ruby-identifier">connect</span>(<span class="ruby-identifier">:keep_retrying</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>) }
320:           <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000061">
                    
                    <a name="M000061"></a><b>correct_license_length</b>()
                    
                </div>
                
                <div class="description">
                  <p>
A license key is an arbitrary 40 character string, usually looks something
like a SHA1 hash
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000061_source')" id="l_M000061_source">show</a>
                        
                    </p>
                    <div id="M000061_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/new_relic/agent/agent.rb, line 398</span>
398:           <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">correct_license_length</span>
399:             <span class="ruby-identifier">key</span> = <span class="ruby-identifier">control</span>.<span class="ruby-identifier">license_key</span>
400:             <span class="ruby-identifier">log_unless</span>((<span class="ruby-identifier">key</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">40</span>), <span class="ruby-identifier">:error</span>, <span class="ruby-node">&quot;Invalid license key: #{key}&quot;</span>)
401:           <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000042">
                    
                    <a name="M000042"></a><b>disabled?</b>()
                    
                </div>
                
                <div class="description">
                  <p>
The agent is disabled when it is not force enabled by the
&#8216;agent_enabled&#8217; option (e.g. in a manual start), or enabled
normally through the configuration file
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000042_source')" id="l_M000042_source">show</a>
                        
                    </p>
                    <div id="M000042_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/new_relic/agent/agent.rb, line 295</span>
295:           <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">disabled?</span>
296:             <span class="ruby-operator">!</span><span class="ruby-identifier">control</span>.<span class="ruby-identifier">agent_enabled?</span>
297:           <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000060">
                    
                    <a name="M000060"></a><b>has_correct_license_key?</b>()
                    
                </div>
                
                <div class="description">
                  <p>
A correct license key exists and is of the proper length
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000060_source')" id="l_M000060_source">show</a>
                        
                    </p>
                    <div id="M000060_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/new_relic/agent/agent.rb, line 392</span>
392:           <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">has_correct_license_key?</span>
393:             <span class="ruby-identifier">has_license_key?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">correct_license_length</span>
394:           <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000059">
                    
                    <a name="M000059"></a><b>has_license_key?</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Tell the user when the license key is missing so they can fix it by adding
it to the file
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000059_source')" id="l_M000059_source">show</a>
                        
                    </p>
                    <div id="M000059_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/new_relic/agent/agent.rb, line 387</span>
387:           <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">has_license_key?</span>
388:             <span class="ruby-identifier">log_unless</span>(<span class="ruby-identifier">control</span>.<span class="ruby-identifier">license_key</span>, <span class="ruby-identifier">:error</span>, <span class="ruby-value str">&quot;No license key found.  Please edit your newrelic.yml file and insert your license key.&quot;</span>)
389:           <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000052">
                    
                    <a name="M000052"></a><b>install_exit_handler</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Installs our exit handler, which exploits the weird behavior of at_exit
blocks to make sure it runs last, by doing an at_exit within an at_exit
block.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000052_source')" id="l_M000052_source">show</a>
                        
                    </p>
                    <div id="M000052_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/new_relic/agent/agent.rb, line 339</span>
339:           <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">install_exit_handler</span>
340:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">control</span>.<span class="ruby-identifier">send_data_on_exit</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">weird_ruby?</span>
341:               <span class="ruby-comment cmt"># Our shutdown handler needs to run after other shutdown handlers</span>
342:               <span class="ruby-identifier">at_exit</span> { <span class="ruby-identifier">at_exit</span> { <span class="ruby-identifier">shutdown</span> } }
343:             <span class="ruby-keyword kw">end</span>
344:           <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000045">
                    
                    <a name="M000045"></a><b>log_app_names</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Logs the configured application names
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000045_source')" id="l_M000045_source">show</a>
                        
                    </p>
                    <div id="M000045_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/new_relic/agent/agent.rb, line 309</span>
309:           <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">log_app_names</span>
310:             <span class="ruby-identifier">log</span>.<span class="ruby-identifier">info</span> <span class="ruby-node">&quot;Application: #{control.app_names.join(&quot;, &quot;)}&quot;</span>
311:           <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000044">
                    
                    <a name="M000044"></a><b>log_dispatcher</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Logs the dispatcher to the log file to assist with debugging. When no
debugger is present, logs this fact to assist with proper dispatcher
detection
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000044_source')" id="l_M000044_source">show</a>
                        
                    </p>
                    <div id="M000044_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/new_relic/agent/agent.rb, line 302</span>
302:           <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">log_dispatcher</span>
303:             <span class="ruby-identifier">dispatcher_name</span> = <span class="ruby-identifier">control</span>.<span class="ruby-identifier">dispatcher</span>.<span class="ruby-identifier">to_s</span>
304:             <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">log_if</span>(<span class="ruby-identifier">dispatcher_name</span>.<span class="ruby-identifier">empty?</span>, <span class="ruby-identifier">:info</span>, <span class="ruby-value str">&quot;No dispatcher detected.&quot;</span>)
305:             <span class="ruby-identifier">log</span>.<span class="ruby-identifier">info</span> <span class="ruby-node">&quot;Dispatcher: #{dispatcher_name}&quot;</span>
306:           <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000056">
                    
                    <a name="M000056"></a><b>log_if</b>(boolean, level, message)
                    
                </div>
                
                <div class="description">
                  <p>
A helper method that logs a condition if that condition is true. Mentally
cleaner than having every method set a local and log if it is true
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000056_source')" id="l_M000056_source">show</a>
                        
                    </p>
                    <div id="M000056_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/new_relic/agent/agent.rb, line 366</span>
366:           <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">log_if</span>(<span class="ruby-identifier">boolean</span>, <span class="ruby-identifier">level</span>, <span class="ruby-identifier">message</span>)
367:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">log</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">level</span>, <span class="ruby-identifier">message</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">boolean</span>
368:             <span class="ruby-identifier">boolean</span>
369:           <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000057">
                    
                    <a name="M000057"></a><b>log_unless</b>(boolean, level, message)
                    
                </div>
                
                <div class="description">
                  <p>
A helper method that logs a condition unless that condition is true.
Mentally cleaner than having every method set a local and log unless it is
true
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000057_source')" id="l_M000057_source">show</a>
                        
                    </p>
                    <div id="M000057_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/new_relic/agent/agent.rb, line 374</span>
374:           <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">log_unless</span>(<span class="ruby-identifier">boolean</span>, <span class="ruby-identifier">level</span>, <span class="ruby-identifier">message</span>)
375:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">log</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">level</span>, <span class="ruby-identifier">message</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">boolean</span>
376:             <span class="ruby-identifier">boolean</span>
377:           <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000055">
                    
                    <a name="M000055"></a><b>log_version_and_pid</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Classy logging of the agent version and the current pid, so we can
disambiguate processes in the log file and make sure they&#8217;re running
a reasonable version
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000055_source')" id="l_M000055_source">show</a>
                        
                    </p>
                    <div id="M000055_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/new_relic/agent/agent.rb, line 359</span>
359:           <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">log_version_and_pid</span>
360:             <span class="ruby-identifier">log</span>.<span class="ruby-identifier">info</span> <span class="ruby-node">&quot;New Relic Ruby Agent #{NewRelic::VERSION::STRING} Initialized: pid = #{$$}&quot;</span>
361:           <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000058">
                    
                    <a name="M000058"></a><b>monitoring?</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Warn the user if they have configured their agent not to send data, that
way we can see this clearly in the log file
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000058_source')" id="l_M000058_source">show</a>
                        
                    </p>
                    <div id="M000058_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/new_relic/agent/agent.rb, line 381</span>
381:           <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">monitoring?</span>
382:             <span class="ruby-identifier">log_unless</span>(<span class="ruby-identifier">control</span>.<span class="ruby-identifier">monitor_mode?</span>, <span class="ruby-identifier">:warn</span>, <span class="ruby-value str">&quot;Agent configured not to send data in this environment - edit newrelic.yml to change this&quot;</span>)
383:           <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000053">
                    
                    <a name="M000053"></a><b>notify_log_file_location</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Tells us in the log file where the log file is located. This seems
redundant, but can come in handy when we have some log file path set by the
user which parses incorrectly, sending the log file to who-knows-where
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000053_source')" id="l_M000053_source">show</a>
                        
                    </p>
                    <div id="M000053_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/new_relic/agent/agent.rb, line 350</span>
350:           <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">notify_log_file_location</span>
351:             <span class="ruby-identifier">log_file</span> = <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Control</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">log_file</span>
352:             <span class="ruby-identifier">log_if</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-identifier">log_file</span>.<span class="ruby-identifier">to_s</span>), <span class="ruby-identifier">:info</span>,
353:                    <span class="ruby-node">&quot;Agent Log at #{log_file}&quot;</span>)
354:           <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000062">
                    
                    <a name="M000062"></a><b>using_forking_dispatcher?</b>()
                    
                </div>
                
                <div class="description">
                  <p>
If we&#8217;re using a dispatcher that forks before serving requests, we
need to wait until the children are forked before connecting, otherwise the
parent process sends odd data
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000062_source')" id="l_M000062_source">show</a>
                        
                    </p>
                    <div id="M000062_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/new_relic/agent/agent.rb, line 406</span>
406:           <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">using_forking_dispatcher?</span>
407:             <span class="ruby-identifier">log_if</span>([<span class="ruby-identifier">:passenger</span>, <span class="ruby-identifier">:unicorn</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">control</span>.<span class="ruby-identifier">dispatcher</span>), <span class="ruby-identifier">:info</span>, <span class="ruby-value str">&quot;Connecting workers after forking.&quot;</span>)
408:           <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000049">
                    
                    <a name="M000049"></a><b>using_sinatra?</b>()
                    
                </div>
                
                <div class="description">
                  <p>
If we&#8217;re using sinatra, old versions run in an at_exit block so we
should probably know that
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000049_source')" id="l_M000049_source">show</a>
                        
                    </p>
                    <div id="M000049_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/new_relic/agent/agent.rb, line 324</span>
324:           <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">using_sinatra?</span>
325:             <span class="ruby-keyword kw">defined?</span>(<span class="ruby-constant">Sinatra</span><span class="ruby-operator">::</span><span class="ruby-constant">Application</span>)
326:           <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000050">
                    
                    <a name="M000050"></a><b>weird_ruby?</b>()
                    
                </div>
                
                <div class="description">
                  <p>
we should not set an at_exit block if people are using these as they
don&#8217;t do standard at_exit behavior per MRI/YARV
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000050_source')" id="l_M000050_source">show</a>
                        
                    </p>
                    <div id="M000050_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/new_relic/agent/agent.rb, line 330</span>
330:           <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">weird_ruby?</span>
331:             <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">LanguageSupport</span>.<span class="ruby-identifier">using_engine?</span>(<span class="ruby-value str">'rbx'</span>) <span class="ruby-operator">||</span>
332:               <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">LanguageSupport</span>.<span class="ruby-identifier">using_engine?</span>(<span class="ruby-value str">'jruby'</span>) <span class="ruby-operator">||</span>
333:               <span class="ruby-identifier">using_sinatra?</span>
334:           <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    