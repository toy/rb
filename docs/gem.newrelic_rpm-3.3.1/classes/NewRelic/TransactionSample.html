<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>NewRelic::TransactionSample</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../css/main.css" type="text/css" media="screen" />
    <script src="../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Class</span> 
            NewRelic::TransactionSample 
            
                <span class="parent">&lt; 
                    
                    <a href="../Object.html">Object</a>
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../files/lib/new_relic/transaction_sample/composite_segment_rb.html">lib/new_relic/transaction_sample/composite_segment.rb</a></li>
            
            <li><a href="../../files/lib/new_relic/transaction_sample/fake_segment_rb.html">lib/new_relic/transaction_sample/fake_segment.rb</a></li>
            
            <li><a href="../../files/lib/new_relic/transaction_sample/segment_rb.html">lib/new_relic/transaction_sample/segment.rb</a></li>
            
            <li><a href="../../files/lib/new_relic/transaction_sample/summary_segment_rb.html">lib/new_relic/transaction_sample/summary_segment.rb</a></li>
            
            <li><a href="../../files/lib/new_relic/transaction_sample_rb.html">lib/new_relic/transaction_sample.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>B</dt>
        <dd>
            <ul>
                
                <li><a href="#M000955">build_segment_for_transfer</a>,</li>
                
                <li><a href="#M000947">build_segment_with_omissions</a></li>
                
            </ul>
        </dd>
    
        <dt>C</dt>
        <dd>
            <ul>
                
                <li><a href="#M000928">count_segments</a>,</li>
                
                <li><a href="#M000935">create_segment</a></li>
                
            </ul>
        </dd>
    
        <dt>D</dt>
        <dd>
            <ul>
                
                <li><a href="#M000936">duration</a></li>
                
            </ul>
        </dd>
    
        <dt>E</dt>
        <dd>
            <ul>
                
                <li><a href="#M000937">each_segment</a>,</li>
                
                <li><a href="#M000938">each_segment_with_nest_tracking</a>,</li>
                
                <li><a href="#M000930">ensure_segment_count_set</a></li>
                
            </ul>
        </dd>
    
        <dt>F</dt>
        <dd>
            <ul>
                
                <li><a href="#M000940">find_segment</a></li>
                
            </ul>
        </dd>
    
        <dt>G</dt>
        <dd>
            <ul>
                
                <li><a href="#M000946">generate_guid</a></li>
                
            </ul>
        </dd>
    
        <dt>N</dt>
        <dd>
            <ul>
                
                <li><a href="#M000923">new</a></li>
                
            </ul>
        </dd>
    
        <dt>O</dt>
        <dd>
            <ul>
                
                <li><a href="#M000943">omit_segments_with</a></li>
                
            </ul>
        </dd>
    
        <dt>P</dt>
        <dd>
            <ul>
                
                <li><a href="#M000945">params=</a>,</li>
                
                <li><a href="#M000934">path_string</a>,</li>
                
                <li><a href="#M000944">prepare_to_send</a></li>
                
            </ul>
        </dd>
    
        <dt>S</dt>
        <dd>
            <ul>
                
                <li><a href="#M000933">start_time</a></li>
                
            </ul>
        </dd>
    
        <dt>T</dt>
        <dd>
            <ul>
                
                <li><a href="#M000931">timestamp</a>,</li>
                
                <li><a href="#M000942">to_s</a>,</li>
                
                <li><a href="#M000939">to_s_compact</a>,</li>
                
                <li><a href="#M000929">truncate</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    
    <div class="sectiontitle">Included Modules</div>
    <ul>
        
        <li>
            
            <a href="Agent/BrowserMonitoring.html">NewRelic::Agent::BrowserMonitoring</a>
            
            START:includes
        </li>
        
    </ul>
    

    

    
    <div class="sectiontitle">Classes and Modules</div>
    <ul>
        
        <li><span class="type">CLASS</span> <a href="TransactionSample/CompositeSegment.html">NewRelic::TransactionSample::CompositeSegment</a></li>
        
        <li><span class="type">CLASS</span> <a href="TransactionSample/FakeSegment.html">NewRelic::TransactionSample::FakeSegment</a></li>
        
        <li><span class="type">CLASS</span> <a href="TransactionSample/Segment.html">NewRelic::TransactionSample::Segment</a></li>
        
        <li><span class="type">CLASS</span> <a href="TransactionSample/SummarySegment.html">NewRelic::TransactionSample::SummarySegment</a></li>
        
    </ul>
    

    

    
    <div class="sectiontitle">Attributes</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>params</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>root_segment</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>profile</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>force_persist</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>guid</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>root_segment</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>params</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>sample_id</td>
            <td class='attr-desc'></td>
        </tr>
        
    </table>
    

    
            <div class="sectiontitle">Class Public methods</div>
            
            <div class="method">
                <div class="title" id="M000923">
                    
                    <a name="M000923"></a><b>new</b>(time = Time.now.to_f, sample_id = nil)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000923_source')" id="l_M000923_source">show</a>
                        
                    </p>
                    <div id="M000923_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 19</span>
19:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">time</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">to_f</span>, <span class="ruby-identifier">sample_id</span> = <span class="ruby-keyword kw">nil</span>)
20:       <span class="ruby-ivar">@sample_id</span> = <span class="ruby-identifier">sample_id</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">object_id</span>
21:       <span class="ruby-ivar">@start_time</span> = <span class="ruby-identifier">time</span>
22:       <span class="ruby-ivar">@root_segment</span> = <span class="ruby-identifier">create_segment</span> <span class="ruby-value">0</span><span class="ruby-value">.0</span>, <span class="ruby-value str">&quot;ROOT&quot;</span>
23:       <span class="ruby-ivar">@params</span> = {}
24:       <span class="ruby-ivar">@params</span>[<span class="ruby-identifier">:request_params</span>] = {}
25: 
26:       <span class="ruby-ivar">@guid</span> = <span class="ruby-identifier">generate_guid</span>
27:       <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Agent</span><span class="ruby-operator">::</span><span class="ruby-constant">TransactionInfo</span>.<span class="ruby-identifier">get</span>.<span class="ruby-identifier">guid</span> = <span class="ruby-ivar">@guid</span>
28:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M000928">
                    
                    <a name="M000928"></a><b>count_segments</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000928_source')" id="l_M000928_source">show</a>
                        
                    </p>
                    <div id="M000928_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 30</span>
30:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">count_segments</span>
31:       <span class="ruby-ivar">@root_segment</span>.<span class="ruby-identifier">count_segments</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>    <span class="ruby-comment cmt"># don't count the root segment</span>
32:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000935">
                    
                    <a name="M000935"></a><b>create_segment</b>(relative_timestamp, metric_name, segment_id = nil)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000935_source')" id="l_M000935_source">show</a>
                        
                    </p>
                    <div id="M000935_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 75</span>
75:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create_segment</span>(<span class="ruby-identifier">relative_timestamp</span>, <span class="ruby-identifier">metric_name</span>, <span class="ruby-identifier">segment_id</span> = <span class="ruby-keyword kw">nil</span>)
76:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">TypeError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;Frozen Transaction Sample&quot;</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">frozen?</span>
77:       <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">TransactionSample</span><span class="ruby-operator">::</span><span class="ruby-constant">Segment</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">relative_timestamp</span>, <span class="ruby-identifier">metric_name</span>, <span class="ruby-identifier">segment_id</span>)
78:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000936">
                    
                    <a name="M000936"></a><b>duration</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000936_source')" id="l_M000936_source">show</a>
                        
                    </p>
                    <div id="M000936_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 80</span>
80:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">duration</span>
81:       <span class="ruby-identifier">root_segment</span>.<span class="ruby-identifier">duration</span>
82:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000937">
                    
                    <a name="M000937"></a><b>each_segment</b>(&amp;block)
                    
                </div>
                
                <div class="description">
                  <p>
Iterates recursively over each segment in the entire transaction sample
tree
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000937_source')" id="l_M000937_source">show</a>
                        
                    </p>
                    <div id="M000937_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 86</span>
86:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">each_segment</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
87:       <span class="ruby-ivar">@root_segment</span>.<span class="ruby-identifier">each_segment</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
88:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000938">
                    
                    <a name="M000938"></a><b>each_segment_with_nest_tracking</b>(&amp;block)
                    
                </div>
                
                <div class="description">
                  <p>
Iterates recursively over each segment in the entire transaction sample
tree while keeping track of nested segments
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000938_source')" id="l_M000938_source">show</a>
                        
                    </p>
                    <div id="M000938_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 92</span>
92:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">each_segment_with_nest_tracking</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
93:       <span class="ruby-ivar">@root_segment</span>.<span class="ruby-identifier">each_segment_with_nest_tracking</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
94:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000930">
                    
                    <a name="M000930"></a><b>ensure_segment_count_set</b>(count)
                    
                </div>
                
                <div class="description">
                  <p>
makes sure that the parameter cache for segment count is set to the correct
value
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000930_source')" id="l_M000930_source">show</a>
                        
                    </p>
                    <div id="M000930_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 47</span>
47:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">ensure_segment_count_set</span>(<span class="ruby-identifier">count</span>)
48:       <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:segment_count</span>] <span class="ruby-operator">||=</span> <span class="ruby-identifier">count</span>
49:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000940">
                    
                    <a name="M000940"></a><b>find_segment</b>(id)
                    
                </div>
                
                <div class="description">
                  <p>
Searches the tree recursively for the segment with the given id. note that
this is an internal id, not an ActiveRecord id
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000940_source')" id="l_M000940_source">show</a>
                        
                    </p>
                    <div id="M000940_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 102</span>
102:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">find_segment</span>(<span class="ruby-identifier">id</span>)
103:       <span class="ruby-ivar">@root_segment</span>.<span class="ruby-identifier">find_segment</span>(<span class="ruby-identifier">id</span>)
104:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000943">
                    
                    <a name="M000943"></a><b>omit_segments_with</b>(regex)
                    
                </div>
                
                <div class="description">
                  <p>
return a new transaction sample that treats segments with the given regular
expression in their name as if they were never called at all. This allows
us to strip out segments from traces captured in development environment
that would not normally show up in production (like Rails/Application Code
Loading)
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000943_source')" id="l_M000943_source">show</a>
                        
                    </p>
                    <div id="M000943_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 132</span>
132:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">omit_segments_with</span>(<span class="ruby-identifier">regex</span>)
133:       <span class="ruby-identifier">regex</span> = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">regex</span>)
134: 
135:       <span class="ruby-identifier">sample</span> = <span class="ruby-constant">TransactionSample</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@start_time</span>, <span class="ruby-identifier">sample_id</span>)
136: 
137:       <span class="ruby-identifier">params</span>.<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">sample</span>.<span class="ruby-identifier">params</span>[<span class="ruby-identifier">k</span>] = <span class="ruby-identifier">v</span>}
138: 
139:       <span class="ruby-identifier">delta</span> = <span class="ruby-identifier">build_segment_with_omissions</span>(<span class="ruby-identifier">sample</span>, <span class="ruby-value">0</span><span class="ruby-value">.0</span>, <span class="ruby-ivar">@root_segment</span>, <span class="ruby-identifier">sample</span>.<span class="ruby-identifier">root_segment</span>, <span class="ruby-identifier">regex</span>)
140:       <span class="ruby-identifier">sample</span>.<span class="ruby-identifier">root_segment</span>.<span class="ruby-identifier">end_trace</span>(<span class="ruby-ivar">@root_segment</span>.<span class="ruby-identifier">exit_timestamp</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">delta</span>)
141:       <span class="ruby-identifier">sample</span>.<span class="ruby-identifier">profile</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">profile</span>
142:       <span class="ruby-identifier">sample</span>
143:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000945">
                    
                    <a name="M000945"></a><b>params=</b>(params)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000945_source')" id="l_M000945_source">show</a>
                        
                    </p>
                    <div id="M000945_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 170</span>
170:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">params=</span>(<span class="ruby-identifier">params</span>)
171:       <span class="ruby-ivar">@params</span> = <span class="ruby-identifier">params</span>
172:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000934">
                    
                    <a name="M000934"></a><b>path_string</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000934_source')" id="l_M000934_source">show</a>
                        
                    </p>
                    <div id="M000934_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 71</span>
71:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">path_string</span>
72:       <span class="ruby-ivar">@root_segment</span>.<span class="ruby-identifier">path_string</span>
73:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000944">
                    
                    <a name="M000944"></a><b>prepare_to_send</b>(options={})
                    
                </div>
                
                <div class="description">
                  <p>
Return a new transaction sample that can be sent to the New Relic service.
This involves potentially one or more of the following options
</p>
<pre>
  :explain_sql : run EXPLAIN on all queries whose response times equal the value for this key
      (for example :explain_sql =&gt; 2.0 would explain everything over 2 seconds.  0.0 would explain everything.)
  :keep_backtraces : keep backtraces, significantly increasing size of trace (off by default)
  :record_sql =&gt; [ :raw | :obfuscated] : copy over the sql, obfuscating if necessary
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000944_source')" id="l_M000944_source">show</a>
                        
                    </p>
                    <div id="M000944_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 153</span>
153:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">prepare_to_send</span>(<span class="ruby-identifier">options</span>={})
154:       <span class="ruby-identifier">sample</span> = <span class="ruby-constant">TransactionSample</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@start_time</span>, <span class="ruby-identifier">sample_id</span>)
155: 
156:       <span class="ruby-identifier">sample</span>.<span class="ruby-identifier">params</span>.<span class="ruby-identifier">merge!</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">params</span>
157:       <span class="ruby-identifier">sample</span>.<span class="ruby-identifier">guid</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">guid</span>
158:       <span class="ruby-identifier">sample</span>.<span class="ruby-identifier">force_persist</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">force_persist</span> <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">force_persist</span>
159: 
160:       <span class="ruby-keyword kw">begin</span>
161:         <span class="ruby-identifier">build_segment_for_transfer</span>(<span class="ruby-identifier">sample</span>, <span class="ruby-ivar">@root_segment</span>, <span class="ruby-identifier">sample</span>.<span class="ruby-identifier">root_segment</span>, <span class="ruby-identifier">options</span>)
162:       <span class="ruby-keyword kw">ensure</span>
163:         <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Agent</span><span class="ruby-operator">::</span><span class="ruby-constant">Database</span>.<span class="ruby-identifier">close_connections</span>
164:       <span class="ruby-keyword kw">end</span>
165: 
166:       <span class="ruby-identifier">sample</span>.<span class="ruby-identifier">root_segment</span>.<span class="ruby-identifier">end_trace</span>(<span class="ruby-ivar">@root_segment</span>.<span class="ruby-identifier">exit_timestamp</span>)
167:       <span class="ruby-identifier">sample</span>
168:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000933">
                    
                    <a name="M000933"></a><b>start_time</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000933_source')" id="l_M000933_source">show</a>
                        
                    </p>
                    <div id="M000933_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 67</span>
67:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">start_time</span>
68:       <span class="ruby-constant">Time</span>.<span class="ruby-identifier">at</span>(<span class="ruby-ivar">@start_time</span>)
69:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000931">
                    
                    <a name="M000931"></a><b>timestamp</b>()
                    
                </div>
                
                <div class="description">
                  <p>
offset from start of app
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000931_source')" id="l_M000931_source">show</a>
                        
                    </p>
                    <div id="M000931_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 52</span>
52:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">timestamp</span>
53:       <span class="ruby-ivar">@start_time</span> <span class="ruby-operator">-</span> <span class="ruby-ivar">@@start_time</span>.<span class="ruby-identifier">to_f</span>
54:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000942">
                    
                    <a name="M000942"></a><b>to_s</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000942_source')" id="l_M000942_source">show</a>
                        
                    </p>
                    <div id="M000942_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 106</span>
106:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">to_s</span>
107:       <span class="ruby-identifier">s</span> = <span class="ruby-node">&quot;Transaction Sample collected at #{start_time}\n&quot;</span>
108:       <span class="ruby-identifier">s</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;  {\n&quot;</span>
109:       <span class="ruby-identifier">s</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;  Path: #{params[:path]} \n&quot;</span>
110: 
111:       <span class="ruby-identifier">params</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
112:         <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">k</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:path</span>
113:         <span class="ruby-identifier">s</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;  #{k}: &quot;</span> <span class="ruby-operator">&lt;&lt;</span>
114:         <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">v</span>
115:           <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Enumerable</span> <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">:to_s</span>).<span class="ruby-identifier">sort</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;; &quot;</span>)
116:           <span class="ruby-keyword kw">when</span> <span class="ruby-constant">String</span> <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">v</span>
117:           <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Float</span> <span class="ruby-keyword kw">then</span> <span class="ruby-value str">'%6.3s'</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">v</span>
118:           <span class="ruby-keyword kw">when</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">then</span> <span class="ruby-value str">''</span>
119:         <span class="ruby-keyword kw">else</span>
120:           <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;unexpected value type for #{k}: '#{v}' (#{v.class})&quot;</span>
121:         <span class="ruby-keyword kw">end</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;\n&quot;</span>
122:       <span class="ruby-keyword kw">end</span>
123:       <span class="ruby-identifier">s</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;  }\n\n&quot;</span>
124:       <span class="ruby-identifier">s</span> <span class="ruby-operator">&lt;&lt;</span>  <span class="ruby-ivar">@root_segment</span>.<span class="ruby-identifier">to_debug_str</span>(<span class="ruby-value">0</span>)
125:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000939">
                    
                    <a name="M000939"></a><b>to_s_compact</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000939_source')" id="l_M000939_source">show</a>
                        
                    </p>
                    <div id="M000939_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 96</span>
96:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">to_s_compact</span>
97:       <span class="ruby-ivar">@root_segment</span>.<span class="ruby-identifier">to_s_compact</span>
98:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000929">
                    
                    <a name="M000929"></a><b>truncate</b>(max)
                    
                </div>
                
                <div class="description">
                  <p>
Truncates the transaction sample to a maximum length determined by the
passed-in parameter. Operates recursively on the entire tree of transaction
segments in a depth-first manner
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000929_source')" id="l_M000929_source">show</a>
                        
                    </p>
                    <div id="M000929_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 37</span>
37:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">truncate</span>(<span class="ruby-identifier">max</span>)
38:       <span class="ruby-identifier">count</span> = <span class="ruby-identifier">count_segments</span>
39:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">count</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">max</span>
40:       <span class="ruby-ivar">@root_segment</span>.<span class="ruby-identifier">truncate</span>(<span class="ruby-identifier">max</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>)
41: 
42:       <span class="ruby-identifier">ensure_segment_count_set</span>(<span class="ruby-identifier">count</span>)
43:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Private methods</div>
            
            <div class="method">
                <div class="title" id="M000955">
                    
                    <a name="M000955"></a><b>build_segment_for_transfer</b>(new_sample, source_segment, target_segment, options)
                    
                </div>
                
                <div class="description">
                  <p>
see <a href="TransactionSample.html#M000944">prepare_to_send</a> for what
we do with options
</p>
<p>
This is badly in need of refactoring
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000955_source')" id="l_M000955_source">show</a>
                        
                    </p>
                    <div id="M000955_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 213</span>
213:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">build_segment_for_transfer</span>(<span class="ruby-identifier">new_sample</span>, <span class="ruby-identifier">source_segment</span>, <span class="ruby-identifier">target_segment</span>, <span class="ruby-identifier">options</span>)
214:       <span class="ruby-identifier">source_segment</span>.<span class="ruby-identifier">called_segments</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">source_called_segment</span><span class="ruby-operator">|</span>
215:         <span class="ruby-identifier">target_called_segment</span> = <span class="ruby-identifier">new_sample</span>.<span class="ruby-identifier">create_segment</span>(
216:               <span class="ruby-identifier">source_called_segment</span>.<span class="ruby-identifier">entry_timestamp</span>,
217:               <span class="ruby-identifier">source_called_segment</span>.<span class="ruby-identifier">metric_name</span>,
218:               <span class="ruby-identifier">source_called_segment</span>.<span class="ruby-identifier">segment_id</span>)
219: 
220:         <span class="ruby-identifier">target_segment</span>.<span class="ruby-identifier">add_called_segment</span> <span class="ruby-identifier">target_called_segment</span>
221:         <span class="ruby-identifier">source_called_segment</span>.<span class="ruby-identifier">params</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
222:           <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">k</span>
223:           <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:backtrace</span>
224:             <span class="ruby-identifier">target_called_segment</span>[<span class="ruby-identifier">k</span>]=<span class="ruby-identifier">v</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:keep_backtraces</span>]
225:           <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:sql</span>
226:             <span class="ruby-comment cmt"># run an EXPLAIN on this sql if specified.</span>
227:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:record_sql</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:record_sql</span>] <span class="ruby-operator">&amp;&amp;</span>
228:                 <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:explain_sql</span>] <span class="ruby-operator">&amp;&amp;</span>
229:                 <span class="ruby-identifier">source_called_segment</span>.<span class="ruby-identifier">duration</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:explain_sql</span>].<span class="ruby-identifier">to_f</span>
230:               <span class="ruby-identifier">target_called_segment</span>[<span class="ruby-identifier">:explain_plan</span>] = <span class="ruby-identifier">source_called_segment</span>.<span class="ruby-identifier">explain_sql</span>
231:             <span class="ruby-keyword kw">end</span>
232:             
233:             <span class="ruby-identifier">target_called_segment</span>[<span class="ruby-identifier">:sql</span>] = <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:record_sql</span>]
234:               <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:raw</span> <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">v</span>
235:               <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:obfuscated</span> <span class="ruby-keyword kw">then</span> <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Agent</span><span class="ruby-operator">::</span><span class="ruby-constant">Database</span>.<span class="ruby-identifier">obfuscate_sql</span>(<span class="ruby-identifier">v</span>)
236:               <span class="ruby-keyword kw">else</span> <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Invalid value for record_sql: #{options[:record_sql]}&quot;</span>
237:             <span class="ruby-keyword kw">end</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:record_sql</span>]
238:           <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:connection_config</span>
239:             <span class="ruby-comment cmt"># don't copy it</span>
240:           <span class="ruby-keyword kw">else</span>
241:             <span class="ruby-identifier">target_called_segment</span>[<span class="ruby-identifier">k</span>]=<span class="ruby-identifier">v</span>
242:           <span class="ruby-keyword kw">end</span>
243:         <span class="ruby-keyword kw">end</span>
244: 
245:         <span class="ruby-identifier">build_segment_for_transfer</span>(<span class="ruby-identifier">new_sample</span>, <span class="ruby-identifier">source_called_segment</span>, <span class="ruby-identifier">target_called_segment</span>, <span class="ruby-identifier">options</span>)
246:         <span class="ruby-identifier">target_called_segment</span>.<span class="ruby-identifier">end_trace</span>(<span class="ruby-identifier">source_called_segment</span>.<span class="ruby-identifier">exit_timestamp</span>)
247:       <span class="ruby-keyword kw">end</span>
248:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000947">
                    
                    <a name="M000947"></a><b>build_segment_with_omissions</b>(new_sample, time_delta, source_segment, target_segment, regex)
                    
                </div>
                
                <div class="description">
                  <p>
This is badly in need of refactoring
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000947_source')" id="l_M000947_source">show</a>
                        
                    </p>
                    <div id="M000947_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 181</span>
181:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">build_segment_with_omissions</span>(<span class="ruby-identifier">new_sample</span>, <span class="ruby-identifier">time_delta</span>, <span class="ruby-identifier">source_segment</span>, <span class="ruby-identifier">target_segment</span>, <span class="ruby-identifier">regex</span>)
182:       <span class="ruby-identifier">source_segment</span>.<span class="ruby-identifier">called_segments</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">source_called_segment</span><span class="ruby-operator">|</span>
183:         <span class="ruby-comment cmt"># if this segment's metric name matches the given regular expression, bail</span>
184:         <span class="ruby-comment cmt"># here and increase the amount of time that we reduce the target sample with</span>
185:         <span class="ruby-comment cmt"># by this omitted segment's duration.</span>
186:         <span class="ruby-identifier">do_omit</span> = <span class="ruby-identifier">regex</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">source_called_segment</span>.<span class="ruby-identifier">metric_name</span>
187: 
188:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">do_omit</span>
189:           <span class="ruby-identifier">time_delta</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">source_called_segment</span>.<span class="ruby-identifier">duration</span>
190:         <span class="ruby-keyword kw">else</span>
191:           <span class="ruby-identifier">target_called_segment</span> = <span class="ruby-identifier">new_sample</span>.<span class="ruby-identifier">create_segment</span>(
192:                 <span class="ruby-identifier">source_called_segment</span>.<span class="ruby-identifier">entry_timestamp</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">time_delta</span>,
193:                 <span class="ruby-identifier">source_called_segment</span>.<span class="ruby-identifier">metric_name</span>,
194:                 <span class="ruby-identifier">source_called_segment</span>.<span class="ruby-identifier">segment_id</span>)
195: 
196:           <span class="ruby-identifier">target_segment</span>.<span class="ruby-identifier">add_called_segment</span> <span class="ruby-identifier">target_called_segment</span>
197:           <span class="ruby-identifier">source_called_segment</span>.<span class="ruby-identifier">params</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
198:             <span class="ruby-identifier">target_called_segment</span>[<span class="ruby-identifier">k</span>]=<span class="ruby-identifier">v</span>
199:           <span class="ruby-keyword kw">end</span>
200: 
201:           <span class="ruby-identifier">time_delta</span> = <span class="ruby-identifier">build_segment_with_omissions</span>(
202:                 <span class="ruby-identifier">new_sample</span>, <span class="ruby-identifier">time_delta</span>, <span class="ruby-identifier">source_called_segment</span>, <span class="ruby-identifier">target_called_segment</span>, <span class="ruby-identifier">regex</span>)
203:           <span class="ruby-identifier">target_called_segment</span>.<span class="ruby-identifier">end_trace</span>(<span class="ruby-identifier">source_called_segment</span>.<span class="ruby-identifier">exit_timestamp</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">time_delta</span>)
204:         <span class="ruby-keyword kw">end</span>
205:       <span class="ruby-keyword kw">end</span>
206: 
207:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">time_delta</span>
208:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000946">
                    
                    <a name="M000946"></a><b>generate_guid</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000946_source')" id="l_M000946_source">show</a>
                        
                    </p>
                    <div id="M000946_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 176</span>
176:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">generate_guid</span>
177:       (<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">15</span>).<span class="ruby-identifier">to_a</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span> <span class="ruby-identifier">rand</span>(<span class="ruby-value">16</span>).<span class="ruby-identifier">to_s</span>(<span class="ruby-value">16</span>)}.<span class="ruby-identifier">join</span>  <span class="ruby-comment cmt"># a 64 bit random GUID</span>
178:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    