<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>Net::SSH::Gateway</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../../css/main.css" type="text/css" media="screen" />
    <script src="../../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Class</span> 
            Net::SSH::Gateway 
            
                <span class="parent">&lt; 
                    
                    Object
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../../files/lib/net/ssh/gateway_rb.html">lib/net/ssh/gateway.rb</a></li>
            
            <li><a href="../../../files/lib/net/ssh/gateway_rb.html">lib/net/ssh/gateway.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    
    <div class="description">
        <p>
A <a href="Gateway.html">Gateway</a> is an object that allows you to tunnel
network connections through a publicly visible host to a host hidden behind
it. This is particularly useful when dealing with hosts behind a firewall.
One host will generally be visible (and accessible) outside the firewall,
while the others will all be behind the firewall, and the only way to
access those restricted hosts is by first logging into the publicly visible
host, and from thence logging into the restricted ones.
</p>
<p>
This class makes it easy to programmatically connect to these restricted
hosts via <a href="../SSH.html">SSH</a>. You can either simply forward a
port from the local host to the remote host, or you can open a new <a
href="../SSH.html">Net::SSH</a> connection to the remote host via a
forwarded port.
</p>
<pre>
  require 'net/ssh/gateway'

  gateway = Net::SSH::Gateway.new('host.name', 'user')

  gateway.open('hidden.host', 80) do |port|
    Net::HTTP.get_print '127.0.0.1', '/path', port
  end

  gateway.ssh('hidden.host', 'user') do |ssh|
    puts ssh.exec!(&quot;hostname&quot;)
  end

  gateway.shutdown!
</pre>
<p>
Port numbers are allocated automatically, beginning at <a
href="Gateway.html#MAX_PORT">MAX_PORT</a> and decrementing on each request
for a new port until <a href="Gateway.html#MIN_PORT">MIN_PORT</a> is
reached. If a port is already in use, this is detected and a different port
will be assigned.
</p>

    </div>
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>A</dt>
        <dd>
            <ul>
                
                <li><a href="#M000004">active?</a>,</li>
                
                <li><a href="#M000001">active?</a></li>
                
            </ul>
        </dd>
    
        <dt>C</dt>
        <dd>
            <ul>
                
                <li><a href="#M000008">close</a>,</li>
                
                <li><a href="#M000010">close</a></li>
                
            </ul>
        </dd>
    
        <dt>E</dt>
        <dd>
            <ul>
                
                <li><a href="#M000011">ensure_open!</a>,</li>
                
                <li><a href="#M000015">ensure_open!</a></li>
                
            </ul>
        </dd>
    
        <dt>I</dt>
        <dd>
            <ul>
                
                <li><a href="#M000016">initiate_event_loop!</a>,</li>
                
                <li><a href="#M000012">initiate_event_loop!</a></li>
                
            </ul>
        </dd>
    
        <dt>N</dt>
        <dd>
            <ul>
                
                <li><a href="#M000000">new</a>,</li>
                
                <li><a href="#M000003">new</a>,</li>
                
                <li><a href="#M000014">next_port</a>,</li>
                
                <li><a href="#M000017">next_port</a></li>
                
            </ul>
        </dd>
    
        <dt>O</dt>
        <dd>
            <ul>
                
                <li><a href="#M000007">open</a>,</li>
                
                <li><a href="#M000006">open</a></li>
                
            </ul>
        </dd>
    
        <dt>S</dt>
        <dd>
            <ul>
                
                <li><a href="#M000002">shutdown!</a>,</li>
                
                <li><a href="#M000005">shutdown!</a>,</li>
                
                <li><a href="#M000013">ssh</a>,</li>
                
                <li><a href="#M000009">ssh</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    

    

    
    <div class="sectiontitle">Classes and Modules</div>
    <ul>
        
        <li><span class="type">CLASS</span> <a href="Gateway/Version.html">Net::SSH::Gateway::Version</a></li>
        
    </ul>
    

    
    <div class="sectiontitle">Constants</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class="attr-name">MAX_PORT</td>
            <td>=</td>
            <td class="attr-value">65535</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
The maximum port number that the gateway will attempt to use to forward
connections from.
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">MIN_PORT</td>
            <td>=</td>
            <td class="attr-value">1024</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
The minimum port number that the gateway will attempt to use to forward
connections from.
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">MAX_PORT</td>
            <td>=</td>
            <td class="attr-value">65535</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
The maximum port number that the gateway will attempt to use to forward
connections from.
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">MIN_PORT</td>
            <td>=</td>
            <td class="attr-value">1024</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
The minimum port number that the gateway will attempt to use to forward
connections from.
</p>
</td>
        </tr>
        
        
    </table>
    

    

    
            <div class="sectiontitle">Class Public methods</div>
            
            <div class="method">
                <div class="title" id="M000000">
                    
                    <a name="M000000"></a><b>new</b>(host, user, options={})
                    
                </div>
                
                <div class="description">
                  <p>
Instantiate a new <a href="Gateway.html">Gateway</a> object, using the
given remote host as the tunnel. The arguments here are identical to those
for Net::SSH.start, and are passed as given to that method to start up the
gateway connection.
</p>
<pre>
  gateway = Net::SSH::Gateway.new('host', 'user', :password =&gt; &quot;password&quot;)
</pre>
<p>
As of 1.1 there is an additional option to specify the wait time for the
gateway thread. The default is 0.001 seconds and can be changed with the
:loop_wait option.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000000_source')" id="l_M000000_source">show</a>
                        
                    </p>
                    <div id="M000000_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/net/ssh/gateway.rb, line 73</span>
73:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">host</span>, <span class="ruby-identifier">user</span>, <span class="ruby-identifier">options</span>={})
74:     <span class="ruby-ivar">@session</span> = <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">SSH</span>.<span class="ruby-identifier">start</span>(<span class="ruby-identifier">host</span>, <span class="ruby-identifier">user</span>, <span class="ruby-identifier">options</span>)
75:     <span class="ruby-ivar">@session_mutex</span> = <span class="ruby-constant">Mutex</span>.<span class="ruby-identifier">new</span>
76:     <span class="ruby-ivar">@port_mutex</span> = <span class="ruby-constant">Mutex</span>.<span class="ruby-identifier">new</span>
77:     <span class="ruby-ivar">@next_port</span> = <span class="ruby-constant">MAX_PORT</span>
78:     <span class="ruby-ivar">@loop_wait</span> = <span class="ruby-identifier">options</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:loop_wait</span>) <span class="ruby-operator">||</span> <span class="ruby-value">0</span><span class="ruby-value">.001</span>
79:     <span class="ruby-identifier">initiate_event_loop!</span>
80:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000003">
                    
                    <a name="M000003"></a><b>new</b>(host, user, options={})
                    
                </div>
                
                <div class="description">
                  <p>
Instantiate a new <a href="Gateway.html">Gateway</a> object, using the
given remote host as the tunnel. The arguments here are identical to those
for Net::SSH.start, and are passed as given to that method to start up the
gateway connection.
</p>
<pre>
  gateway = Net::SSH::Gateway.new('host', 'user', :password =&gt; &quot;password&quot;)
</pre>
<p>
As of 1.1 there is an additional option to specify the wait time for the
gateway thread. The default is 0.001 seconds and can be changed with the
:loop_wait option.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000003_source')" id="l_M000003_source">show</a>
                        
                    </p>
                    <div id="M000003_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/net/ssh/gateway.rb, line 73</span>
73:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">host</span>, <span class="ruby-identifier">user</span>, <span class="ruby-identifier">options</span>={})
74:     <span class="ruby-ivar">@session</span> = <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">SSH</span>.<span class="ruby-identifier">start</span>(<span class="ruby-identifier">host</span>, <span class="ruby-identifier">user</span>, <span class="ruby-identifier">options</span>)
75:     <span class="ruby-ivar">@session_mutex</span> = <span class="ruby-constant">Mutex</span>.<span class="ruby-identifier">new</span>
76:     <span class="ruby-ivar">@port_mutex</span> = <span class="ruby-constant">Mutex</span>.<span class="ruby-identifier">new</span>
77:     <span class="ruby-ivar">@next_port</span> = <span class="ruby-constant">MAX_PORT</span>
78:     <span class="ruby-ivar">@loop_wait</span> = <span class="ruby-identifier">options</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:loop_wait</span>) <span class="ruby-operator">||</span> <span class="ruby-value">0</span><span class="ruby-value">.001</span>
79:     <span class="ruby-identifier">initiate_event_loop!</span>
80:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M000001">
                    
                    <a name="M000001"></a><b>active?</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Returns <tt>true</tt> if the gateway is currently open and accepting
connections. This will be the case unless <a
href="Gateway.html#M000002">shutdown!</a> has been invoked.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000001_source')" id="l_M000001_source">show</a>
                        
                    </p>
                    <div id="M000001_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/net/ssh/gateway.rb, line 84</span>
84:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">active?</span>
85:     <span class="ruby-ivar">@active</span>
86:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000004">
                    
                    <a name="M000004"></a><b>active?</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Returns <tt>true</tt> if the gateway is currently open and accepting
connections. This will be the case unless <a
href="Gateway.html#M000002">shutdown!</a> has been invoked.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000004_source')" id="l_M000004_source">show</a>
                        
                    </p>
                    <div id="M000004_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/net/ssh/gateway.rb, line 84</span>
84:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">active?</span>
85:     <span class="ruby-ivar">@active</span>
86:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000008">
                    
                    <a name="M000008"></a><b>close</b>(port)
                    
                </div>
                
                <div class="description">
                  <p>
Cancels port-forwarding over an open port that was previously opened via <a
href="Gateway.html#M000006">open</a>.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000008_source')" id="l_M000008_source">show</a>
                        
                    </p>
                    <div id="M000008_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/net/ssh/gateway.rb, line 146</span>
146:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">close</span>(<span class="ruby-identifier">port</span>)
147:     <span class="ruby-identifier">ensure_open!</span>
148: 
149:     <span class="ruby-ivar">@session_mutex</span>.<span class="ruby-identifier">synchronize</span> <span class="ruby-keyword kw">do</span>
150:       <span class="ruby-ivar">@session</span>.<span class="ruby-identifier">forward</span>.<span class="ruby-identifier">cancel_local</span>(<span class="ruby-identifier">port</span>)
151:     <span class="ruby-keyword kw">end</span>
152:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000010">
                    
                    <a name="M000010"></a><b>close</b>(port)
                    
                </div>
                
                <div class="description">
                  <p>
Cancels port-forwarding over an open port that was previously opened via <a
href="Gateway.html#M000006">open</a>.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000010_source')" id="l_M000010_source">show</a>
                        
                    </p>
                    <div id="M000010_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/net/ssh/gateway.rb, line 146</span>
146:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">close</span>(<span class="ruby-identifier">port</span>)
147:     <span class="ruby-identifier">ensure_open!</span>
148: 
149:     <span class="ruby-ivar">@session_mutex</span>.<span class="ruby-identifier">synchronize</span> <span class="ruby-keyword kw">do</span>
150:       <span class="ruby-ivar">@session</span>.<span class="ruby-identifier">forward</span>.<span class="ruby-identifier">cancel_local</span>(<span class="ruby-identifier">port</span>)
151:     <span class="ruby-keyword kw">end</span>
152:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000007">
                    
                    <a name="M000007"></a><b>open</b>(host, port, local_port=nil)
                    
                </div>
                
                <div class="description">
                  <p>
Opens a new port on the local host and forwards it to the given host/port
via the gateway host. If a block is given, the newly allocated port number
will be yielded to the block, and the port automatically closed (see <a
href="Gateway.html#M000008">close</a>) when the block finishes. Otherwise,
the port number will be returned, and the caller is responsible for closing
the port (<a href="Gateway.html#M000008">close</a>).
</p>
<pre>
  gateway.open('host', 80) do |port|
    # ...
  end

  port = gateway.open('host', 80)
  # ...
  gateway.close(port)
</pre>
<p>
If <tt>local_port</tt> is not specified, the next available port will be
used.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000007_source')" id="l_M000007_source">show</a>
                        
                    </p>
                    <div id="M000007_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/net/ssh/gateway.rb, line 121</span>
121:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">open</span>(<span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>, <span class="ruby-identifier">local_port</span>=<span class="ruby-keyword kw">nil</span>)
122:     <span class="ruby-identifier">ensure_open!</span>
123: 
124:     <span class="ruby-identifier">actual_local_port</span> = <span class="ruby-identifier">local_port</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">next_port</span>
125: 
126:     <span class="ruby-ivar">@session_mutex</span>.<span class="ruby-identifier">synchronize</span> <span class="ruby-keyword kw">do</span>
127:       <span class="ruby-ivar">@session</span>.<span class="ruby-identifier">forward</span>.<span class="ruby-identifier">local</span>(<span class="ruby-identifier">actual_local_port</span>, <span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>)
128:     <span class="ruby-keyword kw">end</span>
129: 
130:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block_given?</span>
131:       <span class="ruby-keyword kw">begin</span>
132:         <span class="ruby-keyword kw">yield</span> <span class="ruby-identifier">actual_local_port</span>
133:       <span class="ruby-keyword kw">ensure</span>
134:         <span class="ruby-identifier">close</span>(<span class="ruby-identifier">actual_local_port</span>)
135:       <span class="ruby-keyword kw">end</span>
136:     <span class="ruby-keyword kw">else</span>
137:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">actual_local_port</span>
138:     <span class="ruby-keyword kw">end</span>
139:   <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">EADDRINUSE</span>
140:     <span class="ruby-identifier">raise</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">local_port</span> <span class="ruby-comment cmt"># if a local port was explicitly requested, bubble the error up</span>
141:     <span class="ruby-keyword kw">retry</span>
142:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000006">
                    
                    <a name="M000006"></a><b>open</b>(host, port, local_port=nil)
                    
                </div>
                
                <div class="description">
                  <p>
Opens a new port on the local host and forwards it to the given host/port
via the gateway host. If a block is given, the newly allocated port number
will be yielded to the block, and the port automatically closed (see <a
href="Gateway.html#M000008">close</a>) when the block finishes. Otherwise,
the port number will be returned, and the caller is responsible for closing
the port (<a href="Gateway.html#M000008">close</a>).
</p>
<pre>
  gateway.open('host', 80) do |port|
    # ...
  end

  port = gateway.open('host', 80)
  # ...
  gateway.close(port)
</pre>
<p>
If <tt>local_port</tt> is not specified, the next available port will be
used.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000006_source')" id="l_M000006_source">show</a>
                        
                    </p>
                    <div id="M000006_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/net/ssh/gateway.rb, line 121</span>
121:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">open</span>(<span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>, <span class="ruby-identifier">local_port</span>=<span class="ruby-keyword kw">nil</span>)
122:     <span class="ruby-identifier">ensure_open!</span>
123: 
124:     <span class="ruby-identifier">actual_local_port</span> = <span class="ruby-identifier">local_port</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">next_port</span>
125: 
126:     <span class="ruby-ivar">@session_mutex</span>.<span class="ruby-identifier">synchronize</span> <span class="ruby-keyword kw">do</span>
127:       <span class="ruby-ivar">@session</span>.<span class="ruby-identifier">forward</span>.<span class="ruby-identifier">local</span>(<span class="ruby-identifier">actual_local_port</span>, <span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>)
128:     <span class="ruby-keyword kw">end</span>
129: 
130:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block_given?</span>
131:       <span class="ruby-keyword kw">begin</span>
132:         <span class="ruby-keyword kw">yield</span> <span class="ruby-identifier">actual_local_port</span>
133:       <span class="ruby-keyword kw">ensure</span>
134:         <span class="ruby-identifier">close</span>(<span class="ruby-identifier">actual_local_port</span>)
135:       <span class="ruby-keyword kw">end</span>
136:     <span class="ruby-keyword kw">else</span>
137:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">actual_local_port</span>
138:     <span class="ruby-keyword kw">end</span>
139:   <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">EADDRINUSE</span>
140:     <span class="ruby-identifier">raise</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">local_port</span> <span class="ruby-comment cmt"># if a local port was explicitly requested, bubble the error up</span>
141:     <span class="ruby-keyword kw">retry</span>
142:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000002">
                    
                    <a name="M000002"></a><b>shutdown!</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Shuts down the gateway by closing all forwarded ports and then closing the
gateway&#8217;s <a href="../SSH.html">SSH</a> session.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000002_source')" id="l_M000002_source">show</a>
                        
                    </p>
                    <div id="M000002_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/net/ssh/gateway.rb, line 90</span>
 90:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">shutdown!</span>
 91:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">active?</span>
 92: 
 93:     <span class="ruby-ivar">@session_mutex</span>.<span class="ruby-identifier">synchronize</span> <span class="ruby-keyword kw">do</span>
 94:       <span class="ruby-comment cmt"># cancel all active forward channels</span>
 95:       <span class="ruby-ivar">@session</span>.<span class="ruby-identifier">forward</span>.<span class="ruby-identifier">active_locals</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">lport</span>, <span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span><span class="ruby-operator">|</span>
 96:         <span class="ruby-ivar">@session</span>.<span class="ruby-identifier">forward</span>.<span class="ruby-identifier">cancel_local</span>(<span class="ruby-identifier">lport</span>)
 97:       <span class="ruby-keyword kw">end</span>
 98:     <span class="ruby-keyword kw">end</span>
 99: 
100:     <span class="ruby-ivar">@active</span> = <span class="ruby-keyword kw">false</span>
101:     
102:     <span class="ruby-ivar">@thread</span>.<span class="ruby-identifier">join</span>
103:     <span class="ruby-ivar">@session</span>.<span class="ruby-identifier">close</span>
104:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000005">
                    
                    <a name="M000005"></a><b>shutdown!</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Shuts down the gateway by closing all forwarded ports and then closing the
gateway&#8217;s <a href="../SSH.html">SSH</a> session.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000005_source')" id="l_M000005_source">show</a>
                        
                    </p>
                    <div id="M000005_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/net/ssh/gateway.rb, line 90</span>
 90:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">shutdown!</span>
 91:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">active?</span>
 92: 
 93:     <span class="ruby-ivar">@session_mutex</span>.<span class="ruby-identifier">synchronize</span> <span class="ruby-keyword kw">do</span>
 94:       <span class="ruby-comment cmt"># cancel all active forward channels</span>
 95:       <span class="ruby-ivar">@session</span>.<span class="ruby-identifier">forward</span>.<span class="ruby-identifier">active_locals</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">lport</span>, <span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span><span class="ruby-operator">|</span>
 96:         <span class="ruby-ivar">@session</span>.<span class="ruby-identifier">forward</span>.<span class="ruby-identifier">cancel_local</span>(<span class="ruby-identifier">lport</span>)
 97:       <span class="ruby-keyword kw">end</span>
 98:     <span class="ruby-keyword kw">end</span>
 99: 
100:     <span class="ruby-ivar">@active</span> = <span class="ruby-keyword kw">false</span>
101:     
102:     <span class="ruby-ivar">@thread</span>.<span class="ruby-identifier">join</span>
103:     <span class="ruby-ivar">@session</span>.<span class="ruby-identifier">close</span>
104:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000013">
                    
                    <a name="M000013"></a><b>ssh</b>(host, user, options={}, &amp;block)
                    
                </div>
                
                <div class="description">
                  <p>
Forwards a new connection to the given <tt>host</tt> and opens a new <a
href="../SSH.html">Net::SSH</a> connection to that host over the forwarded
port. If a block is given, the new <a href="../SSH.html">SSH</a> connection
will be yielded to the block, and autoclosed when the block terminates. The
forwarded port will be autoclosed as well. If no block was given, the new
<a href="../SSH.html">SSH</a> connection will be returned, and it is up to
the caller to terminate both the connection and the forwarded port when
done.
</p>
<pre>
  gateway.ssh('host', 'user') do |ssh|
    # ...
  end

  ssh = gateway.ssh('host', 'user')
  # ...
  ssh.close
  gateway.close(ssh.transport.port)
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000013_source')" id="l_M000013_source">show</a>
                        
                    </p>
                    <div id="M000013_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/net/ssh/gateway.rb, line 170</span>
170:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">ssh</span>(<span class="ruby-identifier">host</span>, <span class="ruby-identifier">user</span>, <span class="ruby-identifier">options</span>={}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
171:     <span class="ruby-identifier">local_port</span> = <span class="ruby-identifier">open</span>(<span class="ruby-identifier">host</span>, <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:port</span>] <span class="ruby-operator">||</span> <span class="ruby-value">22</span>)
172: 
173:     <span class="ruby-keyword kw">begin</span>
174:       <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">SSH</span>.<span class="ruby-identifier">start</span>(<span class="ruby-value str">&quot;127.0.0.1&quot;</span>, <span class="ruby-identifier">user</span>, <span class="ruby-identifier">options</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">:port</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">local_port</span>), <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
175:     <span class="ruby-keyword kw">ensure</span>
176:       <span class="ruby-identifier">close</span>(<span class="ruby-identifier">local_port</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">$!</span>
177:     <span class="ruby-keyword kw">end</span>
178:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000009">
                    
                    <a name="M000009"></a><b>ssh</b>(host, user, options={}, &amp;block)
                    
                </div>
                
                <div class="description">
                  <p>
Forwards a new connection to the given <tt>host</tt> and opens a new <a
href="../SSH.html">Net::SSH</a> connection to that host over the forwarded
port. If a block is given, the new <a href="../SSH.html">SSH</a> connection
will be yielded to the block, and autoclosed when the block terminates. The
forwarded port will be autoclosed as well. If no block was given, the new
<a href="../SSH.html">SSH</a> connection will be returned, and it is up to
the caller to terminate both the connection and the forwarded port when
done.
</p>
<pre>
  gateway.ssh('host', 'user') do |ssh|
    # ...
  end

  ssh = gateway.ssh('host', 'user')
  # ...
  ssh.close
  gateway.close(ssh.transport.port)
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000009_source')" id="l_M000009_source">show</a>
                        
                    </p>
                    <div id="M000009_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/net/ssh/gateway.rb, line 170</span>
170:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">ssh</span>(<span class="ruby-identifier">host</span>, <span class="ruby-identifier">user</span>, <span class="ruby-identifier">options</span>={}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
171:     <span class="ruby-identifier">local_port</span> = <span class="ruby-identifier">open</span>(<span class="ruby-identifier">host</span>, <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:port</span>] <span class="ruby-operator">||</span> <span class="ruby-value">22</span>)
172: 
173:     <span class="ruby-keyword kw">begin</span>
174:       <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">SSH</span>.<span class="ruby-identifier">start</span>(<span class="ruby-value str">&quot;127.0.0.1&quot;</span>, <span class="ruby-identifier">user</span>, <span class="ruby-identifier">options</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">:port</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">local_port</span>), <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
175:     <span class="ruby-keyword kw">ensure</span>
176:       <span class="ruby-identifier">close</span>(<span class="ruby-identifier">local_port</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">$!</span>
177:     <span class="ruby-keyword kw">end</span>
178:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Private methods</div>
            
            <div class="method">
                <div class="title" id="M000015">
                    
                    <a name="M000015"></a><b>ensure_open!</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Raises a RuntimeError if the gateway is not active. This is used as a
sanity check to make sure a client doesn&#8217;t try to call any methods on
a closed gateway.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000015_source')" id="l_M000015_source">show</a>
                        
                    </p>
                    <div id="M000015_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/net/ssh/gateway.rb, line 185</span>
185:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">ensure_open!</span>
186:       <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;attempt to use a closed gateway&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">active?</span>
187:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000011">
                    
                    <a name="M000011"></a><b>ensure_open!</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Raises a RuntimeError if the gateway is not active. This is used as a
sanity check to make sure a client doesn&#8217;t try to call any methods on
a closed gateway.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000011_source')" id="l_M000011_source">show</a>
                        
                    </p>
                    <div id="M000011_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/net/ssh/gateway.rb, line 185</span>
185:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">ensure_open!</span>
186:       <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;attempt to use a closed gateway&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">active?</span>
187:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000012">
                    
                    <a name="M000012"></a><b>initiate_event_loop!</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Fires up the gateway session&#8217;s event loop within a thread, so that it
can run in the background. The loop will run for as long as the gateway
remains active.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000012_source')" id="l_M000012_source">show</a>
                        
                    </p>
                    <div id="M000012_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/net/ssh/gateway.rb, line 192</span>
192:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initiate_event_loop!</span>
193:       <span class="ruby-ivar">@active</span> = <span class="ruby-keyword kw">true</span>
194: 
195:       <span class="ruby-ivar">@thread</span> = <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword kw">do</span>
196:         <span class="ruby-keyword kw">while</span> <span class="ruby-ivar">@active</span>
197:           <span class="ruby-ivar">@session_mutex</span>.<span class="ruby-identifier">synchronize</span> <span class="ruby-keyword kw">do</span>
198:             <span class="ruby-ivar">@session</span>.<span class="ruby-identifier">process</span>(<span class="ruby-ivar">@loop_wait</span>)
199:           <span class="ruby-keyword kw">end</span>
200:           <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">pass</span>
201:         <span class="ruby-keyword kw">end</span>
202:       <span class="ruby-keyword kw">end</span>
203:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000016">
                    
                    <a name="M000016"></a><b>initiate_event_loop!</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Fires up the gateway session&#8217;s event loop within a thread, so that it
can run in the background. The loop will run for as long as the gateway
remains active.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000016_source')" id="l_M000016_source">show</a>
                        
                    </p>
                    <div id="M000016_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/net/ssh/gateway.rb, line 192</span>
192:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initiate_event_loop!</span>
193:       <span class="ruby-ivar">@active</span> = <span class="ruby-keyword kw">true</span>
194: 
195:       <span class="ruby-ivar">@thread</span> = <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword kw">do</span>
196:         <span class="ruby-keyword kw">while</span> <span class="ruby-ivar">@active</span>
197:           <span class="ruby-ivar">@session_mutex</span>.<span class="ruby-identifier">synchronize</span> <span class="ruby-keyword kw">do</span>
198:             <span class="ruby-ivar">@session</span>.<span class="ruby-identifier">process</span>(<span class="ruby-ivar">@loop_wait</span>)
199:           <span class="ruby-keyword kw">end</span>
200:           <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">pass</span>
201:         <span class="ruby-keyword kw">end</span>
202:       <span class="ruby-keyword kw">end</span>
203:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000014">
                    
                    <a name="M000014"></a><b>next_port</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Grabs the next available port number and returns it.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000014_source')" id="l_M000014_source">show</a>
                        
                    </p>
                    <div id="M000014_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/net/ssh/gateway.rb, line 206</span>
206:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">next_port</span>
207:       <span class="ruby-ivar">@port_mutex</span>.<span class="ruby-identifier">synchronize</span> <span class="ruby-keyword kw">do</span>
208:         <span class="ruby-identifier">port</span> = <span class="ruby-ivar">@next_port</span>
209:         <span class="ruby-ivar">@next_port</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span>
210:         <span class="ruby-ivar">@next_port</span> = <span class="ruby-constant">MAX_PORT</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@next_port</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">MIN_PORT</span>
211:         <span class="ruby-identifier">port</span>
212:       <span class="ruby-keyword kw">end</span>
213:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000017">
                    
                    <a name="M000017"></a><b>next_port</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Grabs the next available port number and returns it.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000017_source')" id="l_M000017_source">show</a>
                        
                    </p>
                    <div id="M000017_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/net/ssh/gateway.rb, line 206</span>
206:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">next_port</span>
207:       <span class="ruby-ivar">@port_mutex</span>.<span class="ruby-identifier">synchronize</span> <span class="ruby-keyword kw">do</span>
208:         <span class="ruby-identifier">port</span> = <span class="ruby-ivar">@next_port</span>
209:         <span class="ruby-ivar">@next_port</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span>
210:         <span class="ruby-ivar">@next_port</span> = <span class="ruby-constant">MAX_PORT</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@next_port</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">MIN_PORT</span>
211:         <span class="ruby-identifier">port</span>
212:       <span class="ruby-keyword kw">end</span>
213:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    