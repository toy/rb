<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>Vagrant::TestHelpers</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../css/main.css" type="text/css" media="screen" />
    <script src="../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Module</span> 
            Vagrant::TestHelpers 
            
        </h1>
        <ul class="files">
            
            <li><a href="../../files/lib/vagrant/test_helpers_rb.html">lib/vagrant/test_helpers.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    
    <div class="description">
        <p>
Test helpers provided by <a href="../Vagrant.html">Vagrant</a> to allow for
plugin developers to write automated tests for their code. This module
simply provides methods which can be included into any test framework
(`test/unit`, RSpec, Shoulda, etc.)
</p>

    </div>
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>A</dt>
        <dd>
            <ul>
                
                <li><a href="#M000544">action_env</a></li>
                
            </ul>
        </dd>
    
        <dt>B</dt>
        <dd>
            <ul>
                
                <li><a href="#M000549">boxes_path</a></li>
                
            </ul>
        </dd>
    
        <dt>C</dt>
        <dd>
            <ul>
                
                <li><a href="#M000545">capture</a>,</li>
                
                <li><a href="#M000550">clean_paths</a></li>
                
            </ul>
        </dd>
    
        <dt>H</dt>
        <dd>
            <ul>
                
                <li><a href="#M000548">home_path</a></li>
                
            </ul>
        </dd>
    
        <dt>S</dt>
        <dd>
            <ul>
                
                <li><a href="#M000546">silence</a></li>
                
            </ul>
        </dd>
    
        <dt>T</dt>
        <dd>
            <ul>
                
                <li><a href="#M000547">tmp_path</a></li>
                
            </ul>
        </dd>
    
        <dt>V</dt>
        <dd>
            <ul>
                
                <li><a href="#M000539">vagrant_app</a>,</li>
                
                <li><a href="#M000542">vagrant_box</a>,</li>
                
                <li><a href="#M000541">vagrant_env</a>,</li>
                
                <li><a href="#M000543">vagrant_mock_downloader</a>,</li>
                
                <li><a href="#M000540">vagrantfile</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    

    

    

    

    

    
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M000544">
                    
                    <a name="M000544"></a><b>action_env</b>(v_env = nil)
                    
                </div>
                
                <div class="description">
                  <p>
Returns a blank app (callable) and action environment with the given
vagrant environment. This allows for testing of middlewares.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000544_source')" id="l_M000544_source">show</a>
                        
                    </p>
                    <div id="M000544_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/vagrant/test_helpers.rb, line 79</span>
79:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">action_env</span>(<span class="ruby-identifier">v_env</span> = <span class="ruby-keyword kw">nil</span>)
80:       <span class="ruby-identifier">v_env</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">vagrant_env</span>
81:       <span class="ruby-identifier">app</span> = <span class="ruby-identifier">lambda</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">env</span><span class="ruby-operator">|</span> }
82:       <span class="ruby-identifier">env</span> = <span class="ruby-constant">Vagrant</span><span class="ruby-operator">::</span><span class="ruby-constant">Action</span><span class="ruby-operator">::</span><span class="ruby-constant">Environment</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">v_env</span>)
83:       <span class="ruby-identifier">env</span>[<span class="ruby-value str">&quot;vagrant.test&quot;</span>] = <span class="ruby-keyword kw">true</span>
84:       [<span class="ruby-identifier">app</span>, <span class="ruby-identifier">env</span>]
85:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000549">
                    
                    <a name="M000549"></a><b>boxes_path</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Path to the boxes directory in the home directory
</p>
<p>
@return [Pathname]
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000549_source')" id="l_M000549_source">show</a>
                        
                    </p>
                    <div id="M000549_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/vagrant/test_helpers.rb, line 134</span>
134:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">boxes_path</span>
135:       <span class="ruby-identifier">result</span> = <span class="ruby-identifier">home_path</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;boxes&quot;</span>)
136:       <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span>(<span class="ruby-identifier">result</span>)
137:       <span class="ruby-identifier">result</span>
138:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000545">
                    
                    <a name="M000545"></a><b>capture</b>(stream)
                    
                </div>
                
                <div class="description">
                  <p>
Utility method for capturing output streams. @example Evaluate the output
</p>
<pre>
  output = capture(:stdout){ env.cli(&quot;foo&quot;) }
  assert_equal &quot;bar&quot;, output
</pre>
<p>
@example Silence the output
</p>
<pre>
  silence(:stdout){ env.cli(&quot;init&quot;) }
</pre>
<p>
@param [:stdout, :stderr] stream The stream to capture @yieldreturn String
@see <a
href="https://github.com/wycats/thor/blob/master/spec/spec_helper.rb">github.com/wycats/thor/blob/master/spec/spec_helper.rb</a>
</p>

                </div>
                
                
                <div class="aka">
                    This method is also aliased as
                    
                    <a href="TestHelpers.html#M000546">silence</a>
                    
                </div>
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000545_source')" id="l_M000545_source">show</a>
                        
                    </p>
                    <div id="M000545_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/vagrant/test_helpers.rb, line 96</span>
 96:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">capture</span>(<span class="ruby-identifier">stream</span>)
 97:       <span class="ruby-keyword kw">begin</span>
 98:         <span class="ruby-identifier">stream</span> = <span class="ruby-identifier">stream</span>.<span class="ruby-identifier">to_s</span>
 99:         <span class="ruby-identifier">eval</span> <span class="ruby-node">&quot;$#{stream} = StringIO.new&quot;</span>
100:         <span class="ruby-keyword kw">yield</span>
101:         <span class="ruby-identifier">result</span> = <span class="ruby-identifier">eval</span>(<span class="ruby-node">&quot;$#{stream}&quot;</span>).<span class="ruby-identifier">string</span>
102:       <span class="ruby-keyword kw">ensure</span>
103:         <span class="ruby-identifier">eval</span>(<span class="ruby-node">&quot;$#{stream} = #{stream.upcase}&quot;</span>)
104:       <span class="ruby-keyword kw">end</span>
105: 
106:       <span class="ruby-identifier">result</span>
107:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000550">
                    
                    <a name="M000550"></a><b>clean_paths</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Cleans all the test temp paths, which includes the boxes path, home path,
etc. This allows for cleaning between tests.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000550_source')" id="l_M000550_source">show</a>
                        
                    </p>
                    <div id="M000550_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/vagrant/test_helpers.rb, line 142</span>
142:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">clean_paths</span>
143:       <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm_rf</span>(<span class="ruby-identifier">tmp_path</span>)
144: 
145:       <span class="ruby-comment cmt"># Call these methods only to rebuild the directories</span>
146:       <span class="ruby-identifier">tmp_path</span>
147:       <span class="ruby-identifier">home_path</span>
148:       <span class="ruby-identifier">boxes_path</span>
149:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000548">
                    
                    <a name="M000548"></a><b>home_path</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Path to the &#8220;home&#8221; directory for the tests
</p>
<p>
@return [Pathname]
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000548_source')" id="l_M000548_source">show</a>
                        
                    </p>
                    <div id="M000548_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/vagrant/test_helpers.rb, line 125</span>
125:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">home_path</span>
126:       <span class="ruby-identifier">result</span> = <span class="ruby-identifier">tmp_path</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;home&quot;</span>)
127:       <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span>(<span class="ruby-identifier">result</span>)
128:       <span class="ruby-identifier">result</span>
129:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000546">
                    
                    <a name="M000546"></a><b>silence</b>(stream)
                    
                </div>
                
                <div class="description">
                  <p>
Alias for <a href="TestHelpers.html#M000545">capture</a>
</p>

                </div>
                
                
                
            </div>
            
            <div class="method">
                <div class="title" id="M000547">
                    
                    <a name="M000547"></a><b>tmp_path</b>()
                    
                </div>
                
                <div class="description">
                  <hr size="10"></hr><pre>
 Path helpers
</pre>
<hr size="10"></hr><pre>
 Path to the tmp directory for the tests.

 @return [Pathname]
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000547_source')" id="l_M000547_source">show</a>
                        
                    </p>
                    <div id="M000547_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/vagrant/test_helpers.rb, line 116</span>
116:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">tmp_path</span>
117:       <span class="ruby-identifier">result</span> = <span class="ruby-constant">Vagrant</span>.<span class="ruby-identifier">source_root</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;test&quot;</span>, <span class="ruby-value str">&quot;tmp&quot;</span>)
118:       <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span>(<span class="ruby-identifier">result</span>)
119:       <span class="ruby-identifier">result</span>
120:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000539">
                    
                    <a name="M000539"></a><b>vagrant_app</b>(*path)
                    
                </div>
                
                <div class="description">
                  <hr size="10"></hr><pre>
 Environment creation helpers
</pre>
<hr size="10"></hr><pre>
 Creates a &quot;vagrant_app&quot; directory in the test tmp folder
 which can be used for creating test Vagrant environments.
 Returns the root directory of the app. This typically doesn't need
 to be called directly unless you're setting up a custom application.
 See the examples for common use cases.
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000539_source')" id="l_M000539_source">show</a>
                        
                    </p>
                    <div id="M000539_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/vagrant/test_helpers.rb, line 15</span>
15:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">vagrant_app</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">path</span>)
16:       <span class="ruby-identifier">root</span> = <span class="ruby-identifier">tmp_path</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;vagrant_app&quot;</span>)
17:       <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm_rf</span>(<span class="ruby-identifier">root</span>)
18:       <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span>(<span class="ruby-identifier">root</span>)
19:       <span class="ruby-identifier">root</span>.<span class="ruby-identifier">join</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">path</span>)
20:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000542">
                    
                    <a name="M000542"></a><b>vagrant_box</b>(name)
                    
                </div>
                
                <div class="description">
                  <p>
Creates the folder to contain a vagrant box. This allows for
&#8220;fake&#8221; boxes to be made with the specified name.
</p>
<p>
@param [String] name @return [Pathname]
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000542_source')" id="l_M000542_source">show</a>
                        
                    </p>
                    <div id="M000542_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/vagrant/test_helpers.rb, line 58</span>
58:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">vagrant_box</span>(<span class="ruby-identifier">name</span>)
59:       <span class="ruby-identifier">result</span> = <span class="ruby-identifier">boxes_path</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">name</span>)
60:       <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span>(<span class="ruby-identifier">result</span>)
61:       <span class="ruby-identifier">result</span>
62:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000541">
                    
                    <a name="M000541"></a><b>vagrant_env</b>(*args)
                    
                </div>
                
                <div class="description">
                  <p>
Creates and <em>loads</em> a <a href="../Vagrant.html">Vagrant</a>
environment at the given path. If no path is given, then a default {<a
href="TestHelpers.html#M000540">vagrantfile</a>} is used.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000541_source')" id="l_M000541_source">show</a>
                        
                    </p>
                    <div id="M000541_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/vagrant/test_helpers.rb, line 47</span>
47:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">vagrant_env</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
48:       <span class="ruby-identifier">path</span> = <span class="ruby-identifier">args</span>.<span class="ruby-identifier">shift</span> <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Pathname</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">first</span>
49:       <span class="ruby-identifier">path</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">vagrantfile</span>
50:       <span class="ruby-constant">Vagrant</span><span class="ruby-operator">::</span><span class="ruby-constant">Environment</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:cwd</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">path</span>).<span class="ruby-identifier">load!</span>
51:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000543">
                    
                    <a name="M000543"></a><b>vagrant_mock_downloader</b>(klass)
                    
                </div>
                
                <div class="description">
                  <p>
Returns an instantiated downloader with a mocked tempfile which can be
passed into it.
</p>
<p>
@param [Class] klass The downloader class @return [Array] Returns an array
of `downloader` `tempfile`
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000543_source')" id="l_M000543_source">show</a>
                        
                    </p>
                    <div id="M000543_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/vagrant/test_helpers.rb, line 69</span>
69:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">vagrant_mock_downloader</span>(<span class="ruby-identifier">klass</span>)
70:       <span class="ruby-identifier">tempfile</span> = <span class="ruby-identifier">mock</span>(<span class="ruby-value str">&quot;tempfile&quot;</span>)
71:       <span class="ruby-identifier">tempfile</span>.<span class="ruby-identifier">stubs</span>(<span class="ruby-identifier">:write</span>)
72: 
73:       <span class="ruby-identifier">_</span>, <span class="ruby-identifier">env</span> = <span class="ruby-identifier">action_env</span>
74:       [<span class="ruby-identifier">klass</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">env</span>), <span class="ruby-identifier">tempfile</span>]
75:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000540">
                    
                    <a name="M000540"></a><b>vagrantfile</b>(*args)
                    
                </div>
                
                <div class="description">
                  <p>
Creates a Vagrantfile with the given contents in the given app directory.
If no app directory is specified, then a default <a
href="../Vagrant.html">Vagrant</a> app is used.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000540_source')" id="l_M000540_source">show</a>
                        
                    </p>
                    <div id="M000540_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/vagrant/test_helpers.rb, line 25</span>
25:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">vagrantfile</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
26:       <span class="ruby-identifier">path</span> = <span class="ruby-identifier">args</span>.<span class="ruby-identifier">shift</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;Vagrantfile&quot;</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Pathname</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">first</span>
27:       <span class="ruby-identifier">path</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">vagrant_app</span>(<span class="ruby-value str">&quot;Vagrantfile&quot;</span>)
28: 
29:       <span class="ruby-comment cmt"># Create this box so that it exists</span>
30:       <span class="ruby-identifier">vagrant_box</span>(<span class="ruby-value str">&quot;base&quot;</span>)
31: 
32:       <span class="ruby-identifier">str</span>  = <span class="ruby-identifier">args</span>.<span class="ruby-identifier">shift</span> <span class="ruby-operator">||</span> <span class="ruby-value str">&quot;&quot;</span>
33:       <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">path</span>.<span class="ruby-identifier">to_s</span>, <span class="ruby-value str">&quot;w&quot;</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span>
34:         <span class="ruby-identifier">f</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;ENV['VAGRANT_HOME'] = '#{home_path}'&quot;</span>
35:         <span class="ruby-identifier">f</span>.<span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;Vagrant::Config.run do |config|&quot;</span>
36:         <span class="ruby-identifier">f</span>.<span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;config.vm.base_mac = 'foo' if !config.vm.base_mac&quot;</span>
37:         <span class="ruby-identifier">f</span>.<span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;config.vm.box = 'base'&quot;</span>
38:         <span class="ruby-identifier">f</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">str</span>
39:         <span class="ruby-identifier">f</span>.<span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;end&quot;</span>
40:       <span class="ruby-keyword kw">end</span>
41: 
42:       <span class="ruby-identifier">path</span>.<span class="ruby-identifier">parent</span>
43:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    