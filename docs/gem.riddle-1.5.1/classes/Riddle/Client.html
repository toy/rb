<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>Riddle::Client</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../css/main.css" type="text/css" media="screen" />
    <script src="../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Class</span> 
            Riddle::Client 
            
                <span class="parent">&lt; 
                    
                    Object
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../files/lib/riddle/0_9_9/client_rb.html">lib/riddle/0.9.9/client.rb</a></li>
            
            <li><a href="../../files/lib/riddle/1_10/client_rb.html">lib/riddle/1.10/client.rb</a></li>
            
            <li><a href="../../files/lib/riddle/client/filter_rb.html">lib/riddle/client/filter.rb</a></li>
            
            <li><a href="../../files/lib/riddle/client/message_rb.html">lib/riddle/client/message.rb</a></li>
            
            <li><a href="../../files/lib/riddle/client/response_rb.html">lib/riddle/client/response.rb</a></li>
            
            <li><a href="../../files/lib/riddle/client_rb.html">lib/riddle/client.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    
    <div class="description">
        <p>
This class was heavily based on the existing <a
href="Client.html">Client</a> API by Dmytro Shteflyuk and Alexy Kovyrin.
Their code worked fine, I just wanted something a bit more Ruby-ish (ie.
lowercase and underscored method names). I also have used a few helper
classes, just to neaten things up.
</p>
<p>
Feel free to use it wherever. Send bug reports, patches, comments and
suggestions to pat at freelancing-gods dot com.
</p>
<p>
Most properties of the client are accessible through attribute accessors,
and where relevant use symboles instead of the long constants common in
other clients. Some examples:
</p>
<pre>
  client.sort_mode  = :extended
  client.sort_by    = &quot;birthday DESC&quot;
  client.match_mode = :extended
</pre>
<p>
To add a filter, you will need to create a <a
href="Client/Filter.html">Filter</a> object:
</p>
<pre>
  client.filters &lt;&lt; Riddle::Client::Filter.new(&quot;birthday&quot;,
    Time.at(1975, 1, 1).to_i..Time.at(1985, 1, 1).to_i, false)
</pre>

    </div>
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>A</dt>
        <dd>
            <ul>
                
                <li><a href="#M000085">add_override</a>,</li>
                
                <li><a href="#M000051">append_query</a>,</li>
                
                <li><a href="#M000110">attribute_from_type</a></li>
                
            </ul>
        </dd>
    
        <dt>C</dt>
        <dd>
            <ul>
                
                <li><a href="#M000087">close</a>,</li>
                
                <li><a href="#M000089">close_socket</a>,</li>
                
                <li><a href="#M000090">connect</a>,</li>
                
                <li><a href="#M000044">connection</a>,</li>
                
                <li><a href="#M000043">connection=</a></li>
                
            </ul>
        </dd>
    
        <dt>E</dt>
        <dd>
            <ul>
                
                <li><a href="#M000111">excerpt_flags</a>,</li>
                
                <li><a href="#M000078">excerpts</a>,</li>
                
                <li><a href="#M000007">excerpts_message</a>,</li>
                
                <li><a href="#M000107">excerpts_message</a></li>
                
            </ul>
        </dd>
    
        <dt>F</dt>
        <dd>
            <ul>
                
                <li><a href="#M000084">flush_attributes</a></li>
                
            </ul>
        </dd>
    
        <dt>I</dt>
        <dd>
            <ul>
                
                <li><a href="#M000002">initialise_connection</a>,</li>
                
                <li><a href="#M000091">initialise_connection</a>,</li>
                
                <li><a href="#M000092">initialise_socket</a></li>
                
            </ul>
        </dd>
    
        <dt>K</dt>
        <dd>
            <ul>
                
                <li><a href="#M000099">key_message</a>,</li>
                
                <li><a href="#M000080">keywords</a>,</li>
                
                <li><a href="#M000109">keywords_message</a></li>
                
            </ul>
        </dd>
    
        <dt>N</dt>
        <dd>
            <ul>
                
                <li><a href="#M000045">new</a></li>
                
            </ul>
        </dd>
    
        <dt>O</dt>
        <dd>
            <ul>
                
                <li><a href="#M000086">open</a>,</li>
                
                <li><a href="#M000088">open_socket</a></li>
                
            </ul>
        </dd>
    
        <dt>Q</dt>
        <dd>
            <ul>
                
                <li><a href="#M000076">query</a>,</li>
                
                <li><a href="#M000101">query_message</a></li>
                
            </ul>
        </dd>
    
        <dt>R</dt>
        <dd>
            <ul>
                
                <li><a href="#M000100">request</a>,</li>
                
                <li><a href="#M000095">request_header</a>,</li>
                
                <li><a href="#M000046">reset</a>,</li>
                
                <li><a href="#M000052">run</a></li>
                
            </ul>
        </dd>
    
        <dt>S</dt>
        <dd>
            <ul>
                
                <li><a href="#M000048">server</a>,</li>
                
                <li><a href="#M000049">server=</a>,</li>
                
                <li><a href="#M000050">set_anchor</a>,</li>
                
                <li><a href="#M000083">status</a></li>
                
            </ul>
        </dd>
    
        <dt>U</dt>
        <dd>
            <ul>
                
                <li><a href="#M000079">update</a>,</li>
                
                <li><a href="#M000003">update_message</a>,</li>
                
                <li><a href="#M000108">update_message</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    

    

    
    <div class="sectiontitle">Classes and Modules</div>
    <ul>
        
        <li><span class="type">CLASS</span> <a href="Client/Filter.html">Riddle::Client::Filter</a></li>
        
        <li><span class="type">CLASS</span> <a href="Client/Message.html">Riddle::Client::Message</a></li>
        
        <li><span class="type">CLASS</span> <a href="Client/Response.html">Riddle::Client::Response</a></li>
        
    </ul>
    

    
    <div class="sectiontitle">Constants</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class="attr-name">Commands</td>
            <td>=</td>
            <td class="attr-value">{       :search     =&gt; 0, # SEARCHD_COMMAND_SEARCH       :excerpt    =&gt; 1, # SEARCHD_COMMAND_EXCERPT       :update     =&gt; 2, # SEARCHD_COMMAND_UPDATE       :keywords   =&gt; 3, # SEARCHD_COMMAND_KEYWORDS       :persist    =&gt; 4, # SEARCHD_COMMAND_PERSIST       :status     =&gt; 5, # SEARCHD_COMMAND_STATUS       :query      =&gt; 6, # SEARCHD_COMMAND_QUERY       :flushattrs =&gt; 7  # SEARCHD_COMMAND_FLUSHATTRS     }</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">Versions</td>
            <td>=</td>
            <td class="attr-value">{       :search     =&gt; 0x113, # VER_COMMAND_SEARCH       :excerpt    =&gt; 0x100, # VER_COMMAND_EXCERPT       :update     =&gt; 0x101, # VER_COMMAND_UPDATE       :keywords   =&gt; 0x100, # VER_COMMAND_KEYWORDS       :status     =&gt; 0x100, # VER_COMMAND_STATUS       :query      =&gt; 0x100, # VER_COMMAND_QUERY       :flushattrs =&gt; 0x100  # VER_COMMAND_FLUSHATTRS     }</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">Statuses</td>
            <td>=</td>
            <td class="attr-value">{       :ok      =&gt; 0, # SEARCHD_OK       :error   =&gt; 1, # SEARCHD_ERROR       :retry   =&gt; 2, # SEARCHD_RETRY       :warning =&gt; 3  # SEARCHD_WARNING     }</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">MatchModes</td>
            <td>=</td>
            <td class="attr-value">{       :all        =&gt; 0, # SPH_MATCH_ALL       :any        =&gt; 1, # SPH_MATCH_ANY       :phrase     =&gt; 2, # SPH_MATCH_PHRASE       :boolean    =&gt; 3, # SPH_MATCH_BOOLEAN       :extended   =&gt; 4, # SPH_MATCH_EXTENDED       :fullscan   =&gt; 5, # SPH_MATCH_FULLSCAN       :extended2  =&gt; 6  # SPH_MATCH_EXTENDED2     }</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">RankModes</td>
            <td>=</td>
            <td class="attr-value">{       :proximity_bm25 =&gt; 0, # SPH_RANK_PROXIMITY_BM25       :bm25           =&gt; 1, # SPH_RANK_BM25       :none           =&gt; 2, # SPH_RANK_NONE       :wordcount      =&gt; 3, # SPH_RANK_WORDCOUNT       :proximity      =&gt; 4, # SPH_RANK_PROXIMITY       :match_any      =&gt; 5, # SPH_RANK_MATCHANY       :fieldmask      =&gt; 6, # SPH_RANK_FIELDMASK       :sph04          =&gt; 7, # SPH_RANK_SPH04       :total          =&gt; 8  # SPH_RANK_TOTAL     }</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">SortModes</td>
            <td>=</td>
            <td class="attr-value">{       :relevance     =&gt; 0, # SPH_SORT_RELEVANCE       :attr_desc     =&gt; 1, # SPH_SORT_ATTR_DESC       :attr_asc      =&gt; 2, # SPH_SORT_ATTR_ASC       :time_segments =&gt; 3, # SPH_SORT_TIME_SEGMENTS       :extended      =&gt; 4, # SPH_SORT_EXTENDED       :expr          =&gt; 5  # SPH_SORT_EXPR     }</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">AttributeTypes</td>
            <td>=</td>
            <td class="attr-value">{       :integer    =&gt; 1, # SPH_ATTR_INTEGER       :timestamp  =&gt; 2, # SPH_ATTR_TIMESTAMP       :ordinal    =&gt; 3, # SPH_ATTR_ORDINAL       :bool       =&gt; 4, # SPH_ATTR_BOOL       :float      =&gt; 5, # SPH_ATTR_FLOAT       :bigint     =&gt; 6, # SPH_ATTR_BIGINT       :string     =&gt; 7, # SPH_ATTR_STRING       :multi      =&gt; 0x40000000 # SPH_ATTR_MULTI     }</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">GroupFunctions</td>
            <td>=</td>
            <td class="attr-value">{       :day      =&gt; 0, # SPH_GROUPBY_DAY       :week     =&gt; 1, # SPH_GROUPBY_WEEK       :month    =&gt; 2, # SPH_GROUPBY_MONTH       :year     =&gt; 3, # SPH_GROUPBY_YEAR       :attr     =&gt; 4, # SPH_GROUPBY_ATTR       :attrpair =&gt; 5  # SPH_GROUPBY_ATTRPAIR     }</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">FilterTypes</td>
            <td>=</td>
            <td class="attr-value">{       :values       =&gt; 0, # SPH_FILTER_VALUES       :range        =&gt; 1, # SPH_FILTER_RANGE       :float_range  =&gt; 2  # SPH_FILTER_FLOATRANGE     }</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">AttributeHandlers</td>
            <td>=</td>
            <td class="attr-value">{       AttributeTypes[:integer]   =&gt; :next_int,       AttributeTypes[:timestamp] =&gt; :next_int,       AttributeTypes[:ordinal]   =&gt; :next_int,       AttributeTypes[:bool]      =&gt; :next_int,       AttributeTypes[:float]     =&gt; :next_float,       AttributeTypes[:bigint]    =&gt; :next_64bit_int,       AttributeTypes[:string]    =&gt; :next,       AttributeTypes[:multi] + AttributeTypes[:integer] =&gt; :next_int_array</td>
        </tr>
        
        
    </table>
    

    
    <div class="sectiontitle">Attributes</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>servers</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>port</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>offset</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>limit</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>max_matches</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>match_mode</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>sort_mode</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>sort_by</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>weights</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>id_range</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>filters</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>group_by</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>group_function</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>group_clause</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>group_distinct</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>cut_off</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>retry_count</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>retry_delay</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>anchor</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>index_weights</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>rank_mode</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>rank_expr</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>max_query_time</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>field_weights</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>timeout</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>overrides</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>select</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>connection</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>key</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>queue</td>
            <td class='attr-desc'></td>
        </tr>
        
    </table>
    

    
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M000085">
                    
                    <a name="M000085"></a><b>add_override</b>(attribute, type, values)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000085_source')" id="l_M000085_source">show</a>
                        
                    </p>
                    <div id="M000085_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/riddle/client.rb, line 475</span>
475:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_override</span>(<span class="ruby-identifier">attribute</span>, <span class="ruby-identifier">type</span>, <span class="ruby-identifier">values</span>)
476:       <span class="ruby-ivar">@overrides</span>[<span class="ruby-identifier">attribute</span>] = {<span class="ruby-identifier">:type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">type</span>, <span class="ruby-identifier">:values</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">values</span>}
477:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000051">
                    
                    <a name="M000051"></a><b>append_query</b>(search, index = '*', comments = '')
                    
                </div>
                
                <div class="description">
                  <p>
Append a query to the queue. This uses the same parameters as the query
method.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000051_source')" id="l_M000051_source">show</a>
                        
                    </p>
                    <div id="M000051_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/riddle/client.rb, line 219</span>
219:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">append_query</span>(<span class="ruby-identifier">search</span>, <span class="ruby-identifier">index</span> = <span class="ruby-value str">'*'</span>, <span class="ruby-identifier">comments</span> = <span class="ruby-value str">''</span>)
220:       <span class="ruby-ivar">@queue</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">query_message</span>(<span class="ruby-identifier">search</span>, <span class="ruby-identifier">index</span>, <span class="ruby-identifier">comments</span>)
221:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000087">
                    
                    <a name="M000087"></a><b>close</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000087_source')" id="l_M000087_source">show</a>
                        
                    </p>
                    <div id="M000087_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/riddle/client.rb, line 489</span>
489:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">close</span>
490:       <span class="ruby-identifier">close_socket</span>
491:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000078">
                    
                    <a name="M000078"></a><b>excerpts</b>(options = {})
                    
                </div>
                
                <div class="description">
                  <p>
Build excerpts from search terms (the <tt>words</tt>) and the text of
documents. Excerpts are bodies of text that have the <tt>words</tt>
highlighted. They may also be abbreviated to fit within a word limit.
</p>
<p>
As part of the options hash, you will need to define:
</p>
<ul>
<li>:docs

</li>
<li>:words

</li>
<li>:index

</li>
</ul>
<p>
Optional settings include:
</p>
<ul>
<li>:before_match (defaults to <span class=&#8220;match&#8221;>)

</li>
<li>:after_match (defaults to </span>)

</li>
<li>:chunk_separator (defaults to &#8217; &amp;8230; &#8217; - which is an HTML
ellipsis)

</li>
<li>:limit (defaults to 256)

</li>
<li>:around (defaults to 5)

</li>
<li>:exact_phrase (defaults to false)

</li>
<li>:single_passage (defaults to false)

</li>
</ul>
<p>
The defaults differ from the official PHP client, as I&#8217;ve opted for
semantic HTML markup.
</p>
<p>
Example:
</p>
<pre>
  client.excerpts(:docs =&gt; [&quot;Pat Allan, Pat Cash&quot;], :words =&gt; 'Pat', :index =&gt; 'pats')
  #=&gt; [&quot;&lt;span class=\&quot;match\&quot;&gt;Pat&lt;/span&gt; Allan, &lt;span class=\&quot;match\&quot;&gt;Pat&lt;/span&gt; Cash&quot;]

  lorem_lipsum = &quot;Lorem ipsum dolor...&quot;

  client.excerpts(:docs =&gt; [&quot;Pat Allan, #{lorem_lipsum} Pat Cash&quot;], :words =&gt; 'Pat', :index =&gt; 'pats')
  #=&gt; [&quot;&lt;span class=\&quot;match\&quot;&gt;Pat&lt;/span&gt; Allan, Lorem ipsum dolor sit amet, consectetur adipisicing
         elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua &amp;#8230; . Excepteur
         sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est
         laborum. &lt;span class=\&quot;match\&quot;&gt;Pat&lt;/span&gt; Cash&quot;]
</pre>
<p>
Workflow:
</p>
<p>
Excerpt creation is completely isolated from searching the index. The
nominated index is only used to discover encoding and charset information.
</p>
<p>
Therefore, the workflow goes:
</p>
<ol>
<li>Do the sphinx query.

</li>
<li>Fetch the documents found by sphinx from their repositories.

</li>
<li>Pass the documents&#8217; text to <tt>excerpts</tt> for marking up of
matched terms.

</li>
</ol>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000078_source')" id="l_M000078_source">show</a>
                        
                    </p>
                    <div id="M000078_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/riddle/client.rb, line 386</span>
386:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">excerpts</span>(<span class="ruby-identifier">options</span> = {})
387:       <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:index</span>]                <span class="ruby-operator">||=</span> <span class="ruby-value str">'*'</span>
388:       <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:before_match</span>]         <span class="ruby-operator">||=</span> <span class="ruby-value str">'&lt;span class=&quot;match&quot;&gt;'</span>
389:       <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:after_match</span>]          <span class="ruby-operator">||=</span> <span class="ruby-value str">'&lt;/span&gt;'</span>
390:       <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:chunk_separator</span>]      <span class="ruby-operator">||=</span> <span class="ruby-value str">' &amp;#8230; '</span> <span class="ruby-comment cmt"># ellipsis</span>
391:       <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:limit</span>]                <span class="ruby-operator">||=</span> <span class="ruby-value">256</span>
392:       <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:limit_passages</span>]       <span class="ruby-operator">||=</span> <span class="ruby-value">0</span>
393:       <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:limit_words</span>]          <span class="ruby-operator">||=</span> <span class="ruby-value">0</span>
394:       <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:around</span>]               <span class="ruby-operator">||=</span> <span class="ruby-value">5</span>
395:       <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:exact_phrase</span>]         <span class="ruby-operator">||=</span> <span class="ruby-keyword kw">false</span>
396:       <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:single_passage</span>]       <span class="ruby-operator">||=</span> <span class="ruby-keyword kw">false</span>
397:       <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:query_mode</span>]           <span class="ruby-operator">||=</span> <span class="ruby-keyword kw">false</span>
398:       <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:force_all_words</span>]      <span class="ruby-operator">||=</span> <span class="ruby-keyword kw">false</span>
399:       <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:start_passage_id</span>]     <span class="ruby-operator">||=</span> <span class="ruby-value">1</span>
400:       <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:load_files</span>]           <span class="ruby-operator">||=</span> <span class="ruby-keyword kw">false</span>
401:       <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:html_strip_mode</span>]      <span class="ruby-operator">||=</span> <span class="ruby-value str">'index'</span>
402:       <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:allow_empty</span>]          <span class="ruby-operator">||=</span> <span class="ruby-keyword kw">false</span>
403:       <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:passage_boundary</span>]     <span class="ruby-operator">||=</span> <span class="ruby-value str">'none'</span>
404:       <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:emit_zones</span>]           <span class="ruby-operator">||=</span> <span class="ruby-keyword kw">false</span>
405:       <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:load_files_scattered</span>] <span class="ruby-operator">||=</span> <span class="ruby-keyword kw">false</span>
406: 
407:       <span class="ruby-identifier">response</span> = <span class="ruby-constant">Response</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">request</span>(<span class="ruby-identifier">:excerpt</span>, <span class="ruby-identifier">excerpts_message</span>(<span class="ruby-identifier">options</span>))
408: 
409:       <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:docs</span>].<span class="ruby-identifier">collect</span> { <span class="ruby-identifier">response</span>.<span class="ruby-identifier">next</span> }
410:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000084">
                    
                    <a name="M000084"></a><b>flush_attributes</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000084_source')" id="l_M000084_source">show</a>
                        
                    </p>
                    <div id="M000084_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/riddle/client.rb, line 467</span>
467:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">flush_attributes</span>
468:       <span class="ruby-identifier">response</span> = <span class="ruby-constant">Response</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">request</span>(
469:         <span class="ruby-identifier">:flushattrs</span>, <span class="ruby-constant">Message</span>.<span class="ruby-identifier">new</span>
470:       )
471: 
472:       <span class="ruby-identifier">response</span>.<span class="ruby-identifier">next_int</span>
473:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000080">
                    
                    <a name="M000080"></a><b>keywords</b>(query, index, return_hits = false)
                    
                </div>
                
                <div class="description">
                  <p>
Generates a keyword list for a given query. Each keyword is represented by
a hash, with keys :tokenised and :normalised. If return_hits is set to true
it will also report on the number of hits and documents for each keyword
(see :hits and :docs keys respectively).
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000080_source')" id="l_M000080_source">show</a>
                        
                    </p>
                    <div id="M000080_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/riddle/client.rb, line 434</span>
434:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">keywords</span>(<span class="ruby-identifier">query</span>, <span class="ruby-identifier">index</span>, <span class="ruby-identifier">return_hits</span> = <span class="ruby-keyword kw">false</span>)
435:       <span class="ruby-identifier">response</span> = <span class="ruby-constant">Response</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">request</span>(
436:         <span class="ruby-identifier">:keywords</span>,
437:         <span class="ruby-identifier">keywords_message</span>(<span class="ruby-identifier">query</span>, <span class="ruby-identifier">index</span>, <span class="ruby-identifier">return_hits</span>)
438:       )
439: 
440:       (<span class="ruby-value">0</span><span class="ruby-operator">...</span><span class="ruby-identifier">response</span>.<span class="ruby-identifier">next_int</span>).<span class="ruby-identifier">collect</span> <span class="ruby-keyword kw">do</span>
441:         <span class="ruby-identifier">hash</span> = {}
442:         <span class="ruby-identifier">hash</span>[<span class="ruby-identifier">:tokenised</span>]  = <span class="ruby-identifier">response</span>.<span class="ruby-identifier">next</span>
443:         <span class="ruby-identifier">hash</span>[<span class="ruby-identifier">:normalised</span>] = <span class="ruby-identifier">response</span>.<span class="ruby-identifier">next</span>
444: 
445:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">return_hits</span>
446:           <span class="ruby-identifier">hash</span>[<span class="ruby-identifier">:docs</span>] = <span class="ruby-identifier">response</span>.<span class="ruby-identifier">next_int</span>
447:           <span class="ruby-identifier">hash</span>[<span class="ruby-identifier">:hits</span>] = <span class="ruby-identifier">response</span>.<span class="ruby-identifier">next_int</span>
448:         <span class="ruby-keyword kw">end</span>
449: 
450:         <span class="ruby-identifier">hash</span>
451:       <span class="ruby-keyword kw">end</span>
452:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000086">
                    
                    <a name="M000086"></a><b>open</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000086_source')" id="l_M000086_source">show</a>
                        
                    </p>
                    <div id="M000086_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/riddle/client.rb, line 479</span>
479:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">open</span>
480:       <span class="ruby-identifier">open_socket</span>
481: 
482:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Versions</span>[<span class="ruby-identifier">:search</span>] <span class="ruby-operator">&lt;</span> <span class="ruby-value">0x116</span>
483: 
484:       <span class="ruby-ivar">@socket</span>.<span class="ruby-identifier">send</span> [
485:         <span class="ruby-constant">Commands</span>[<span class="ruby-identifier">:persist</span>], <span class="ruby-value">0</span>, <span class="ruby-value">4</span>, <span class="ruby-value">1</span>
486:       ].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">&quot;nnNN&quot;</span>), <span class="ruby-value">0</span>
487:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000076">
                    
                    <a name="M000076"></a><b>query</b>(search, index = '*', comments = '')
                    
                </div>
                
                <div class="description">
                  <p>
<a href="Query.html">Query</a> the Sphinx daemon - defaulting to all
indices, but you can specify a specific one if you wish. The search
parameter should be a string following Sphinx&#8217;s expectations.
</p>
<p>
The object returned from this method is a hash with the following keys:
</p>
<ul>
<li>:matches

</li>
<li>:fields

</li>
<li>:attributes

</li>
<li>:attribute_names

</li>
<li>:words

</li>
<li>:total

</li>
<li>:total_found

</li>
<li>:time

</li>
<li>:status

</li>
<li>:warning (if appropriate)

</li>
<li>:error (if appropriate)

</li>
</ul>
<p>
The key <tt>:matches</tt> returns an array of hashes - the actual search
results. Each hash has the document id (<tt>:doc</tt>), the result
weighting (<tt>:weight</tt>), and a hash of the attributes for the document
(<tt>:attributes</tt>).
</p>
<p>
The <tt>:fields</tt> and <tt>:attribute_names</tt> keys return list of
fields and attributes for the documents. The key <tt>:attributes</tt> will
return a hash of attribute name and type pairs, and <tt>:words</tt> returns
a hash of hashes representing the words from the search, with the number of
documents and hits for each, along the lines of:
</p>
<pre>
  results[:words][&quot;Pat&quot;] #=&gt; {:docs =&gt; 12, :hits =&gt; 15}
</pre>
<p>
<tt>:total</tt>, <tt>:total_found</tt> and <tt>:time</tt> return the number
of matches available, the total number of matches (which may be greater
than the maximum available, depending on the number of matches and your
sphinx configuration), and the time in milliseconds that the query took to
run.
</p>
<p>
<tt>:status</tt> is the error code for the query - and if there was a
related warning, it will be under the <tt>:warning</tt> key. Fatal errors
will be described under <tt>:error</tt>.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000076_source')" id="l_M000076_source">show</a>
                        
                    </p>
                    <div id="M000076_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/riddle/client.rb, line 336</span>
336:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">query</span>(<span class="ruby-identifier">search</span>, <span class="ruby-identifier">index</span> = <span class="ruby-value str">'*'</span>, <span class="ruby-identifier">comments</span> = <span class="ruby-value str">''</span>)
337:       <span class="ruby-ivar">@queue</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">query_message</span>(<span class="ruby-identifier">search</span>, <span class="ruby-identifier">index</span>, <span class="ruby-identifier">comments</span>)
338:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">run</span>.<span class="ruby-identifier">first</span>
339:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000046">
                    
                    <a name="M000046"></a><b>reset</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Reset attributes and settings to defaults.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000046_source')" id="l_M000046_source">show</a>
                        
                    </p>
                    <div id="M000046_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/riddle/client.rb, line 155</span>
155:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">reset</span>
156:       <span class="ruby-comment cmt"># defaults</span>
157:       <span class="ruby-ivar">@offset</span>         = <span class="ruby-value">0</span>
158:       <span class="ruby-ivar">@limit</span>          = <span class="ruby-value">20</span>
159:       <span class="ruby-ivar">@max_matches</span>    = <span class="ruby-value">1000</span>
160:       <span class="ruby-ivar">@match_mode</span>     = <span class="ruby-identifier">:all</span>
161:       <span class="ruby-ivar">@sort_mode</span>      = <span class="ruby-identifier">:relevance</span>
162:       <span class="ruby-ivar">@sort_by</span>        = <span class="ruby-value str">''</span>
163:       <span class="ruby-ivar">@weights</span>        = []
164:       <span class="ruby-ivar">@id_range</span>       = <span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">0</span>
165:       <span class="ruby-ivar">@filters</span>        = []
166:       <span class="ruby-ivar">@group_by</span>       = <span class="ruby-value str">''</span>
167:       <span class="ruby-ivar">@group_function</span> = <span class="ruby-identifier">:day</span>
168:       <span class="ruby-ivar">@group_clause</span>   = <span class="ruby-value str">'@group desc'</span>
169:       <span class="ruby-ivar">@group_distinct</span> = <span class="ruby-value str">''</span>
170:       <span class="ruby-ivar">@cut_off</span>        = <span class="ruby-value">0</span>
171:       <span class="ruby-ivar">@retry_count</span>    = <span class="ruby-value">0</span>
172:       <span class="ruby-ivar">@retry_delay</span>    = <span class="ruby-value">0</span>
173:       <span class="ruby-ivar">@anchor</span>         = {}
174:       <span class="ruby-comment cmt"># string keys are index names, integer values are weightings</span>
175:       <span class="ruby-ivar">@index_weights</span>  = {}
176:       <span class="ruby-ivar">@rank_mode</span>      = <span class="ruby-identifier">:proximity_bm25</span>
177:       <span class="ruby-ivar">@rank_expr</span>      = <span class="ruby-value str">''</span>
178:       <span class="ruby-ivar">@max_query_time</span> = <span class="ruby-value">0</span>
179:       <span class="ruby-comment cmt"># string keys are field names, integer values are weightings</span>
180:       <span class="ruby-ivar">@field_weights</span>  = {}
181:       <span class="ruby-ivar">@timeout</span>        = <span class="ruby-value">0</span>
182:       <span class="ruby-ivar">@overrides</span>      = {}
183:       <span class="ruby-ivar">@select</span>         = <span class="ruby-value str">&quot;*&quot;</span>
184:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000052">
                    
                    <a name="M000052"></a><b>run</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Run all the queries currently in the queue. This will return an array of
results hashes.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000052_source')" id="l_M000052_source">show</a>
                        
                    </p>
                    <div id="M000052_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/riddle/client.rb, line 225</span>
225:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">run</span>
226:       <span class="ruby-identifier">response</span> = <span class="ruby-constant">Response</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">request</span>(<span class="ruby-identifier">:search</span>, <span class="ruby-ivar">@queue</span>)
227: 
228:       <span class="ruby-identifier">results</span> = <span class="ruby-ivar">@queue</span>.<span class="ruby-identifier">collect</span> <span class="ruby-keyword kw">do</span>
229:         <span class="ruby-identifier">result</span> = {
230:           <span class="ruby-identifier">:matches</span>         =<span class="ruby-operator">&gt;</span> [],
231:           <span class="ruby-identifier">:fields</span>          =<span class="ruby-operator">&gt;</span> [],
232:           <span class="ruby-identifier">:attributes</span>      =<span class="ruby-operator">&gt;</span> {},
233:           <span class="ruby-identifier">:attribute_names</span> =<span class="ruby-operator">&gt;</span> [],
234:           <span class="ruby-identifier">:words</span>           =<span class="ruby-operator">&gt;</span> {}
235:         }
236: 
237:         <span class="ruby-identifier">result</span>[<span class="ruby-identifier">:status</span>] = <span class="ruby-identifier">response</span>.<span class="ruby-identifier">next_int</span>
238:         <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">result</span>[<span class="ruby-identifier">:status</span>]
239:         <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Statuses</span>[<span class="ruby-identifier">:warning</span>]
240:           <span class="ruby-identifier">result</span>[<span class="ruby-identifier">:warning</span>] = <span class="ruby-identifier">response</span>.<span class="ruby-identifier">next</span>
241:         <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Statuses</span>[<span class="ruby-identifier">:error</span>]
242:           <span class="ruby-identifier">result</span>[<span class="ruby-identifier">:error</span>] = <span class="ruby-identifier">response</span>.<span class="ruby-identifier">next</span>
243:           <span class="ruby-keyword kw">next</span> <span class="ruby-identifier">result</span>
244:         <span class="ruby-keyword kw">end</span>
245: 
246:         <span class="ruby-identifier">result</span>[<span class="ruby-identifier">:fields</span>] = <span class="ruby-identifier">response</span>.<span class="ruby-identifier">next_array</span>
247: 
248:         <span class="ruby-identifier">attributes</span> = <span class="ruby-identifier">response</span>.<span class="ruby-identifier">next_int</span>
249:         <span class="ruby-identifier">attributes</span>.<span class="ruby-identifier">times</span> <span class="ruby-keyword kw">do</span>
250:           <span class="ruby-identifier">attribute_name</span> = <span class="ruby-identifier">response</span>.<span class="ruby-identifier">next</span>
251:           <span class="ruby-identifier">type</span>           = <span class="ruby-identifier">response</span>.<span class="ruby-identifier">next_int</span>
252: 
253:           <span class="ruby-identifier">result</span>[<span class="ruby-identifier">:attributes</span>][<span class="ruby-identifier">attribute_name</span>] = <span class="ruby-identifier">type</span>
254:           <span class="ruby-identifier">result</span>[<span class="ruby-identifier">:attribute_names</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">attribute_name</span>
255:         <span class="ruby-keyword kw">end</span>
256: 
257:         <span class="ruby-identifier">result_attribute_names_and_types</span> = <span class="ruby-identifier">result</span>[<span class="ruby-identifier">:attribute_names</span>].
258:           <span class="ruby-identifier">inject</span>([]) { <span class="ruby-operator">|</span><span class="ruby-identifier">array</span>, <span class="ruby-identifier">attr</span><span class="ruby-operator">|</span> <span class="ruby-identifier">array</span>.<span class="ruby-identifier">push</span>([ <span class="ruby-identifier">attr</span>, <span class="ruby-identifier">result</span>[<span class="ruby-identifier">:attributes</span>][<span class="ruby-identifier">attr</span>] ]) }
259: 
260:         <span class="ruby-identifier">matches</span>   = <span class="ruby-identifier">response</span>.<span class="ruby-identifier">next_int</span>
261:         <span class="ruby-identifier">is_64_bit</span> = <span class="ruby-identifier">response</span>.<span class="ruby-identifier">next_int</span>
262: 
263:         <span class="ruby-identifier">result</span>[<span class="ruby-identifier">:matches</span>] = (<span class="ruby-value">0</span><span class="ruby-operator">...</span><span class="ruby-identifier">matches</span>).<span class="ruby-identifier">map</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
264:           <span class="ruby-identifier">doc</span> = <span class="ruby-identifier">is_64_bit</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">response</span>.<span class="ruby-identifier">next_64bit_int</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">response</span>.<span class="ruby-identifier">next_int</span>
265:           <span class="ruby-identifier">weight</span> = <span class="ruby-identifier">response</span>.<span class="ruby-identifier">next_int</span>
266: 
267:           <span class="ruby-identifier">current_match_attributes</span> = {}
268: 
269:           <span class="ruby-identifier">result_attribute_names_and_types</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">attr</span>, <span class="ruby-identifier">type</span><span class="ruby-operator">|</span>
270:             <span class="ruby-identifier">current_match_attributes</span>[<span class="ruby-identifier">attr</span>] = <span class="ruby-identifier">attribute_from_type</span>(<span class="ruby-identifier">type</span>, <span class="ruby-identifier">response</span>)
271:           <span class="ruby-keyword kw">end</span>
272: 
273:           {<span class="ruby-identifier">:doc</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">doc</span>, <span class="ruby-identifier">:weight</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">weight</span>, <span class="ruby-identifier">:index</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">i</span>, <span class="ruby-identifier">:attributes</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">current_match_attributes</span>}
274:         <span class="ruby-keyword kw">end</span>
275: 
276:         <span class="ruby-identifier">result</span>[<span class="ruby-identifier">:total</span>] = <span class="ruby-identifier">response</span>.<span class="ruby-identifier">next_int</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">||</span> <span class="ruby-value">0</span>
277:         <span class="ruby-identifier">result</span>[<span class="ruby-identifier">:total_found</span>] = <span class="ruby-identifier">response</span>.<span class="ruby-identifier">next_int</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">||</span> <span class="ruby-value">0</span>
278:         <span class="ruby-identifier">result</span>[<span class="ruby-identifier">:time</span>] = (<span class="ruby-value str">'%.3f'</span> <span class="ruby-operator">%</span> (<span class="ruby-identifier">response</span>.<span class="ruby-identifier">next_int</span> <span class="ruby-operator">/</span> <span class="ruby-value">1000.0</span>)).<span class="ruby-identifier">to_f</span> <span class="ruby-operator">||</span> <span class="ruby-value">0</span><span class="ruby-value">.0</span>
279: 
280:         <span class="ruby-identifier">words</span> = <span class="ruby-identifier">response</span>.<span class="ruby-identifier">next_int</span>
281:         <span class="ruby-identifier">words</span>.<span class="ruby-identifier">times</span> <span class="ruby-keyword kw">do</span>
282:           <span class="ruby-identifier">word</span> = <span class="ruby-identifier">response</span>.<span class="ruby-identifier">next</span>
283:           <span class="ruby-identifier">docs</span> = <span class="ruby-identifier">response</span>.<span class="ruby-identifier">next_int</span>
284:           <span class="ruby-identifier">hits</span> = <span class="ruby-identifier">response</span>.<span class="ruby-identifier">next_int</span>
285:           <span class="ruby-identifier">result</span>[<span class="ruby-identifier">:words</span>][<span class="ruby-identifier">word</span>] = {<span class="ruby-identifier">:docs</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">docs</span>, <span class="ruby-identifier">:hits</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">hits</span>}
286:         <span class="ruby-keyword kw">end</span>
287: 
288:         <span class="ruby-identifier">result</span>
289:       <span class="ruby-keyword kw">end</span>
290: 
291:       <span class="ruby-ivar">@queue</span>.<span class="ruby-identifier">clear</span>
292:       <span class="ruby-identifier">results</span>
293:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000048">
                    
                    <a name="M000048"></a><b>server</b>()
                    
                </div>
                
                <div class="description">
                  <p>
The searchd server to query. Servers are removed from @server after a
Timeout::Error is hit to allow for fail-over.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000048_source')" id="l_M000048_source">show</a>
                        
                    </p>
                    <div id="M000048_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/riddle/client.rb, line 188</span>
188:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">server</span>
189:       <span class="ruby-ivar">@servers</span>.<span class="ruby-identifier">first</span>
190:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000049">
                    
                    <a name="M000049"></a><b>server=</b>(server)
                    
                </div>
                
                <div class="description">
                  <p>
Backwards compatible writer to the @servers array.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000049_source')" id="l_M000049_source">show</a>
                        
                    </p>
                    <div id="M000049_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/riddle/client.rb, line 193</span>
193:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">server=</span>(<span class="ruby-identifier">server</span>)
194:       <span class="ruby-ivar">@servers</span> = <span class="ruby-identifier">server</span>.<span class="ruby-identifier">to_a</span>
195:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000050">
                    
                    <a name="M000050"></a><b>set_anchor</b>(lat_attr, lat, long_attr, long)
                    
                </div>
                
                <div class="description">
                  <p>
Set the geo-anchor point - with the names of the attributes that contain
the latitude and longitude (in radians), and the reference position. Note
that for geocoding to work properly, you must also set <a
href="Client.html#match_mode">match_mode</a> to :extended. To sort results
by distance, you will need to set <a href="Client.html#sort_by">sort_by</a>
to &#8217;@geodist asc&#8217;, and <a
href="Client.html#sort_mode">sort_mode</a> to extended (as an example).
Sphinx expects latitude and longitude to be returned from you SQL source in
radians.
</p>
<p>
Example:
</p>
<pre>
  client.set_anchor('lat', -0.6591741, 'long', 2.530770)
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000050_source')" id="l_M000050_source">show</a>
                        
                    </p>
                    <div id="M000050_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/riddle/client.rb, line 208</span>
208:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set_anchor</span>(<span class="ruby-identifier">lat_attr</span>, <span class="ruby-identifier">lat</span>, <span class="ruby-identifier">long_attr</span>, <span class="ruby-identifier">long</span>)
209:       <span class="ruby-ivar">@anchor</span> = {
210:         <span class="ruby-identifier">:latitude_attribute</span>   =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">lat_attr</span>,
211:         <span class="ruby-identifier">:latitude</span>             =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">lat</span>,
212:         <span class="ruby-identifier">:longitude_attribute</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">long_attr</span>,
213:         <span class="ruby-identifier">:longitude</span>            =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">long</span>
214:       }
215:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000083">
                    
                    <a name="M000083"></a><b>status</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000083_source')" id="l_M000083_source">show</a>
                        
                    </p>
                    <div id="M000083_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/riddle/client.rb, line 454</span>
454:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">status</span>
455:       <span class="ruby-identifier">response</span> = <span class="ruby-constant">Response</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">request</span>(
456:         <span class="ruby-identifier">:status</span>, <span class="ruby-constant">Message</span>.<span class="ruby-identifier">new</span>
457:       )
458: 
459:       <span class="ruby-identifier">rows</span>, <span class="ruby-identifier">cols</span> = <span class="ruby-identifier">response</span>.<span class="ruby-identifier">next_int</span>, <span class="ruby-identifier">response</span>.<span class="ruby-identifier">next_int</span>
460: 
461:       (<span class="ruby-value">0</span><span class="ruby-operator">...</span><span class="ruby-identifier">rows</span>).<span class="ruby-identifier">inject</span>({}) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">hash</span>, <span class="ruby-identifier">row</span><span class="ruby-operator">|</span>
462:         <span class="ruby-identifier">hash</span>[<span class="ruby-identifier">response</span>.<span class="ruby-identifier">next</span>.<span class="ruby-identifier">to_sym</span>] = <span class="ruby-identifier">response</span>.<span class="ruby-identifier">next</span>
463:         <span class="ruby-identifier">hash</span>
464:       <span class="ruby-keyword kw">end</span>
465:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000079">
                    
                    <a name="M000079"></a><b>update</b>(index, attributes, values_by_doc)
                    
                </div>
                
                <div class="description">
                  <p>
Update attributes - first parameter is the relevant index, second is an
array of attributes to be updated, and the third is a hash, where the keys
are the document ids, and the values are arrays with the attribute values -
in the same order as the second parameter.
</p>
<p>
Example:
</p>
<pre>
  client.update('people', ['birthday'], {1 =&gt; [Time.at(1982, 20, 8).to_i]})
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000079_source')" id="l_M000079_source">show</a>
                        
                    </p>
                    <div id="M000079_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/riddle/client.rb, line 421</span>
421:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update</span>(<span class="ruby-identifier">index</span>, <span class="ruby-identifier">attributes</span>, <span class="ruby-identifier">values_by_doc</span>)
422:       <span class="ruby-identifier">response</span> = <span class="ruby-constant">Response</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">request</span>(
423:         <span class="ruby-identifier">:update</span>,
424:         <span class="ruby-identifier">update_message</span>(<span class="ruby-identifier">index</span>, <span class="ruby-identifier">attributes</span>, <span class="ruby-identifier">values_by_doc</span>)
425:       )
426: 
427:       <span class="ruby-identifier">response</span>.<span class="ruby-identifier">next_int</span>
428:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Private methods</div>
            
            <div class="method">
                <div class="title" id="M000110">
                    
                    <a name="M000110"></a><b>attribute_from_type</b>(type, response)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000110_source')" id="l_M000110_source">show</a>
                        
                    </p>
                    <div id="M000110_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/riddle/client.rb, line 832</span>
832:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">attribute_from_type</span>(<span class="ruby-identifier">type</span>, <span class="ruby-identifier">response</span>)
833:       <span class="ruby-identifier">handler</span> = <span class="ruby-constant">AttributeHandlers</span>[<span class="ruby-identifier">type</span>]
834:       <span class="ruby-identifier">response</span>.<span class="ruby-identifier">send</span> <span class="ruby-identifier">handler</span>
835:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000089">
                    
                    <a name="M000089"></a><b>close_socket</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000089_source')" id="l_M000089_source">show</a>
                        
                    </p>
                    <div id="M000089_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/riddle/client.rb, line 521</span>
521:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">close_socket</span>
522:       <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;Not Connected&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@socket</span>.<span class="ruby-identifier">nil?</span>
523: 
524:       <span class="ruby-ivar">@socket</span>.<span class="ruby-identifier">close</span>
525:       <span class="ruby-ivar">@socket</span> = <span class="ruby-keyword kw">nil</span>
526: 
527:       <span class="ruby-keyword kw">true</span>
528:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000090">
                    
                    <a name="M000090"></a><b>connect</b>(&amp;block)
                    
                </div>
                
                <div class="description">
                  <p>
If there&#8217;s an active connection to the Sphinx daemon, this will yield
the socket. If there&#8217;s no active connection, then it will connect,
yield the new socket, then close it.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000090_source')" id="l_M000090_source">show</a>
                        
                    </p>
                    <div id="M000090_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/riddle/client.rb, line 533</span>
533:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">connect</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
534:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@socket</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-ivar">@socket</span>.<span class="ruby-identifier">closed?</span>
535:         <span class="ruby-ivar">@socket</span> = <span class="ruby-keyword kw">nil</span>
536:         <span class="ruby-identifier">open_socket</span>
537:         <span class="ruby-keyword kw">begin</span>
538:           <span class="ruby-keyword kw">yield</span> <span class="ruby-ivar">@socket</span>
539:         <span class="ruby-keyword kw">ensure</span>
540:           <span class="ruby-identifier">close_socket</span>
541:         <span class="ruby-keyword kw">end</span>
542:       <span class="ruby-keyword kw">else</span>
543:         <span class="ruby-keyword kw">yield</span> <span class="ruby-ivar">@socket</span>
544:       <span class="ruby-keyword kw">end</span>
545:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000111">
                    
                    <a name="M000111"></a><b>excerpt_flags</b>(options)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000111_source')" id="l_M000111_source">show</a>
                        
                    </p>
                    <div id="M000111_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/riddle/client.rb, line 837</span>
837:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">excerpt_flags</span>(<span class="ruby-identifier">options</span>)
838:       <span class="ruby-identifier">flags</span> = <span class="ruby-value">1</span>
839:       <span class="ruby-identifier">flags</span> <span class="ruby-operator">|=</span> <span class="ruby-value">2</span>    <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:exact_phrase</span>]
840:       <span class="ruby-identifier">flags</span> <span class="ruby-operator">|=</span> <span class="ruby-value">4</span>    <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:single_passage</span>]
841:       <span class="ruby-identifier">flags</span> <span class="ruby-operator">|=</span> <span class="ruby-value">8</span>    <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:use_boundaries</span>]
842:       <span class="ruby-identifier">flags</span> <span class="ruby-operator">|=</span> <span class="ruby-value">16</span>   <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:weight_order</span>]
843:       <span class="ruby-identifier">flags</span> <span class="ruby-operator">|=</span> <span class="ruby-value">32</span>   <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:query_mode</span>]
844:       <span class="ruby-identifier">flags</span> <span class="ruby-operator">|=</span> <span class="ruby-value">64</span>   <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:force_all_words</span>]
845:       <span class="ruby-identifier">flags</span> <span class="ruby-operator">|=</span> <span class="ruby-value">128</span>  <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:load_files</span>]
846:       <span class="ruby-identifier">flags</span> <span class="ruby-operator">|=</span> <span class="ruby-value">256</span>  <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:allow_empty</span>]
847:       <span class="ruby-identifier">flags</span> <span class="ruby-operator">|=</span> <span class="ruby-value">512</span>  <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:emit_zones</span>]
848:       <span class="ruby-identifier">flags</span> <span class="ruby-operator">|=</span> <span class="ruby-value">1024</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:load_files_scattered</span>]
849:       <span class="ruby-identifier">flags</span>
850:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000007">
                    
                    <a name="M000007"></a><b>excerpts_message</b>(options)
                    
                </div>
                
                <div class="description">
                  <p>
Generation of the message to send to Sphinx for an excerpts request.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000007_source')" id="l_M000007_source">show</a>
                        
                    </p>
                    <div id="M000007_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/riddle/1.10/client.rb, line 8</span>
 8:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">excerpts_message</span>(<span class="ruby-identifier">options</span>)
 9:     <span class="ruby-identifier">message</span> = <span class="ruby-constant">Message</span>.<span class="ruby-identifier">new</span>
10:     
11:     <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append</span> [<span class="ruby-value">0</span>, <span class="ruby-identifier">excerpt_flags</span>(<span class="ruby-identifier">options</span>)].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'N2'</span>) <span class="ruby-comment cmt"># 0 = mode</span>
12:     <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_string</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:index</span>]
13:     <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_string</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:words</span>]
14:     
15:     <span class="ruby-comment cmt"># options</span>
16:     <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_string</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:before_match</span>]
17:     <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_string</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:after_match</span>]
18:     <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_string</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:chunk_separator</span>]
19:     <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_ints</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:limit</span>], <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:around</span>]
20:     <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_ints</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:limit_passages</span>], <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:limit_words</span>]
21:     <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_ints</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:start_passage_id</span>]
22:     <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_string</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:html_strip_mode</span>]
23:     
24:     <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Versions</span>[<span class="ruby-identifier">:excerpt</span>] <span class="ruby-operator">&gt;=</span> <span class="ruby-value">0x103</span>
25:       <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_string</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:passage_boundary</span>]
26:     <span class="ruby-keyword kw">end</span>
27:     
28:     <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_array</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:docs</span>]
29:     
30:     <span class="ruby-identifier">message</span>.<span class="ruby-identifier">to_s</span>
31:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000107">
                    
                    <a name="M000107"></a><b>excerpts_message</b>(options)
                    
                </div>
                
                <div class="description">
                  <p>
Generation of the message to send to Sphinx for an excerpts request.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000107_source')" id="l_M000107_source">show</a>
                        
                    </p>
                    <div id="M000107_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/riddle/client.rb, line 775</span>
775:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">excerpts_message</span>(<span class="ruby-identifier">options</span>)
776:       <span class="ruby-identifier">message</span> = <span class="ruby-constant">Message</span>.<span class="ruby-identifier">new</span>
777: 
778:       <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append</span> [<span class="ruby-value">0</span>, <span class="ruby-identifier">excerpt_flags</span>(<span class="ruby-identifier">options</span>)].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'N2'</span>) <span class="ruby-comment cmt"># 0 = mode</span>
779:       <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_string</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:index</span>]
780:       <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_string</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:words</span>]
781: 
782:       <span class="ruby-comment cmt"># options</span>
783:       <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_string</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:before_match</span>]
784:       <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_string</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:after_match</span>]
785:       <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_string</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:chunk_separator</span>]
786:       <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_ints</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:limit</span>], <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:around</span>]
787: 
788:       <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_array</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:docs</span>]
789: 
790:       <span class="ruby-identifier">message</span>.<span class="ruby-identifier">to_s</span>
791:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000002">
                    
                    <a name="M000002"></a><b>initialise_connection</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000002_source')" id="l_M000002_source">show</a>
                        
                    </p>
                    <div id="M000002_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/riddle/0.9.9/client.rb, line 7</span>
 7:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialise_connection</span>
 8:     <span class="ruby-identifier">socket</span> = <span class="ruby-identifier">initialise_socket</span>
 9: 
10:     <span class="ruby-comment cmt"># Send version</span>
11:     <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">send</span> [<span class="ruby-value">1</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'N'</span>), <span class="ruby-value">0</span>
12:     
13:     <span class="ruby-comment cmt"># Checking version</span>
14:     <span class="ruby-identifier">version</span> = <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">recv</span>(<span class="ruby-value">4</span>).<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">'N*'</span>).<span class="ruby-identifier">first</span>
15:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">version</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">1</span>
16:       <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">close</span>
17:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">VersionError</span>, <span class="ruby-node">&quot;Can only connect to searchd version 1.0 or better, not version #{version}&quot;</span>
18:     <span class="ruby-keyword kw">end</span>
19:     
20:     <span class="ruby-identifier">socket</span>
21:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000091">
                    
                    <a name="M000091"></a><b>initialise_connection</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000091_source')" id="l_M000091_source">show</a>
                        
                    </p>
                    <div id="M000091_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/riddle/client.rb, line 547</span>
547:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialise_connection</span>
548:       <span class="ruby-identifier">socket</span> = <span class="ruby-identifier">initialise_socket</span>
549: 
550:       <span class="ruby-comment cmt"># Checking version</span>
551:       <span class="ruby-identifier">version</span> = <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">recv</span>(<span class="ruby-value">4</span>).<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">'N*'</span>).<span class="ruby-identifier">first</span>
552:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">version</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">1</span>
553:         <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">close</span>
554:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">VersionError</span>, <span class="ruby-node">&quot;Can only connect to searchd version 1.0 or better, not version #{version}&quot;</span>
555:       <span class="ruby-keyword kw">end</span>
556: 
557:       <span class="ruby-comment cmt"># Send version</span>
558:       <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">send</span> [<span class="ruby-value">1</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'N'</span>), <span class="ruby-value">0</span>
559: 
560:       <span class="ruby-identifier">socket</span>
561:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000092">
                    
                    <a name="M000092"></a><b>initialise_socket</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000092_source')" id="l_M000092_source">show</a>
                        
                    </p>
                    <div id="M000092_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/riddle/client.rb, line 563</span>
563:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialise_socket</span>
564:       <span class="ruby-identifier">tries</span> = <span class="ruby-value">0</span>
565:       <span class="ruby-keyword kw">begin</span>
566:         <span class="ruby-identifier">socket</span> = <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">connection</span>
567:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">call</span>(<span class="ruby-keyword kw">self</span>)
568:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">connection</span>
569:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">call</span>(<span class="ruby-keyword kw">self</span>)
570:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">server</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">server</span>.<span class="ruby-identifier">index</span>(<span class="ruby-value str">'/'</span>) <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
571:           <span class="ruby-constant">UNIXSocket</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">server</span>
572:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">server</span>
573:           <span class="ruby-constant">TCPSocket</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">server</span>, <span class="ruby-ivar">@port</span>
574:         <span class="ruby-keyword kw">else</span>
575:           <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;Server not set.&quot;</span>
576:         <span class="ruby-keyword kw">end</span>
577:       <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">ETIMEDOUT</span>, <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">ECONNRESET</span>, <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">ECONNREFUSED</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
578:         <span class="ruby-keyword kw">retry</span> <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">tries</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>) <span class="ruby-operator">&lt;</span> <span class="ruby-value">5</span>
579:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">Riddle</span><span class="ruby-operator">::</span><span class="ruby-constant">ConnectionError</span>,
580:           <span class="ruby-node">&quot;Connection to #{server} on #{@port} failed. #{e.message}&quot;</span>
581:       <span class="ruby-keyword kw">end</span>
582: 
583:       <span class="ruby-identifier">socket</span>
584:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000099">
                    
                    <a name="M000099"></a><b>key_message</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000099_source')" id="l_M000099_source">show</a>
                        
                    </p>
                    <div id="M000099_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/riddle/client.rb, line 606</span>
606:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">key_message</span>
607:       <span class="ruby-ivar">@key_message</span> <span class="ruby-operator">||=</span> <span class="ruby-keyword kw">begin</span>
608:         <span class="ruby-identifier">message</span> = <span class="ruby-constant">Message</span>.<span class="ruby-identifier">new</span>
609:         <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_string</span> <span class="ruby-identifier">key</span>
610:         <span class="ruby-identifier">message</span>.<span class="ruby-identifier">to_s</span>
611:       <span class="ruby-keyword kw">end</span>
612:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000109">
                    
                    <a name="M000109"></a><b>keywords_message</b>(query, index, return_hits)
                    
                </div>
                
                <div class="description">
                  <p>
Generates the simple message to send to the daemon for a keywords request.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000109_source')" id="l_M000109_source">show</a>
                        
                    </p>
                    <div id="M000109_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/riddle/client.rb, line 811</span>
811:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">keywords_message</span>(<span class="ruby-identifier">query</span>, <span class="ruby-identifier">index</span>, <span class="ruby-identifier">return_hits</span>)
812:       <span class="ruby-identifier">message</span> = <span class="ruby-constant">Message</span>.<span class="ruby-identifier">new</span>
813: 
814:       <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_string</span> <span class="ruby-identifier">query</span>
815:       <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_string</span> <span class="ruby-identifier">index</span>
816:       <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_int</span> <span class="ruby-identifier">return_hits</span> <span class="ruby-operator">?</span> <span class="ruby-value">1</span> <span class="ruby-operator">:</span> <span class="ruby-value">0</span>
817: 
818:       <span class="ruby-identifier">message</span>.<span class="ruby-identifier">to_s</span>
819:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000088">
                    
                    <a name="M000088"></a><b>open_socket</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000088_source')" id="l_M000088_source">show</a>
                        
                    </p>
                    <div id="M000088_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/riddle/client.rb, line 495</span>
495:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">open_socket</span>
496:       <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;Already Connected&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@socket</span>.<span class="ruby-identifier">nil?</span>
497: 
498:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@timeout</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
499:         <span class="ruby-ivar">@socket</span> = <span class="ruby-identifier">initialise_connection</span>
500:       <span class="ruby-keyword kw">else</span>
501:         <span class="ruby-keyword kw">begin</span>
502:           <span class="ruby-constant">Timeout</span>.<span class="ruby-identifier">timeout</span>(<span class="ruby-ivar">@timeout</span>) { <span class="ruby-ivar">@socket</span> = <span class="ruby-identifier">initialise_connection</span> }
503:         <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Timeout</span><span class="ruby-operator">::</span><span class="ruby-constant">Error</span>, <span class="ruby-constant">Riddle</span><span class="ruby-operator">::</span><span class="ruby-constant">ConnectionError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
504:           <span class="ruby-identifier">failed_servers</span> <span class="ruby-operator">||=</span> []
505:           <span class="ruby-identifier">failed_servers</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">servers</span>.<span class="ruby-identifier">shift</span>
506:           <span class="ruby-keyword kw">retry</span> <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">servers</span>.<span class="ruby-identifier">empty?</span>
507: 
508:           <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">e</span>
509:           <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Timeout</span><span class="ruby-operator">::</span><span class="ruby-constant">Error</span>
510:             <span class="ruby-identifier">raise</span> <span class="ruby-constant">Riddle</span><span class="ruby-operator">::</span><span class="ruby-constant">ConnectionError</span>,
511:               <span class="ruby-node">&quot;Connection to #{failed_servers.inspect} on #{@port} timed out after #{@timeout} seconds&quot;</span>
512:           <span class="ruby-keyword kw">else</span>
513:             <span class="ruby-identifier">raise</span> <span class="ruby-identifier">e</span>
514:           <span class="ruby-keyword kw">end</span>
515:         <span class="ruby-keyword kw">end</span>
516:       <span class="ruby-keyword kw">end</span>
517: 
518:       <span class="ruby-keyword kw">true</span>
519:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000101">
                    
                    <a name="M000101"></a><b>query_message</b>(search, index, comments = '')
                    
                </div>
                
                <div class="description">
                  <p>
Generation of the message to send to Sphinx for a search.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000101_source')" id="l_M000101_source">show</a>
                        
                    </p>
                    <div id="M000101_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/riddle/client.rb, line 678</span>
678:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">query_message</span>(<span class="ruby-identifier">search</span>, <span class="ruby-identifier">index</span>, <span class="ruby-identifier">comments</span> = <span class="ruby-value str">''</span>)
679:       <span class="ruby-identifier">message</span> = <span class="ruby-constant">Message</span>.<span class="ruby-identifier">new</span>
680: 
681:       <span class="ruby-comment cmt"># Mode, Limits</span>
682:       <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_ints</span> <span class="ruby-ivar">@offset</span>, <span class="ruby-ivar">@limit</span>, <span class="ruby-constant">MatchModes</span>[<span class="ruby-ivar">@match_mode</span>]
683: 
684:       <span class="ruby-comment cmt"># Ranking</span>
685:       <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_int</span> <span class="ruby-constant">RankModes</span>[<span class="ruby-ivar">@rank_mode</span>]
686:       <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_string</span> <span class="ruby-ivar">@rank_expr</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@rank_mode</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:expr</span>
687: 
688:       <span class="ruby-comment cmt"># Sort Mode</span>
689:       <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_int</span> <span class="ruby-constant">SortModes</span>[<span class="ruby-ivar">@sort_mode</span>]
690:       <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_string</span> <span class="ruby-ivar">@sort_by</span>
691: 
692:       <span class="ruby-comment cmt"># Query</span>
693:       <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_string</span> <span class="ruby-identifier">search</span>
694: 
695:       <span class="ruby-comment cmt"># Weights</span>
696:       <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_int</span> <span class="ruby-ivar">@weights</span>.<span class="ruby-identifier">length</span>
697:       <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_ints</span> <span class="ruby-operator">*</span><span class="ruby-ivar">@weights</span>
698: 
699:       <span class="ruby-comment cmt"># Index</span>
700:       <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_string</span> <span class="ruby-identifier">index</span>
701: 
702:       <span class="ruby-comment cmt"># ID Range</span>
703:       <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_int</span> <span class="ruby-value">1</span>
704:       <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_64bit_ints</span> <span class="ruby-ivar">@id_range</span>.<span class="ruby-identifier">first</span>, <span class="ruby-ivar">@id_range</span>.<span class="ruby-identifier">last</span>
705: 
706:       <span class="ruby-comment cmt"># Filters</span>
707:       <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_int</span> <span class="ruby-ivar">@filters</span>.<span class="ruby-identifier">length</span>
708:       <span class="ruby-ivar">@filters</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">filter</span><span class="ruby-operator">|</span> <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append</span> <span class="ruby-identifier">filter</span>.<span class="ruby-identifier">query_message</span> }
709: 
710:       <span class="ruby-comment cmt"># Grouping</span>
711:       <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_int</span> <span class="ruby-constant">GroupFunctions</span>[<span class="ruby-ivar">@group_function</span>]
712:       <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_string</span> <span class="ruby-ivar">@group_by</span>
713:       <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_int</span> <span class="ruby-ivar">@max_matches</span>
714:       <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_string</span> <span class="ruby-ivar">@group_clause</span>
715:       <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_ints</span> <span class="ruby-ivar">@cut_off</span>, <span class="ruby-ivar">@retry_count</span>, <span class="ruby-ivar">@retry_delay</span>
716:       <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_string</span> <span class="ruby-ivar">@group_distinct</span>
717: 
718:       <span class="ruby-comment cmt"># Anchor Point</span>
719:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@anchor</span>.<span class="ruby-identifier">empty?</span>
720:         <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_int</span> <span class="ruby-value">0</span>
721:       <span class="ruby-keyword kw">else</span>
722:         <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_int</span> <span class="ruby-value">1</span>
723:         <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_string</span> <span class="ruby-ivar">@anchor</span>[<span class="ruby-identifier">:latitude_attribute</span>]
724:         <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_string</span> <span class="ruby-ivar">@anchor</span>[<span class="ruby-identifier">:longitude_attribute</span>]
725:         <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_floats</span> <span class="ruby-ivar">@anchor</span>[<span class="ruby-identifier">:latitude</span>], <span class="ruby-ivar">@anchor</span>[<span class="ruby-identifier">:longitude</span>]
726:       <span class="ruby-keyword kw">end</span>
727: 
728:       <span class="ruby-comment cmt"># Per Index Weights</span>
729:       <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_int</span> <span class="ruby-ivar">@index_weights</span>.<span class="ruby-identifier">length</span>
730:       <span class="ruby-ivar">@index_weights</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>,<span class="ruby-identifier">val</span><span class="ruby-operator">|</span>
731:         <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_string</span> <span class="ruby-identifier">key</span>.<span class="ruby-identifier">to_s</span>
732:         <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_int</span> <span class="ruby-identifier">val</span>
733:       <span class="ruby-keyword kw">end</span>
734: 
735:       <span class="ruby-comment cmt"># Max Query Time</span>
736:       <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_int</span> <span class="ruby-ivar">@max_query_time</span>
737: 
738:       <span class="ruby-comment cmt"># Per Field Weights</span>
739:       <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_int</span> <span class="ruby-ivar">@field_weights</span>.<span class="ruby-identifier">length</span>
740:       <span class="ruby-ivar">@field_weights</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>,<span class="ruby-identifier">val</span><span class="ruby-operator">|</span>
741:         <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_string</span> <span class="ruby-identifier">key</span>.<span class="ruby-identifier">to_s</span>
742:         <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_int</span> <span class="ruby-identifier">val</span>
743:       <span class="ruby-keyword kw">end</span>
744: 
745:       <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_string</span> <span class="ruby-identifier">comments</span>
746: 
747:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">message</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Versions</span>[<span class="ruby-identifier">:search</span>] <span class="ruby-operator">&lt;</span> <span class="ruby-value">0x116</span>
748: 
749:       <span class="ruby-comment cmt"># Overrides</span>
750:       <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_int</span> <span class="ruby-ivar">@overrides</span>.<span class="ruby-identifier">length</span>
751:       <span class="ruby-ivar">@overrides</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>,<span class="ruby-identifier">val</span><span class="ruby-operator">|</span>
752:         <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_string</span> <span class="ruby-identifier">key</span>.<span class="ruby-identifier">to_s</span>
753:         <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_int</span> <span class="ruby-constant">AttributeTypes</span>[<span class="ruby-identifier">val</span>[<span class="ruby-identifier">:type</span>]]
754:         <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_int</span> <span class="ruby-identifier">val</span>[<span class="ruby-identifier">:values</span>].<span class="ruby-identifier">length</span>
755:         <span class="ruby-identifier">val</span>[<span class="ruby-identifier">:values</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">id</span>,<span class="ruby-identifier">map</span><span class="ruby-operator">|</span>
756:           <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_64bit_int</span> <span class="ruby-identifier">id</span>
757:           <span class="ruby-identifier">method</span> = <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">val</span>[<span class="ruby-identifier">:type</span>]
758:           <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:float</span>
759:             <span class="ruby-identifier">:append_float</span>
760:           <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:bigint</span>
761:             <span class="ruby-identifier">:append_64bit_int</span>
762:           <span class="ruby-keyword kw">else</span>
763:             <span class="ruby-identifier">:append_int</span>
764:           <span class="ruby-keyword kw">end</span>
765:           <span class="ruby-identifier">message</span>.<span class="ruby-identifier">send</span> <span class="ruby-identifier">method</span>, <span class="ruby-identifier">map</span>
766:         <span class="ruby-keyword kw">end</span>
767:       <span class="ruby-keyword kw">end</span>
768: 
769:       <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_string</span> <span class="ruby-ivar">@select</span>
770: 
771:       <span class="ruby-identifier">message</span>.<span class="ruby-identifier">to_s</span>
772:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000100">
                    
                    <a name="M000100"></a><b>request</b>(command, messages)
                    
                </div>
                
                <div class="description">
                  <p>
Send a collection of messages, for a command type (eg, search, excerpts,
update), to the Sphinx daemon.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000100_source')" id="l_M000100_source">show</a>
                        
                    </p>
                    <div id="M000100_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/riddle/client.rb, line 616</span>
616:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">request</span>(<span class="ruby-identifier">command</span>, <span class="ruby-identifier">messages</span>)
617:       <span class="ruby-identifier">response</span> = <span class="ruby-value str">&quot;&quot;</span>
618:       <span class="ruby-identifier">status</span>   = <span class="ruby-value">-1</span>
619:       <span class="ruby-identifier">version</span>  = <span class="ruby-value">0</span>
620:       <span class="ruby-identifier">length</span>   = <span class="ruby-value">0</span>
621:       <span class="ruby-identifier">message</span>  = <span class="ruby-constant">Riddle</span>.<span class="ruby-identifier">encode</span>(<span class="ruby-constant">Array</span>(<span class="ruby-identifier">messages</span>).<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;&quot;</span>), <span class="ruby-value str">'ASCII-8BIT'</span>)
622: 
623:       <span class="ruby-identifier">connect</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">socket</span><span class="ruby-operator">|</span>
624:         <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">command</span>
625:         <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:search</span>
626:           <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Versions</span>[<span class="ruby-identifier">command</span>] <span class="ruby-operator">&gt;=</span> <span class="ruby-value">0x118</span>
627:             <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">send</span> <span class="ruby-identifier">request_header</span>(<span class="ruby-identifier">command</span>, <span class="ruby-identifier">message</span>.<span class="ruby-identifier">length</span>) <span class="ruby-operator">+</span>
628:               [<span class="ruby-value">0</span>, <span class="ruby-identifier">messages</span>.<span class="ruby-identifier">length</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'NN'</span>) <span class="ruby-operator">+</span> <span class="ruby-identifier">message</span>, <span class="ruby-value">0</span>
629:           <span class="ruby-keyword kw">else</span>
630:             <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">send</span> <span class="ruby-identifier">request_header</span>(<span class="ruby-identifier">command</span>, <span class="ruby-identifier">message</span>.<span class="ruby-identifier">length</span>) <span class="ruby-operator">+</span>
631:               [<span class="ruby-identifier">messages</span>.<span class="ruby-identifier">length</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'N'</span>) <span class="ruby-operator">+</span> <span class="ruby-identifier">message</span>, <span class="ruby-value">0</span>
632:           <span class="ruby-keyword kw">end</span>
633:         <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:status</span>
634:           <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">send</span> <span class="ruby-identifier">request_header</span>(<span class="ruby-identifier">command</span>, <span class="ruby-identifier">message</span>.<span class="ruby-identifier">length</span>), <span class="ruby-value">0</span>
635:         <span class="ruby-keyword kw">else</span>
636:           <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">send</span> <span class="ruby-identifier">request_header</span>(<span class="ruby-identifier">command</span>, <span class="ruby-identifier">message</span>.<span class="ruby-identifier">length</span>) <span class="ruby-operator">+</span> <span class="ruby-identifier">message</span>, <span class="ruby-value">0</span>
637:         <span class="ruby-keyword kw">end</span>
638: 
639:         <span class="ruby-identifier">header</span> = <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">recv</span>(<span class="ruby-value">8</span>)
640:         <span class="ruby-identifier">status</span>, <span class="ruby-identifier">version</span>, <span class="ruby-identifier">length</span> = <span class="ruby-identifier">header</span>.<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">'n2N'</span>)
641: 
642:         <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">response</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&lt;</span> (<span class="ruby-identifier">length</span> <span class="ruby-operator">||</span> <span class="ruby-value">0</span>)
643:           <span class="ruby-identifier">part</span> = <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">recv</span>(<span class="ruby-identifier">length</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">response</span>.<span class="ruby-identifier">length</span>)
644: 
645:           <span class="ruby-comment cmt"># will return 0 bytes if remote side closed TCP connection, e.g, searchd segfaulted.</span>
646:           <span class="ruby-keyword kw">break</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">part</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">TCPSocket</span>)
647: 
648:           <span class="ruby-identifier">response</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">part</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">part</span>
649:         <span class="ruby-keyword kw">end</span>
650:       <span class="ruby-keyword kw">end</span>
651: 
652:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">response</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">response</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">length</span>
653:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">ResponseError</span>, <span class="ruby-node">&quot;No response from searchd (status: #{status}, version: #{version})&quot;</span>
654:       <span class="ruby-keyword kw">end</span>
655: 
656:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">status</span>
657:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Statuses</span>[<span class="ruby-identifier">:ok</span>]
658:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">version</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Versions</span>[<span class="ruby-identifier">command</span>]
659:           <span class="ruby-identifier">puts</span> <span class="ruby-identifier">format</span>(<span class="ruby-value str">&quot;searchd command v.%d.%d older than client (v.%d.%d)&quot;</span>,
660:             <span class="ruby-identifier">version</span> <span class="ruby-operator">&gt;&gt;</span> <span class="ruby-value">8</span>, <span class="ruby-identifier">version</span> <span class="ruby-operator">&amp;</span> <span class="ruby-value">0xff</span>,
661:             <span class="ruby-constant">Versions</span>[<span class="ruby-identifier">command</span>] <span class="ruby-operator">&gt;&gt;</span> <span class="ruby-value">8</span>, <span class="ruby-constant">Versions</span>[<span class="ruby-identifier">command</span>] <span class="ruby-operator">&amp;</span> <span class="ruby-value">0xff</span>)
662:         <span class="ruby-keyword kw">end</span>
663:         <span class="ruby-identifier">response</span>
664:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Statuses</span>[<span class="ruby-identifier">:warning</span>]
665:         <span class="ruby-identifier">length</span> = <span class="ruby-identifier">response</span>[<span class="ruby-value">0</span>, <span class="ruby-value">4</span>].<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">'N*'</span>).<span class="ruby-identifier">first</span>
666:         <span class="ruby-identifier">puts</span> <span class="ruby-identifier">response</span>[<span class="ruby-value">4</span>, <span class="ruby-identifier">length</span>]
667:         <span class="ruby-identifier">response</span>[<span class="ruby-value">4</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">length</span>, <span class="ruby-identifier">response</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">-</span> <span class="ruby-value">4</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">length</span>]
668:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Statuses</span>[<span class="ruby-identifier">:error</span>], <span class="ruby-constant">Statuses</span>[<span class="ruby-identifier">:retry</span>]
669:         <span class="ruby-identifier">message</span> = <span class="ruby-identifier">response</span>[<span class="ruby-value">4</span>, <span class="ruby-identifier">response</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">-</span> <span class="ruby-value">4</span>]
670:         <span class="ruby-identifier">klass</span> = <span class="ruby-identifier">message</span>[<span class="ruby-regexp re">/out of bounds/</span>] <span class="ruby-operator">?</span> <span class="ruby-constant">OutOfBoundsError</span> <span class="ruby-operator">:</span> <span class="ruby-constant">ResponseError</span>
671:         <span class="ruby-identifier">raise</span> <span class="ruby-identifier">klass</span>, <span class="ruby-node">&quot;searchd error (status: #{status}): #{message}&quot;</span>
672:       <span class="ruby-keyword kw">else</span>
673:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">ResponseError</span>, <span class="ruby-node">&quot;Unknown searchd error (status: #{status})&quot;</span>
674:       <span class="ruby-keyword kw">end</span>
675:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000095">
                    
                    <a name="M000095"></a><b>request_header</b>(command, length = 0)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000095_source')" id="l_M000095_source">show</a>
                        
                    </p>
                    <div id="M000095_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/riddle/client.rb, line 586</span>
586:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">request_header</span>(<span class="ruby-identifier">command</span>, <span class="ruby-identifier">length</span> = <span class="ruby-value">0</span>)
587:       <span class="ruby-identifier">length</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">key_message</span>.<span class="ruby-identifier">length</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">key</span>
588:       <span class="ruby-identifier">core_header</span> = <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">command</span>
589:       <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:search</span>
590:         <span class="ruby-comment cmt"># Message length is +4/+8 to account for the following count value for</span>
591:         <span class="ruby-comment cmt"># the number of messages.</span>
592:         <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Versions</span>[<span class="ruby-identifier">command</span>] <span class="ruby-operator">&gt;=</span> <span class="ruby-value">0x118</span>
593:           [<span class="ruby-constant">Commands</span>[<span class="ruby-identifier">command</span>], <span class="ruby-constant">Versions</span>[<span class="ruby-identifier">command</span>], <span class="ruby-value">8</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">length</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">&quot;nnN&quot;</span>)
594:         <span class="ruby-keyword kw">else</span>
595:           [<span class="ruby-constant">Commands</span>[<span class="ruby-identifier">command</span>], <span class="ruby-constant">Versions</span>[<span class="ruby-identifier">command</span>], <span class="ruby-value">4</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">length</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">&quot;nnN&quot;</span>)
596:         <span class="ruby-keyword kw">end</span>
597:       <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:status</span>
598:         [<span class="ruby-constant">Commands</span>[<span class="ruby-identifier">command</span>], <span class="ruby-constant">Versions</span>[<span class="ruby-identifier">command</span>], <span class="ruby-value">4</span>, <span class="ruby-value">1</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">&quot;nnNN&quot;</span>)
599:       <span class="ruby-keyword kw">else</span>
600:         [<span class="ruby-constant">Commands</span>[<span class="ruby-identifier">command</span>], <span class="ruby-constant">Versions</span>[<span class="ruby-identifier">command</span>], <span class="ruby-identifier">length</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">&quot;nnN&quot;</span>)
601:       <span class="ruby-keyword kw">end</span>
602: 
603:       <span class="ruby-identifier">key</span> <span class="ruby-value">? </span><span class="ruby-identifier">core_header</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">key_message</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">core_header</span>
604:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000003">
                    
                    <a name="M000003"></a><b>update_message</b>(index, attributes, values_by_doc)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000003_source')" id="l_M000003_source">show</a>
                        
                    </p>
                    <div id="M000003_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/riddle/0.9.9/client.rb, line 23</span>
23:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update_message</span>(<span class="ruby-identifier">index</span>, <span class="ruby-identifier">attributes</span>, <span class="ruby-identifier">values_by_doc</span>)
24:     <span class="ruby-identifier">message</span> = <span class="ruby-constant">Message</span>.<span class="ruby-identifier">new</span>
25:     
26:     <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_string</span> <span class="ruby-identifier">index</span>
27:     <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_int</span> <span class="ruby-identifier">attributes</span>.<span class="ruby-identifier">length</span>
28:     <span class="ruby-identifier">attributes</span>.<span class="ruby-identifier">each_with_index</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">attribute</span>, <span class="ruby-identifier">index</span><span class="ruby-operator">|</span>
29:       <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_string</span> <span class="ruby-identifier">attribute</span>
30:       <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_boolean</span> <span class="ruby-identifier">values_by_doc</span>.<span class="ruby-identifier">values</span>.<span class="ruby-identifier">first</span>[<span class="ruby-identifier">index</span>].<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>)
31:     <span class="ruby-keyword kw">end</span>
32:     
33:     <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_int</span> <span class="ruby-identifier">values_by_doc</span>.<span class="ruby-identifier">length</span>
34:     <span class="ruby-identifier">values_by_doc</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>,<span class="ruby-identifier">values</span><span class="ruby-operator">|</span>
35:       <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_64bit_int</span> <span class="ruby-identifier">key</span> <span class="ruby-comment cmt"># document ID</span>
36:       <span class="ruby-identifier">values</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
37:         <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">value</span>
38:         <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Array</span>
39:           <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_int</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">length</span>
40:           <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_ints</span> <span class="ruby-operator">*</span><span class="ruby-identifier">value</span>
41:         <span class="ruby-keyword kw">else</span>
42:           <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_int</span> <span class="ruby-identifier">value</span>
43:         <span class="ruby-keyword kw">end</span>
44:       <span class="ruby-keyword kw">end</span>
45:     <span class="ruby-keyword kw">end</span>
46:     
47:     <span class="ruby-identifier">message</span>.<span class="ruby-identifier">to_s</span>
48:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000108">
                    
                    <a name="M000108"></a><b>update_message</b>(index, attributes, values_by_doc)
                    
                </div>
                
                <div class="description">
                  <p>
Generation of the message to send to Sphinx to update attributes of a
document.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000108_source')" id="l_M000108_source">show</a>
                        
                    </p>
                    <div id="M000108_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/riddle/client.rb, line 795</span>
795:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update_message</span>(<span class="ruby-identifier">index</span>, <span class="ruby-identifier">attributes</span>, <span class="ruby-identifier">values_by_doc</span>)
796:       <span class="ruby-identifier">message</span> = <span class="ruby-constant">Message</span>.<span class="ruby-identifier">new</span>
797: 
798:       <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_string</span> <span class="ruby-identifier">index</span>
799:       <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_array</span> <span class="ruby-identifier">attributes</span>
800: 
801:       <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_int</span> <span class="ruby-identifier">values_by_doc</span>.<span class="ruby-identifier">length</span>
802:       <span class="ruby-identifier">values_by_doc</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>,<span class="ruby-identifier">values</span><span class="ruby-operator">|</span>
803:         <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_64bit_int</span> <span class="ruby-identifier">key</span> <span class="ruby-comment cmt"># document ID</span>
804:         <span class="ruby-identifier">message</span>.<span class="ruby-identifier">append_ints</span> <span class="ruby-operator">*</span><span class="ruby-identifier">values</span> <span class="ruby-comment cmt"># array of new values (integers)</span>
805:       <span class="ruby-keyword kw">end</span>
806: 
807:       <span class="ruby-identifier">message</span>.<span class="ruby-identifier">to_s</span>
808:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Class Public methods</div>
            
            <div class="method">
                <div class="title" id="M000044">
                    
                    <a name="M000044"></a><b>connection</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000044_source')" id="l_M000044_source">show</a>
                        
                    </p>
                    <div id="M000044_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/riddle/client.rb, line 134</span>
134:     <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">connection</span>
135:       <span class="ruby-ivar">@@connection</span>
136:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000043">
                    
                    <a name="M000043"></a><b>connection=</b>(value)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000043_source')" id="l_M000043_source">show</a>
                        
                    </p>
                    <div id="M000043_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/riddle/client.rb, line 128</span>
128:     <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">connection=</span>(<span class="ruby-identifier">value</span>)
129:       <span class="ruby-constant">Riddle</span>.<span class="ruby-identifier">mutex</span>.<span class="ruby-identifier">synchronize</span> <span class="ruby-keyword kw">do</span>
130:         <span class="ruby-ivar">@@connection</span> = <span class="ruby-identifier">value</span>
131:       <span class="ruby-keyword kw">end</span>
132:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000045">
                    
                    <a name="M000045"></a><b>new</b>(servers = nil, port = nil, key = nil)
                    
                </div>
                
                <div class="description">
                  <p>
Can instantiate with a specific server and port - otherwise it assumes
defaults of localhost and 3312 respectively. All other settings can be
accessed and changed via the attribute accessors.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000045_source')" id="l_M000045_source">show</a>
                        
                    </p>
                    <div id="M000045_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/riddle/client.rb, line 141</span>
141:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">servers</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">port</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">key</span> = <span class="ruby-keyword kw">nil</span>)
142:       <span class="ruby-constant">Riddle</span>.<span class="ruby-identifier">version_warning</span>
143: 
144:       <span class="ruby-ivar">@servers</span> = <span class="ruby-constant">Array</span>(<span class="ruby-identifier">servers</span> <span class="ruby-operator">||</span> <span class="ruby-value str">&quot;localhost&quot;</span>)
145:       <span class="ruby-ivar">@port</span>   = <span class="ruby-identifier">port</span> <span class="ruby-operator">||</span> <span class="ruby-value">9312</span>
146:       <span class="ruby-ivar">@socket</span> = <span class="ruby-keyword kw">nil</span>
147:       <span class="ruby-ivar">@key</span>    = <span class="ruby-identifier">key</span>
148: 
149:       <span class="ruby-identifier">reset</span>
150: 
151:       <span class="ruby-ivar">@queue</span> = []
152:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    