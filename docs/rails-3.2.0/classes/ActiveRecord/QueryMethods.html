<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>ActiveRecord::QueryMethods</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../css/main.css" type="text/css" media="screen" />
    <script src="../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Module</span> 
            ActiveRecord::QueryMethods 
            
        </h1>
        <ul class="files">
            
            <li><a href="../../files/activerecord-3_2_0/lib/active_record/relation/query_methods_rb.html">activerecord-3.2.0/lib/active_record/relation/query_methods.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>A</dt>
        <dd>
            <ul>
                
                <li><a href="#M001638">apply_modules</a>,</li>
                
                <li><a href="#M001630">arel</a>,</li>
                
                <li><a href="#M001642">array_of_strings?</a></li>
                
            </ul>
        </dd>
    
        <dt>B</dt>
        <dd>
            <ul>
                
                <li><a href="#M001614">bind</a>,</li>
                
                <li><a href="#M001631">build_arel</a>,</li>
                
                <li><a href="#M001636">build_joins</a>,</li>
                
                <li><a href="#M001637">build_select</a>,</li>
                
                <li><a href="#M001635">build_where</a></li>
                
            </ul>
        </dd>
    
        <dt>C</dt>
        <dd>
            <ul>
                
                <li><a href="#M001633">collapse_wheres</a>,</li>
                
                <li><a href="#M001622">create_with</a>,</li>
                
                <li><a href="#M001632">custom_join_ast</a></li>
                
            </ul>
        </dd>
    
        <dt>E</dt>
        <dd>
            <ul>
                
                <li><a href="#M001603">eager_load</a>,</li>
                
                <li><a href="#M001628">extending</a></li>
                
            </ul>
        </dd>
    
        <dt>F</dt>
        <dd>
            <ul>
                
                <li><a href="#M001623">from</a></li>
                
            </ul>
        </dd>
    
        <dt>G</dt>
        <dd>
            <ul>
                
                <li><a href="#M001608">group</a></li>
                
            </ul>
        </dd>
    
        <dt>H</dt>
        <dd>
            <ul>
                
                <li><a href="#M001616">having</a></li>
                
            </ul>
        </dd>
    
        <dt>I</dt>
        <dd>
            <ul>
                
                <li><a href="#M001602">includes</a></li>
                
            </ul>
        </dd>
    
        <dt>J</dt>
        <dd>
            <ul>
                
                <li><a href="#M001612">joins</a></li>
                
            </ul>
        </dd>
    
        <dt>L</dt>
        <dd>
            <ul>
                
                <li><a href="#M001617">limit</a>,</li>
                
                <li><a href="#M001619">lock</a></li>
                
            </ul>
        </dd>
    
        <dt>O</dt>
        <dd>
            <ul>
                
                <li><a href="#M001618">offset</a>,</li>
                
                <li><a href="#M001609">order</a></li>
                
            </ul>
        </dd>
    
        <dt>P</dt>
        <dd>
            <ul>
                
                <li><a href="#M001604">preload</a></li>
                
            </ul>
        </dd>
    
        <dt>R</dt>
        <dd>
            <ul>
                
                <li><a href="#M001621">readonly</a>,</li>
                
                <li><a href="#M001611">reorder</a>,</li>
                
                <li><a href="#M001629">reverse_order</a>,</li>
                
                <li><a href="#M001640">reverse_sql_order</a></li>
                
            </ul>
        </dd>
    
        <dt>S</dt>
        <dd>
            <ul>
                
                <li><a href="#M001607">select</a></li>
                
            </ul>
        </dd>
    
        <dt>U</dt>
        <dd>
            <ul>
                
                <li><a href="#M001626">uniq</a></li>
                
            </ul>
        </dd>
    
        <dt>W</dt>
        <dd>
            <ul>
                
                <li><a href="#M001615">where</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    

    

    

    

    
    <div class="sectiontitle">Attributes</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>includes_values</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>eager_load_values</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>preload_values</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>select_values</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>group_values</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>order_values</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>joins_values</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>where_values</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>having_values</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>bind_values</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>limit_value</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>offset_value</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>lock_value</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>readonly_value</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>create_with_value</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>from_value</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>reordering_value</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>reverse_order_value</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>uniq_value</td>
            <td class='attr-desc'></td>
        </tr>
        
    </table>
    

    
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M001630">
                    
                    <a name="M001630"></a><b>arel</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001630_source')" id="l_M001630_source">show</a>
                        
                    </p>
                    <div id="M001630_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activerecord-3.2.0/lib/active_record/relation/query_methods.rb, line 259</span>
259:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">arel</span>
260:       <span class="ruby-ivar">@arel</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">with_default_scope</span>.<span class="ruby-identifier">build_arel</span>
261:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001614">
                    
                    <a name="M001614"></a><b>bind</b>(value)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001614_source')" id="l_M001614_source">show</a>
                        
                    </p>
                    <div id="M001614_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activerecord-3.2.0/lib/active_record/relation/query_methods.rb, line 126</span>
126:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">bind</span>(<span class="ruby-identifier">value</span>)
127:       <span class="ruby-identifier">relation</span> = <span class="ruby-identifier">clone</span>
128:       <span class="ruby-identifier">relation</span>.<span class="ruby-identifier">bind_values</span> <span class="ruby-operator">+=</span> [<span class="ruby-identifier">value</span>]
129:       <span class="ruby-identifier">relation</span>
130:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001631">
                    
                    <a name="M001631"></a><b>build_arel</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001631_source')" id="l_M001631_source">show</a>
                        
                    </p>
                    <div id="M001631_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activerecord-3.2.0/lib/active_record/relation/query_methods.rb, line 263</span>
263:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">build_arel</span>
264:       <span class="ruby-identifier">arel</span> = <span class="ruby-identifier">table</span>.<span class="ruby-identifier">from</span> <span class="ruby-identifier">table</span>
265: 
266:       <span class="ruby-identifier">build_joins</span>(<span class="ruby-identifier">arel</span>, <span class="ruby-ivar">@joins_values</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@joins_values</span>.<span class="ruby-identifier">empty?</span>
267: 
268:       <span class="ruby-identifier">collapse_wheres</span>(<span class="ruby-identifier">arel</span>, (<span class="ruby-ivar">@where_values</span> <span class="ruby-operator">-</span> [<span class="ruby-value str">''</span>]).<span class="ruby-identifier">uniq</span>)
269: 
270:       <span class="ruby-identifier">arel</span>.<span class="ruby-identifier">having</span>(<span class="ruby-operator">*</span><span class="ruby-ivar">@having_values</span>.<span class="ruby-identifier">uniq</span>.<span class="ruby-identifier">reject</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">h</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>.<span class="ruby-identifier">blank?</span>}) <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@having_values</span>.<span class="ruby-identifier">empty?</span>
271: 
272:       <span class="ruby-identifier">arel</span>.<span class="ruby-identifier">take</span>(<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">sanitize_limit</span>(<span class="ruby-ivar">@limit_value</span>)) <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@limit_value</span>
273:       <span class="ruby-identifier">arel</span>.<span class="ruby-identifier">skip</span>(<span class="ruby-ivar">@offset_value</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@offset_value</span>
274: 
275:       <span class="ruby-identifier">arel</span>.<span class="ruby-identifier">group</span>(<span class="ruby-operator">*</span><span class="ruby-ivar">@group_values</span>.<span class="ruby-identifier">uniq</span>.<span class="ruby-identifier">reject</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">g</span><span class="ruby-operator">|</span> <span class="ruby-identifier">g</span>.<span class="ruby-identifier">blank?</span>}) <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@group_values</span>.<span class="ruby-identifier">empty?</span>
276: 
277:       <span class="ruby-identifier">order</span> = <span class="ruby-ivar">@order_values</span>
278:       <span class="ruby-identifier">order</span> = <span class="ruby-identifier">reverse_sql_order</span>(<span class="ruby-identifier">order</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@reverse_order_value</span>
279:       <span class="ruby-identifier">arel</span>.<span class="ruby-identifier">order</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">order</span>.<span class="ruby-identifier">uniq</span>.<span class="ruby-identifier">reject</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">o</span><span class="ruby-operator">|</span> <span class="ruby-identifier">o</span>.<span class="ruby-identifier">blank?</span>}) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">order</span>.<span class="ruby-identifier">empty?</span>
280: 
281:       <span class="ruby-identifier">build_select</span>(<span class="ruby-identifier">arel</span>, <span class="ruby-ivar">@select_values</span>.<span class="ruby-identifier">uniq</span>)
282: 
283:       <span class="ruby-identifier">arel</span>.<span class="ruby-identifier">distinct</span>(<span class="ruby-ivar">@uniq_value</span>)
284:       <span class="ruby-identifier">arel</span>.<span class="ruby-identifier">from</span>(<span class="ruby-ivar">@from_value</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@from_value</span>
285:       <span class="ruby-identifier">arel</span>.<span class="ruby-identifier">lock</span>(<span class="ruby-ivar">@lock_value</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@lock_value</span>
286: 
287:       <span class="ruby-identifier">arel</span>
288:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001622">
                    
                    <a name="M001622"></a><b>create_with</b>(value)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001622_source')" id="l_M001622_source">show</a>
                        
                    </p>
                    <div id="M001622_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activerecord-3.2.0/lib/active_record/relation/query_methods.rb, line 179</span>
179:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create_with</span>(<span class="ruby-identifier">value</span>)
180:       <span class="ruby-identifier">relation</span> = <span class="ruby-identifier">clone</span>
181:       <span class="ruby-identifier">relation</span>.<span class="ruby-identifier">create_with_value</span> = <span class="ruby-identifier">value</span> <span class="ruby-value">? </span><span class="ruby-identifier">create_with_value</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">value</span>) <span class="ruby-operator">:</span> {}
182:       <span class="ruby-identifier">relation</span>
183:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001603">
                    
                    <a name="M001603"></a><b>eager_load</b>(*args)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001603_source')" id="l_M001603_source">show</a>
                        
                    </p>
                    <div id="M001603_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File activerecord-3.2.0/lib/active_record/relation/query_methods.rb, line 25</span>
25:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">eager_load</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
26:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">self</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">blank?</span>
27: 
28:       <span class="ruby-identifier">relation</span> = <span class="ruby-identifier">clone</span>
29:       <span class="ruby-identifier">relation</span>.<span class="ruby-identifier">eager_load_values</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">args</span>
30:       <span class="ruby-identifier">relation</span>
31:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001628">
                    
                    <a name="M001628"></a><b>extending</b>(*modules)
                    
                </div>
                
                <div class="description">
                  <p>
Used to extend a scope with additional methods, either through a module or
through a block provided.
</p>
<p>
The object returned is a relation, which can be further extended.
</p>
<h3>Using a module</h3>
<pre>
  module Pagination
    def page(number)
      # pagination code goes here
    end
  end

  scope = Model.scoped.extending(Pagination)
  scope.page(params[:page])
</pre>
<p>
You can also pass a list of modules:
</p>
<pre>
  scope = Model.scoped.extending(Pagination, SomethingElse)
</pre>
<h3>Using a block</h3>
<pre>
  scope = Model.scoped.extending do
    def page(number)
      # pagination code goes here
    end
  end
  scope.page(params[:page])
</pre>
<p>
You can also use a block and a module list:
</p>
<pre>
  scope = Model.scoped.extending(Pagination) do
    def per_page(number)
      # pagination code goes here
    end
  end
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001628_source')" id="l_M001628_source">show</a>
                        
                    </p>
                    <div id="M001628_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activerecord-3.2.0/lib/active_record/relation/query_methods.rb, line 243</span>
243:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">extending</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">modules</span>)
244:       <span class="ruby-identifier">modules</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Module</span>.<span class="ruby-identifier">new</span>(<span class="ruby-operator">&amp;</span><span class="ruby-constant">Proc</span>.<span class="ruby-identifier">new</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block_given?</span>
245: 
246:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">self</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">modules</span>.<span class="ruby-identifier">empty?</span>
247: 
248:       <span class="ruby-identifier">relation</span> = <span class="ruby-identifier">clone</span>
249:       <span class="ruby-identifier">relation</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">:apply_modules</span>, <span class="ruby-identifier">modules</span>.<span class="ruby-identifier">flatten</span>)
250:       <span class="ruby-identifier">relation</span>
251:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001623">
                    
                    <a name="M001623"></a><b>from</b>(value)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001623_source')" id="l_M001623_source">show</a>
                        
                    </p>
                    <div id="M001623_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activerecord-3.2.0/lib/active_record/relation/query_methods.rb, line 185</span>
185:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">from</span>(<span class="ruby-identifier">value</span>)
186:       <span class="ruby-identifier">relation</span> = <span class="ruby-identifier">clone</span>
187:       <span class="ruby-identifier">relation</span>.<span class="ruby-identifier">from_value</span> = <span class="ruby-identifier">value</span>
188:       <span class="ruby-identifier">relation</span>
189:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001608">
                    
                    <a name="M001608"></a><b>group</b>(*args)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001608_source')" id="l_M001608_source">show</a>
                        
                    </p>
                    <div id="M001608_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File activerecord-3.2.0/lib/active_record/relation/query_methods.rb, line 80</span>
80:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">group</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
81:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">self</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">blank?</span>
82: 
83:       <span class="ruby-identifier">relation</span> = <span class="ruby-identifier">clone</span>
84:       <span class="ruby-identifier">relation</span>.<span class="ruby-identifier">group_values</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">flatten</span>
85:       <span class="ruby-identifier">relation</span>
86:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001616">
                    
                    <a name="M001616"></a><b>having</b>(opts, *rest)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001616_source')" id="l_M001616_source">show</a>
                        
                    </p>
                    <div id="M001616_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activerecord-3.2.0/lib/active_record/relation/query_methods.rb, line 140</span>
140:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">having</span>(<span class="ruby-identifier">opts</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">rest</span>)
141:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">self</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">blank?</span>
142: 
143:       <span class="ruby-identifier">relation</span> = <span class="ruby-identifier">clone</span>
144:       <span class="ruby-identifier">relation</span>.<span class="ruby-identifier">having_values</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">build_where</span>(<span class="ruby-identifier">opts</span>, <span class="ruby-identifier">rest</span>)
145:       <span class="ruby-identifier">relation</span>
146:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001602">
                    
                    <a name="M001602"></a><b>includes</b>(*args)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001602_source')" id="l_M001602_source">show</a>
                        
                    </p>
                    <div id="M001602_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File activerecord-3.2.0/lib/active_record/relation/query_methods.rb, line 15</span>
15:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">includes</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
16:       <span class="ruby-identifier">args</span>.<span class="ruby-identifier">reject!</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">blank?</span> }
17: 
18:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">self</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">empty?</span>
19: 
20:       <span class="ruby-identifier">relation</span> = <span class="ruby-identifier">clone</span>
21:       <span class="ruby-identifier">relation</span>.<span class="ruby-identifier">includes_values</span> = (<span class="ruby-identifier">relation</span>.<span class="ruby-identifier">includes_values</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">args</span>).<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">uniq</span>
22:       <span class="ruby-identifier">relation</span>
23:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001612">
                    
                    <a name="M001612"></a><b>joins</b>(*args)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001612_source')" id="l_M001612_source">show</a>
                        
                    </p>
                    <div id="M001612_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activerecord-3.2.0/lib/active_record/relation/query_methods.rb, line 115</span>
115:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">joins</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
116:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">self</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">blank?</span>
117: 
118:       <span class="ruby-identifier">relation</span> = <span class="ruby-identifier">clone</span>
119: 
120:       <span class="ruby-identifier">args</span>.<span class="ruby-identifier">flatten!</span>
121:       <span class="ruby-identifier">relation</span>.<span class="ruby-identifier">joins_values</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">args</span>
122: 
123:       <span class="ruby-identifier">relation</span>
124:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001617">
                    
                    <a name="M001617"></a><b>limit</b>(value)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001617_source')" id="l_M001617_source">show</a>
                        
                    </p>
                    <div id="M001617_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activerecord-3.2.0/lib/active_record/relation/query_methods.rb, line 148</span>
148:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">limit</span>(<span class="ruby-identifier">value</span>)
149:       <span class="ruby-identifier">relation</span> = <span class="ruby-identifier">clone</span>
150:       <span class="ruby-identifier">relation</span>.<span class="ruby-identifier">limit_value</span> = <span class="ruby-identifier">value</span>
151:       <span class="ruby-identifier">relation</span>
152:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001619">
                    
                    <a name="M001619"></a><b>lock</b>(locks = true)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001619_source')" id="l_M001619_source">show</a>
                        
                    </p>
                    <div id="M001619_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activerecord-3.2.0/lib/active_record/relation/query_methods.rb, line 160</span>
160:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">lock</span>(<span class="ruby-identifier">locks</span> = <span class="ruby-keyword kw">true</span>)
161:       <span class="ruby-identifier">relation</span> = <span class="ruby-identifier">clone</span>
162: 
163:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">locks</span>
164:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">String</span>, <span class="ruby-constant">TrueClass</span>, <span class="ruby-constant">NilClass</span>
165:         <span class="ruby-identifier">relation</span>.<span class="ruby-identifier">lock_value</span> = <span class="ruby-identifier">locks</span> <span class="ruby-operator">||</span> <span class="ruby-keyword kw">true</span>
166:       <span class="ruby-keyword kw">else</span>
167:         <span class="ruby-identifier">relation</span>.<span class="ruby-identifier">lock_value</span> = <span class="ruby-keyword kw">false</span>
168:       <span class="ruby-keyword kw">end</span>
169: 
170:       <span class="ruby-identifier">relation</span>
171:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001618">
                    
                    <a name="M001618"></a><b>offset</b>(value)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001618_source')" id="l_M001618_source">show</a>
                        
                    </p>
                    <div id="M001618_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activerecord-3.2.0/lib/active_record/relation/query_methods.rb, line 154</span>
154:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">offset</span>(<span class="ruby-identifier">value</span>)
155:       <span class="ruby-identifier">relation</span> = <span class="ruby-identifier">clone</span>
156:       <span class="ruby-identifier">relation</span>.<span class="ruby-identifier">offset_value</span> = <span class="ruby-identifier">value</span>
157:       <span class="ruby-identifier">relation</span>
158:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001609">
                    
                    <a name="M001609"></a><b>order</b>(*args)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001609_source')" id="l_M001609_source">show</a>
                        
                    </p>
                    <div id="M001609_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File activerecord-3.2.0/lib/active_record/relation/query_methods.rb, line 88</span>
88:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">order</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
89:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">self</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">blank?</span>
90: 
91:       <span class="ruby-identifier">relation</span> = <span class="ruby-identifier">clone</span>
92:       <span class="ruby-identifier">relation</span>.<span class="ruby-identifier">order_values</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">flatten</span>
93:       <span class="ruby-identifier">relation</span>
94:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001604">
                    
                    <a name="M001604"></a><b>preload</b>(*args)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001604_source')" id="l_M001604_source">show</a>
                        
                    </p>
                    <div id="M001604_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File activerecord-3.2.0/lib/active_record/relation/query_methods.rb, line 33</span>
33:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">preload</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
34:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">self</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">blank?</span>
35: 
36:       <span class="ruby-identifier">relation</span> = <span class="ruby-identifier">clone</span>
37:       <span class="ruby-identifier">relation</span>.<span class="ruby-identifier">preload_values</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">args</span>
38:       <span class="ruby-identifier">relation</span>
39:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001621">
                    
                    <a name="M001621"></a><b>readonly</b>(value = true)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001621_source')" id="l_M001621_source">show</a>
                        
                    </p>
                    <div id="M001621_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activerecord-3.2.0/lib/active_record/relation/query_methods.rb, line 173</span>
173:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">readonly</span>(<span class="ruby-identifier">value</span> = <span class="ruby-keyword kw">true</span>)
174:       <span class="ruby-identifier">relation</span> = <span class="ruby-identifier">clone</span>
175:       <span class="ruby-identifier">relation</span>.<span class="ruby-identifier">readonly_value</span> = <span class="ruby-identifier">value</span>
176:       <span class="ruby-identifier">relation</span>
177:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001611">
                    
                    <a name="M001611"></a><b>reorder</b>(*args)
                    
                </div>
                
                <div class="description">
                  <p>
Replaces any existing order defined on the relation with the specified
order.
</p>
<pre>
  User.order('email DESC').reorder('id ASC') # generated SQL has 'ORDER BY id ASC'
</pre>
<p>
Subsequent calls to order on the same relation will be appended. For
example:
</p>
<pre>
  User.order('email DESC').reorder('id ASC').order('name ASC')
</pre>
<p>
generates a query with &#8216;ORDER BY id ASC, name ASC&#8217;.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001611_source')" id="l_M001611_source">show</a>
                        
                    </p>
                    <div id="M001611_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activerecord-3.2.0/lib/active_record/relation/query_methods.rb, line 106</span>
106:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">reorder</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
107:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">self</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">blank?</span>
108: 
109:       <span class="ruby-identifier">relation</span> = <span class="ruby-identifier">clone</span>
110:       <span class="ruby-identifier">relation</span>.<span class="ruby-identifier">reordering_value</span> = <span class="ruby-keyword kw">true</span>
111:       <span class="ruby-identifier">relation</span>.<span class="ruby-identifier">order_values</span> = <span class="ruby-identifier">args</span>.<span class="ruby-identifier">flatten</span>
112:       <span class="ruby-identifier">relation</span>
113:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001629">
                    
                    <a name="M001629"></a><b>reverse_order</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001629_source')" id="l_M001629_source">show</a>
                        
                    </p>
                    <div id="M001629_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activerecord-3.2.0/lib/active_record/relation/query_methods.rb, line 253</span>
253:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">reverse_order</span>
254:       <span class="ruby-identifier">relation</span> = <span class="ruby-identifier">clone</span>
255:       <span class="ruby-identifier">relation</span>.<span class="ruby-identifier">reverse_order_value</span> = <span class="ruby-operator">!</span><span class="ruby-identifier">relation</span>.<span class="ruby-identifier">reverse_order_value</span>
256:       <span class="ruby-identifier">relation</span>
257:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001607">
                    
                    <a name="M001607"></a><b>select</b>(value = Proc.new)
                    
                </div>
                
                <div class="description">
                  <p>
Works in two unique ways.
</p>
<p>
First: takes a block so it can be used just like Array#select.
</p>
<pre>
  Model.scoped.select { |m| m.field == value }
</pre>
<p>
This will build an array of objects from the database for the scope,
converting them into an array and iterating through them using
Array#select.
</p>
<p>
Second: Modifies the SELECT statement for the query so that only certain
fields are retrieved:
</p>
<pre>
  &gt;&gt; Model.select(:field)
  =&gt; [#&lt;Model field:value&gt;]
</pre>
<p>
Although in the above example it looks as though this method returns an
array, it actually returns a relation object and can have other query
methods appended to it, such as the other methods in <a
href="QueryMethods.html">ActiveRecord::QueryMethods</a>.
</p>
<p>
The argument to the method can also be an array of fields.
</p>
<pre>
  &gt;&gt; Model.select([:field, :other_field, :and_one_more])
  =&gt; [#&lt;Model field: &quot;value&quot;, other_field: &quot;value&quot;, and_one_more: &quot;value&quot;&gt;]
</pre>
<p>
Any attributes that do not have fields retrieved by a select will raise a
<a
href="../ActiveModel/MissingAttributeError.html">ActiveModel::MissingAttributeError</a>
when the getter method for that attribute is used:
</p>
<pre>
  &gt;&gt; Model.select(:field).first.other_field
  =&gt; ActiveModel::MissingAttributeError: missing attribute: other_field
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001607_source')" id="l_M001607_source">show</a>
                        
                    </p>
                    <div id="M001607_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File activerecord-3.2.0/lib/active_record/relation/query_methods.rb, line 70</span>
70:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">select</span>(<span class="ruby-identifier">value</span> = <span class="ruby-constant">Proc</span>.<span class="ruby-identifier">new</span>)
71:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block_given?</span>
72:         <span class="ruby-identifier">to_a</span>.<span class="ruby-identifier">select</span> {<span class="ruby-operator">|</span><span class="ruby-operator">*</span><span class="ruby-identifier">block_args</span><span class="ruby-operator">|</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">call</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">block_args</span>) }
73:       <span class="ruby-keyword kw">else</span>
74:         <span class="ruby-identifier">relation</span> = <span class="ruby-identifier">clone</span>
75:         <span class="ruby-identifier">relation</span>.<span class="ruby-identifier">select_values</span> <span class="ruby-operator">+=</span> <span class="ruby-constant">Array</span>.<span class="ruby-identifier">wrap</span>(<span class="ruby-identifier">value</span>)
76:         <span class="ruby-identifier">relation</span>
77:       <span class="ruby-keyword kw">end</span>
78:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001626">
                    
                    <a name="M001626"></a><b>uniq</b>(value = true)
                    
                </div>
                
                <div class="description">
                  <p>
Specifies whether the records should be unique or not. For example:
</p>
<pre>
  User.select(:name)
  # =&gt; Might return two records with the same name

  User.select(:name).uniq
  # =&gt; Returns 1 record per unique name

  User.select(:name).uniq.uniq(false)
  # =&gt; You can also remove the uniqueness
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001626_source')" id="l_M001626_source">show</a>
                        
                    </p>
                    <div id="M001626_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activerecord-3.2.0/lib/active_record/relation/query_methods.rb, line 201</span>
201:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">uniq</span>(<span class="ruby-identifier">value</span> = <span class="ruby-keyword kw">true</span>)
202:       <span class="ruby-identifier">relation</span> = <span class="ruby-identifier">clone</span>
203:       <span class="ruby-identifier">relation</span>.<span class="ruby-identifier">uniq_value</span> = <span class="ruby-identifier">value</span>
204:       <span class="ruby-identifier">relation</span>
205:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001615">
                    
                    <a name="M001615"></a><b>where</b>(opts, *rest)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001615_source')" id="l_M001615_source">show</a>
                        
                    </p>
                    <div id="M001615_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activerecord-3.2.0/lib/active_record/relation/query_methods.rb, line 132</span>
132:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">where</span>(<span class="ruby-identifier">opts</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">rest</span>)
133:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">self</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">blank?</span>
134: 
135:       <span class="ruby-identifier">relation</span> = <span class="ruby-identifier">clone</span>
136:       <span class="ruby-identifier">relation</span>.<span class="ruby-identifier">where_values</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">build_where</span>(<span class="ruby-identifier">opts</span>, <span class="ruby-identifier">rest</span>)
137:       <span class="ruby-identifier">relation</span>
138:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Private methods</div>
            
            <div class="method">
                <div class="title" id="M001638">
                    
                    <a name="M001638"></a><b>apply_modules</b>(modules)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001638_source')" id="l_M001638_source">show</a>
                        
                    </p>
                    <div id="M001638_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activerecord-3.2.0/lib/active_record/relation/query_methods.rb, line 387</span>
387:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">apply_modules</span>(<span class="ruby-identifier">modules</span>)
388:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">modules</span>.<span class="ruby-identifier">empty?</span>
389:         <span class="ruby-ivar">@extensions</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">modules</span>
390:         <span class="ruby-identifier">modules</span>.<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">extension</span><span class="ruby-operator">|</span> <span class="ruby-identifier">extend</span>(<span class="ruby-identifier">extension</span>) }
391:       <span class="ruby-keyword kw">end</span>
392:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001642">
                    
                    <a name="M001642"></a><b>array_of_strings?</b>(o)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001642_source')" id="l_M001642_source">show</a>
                        
                    </p>
                    <div id="M001642_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activerecord-3.2.0/lib/active_record/relation/query_methods.rb, line 412</span>
412:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">array_of_strings?</span>(<span class="ruby-identifier">o</span>)
413:       <span class="ruby-identifier">o</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">o</span>.<span class="ruby-identifier">all?</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">obj</span><span class="ruby-operator">|</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>)}
414:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001636">
                    
                    <a name="M001636"></a><b>build_joins</b>(manager, joins)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001636_source')" id="l_M001636_source">show</a>
                        
                    </p>
                    <div id="M001636_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activerecord-3.2.0/lib/active_record/relation/query_methods.rb, line 333</span>
333:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">build_joins</span>(<span class="ruby-identifier">manager</span>, <span class="ruby-identifier">joins</span>)
334:       <span class="ruby-identifier">buckets</span> = <span class="ruby-identifier">joins</span>.<span class="ruby-identifier">group_by</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">join</span><span class="ruby-operator">|</span>
335:         <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">join</span>
336:         <span class="ruby-keyword kw">when</span> <span class="ruby-constant">String</span>
337:           <span class="ruby-value str">'string_join'</span>
338:         <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Hash</span>, <span class="ruby-constant">Symbol</span>, <span class="ruby-constant">Array</span>
339:           <span class="ruby-value str">'association_join'</span>
340:         <span class="ruby-keyword kw">when</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Associations</span><span class="ruby-operator">::</span><span class="ruby-constant">JoinDependency</span><span class="ruby-operator">::</span><span class="ruby-constant">JoinAssociation</span>
341:           <span class="ruby-value str">'stashed_join'</span>
342:         <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Arel</span><span class="ruby-operator">::</span><span class="ruby-constant">Nodes</span><span class="ruby-operator">::</span><span class="ruby-constant">Join</span>
343:           <span class="ruby-value str">'join_node'</span>
344:         <span class="ruby-keyword kw">else</span>
345:           <span class="ruby-identifier">raise</span> <span class="ruby-value str">'unknown class: %s'</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">join</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">name</span>
346:         <span class="ruby-keyword kw">end</span>
347:       <span class="ruby-keyword kw">end</span>
348: 
349:       <span class="ruby-identifier">association_joins</span>         = <span class="ruby-identifier">buckets</span>[<span class="ruby-value str">'association_join'</span>] <span class="ruby-operator">||</span> []
350:       <span class="ruby-identifier">stashed_association_joins</span> = <span class="ruby-identifier">buckets</span>[<span class="ruby-value str">'stashed_join'</span>] <span class="ruby-operator">||</span> []
351:       <span class="ruby-identifier">join_nodes</span>                = (<span class="ruby-identifier">buckets</span>[<span class="ruby-value str">'join_node'</span>] <span class="ruby-operator">||</span> []).<span class="ruby-identifier">uniq</span>
352:       <span class="ruby-identifier">string_joins</span>              = (<span class="ruby-identifier">buckets</span>[<span class="ruby-value str">'string_join'</span>] <span class="ruby-operator">||</span> []).<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span>
353:         <span class="ruby-identifier">x</span>.<span class="ruby-identifier">strip</span>
354:       }.<span class="ruby-identifier">uniq</span>
355: 
356:       <span class="ruby-identifier">join_list</span> = <span class="ruby-identifier">join_nodes</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">custom_join_ast</span>(<span class="ruby-identifier">manager</span>, <span class="ruby-identifier">string_joins</span>)
357: 
358:       <span class="ruby-identifier">join_dependency</span> = <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Associations</span><span class="ruby-operator">::</span><span class="ruby-constant">JoinDependency</span>.<span class="ruby-identifier">new</span>(
359:         <span class="ruby-ivar">@klass</span>,
360:         <span class="ruby-identifier">association_joins</span>,
361:         <span class="ruby-identifier">join_list</span>
362:       )
363: 
364:       <span class="ruby-identifier">join_dependency</span>.<span class="ruby-identifier">graft</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">stashed_association_joins</span>)
365: 
366:       <span class="ruby-ivar">@implicit_readonly</span> = <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">association_joins</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">stashed_association_joins</span>.<span class="ruby-identifier">empty?</span>
367: 
368:       <span class="ruby-comment cmt"># FIXME: refactor this to build an AST</span>
369:       <span class="ruby-identifier">join_dependency</span>.<span class="ruby-identifier">join_associations</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">association</span><span class="ruby-operator">|</span>
370:         <span class="ruby-identifier">association</span>.<span class="ruby-identifier">join_to</span>(<span class="ruby-identifier">manager</span>)
371:       <span class="ruby-keyword kw">end</span>
372: 
373:       <span class="ruby-identifier">manager</span>.<span class="ruby-identifier">join_sources</span>.<span class="ruby-identifier">concat</span> <span class="ruby-identifier">join_list</span>
374: 
375:       <span class="ruby-identifier">manager</span>
376:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001637">
                    
                    <a name="M001637"></a><b>build_select</b>(arel, selects)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001637_source')" id="l_M001637_source">show</a>
                        
                    </p>
                    <div id="M001637_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activerecord-3.2.0/lib/active_record/relation/query_methods.rb, line 378</span>
378:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">build_select</span>(<span class="ruby-identifier">arel</span>, <span class="ruby-identifier">selects</span>)
379:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">selects</span>.<span class="ruby-identifier">empty?</span>
380:         <span class="ruby-ivar">@implicit_readonly</span> = <span class="ruby-keyword kw">false</span>
381:         <span class="ruby-identifier">arel</span>.<span class="ruby-identifier">project</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">selects</span>)
382:       <span class="ruby-keyword kw">else</span>
383:         <span class="ruby-identifier">arel</span>.<span class="ruby-identifier">project</span>(<span class="ruby-ivar">@klass</span>.<span class="ruby-identifier">arel_table</span>[<span class="ruby-constant">Arel</span>.<span class="ruby-identifier">star</span>])
384:       <span class="ruby-keyword kw">end</span>
385:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001635">
                    
                    <a name="M001635"></a><b>build_where</b>(opts, other = [])
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001635_source')" id="l_M001635_source">show</a>
                        
                    </p>
                    <div id="M001635_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activerecord-3.2.0/lib/active_record/relation/query_methods.rb, line 321</span>
321:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">build_where</span>(<span class="ruby-identifier">opts</span>, <span class="ruby-identifier">other</span> = [])
322:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">opts</span>
323:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">String</span>, <span class="ruby-constant">Array</span>
324:         [<span class="ruby-ivar">@klass</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">:sanitize_sql</span>, <span class="ruby-identifier">other</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-value">? </span><span class="ruby-identifier">opts</span> <span class="ruby-operator">:</span> ([<span class="ruby-identifier">opts</span>] <span class="ruby-operator">+</span> <span class="ruby-identifier">other</span>))]
325:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Hash</span>
326:         <span class="ruby-identifier">attributes</span> = <span class="ruby-ivar">@klass</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">:expand_hash_conditions_for_aggregates</span>, <span class="ruby-identifier">opts</span>)
327:         <span class="ruby-constant">PredicateBuilder</span>.<span class="ruby-identifier">build_from_hash</span>(<span class="ruby-identifier">table</span>.<span class="ruby-identifier">engine</span>, <span class="ruby-identifier">attributes</span>, <span class="ruby-identifier">table</span>)
328:       <span class="ruby-keyword kw">else</span>
329:         [<span class="ruby-identifier">opts</span>]
330:       <span class="ruby-keyword kw">end</span>
331:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001633">
                    
                    <a name="M001633"></a><b>collapse_wheres</b>(arel, wheres)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001633_source')" id="l_M001633_source">show</a>
                        
                    </p>
                    <div id="M001633_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activerecord-3.2.0/lib/active_record/relation/query_methods.rb, line 310</span>
310:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">collapse_wheres</span>(<span class="ruby-identifier">arel</span>, <span class="ruby-identifier">wheres</span>)
311:       <span class="ruby-identifier">equalities</span> = <span class="ruby-identifier">wheres</span>.<span class="ruby-identifier">grep</span>(<span class="ruby-constant">Arel</span><span class="ruby-operator">::</span><span class="ruby-constant">Nodes</span><span class="ruby-operator">::</span><span class="ruby-constant">Equality</span>)
312: 
313:       <span class="ruby-identifier">arel</span>.<span class="ruby-identifier">where</span>(<span class="ruby-constant">Arel</span><span class="ruby-operator">::</span><span class="ruby-constant">Nodes</span><span class="ruby-operator">::</span><span class="ruby-constant">And</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">equalities</span>)) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">equalities</span>.<span class="ruby-identifier">empty?</span>
314: 
315:       (<span class="ruby-identifier">wheres</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">equalities</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">where</span><span class="ruby-operator">|</span>
316:         <span class="ruby-identifier">where</span> = <span class="ruby-constant">Arel</span>.<span class="ruby-identifier">sql</span>(<span class="ruby-identifier">where</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-constant">String</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">where</span>
317:         <span class="ruby-identifier">arel</span>.<span class="ruby-identifier">where</span>(<span class="ruby-constant">Arel</span><span class="ruby-operator">::</span><span class="ruby-constant">Nodes</span><span class="ruby-operator">::</span><span class="ruby-constant">Grouping</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">where</span>))
318:       <span class="ruby-keyword kw">end</span>
319:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001632">
                    
                    <a name="M001632"></a><b>custom_join_ast</b>(table, joins)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001632_source')" id="l_M001632_source">show</a>
                        
                    </p>
                    <div id="M001632_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activerecord-3.2.0/lib/active_record/relation/query_methods.rb, line 292</span>
292:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">custom_join_ast</span>(<span class="ruby-identifier">table</span>, <span class="ruby-identifier">joins</span>)
293:       <span class="ruby-identifier">joins</span> = <span class="ruby-identifier">joins</span>.<span class="ruby-identifier">reject</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">join</span><span class="ruby-operator">|</span> <span class="ruby-identifier">join</span>.<span class="ruby-identifier">blank?</span> }
294: 
295:       <span class="ruby-keyword kw">return</span> [] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">joins</span>.<span class="ruby-identifier">empty?</span>
296: 
297:       <span class="ruby-ivar">@implicit_readonly</span> = <span class="ruby-keyword kw">true</span>
298: 
299:       <span class="ruby-identifier">joins</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">join</span><span class="ruby-operator">|</span>
300:         <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">join</span>
301:         <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Array</span>
302:           <span class="ruby-identifier">join</span> = <span class="ruby-constant">Arel</span>.<span class="ruby-identifier">sql</span>(<span class="ruby-identifier">join</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">' '</span>)) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">array_of_strings?</span>(<span class="ruby-identifier">join</span>)
303:         <span class="ruby-keyword kw">when</span> <span class="ruby-constant">String</span>
304:           <span class="ruby-identifier">join</span> = <span class="ruby-constant">Arel</span>.<span class="ruby-identifier">sql</span>(<span class="ruby-identifier">join</span>)
305:         <span class="ruby-keyword kw">end</span>
306:         <span class="ruby-identifier">table</span>.<span class="ruby-identifier">create_string_join</span>(<span class="ruby-identifier">join</span>)
307:       <span class="ruby-keyword kw">end</span>
308:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001640">
                    
                    <a name="M001640"></a><b>reverse_sql_order</b>(order_query)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001640_source')" id="l_M001640_source">show</a>
                        
                    </p>
                    <div id="M001640_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activerecord-3.2.0/lib/active_record/relation/query_methods.rb, line 394</span>
394:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">reverse_sql_order</span>(<span class="ruby-identifier">order_query</span>)
395:       <span class="ruby-identifier">order_query</span> = [<span class="ruby-node">&quot;#{quoted_table_name}.#{quoted_primary_key} ASC&quot;</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">order_query</span>.<span class="ruby-identifier">empty?</span>
396: 
397:       <span class="ruby-identifier">order_query</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">o</span><span class="ruby-operator">|</span>
398:         <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">o</span>
399:         <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Arel</span><span class="ruby-operator">::</span><span class="ruby-constant">Nodes</span><span class="ruby-operator">::</span><span class="ruby-constant">Ordering</span>
400:           <span class="ruby-identifier">o</span>.<span class="ruby-identifier">reverse</span>
401:         <span class="ruby-keyword kw">when</span> <span class="ruby-constant">String</span>, <span class="ruby-constant">Symbol</span>
402:           <span class="ruby-identifier">o</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">','</span>).<span class="ruby-identifier">collect</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
403:             <span class="ruby-identifier">s</span>.<span class="ruby-identifier">strip!</span>
404:             <span class="ruby-identifier">s</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">/\sasc\Z/i</span>, <span class="ruby-value str">' DESC'</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">/\sdesc\Z/i</span>, <span class="ruby-value str">' ASC'</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-value str">' DESC'</span>)
405:           <span class="ruby-keyword kw">end</span>
406:         <span class="ruby-keyword kw">else</span>
407:           <span class="ruby-identifier">o</span>
408:         <span class="ruby-keyword kw">end</span>
409:       <span class="ruby-keyword kw">end</span>.<span class="ruby-identifier">flatten</span>
410:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    