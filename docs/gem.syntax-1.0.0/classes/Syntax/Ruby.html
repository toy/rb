<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>Syntax::Ruby</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../css/main.css" type="text/css" media="screen" />
    <script src="../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Class</span> 
            Syntax::Ruby 
            
                <span class="parent">&lt; 
                    
                    Tokenizer
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../files/lib/syntax/lang/ruby_rb.html">lib/syntax/lang/ruby.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    
    <div class="description">
        <p>
A tokenizer for the <a href="Ruby.html">Ruby</a> language. It recognizes
all common syntax (and some less common syntax) but because it is not a
true lexer, it will make mistakes on some ambiguous cases.
</p>

    </div>
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>S</dt>
        <dd>
            <ul>
                
                <li><a href="#M000027">scan_delimited_region</a>,</li>
                
                <li><a href="#M000029">scan_heredoc</a>,</li>
                
                <li><a href="#M000023">setup</a>,</li>
                
                <li><a href="#M000024">step</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    

    

    

    
    <div class="sectiontitle">Constants</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class="attr-name">KEYWORDS</td>
            <td>=</td>
            <td class="attr-value">%w{if then elsif else end begin do rescue ensure while for          class module def yield raise until unless and or not when          case super undef break next redo retry in return alias          defined?}</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
The list of all identifiers recognized as keywords.
</p>
</td>
        </tr>
        
        
    </table>
    

    

    
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M000023">
                    
                    <a name="M000023"></a><b>setup</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Perform ruby-specific setup
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000023_source')" id="l_M000023_source">show</a>
                        
                    </p>
                    <div id="M000023_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/syntax/lang/ruby.rb, line 18</span>
18:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">setup</span>
19:       <span class="ruby-ivar">@selector</span> = <span class="ruby-keyword kw">false</span>
20:       <span class="ruby-ivar">@allow_operator</span> = <span class="ruby-keyword kw">false</span>
21:       <span class="ruby-ivar">@heredocs</span> = []
22:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000024">
                    
                    <a name="M000024"></a><b>step</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Step through a single iteration of the tokenization process.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000024_source')" id="l_M000024_source">show</a>
                        
                    </p>
                    <div id="M000024_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/syntax/lang/ruby.rb, line 25</span>
 25:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">step</span>
 26:       <span class="ruby-keyword kw">case</span>
 27:         <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">bol?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">check</span>( <span class="ruby-regexp re">/=begin/</span> )
 28:           <span class="ruby-identifier">start_group</span>( <span class="ruby-identifier">:comment</span>, <span class="ruby-identifier">scan_until</span>( <span class="ruby-node">/^=end#{EOL}/</span> ) )
 29:         <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">bol?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">check</span>( <span class="ruby-node">/__END__#{EOL}/</span> )
 30:           <span class="ruby-identifier">start_group</span>( <span class="ruby-identifier">:comment</span>, <span class="ruby-identifier">scan_until</span>( <span class="ruby-regexp re">/\Z/</span> ) )
 31:       <span class="ruby-keyword kw">else</span>
 32:         <span class="ruby-keyword kw">case</span>
 33:           <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">check</span>( <span class="ruby-regexp re">/def\s+/</span> )
 34:             <span class="ruby-identifier">start_group</span> <span class="ruby-identifier">:keyword</span>, <span class="ruby-identifier">scan</span>( <span class="ruby-regexp re">/def\s+/</span> )
 35:             <span class="ruby-identifier">start_group</span> <span class="ruby-identifier">:method</span>,  <span class="ruby-identifier">scan_until</span>( <span class="ruby-node">/(?=[;(\s]|#{EOL})/</span> )
 36:           <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">check</span>( <span class="ruby-regexp re">/class\s+/</span> )
 37:             <span class="ruby-identifier">start_group</span> <span class="ruby-identifier">:keyword</span>, <span class="ruby-identifier">scan</span>( <span class="ruby-regexp re">/class\s+/</span> )
 38:             <span class="ruby-identifier">start_group</span> <span class="ruby-identifier">:class</span>,  <span class="ruby-identifier">scan_until</span>( <span class="ruby-node">/(?=[;\s&lt;]|#{EOL})/</span> )
 39:           <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">check</span>( <span class="ruby-regexp re">/module\s+/</span> )
 40:             <span class="ruby-identifier">start_group</span> <span class="ruby-identifier">:keyword</span>, <span class="ruby-identifier">scan</span>( <span class="ruby-regexp re">/module\s+/</span> )
 41:             <span class="ruby-identifier">start_group</span> <span class="ruby-identifier">:module</span>,  <span class="ruby-identifier">scan_until</span>( <span class="ruby-node">/(?=[;\s]|#{EOL})/</span> )
 42:           <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">check</span>( <span class="ruby-regexp re">/::/</span> )
 43:             <span class="ruby-identifier">start_group</span> <span class="ruby-identifier">:punct</span>, <span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/::/</span>)
 44:           <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">check</span>( <span class="ruby-regexp re">/:&quot;/</span> )
 45:             <span class="ruby-identifier">start_group</span> <span class="ruby-identifier">:symbol</span>, <span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/:/</span>)
 46:             <span class="ruby-identifier">scan_delimited_region</span> <span class="ruby-identifier">:symbol</span>, <span class="ruby-identifier">:symbol</span>, <span class="ruby-value str">&quot;&quot;</span>, <span class="ruby-keyword kw">true</span>
 47:             <span class="ruby-ivar">@allow_operator</span> = <span class="ruby-keyword kw">true</span>
 48:           <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">check</span>( <span class="ruby-regexp re">/:'/</span> )
 49:             <span class="ruby-identifier">start_group</span> <span class="ruby-identifier">:symbol</span>, <span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/:/</span>)
 50:             <span class="ruby-identifier">scan_delimited_region</span> <span class="ruby-identifier">:symbol</span>, <span class="ruby-identifier">:symbol</span>, <span class="ruby-value str">&quot;&quot;</span>, <span class="ruby-keyword kw">false</span>
 51:             <span class="ruby-ivar">@allow_operator</span> = <span class="ruby-keyword kw">true</span>
 52:           <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">scan</span>( <span class="ruby-regexp re">/:[_a-zA-Z@$][$@\w]*[=!?]?/</span> )
 53:             <span class="ruby-identifier">start_group</span> <span class="ruby-identifier">:symbol</span>, <span class="ruby-identifier">matched</span>
 54:             <span class="ruby-ivar">@allow_operator</span> = <span class="ruby-keyword kw">true</span>
 55:           <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">scan</span>( <span class="ruby-regexp re">/\?(\\[^\n\r]|[^\\\n\r\s])/</span> )
 56:             <span class="ruby-identifier">start_group</span> <span class="ruby-identifier">:char</span>, <span class="ruby-identifier">matched</span>
 57:             <span class="ruby-ivar">@allow_operator</span> = <span class="ruby-keyword kw">true</span>
 58:           <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">check</span>( <span class="ruby-regexp re">/(__FILE__|__LINE__|true|false|nil|self)[?!]?/</span> )
 59:             <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@selector</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">matched</span>[<span class="ruby-value">-1</span>] <span class="ruby-operator">==</span> <span class="ruby-value">??</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">matched</span>[<span class="ruby-value">-1</span>] <span class="ruby-operator">==</span> <span class="ruby-value">?!</span>
 60:               <span class="ruby-identifier">start_group</span> <span class="ruby-identifier">:ident</span>,
 61:                 <span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/(__FILE__|__LINE__|true|false|nil|self)[?!]?/</span>)
 62:             <span class="ruby-keyword kw">else</span>
 63:               <span class="ruby-identifier">start_group</span> <span class="ruby-identifier">:constant</span>,
 64:                 <span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/(__FILE__|__LINE__|true|false|nil|self)/</span>)
 65:             <span class="ruby-keyword kw">end</span>
 66:             <span class="ruby-ivar">@selector</span> = <span class="ruby-keyword kw">false</span>
 67:             <span class="ruby-ivar">@allow_operator</span> = <span class="ruby-keyword kw">true</span>
 68:           <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/0([bB][01]+|[oO][0-7]+|[dD][0-9]+|[xX][0-9a-fA-F]+)/</span>)
 69:             <span class="ruby-identifier">start_group</span> <span class="ruby-identifier">:number</span>, <span class="ruby-identifier">matched</span>
 70:             <span class="ruby-ivar">@allow_operator</span> = <span class="ruby-keyword kw">true</span>
 71:           <span class="ruby-keyword kw">else</span>
 72:             <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">peek</span>(<span class="ruby-value">2</span>)
 73:               <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;%r&quot;</span>
 74:                 <span class="ruby-identifier">scan_delimited_region</span> <span class="ruby-identifier">:punct</span>, <span class="ruby-identifier">:regex</span>, <span class="ruby-identifier">scan</span>( <span class="ruby-regexp re">/../</span> ), <span class="ruby-keyword kw">true</span>
 75:                 <span class="ruby-ivar">@allow_operator</span> = <span class="ruby-keyword kw">true</span>
 76:               <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;%w&quot;</span>, <span class="ruby-value str">&quot;%q&quot;</span>
 77:                 <span class="ruby-identifier">scan_delimited_region</span> <span class="ruby-identifier">:punct</span>, <span class="ruby-identifier">:string</span>, <span class="ruby-identifier">scan</span>( <span class="ruby-regexp re">/../</span> ), <span class="ruby-keyword kw">false</span>
 78:                 <span class="ruby-ivar">@allow_operator</span> = <span class="ruby-keyword kw">true</span>
 79:               <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;%s&quot;</span>
 80:                 <span class="ruby-identifier">scan_delimited_region</span> <span class="ruby-identifier">:punct</span>, <span class="ruby-identifier">:symbol</span>, <span class="ruby-identifier">scan</span>( <span class="ruby-regexp re">/../</span> ), <span class="ruby-keyword kw">false</span>
 81:                 <span class="ruby-ivar">@allow_operator</span> = <span class="ruby-keyword kw">true</span>
 82:               <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;%W&quot;</span>, <span class="ruby-value str">&quot;%Q&quot;</span>, <span class="ruby-value str">&quot;%x&quot;</span>
 83:                 <span class="ruby-identifier">scan_delimited_region</span> <span class="ruby-identifier">:punct</span>, <span class="ruby-identifier">:string</span>, <span class="ruby-identifier">scan</span>( <span class="ruby-regexp re">/../</span> ), <span class="ruby-keyword kw">true</span>
 84:                 <span class="ruby-ivar">@allow_operator</span> = <span class="ruby-keyword kw">true</span>
 85:               <span class="ruby-keyword kw">when</span> <span class="ruby-regexp re">/%[^\sa-zA-Z0-9]/</span>
 86:                 <span class="ruby-identifier">scan_delimited_region</span> <span class="ruby-identifier">:punct</span>, <span class="ruby-identifier">:string</span>, <span class="ruby-identifier">scan</span>( <span class="ruby-regexp re">/./</span> ), <span class="ruby-keyword kw">true</span>
 87:                 <span class="ruby-ivar">@allow_operator</span> = <span class="ruby-keyword kw">true</span>
 88:               <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;&lt;&lt;&quot;</span>
 89:                 <span class="ruby-identifier">saw_word</span> = ( <span class="ruby-identifier">chunk</span>[<span class="ruby-value">-1</span>,<span class="ruby-value">1</span>] <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/[\w!?]/</span> )
 90:                 <span class="ruby-identifier">start_group</span> <span class="ruby-identifier">:punct</span>, <span class="ruby-identifier">scan</span>( <span class="ruby-regexp re">/&lt;&lt;/</span> )
 91:                 <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">saw_word</span>
 92:                   <span class="ruby-ivar">@allow_operator</span> = <span class="ruby-keyword kw">false</span>
 93:                   <span class="ruby-keyword kw">return</span>
 94:                 <span class="ruby-keyword kw">end</span>
 95: 
 96:                 <span class="ruby-identifier">float_right</span> = <span class="ruby-identifier">scan</span>( <span class="ruby-regexp re">/-/</span> )
 97:                 <span class="ruby-identifier">append</span> <span class="ruby-value str">&quot;-&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">float_right</span>
 98:                 <span class="ruby-keyword kw">if</span> ( <span class="ruby-identifier">type</span> = <span class="ruby-identifier">scan</span>( <span class="ruby-regexp re">/['&quot;]/</span> ) )
 99:                   <span class="ruby-identifier">append</span> <span class="ruby-identifier">type</span>
100:                   <span class="ruby-identifier">delim</span> = <span class="ruby-identifier">scan_until</span>( <span class="ruby-node">/(?=#{type})/</span> )
101:                   <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">delim</span>.<span class="ruby-identifier">nil?</span>
102:                     <span class="ruby-identifier">append</span> <span class="ruby-identifier">scan_until</span>( <span class="ruby-regexp re">/\Z/</span> )
103:                     <span class="ruby-keyword kw">return</span>
104:                   <span class="ruby-keyword kw">end</span>
105:                 <span class="ruby-keyword kw">else</span>
106:                   <span class="ruby-identifier">delim</span> = <span class="ruby-identifier">scan</span>( <span class="ruby-regexp re">/\w+/</span> ) <span class="ruby-keyword kw">or</span> <span class="ruby-keyword kw">return</span>
107:                 <span class="ruby-keyword kw">end</span>
108:                 <span class="ruby-identifier">start_group</span> <span class="ruby-identifier">:constant</span>, <span class="ruby-identifier">delim</span>
109:                 <span class="ruby-identifier">start_group</span> <span class="ruby-identifier">:punct</span>, <span class="ruby-identifier">scan</span>( <span class="ruby-node">/#{type}/</span> ) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">type</span>
110:                 <span class="ruby-ivar">@heredocs</span> <span class="ruby-operator">&lt;&lt;</span> [ <span class="ruby-identifier">float_right</span>, <span class="ruby-identifier">type</span>, <span class="ruby-identifier">delim</span> ]
111:                 <span class="ruby-ivar">@allow_operator</span> = <span class="ruby-keyword kw">true</span>
112:               <span class="ruby-keyword kw">else</span>
113:                 <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">peek</span>(<span class="ruby-value">1</span>)
114:                   <span class="ruby-keyword kw">when</span> <span class="ruby-regexp re">/[\n\r]/</span>
115:                     <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@heredocs</span>.<span class="ruby-identifier">empty?</span>
116:                       <span class="ruby-identifier">scan_heredoc</span>(<span class="ruby-operator">*</span><span class="ruby-ivar">@heredocs</span>.<span class="ruby-identifier">shift</span>)
117:                     <span class="ruby-keyword kw">else</span>
118:                       <span class="ruby-identifier">start_group</span> <span class="ruby-identifier">:normal</span>, <span class="ruby-identifier">scan</span>( <span class="ruby-regexp re">/\s+/</span> )
119:                     <span class="ruby-keyword kw">end</span>
120:                     <span class="ruby-ivar">@allow_operator</span> = <span class="ruby-keyword kw">false</span>
121:                   <span class="ruby-keyword kw">when</span> <span class="ruby-regexp re">/\s/</span>
122:                     <span class="ruby-identifier">start_group</span> <span class="ruby-identifier">:normal</span>, <span class="ruby-identifier">scan</span>( <span class="ruby-regexp re">/\s+/</span> )
123:                   <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;#&quot;</span>
124:                     <span class="ruby-identifier">start_group</span> <span class="ruby-identifier">:comment</span>, <span class="ruby-identifier">scan</span>( <span class="ruby-regexp re">/#[^\n\r]*/</span> )
125:                   <span class="ruby-keyword kw">when</span> <span class="ruby-regexp re">/[A-Z]/</span>
126:                     <span class="ruby-identifier">start_group</span> <span class="ruby-ivar">@selector</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">:ident</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">:constant</span>, <span class="ruby-identifier">scan</span>( <span class="ruby-regexp re">/\w+/</span> )
127:                     <span class="ruby-ivar">@allow_operator</span> = <span class="ruby-keyword kw">true</span>
128:                   <span class="ruby-keyword kw">when</span> <span class="ruby-regexp re">/[a-z_]/</span>
129:                     <span class="ruby-identifier">word</span> = <span class="ruby-identifier">scan</span>( <span class="ruby-regexp re">/\w+[?!]?/</span> )
130:                     <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@selector</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-constant">KEYWORDS</span>.<span class="ruby-identifier">include?</span>( <span class="ruby-identifier">word</span> )
131:                       <span class="ruby-identifier">start_group</span> <span class="ruby-identifier">:keyword</span>, <span class="ruby-identifier">word</span>
132:                       <span class="ruby-ivar">@allow_operator</span> = <span class="ruby-keyword kw">false</span>
133:                     <span class="ruby-keyword kw">elsif</span>
134:                       <span class="ruby-identifier">start_group</span> <span class="ruby-identifier">:ident</span>, <span class="ruby-identifier">word</span>
135:                       <span class="ruby-ivar">@allow_operator</span> = <span class="ruby-keyword kw">true</span>
136:                     <span class="ruby-keyword kw">end</span>
137:                     <span class="ruby-ivar">@selector</span> = <span class="ruby-keyword kw">false</span>
138:                   <span class="ruby-keyword kw">when</span> <span class="ruby-regexp re">/\d/</span>
139:                     <span class="ruby-identifier">start_group</span> <span class="ruby-identifier">:number</span>,
140:                       <span class="ruby-identifier">scan</span>( <span class="ruby-regexp re">/[\d_]+(\.[\d_]+)?([eE][\d_]+)?/</span> )
141:                     <span class="ruby-ivar">@allow_operator</span> = <span class="ruby-keyword kw">true</span>
142:                   <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'&quot;'</span>
143:                     <span class="ruby-identifier">scan_delimited_region</span> <span class="ruby-identifier">:punct</span>, <span class="ruby-identifier">:string</span>, <span class="ruby-value str">&quot;&quot;</span>, <span class="ruby-keyword kw">true</span>
144:                     <span class="ruby-ivar">@allow_operator</span> = <span class="ruby-keyword kw">true</span>
145:                   <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'/'</span>
146:                     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@allow_operator</span>
147:                       <span class="ruby-identifier">start_group</span> <span class="ruby-identifier">:punct</span>, <span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">%r{/}</span>)
148:                       <span class="ruby-ivar">@allow_operator</span> = <span class="ruby-keyword kw">false</span>
149:                     <span class="ruby-keyword kw">else</span>
150:                       <span class="ruby-identifier">scan_delimited_region</span> <span class="ruby-identifier">:punct</span>, <span class="ruby-identifier">:regex</span>, <span class="ruby-value str">&quot;&quot;</span>, <span class="ruby-keyword kw">true</span>
151:                       <span class="ruby-ivar">@allow_operator</span> = <span class="ruby-keyword kw">true</span>
152:                     <span class="ruby-keyword kw">end</span>
153:                   <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;'&quot;</span>
154:                     <span class="ruby-identifier">scan_delimited_region</span> <span class="ruby-identifier">:punct</span>, <span class="ruby-identifier">:string</span>, <span class="ruby-value str">&quot;&quot;</span>, <span class="ruby-keyword kw">false</span>
155:                     <span class="ruby-ivar">@allow_operator</span> = <span class="ruby-keyword kw">true</span>
156:                   <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;.&quot;</span>
157:                     <span class="ruby-identifier">dots</span> = <span class="ruby-identifier">scan</span>( <span class="ruby-regexp re">/\.{1,3}/</span> )
158:                     <span class="ruby-identifier">start_group</span> <span class="ruby-identifier">:punct</span>, <span class="ruby-identifier">dots</span>
159:                     <span class="ruby-ivar">@selector</span> = ( <span class="ruby-identifier">dots</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span> )
160:                   <span class="ruby-keyword kw">when</span> <span class="ruby-regexp re">/[@]/</span>
161:                     <span class="ruby-identifier">start_group</span> <span class="ruby-identifier">:attribute</span>, <span class="ruby-identifier">scan</span>( <span class="ruby-regexp re">/@{1,2}\w*/</span> )
162:                     <span class="ruby-ivar">@allow_operator</span> = <span class="ruby-keyword kw">true</span>
163:                   <span class="ruby-keyword kw">when</span> <span class="ruby-regexp re">/[$]/</span>
164:                     <span class="ruby-identifier">start_group</span> <span class="ruby-identifier">:global</span>, <span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\$/</span>)
165:                     <span class="ruby-identifier">start_group</span> <span class="ruby-identifier">:global</span>, <span class="ruby-identifier">scan</span>( <span class="ruby-regexp re">/\w+|./</span> ) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">check</span>(<span class="ruby-regexp re">/./</span>)
166:                     <span class="ruby-ivar">@allow_operator</span> = <span class="ruby-keyword kw">true</span>
167:                   <span class="ruby-keyword kw">when</span> <span class="ruby-regexp re">/[-!?*\/+=&lt;&gt;(\[\{}:;,&amp;|%]/</span>
168:                     <span class="ruby-identifier">start_group</span> <span class="ruby-identifier">:punct</span>, <span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/./</span>)
169:                     <span class="ruby-ivar">@allow_operator</span> = <span class="ruby-keyword kw">false</span>
170:                   <span class="ruby-keyword kw">when</span> <span class="ruby-regexp re">/[)\]]/</span>
171:                     <span class="ruby-identifier">start_group</span> <span class="ruby-identifier">:punct</span>, <span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/./</span>)
172:                     <span class="ruby-ivar">@allow_operator</span> = <span class="ruby-keyword kw">true</span>
173:                   <span class="ruby-keyword kw">else</span>
174:                     <span class="ruby-comment cmt"># all else just falls through this, to prevent</span>
175:                     <span class="ruby-comment cmt"># infinite loops...</span>
176:                     <span class="ruby-identifier">append</span> <span class="ruby-identifier">getch</span>
177:                 <span class="ruby-keyword kw">end</span>
178:             <span class="ruby-keyword kw">end</span>
179:         <span class="ruby-keyword kw">end</span>
180:       <span class="ruby-keyword kw">end</span>
181:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Private methods</div>
            
            <div class="method">
                <div class="title" id="M000027">
                    
                    <a name="M000027"></a><b>scan_delimited_region</b>( delim_group, inner_group, starter, exprs, delim=nil, heredoc=false )
                    
                </div>
                
                <div class="description">
                  <p>
Scan a delimited region of text. This handles the simple cases (strings
delimited with quotes) as well as the more complex cases of %-strings and
here-documents.
</p>
<ul>
<li><tt>delim_group</tt> is the group to use to classify the delimiters of the
region

</li>
<li><tt>inner_group</tt> is the group to use to classify the contents of the
region

</li>
<li><tt>starter</tt> is the text to use as the starting delimiter

</li>
<li><tt>exprs</tt> is a boolean flag indicating whether the region is an
interpolated string or not

</li>
<li><tt>delim</tt> is the text to use as the delimiter of the region. If
<tt>nil</tt>, the next character will be treated as the delimiter.

</li>
<li><tt>heredoc</tt> is either <tt>false</tt>, meaning the region is not a
heredoc, or <tt>:flush</tt> (meaning the delimiter must be flushed left),
or <tt>:float</tt> (meaning the delimiter doens&#8217;t have to be flush
left).

</li>
</ul>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000027_source')" id="l_M000027_source">show</a>
                        
                    </p>
                    <div id="M000027_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/syntax/lang/ruby.rb, line 201</span>
201:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">scan_delimited_region</span>( <span class="ruby-identifier">delim_group</span>, <span class="ruby-identifier">inner_group</span>, <span class="ruby-identifier">starter</span>, <span class="ruby-identifier">exprs</span>,
202:         <span class="ruby-identifier">delim</span>=<span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">heredoc</span>=<span class="ruby-keyword kw">false</span> )
203:       <span class="ruby-comment cmt"># begin</span>
204:         <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">delim</span>
205:           <span class="ruby-identifier">start_group</span> <span class="ruby-identifier">delim_group</span>, <span class="ruby-identifier">starter</span>
206:           <span class="ruby-identifier">delim</span> = <span class="ruby-identifier">scan</span>( <span class="ruby-regexp re">/./</span> )
207:           <span class="ruby-identifier">append</span> <span class="ruby-identifier">delim</span>
208: 
209:           <span class="ruby-identifier">delim</span> = <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">delim</span>
210:             <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'{'</span> <span class="ruby-keyword kw">then</span> <span class="ruby-value str">'}'</span>
211:             <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'('</span> <span class="ruby-keyword kw">then</span> <span class="ruby-value str">')'</span>
212:             <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'['</span> <span class="ruby-keyword kw">then</span> <span class="ruby-value str">']'</span>
213:             <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'&lt;'</span> <span class="ruby-keyword kw">then</span> <span class="ruby-value str">'&gt;'</span>
214:             <span class="ruby-keyword kw">else</span> <span class="ruby-identifier">delim</span>
215:           <span class="ruby-keyword kw">end</span>
216:         <span class="ruby-keyword kw">end</span>
217: 
218:         <span class="ruby-identifier">start_region</span> <span class="ruby-identifier">inner_group</span>
219: 
220:         <span class="ruby-identifier">items</span> = <span class="ruby-value str">&quot;\\\\|&quot;</span>
221:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">heredoc</span>
222:           <span class="ruby-identifier">items</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;(^&quot;</span>
223:           <span class="ruby-identifier">items</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">'\s*'</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">heredoc</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:float</span>
224:           <span class="ruby-identifier">items</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;#{Regexp.escape(delim)}\s*?)#{EOL}&quot;</span>
225:         <span class="ruby-keyword kw">else</span>
226:           <span class="ruby-identifier">items</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;#{Regexp.escape(delim)}&quot;</span>
227:         <span class="ruby-keyword kw">end</span>
228:         <span class="ruby-identifier">items</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;|#(\\$|@@?|\\{)&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">exprs</span>
229:         <span class="ruby-identifier">items</span> = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>( <span class="ruby-identifier">items</span> )
230: 
231:         <span class="ruby-identifier">loop</span> <span class="ruby-keyword kw">do</span>
232:           <span class="ruby-identifier">p</span> = <span class="ruby-identifier">pos</span>
233:           <span class="ruby-identifier">match</span> = <span class="ruby-identifier">scan_until</span>( <span class="ruby-identifier">items</span> )
234:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">match</span>.<span class="ruby-identifier">nil?</span>
235:             <span class="ruby-identifier">start_group</span> <span class="ruby-identifier">inner_group</span>, <span class="ruby-identifier">scan_until</span>( <span class="ruby-regexp re">/\Z/</span> )
236:             <span class="ruby-keyword kw">break</span>
237:           <span class="ruby-keyword kw">else</span>
238:             <span class="ruby-identifier">text</span> = <span class="ruby-identifier">pre_match</span>[<span class="ruby-identifier">p</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>]
239:             <span class="ruby-identifier">start_group</span> <span class="ruby-identifier">inner_group</span>, <span class="ruby-identifier">text</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">text</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
240:             <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">matched</span>.<span class="ruby-identifier">strip</span>
241:               <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;\\&quot;</span>
242:                 <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">exprs</span>
243:                   <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">peek</span>(<span class="ruby-value">1</span>)
244:                     <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;'&quot;</span>
245:                       <span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/./</span>)
246:                       <span class="ruby-identifier">start_group</span> <span class="ruby-identifier">:escape</span>, <span class="ruby-value str">&quot;\\'&quot;</span>
247:                     <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;\\&quot;</span>
248:                       <span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/./</span>)
249:                       <span class="ruby-identifier">start_group</span> <span class="ruby-identifier">:escape</span>, <span class="ruby-value str">&quot;\\\\&quot;</span>
250:                     <span class="ruby-keyword kw">else</span>
251:                       <span class="ruby-identifier">start_group</span> <span class="ruby-identifier">inner_group</span>, <span class="ruby-value str">&quot;\\&quot;</span>
252:                   <span class="ruby-keyword kw">end</span>
253:                 <span class="ruby-keyword kw">else</span>
254:                   <span class="ruby-identifier">start_group</span> <span class="ruby-identifier">:escape</span>, <span class="ruby-value str">&quot;\\&quot;</span>
255:                   <span class="ruby-identifier">c</span> = <span class="ruby-identifier">getch</span>
256:                   <span class="ruby-identifier">append</span> <span class="ruby-identifier">c</span>
257:                   <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">c</span>
258:                     <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'x'</span>
259:                       <span class="ruby-identifier">append</span> <span class="ruby-identifier">scan</span>( <span class="ruby-regexp re">/[a-fA-F0-9]{1,2}/</span> )
260:                     <span class="ruby-keyword kw">when</span> <span class="ruby-regexp re">/[0-7]/</span>
261:                       <span class="ruby-identifier">append</span> <span class="ruby-identifier">scan</span>( <span class="ruby-regexp re">/[0-7]{0,2}/</span> )
262:                   <span class="ruby-keyword kw">end</span>
263:                 <span class="ruby-keyword kw">end</span>
264:               <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">delim</span>
265:                 <span class="ruby-identifier">end_region</span> <span class="ruby-identifier">inner_group</span>
266:                 <span class="ruby-identifier">start_group</span> <span class="ruby-identifier">delim_group</span>, <span class="ruby-identifier">matched</span>
267:                 <span class="ruby-keyword kw">break</span>
268:               <span class="ruby-keyword kw">when</span> <span class="ruby-regexp re">/^#/</span>
269:                 <span class="ruby-identifier">do_highlight</span> = (<span class="ruby-identifier">option</span>(<span class="ruby-identifier">:expressions</span>) <span class="ruby-operator">==</span> <span class="ruby-identifier">:highlight</span>)
270:                 <span class="ruby-identifier">start_region</span> <span class="ruby-identifier">:expr</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">do_highlight</span>
271:                 <span class="ruby-identifier">start_group</span> <span class="ruby-identifier">:expr</span>, <span class="ruby-identifier">matched</span>
272:                 <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">matched</span>[<span class="ruby-value">1</span>]
273:                   <span class="ruby-keyword kw">when</span> <span class="ruby-value">?{</span>
274:                     <span class="ruby-identifier">depth</span> = <span class="ruby-value">1</span>
275:                     <span class="ruby-identifier">content</span> = <span class="ruby-value str">&quot;&quot;</span>
276:                     <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">depth</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
277:                       <span class="ruby-identifier">p</span> = <span class="ruby-identifier">pos</span>
278:                       <span class="ruby-identifier">c</span> = <span class="ruby-identifier">scan_until</span>( <span class="ruby-regexp re">/[\{}]/</span> )
279:                       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">nil?</span>
280:                         <span class="ruby-identifier">content</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">scan_until</span>( <span class="ruby-regexp re">/\Z/</span> )
281:                         <span class="ruby-keyword kw">break</span>
282:                       <span class="ruby-keyword kw">else</span>
283:                         <span class="ruby-identifier">depth</span> <span class="ruby-operator">+=</span> ( <span class="ruby-identifier">matched</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;{&quot;</span> <span class="ruby-operator">?</span> <span class="ruby-value">1</span> <span class="ruby-operator">:</span> <span class="ruby-value">-1</span> )
284:                         <span class="ruby-identifier">content</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">pre_match</span>[<span class="ruby-identifier">p</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>]
285:                         <span class="ruby-identifier">content</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">matched</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">depth</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
286:                       <span class="ruby-keyword kw">end</span>
287:                     <span class="ruby-keyword kw">end</span>
288:                     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">do_highlight</span>
289:                       <span class="ruby-identifier">subtokenize</span> <span class="ruby-value str">&quot;ruby&quot;</span>, <span class="ruby-identifier">content</span>
290:                       <span class="ruby-identifier">start_group</span> <span class="ruby-identifier">:expr</span>, <span class="ruby-value str">&quot;}&quot;</span>
291:                     <span class="ruby-keyword kw">else</span>
292:                       <span class="ruby-identifier">append</span> <span class="ruby-identifier">content</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;}&quot;</span>
293:                     <span class="ruby-keyword kw">end</span>
294:                   <span class="ruby-keyword kw">when</span> <span class="ruby-value">?$</span>, <span class="ruby-value">?@</span>
295:                     <span class="ruby-identifier">append</span> <span class="ruby-identifier">scan</span>( <span class="ruby-regexp re">/\w+/</span> )
296:                 <span class="ruby-keyword kw">end</span>
297:                 <span class="ruby-identifier">end_region</span> <span class="ruby-identifier">:expr</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">do_highlight</span>
298:               <span class="ruby-keyword kw">else</span> <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;unexpected match on #{matched}&quot;</span>
299:             <span class="ruby-keyword kw">end</span>
300:           <span class="ruby-keyword kw">end</span>
301:         <span class="ruby-keyword kw">end</span>
302:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000029">
                    
                    <a name="M000029"></a><b>scan_heredoc</b>(float, type, delim)
                    
                </div>
                
                <div class="description">
                  <p>
Scan a heredoc beginning at the current position.
</p>
<ul>
<li><tt>float</tt> indicates whether the delimiter may be floated to the right

</li>
<li><tt>type</tt> is <tt>nil</tt>, a single quote, or a double quote

</li>
<li><tt>delim</tt> is the delimiter to look for

</li>
</ul>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000029_source')" id="l_M000029_source">show</a>
                        
                    </p>
                    <div id="M000029_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/syntax/lang/ruby.rb, line 309</span>
309:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">scan_heredoc</span>(<span class="ruby-identifier">float</span>, <span class="ruby-identifier">type</span>, <span class="ruby-identifier">delim</span>)
310:         <span class="ruby-identifier">scan_delimited_region</span>( <span class="ruby-identifier">:constant</span>, <span class="ruby-identifier">:string</span>, <span class="ruby-value str">&quot;&quot;</span>, <span class="ruby-identifier">type</span> <span class="ruby-operator">!=</span> <span class="ruby-value str">&quot;'&quot;</span>,
311:           <span class="ruby-identifier">delim</span>, <span class="ruby-identifier">float</span> <span class="ruby-value">? </span><span class="ruby-operator">:</span><span class="ruby-identifier">float</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">:flush</span> )
312:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    