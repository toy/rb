<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>Mp3Info</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen" />
    <script src="../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Class</span> 
            Mp3Info 
            
                <span class="parent">&lt; 
                    
                    Object
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../files/lib/mp3info/extension_modules_rb.html">lib/mp3info/extension_modules.rb</a></li>
            
            <li><a href="../files/lib/mp3info_rb.html">lib/mp3info.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    
    <div class="description">
        <p>
coding:utf-8
</p>
<table>
<tr><td valign="top">License:</td><td>Ruby

</td></tr>
<tr><td valign="top">Author:</td><td>Guillaume Pierronnet (<a
href="mailto:moumar_AT__rubyforge_DOT_org">moumar_AT__rubyforge_DOT_org</a>)

</td></tr>
<tr><td valign="top">Website:</td><td><a
href="http://ruby-mp3info.rubyforge.org/">ruby-mp3info.rubyforge.org/</a>

</td></tr>
</table>

    </div>
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>A</dt>
        <dd>
            <ul>
                
                <li><a href="#M000027">audio_content</a></li>
                
            </ul>
        </dd>
    
        <dt>B</dt>
        <dd>
            <ul>
                
                <li><a href="#M000039">bits</a></li>
                
            </ul>
        </dd>
    
        <dt>C</dt>
        <dd>
            <ul>
                
                <li><a href="#M000029">close</a></li>
                
            </ul>
        </dd>
    
        <dt>E</dt>
        <dd>
            <ul>
                
                <li><a href="#M000032">each_frame</a></li>
                
            </ul>
        </dd>
    
        <dt>F</dt>
        <dd>
            <ul>
                
                <li><a href="#M000036">find_next_frame</a>,</li>
                
                <li><a href="#M000030">flush</a>,</li>
                
                <li><a href="#M000028">frame_length</a>,</li>
                
                <li><a href="#M000037">frame_scan</a></li>
                
            </ul>
        </dd>
    
        <dt>G</dt>
        <dd>
            <ul>
                
                <li><a href="#M000033">get_frames_infos</a>,</li>
                
                <li><a href="#M000035">gettag1</a></li>
                
            </ul>
        </dd>
    
        <dt>H</dt>
        <dd>
            <ul>
                
                <li><a href="#M000024">hastag1?</a>,</li>
                
                <li><a href="#M000008">hastag1?</a>,</li>
                
                <li><a href="#M000025">hastag2?</a>,</li>
                
                <li><a href="#M000009">hastag2?</a>,</li>
                
                <li><a href="#M000023">hastag?</a></li>
                
            </ul>
        </dd>
    
        <dt>N</dt>
        <dd>
            <ul>
                
                <li><a href="#M000014">new</a></li>
                
            </ul>
        </dd>
    
        <dt>O</dt>
        <dd>
            <ul>
                
                <li><a href="#M000019">open</a></li>
                
            </ul>
        </dd>
    
        <dt>P</dt>
        <dd>
            <ul>
                
                <li><a href="#M000038">parse_mp3</a>,</li>
                
                <li><a href="#M000034">parse_tags</a></li>
                
            </ul>
        </dd>
    
        <dt>R</dt>
        <dd>
            <ul>
                
                <li><a href="#M000015">reload</a>,</li>
                
                <li><a href="#M000020">removetag1</a>,</li>
                
                <li><a href="#M000011">removetag1</a>,</li>
                
                <li><a href="#M000022">removetag2</a>,</li>
                
                <li><a href="#M000012">removetag2</a>,</li>
                
                <li><a href="#M000026">rename</a></li>
                
            </ul>
        </dd>
    
        <dt>T</dt>
        <dd>
            <ul>
                
                <li><a href="#M000031">to_s</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    

    

    
    <div class="sectiontitle">Classes and Modules</div>
    <ul>
        
        <li><span class="type">MODULE</span> <a href="Mp3Info/HashKeys.html">Mp3Info::HashKeys</a></li>
        
        <li><span class="type">MODULE</span> <a href="Mp3Info/Mp3FileMethods.html">Mp3Info::Mp3FileMethods</a></li>
        
    </ul>
    

    
    <div class="sectiontitle">Constants</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class="attr-name">VERSION</td>
            <td>=</td>
            <td class="attr-value">&quot;0.6.16&quot;</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">LAYER</td>
            <td>=</td>
            <td class="attr-value">[ nil, 3, 2, 1]</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">BITRATE</td>
            <td>=</td>
            <td class="attr-value">{     1 =&gt;     [       [32, 64, 96, 128, 160, 192, 224, 256, 288, 320, 352, 384, 416, 448],       [32, 48, 56, 64, 80, 96, 112, 128, 160, 192, 224, 256, 320, 384],       [32, 40, 48, 56, 64, 80, 96, 112, 128, 160, 192, 224, 256, 320] ],     2 =&gt;     [       [32, 48, 56, 64, 80, 96, 112, 128, 144, 160, 176, 192, 224, 256],       [8, 16, 24, 32, 40, 48, 56, 64, 80, 96, 112, 128, 144, 160],       [8, 16, 24, 32, 40, 48, 56, 64, 80, 96, 112, 128, 144, 160]     ],     2.5 =&gt;     [       [32, 48, 56, 64, 80, 96, 112, 128, 144, 160, 176, 192, 224, 256],       [8, 16, 24, 32, 40, 48, 56, 64, 80, 96, 112, 128, 144, 160],       [8, 16, 24, 32, 40, 48, 56, 64, 80, 96, 112, 128, 144, 160]     ]   }</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">SAMPLERATE</td>
            <td>=</td>
            <td class="attr-value">{     1 =&gt; [ 44100, 48000, 32000 ],     2 =&gt; [ 22050, 24000, 16000 ],     2.5 =&gt; [ 11025, 12000, 8000 ]   }</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">CHANNEL_MODE</td>
            <td>=</td>
            <td class="attr-value">[ &quot;Stereo&quot;, &quot;JStereo&quot;, &quot;Dual Channel&quot;, &quot;Single Channel&quot;]</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">GENRES</td>
            <td>=</td>
            <td class="attr-value">[     &quot;Blues&quot;, &quot;Classic Rock&quot;, &quot;Country&quot;, &quot;Dance&quot;, &quot;Disco&quot;, &quot;Funk&quot;,     &quot;Grunge&quot;, &quot;Hip-Hop&quot;, &quot;Jazz&quot;, &quot;Metal&quot;, &quot;New Age&quot;, &quot;Oldies&quot;,     &quot;Other&quot;, &quot;Pop&quot;, &quot;R&amp;B&quot;, &quot;Rap&quot;, &quot;Reggae&quot;, &quot;Rock&quot;,     &quot;Techno&quot;, &quot;Industrial&quot;, &quot;Alternative&quot;, &quot;Ska&quot;, &quot;Death Metal&quot;, &quot;Pranks&quot;,     &quot;Soundtrack&quot;, &quot;Euro-Techno&quot;, &quot;Ambient&quot;, &quot;Trip-Hop&quot;, &quot;Vocal&quot;, &quot;Jazz+Funk&quot;,     &quot;Fusion&quot;, &quot;Trance&quot;, &quot;Classical&quot;, &quot;Instrumental&quot;, &quot;Acid&quot;, &quot;House&quot;,     &quot;Game&quot;, &quot;Sound Clip&quot;, &quot;Gospel&quot;, &quot;Noise&quot;, &quot;AlternRock&quot;, &quot;Bass&quot;,     &quot;Soul&quot;, &quot;Punk&quot;, &quot;Space&quot;, &quot;Meditative&quot;, &quot;Instrumental Pop&quot;, &quot;Instrumental Rock&quot;,     &quot;Ethnic&quot;, &quot;Gothic&quot;, &quot;Darkwave&quot;, &quot;Techno-Industrial&quot;, &quot;Electronic&quot;, &quot;Pop-Folk&quot;,     &quot;Eurodance&quot;, &quot;Dream&quot;, &quot;Southern Rock&quot;, &quot;Comedy&quot;, &quot;Cult&quot;, &quot;Gangsta&quot;,     &quot;Top 40&quot;, &quot;Christian Rap&quot;, &quot;Pop/Funk&quot;, &quot;Jungle&quot;, &quot;Native American&quot;, &quot;Cabaret&quot;,     &quot;New Wave&quot;, &quot;Psychadelic&quot;, &quot;Rave&quot;, &quot;Showtunes&quot;, &quot;Trailer&quot;, &quot;Lo-Fi&quot;,     &quot;Tribal&quot;, &quot;Acid Punk&quot;, &quot;Acid Jazz&quot;, &quot;Polka&quot;, &quot;Retro&quot;, &quot;Musical&quot;,     &quot;Rock &amp; Roll&quot;, &quot;Hard Rock&quot;, &quot;Folk&quot;, &quot;Folk/Rock&quot;, &quot;National Folk&quot;, &quot;Swing&quot;,     &quot;Fast-Fusion&quot;, &quot;Bebob&quot;, &quot;Latin&quot;, &quot;Revival&quot;, &quot;Celtic&quot;, &quot;Bluegrass&quot;, &quot;Avantgarde&quot;,     &quot;Gothic Rock&quot;, &quot;Progressive Rock&quot;, &quot;Psychedelic Rock&quot;, &quot;Symphonic Rock&quot;, &quot;Slow Rock&quot;, &quot;Big Band&quot;,     &quot;Chorus&quot;, &quot;Easy Listening&quot;, &quot;Acoustic&quot;, &quot;Humour&quot;, &quot;Speech&quot;, &quot;Chanson&quot;,     &quot;Opera&quot;, &quot;Chamber Music&quot;, &quot;Sonata&quot;, &quot;Symphony&quot;, &quot;Booty Bass&quot;, &quot;Primus&quot;,     &quot;Porn Groove&quot;, &quot;Satire&quot;, &quot;Slow Jam&quot;, &quot;Club&quot;, &quot;Tango&quot;, &quot;Samba&quot;,     &quot;Folklore&quot;, &quot;Ballad&quot;, &quot;Power Ballad&quot;, &quot;Rhythmic Soul&quot;, &quot;Freestyle&quot;, &quot;Duet&quot;,     &quot;Punk Rock&quot;, &quot;Drum Solo&quot;, &quot;A capella&quot;, &quot;Euro-House&quot;, &quot;Dance Hall&quot;,     &quot;Goa&quot;, &quot;Drum &amp; Bass&quot;, &quot;Club House&quot;, &quot;Hardcore&quot;, &quot;Terror&quot;,     &quot;Indie&quot;, &quot;BritPop&quot;, &quot;NegerPunk&quot;, &quot;Polsk Punk&quot;, &quot;Beat&quot;,     &quot;Christian Gangsta&quot;, &quot;Heavy Metal&quot;, &quot;Black Metal&quot;, &quot;Crossover&quot;, &quot;Contemporary C&quot;,     &quot;Christian Rock&quot;, &quot;Merengue&quot;, &quot;Salsa&quot;, &quot;Thrash Metal&quot;, &quot;Anime&quot;, &quot;JPop&quot;,     &quot;SynthPop&quot; ]</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">TAG1_SIZE</td>
            <td>=</td>
            <td class="attr-value">128</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">TAG_MAPPING_2_2</td>
            <td>=</td>
            <td class="attr-value">{     &quot;title&quot;    =&gt; &quot;TT2&quot;,     &quot;artist&quot;   =&gt; &quot;TP1&quot;,     &quot;album&quot;    =&gt; &quot;TAL&quot;,     &quot;year&quot;     =&gt; &quot;TYE&quot;,     &quot;tracknum&quot; =&gt; &quot;TRK&quot;,     &quot;comments&quot; =&gt; &quot;COM&quot;,     &quot;genre_s&quot;  =&gt; &quot;TCO&quot;   }</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
map to fill the &#8220;universal&#8221; tag (<a
href="Mp3Info.html#tag">tag</a> attribute) for id3v2.2
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">TAG_MAPPING_2_3</td>
            <td>=</td>
            <td class="attr-value">{     &quot;title&quot;    =&gt; &quot;TIT2&quot;,     &quot;artist&quot;   =&gt; &quot;TPE1&quot;,     &quot;album&quot;    =&gt; &quot;TALB&quot;,     &quot;year&quot;     =&gt; &quot;TYER&quot;,     &quot;tracknum&quot; =&gt; &quot;TRCK&quot;,     &quot;comments&quot; =&gt; &quot;COMM&quot;,     &quot;genre_s&quot;  =&gt; &quot;TCON&quot;   }</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
for id3v2.3 and 2.4
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">SAMPLES_PER_FRAME</td>
            <td>=</td>
            <td class="attr-value">[     nil,     {1=&gt;384, 2=&gt;384, 2.5=&gt;384},    # Layer I     {1=&gt;1152, 2=&gt;1152, 2.5=&gt;1152}, # Layer II     {1=&gt;1152, 2=&gt;576, 2.5=&gt;576}    # Layer III   ]</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
<a
href="http://www.codeproject.com/audio/MPEGAudioInfo.asp">www.codeproject.com/audio/MPEGAudioInfo.asp</a>
</p>
</td>
        </tr>
        
        
    </table>
    

    
    <div class="sectiontitle">Attributes</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>mpeg_version</td>
            <td class='attr-desc'><p>
mpeg version = 1 or 2
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>layer</td>
            <td class='attr-desc'><p>
layer = 1, 2, or 3
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>bitrate</td>
            <td class='attr-desc'><p>
bitrate in kbps
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>samplerate</td>
            <td class='attr-desc'><p>
samplerate in Hz
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>channel_mode</td>
            <td class='attr-desc'><p>
channel mode => &#8220;Stereo&#8221;, &#8220;JStereo&#8221;, &#8220;Dual
Channel&#8221; or &#8220;Single Channel&#8220;
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>vbr</td>
            <td class='attr-desc'><p>
variable bitrate => true or false
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>header</td>
            <td class='attr-desc'><p>
Hash representing values in the MP3 frame header. Keys are one of the
following:
</p>
<ul>
<li>:private (boolean)

</li>
<li>:copyright (boolean)

</li>
<li>:original (boolean)

</li>
<li>:padding (boolean)

</li>
<li>:<a href="Mp3Info.html#error_protection">error_protection</a> (boolean)

</li>
<li>:mode_extension (integer in the 0..3 range)

</li>
<li>:emphasis (integer in the 0..3 range)

</li>
</ul>
<p>
detailled explanation can be found here: <a
href="http://www.mp3-tech.org/programmer/frame_header.html">www.mp3-tech.org/programmer/frame_header.html</a>
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>length</td>
            <td class='attr-desc'><p>
length in seconds as a Float
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>error_protection</td>
            <td class='attr-desc'><p>
error protection => true or false
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>tag</td>
            <td class='attr-desc'><p>
a sort of &#8220;universal&#8221; tag, regardless of the tag version, 1 or
2, with the same keys as @tag1 this tag has priority over @tag1 and @tag2
when writing the tag with <a href="Mp3Info.html#M000029">close</a>
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>tag1</td>
            <td class='attr-desc'><p>
id3v1 tag as a Hash. You can modify it, it will be written when calling
&#8220;close&#8221; method.
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>tag2</td>
            <td class='attr-desc'><p>
id3v2 tag attribute as an <a href="ID3v2.html">ID3v2</a> object. You can
modify it, it will be written when calling &#8220;close&#8221; method.
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>filename</td>
            <td class='attr-desc'><p>
the original filename unless used with a StringIO
</p></td>
        </tr>
        
    </table>
    

    
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M000027">
                    
                    <a name="M000027"></a><b>audio_content</b>()
                    
                </div>
                
                <div class="description">
                  <p>
this method returns the &#8220;audio-only&#8221; data boundaries of the
file, i.e. content stripped form tags. Useful to compare 2 files with the
same audio content but with differents tags. Returned value is an array
[position_in_the_file, length_of_the_data]
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000027_source')" id="l_M000027_source">show</a>
                        
                    </p>
                    <div id="M000027_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/mp3info.rb, line 353</span>
353:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">audio_content</span>
354:     <span class="ruby-identifier">pos</span> = <span class="ruby-value">0</span>
355:     <span class="ruby-identifier">length</span> = <span class="ruby-ivar">@io_size</span>
356:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">hastag1?</span>
357:       <span class="ruby-identifier">length</span> <span class="ruby-operator">-=</span> <span class="ruby-constant">TAG1_SIZE</span>
358:     <span class="ruby-keyword kw">end</span>
359:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">hastag2?</span>
360:       <span class="ruby-identifier">pos</span> = <span class="ruby-ivar">@tag2</span>.<span class="ruby-identifier">io_position</span>
361:       <span class="ruby-identifier">length</span> <span class="ruby-operator">-=</span> <span class="ruby-ivar">@tag2</span>.<span class="ruby-identifier">io_position</span>
362:     <span class="ruby-keyword kw">end</span>
363:     [<span class="ruby-identifier">pos</span>, <span class="ruby-identifier">length</span>]
364:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000029">
                    
                    <a name="M000029"></a><b>close</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Flush pending modifications to tags and close the file not used when source
IO is a StringIO
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000029_source')" id="l_M000029_source">show</a>
                        
                    </p>
                    <div id="M000029_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/mp3info.rb, line 373</span>
373:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">close</span>
374:     <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;close&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">$DEBUG</span>
375:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@io_is_a_file</span>
376:     <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@tag_parsing_enabled</span>
377:       <span class="ruby-keyword kw">return</span>
378:     <span class="ruby-keyword kw">end</span>
379:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@tag</span> <span class="ruby-operator">!=</span> <span class="ruby-ivar">@tag_orig</span>
380:       <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;@tag has changed&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">$DEBUG</span>
381: 
382:       <span class="ruby-comment cmt"># @tag1 has precedence over @tag</span>
383:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@tag1</span> <span class="ruby-operator">==</span> <span class="ruby-ivar">@tag1_orig</span>
384:         <span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
385:           <span class="ruby-ivar">@tag1</span>[<span class="ruby-identifier">k</span>] = <span class="ruby-identifier">v</span>
386:         <span class="ruby-keyword kw">end</span>
387:       <span class="ruby-keyword kw">end</span>
388: 
389:       <span class="ruby-comment cmt"># ruby-mp3info can only write v2.3 tags</span>
390:       <span class="ruby-constant">TAG_MAPPING_2_3</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">tag2_name</span><span class="ruby-operator">|</span>
391:         <span class="ruby-ivar">@tag2</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-constant">TAG_MAPPING_2_2</span>[<span class="ruby-identifier">key</span>])
392:         <span class="ruby-ivar">@tag2</span>[<span class="ruby-identifier">tag2_name</span>] = <span class="ruby-ivar">@tag</span>[<span class="ruby-identifier">key</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@tag</span>[<span class="ruby-identifier">key</span>]
393:       <span class="ruby-keyword kw">end</span>
394:     <span class="ruby-keyword kw">end</span>
395: 
396:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@tag1</span> <span class="ruby-operator">!=</span> <span class="ruby-ivar">@tag1_orig</span>
397:       <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;@tag1 has changed&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">$DEBUG</span>
398:       <span class="ruby-identifier">raise</span>(<span class="ruby-constant">Mp3InfoError</span>, <span class="ruby-value str">&quot;file is not writable&quot;</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">writable?</span>(<span class="ruby-ivar">@filename_or_io</span>)
399:       <span class="ruby-comment cmt">#@tag1_orig.update(@tag1)</span>
400:       <span class="ruby-ivar">@tag1_orig</span> = <span class="ruby-ivar">@tag1</span>.<span class="ruby-identifier">dup</span>
401:       <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-ivar">@filename_or_io</span>, <span class="ruby-value str">'rb+'</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span>
402:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@tag1_orig</span>.<span class="ruby-identifier">empty?</span>
403:           <span class="ruby-identifier">newsize</span> = <span class="ruby-ivar">@io_size</span> <span class="ruby-operator">-</span> <span class="ruby-constant">TAG1_SIZE</span>
404:           <span class="ruby-identifier">file</span>.<span class="ruby-identifier">truncate</span>(<span class="ruby-identifier">newsize</span>)
405:         <span class="ruby-keyword kw">else</span>
406:           <span class="ruby-identifier">file</span>.<span class="ruby-identifier">seek</span>(<span class="ruby-operator">-</span><span class="ruby-constant">TAG1_SIZE</span>, <span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">SEEK_END</span>)
407:           <span class="ruby-identifier">t</span> = <span class="ruby-identifier">file</span>.<span class="ruby-identifier">read</span>(<span class="ruby-value">3</span>)
408:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">t</span> <span class="ruby-operator">!=</span> <span class="ruby-value str">'TAG'</span>
409:             <span class="ruby-comment cmt">#append new tag</span>
410:             <span class="ruby-identifier">file</span>.<span class="ruby-identifier">seek</span>(<span class="ruby-value">0</span>, <span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">SEEK_END</span>)
411:             <span class="ruby-identifier">file</span>.<span class="ruby-identifier">write</span>(<span class="ruby-value str">'TAG'</span>)
412:           <span class="ruby-keyword kw">end</span>
413:           <span class="ruby-identifier">str</span> = [
414:             <span class="ruby-ivar">@tag1_orig</span>[<span class="ruby-value str">&quot;title&quot;</span>]<span class="ruby-operator">||</span><span class="ruby-value str">&quot;&quot;</span>,
415:             <span class="ruby-ivar">@tag1_orig</span>[<span class="ruby-value str">&quot;artist&quot;</span>]<span class="ruby-operator">||</span><span class="ruby-value str">&quot;&quot;</span>,
416:             <span class="ruby-ivar">@tag1_orig</span>[<span class="ruby-value str">&quot;album&quot;</span>]<span class="ruby-operator">||</span><span class="ruby-value str">&quot;&quot;</span>,
417:             ((<span class="ruby-ivar">@tag1_orig</span>[<span class="ruby-value str">&quot;year&quot;</span>] <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>) <span class="ruby-operator">?</span> (<span class="ruby-value str">&quot;%04d&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-ivar">@tag1_orig</span>[<span class="ruby-value str">&quot;year&quot;</span>].<span class="ruby-identifier">to_i</span>) <span class="ruby-operator">:</span> <span class="ruby-value str">&quot;\0\0\0\0&quot;</span>),
418:             <span class="ruby-ivar">@tag1_orig</span>[<span class="ruby-value str">&quot;comments&quot;</span>]<span class="ruby-operator">||</span><span class="ruby-value str">&quot;&quot;</span>,
419:             <span class="ruby-value">0</span>,
420:             <span class="ruby-ivar">@tag1_orig</span>[<span class="ruby-value str">&quot;tracknum&quot;</span>]<span class="ruby-operator">||</span><span class="ruby-value">0</span>,
421:             <span class="ruby-ivar">@tag1_orig</span>[<span class="ruby-value str">&quot;genre&quot;</span>]<span class="ruby-operator">||</span><span class="ruby-value">255</span>
422:             ].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">&quot;Z30Z30Z30Z4Z28CCC&quot;</span>)
423:           <span class="ruby-identifier">file</span>.<span class="ruby-identifier">write</span>(<span class="ruby-identifier">str</span>)
424:         <span class="ruby-keyword kw">end</span>
425:       <span class="ruby-keyword kw">end</span>
426:     <span class="ruby-keyword kw">end</span>
427: 
428:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@tag2</span>.<span class="ruby-identifier">changed?</span>
429:       <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;@tag2 has changed&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">$DEBUG</span>
430:       <span class="ruby-identifier">raise</span>(<span class="ruby-constant">Mp3InfoError</span>, <span class="ruby-value str">&quot;file is not writable&quot;</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">writable?</span>(<span class="ruby-ivar">@filename_or_io</span>)
431:       <span class="ruby-identifier">tempfile_name</span> = <span class="ruby-keyword kw">nil</span>
432:       <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-ivar">@filename_or_io</span>, <span class="ruby-value str">'rb+'</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span>
433:         <span class="ruby-comment cmt">#if tag2 already exists, seek to end of it</span>
434:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@tag2</span>.<span class="ruby-identifier">parsed?</span>
435:           <span class="ruby-identifier">file</span>.<span class="ruby-identifier">seek</span>(<span class="ruby-ivar">@tag2</span>.<span class="ruby-identifier">io_position</span>)
436:         <span class="ruby-keyword kw">end</span>
437:   <span class="ruby-comment cmt">#      if @io.read(3) == &quot;ID3&quot;</span>
438:   <span class="ruby-comment cmt">#        version_maj, version_min, flags = @io.read(3).unpack(&quot;CCB4&quot;)</span>
439:   <span class="ruby-comment cmt">#        unsync, ext_header, experimental, footer = (0..3).collect { |i| flags[i].chr == '1' }</span>
440:   <span class="ruby-comment cmt">#        tag2_len = @io.get_syncsafe</span>
441:   <span class="ruby-comment cmt">#        @io.seek(@io.get_syncsafe - 4, IO::SEEK_CUR) if ext_header</span>
442:   <span class="ruby-comment cmt">#        @io.seek(tag2_len, IO::SEEK_CUR)</span>
443:   <span class="ruby-comment cmt">#      end</span>
444:         <span class="ruby-identifier">tempfile_name</span> = <span class="ruby-ivar">@filename_or_io</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;.tmp&quot;</span>
445:         <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">tempfile_name</span>, <span class="ruby-value str">&quot;wb&quot;</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">tempfile</span><span class="ruby-operator">|</span>
446:           <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@tag2</span>.<span class="ruby-identifier">empty?</span>
447:             <span class="ruby-identifier">tempfile</span>.<span class="ruby-identifier">write</span>(<span class="ruby-ivar">@tag2</span>.<span class="ruby-identifier">to_bin</span>)
448:           <span class="ruby-keyword kw">end</span>
449: 
450:           <span class="ruby-identifier">bufsiz</span> = <span class="ruby-identifier">file</span>.<span class="ruby-identifier">stat</span>.<span class="ruby-identifier">blksize</span> <span class="ruby-operator">||</span> <span class="ruby-value">4096</span>
451:           <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">buf</span> = <span class="ruby-identifier">file</span>.<span class="ruby-identifier">read</span>(<span class="ruby-identifier">bufsiz</span>)
452:             <span class="ruby-identifier">tempfile</span>.<span class="ruby-identifier">write</span>(<span class="ruby-identifier">buf</span>)
453:           <span class="ruby-keyword kw">end</span>
454:         <span class="ruby-keyword kw">end</span>
455:       <span class="ruby-keyword kw">end</span>
456:       <span class="ruby-constant">File</span>.<span class="ruby-identifier">rename</span>(<span class="ruby-identifier">tempfile_name</span>, <span class="ruby-ivar">@filename_or_io</span>)
457:     <span class="ruby-keyword kw">end</span>
458:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000032">
                    
                    <a name="M000032"></a><b>each_frame</b>()
                    
                </div>
                
                <div class="description">
                  <p>
iterates over each mpeg frame over the file, allowing you to write some
funny things, like an mpeg lossless cutter, or frame counter, or whatever
you like ;) <tt>frame</tt> is a hash with the following keys: :layer,
:bitrate, :samplerate, :<a
href="Mp3Info.html#mpeg_version">mpeg_version</a>, :padding and :size (in
bytes)
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000032_source')" id="l_M000032_source">show</a>
                        
                    </p>
                    <div id="M000032_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/mp3info.rb, line 480</span>
480:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">each_frame</span>
481:     <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">seek</span>(<span class="ruby-ivar">@first_frame_pos</span>, <span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">SEEK_SET</span>)
482:     <span class="ruby-identifier">loop</span> <span class="ruby-keyword kw">do</span>
483:       <span class="ruby-identifier">head</span> = <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">read</span>(<span class="ruby-value">4</span>).<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">&quot;N&quot;</span>).<span class="ruby-identifier">first</span>
484:       <span class="ruby-identifier">frame</span> = <span class="ruby-constant">Mp3Info</span>.<span class="ruby-identifier">get_frames_infos</span>(<span class="ruby-identifier">head</span>)
485:       <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">seek</span>(<span class="ruby-identifier">frame</span>[<span class="ruby-identifier">:size</span>] <span class="ruby-operator">-</span><span class="ruby-value">4</span>, <span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">SEEK_CUR</span>)
486:       <span class="ruby-keyword kw">yield</span> <span class="ruby-identifier">frame</span>
487:       <span class="ruby-comment cmt">#puts &quot;frame #{frame_count} len #{frame[:length]} br #{frame[:bitrate]} @io.pos #{@io.pos}&quot;</span>
488:       <span class="ruby-keyword kw">break</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">eof?</span>
489:     <span class="ruby-keyword kw">end</span>
490:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000030">
                    
                    <a name="M000030"></a><b>flush</b>()
                    
                </div>
                
                <div class="description">
                  <p>
close and reopen the file, i.e. commit changes to disk and reload it (only
works with &#8220;true&#8221; files, not StringIO ones)
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000030_source')" id="l_M000030_source">show</a>
                        
                    </p>
                    <div id="M000030_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/mp3info.rb, line 462</span>
462:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">flush</span>
463:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@io_is_a_file</span>
464:     <span class="ruby-identifier">close</span>
465:     <span class="ruby-identifier">reload</span>
466:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000028">
                    
                    <a name="M000028"></a><b>frame_length</b>()
                    
                </div>
                
                <div class="description">
                  <p>
return the length in seconds of one frame
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000028_source')" id="l_M000028_source">show</a>
                        
                    </p>
                    <div id="M000028_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/mp3info.rb, line 367</span>
367:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">frame_length</span>
368:     <span class="ruby-constant">SAMPLES_PER_FRAME</span>[<span class="ruby-ivar">@layer</span>][<span class="ruby-ivar">@mpeg_version</span>] <span class="ruby-operator">/</span> <span class="ruby-constant">Float</span>(<span class="ruby-ivar">@samplerate</span>)
369:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000024">
                    
                    <a name="M000024"></a><b>hastag1?</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Does the file has an id3v1 tag?
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000024_source')" id="l_M000024_source">show</a>
                        
                    </p>
                    <div id="M000024_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/mp3info.rb, line 334</span>
334:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">hastag1?</span>
335:     <span class="ruby-operator">!</span><span class="ruby-ivar">@tag1</span>.<span class="ruby-identifier">empty?</span>
336:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000025">
                    
                    <a name="M000025"></a><b>hastag2?</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Does the file has an id3v2 tag?
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000025_source')" id="l_M000025_source">show</a>
                        
                    </p>
                    <div id="M000025_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/mp3info.rb, line 339</span>
339:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">hastag2?</span>
340:     <span class="ruby-ivar">@tag2</span>.<span class="ruby-identifier">parsed?</span>
341:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000023">
                    
                    <a name="M000023"></a><b>hastag?</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Does the file has an id3v1 or v2 tag?
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000023_source')" id="l_M000023_source">show</a>
                        
                    </p>
                    <div id="M000023_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/mp3info.rb, line 329</span>
329:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">hastag?</span>
330:     <span class="ruby-identifier">hastag1?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">hastag2?</span>
331:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000015">
                    
                    <a name="M000015"></a><b>reload</b>()
                    
                </div>
                
                <div class="description">
                  <p>
reload (or load for the first time) the file from disk
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000015_source')" id="l_M000015_source">show</a>
                        
                    </p>
                    <div id="M000015_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/mp3info.rb, line 231</span>
231:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">reload</span>
232:     <span class="ruby-ivar">@header</span> = {}
233: 
234:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@filename_or_io</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">StringIO</span>)
235:       <span class="ruby-ivar">@io_is_a_file</span> = <span class="ruby-keyword kw">false</span>
236:       <span class="ruby-ivar">@io</span> = <span class="ruby-ivar">@filename_or_io</span>
237:       <span class="ruby-ivar">@io_size</span> = <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">size</span>
238:       <span class="ruby-ivar">@filename</span> = <span class="ruby-keyword kw">nil</span>
239:     <span class="ruby-keyword kw">else</span>
240:       <span class="ruby-ivar">@io_is_a_file</span> = <span class="ruby-keyword kw">true</span>
241:       <span class="ruby-ivar">@io</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@filename_or_io</span>, <span class="ruby-value str">&quot;rb&quot;</span>)
242:       <span class="ruby-ivar">@io_size</span> = <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">stat</span>.<span class="ruby-identifier">size</span>
243:       <span class="ruby-ivar">@filename</span> = <span class="ruby-ivar">@filename_or_io</span>
244:     <span class="ruby-keyword kw">end</span>
245: 
246:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@io_size</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
247:       <span class="ruby-identifier">raise</span>(<span class="ruby-constant">Mp3InfoError</span>, <span class="ruby-value str">&quot;empty file or IO&quot;</span>)
248:     <span class="ruby-keyword kw">end</span>
249: 
250: 
251:     <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">extend</span>(<span class="ruby-constant">Mp3FileMethods</span>)
252:     <span class="ruby-ivar">@tag1</span> = <span class="ruby-ivar">@tag</span> = <span class="ruby-ivar">@tag1_orig</span> = <span class="ruby-ivar">@tag_orig</span> = {}
253:     <span class="ruby-ivar">@tag1</span>.<span class="ruby-identifier">extend</span>(<span class="ruby-constant">HashKeys</span>)
254:     <span class="ruby-ivar">@tag2</span> = <span class="ruby-constant">ID3v2</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@id3v2_options</span>)
255: 
256:     <span class="ruby-keyword kw">begin</span>
257:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@tag_parsing_enabled</span>
258:         <span class="ruby-identifier">parse_tags</span>
259:         <span class="ruby-ivar">@tag1_orig</span> = <span class="ruby-ivar">@tag1</span>.<span class="ruby-identifier">dup</span>
260: 
261:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">hastag1?</span>
262:           <span class="ruby-ivar">@tag</span> = <span class="ruby-ivar">@tag1</span>.<span class="ruby-identifier">dup</span>
263:         <span class="ruby-keyword kw">end</span>
264: 
265:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">hastag2?</span>
266:           <span class="ruby-ivar">@tag</span> = {}
267:           <span class="ruby-comment cmt"># creation of a sort of &quot;universal&quot; tag, regardless of the tag version</span>
268:           <span class="ruby-identifier">tag2_mapping</span> = <span class="ruby-ivar">@tag2</span>.<span class="ruby-identifier">version</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/^2\.2/</span> <span class="ruby-operator">?</span> <span class="ruby-constant">TAG_MAPPING_2_2</span> <span class="ruby-operator">:</span> <span class="ruby-constant">TAG_MAPPING_2_3</span>
269:           <span class="ruby-identifier">tag2_mapping</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">tag2_name</span><span class="ruby-operator">|</span>
270:             <span class="ruby-identifier">tag_value</span> = (<span class="ruby-ivar">@tag2</span>[<span class="ruby-identifier">tag2_name</span>].<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>) <span class="ruby-operator">?</span> <span class="ruby-ivar">@tag2</span>[<span class="ruby-identifier">tag2_name</span>].<span class="ruby-identifier">first</span> <span class="ruby-operator">:</span> <span class="ruby-ivar">@tag2</span>[<span class="ruby-identifier">tag2_name</span>])
271:             <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">tag_value</span>
272:             <span class="ruby-ivar">@tag</span>[<span class="ruby-identifier">key</span>] = <span class="ruby-identifier">tag_value</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">tag_value</span>.<span class="ruby-identifier">first</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">tag_value</span>
273: 
274:             <span class="ruby-keyword kw">if</span> <span class="ruby-node">%w{year tracknum}</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">key</span>)
275:               <span class="ruby-ivar">@tag</span>[<span class="ruby-identifier">key</span>] = <span class="ruby-identifier">tag_value</span>.<span class="ruby-identifier">to_i</span>
276:             <span class="ruby-keyword kw">end</span>
277:             <span class="ruby-comment cmt"># this is a special case with id3v2.2, which uses</span>
278:             <span class="ruby-comment cmt"># old fashionned id3v1 genres</span>
279:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">tag2_name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;TCO&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">tag_value</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/^\((\d+)\)$/</span>
280:               <span class="ruby-ivar">@tag</span>[<span class="ruby-value str">&quot;genre_s&quot;</span>] = <span class="ruby-constant">GENRES</span>[<span class="ruby-identifier">$1</span>.<span class="ruby-identifier">to_i</span>]
281:             <span class="ruby-keyword kw">end</span>
282:           <span class="ruby-keyword kw">end</span>
283:         <span class="ruby-keyword kw">end</span>
284: 
285:         <span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">extend</span>(<span class="ruby-constant">HashKeys</span>)
286:         <span class="ruby-ivar">@tag_orig</span> = <span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">dup</span>
287:       <span class="ruby-keyword kw">end</span>
288: 
289:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@mp3_parsing_enabled</span>
290:         <span class="ruby-identifier">parse_mp3</span>
291:       <span class="ruby-keyword kw">end</span>
292: 
293:     <span class="ruby-keyword kw">ensure</span>
294:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@io_is_a_file</span>
295:         <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">close</span>
296:       <span class="ruby-keyword kw">end</span>
297:     <span class="ruby-keyword kw">end</span>
298:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000020">
                    
                    <a name="M000020"></a><b>removetag1</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Remove id3v1 from mp3
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000020_source')" id="l_M000020_source">show</a>
                        
                    </p>
                    <div id="M000020_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/mp3info.rb, line 317</span>
317:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">removetag1</span>
318:     <span class="ruby-ivar">@tag1</span>.<span class="ruby-identifier">clear</span>
319:     <span class="ruby-keyword kw">self</span>
320:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000022">
                    
                    <a name="M000022"></a><b>removetag2</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Remove id3v2 from mp3
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000022_source')" id="l_M000022_source">show</a>
                        
                    </p>
                    <div id="M000022_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/mp3info.rb, line 323</span>
323:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">removetag2</span>
324:     <span class="ruby-ivar">@tag2</span>.<span class="ruby-identifier">clear</span>
325:     <span class="ruby-keyword kw">self</span>
326:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000026">
                    
                    <a name="M000026"></a><b>rename</b>(new_filename)
                    
                </div>
                
                <div class="description">
                  <p>
write to another filename at close()
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000026_source')" id="l_M000026_source">show</a>
                        
                    </p>
                    <div id="M000026_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/mp3info.rb, line 344</span>
344:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">rename</span>(<span class="ruby-identifier">new_filename</span>)
345:     <span class="ruby-identifier">raise</span>(<span class="ruby-constant">Mp3InfoError</span>, <span class="ruby-value str">&quot;cannot rename an IO&quot;</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@io_is_a_file</span>
346:     <span class="ruby-ivar">@filename</span> = <span class="ruby-identifier">new_filename</span>
347:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000031">
                    
                    <a name="M000031"></a><b>to_s</b>()
                    
                </div>
                
                <div class="description">
                  <p>
inspect inside <a href="Mp3Info.html">Mp3Info</a>
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000031_source')" id="l_M000031_source">show</a>
                        
                    </p>
                    <div id="M000031_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/mp3info.rb, line 469</span>
469:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">to_s</span>
470:     <span class="ruby-identifier">s</span> = <span class="ruby-node">&quot;MPEG #{@mpeg_version} Layer #{@layer} #{@vbr ? &quot;VBR&quot; : &quot;CBR&quot;} #{@bitrate} Kbps #{@channel_mode} #{@samplerate} Hz length #{@length} sec. header #{@header.inspect} &quot;</span>
471:     <span class="ruby-identifier">s</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;tag1: &quot;</span><span class="ruby-operator">+</span><span class="ruby-ivar">@tag1</span>.<span class="ruby-identifier">to_hash</span>.<span class="ruby-identifier">inspect</span><span class="ruby-operator">+</span><span class="ruby-value str">&quot;\n&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">hastag1?</span>
472:     <span class="ruby-identifier">s</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;tag2: &quot;</span><span class="ruby-operator">+</span><span class="ruby-ivar">@tag2</span>.<span class="ruby-identifier">to_hash</span>.<span class="ruby-identifier">inspect</span><span class="ruby-operator">+</span><span class="ruby-value str">&quot;\n&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">hastag2?</span>
473:     <span class="ruby-identifier">s</span>
474:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Private methods</div>
            
            <div class="method">
                <div class="title" id="M000036">
                    
                    <a name="M000036"></a><b>find_next_frame</b>()
                    
                </div>
                
                <div class="description">
                  <p>
reads through @io from current pos until it finds a valid MPEG header
returns the MPEG header as FixNum
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000036_source')" id="l_M000036_source">show</a>
                        
                    </p>
                    <div id="M000036_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/mp3info.rb, line 580</span>
580:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">find_next_frame</span>
581:     <span class="ruby-comment cmt"># @io will now be sitting at the best guess for where the MPEG frame is.</span>
582:     <span class="ruby-comment cmt"># It should be at byte 0 when there's no id3v2 tag.</span>
583:     <span class="ruby-comment cmt"># It should be at the end of the id3v2 tag or the zero padding if there</span>
584:     <span class="ruby-comment cmt">#   is a id3v2 tag.</span>
585:     <span class="ruby-comment cmt">#dummyproof = @io.stat.size - @io.pos =&gt; WAS TOO MUCH</span>
586: 
587:     <span class="ruby-identifier">dummyproof</span> = [ <span class="ruby-ivar">@io_size</span> <span class="ruby-operator">-</span> <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">pos</span>, <span class="ruby-value">2000000</span> ].<span class="ruby-identifier">min</span>
588:     <span class="ruby-identifier">dummyproof</span>.<span class="ruby-identifier">times</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
589:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">getbyte</span> <span class="ruby-operator">==</span> <span class="ruby-value">0xff</span>
590:         <span class="ruby-identifier">data</span> = <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">read</span>(<span class="ruby-value">3</span>)
591:         <span class="ruby-identifier">raise</span>(<span class="ruby-constant">Mp3InfoError</span>, <span class="ruby-value str">&quot;end of file reached&quot;</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">eof?</span>
592:         <span class="ruby-identifier">head</span> = <span class="ruby-value">0xff000000</span> <span class="ruby-operator">+</span> (<span class="ruby-identifier">data</span>.<span class="ruby-identifier">getbyte</span>(<span class="ruby-value">0</span>) <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value">16</span>) <span class="ruby-operator">+</span> (<span class="ruby-identifier">data</span>.<span class="ruby-identifier">getbyte</span>(<span class="ruby-value">1</span>) <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value">8</span>) <span class="ruby-operator">+</span> <span class="ruby-identifier">data</span>.<span class="ruby-identifier">getbyte</span>(<span class="ruby-value">2</span>)
593:         <span class="ruby-keyword kw">begin</span>
594:           <span class="ruby-constant">Mp3Info</span>.<span class="ruby-identifier">get_frames_infos</span>(<span class="ruby-identifier">head</span>)
595:           <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">head</span>
596:         <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Mp3InfoInternalError</span>
597:           <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">seek</span>(<span class="ruby-value">-3</span>, <span class="ruby-constant">IO</span><span class="ruby-operator">::</span><span class="ruby-constant">SEEK_CUR</span>)
598:         <span class="ruby-keyword kw">end</span>
599:       <span class="ruby-keyword kw">end</span>
600:     <span class="ruby-keyword kw">end</span>
601:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">eof?</span>
602:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">Mp3InfoError</span>, <span class="ruby-value str">&quot;cannot find a valid frame: got EOF&quot;</span>
603:     <span class="ruby-keyword kw">else</span>
604:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">Mp3InfoError</span>, <span class="ruby-node">&quot;cannot find a valid frame after reading #{dummyproof} bytes&quot;</span>
605:     <span class="ruby-keyword kw">end</span>
606:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000037">
                    
                    <a name="M000037"></a><b>frame_scan</b>(frame_limit = nil)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000037_source')" id="l_M000037_source">show</a>
                        
                    </p>
                    <div id="M000037_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/mp3info.rb, line 608</span>
608:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">frame_scan</span>(<span class="ruby-identifier">frame_limit</span> = <span class="ruby-keyword kw">nil</span>)
609:     <span class="ruby-identifier">frame_count</span> = <span class="ruby-identifier">bitrate_sum</span> = <span class="ruby-value">0</span>
610:     <span class="ruby-identifier">each_frame</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">frame</span><span class="ruby-operator">|</span>
611:       <span class="ruby-identifier">bitrate_sum</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">frame</span>[<span class="ruby-identifier">:bitrate</span>]
612:       <span class="ruby-identifier">frame_count</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
613:       <span class="ruby-keyword kw">break</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">frame_limit</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">frame_count</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">frame_limit</span>)
614:     <span class="ruby-keyword kw">end</span>
615: 
616:     <span class="ruby-identifier">average_bitrate</span> = <span class="ruby-identifier">bitrate_sum</span><span class="ruby-operator">/</span><span class="ruby-identifier">frame_count</span>.<span class="ruby-identifier">to_f</span>
617:     <span class="ruby-identifier">length</span> = (<span class="ruby-identifier">frame_count</span><span class="ruby-operator">-</span><span class="ruby-value">1</span>) <span class="ruby-operator">*</span> <span class="ruby-identifier">frame_length</span>
618:     [<span class="ruby-identifier">average_bitrate</span>, <span class="ruby-identifier">length</span>]
619:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000035">
                    
                    <a name="M000035"></a><b>gettag1</b>()
                    
                </div>
                
                <div class="description">
                  <p>
gets id3v1 tag information from @io assumes @io is pointing to char after
&#8220;TAG&#8221; id
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000035_source')" id="l_M000035_source">show</a>
                        
                    </p>
                    <div id="M000035_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/mp3info.rb, line 556</span>
556:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">gettag1</span>
557:     <span class="ruby-ivar">@tag1_parsed</span> = <span class="ruby-keyword kw">true</span>
558:     <span class="ruby-ivar">@tag1</span>[<span class="ruby-value str">&quot;title&quot;</span>] = <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">read</span>(<span class="ruby-value">30</span>).<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">&quot;A*&quot;</span>).<span class="ruby-identifier">first</span>
559:     <span class="ruby-ivar">@tag1</span>[<span class="ruby-value str">&quot;artist&quot;</span>] = <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">read</span>(<span class="ruby-value">30</span>).<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">&quot;A*&quot;</span>).<span class="ruby-identifier">first</span>
560:     <span class="ruby-ivar">@tag1</span>[<span class="ruby-value str">&quot;album&quot;</span>] = <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">read</span>(<span class="ruby-value">30</span>).<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">&quot;A*&quot;</span>).<span class="ruby-identifier">first</span>
561:     <span class="ruby-identifier">year_t</span> = <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">read</span>(<span class="ruby-value">4</span>).<span class="ruby-identifier">to_i</span>
562:     <span class="ruby-ivar">@tag1</span>[<span class="ruby-value str">&quot;year&quot;</span>] = <span class="ruby-identifier">year_t</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">year_t</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
563:     <span class="ruby-identifier">comments</span> = <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">read</span>(<span class="ruby-value">30</span>)
564:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">comments</span>.<span class="ruby-identifier">getbyte</span>(<span class="ruby-value">-2</span>) <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
565:       <span class="ruby-ivar">@tag1</span>[<span class="ruby-value str">&quot;tracknum&quot;</span>] = <span class="ruby-identifier">comments</span>.<span class="ruby-identifier">getbyte</span>(<span class="ruby-value">-1</span>).<span class="ruby-identifier">to_i</span>
566:       <span class="ruby-identifier">comments</span>.<span class="ruby-identifier">chop!</span> <span class="ruby-comment cmt">#remove the last char</span>
567:     <span class="ruby-keyword kw">end</span>
568:     <span class="ruby-ivar">@tag1</span>[<span class="ruby-value str">&quot;comments&quot;</span>] = <span class="ruby-identifier">comments</span>.<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">&quot;A*&quot;</span>).<span class="ruby-identifier">first</span>
569:     <span class="ruby-ivar">@tag1</span>[<span class="ruby-value str">&quot;genre&quot;</span>] = <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">getbyte</span>
570:     <span class="ruby-ivar">@tag1</span>[<span class="ruby-value str">&quot;genre_s&quot;</span>] = <span class="ruby-constant">GENRES</span>[<span class="ruby-ivar">@tag1</span>[<span class="ruby-value str">&quot;genre&quot;</span>]] <span class="ruby-operator">||</span> <span class="ruby-value str">&quot;&quot;</span>
571: 
572:     <span class="ruby-comment cmt"># clear empty tags</span>
573:     <span class="ruby-ivar">@tag1</span>.<span class="ruby-identifier">delete_if</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:empty?</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">empty?</span> }
574:     <span class="ruby-ivar">@tag1</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value str">&quot;genre&quot;</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@tag1</span>[<span class="ruby-value str">&quot;genre&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-value">255</span>
575:     <span class="ruby-ivar">@tag1</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value str">&quot;tracknum&quot;</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@tag1</span>[<span class="ruby-value str">&quot;tracknum&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
576:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000038">
                    
                    <a name="M000038"></a><b>parse_mp3</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000038_source')" id="l_M000038_source">show</a>
                        
                    </p>
                    <div id="M000038_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/mp3info.rb, line 621</span>
621:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">parse_mp3</span>
622:     <span class="ruby-comment cmt">### extracts MPEG info from MPEG header and stores it in the hash @mpeg</span>
623:     <span class="ruby-comment cmt">###  head (fixnum) = valid 4 byte MPEG header</span>
624: 
625:     <span class="ruby-identifier">found</span> = <span class="ruby-keyword kw">false</span>
626: 
627:     <span class="ruby-identifier">head</span> = <span class="ruby-keyword kw">nil</span>
628:     <span class="ruby-value">5</span>.<span class="ruby-identifier">times</span> <span class="ruby-keyword kw">do</span>
629:       <span class="ruby-identifier">head</span> = <span class="ruby-identifier">find_next_frame</span>()
630:       <span class="ruby-ivar">@first_frame_pos</span> = <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">pos</span> <span class="ruby-operator">-</span> <span class="ruby-value">4</span>
631:       <span class="ruby-identifier">current_frame</span> = <span class="ruby-constant">Mp3Info</span>.<span class="ruby-identifier">get_frames_infos</span>(<span class="ruby-identifier">head</span>)
632:       <span class="ruby-ivar">@mpeg_version</span> = <span class="ruby-identifier">current_frame</span>[<span class="ruby-identifier">:mpeg_version</span>]
633:       <span class="ruby-ivar">@layer</span> = <span class="ruby-identifier">current_frame</span>[<span class="ruby-identifier">:layer</span>]
634:       <span class="ruby-ivar">@header</span>[<span class="ruby-identifier">:error_protection</span>] = <span class="ruby-identifier">head</span>[<span class="ruby-value">16</span>] <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-operator">?</span> <span class="ruby-keyword kw">true</span> <span class="ruby-operator">:</span> <span class="ruby-keyword kw">false</span>
635:       <span class="ruby-ivar">@bitrate</span> = <span class="ruby-identifier">current_frame</span>[<span class="ruby-identifier">:bitrate</span>]
636:       <span class="ruby-ivar">@samplerate</span> = <span class="ruby-identifier">current_frame</span>[<span class="ruby-identifier">:samplerate</span>]
637:       <span class="ruby-ivar">@header</span>[<span class="ruby-identifier">:padding</span>] = <span class="ruby-identifier">current_frame</span>[<span class="ruby-identifier">:padding</span>]
638:       <span class="ruby-ivar">@header</span>[<span class="ruby-identifier">:private</span>] = <span class="ruby-identifier">head</span>[<span class="ruby-value">8</span>] <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-operator">?</span> <span class="ruby-keyword kw">true</span> <span class="ruby-operator">:</span> <span class="ruby-keyword kw">false</span>
639:       <span class="ruby-ivar">@channel_mode</span> = <span class="ruby-constant">CHANNEL_MODE</span>[<span class="ruby-ivar">@channel_num</span> = <span class="ruby-constant">Mp3Info</span>.<span class="ruby-identifier">bits</span>(<span class="ruby-identifier">head</span>, <span class="ruby-value">7</span>,<span class="ruby-value">6</span>)]
640:       <span class="ruby-ivar">@header</span>[<span class="ruby-identifier">:mode_extension</span>] = <span class="ruby-constant">Mp3Info</span>.<span class="ruby-identifier">bits</span>(<span class="ruby-identifier">head</span>, <span class="ruby-value">5</span>,<span class="ruby-value">4</span>)
641:       <span class="ruby-ivar">@header</span>[<span class="ruby-identifier">:copyright</span>] = (<span class="ruby-identifier">head</span>[<span class="ruby-value">3</span>] <span class="ruby-operator">==</span> <span class="ruby-value">1</span> <span class="ruby-operator">?</span> <span class="ruby-keyword kw">true</span> <span class="ruby-operator">:</span> <span class="ruby-keyword kw">false</span>)
642:       <span class="ruby-ivar">@header</span>[<span class="ruby-identifier">:original</span>] = (<span class="ruby-identifier">head</span>[<span class="ruby-value">2</span>] <span class="ruby-operator">==</span> <span class="ruby-value">1</span> <span class="ruby-operator">?</span> <span class="ruby-keyword kw">true</span> <span class="ruby-operator">:</span> <span class="ruby-keyword kw">false</span>)
643:       <span class="ruby-ivar">@header</span>[<span class="ruby-identifier">:emphasis</span>] = <span class="ruby-constant">Mp3Info</span>.<span class="ruby-identifier">bits</span>(<span class="ruby-identifier">head</span>, <span class="ruby-value">1</span>,<span class="ruby-value">0</span>)
644:       <span class="ruby-ivar">@vbr</span> = <span class="ruby-keyword kw">false</span>
645:       <span class="ruby-identifier">found</span> = <span class="ruby-keyword kw">true</span>
646:       <span class="ruby-keyword kw">break</span>
647:     <span class="ruby-keyword kw">end</span>
648: 
649:     <span class="ruby-identifier">raise</span>(<span class="ruby-constant">Mp3InfoError</span>, <span class="ruby-value str">&quot;Cannot find good frame&quot;</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">found</span>
650: 
651:     <span class="ruby-identifier">seek</span> = <span class="ruby-ivar">@mpeg_version</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span> <span class="ruby-operator">?</span>
652:       (<span class="ruby-ivar">@channel_num</span> <span class="ruby-operator">==</span> <span class="ruby-value">3</span> <span class="ruby-operator">?</span> <span class="ruby-value">17</span> <span class="ruby-operator">:</span> <span class="ruby-value">32</span>) <span class="ruby-operator">:</span>
653:       (<span class="ruby-ivar">@channel_num</span> <span class="ruby-operator">==</span> <span class="ruby-value">3</span> <span class="ruby-operator">?</span>  <span class="ruby-value">9</span> <span class="ruby-operator">:</span> <span class="ruby-value">17</span>)
654: 
655:     <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">seek</span>(<span class="ruby-identifier">seek</span>, <span class="ruby-constant">IO</span><span class="ruby-operator">::</span><span class="ruby-constant">SEEK_CUR</span>)
656: 
657:     <span class="ruby-identifier">vbr_head</span> = <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">read</span>(<span class="ruby-value">4</span>)
658:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">vbr_head</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;Xing&quot;</span>
659:       <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;Xing header (VBR) detected&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">$DEBUG</span>
660:       <span class="ruby-identifier">flags</span> = <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">get32bits</span>
661:       <span class="ruby-identifier">stream_size</span> = <span class="ruby-identifier">frame_count</span> = <span class="ruby-value">0</span>
662:       <span class="ruby-identifier">flags</span>[<span class="ruby-value">1</span>] <span class="ruby-operator">==</span> <span class="ruby-value">1</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">frame_count</span> = <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">get32bits</span>
663:       <span class="ruby-identifier">flags</span>[<span class="ruby-value">2</span>] <span class="ruby-operator">==</span> <span class="ruby-value">1</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">stream_size</span> = <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">get32bits</span>
664:       <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{frame_count} frames&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">$DEBUG</span>
665:       <span class="ruby-identifier">raise</span>(<span class="ruby-constant">Mp3InfoError</span>, <span class="ruby-value str">&quot;bad VBR header&quot;</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">frame_count</span>.<span class="ruby-identifier">zero?</span>
666:       <span class="ruby-comment cmt"># currently this just skips the TOC entries if they're found</span>
667:       <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">seek</span>(<span class="ruby-value">100</span>, <span class="ruby-constant">IO</span><span class="ruby-operator">::</span><span class="ruby-constant">SEEK_CUR</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">flags</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-value">1</span>
668:       <span class="ruby-comment cmt">#@vbr_quality = @io.get32bits if flags[3] == 1</span>
669: 
670:       <span class="ruby-identifier">samples_per_frame</span> = <span class="ruby-constant">SAMPLES_PER_FRAME</span>[<span class="ruby-ivar">@layer</span>][<span class="ruby-ivar">@mpeg_version</span>]
671:       <span class="ruby-ivar">@length</span> = <span class="ruby-identifier">frame_count</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">samples_per_frame</span> <span class="ruby-operator">/</span> <span class="ruby-constant">Float</span>(<span class="ruby-ivar">@samplerate</span>)
672: 
673:       <span class="ruby-ivar">@bitrate</span> = (((<span class="ruby-identifier">stream_size</span><span class="ruby-operator">/</span><span class="ruby-identifier">frame_count</span>)<span class="ruby-operator">*</span><span class="ruby-ivar">@samplerate</span>)<span class="ruby-operator">/</span><span class="ruby-value">144</span>) <span class="ruby-operator">/</span> <span class="ruby-value">1024</span>
674:       <span class="ruby-ivar">@vbr</span> = <span class="ruby-keyword kw">true</span>
675:     <span class="ruby-keyword kw">else</span>
676:       <span class="ruby-comment cmt"># for cbr, calculate duration with the given bitrate</span>
677: 
678:       <span class="ruby-identifier">stream_size</span> = <span class="ruby-ivar">@io_size</span> <span class="ruby-operator">-</span> (<span class="ruby-identifier">hastag1?</span> <span class="ruby-value">? </span><span class="ruby-constant">TAG1_SIZE</span> <span class="ruby-operator">:</span> <span class="ruby-value">0</span>) <span class="ruby-operator">-</span> (<span class="ruby-ivar">@tag2</span>.<span class="ruby-identifier">io_position</span> <span class="ruby-operator">||</span> <span class="ruby-value">0</span>)
679:       <span class="ruby-ivar">@length</span> = ((<span class="ruby-identifier">stream_size</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value">3</span>)<span class="ruby-operator">/</span><span class="ruby-value">1000.0</span>)<span class="ruby-operator">/</span><span class="ruby-ivar">@bitrate</span>
680:       <span class="ruby-comment cmt"># read the first 100 frames and decide if the mp3 is vbr and needs full scan</span>
681:       <span class="ruby-keyword kw">begin</span>
682:         <span class="ruby-identifier">bitrate</span>, <span class="ruby-identifier">length</span> = <span class="ruby-identifier">frame_scan</span>(<span class="ruby-value">100</span>)
683:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@bitrate</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">bitrate</span>
684:           <span class="ruby-ivar">@vbr</span> = <span class="ruby-keyword kw">true</span>
685:           <span class="ruby-ivar">@bitrate</span>, <span class="ruby-ivar">@length</span> = <span class="ruby-identifier">frame_scan</span>
686:         <span class="ruby-keyword kw">end</span>
687:       <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Mp3InfoInternalError</span>
688:       <span class="ruby-keyword kw">end</span>
689:     <span class="ruby-keyword kw">end</span>
690:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000034">
                    
                    <a name="M000034"></a><b>parse_tags</b>()
                    
                </div>
                
                <div class="description">
                  <p>
parses the id3 tags of the currently open @io
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000034_source')" id="l_M000034_source">show</a>
                        
                    </p>
                    <div id="M000034_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/mp3info.rb, line 527</span>
527:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">parse_tags</span>
528:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@io_size</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">TAG1_SIZE</span>  <span class="ruby-comment cmt"># file is too small</span>
529: 
530:     <span class="ruby-ivar">@tag1_parsed</span> = <span class="ruby-keyword kw">false</span>
531:     <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">seek</span>(<span class="ruby-value">0</span>)
532:     <span class="ruby-identifier">f3</span> = <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">read</span>(<span class="ruby-value">3</span>)
533:     <span class="ruby-comment cmt"># v1 tag at beginning</span>
534:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">f3</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;TAG&quot;</span>
535:       <span class="ruby-identifier">gettag1</span>
536:       <span class="ruby-ivar">@tag1_parsed</span> = <span class="ruby-keyword kw">true</span>
537:     <span class="ruby-keyword kw">end</span>
538: 
539:     <span class="ruby-ivar">@tag2</span>.<span class="ruby-identifier">from_io</span>(<span class="ruby-ivar">@io</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">f3</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;ID3&quot;</span>  <span class="ruby-comment cmt"># v2 tag at beginning</span>
540: 
541:     <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@tag1_parsed</span>         <span class="ruby-comment cmt"># v1 tag at end</span>
542:       <span class="ruby-comment cmt"># this preserves the file pos if tag2 found, since gettag2 leaves</span>
543:       <span class="ruby-comment cmt"># the file at the best guess as to the first MPEG frame</span>
544:       <span class="ruby-identifier">pos</span> = (<span class="ruby-ivar">@tag2</span>.<span class="ruby-identifier">io_position</span> <span class="ruby-operator">||</span> <span class="ruby-value">0</span>)
545:       <span class="ruby-comment cmt"># seek to where id3v1 tag should be</span>
546:       <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">seek</span>(<span class="ruby-operator">-</span><span class="ruby-constant">TAG1_SIZE</span>, <span class="ruby-constant">IO</span><span class="ruby-operator">::</span><span class="ruby-constant">SEEK_END</span>)
547:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">read</span>(<span class="ruby-value">3</span>) <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;TAG&quot;</span>
548:         <span class="ruby-identifier">gettag1</span>
549:       <span class="ruby-keyword kw">end</span>
550:       <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">seek</span>(<span class="ruby-identifier">pos</span>)
551:     <span class="ruby-keyword kw">end</span>
552:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Class Public methods</div>
            
            <div class="method">
                <div class="title" id="M000008">
                    
                    <a name="M000008"></a><b>hastag1?</b>(filename_or_io)
                    
                </div>
                
                <div class="description">
                  <p>
Test the presence of an id3v1 tag in file or StringIO
<tt>filename_or_io</tt>
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000008_source')" id="l_M000008_source">show</a>
                        
                    </p>
                    <div id="M000008_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/mp3info.rb, line 163</span>
163:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">hastag1?</span>(<span class="ruby-identifier">filename_or_io</span>)
164:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">filename_or_io</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">StringIO</span>)
165:       <span class="ruby-identifier">io</span> = <span class="ruby-identifier">filename_or_io</span>
166:       <span class="ruby-identifier">io</span>.<span class="ruby-identifier">rewind</span>
167:     <span class="ruby-keyword kw">else</span>
168:       <span class="ruby-identifier">io</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">filename_or_io</span>, <span class="ruby-value str">&quot;rb&quot;</span>)
169:     <span class="ruby-keyword kw">end</span>
170: 
171:     <span class="ruby-identifier">hastag1</span> = <span class="ruby-keyword kw">false</span>
172:     <span class="ruby-keyword kw">begin</span>
173:       <span class="ruby-identifier">io</span>.<span class="ruby-identifier">seek</span>(<span class="ruby-operator">-</span><span class="ruby-constant">TAG1_SIZE</span>, <span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">SEEK_END</span>)
174:       <span class="ruby-identifier">hastag1</span> = <span class="ruby-identifier">io</span>.<span class="ruby-identifier">read</span>(<span class="ruby-value">3</span>) <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;TAG&quot;</span>
175:     <span class="ruby-keyword kw">ensure</span>
176:       <span class="ruby-identifier">io</span>.<span class="ruby-identifier">close</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">io</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">File</span>)
177:     <span class="ruby-keyword kw">end</span>
178:     <span class="ruby-identifier">hastag1</span>
179:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000009">
                    
                    <a name="M000009"></a><b>hastag2?</b>(filename_or_io)
                    
                </div>
                
                <div class="description">
                  <p>
Test the presence of an id3v2 tag in file or StringIO
<tt>filename_or_io</tt>
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000009_source')" id="l_M000009_source">show</a>
                        
                    </p>
                    <div id="M000009_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/mp3info.rb, line 182</span>
182:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">hastag2?</span>(<span class="ruby-identifier">filename_or_io</span>)
183:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">filename_or_io</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">StringIO</span>)
184:       <span class="ruby-identifier">io</span> = <span class="ruby-identifier">filename_or_io</span>
185:       <span class="ruby-identifier">io</span>.<span class="ruby-identifier">rewind</span>
186:     <span class="ruby-keyword kw">else</span>
187:       <span class="ruby-identifier">io</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">filename_or_io</span>,<span class="ruby-value str">&quot;rb&quot;</span>)
188:     <span class="ruby-keyword kw">end</span>
189: 
190:     <span class="ruby-identifier">hastag2</span> = <span class="ruby-keyword kw">false</span>
191: 
192:     <span class="ruby-keyword kw">begin</span>
193:       <span class="ruby-identifier">hastag2</span> = <span class="ruby-identifier">io</span>.<span class="ruby-identifier">read</span>(<span class="ruby-value">3</span>) <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;ID3&quot;</span>
194:     <span class="ruby-keyword kw">ensure</span>
195:       <span class="ruby-identifier">io</span>.<span class="ruby-identifier">close</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">io</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">File</span>)
196:     <span class="ruby-keyword kw">end</span>
197:     <span class="ruby-identifier">hastag2</span>
198:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000014">
                    
                    <a name="M000014"></a><b>new</b>(filename_or_io, options = {})
                    
                </div>
                
                <div class="description">
                  <p>
Instantiate <a href="Mp3Info.html">Mp3Info</a> object with name
<tt>filename</tt>. options hash is used for <a
href="ID3v2.html#M000001">ID3v2#new</a>. Specify :<a
href="Mp3Info.html#M000034">parse_tags</a> => false to disable the
processing of the tags (read and write). Specify :<a
href="Mp3Info.html#M000038">parse_mp3</a> => false to disable processing of
the mp3
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000014_source')" id="l_M000014_source">show</a>
                        
                    </p>
                    <div id="M000014_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/mp3info.rb, line 220</span>
220:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">filename_or_io</span>, <span class="ruby-identifier">options</span> = {})
221:     <span class="ruby-identifier">warn</span>(<span class="ruby-node">&quot;#{self.class}::new() does not take block; use #{self.class}::open() instead&quot;</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block_given?</span>
222:     <span class="ruby-ivar">@filename_or_io</span> = <span class="ruby-identifier">filename_or_io</span>
223:     <span class="ruby-identifier">options</span> = {<span class="ruby-identifier">:parse_mp3</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>, <span class="ruby-identifier">:parse_tags</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>}.<span class="ruby-identifier">update</span>(<span class="ruby-identifier">options</span>)
224:     <span class="ruby-ivar">@tag_parsing_enabled</span> = <span class="ruby-identifier">options</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:parse_tags</span>)
225:     <span class="ruby-ivar">@mp3_parsing_enabled</span> = <span class="ruby-identifier">options</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:parse_mp3</span>)
226:     <span class="ruby-ivar">@id3v2_options</span> = <span class="ruby-identifier">options</span>
227:     <span class="ruby-identifier">reload</span>
228:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000019">
                    
                    <a name="M000019"></a><b>open</b>(*params)
                    
                </div>
                
                <div class="description">
                  <p>
&#8220;block version&#8221; of Mp3Info::new()
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000019_source')" id="l_M000019_source">show</a>
                        
                    </p>
                    <div id="M000019_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/mp3info.rb, line 301</span>
301:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">open</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">params</span>)
302:     <span class="ruby-identifier">m</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">new</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">params</span>)
303:     <span class="ruby-identifier">ret</span> = <span class="ruby-keyword kw">nil</span>
304:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block_given?</span>
305:       <span class="ruby-keyword kw">begin</span>
306:         <span class="ruby-identifier">ret</span> = <span class="ruby-keyword kw">yield</span>(<span class="ruby-identifier">m</span>)
307:       <span class="ruby-keyword kw">ensure</span>
308:         <span class="ruby-identifier">m</span>.<span class="ruby-identifier">close</span>
309:       <span class="ruby-keyword kw">end</span>
310:     <span class="ruby-keyword kw">else</span>
311:       <span class="ruby-identifier">ret</span> = <span class="ruby-identifier">m</span>
312:     <span class="ruby-keyword kw">end</span>
313:     <span class="ruby-identifier">ret</span>
314:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000011">
                    
                    <a name="M000011"></a><b>removetag1</b>(filename)
                    
                </div>
                
                <div class="description">
                  <p>
Remove id3v1 tag from <tt>filename</tt>
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000011_source')" id="l_M000011_source">show</a>
                        
                    </p>
                    <div id="M000011_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/mp3info.rb, line 201</span>
201:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">removetag1</span>(<span class="ruby-identifier">filename</span>)
202:     <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">hastag1?</span>(<span class="ruby-identifier">filename</span>)
203:       <span class="ruby-identifier">newsize</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">size</span>(<span class="ruby-identifier">filename</span>) <span class="ruby-operator">-</span> <span class="ruby-constant">TAG1_SIZE</span>
204:       <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">filename</span>, <span class="ruby-value str">&quot;rb+&quot;</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span> <span class="ruby-identifier">f</span>.<span class="ruby-identifier">truncate</span>(<span class="ruby-identifier">newsize</span>) }
205:     <span class="ruby-keyword kw">end</span>
206:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000012">
                    
                    <a name="M000012"></a><b>removetag2</b>(filename)
                    
                </div>
                
                <div class="description">
                  <p>
Remove id3v2 tag from <tt>filename</tt>
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000012_source')" id="l_M000012_source">show</a>
                        
                    </p>
                    <div id="M000012_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/mp3info.rb, line 209</span>
209:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">removetag2</span>(<span class="ruby-identifier">filename</span>)
210:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">filename</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">mp3</span><span class="ruby-operator">|</span>
211:       <span class="ruby-identifier">mp3</span>.<span class="ruby-identifier">tag2</span>.<span class="ruby-identifier">clear</span>
212:     <span class="ruby-keyword kw">end</span>
213:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Class Private methods</div>
            
            <div class="method">
                <div class="title" id="M000039">
                    
                    <a name="M000039"></a><b>bits</b>(number, b, a)
                    
                </div>
                
                <div class="description">
                  <p>
returns the selected bit range (b, a) as a number NOTE: b > a if not,
returns 0
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000039_source')" id="l_M000039_source">show</a>
                        
                    </p>
                    <div id="M000039_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/mp3info.rb, line 694</span>
694:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">bits</span>(<span class="ruby-identifier">number</span>, <span class="ruby-identifier">b</span>, <span class="ruby-identifier">a</span>)
695:     <span class="ruby-identifier">t</span> = <span class="ruby-value">0</span>
696:     <span class="ruby-identifier">b</span>.<span class="ruby-identifier">downto</span>(<span class="ruby-identifier">a</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span> <span class="ruby-identifier">t</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">t</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">number</span>[<span class="ruby-identifier">i</span>] }
697:     <span class="ruby-identifier">t</span>
698:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000033">
                    
                    <a name="M000033"></a><b>get_frames_infos</b>(head)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000033_source')" id="l_M000033_source">show</a>
                        
                    </p>
                    <div id="M000033_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/mp3info.rb, line 494</span>
494:   <span class="ruby-keyword kw">def</span> <span class="ruby-constant">Mp3Info</span>.<span class="ruby-identifier">get_frames_infos</span>(<span class="ruby-identifier">head</span>)
495:     <span class="ruby-comment cmt"># be sure we are in sync</span>
496:     <span class="ruby-keyword kw">if</span> ((<span class="ruby-identifier">head</span> <span class="ruby-operator">&amp;</span> <span class="ruby-value">0xffe00000</span>) <span class="ruby-operator">!=</span> <span class="ruby-value">0xffe00000</span>)    <span class="ruby-operator">||</span> <span class="ruby-comment cmt"># 11 bit MPEG frame sync</span>
497:         ((<span class="ruby-identifier">head</span> <span class="ruby-operator">&amp;</span> <span class="ruby-value">0x00060000</span>) <span class="ruby-operator">==</span> <span class="ruby-value">0x00060000</span>)    <span class="ruby-operator">||</span> <span class="ruby-comment cmt">#  2 bit layer type</span>
498:         ((<span class="ruby-identifier">head</span> <span class="ruby-operator">&amp;</span> <span class="ruby-value">0x0000f000</span>) <span class="ruby-operator">==</span> <span class="ruby-value">0x0000f000</span>)    <span class="ruby-operator">||</span> <span class="ruby-comment cmt">#  4 bit bitrate</span>
499:         ((<span class="ruby-identifier">head</span> <span class="ruby-operator">&amp;</span> <span class="ruby-value">0x0000f000</span>) <span class="ruby-operator">==</span> <span class="ruby-value">0x00000000</span>)    <span class="ruby-operator">||</span> <span class="ruby-comment cmt">#        free format bitstream</span>
500:         ((<span class="ruby-identifier">head</span> <span class="ruby-operator">&amp;</span> <span class="ruby-value">0x00000c00</span>) <span class="ruby-operator">==</span> <span class="ruby-value">0x00000c00</span>)    <span class="ruby-operator">||</span> <span class="ruby-comment cmt">#  2 bit frequency</span>
501:         ((<span class="ruby-identifier">head</span> <span class="ruby-operator">&amp;</span> <span class="ruby-value">0xffff0000</span>) <span class="ruby-operator">==</span> <span class="ruby-value">0xfffe0000</span>)
502:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">Mp3InfoInternalError</span>
503:     <span class="ruby-keyword kw">end</span>
504:     <span class="ruby-identifier">mpeg_version</span> = [<span class="ruby-value">2.5</span>, <span class="ruby-keyword kw">nil</span>, <span class="ruby-value">2</span>, <span class="ruby-value">1</span>][<span class="ruby-identifier">bits</span>(<span class="ruby-identifier">head</span>, <span class="ruby-value">20</span>,<span class="ruby-value">19</span>)]
505: 
506:     <span class="ruby-identifier">layer</span> = <span class="ruby-constant">LAYER</span>[<span class="ruby-identifier">bits</span>(<span class="ruby-identifier">head</span>, <span class="ruby-value">18</span>,<span class="ruby-value">17</span>)]
507:     <span class="ruby-identifier">raise</span> <span class="ruby-constant">Mp3InfoInternalError</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">layer</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">mpeg_version</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>
508: 
509:     <span class="ruby-identifier">bitrate</span> = <span class="ruby-constant">BITRATE</span>[<span class="ruby-identifier">mpeg_version</span>][<span class="ruby-identifier">layer</span><span class="ruby-operator">-</span><span class="ruby-value">1</span>][<span class="ruby-identifier">bits</span>(<span class="ruby-identifier">head</span>, <span class="ruby-value">15</span>,<span class="ruby-value">12</span>)<span class="ruby-operator">-</span><span class="ruby-value">1</span>]
510:     <span class="ruby-identifier">samplerate</span> = <span class="ruby-constant">SAMPLERATE</span>[<span class="ruby-identifier">mpeg_version</span>][<span class="ruby-identifier">bits</span>(<span class="ruby-identifier">head</span>, <span class="ruby-value">11</span>,<span class="ruby-value">10</span>)]
511:     <span class="ruby-identifier">padding</span> = (<span class="ruby-identifier">head</span>[<span class="ruby-value">9</span>] <span class="ruby-operator">==</span> <span class="ruby-value">1</span>)
512:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">layer</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span>
513:       <span class="ruby-identifier">size</span> = (<span class="ruby-value">12</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">bitrate</span><span class="ruby-operator">*</span><span class="ruby-value">1000.0</span> <span class="ruby-operator">/</span> <span class="ruby-identifier">samplerate</span> <span class="ruby-operator">+</span> (<span class="ruby-identifier">padding</span> <span class="ruby-value">? </span><span class="ruby-value">1</span> <span class="ruby-operator">:</span> <span class="ruby-value">0</span>))<span class="ruby-operator">*</span><span class="ruby-value">4</span>
514:     <span class="ruby-keyword kw">else</span> <span class="ruby-comment cmt"># layer 2 and 3</span>
515:       <span class="ruby-identifier">size</span> = <span class="ruby-value">144</span> <span class="ruby-operator">*</span> (<span class="ruby-identifier">bitrate</span><span class="ruby-operator">*</span><span class="ruby-value">1000.0</span> <span class="ruby-operator">/</span> <span class="ruby-identifier">samplerate</span>) <span class="ruby-operator">+</span> (<span class="ruby-identifier">padding</span> <span class="ruby-value">? </span><span class="ruby-value">1</span> <span class="ruby-operator">:</span> <span class="ruby-value">0</span>)
516:     <span class="ruby-keyword kw">end</span>
517:     <span class="ruby-identifier">size</span> = <span class="ruby-identifier">size</span>.<span class="ruby-identifier">to_i</span>
518:     { <span class="ruby-identifier">:layer</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">layer</span>,
519:       <span class="ruby-identifier">:bitrate</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">bitrate</span>,
520:       <span class="ruby-identifier">:samplerate</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">samplerate</span>,
521:       <span class="ruby-identifier">:mpeg_version</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">mpeg_version</span>,
522:       <span class="ruby-identifier">:padding</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">padding</span>,
523:       <span class="ruby-identifier">:size</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">size</span> }
524:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    