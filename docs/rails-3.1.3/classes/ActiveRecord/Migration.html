<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>ActiveRecord::Migration</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../css/main.css" type="text/css" media="screen" />
    <script src="../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Class</span> 
            ActiveRecord::Migration 
            
                <span class="parent">&lt; 
                    
                    <a href="../Object.html">Object</a>
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../files/activerecord-3_1_3/lib/active_record/migration/command_recorder_rb.html">activerecord-3.1.3/lib/active_record/migration/command_recorder.rb</a></li>
            
            <li><a href="../../files/activerecord-3_1_3/lib/active_record/migration_rb.html">activerecord-3.1.3/lib/active_record/migration.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    
    <div class="description">
        <h1>Active Record Migrations</h1>
<p>
Migrations can manage the evolution of a schema used by several physical
databases. It&#8217;s a solution to the common problem of adding a field to
make a new feature work in your local database, but being unsure of how to
push that change to other developers and to the production server. With
migrations, you can describe the transformations in self-contained classes
that can be checked into version control systems and executed against
another database that might be one, two, or five versions behind.
</p>
<p>
Example of a simple migration:
</p>
<pre>
  class AddSsl &lt; ActiveRecord::Migration
    def up
      add_column :accounts, :ssl_enabled, :boolean, :default =&gt; 1
    end

    def down
      remove_column :accounts, :ssl_enabled
    end
  end
</pre>
<p>
This migration will add a boolean flag to the accounts table and remove it
if you&#8217;re backing out of the migration. It shows how all migrations
have two methods <tt>up</tt> and <tt>down</tt> that describes the
transformations required to implement or remove the migration. These
methods can consist of both the migration specific methods like add_column
and remove_column, but may also contain regular Ruby code for generating
data needed for the transformations.
</p>
<p>
Example of a more complex migration that also needs to initialize data:
</p>
<pre>
  class AddSystemSettings &lt; ActiveRecord::Migration
    def up
      create_table :system_settings do |t|
        t.string  :name
        t.string  :label
        t.text  :value
        t.string  :type
        t.integer  :position
      end

      SystemSetting.create  :name =&gt; &quot;notice&quot;,
                            :label =&gt; &quot;Use notice?&quot;,
                            :value =&gt; 1
    end

    def down
      drop_table :system_settings
    end
  end
</pre>
<p>
This migration first adds the system_settings table, then creates the very
first row in it using the Active Record model that relies on the table. It
also uses the more advanced create_table syntax where you can specify a
complete table schema in one block call.
</p>
<h2>Available transformations</h2>
<ul>
<li><tt>create_table(name, options)</tt> Creates a table called <tt>name</tt>
and makes the table object available to a block that can then add columns
to it, following the same format as add_column. See example above. The
options hash is for fragments like &#8220;DEFAULT CHARSET=UTF-8&#8221; that
are appended to the create table definition.

</li>
<li><tt>drop_table(name)</tt>: Drops the table called <tt>name</tt>.

</li>
<li><tt>rename_table(old_name, new_name)</tt>: Renames the table called
<tt>old_name</tt> to <tt>new_name</tt>.

</li>
<li><tt>add_column(table_name, column_name, type, options)</tt>: Adds a new
column to the table called <tt>table_name</tt> named <tt>column_name</tt>
specified to be one of the following types: <tt>:string</tt>,
<tt>:text</tt>, <tt>:integer</tt>, <tt>:float</tt>, <tt>:decimal</tt>,
<tt>:datetime</tt>, <tt>:timestamp</tt>, <tt>:time</tt>, <tt>:date</tt>,
<tt>:binary</tt>, <tt>:boolean</tt>. A default value can be specified by
passing an <tt>options</tt> hash like <tt>{ :default =&gt; 11 }</tt>. Other
options include <tt>:limit</tt> and <tt>:null</tt> (e.g. <tt>{ :limit =&gt;
50, :null =&gt; false }</tt>) &#8212; see
ActiveRecord::ConnectionAdapters::TableDefinition#column for details.

</li>
<li><tt>rename_column(table_name, column_name, new_column_name)</tt>: Renames a
column but keeps the type and content.

</li>
<li><tt>change_column(table_name, column_name, type, options)</tt>: Changes the
column to a different type using the same parameters as add_column.

</li>
<li><tt>remove_column(table_name, column_names)</tt>: Removes the column listed
in <tt>column_names</tt> from the table called <tt>table_name</tt>.

</li>
<li><tt>add_index(table_name, column_names, options)</tt>: Adds a new index
with the name of the column. Other options include <tt>:name</tt> and
<tt>:unique</tt> (e.g. <tt>{ :name =&gt; &quot;users_name_index&quot;,
:unique =&gt; true }</tt>).

</li>
<li><tt>remove_index(table_name, :column =&gt; column_name)</tt>: Removes the
index specified by <tt>column_name</tt>.

</li>
<li><tt>remove_index(table_name, :name =&gt; index_name)</tt>: Removes the
index specified by <tt>index_name</tt>.

</li>
</ul>
<h2>Irreversible transformations</h2>
<p>
Some transformations are destructive in a manner that cannot be reversed.
Migrations of that kind should raise an
<tt>ActiveRecord::IrreversibleMigration</tt> exception in their
<tt>down</tt> method.
</p>
<h2>Running migrations from within <a href="../Rails.html">Rails</a></h2>
<p>
The <a href="../Rails.html">Rails</a> package has several tools to help
create and apply migrations.
</p>
<p>
To generate a new migration, you can use
</p>
<pre>
  rails generate migration MyNewMigration
</pre>
<p>
where MyNewMigration is the name of your migration. The generator will
create an empty migration file <tt>timestamp_my_new_migration.rb</tt> in
the <tt>db/migrate/</tt> directory where <tt>timestamp</tt> is the UTC
formatted date and time that the migration was generated.
</p>
<p>
You may then edit the <tt>up</tt> and <tt>down</tt> methods of
MyNewMigration.
</p>
<p>
There is a special syntactic shortcut to generate migrations that add
fields to a table.
</p>
<pre>
  rails generate migration add_fieldname_to_tablename fieldname:string
</pre>
<p>
This will generate the file <tt>timestamp_add_fieldname_to_tablename</tt>,
which will look like this:
</p>
<pre>
  class AddFieldnameToTablename &lt; ActiveRecord::Migration
    def up
      add_column :tablenames, :fieldname, :string
    end

    def down
      remove_column :tablenames, :fieldname
    end
  end
</pre>
<p>
To run migrations against the currently configured database, use <tt>rake
db:migrate</tt>. This will update the database by running all of the
pending migrations, creating the <tt>schema_migrations</tt> table (see
&#8220;About the schema_migrations table&#8221; section below) if missing.
It will also invoke the db:schema:dump task, which will update your
db/schema.rb file to match the structure of your database.
</p>
<p>
To roll the database back to a previous migration version, use <tt>rake
db:migrate VERSION=X</tt> where <tt>X</tt> is the version to which you wish
to downgrade. If any of the migrations throw an
<tt>ActiveRecord::IrreversibleMigration</tt> exception, that step will fail
and you&#8217;ll have some manual work to do.
</p>
<h2>Database support</h2>
<p>
Migrations are currently supported in MySQL, PostgreSQL, SQLite, SQL
Server, Sybase, and Oracle (all supported databases except DB2).
</p>
<h2>More examples</h2>
<p>
Not all migrations change the schema. Some just fix the data:
</p>
<pre>
  class RemoveEmptyTags &lt; ActiveRecord::Migration
    def up
      Tag.find(:all).each { |tag| tag.destroy if tag.pages.empty? }
    end

    def down
      # not much we can do to restore deleted data
      raise ActiveRecord::IrreversibleMigration, &quot;Can't recover the deleted tags&quot;
    end
  end
</pre>
<p>
Others remove columns when they migrate up instead of down:
</p>
<pre>
  class RemoveUnnecessaryItemAttributes &lt; ActiveRecord::Migration
    def up
      remove_column :items, :incomplete_items_count
      remove_column :items, :completed_items_count
    end

    def down
      add_column :items, :incomplete_items_count
      add_column :items, :completed_items_count
    end
  end
</pre>
<p>
And sometimes you need to do something in SQL not abstracted directly by
migrations:
</p>
<pre>
  class MakeJoinUnique &lt; ActiveRecord::Migration
    def up
      execute &quot;ALTER TABLE `pages_linked_pages` ADD UNIQUE `page_id_linked_page_id` (`page_id`,`linked_page_id`)&quot;
    end

    def down
      execute &quot;ALTER TABLE `pages_linked_pages` DROP INDEX `page_id_linked_page_id`&quot;
    end
  end
</pre>
<h2>Using a model after changing its table</h2>
<p>
Sometimes you&#8217;ll want to add a column in a migration and populate it
immediately after. In that case, you&#8217;ll need to make a call to <tt><a
href="Base.html#M000954">Base#reset_column_information</a></tt> in order to
ensure that the model has the latest column data from after the new column
was added. Example:
</p>
<pre>
  class AddPeopleSalary &lt; ActiveRecord::Migration
    def up
      add_column :people, :salary, :integer
      Person.reset_column_information
      Person.find(:all).each do |p|
        p.update_attribute :salary, SalaryCalculator.compute(p)
      end
    end
  end
</pre>
<h2>Controlling verbosity</h2>
<p>
By default, migrations will describe the actions they are taking, writing
them to the console as they happen, along with benchmarks describing how
long each step took.
</p>
<p>
You can quiet them down by setting ActiveRecord::Migration.verbose = false.
</p>
<p>
You can also insert your own messages and benchmarks by using the <tt><a
href="Migration.html#M001542">say_with_time</a></tt> method:
</p>
<pre>
  def up
    ...
    say_with_time &quot;Updating salaries...&quot; do
      Person.find(:all).each do |p|
        p.update_attribute :salary, SalaryCalculator.compute(p)
      end
    end
    ...
  end
</pre>
<p>
The phrase &#8220;Updating salaries...&#8220; would then be printed, along
with the benchmark for the block when the block completes.
</p>
<h2>About the schema_migrations table</h2>
<p>
<a href="../Rails.html">Rails</a> versions 2.0 and prior used to create a
table called <tt>schema_info</tt> when using migrations. This table
contained the version of the schema as of the last applied migration.
</p>
<p>
Starting with <a href="../Rails.html">Rails</a> 2.1, the
<tt>schema_info</tt> table is (automatically) replaced by the
<tt>schema_migrations</tt> table, which contains the version numbers of all
the migrations applied.
</p>
<p>
As a result, it is now possible to add migration files that are numbered
lower than the current schema version: when migrating up, those
never-applied &#8220;interleaved&#8221; migrations will be automatically
applied, and when migrating down, never-applied &#8220;interleaved&#8221;
migrations will be skipped.
</p>
<h2>Timestamped Migrations</h2>
<p>
By default, <a href="../Rails.html">Rails</a> generates migrations that
look like:
</p>
<pre>
   20080717013526_your_migration_name.rb
</pre>
<p>
The prefix is a generation timestamp (in UTC).
</p>
<p>
If you&#8217;d prefer to use numeric prefixes, you can turn timestamped
migrations off by setting:
</p>
<pre>
   config.active_record.timestamped_migrations = false
</pre>
<p>
In application.rb.
</p>
<h2>Reversible Migrations</h2>
<p>
Starting with <a href="../Rails.html">Rails</a> 3.1, you will be able to
define reversible migrations. Reversible migrations are migrations that
know how to go <tt>down</tt> for you. You simply supply the <tt>up</tt>
logic, and the <a href="Migration.html">Migration</a> system will figure
out how to execute the down commands for you.
</p>
<p>
To define a reversible migration, define the <tt>change</tt> method in your
migration like this:
</p>
<pre>
  class TenderloveMigration &lt; ActiveRecord::Migration
    def change
      create_table(:horses) do
        t.column :content, :text
        t.column :remind_at, :datetime
      end
    end
  end
</pre>
<p>
This migration will create the horses table for you on the way up, and
automatically figure out how to drop the table on the way down.
</p>
<p>
Some commands like <tt>remove_column</tt> cannot be reversed. If you care
to define how to move up and down in these cases, you should define the
<tt>up</tt> and <tt>down</tt> methods as before.
</p>
<p>
If a command cannot be reversed, an
<tt>ActiveRecord::IrreversibleMigration</tt> exception will be raised when
the migration is moving down.
</p>
<p>
For a list of commands that are reversible, please see
<tt>ActiveRecord::Migration::CommandRecorder</tt>.
</p>

    </div>
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>A</dt>
        <dd>
            <ul>
                
                <li><a href="#M001540">announce</a></li>
                
            </ul>
        </dd>
    
        <dt>C</dt>
        <dd>
            <ul>
                
                <li><a href="#M001544">connection</a>,</li>
                
                <li><a href="#M001546">copy</a></li>
                
            </ul>
        </dd>
    
        <dt>D</dt>
        <dd>
            <ul>
                
                <li><a href="#M001537">down</a></li>
                
            </ul>
        </dd>
    
        <dt>M</dt>
        <dd>
            <ul>
                
                <li><a href="#M001545">method_missing</a>,</li>
                
                <li><a href="#M001538">migrate</a>,</li>
                
                <li><a href="#M001534">migrate</a></li>
                
            </ul>
        </dd>
    
        <dt>N</dt>
        <dd>
            <ul>
                
                <li><a href="#M001535">new</a>,</li>
                
                <li><a href="#M001547">next_migration_number</a></li>
                
            </ul>
        </dd>
    
        <dt>S</dt>
        <dd>
            <ul>
                
                <li><a href="#M001541">say</a>,</li>
                
                <li><a href="#M001542">say_with_time</a>,</li>
                
                <li><a href="#M001543">suppress_messages</a></li>
                
            </ul>
        </dd>
    
        <dt>U</dt>
        <dd>
            <ul>
                
                <li><a href="#M001536">up</a></li>
                
            </ul>
        </dd>
    
        <dt>W</dt>
        <dd>
            <ul>
                
                <li><a href="#M001539">write</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    

    

    
    <div class="sectiontitle">Classes and Modules</div>
    <ul>
        
        <li><span class="type">CLASS</span> <a href="Migration/CommandRecorder.html">ActiveRecord::Migration::CommandRecorder</a></li>
        
    </ul>
    

    

    
    <div class="sectiontitle">Attributes</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>name</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>version</td>
            <td class='attr-desc'></td>
        </tr>
        
    </table>
    

    
            <div class="sectiontitle">Class Public methods</div>
            
            <div class="method">
                <div class="title" id="M001534">
                    
                    <a name="M001534"></a><b>migrate</b>(direction)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001534_source')" id="l_M001534_source">show</a>
                        
                    </p>
                    <div id="M001534_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activerecord-3.1.3/lib/active_record/migration.rb, line 335</span>
335:     <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">migrate</span>(<span class="ruby-identifier">direction</span>)
336:       <span class="ruby-identifier">new</span>.<span class="ruby-identifier">migrate</span> <span class="ruby-identifier">direction</span>
337:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001535">
                    
                    <a name="M001535"></a><b>new</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001535_source')" id="l_M001535_source">show</a>
                        
                    </p>
                    <div id="M001535_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activerecord-3.1.3/lib/active_record/migration.rb, line 343</span>
343:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>
344:       <span class="ruby-ivar">@name</span>       = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">name</span>
345:       <span class="ruby-ivar">@version</span>    = <span class="ruby-keyword kw">nil</span>
346:       <span class="ruby-ivar">@connection</span> = <span class="ruby-keyword kw">nil</span>
347:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M001540">
                    
                    <a name="M001540"></a><b>announce</b>(message)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001540_source')" id="l_M001540_source">show</a>
                        
                    </p>
                    <div id="M001540_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activerecord-3.1.3/lib/active_record/migration.rb, line 409</span>
409:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">announce</span>(<span class="ruby-identifier">message</span>)
410:       <span class="ruby-identifier">text</span> = <span class="ruby-node">&quot;#{version} #{name}: #{message}&quot;</span>
411:       <span class="ruby-identifier">length</span> = [<span class="ruby-value">0</span>, <span class="ruby-value">75</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">text</span>.<span class="ruby-identifier">length</span>].<span class="ruby-identifier">max</span>
412:       <span class="ruby-identifier">write</span> <span class="ruby-value str">&quot;== %s %s&quot;</span> <span class="ruby-operator">%</span> [<span class="ruby-identifier">text</span>, <span class="ruby-value str">&quot;=&quot;</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">length</span>]
413:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001544">
                    
                    <a name="M001544"></a><b>connection</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001544_source')" id="l_M001544_source">show</a>
                        
                    </p>
                    <div id="M001544_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activerecord-3.1.3/lib/active_record/migration.rb, line 435</span>
435:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">connection</span>
436:       <span class="ruby-ivar">@connection</span> <span class="ruby-operator">||</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>
437:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001546">
                    
                    <a name="M001546"></a><b>copy</b>(destination, sources, options = {})
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001546_source')" id="l_M001546_source">show</a>
                        
                    </p>
                    <div id="M001546_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activerecord-3.1.3/lib/active_record/migration.rb, line 451</span>
451:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">copy</span>(<span class="ruby-identifier">destination</span>, <span class="ruby-identifier">sources</span>, <span class="ruby-identifier">options</span> = {})
452:       <span class="ruby-identifier">copied</span> = []
453: 
454:       <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span>(<span class="ruby-identifier">destination</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-identifier">destination</span>)
455: 
456:       <span class="ruby-identifier">destination_migrations</span> = <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">migrations</span>(<span class="ruby-identifier">destination</span>)
457:       <span class="ruby-identifier">last</span> = <span class="ruby-identifier">destination_migrations</span>.<span class="ruby-identifier">last</span>
458:       <span class="ruby-identifier">sources</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">name</span>, <span class="ruby-identifier">path</span><span class="ruby-operator">|</span>
459:         <span class="ruby-identifier">source_migrations</span> = <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">migrations</span>(<span class="ruby-identifier">path</span>)
460: 
461:         <span class="ruby-identifier">source_migrations</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">migration</span><span class="ruby-operator">|</span>
462:           <span class="ruby-identifier">source</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span>(<span class="ruby-identifier">migration</span>.<span class="ruby-identifier">filename</span>)
463:           <span class="ruby-identifier">source</span> = <span class="ruby-node">&quot;# This migration comes from #{name} (originally #{migration.version})\n#{source}&quot;</span>
464: 
465:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">duplicate</span> = <span class="ruby-identifier">destination_migrations</span>.<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">m</span><span class="ruby-operator">|</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">migration</span>.<span class="ruby-identifier">name</span> }
466:             <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:on_skip</span>].<span class="ruby-identifier">call</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">migration</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span>(<span class="ruby-identifier">duplicate</span>.<span class="ruby-identifier">filename</span>) <span class="ruby-operator">!=</span> <span class="ruby-identifier">source</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:on_skip</span>]
467:             <span class="ruby-keyword kw">next</span>
468:           <span class="ruby-keyword kw">end</span>
469: 
470:           <span class="ruby-identifier">migration</span>.<span class="ruby-identifier">version</span> = <span class="ruby-identifier">next_migration_number</span>(<span class="ruby-identifier">last</span> <span class="ruby-value">? </span><span class="ruby-identifier">last</span>.<span class="ruby-identifier">version</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span> <span class="ruby-operator">:</span> <span class="ruby-value">0</span>).<span class="ruby-identifier">to_i</span>
471:           <span class="ruby-identifier">new_path</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">destination</span>, <span class="ruby-node">&quot;#{migration.version}_#{migration.name.underscore}.rb&quot;</span>)
472:           <span class="ruby-identifier">old_path</span>, <span class="ruby-identifier">migration</span>.<span class="ruby-identifier">filename</span> = <span class="ruby-identifier">migration</span>.<span class="ruby-identifier">filename</span>, <span class="ruby-identifier">new_path</span>
473:           <span class="ruby-identifier">last</span> = <span class="ruby-identifier">migration</span>
474: 
475:           <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">cp</span>(<span class="ruby-identifier">old_path</span>, <span class="ruby-identifier">migration</span>.<span class="ruby-identifier">filename</span>)
476:           <span class="ruby-identifier">copied</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">migration</span>
477:           <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:on_copy</span>].<span class="ruby-identifier">call</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">migration</span>, <span class="ruby-identifier">old_path</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:on_copy</span>]
478:           <span class="ruby-identifier">destination_migrations</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">migration</span>
479:         <span class="ruby-keyword kw">end</span>
480:       <span class="ruby-keyword kw">end</span>
481: 
482:       <span class="ruby-identifier">copied</span>
483:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001537">
                    
                    <a name="M001537"></a><b>down</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001537_source')" id="l_M001537_source">show</a>
                        
                    </p>
                    <div id="M001537_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activerecord-3.1.3/lib/active_record/migration.rb, line 359</span>
359:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">down</span>
360:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">delegate</span> = <span class="ruby-keyword kw">self</span>
361:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:down</span>)
362:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">down</span>
363:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001545">
                    
                    <a name="M001545"></a><b>method_missing</b>(method, *arguments, &amp;block)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001545_source')" id="l_M001545_source">show</a>
                        
                    </p>
                    <div id="M001545_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activerecord-3.1.3/lib/active_record/migration.rb, line 439</span>
439:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">method_missing</span>(<span class="ruby-identifier">method</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">arguments</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
440:       <span class="ruby-identifier">arg_list</span> = <span class="ruby-identifier">arguments</span>.<span class="ruby-identifier">map</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">inspect</span> } <span class="ruby-operator">*</span> <span class="ruby-value str">', '</span>
441: 
442:       <span class="ruby-identifier">say_with_time</span> <span class="ruby-node">&quot;#{method}(#{arg_list})&quot;</span> <span class="ruby-keyword kw">do</span>
443:         <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">arguments</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">method</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:execute</span>
444:           <span class="ruby-identifier">arguments</span>[<span class="ruby-value">0</span>] = <span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">proper_table_name</span>(<span class="ruby-identifier">arguments</span>.<span class="ruby-identifier">first</span>)
445:         <span class="ruby-keyword kw">end</span>
446:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">super</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">method</span>)
447:         <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">method</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">arguments</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
448:       <span class="ruby-keyword kw">end</span>
449:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001538">
                    
                    <a name="M001538"></a><b>migrate</b>(direction)
                    
                </div>
                
                <div class="description">
                  <p>
Execute this migration in the named direction
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001538_source')" id="l_M001538_source">show</a>
                        
                    </p>
                    <div id="M001538_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activerecord-3.1.3/lib/active_record/migration.rb, line 366</span>
366:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">migrate</span>(<span class="ruby-identifier">direction</span>)
367:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">direction</span>)
368: 
369:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">direction</span>
370:       <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:up</span>   <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">announce</span> <span class="ruby-value str">&quot;migrating&quot;</span>
371:       <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:down</span> <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">announce</span> <span class="ruby-value str">&quot;reverting&quot;</span>
372:       <span class="ruby-keyword kw">end</span>
373: 
374:       <span class="ruby-identifier">time</span>   = <span class="ruby-keyword kw">nil</span>
375:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection_pool</span>.<span class="ruby-identifier">with_connection</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">conn</span><span class="ruby-operator">|</span>
376:         <span class="ruby-ivar">@connection</span> = <span class="ruby-identifier">conn</span>
377:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:change</span>)
378:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">direction</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:down</span>
379:             <span class="ruby-identifier">recorder</span> = <span class="ruby-constant">CommandRecorder</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@connection</span>)
380:             <span class="ruby-identifier">suppress_messages</span> <span class="ruby-keyword kw">do</span>
381:               <span class="ruby-ivar">@connection</span> = <span class="ruby-identifier">recorder</span>
382:               <span class="ruby-identifier">change</span>
383:             <span class="ruby-keyword kw">end</span>
384:             <span class="ruby-ivar">@connection</span> = <span class="ruby-identifier">conn</span>
385:             <span class="ruby-identifier">time</span> = <span class="ruby-constant">Benchmark</span>.<span class="ruby-identifier">measure</span> {
386:               <span class="ruby-identifier">recorder</span>.<span class="ruby-identifier">inverse</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">cmd</span>, <span class="ruby-identifier">args</span><span class="ruby-operator">|</span>
387:                 <span class="ruby-identifier">send</span>(<span class="ruby-identifier">cmd</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
388:               <span class="ruby-keyword kw">end</span>
389:             }
390:           <span class="ruby-keyword kw">else</span>
391:             <span class="ruby-identifier">time</span> = <span class="ruby-constant">Benchmark</span>.<span class="ruby-identifier">measure</span> { <span class="ruby-identifier">change</span> }
392:           <span class="ruby-keyword kw">end</span>
393:         <span class="ruby-keyword kw">else</span>
394:           <span class="ruby-identifier">time</span> = <span class="ruby-constant">Benchmark</span>.<span class="ruby-identifier">measure</span> { <span class="ruby-identifier">send</span>(<span class="ruby-identifier">direction</span>) }
395:         <span class="ruby-keyword kw">end</span>
396:         <span class="ruby-ivar">@connection</span> = <span class="ruby-keyword kw">nil</span>
397:       <span class="ruby-keyword kw">end</span>
398: 
399:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">direction</span>
400:       <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:up</span>   <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">announce</span> <span class="ruby-value str">&quot;migrated (%.4fs)&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">time</span>.<span class="ruby-identifier">real</span>; <span class="ruby-identifier">write</span>
401:       <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:down</span> <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">announce</span> <span class="ruby-value str">&quot;reverted (%.4fs)&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">time</span>.<span class="ruby-identifier">real</span>; <span class="ruby-identifier">write</span>
402:       <span class="ruby-keyword kw">end</span>
403:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001547">
                    
                    <a name="M001547"></a><b>next_migration_number</b>(number)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001547_source')" id="l_M001547_source">show</a>
                        
                    </p>
                    <div id="M001547_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activerecord-3.1.3/lib/active_record/migration.rb, line 485</span>
485:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">next_migration_number</span>(<span class="ruby-identifier">number</span>)
486:       <span class="ruby-keyword kw">if</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">timestamped_migrations</span>
487:         [<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">utc</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-value str">&quot;%Y%m%d%H%M%S&quot;</span>), <span class="ruby-value str">&quot;%.14d&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">number</span>].<span class="ruby-identifier">max</span>
488:       <span class="ruby-keyword kw">else</span>
489:         <span class="ruby-value str">&quot;%.3d&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">number</span>
490:       <span class="ruby-keyword kw">end</span>
491:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001541">
                    
                    <a name="M001541"></a><b>say</b>(message, subitem=false)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001541_source')" id="l_M001541_source">show</a>
                        
                    </p>
                    <div id="M001541_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activerecord-3.1.3/lib/active_record/migration.rb, line 415</span>
415:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">say</span>(<span class="ruby-identifier">message</span>, <span class="ruby-identifier">subitem</span>=<span class="ruby-keyword kw">false</span>)
416:       <span class="ruby-identifier">write</span> <span class="ruby-node">&quot;#{subitem ? &quot;   -&gt;&quot; : &quot;--&quot;} #{message}&quot;</span>
417:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001542">
                    
                    <a name="M001542"></a><b>say_with_time</b>(message)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001542_source')" id="l_M001542_source">show</a>
                        
                    </p>
                    <div id="M001542_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activerecord-3.1.3/lib/active_record/migration.rb, line 419</span>
419:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">say_with_time</span>(<span class="ruby-identifier">message</span>)
420:       <span class="ruby-identifier">say</span>(<span class="ruby-identifier">message</span>)
421:       <span class="ruby-identifier">result</span> = <span class="ruby-keyword kw">nil</span>
422:       <span class="ruby-identifier">time</span> = <span class="ruby-constant">Benchmark</span>.<span class="ruby-identifier">measure</span> { <span class="ruby-identifier">result</span> = <span class="ruby-keyword kw">yield</span> }
423:       <span class="ruby-identifier">say</span> <span class="ruby-value str">&quot;%.4fs&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">time</span>.<span class="ruby-identifier">real</span>, <span class="ruby-identifier">:subitem</span>
424:       <span class="ruby-identifier">say</span>(<span class="ruby-node">&quot;#{result} rows&quot;</span>, <span class="ruby-identifier">:subitem</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">result</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Integer</span>)
425:       <span class="ruby-identifier">result</span>
426:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001543">
                    
                    <a name="M001543"></a><b>suppress_messages</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001543_source')" id="l_M001543_source">show</a>
                        
                    </p>
                    <div id="M001543_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activerecord-3.1.3/lib/active_record/migration.rb, line 428</span>
428:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">suppress_messages</span>
429:       <span class="ruby-identifier">save</span>, <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">verbose</span> = <span class="ruby-identifier">verbose</span>, <span class="ruby-keyword kw">false</span>
430:       <span class="ruby-keyword kw">yield</span>
431:     <span class="ruby-keyword kw">ensure</span>
432:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">verbose</span> = <span class="ruby-identifier">save</span>
433:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001536">
                    
                    <a name="M001536"></a><b>up</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001536_source')" id="l_M001536_source">show</a>
                        
                    </p>
                    <div id="M001536_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activerecord-3.1.3/lib/active_record/migration.rb, line 353</span>
353:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">up</span>
354:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">delegate</span> = <span class="ruby-keyword kw">self</span>
355:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:up</span>)
356:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">up</span>
357:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001539">
                    
                    <a name="M001539"></a><b>write</b>(text=&quot;&quot;)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001539_source')" id="l_M001539_source">show</a>
                        
                    </p>
                    <div id="M001539_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activerecord-3.1.3/lib/active_record/migration.rb, line 405</span>
405:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">write</span>(<span class="ruby-identifier">text</span>=<span class="ruby-value str">&quot;&quot;</span>)
406:       <span class="ruby-identifier">puts</span>(<span class="ruby-identifier">text</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">verbose</span>
407:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    