<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>ActiveSupport::ClassMethods</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../css/main.css" type="text/css" media="screen" />
    <script src="../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Module</span> 
            ActiveSupport::ClassMethods 
            
        </h1>
        <ul class="files">
            
            <li><a href="../../files/activesupport-3_1_3/lib/active_support/callbacks_rb.html">activesupport-3.1.3/lib/active_support/callbacks.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>D</dt>
        <dd>
            <ul>
                
                <li><a href="#M002093">define_callbacks</a></li>
                
            </ul>
        </dd>
    
        <dt>R</dt>
        <dd>
            <ul>
                
                <li><a href="#M002092">reset_callbacks</a></li>
                
            </ul>
        </dd>
    
        <dt>S</dt>
        <dd>
            <ul>
                
                <li><a href="#M002082">set_callback</a>,</li>
                
                <li><a href="#M002090">skip_callback</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    

    

    

    

    

    
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M002093">
                    
                    <a name="M002093"></a><b>define_callbacks</b>(*callbacks)
                    
                </div>
                
                <div class="description">
                  <p>
Define sets of events in the object lifecycle that support callbacks.
</p>
<pre>
  define_callbacks :validate
  define_callbacks :initialize, :save, :destroy
</pre>
<h5>Options</h5>
<ul>
<li><tt>:terminator</tt> - Determines when a before filter will halt the
callback chain, preventing following callbacks from being called and the
event from being triggered. This is a string to be eval&#8217;ed. The
result of the callback is available in the <tt>result</tt> variable.

<pre>
  define_callbacks :validate, :terminator =&gt; &quot;result == false&quot;
</pre>
<p>
In this example, if any before validate callbacks returns <tt>false</tt>,
other callbacks are not executed. Defaults to &#8220;false&#8221;, meaning
no value halts the chain.
</p>
</li>
<li><tt>:rescuable</tt> - By default, after filters are not executed if the
given block or a before filter raises an error. By setting this option to
<tt>true</tt> exception raised by given block is stored and after executing
all the after callbacks the stored exception is raised.

</li>
<li><tt>:scope</tt> - Indicates which methods should be executed when an object
is used as a callback.

<pre>
  class Audit
    def before(caller)
      puts 'Audit: before is called'
    end

    def before_save(caller)
      puts 'Audit: before_save is called'
    end
  end

  class Account
    include ActiveSupport::Callbacks

    define_callbacks :save
    set_callback :save, :before, Audit.new

    def save
      run_callbacks :save do
        puts 'save in main'
      end
    end
  end
</pre>
<p>
In the above case whenever you save an account the method
<tt>Audit#before</tt> will be called. On the other hand
</p>
<pre>
  define_callbacks :save, :scope =&gt; [:kind, :name]
</pre>
<p>
would trigger <tt>Audit#before_save</tt> instead. That&#8217;s constructed
by calling <tt>#{kind}_#{name}</tt> on the given instance. In this case
&#8220;kind&#8221; is &#8220;before&#8221; and &#8220;name&#8221; is
&#8220;save&#8221;. In this context <tt>:kind</tt> and <tt>:name</tt> have
special meanings: <tt>:kind</tt> refers to the kind of callback
(before/after/around) and <tt>:name</tt> refers to the method on which
callbacks are being defined.
</p>
<p>
A declaration like
</p>
<pre>
  define_callbacks :save, :scope =&gt; [:name]
</pre>
<p>
would call <tt>Audit#save</tt>.
</p>
</li>
</ul>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M002093_source')" id="l_M002093_source">show</a>
                        
                    </p>
                    <div id="M002093_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activesupport-3.1.3/lib/active_support/callbacks.rb, line 619</span>
619:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">define_callbacks</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">callbacks</span>)
620:         <span class="ruby-identifier">config</span> = <span class="ruby-identifier">callbacks</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Hash</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">callbacks</span>.<span class="ruby-identifier">pop</span> <span class="ruby-operator">:</span> {}
621:         <span class="ruby-identifier">callbacks</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">callback</span><span class="ruby-operator">|</span>
622:           <span class="ruby-identifier">class_attribute</span> <span class="ruby-node">&quot;_#{callback}_callbacks&quot;</span>
623:           <span class="ruby-identifier">send</span>(<span class="ruby-node">&quot;_#{callback}_callbacks=&quot;</span>, <span class="ruby-constant">CallbackChain</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">callback</span>, <span class="ruby-identifier">config</span>))
624:           <span class="ruby-identifier">__define_runner</span>(<span class="ruby-identifier">callback</span>)
625:         <span class="ruby-keyword kw">end</span>
626:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M002092">
                    
                    <a name="M002092"></a><b>reset_callbacks</b>(symbol)
                    
                </div>
                
                <div class="description">
                  <p>
Remove all set callbacks for the given event.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M002092_source')" id="l_M002092_source">show</a>
                        
                    </p>
                    <div id="M002092_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activesupport-3.1.3/lib/active_support/callbacks.rb, line 538</span>
538:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">reset_callbacks</span>(<span class="ruby-identifier">symbol</span>)
539:         <span class="ruby-identifier">callbacks</span> = <span class="ruby-identifier">send</span>(<span class="ruby-node">&quot;_#{symbol}_callbacks&quot;</span>)
540: 
541:         <span class="ruby-constant">ActiveSupport</span><span class="ruby-operator">::</span><span class="ruby-constant">DescendantsTracker</span>.<span class="ruby-identifier">descendants</span>(<span class="ruby-keyword kw">self</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">target</span><span class="ruby-operator">|</span>
542:           <span class="ruby-identifier">chain</span> = <span class="ruby-identifier">target</span>.<span class="ruby-identifier">send</span>(<span class="ruby-node">&quot;_#{symbol}_callbacks&quot;</span>).<span class="ruby-identifier">dup</span>
543:           <span class="ruby-identifier">callbacks</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">chain</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">c</span>) }
544:           <span class="ruby-identifier">target</span>.<span class="ruby-identifier">send</span>(<span class="ruby-node">&quot;_#{symbol}_callbacks=&quot;</span>, <span class="ruby-identifier">chain</span>)
545:           <span class="ruby-identifier">target</span>.<span class="ruby-identifier">__define_runner</span>(<span class="ruby-identifier">symbol</span>)
546:         <span class="ruby-keyword kw">end</span>
547: 
548:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">send</span>(<span class="ruby-node">&quot;_#{symbol}_callbacks=&quot;</span>, <span class="ruby-identifier">callbacks</span>.<span class="ruby-identifier">dup</span>.<span class="ruby-identifier">clear</span>)
549: 
550:         <span class="ruby-identifier">__define_runner</span>(<span class="ruby-identifier">symbol</span>)
551:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M002082">
                    
                    <a name="M002082"></a><b>set_callback</b>(name, *filter_list, &amp;block)
                    
                </div>
                
                <div class="description">
                  <p>
Install a callback for the given event.
</p>
<pre>
  set_callback :save, :before, :before_meth
  set_callback :save, :after,  :after_meth, :if =&gt; :condition
  set_callback :save, :around, lambda { |r| stuff; result = yield; stuff }
</pre>
<p>
The second arguments indicates whether the callback is to be run
<tt>:before</tt>, <tt>:after</tt>, or <tt>:around</tt> the event. If
omitted, <tt>:before</tt> is assumed. This means the first example above
can also be written as:
</p>
<pre>
  set_callback :save, :before_meth
</pre>
<p>
The callback can specified as a symbol naming an instance method; as a
proc, lambda, or block; as a string to be instance evaluated; or as an
object that responds to a certain method determined by the <tt>:scope</tt>
argument to <tt>define_callback</tt>.
</p>
<p>
If a proc, lambda, or block is given, its body is evaluated in the context
of the current object. It can also optionally accept the current object as
an argument.
</p>
<p>
Before and around callbacks are called in the order that they are set;
after callbacks are called in the reverse order.
</p>
<p>
Around callbacks can access the return value from the event, if it
wasn&#8217;t halted, from the <tt>yield</tt> call.
</p>
<h5>Options</h5>
<ul>
<li><tt>:if</tt> - A symbol naming an instance method or a proc; the callback
will be called only when it returns a true value.

</li>
<li><tt>:unless</tt> - A symbol naming an instance method or a proc; the
callback will be called only when it returns a false value.

</li>
<li><tt>:prepend</tt> - If true, the callback will be prepended to the existing
chain rather than appended.

</li>
<li><tt>:per_key</tt> - A hash with <tt>:if</tt> and <tt>:unless</tt> options;
see &#8220;Per-key conditions&#8221; below.

</li>
</ul>
<h5>Per-key conditions</h5>
<p>
When creating or skipping callbacks, you can specify conditions that are
always the same for a given key. For instance, in Action Pack, we convert
:only and :except conditions into per-key conditions.
</p>
<pre>
  before_filter :authenticate, :except =&gt; &quot;index&quot;
</pre>
<p>
becomes
</p>
<pre>
  set_callback :process_action, :before, :authenticate, :per_key =&gt; {:unless =&gt; proc {|c| c.action_name == &quot;index&quot;}}
</pre>
<p>
Per-key conditions are evaluated only once per use of a given key. In the
case of the above example, you would do:
</p>
<pre>
  run_callbacks(:process_action, action_name) { ... dispatch stuff ... }
</pre>
<p>
In that case, each action_name would get its own compiled callback method
that took into consideration the per_key conditions. This is a speed
improvement for ActionPack.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M002082_source')" id="l_M002082_source">show</a>
                        
                    </p>
                    <div id="M002082_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activesupport-3.1.3/lib/active_support/callbacks.rb, line 494</span>
494:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set_callback</span>(<span class="ruby-identifier">name</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">filter_list</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
495:         <span class="ruby-identifier">mapped</span> = <span class="ruby-keyword kw">nil</span>
496: 
497:         <span class="ruby-identifier">__update_callbacks</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">filter_list</span>, <span class="ruby-identifier">block</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">target</span>, <span class="ruby-identifier">chain</span>, <span class="ruby-identifier">type</span>, <span class="ruby-identifier">filters</span>, <span class="ruby-identifier">options</span><span class="ruby-operator">|</span>
498:           <span class="ruby-identifier">mapped</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">filters</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">filter</span><span class="ruby-operator">|</span>
499:             <span class="ruby-constant">Callback</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">chain</span>, <span class="ruby-identifier">filter</span>, <span class="ruby-identifier">type</span>, <span class="ruby-identifier">options</span>.<span class="ruby-identifier">dup</span>, <span class="ruby-keyword kw">self</span>)
500:           <span class="ruby-keyword kw">end</span>
501: 
502:           <span class="ruby-identifier">filters</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">filter</span><span class="ruby-operator">|</span>
503:             <span class="ruby-identifier">chain</span>.<span class="ruby-identifier">delete_if</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">matches?</span>(<span class="ruby-identifier">type</span>, <span class="ruby-identifier">filter</span>) }
504:           <span class="ruby-keyword kw">end</span>
505: 
506:           <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:prepend</span>] <span class="ruby-operator">?</span> <span class="ruby-identifier">chain</span>.<span class="ruby-identifier">unshift</span>(<span class="ruby-operator">*</span>(<span class="ruby-identifier">mapped</span>.<span class="ruby-identifier">reverse</span>)) <span class="ruby-operator">:</span> <span class="ruby-identifier">chain</span>.<span class="ruby-identifier">push</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">mapped</span>)
507: 
508:           <span class="ruby-identifier">target</span>.<span class="ruby-identifier">send</span>(<span class="ruby-node">&quot;_#{name}_callbacks=&quot;</span>, <span class="ruby-identifier">chain</span>)
509:         <span class="ruby-keyword kw">end</span>
510:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M002090">
                    
                    <a name="M002090"></a><b>skip_callback</b>(name, *filter_list, &amp;block)
                    
                </div>
                
                <div class="description">
                  <p>
Skip a previously set callback. Like <tt><a
href="ClassMethods.html#M002082">set_callback</a></tt>, <tt>:if</tt> or
<tt>:unless</tt> options may be passed in order to control when the
callback is skipped.
</p>
<pre>
  class Writer &lt; Person
     skip_callback :validate, :before, :check_membership, :if =&gt; lambda { self.age &gt; 18 }
  end
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M002090_source')" id="l_M002090_source">show</a>
                        
                    </p>
                    <div id="M002090_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File activesupport-3.1.3/lib/active_support/callbacks.rb, line 519</span>
519:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">skip_callback</span>(<span class="ruby-identifier">name</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">filter_list</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
520:         <span class="ruby-identifier">__update_callbacks</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">filter_list</span>, <span class="ruby-identifier">block</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">target</span>, <span class="ruby-identifier">chain</span>, <span class="ruby-identifier">type</span>, <span class="ruby-identifier">filters</span>, <span class="ruby-identifier">options</span><span class="ruby-operator">|</span>
521:           <span class="ruby-identifier">filters</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">filter</span><span class="ruby-operator">|</span>
522:             <span class="ruby-identifier">filter</span> = <span class="ruby-identifier">chain</span>.<span class="ruby-identifier">find</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">matches?</span>(<span class="ruby-identifier">type</span>, <span class="ruby-identifier">filter</span>) }
523: 
524:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">filter</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">options</span>.<span class="ruby-identifier">any?</span>
525:               <span class="ruby-identifier">new_filter</span> = <span class="ruby-identifier">filter</span>.<span class="ruby-identifier">clone</span>(<span class="ruby-identifier">chain</span>, <span class="ruby-keyword kw">self</span>)
526:               <span class="ruby-identifier">chain</span>.<span class="ruby-identifier">insert</span>(<span class="ruby-identifier">chain</span>.<span class="ruby-identifier">index</span>(<span class="ruby-identifier">filter</span>), <span class="ruby-identifier">new_filter</span>)
527:               <span class="ruby-identifier">new_filter</span>.<span class="ruby-identifier">recompile!</span>(<span class="ruby-identifier">options</span>, <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:per_key</span>] <span class="ruby-operator">||</span> {})
528:             <span class="ruby-keyword kw">end</span>
529: 
530:             <span class="ruby-identifier">chain</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">filter</span>)
531:           <span class="ruby-keyword kw">end</span>
532:           <span class="ruby-identifier">target</span>.<span class="ruby-identifier">send</span>(<span class="ruby-node">&quot;_#{name}_callbacks=&quot;</span>, <span class="ruby-identifier">chain</span>)
533:         <span class="ruby-keyword kw">end</span>
534:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    