<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>RubyLexer</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen" />
    <script src="../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Class</span> 
            RubyLexer 
            
                <span class="parent">&lt; 
                    
                    Object
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../files/lib/ruby_lexer_rb.html">lib/ruby_lexer.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>A</dt>
        <dd>
            <ul>
                
                <li><a href="#M000006">advance</a>,</li>
                
                <li><a href="#M000007">arg_ambiguous</a></li>
                
            </ul>
        </dd>
    
        <dt>C</dt>
        <dd>
            <ul>
                
                <li><a href="#M000008">comments</a></li>
                
            </ul>
        </dd>
    
        <dt>E</dt>
        <dd>
            <ul>
                
                <li><a href="#M000009">expr_beg_push</a></li>
                
            </ul>
        </dd>
    
        <dt>F</dt>
        <dd>
            <ul>
                
                <li><a href="#M000010">fix_arg_lex_state</a></li>
                
            </ul>
        </dd>
    
        <dt>H</dt>
        <dd>
            <ul>
                
                <li><a href="#M000011">heredoc</a>,</li>
                
                <li><a href="#M000012">heredoc_identifier</a></li>
                
            </ul>
        </dd>
    
        <dt>I</dt>
        <dd>
            <ul>
                
                <li><a href="#M000014">int_with_base</a></li>
                
            </ul>
        </dd>
    
        <dt>L</dt>
        <dd>
            <ul>
                
                <li><a href="#M000015">lex_state=</a>,</li>
                
                <li><a href="#M000016">lineno</a></li>
                
            </ul>
        </dd>
    
        <dt>N</dt>
        <dd>
            <ul>
                
                <li><a href="#M000013">new</a></li>
                
            </ul>
        </dd>
    
        <dt>P</dt>
        <dd>
            <ul>
                
                <li><a href="#M000017">parse_number</a>,</li>
                
                <li><a href="#M000018">parse_quote</a>,</li>
                
                <li><a href="#M000019">parse_string</a>,</li>
                
                <li><a href="#M000030">process_token</a></li>
                
            </ul>
        </dd>
    
        <dt>R</dt>
        <dd>
            <ul>
                
                <li><a href="#M000020">rb_compile_error</a>,</li>
                
                <li><a href="#M000021">read_escape</a>,</li>
                
                <li><a href="#M000022">regx_options</a>,</li>
                
                <li><a href="#M000023">reset</a></li>
                
            </ul>
        </dd>
    
        <dt>S</dt>
        <dd>
            <ul>
                
                <li><a href="#M000024">src=</a></li>
                
            </ul>
        </dd>
    
        <dt>T</dt>
        <dd>
            <ul>
                
                <li><a href="#M000025">tokadd_escape</a>,</li>
                
                <li><a href="#M000026">tokadd_string</a></li>
                
            </ul>
        </dd>
    
        <dt>U</dt>
        <dd>
            <ul>
                
                <li><a href="#M000027">unescape</a></li>
                
            </ul>
        </dd>
    
        <dt>W</dt>
        <dd>
            <ul>
                
                <li><a href="#M000028">warning</a></li>
                
            </ul>
        </dd>
    
        <dt>Y</dt>
        <dd>
            <ul>
                
                <li><a href="#M000029">yylex</a>,</li>
                
                <li><a href="#M000031">yylex_string</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    

    

    

    
    <div class="sectiontitle">Constants</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class="attr-name">ESC_RE</td>
            <td>=</td>
            <td class="attr-value">/\\([0-7]{1,3}|x[0-9a-fA-F]{1,2}|M-[^\\]|(C-|c)[^\\]|[^0-7xMCc])/</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">EOF</td>
            <td>=</td>
            <td class="attr-value">:eof_haha!</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">STR_FUNC_BORING</td>
            <td>=</td>
            <td class="attr-value">0x00</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
ruby constants for strings (should this be moved somewhere else?)
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">STR_FUNC_ESCAPE</td>
            <td>=</td>
            <td class="attr-value">0x01</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">STR_FUNC_EXPAND</td>
            <td>=</td>
            <td class="attr-value">0x02</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">STR_FUNC_REGEXP</td>
            <td>=</td>
            <td class="attr-value">0x04</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">STR_FUNC_AWORDS</td>
            <td>=</td>
            <td class="attr-value">0x08</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">STR_FUNC_SYMBOL</td>
            <td>=</td>
            <td class="attr-value">0x10</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">STR_FUNC_INDENT</td>
            <td>=</td>
            <td class="attr-value">0x20</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">STR_SQUOTE</td>
            <td>=</td>
            <td class="attr-value">STR_FUNC_BORING</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">STR_DQUOTE</td>
            <td>=</td>
            <td class="attr-value">STR_FUNC_BORING | STR_FUNC_EXPAND</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">STR_XQUOTE</td>
            <td>=</td>
            <td class="attr-value">STR_FUNC_BORING | STR_FUNC_EXPAND</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">STR_REGEXP</td>
            <td>=</td>
            <td class="attr-value">STR_FUNC_REGEXP | STR_FUNC_ESCAPE | STR_FUNC_EXPAND</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">STR_SSYM</td>
            <td>=</td>
            <td class="attr-value">STR_FUNC_SYMBOL</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">STR_DSYM</td>
            <td>=</td>
            <td class="attr-value">STR_FUNC_SYMBOL | STR_FUNC_EXPAND</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">TOKENS</td>
            <td>=</td>
            <td class="attr-value">{     &quot;!&quot;   =&gt; :tBANG,     &quot;!=&quot;  =&gt; :tNEQ,     &quot;!~&quot;  =&gt; :tNMATCH,     &quot;,&quot;   =&gt; :tCOMMA,     &quot;..&quot;  =&gt; :tDOT2,     &quot;...&quot; =&gt; :tDOT3,     &quot;=&quot;   =&gt; :tEQL,     &quot;==&quot;  =&gt; :tEQ,     &quot;===&quot; =&gt; :tEQQ,     &quot;=&gt;&quot;  =&gt; :tASSOC,     &quot;=~&quot;  =&gt; :tMATCH,   }</td>
        </tr>
        
        
    </table>
    

    
    <div class="sectiontitle">Attributes</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>command_start</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>cmdarg</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>cond</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>nest</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>lex_state</td>
            <td class='attr-desc'><p>
Additional context surrounding tokens that both the lexer and grammar use.
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>lex_strterm</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>parser</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>src</td>
            <td class='attr-desc'><p>
Stream of data that yylex examines.
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>token</td>
            <td class='attr-desc'><p>
Last token read via yylex.
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>string_buffer</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>yacc_value</td>
            <td class='attr-desc'><p>
Value of last token which had a value associated with it.
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>warnings</td>
            <td class='attr-desc'><p>
What handles warnings
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [W]
            </td>
            <td class='attr-name'>lineno</td>
            <td class='attr-desc'></td>
        </tr>
        
    </table>
    

    
            <div class="sectiontitle">Class Public methods</div>
            
            <div class="method">
                <div class="title" id="M000013">
                    
                    <a name="M000013"></a><b>new</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000013_source')" id="l_M000013_source">show</a>
                        
                    </p>
                    <div id="M000013_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/ruby_lexer.rb, line 219</span>
219:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>
220:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">cond</span> = <span class="ruby-constant">RubyParser</span><span class="ruby-operator">::</span><span class="ruby-constant">StackState</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:cond</span>)
221:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">cmdarg</span> = <span class="ruby-constant">RubyParser</span><span class="ruby-operator">::</span><span class="ruby-constant">StackState</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:cmdarg</span>)
222:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">nest</span> = <span class="ruby-value">0</span>
223:     <span class="ruby-ivar">@comments</span> = []
224: 
225:     <span class="ruby-identifier">reset</span>
226:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M000006">
                    
                    <a name="M000006"></a><b>advance</b>()
                    
                </div>
                
                <div class="description">
                  <p>
How the parser advances to the next token.
</p>
<p>
@return true if not at end of file (<a href="RubyLexer.html#EOF">EOF</a>).
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000006_source')" id="l_M000006_source">show</a>
                        
                    </p>
                    <div id="M000006_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/ruby_lexer.rb, line 67</span>
67:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">advance</span>
68:     <span class="ruby-identifier">r</span> = <span class="ruby-identifier">yylex</span>
69:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">token</span> = <span class="ruby-identifier">r</span>
70: 
71:     <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;yylex returned nil&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">r</span>
72: 
73:     <span class="ruby-keyword kw">return</span> <span class="ruby-constant">RubyLexer</span><span class="ruby-operator">::</span><span class="ruby-constant">EOF</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">r</span>
74:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000007">
                    
                    <a name="M000007"></a><b>arg_ambiguous</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000007_source')" id="l_M000007_source">show</a>
                        
                    </p>
                    <div id="M000007_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/ruby_lexer.rb, line 76</span>
76:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">arg_ambiguous</span>
77:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">warning</span>(<span class="ruby-value str">&quot;Ambiguous first argument. make sure.&quot;</span>)
78:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000008">
                    
                    <a name="M000008"></a><b>comments</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000008_source')" id="l_M000008_source">show</a>
                        
                    </p>
                    <div id="M000008_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/ruby_lexer.rb, line 80</span>
80:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">comments</span>
81:     <span class="ruby-identifier">c</span> = <span class="ruby-ivar">@comments</span>.<span class="ruby-identifier">join</span>
82:     <span class="ruby-ivar">@comments</span>.<span class="ruby-identifier">clear</span>
83:     <span class="ruby-identifier">c</span>
84:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000009">
                    
                    <a name="M000009"></a><b>expr_beg_push</b>(val)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000009_source')" id="l_M000009_source">show</a>
                        
                    </p>
                    <div id="M000009_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/ruby_lexer.rb, line 86</span>
86:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">expr_beg_push</span> <span class="ruby-identifier">val</span>
87:     <span class="ruby-identifier">cond</span>.<span class="ruby-identifier">push</span> <span class="ruby-keyword kw">false</span>
88:     <span class="ruby-identifier">cmdarg</span>.<span class="ruby-identifier">push</span> <span class="ruby-keyword kw">false</span>
89:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_state</span> = <span class="ruby-identifier">:expr_beg</span>
90:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-identifier">val</span>
91:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000010">
                    
                    <a name="M000010"></a><b>fix_arg_lex_state</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000010_source')" id="l_M000010_source">show</a>
                        
                    </p>
                    <div id="M000010_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/ruby_lexer.rb, line 93</span>
93:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">fix_arg_lex_state</span>
94:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_state</span> = <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:expr_fname</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:expr_dot</span>
95:                        <span class="ruby-identifier">:expr_arg</span>
96:                      <span class="ruby-keyword kw">else</span>
97:                        <span class="ruby-identifier">:expr_beg</span>
98:                      <span class="ruby-keyword kw">end</span>
99:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000011">
                    
                    <a name="M000011"></a><b>heredoc</b>(here)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000011_source')" id="l_M000011_source">show</a>
                        
                    </p>
                    <div id="M000011_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/ruby_lexer.rb, line 101</span>
101:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">heredoc</span> <span class="ruby-identifier">here</span> <span class="ruby-comment cmt"># 63 lines</span>
102:     <span class="ruby-identifier">_</span>, <span class="ruby-identifier">eos</span>, <span class="ruby-identifier">func</span>, <span class="ruby-identifier">last_line</span> = <span class="ruby-identifier">here</span>
103: 
104:     <span class="ruby-identifier">indent</span>  = (<span class="ruby-identifier">func</span> <span class="ruby-operator">&amp;</span> <span class="ruby-constant">STR_FUNC_INDENT</span>) <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
105:     <span class="ruby-identifier">expand</span>  = (<span class="ruby-identifier">func</span> <span class="ruby-operator">&amp;</span> <span class="ruby-constant">STR_FUNC_EXPAND</span>) <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
106:     <span class="ruby-identifier">eos_re</span>  = <span class="ruby-identifier">indent</span> <span class="ruby-value">? </span><span class="ruby-operator">/</span>[ \<span class="ruby-identifier">t</span>]<span class="ruby-operator">*</span><span class="ruby-comment cmt">#{eos}(\r?\n|\z)/ : /#{eos}(\r?\n|\z)/</span>
107:     <span class="ruby-identifier">err_msg</span> = <span class="ruby-node">&quot;can't match #{eos_re.inspect} anywhere in &quot;</span>
108: 
109:     <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-identifier">err_msg</span> <span class="ruby-keyword kw">if</span>
110:       <span class="ruby-identifier">src</span>.<span class="ruby-identifier">eos?</span>
111: 
112:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">beginning_of_line?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-identifier">eos_re</span>) <span class="ruby-keyword kw">then</span>
113:       <span class="ruby-identifier">src</span>.<span class="ruby-identifier">unread_many</span> <span class="ruby-identifier">last_line</span> <span class="ruby-comment cmt"># TODO: figure out how to remove this</span>
114:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-identifier">eos</span>
115:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tSTRING_END</span>
116:     <span class="ruby-keyword kw">end</span>
117: 
118:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">string_buffer</span> = []
119: 
120:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">expand</span> <span class="ruby-keyword kw">then</span>
121:       <span class="ruby-keyword kw">case</span>
122:       <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/#[$@]/</span>) <span class="ruby-keyword kw">then</span>
123:         <span class="ruby-identifier">src</span>.<span class="ruby-identifier">pos</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span> <span class="ruby-comment cmt"># FIX omg stupid</span>
124:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-identifier">src</span>.<span class="ruby-identifier">matched</span>
125:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tSTRING_DVAR</span>
126:       <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/#[{]/</span>) <span class="ruby-keyword kw">then</span>
127:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-identifier">src</span>.<span class="ruby-identifier">matched</span>
128:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tSTRING_DBEG</span>
129:       <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/#/</span>) <span class="ruby-keyword kw">then</span>
130:         <span class="ruby-identifier">string_buffer</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">'#'</span>
131:       <span class="ruby-keyword kw">end</span>
132: 
133:       <span class="ruby-keyword kw">until</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-identifier">eos_re</span>) <span class="ruby-keyword kw">do</span>
134:         <span class="ruby-identifier">c</span> = <span class="ruby-identifier">tokadd_string</span> <span class="ruby-identifier">func</span>, <span class="ruby-value str">&quot;\n&quot;</span>, <span class="ruby-keyword kw">nil</span>
135: 
136:         <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-identifier">err_msg</span> <span class="ruby-keyword kw">if</span>
137:           <span class="ruby-identifier">c</span> <span class="ruby-operator">==</span> <span class="ruby-constant">RubyLexer</span><span class="ruby-operator">::</span><span class="ruby-constant">EOF</span>
138: 
139:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">c</span> <span class="ruby-operator">!=</span> <span class="ruby-value str">&quot;\n&quot;</span> <span class="ruby-keyword kw">then</span>
140:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-identifier">string_buffer</span>.<span class="ruby-identifier">join</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value str">&quot;\r&quot;</span>)
141:           <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tSTRING_CONTENT</span>
142:         <span class="ruby-keyword kw">else</span>
143:           <span class="ruby-identifier">string_buffer</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\n/</span>)
144:         <span class="ruby-keyword kw">end</span>
145: 
146:         <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-identifier">err_msg</span> <span class="ruby-keyword kw">if</span>
147:           <span class="ruby-identifier">src</span>.<span class="ruby-identifier">eos?</span>
148:       <span class="ruby-keyword kw">end</span>
149: 
150:       <span class="ruby-comment cmt"># tack on a NL after the heredoc token - FIX NL should not be needed</span>
151:       <span class="ruby-identifier">src</span>.<span class="ruby-identifier">unread_many</span>(<span class="ruby-identifier">eos</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;\n&quot;</span>) <span class="ruby-comment cmt"># TODO: remove this... stupid stupid stupid</span>
152:     <span class="ruby-keyword kw">else</span>
153:       <span class="ruby-keyword kw">until</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">check</span>(<span class="ruby-identifier">eos_re</span>) <span class="ruby-keyword kw">do</span>
154:         <span class="ruby-identifier">string_buffer</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/.*(\n|\z)/</span>)
155:         <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-identifier">err_msg</span> <span class="ruby-keyword kw">if</span>
156:           <span class="ruby-identifier">src</span>.<span class="ruby-identifier">eos?</span>
157:       <span class="ruby-keyword kw">end</span>
158:     <span class="ruby-keyword kw">end</span>
159: 
160:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_strterm</span> = [<span class="ruby-identifier">:heredoc</span>, <span class="ruby-identifier">eos</span>, <span class="ruby-identifier">func</span>, <span class="ruby-identifier">last_line</span>]
161:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-identifier">string_buffer</span>.<span class="ruby-identifier">join</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value str">&quot;\r&quot;</span>)
162: 
163:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tSTRING_CONTENT</span>
164:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000012">
                    
                    <a name="M000012"></a><b>heredoc_identifier</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000012_source')" id="l_M000012_source">show</a>
                        
                    </p>
                    <div id="M000012_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/ruby_lexer.rb, line 166</span>
166:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">heredoc_identifier</span> <span class="ruby-comment cmt"># 51 lines</span>
167:     <span class="ruby-identifier">term</span>, <span class="ruby-identifier">func</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-constant">STR_FUNC_BORING</span>
168:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">string_buffer</span> = []
169: 
170:     <span class="ruby-keyword kw">case</span>
171:     <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/(-?)(['&quot;`])(.*?)\2/</span>) <span class="ruby-keyword kw">then</span>
172:       <span class="ruby-identifier">term</span> = <span class="ruby-identifier">src</span>[<span class="ruby-value">2</span>]
173:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">src</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">empty?</span> <span class="ruby-keyword kw">then</span>
174:         <span class="ruby-identifier">func</span> <span class="ruby-operator">|=</span> <span class="ruby-constant">STR_FUNC_INDENT</span>
175:       <span class="ruby-keyword kw">end</span>
176:       <span class="ruby-identifier">func</span> <span class="ruby-operator">|=</span> <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">term</span>
177:               <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;\'&quot;</span> <span class="ruby-keyword kw">then</span>
178:                 <span class="ruby-constant">STR_SQUOTE</span>
179:               <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'&quot;'</span> <span class="ruby-keyword kw">then</span>
180:                 <span class="ruby-constant">STR_DQUOTE</span>
181:               <span class="ruby-keyword kw">else</span>
182:                 <span class="ruby-constant">STR_XQUOTE</span>
183:               <span class="ruby-keyword kw">end</span>
184:       <span class="ruby-identifier">string_buffer</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">src</span>[<span class="ruby-value">3</span>]
185:     <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/-?(['&quot;`])(?!\1*\Z)/</span>) <span class="ruby-keyword kw">then</span>
186:       <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-value str">&quot;unterminated here document identifier&quot;</span>
187:     <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/(-?)(\w+)/</span>) <span class="ruby-keyword kw">then</span>
188:       <span class="ruby-identifier">term</span> = <span class="ruby-value str">'&quot;'</span>
189:       <span class="ruby-identifier">func</span> <span class="ruby-operator">|=</span> <span class="ruby-constant">STR_DQUOTE</span>
190:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">src</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">empty?</span> <span class="ruby-keyword kw">then</span>
191:         <span class="ruby-identifier">func</span> <span class="ruby-operator">|=</span> <span class="ruby-constant">STR_FUNC_INDENT</span>
192:       <span class="ruby-keyword kw">end</span>
193:       <span class="ruby-identifier">string_buffer</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">src</span>[<span class="ruby-value">2</span>]
194:     <span class="ruby-keyword kw">else</span>
195:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span>
196:     <span class="ruby-keyword kw">end</span>
197: 
198:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">check</span>(<span class="ruby-regexp re">/.*\n/</span>) <span class="ruby-keyword kw">then</span>
199:       <span class="ruby-comment cmt"># TODO: think about storing off the char range instead</span>
200:       <span class="ruby-identifier">line</span> = <span class="ruby-identifier">src</span>.<span class="ruby-identifier">string</span>[<span class="ruby-identifier">src</span>.<span class="ruby-identifier">pos</span>, <span class="ruby-identifier">src</span>.<span class="ruby-identifier">matched_size</span>]
201:       <span class="ruby-identifier">src</span>.<span class="ruby-identifier">string</span>[<span class="ruby-identifier">src</span>.<span class="ruby-identifier">pos</span>, <span class="ruby-identifier">src</span>.<span class="ruby-identifier">matched_size</span>] = <span class="ruby-value str">&quot;\n&quot;</span>
202:       <span class="ruby-identifier">src</span>.<span class="ruby-identifier">extra_lines_added</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
203:       <span class="ruby-identifier">src</span>.<span class="ruby-identifier">pos</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
204:     <span class="ruby-keyword kw">else</span>
205:       <span class="ruby-identifier">line</span> = <span class="ruby-keyword kw">nil</span>
206:     <span class="ruby-keyword kw">end</span>
207: 
208:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_strterm</span> = [<span class="ruby-identifier">:heredoc</span>, <span class="ruby-identifier">string_buffer</span>.<span class="ruby-identifier">join</span>, <span class="ruby-identifier">func</span>, <span class="ruby-identifier">line</span>]
209: 
210:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">term</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'`'</span> <span class="ruby-keyword kw">then</span>
211:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-value str">&quot;`&quot;</span>
212:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tXSTRING_BEG</span>
213:     <span class="ruby-keyword kw">else</span>
214:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-value str">&quot;\&quot;&quot;</span>
215:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tSTRING_BEG</span>
216:     <span class="ruby-keyword kw">end</span>
217:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000014">
                    
                    <a name="M000014"></a><b>int_with_base</b>(base)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000014_source')" id="l_M000014_source">show</a>
                        
                    </p>
                    <div id="M000014_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/ruby_lexer.rb, line 228</span>
228:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">int_with_base</span> <span class="ruby-identifier">base</span>
229:     <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-value str">&quot;Invalid numeric format&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">matched</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/__/</span>
230:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-identifier">src</span>.<span class="ruby-identifier">matched</span>.<span class="ruby-identifier">to_i</span>(<span class="ruby-identifier">base</span>)
231:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tINTEGER</span>
232:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000015">
                    
                    <a name="M000015"></a><b>lex_state=</b>(o)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000015_source')" id="l_M000015_source">show</a>
                        
                    </p>
                    <div id="M000015_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/ruby_lexer.rb, line 234</span>
234:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">lex_state=</span> <span class="ruby-identifier">o</span>
235:     <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;wtf\?&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">Symbol</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">o</span>
236:     <span class="ruby-ivar">@lex_state</span> = <span class="ruby-identifier">o</span>
237:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000016">
                    
                    <a name="M000016"></a><b>lineno</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000016_source')" id="l_M000016_source">show</a>
                        
                    </p>
                    <div id="M000016_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/ruby_lexer.rb, line 240</span>
240:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">lineno</span>
241:     <span class="ruby-ivar">@lineno</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">lineno</span>
242:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000017">
                    
                    <a name="M000017"></a><b>parse_number</b>()
                    
                </div>
                
                <div class="description">
                  <pre>
 Parse a number from the input stream.
</pre>
<p>
@param c The first character of the number. @return A int constant wich
represents a token.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000017_source')" id="l_M000017_source">show</a>
                        
                    </p>
                    <div id="M000017_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/ruby_lexer.rb, line 250</span>
250:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">parse_number</span>
251:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_state</span> = <span class="ruby-identifier">:expr_end</span>
252: 
253:     <span class="ruby-keyword kw">case</span>
254:     <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/[+-]?0[xbd]\b/</span>) <span class="ruby-keyword kw">then</span>
255:       <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-value str">&quot;Invalid numeric format&quot;</span>
256:     <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/[+-]?0x[a-f0-9_]+/i</span>) <span class="ruby-keyword kw">then</span>
257:       <span class="ruby-identifier">int_with_base</span>(<span class="ruby-value">16</span>)
258:     <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/[+-]?0b[01_]+/</span>) <span class="ruby-keyword kw">then</span>
259:       <span class="ruby-identifier">int_with_base</span>(<span class="ruby-value">2</span>)
260:     <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/[+-]?0d[0-9_]+/</span>) <span class="ruby-keyword kw">then</span>
261:       <span class="ruby-identifier">int_with_base</span>(<span class="ruby-value">10</span>)
262:     <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/[+-]?0[Oo]?[0-7_]*[89]/</span>) <span class="ruby-keyword kw">then</span>
263:       <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-value str">&quot;Illegal octal digit.&quot;</span>
264:     <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/[+-]?0[Oo]?[0-7_]+|0[Oo]/</span>) <span class="ruby-keyword kw">then</span>
265:       <span class="ruby-identifier">int_with_base</span>(<span class="ruby-value">8</span>)
266:     <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/[+-]?[\d_]+_(e|\.)/</span>) <span class="ruby-keyword kw">then</span>
267:       <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-value str">&quot;Trailing '_' in number.&quot;</span>
268:     <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/[+-]?[\d_]+\.[\d_]+(e[+-]?[\d_]+)?\b|[+-]?[\d_]+e[+-]?[\d_]+\b/i</span>) <span class="ruby-keyword kw">then</span>
269:       <span class="ruby-identifier">number</span> = <span class="ruby-identifier">src</span>.<span class="ruby-identifier">matched</span>
270:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">number</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/__/</span> <span class="ruby-keyword kw">then</span>
271:         <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-value str">&quot;Invalid numeric format&quot;</span>
272:       <span class="ruby-keyword kw">end</span>
273:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-identifier">number</span>.<span class="ruby-identifier">to_f</span>
274:       <span class="ruby-identifier">:tFLOAT</span>
275:     <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/[+-]?0\b/</span>) <span class="ruby-keyword kw">then</span>
276:       <span class="ruby-identifier">int_with_base</span>(<span class="ruby-value">10</span>)
277:     <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/[+-]?[\d_]+\b/</span>) <span class="ruby-keyword kw">then</span>
278:       <span class="ruby-identifier">int_with_base</span>(<span class="ruby-value">10</span>)
279:     <span class="ruby-keyword kw">else</span>
280:       <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-value str">&quot;Bad number format&quot;</span>
281:     <span class="ruby-keyword kw">end</span>
282:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000018">
                    
                    <a name="M000018"></a><b>parse_quote</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000018_source')" id="l_M000018_source">show</a>
                        
                    </p>
                    <div id="M000018_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/ruby_lexer.rb, line 284</span>
284:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">parse_quote</span> <span class="ruby-comment cmt"># 58 lines</span>
285:     <span class="ruby-identifier">beg</span>, <span class="ruby-identifier">nnd</span>, <span class="ruby-identifier">short_hand</span>, <span class="ruby-identifier">c</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-keyword kw">nil</span>, <span class="ruby-keyword kw">false</span>, <span class="ruby-keyword kw">nil</span>
286: 
287:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/[a-z0-9]{1,2}/i</span>) <span class="ruby-keyword kw">then</span> <span class="ruby-comment cmt"># Long-hand (e.g. %Q{}).</span>
288:       <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-value str">&quot;unknown type of %string&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">matched_size</span> <span class="ruby-operator">==</span> <span class="ruby-value">2</span>
289:       <span class="ruby-identifier">c</span>, <span class="ruby-identifier">beg</span>, <span class="ruby-identifier">short_hand</span> = <span class="ruby-identifier">src</span>.<span class="ruby-identifier">matched</span>, <span class="ruby-identifier">src</span>.<span class="ruby-identifier">getch</span>, <span class="ruby-keyword kw">false</span>
290:     <span class="ruby-keyword kw">else</span>                               <span class="ruby-comment cmt"># Short-hand (e.g. %{, %., %!, etc)</span>
291:       <span class="ruby-identifier">c</span>, <span class="ruby-identifier">beg</span>, <span class="ruby-identifier">short_hand</span> = <span class="ruby-value str">'Q'</span>, <span class="ruby-identifier">src</span>.<span class="ruby-identifier">getch</span>, <span class="ruby-keyword kw">true</span>
292:     <span class="ruby-keyword kw">end</span>
293: 
294:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">eos?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">c</span> <span class="ruby-operator">==</span> <span class="ruby-constant">RubyLexer</span><span class="ruby-operator">::</span><span class="ruby-constant">EOF</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">beg</span> <span class="ruby-operator">==</span> <span class="ruby-constant">RubyLexer</span><span class="ruby-operator">::</span><span class="ruby-constant">EOF</span> <span class="ruby-keyword kw">then</span>
295:       <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-value str">&quot;unterminated quoted string meets end of file&quot;</span>
296:     <span class="ruby-keyword kw">end</span>
297: 
298:     <span class="ruby-comment cmt"># Figure nnd-char.  &quot;\0&quot; is special to indicate beg=nnd and that no nesting?</span>
299:     <span class="ruby-identifier">nnd</span> = { <span class="ruby-value str">&quot;(&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;)&quot;</span>, <span class="ruby-value str">&quot;[&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;]&quot;</span>, <span class="ruby-value str">&quot;{&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;}&quot;</span>, <span class="ruby-value str">&quot;&lt;&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;&gt;&quot;</span> }[<span class="ruby-identifier">beg</span>]
300:     <span class="ruby-identifier">nnd</span>, <span class="ruby-identifier">beg</span> = <span class="ruby-identifier">beg</span>, <span class="ruby-value str">&quot;\0&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">nnd</span>.<span class="ruby-identifier">nil?</span>
301: 
302:     <span class="ruby-identifier">token_type</span>, <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-node">&quot;%#{c}#{beg}&quot;</span>
303:     <span class="ruby-identifier">token_type</span>, <span class="ruby-identifier">string_type</span> = <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">c</span>
304:                               <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'Q'</span> <span class="ruby-keyword kw">then</span>
305:                                 <span class="ruby-identifier">ch</span> = <span class="ruby-identifier">short_hand</span> <span class="ruby-value">? </span><span class="ruby-identifier">nnd</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">c</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">beg</span>
306:                                 <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-node">&quot;%#{ch}&quot;</span>
307:                                 [<span class="ruby-identifier">:tSTRING_BEG</span>,   <span class="ruby-constant">STR_DQUOTE</span>]
308:                               <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'q'</span> <span class="ruby-keyword kw">then</span>
309:                                 [<span class="ruby-identifier">:tSTRING_BEG</span>,   <span class="ruby-constant">STR_SQUOTE</span>]
310:                               <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'W'</span> <span class="ruby-keyword kw">then</span>
311:                                 <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\s*/</span>)
312:                                 [<span class="ruby-identifier">:tWORDS_BEG</span>,    <span class="ruby-constant">STR_DQUOTE</span> <span class="ruby-operator">|</span> <span class="ruby-constant">STR_FUNC_AWORDS</span>]
313:                               <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'w'</span> <span class="ruby-keyword kw">then</span>
314:                                 <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\s*/</span>)
315:                                 [<span class="ruby-identifier">:tAWORDS_BEG</span>,   <span class="ruby-constant">STR_SQUOTE</span> <span class="ruby-operator">|</span> <span class="ruby-constant">STR_FUNC_AWORDS</span>]
316:                               <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'x'</span> <span class="ruby-keyword kw">then</span>
317:                                 [<span class="ruby-identifier">:tXSTRING_BEG</span>,  <span class="ruby-constant">STR_XQUOTE</span>]
318:                               <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'r'</span> <span class="ruby-keyword kw">then</span>
319:                                 [<span class="ruby-identifier">:tREGEXP_BEG</span>,   <span class="ruby-constant">STR_REGEXP</span>]
320:                               <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'s'</span> <span class="ruby-keyword kw">then</span>
321:                                 <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_state</span>  = <span class="ruby-identifier">:expr_fname</span>
322:                                 [<span class="ruby-identifier">:tSYMBEG</span>,       <span class="ruby-constant">STR_SSYM</span>]
323:                               <span class="ruby-keyword kw">end</span>
324: 
325:     <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-node">&quot;Bad %string type. Expected [Qqwxr\W], found '#{c}'.&quot;</span> <span class="ruby-keyword kw">if</span>
326:       <span class="ruby-identifier">token_type</span>.<span class="ruby-identifier">nil?</span>
327: 
328:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_strterm</span> = [<span class="ruby-identifier">:strterm</span>, <span class="ruby-identifier">string_type</span>, <span class="ruby-identifier">nnd</span>, <span class="ruby-identifier">beg</span>]
329: 
330:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">token_type</span>
331:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000019">
                    
                    <a name="M000019"></a><b>parse_string</b>(quote)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000019_source')" id="l_M000019_source">show</a>
                        
                    </p>
                    <div id="M000019_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/ruby_lexer.rb, line 333</span>
333:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">parse_string</span>(<span class="ruby-identifier">quote</span>) <span class="ruby-comment cmt"># 65 lines</span>
334:     <span class="ruby-identifier">_</span>, <span class="ruby-identifier">string_type</span>, <span class="ruby-identifier">term</span>, <span class="ruby-identifier">open</span> = <span class="ruby-identifier">quote</span>
335: 
336:     <span class="ruby-identifier">space</span> = <span class="ruby-keyword kw">false</span> <span class="ruby-comment cmt"># FIX: remove these</span>
337:     <span class="ruby-identifier">func</span> = <span class="ruby-identifier">string_type</span>
338:     <span class="ruby-identifier">paren</span> = <span class="ruby-identifier">open</span>
339:     <span class="ruby-identifier">term_re</span> = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">escape</span> <span class="ruby-identifier">term</span>
340: 
341:     <span class="ruby-identifier">awords</span> = (<span class="ruby-identifier">func</span> <span class="ruby-operator">&amp;</span> <span class="ruby-constant">STR_FUNC_AWORDS</span>) <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
342:     <span class="ruby-identifier">regexp</span> = (<span class="ruby-identifier">func</span> <span class="ruby-operator">&amp;</span> <span class="ruby-constant">STR_FUNC_REGEXP</span>) <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
343:     <span class="ruby-identifier">expand</span> = (<span class="ruby-identifier">func</span> <span class="ruby-operator">&amp;</span> <span class="ruby-constant">STR_FUNC_EXPAND</span>) <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
344: 
345:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">func</span> <span class="ruby-keyword kw">then</span> <span class="ruby-comment cmt"># FIX: impossible, prolly needs == 0</span>
346:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lineno</span> = <span class="ruby-keyword kw">nil</span>
347:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tSTRING_END</span>
348:     <span class="ruby-keyword kw">end</span>
349: 
350:     <span class="ruby-identifier">space</span> = <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">awords</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\s+/</span>)
351: 
352:     <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">nest</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-node">/#{term_re}/</span>) <span class="ruby-keyword kw">then</span>
353:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">awords</span> <span class="ruby-keyword kw">then</span>
354:         <span class="ruby-identifier">quote</span>[<span class="ruby-value">1</span>] = <span class="ruby-keyword kw">nil</span>
355:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tSPACE</span>
356:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">regexp</span> <span class="ruby-keyword kw">then</span>
357:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">regx_options</span>
358:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lineno</span> = <span class="ruby-keyword kw">nil</span>
359:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tREGEXP_END</span>
360:       <span class="ruby-keyword kw">else</span>
361:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-identifier">term</span>
362:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lineno</span> = <span class="ruby-keyword kw">nil</span>
363:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tSTRING_END</span>
364:       <span class="ruby-keyword kw">end</span>
365:     <span class="ruby-keyword kw">end</span>
366: 
367:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">space</span> <span class="ruby-keyword kw">then</span>
368:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tSPACE</span>
369:     <span class="ruby-keyword kw">end</span>
370: 
371:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">string_buffer</span> = []
372: 
373:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">expand</span>
374:       <span class="ruby-keyword kw">case</span>
375:       <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/#(?=[$@])/</span>) <span class="ruby-keyword kw">then</span>
376:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tSTRING_DVAR</span>
377:       <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/#[{]/</span>) <span class="ruby-keyword kw">then</span>
378:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tSTRING_DBEG</span>
379:       <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/#/</span>) <span class="ruby-keyword kw">then</span>
380:         <span class="ruby-identifier">string_buffer</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">'#'</span>
381:       <span class="ruby-keyword kw">end</span>
382:     <span class="ruby-keyword kw">end</span>
383: 
384:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">tokadd_string</span>(<span class="ruby-identifier">func</span>, <span class="ruby-identifier">term</span>, <span class="ruby-identifier">paren</span>) <span class="ruby-operator">==</span> <span class="ruby-constant">RubyLexer</span><span class="ruby-operator">::</span><span class="ruby-constant">EOF</span> <span class="ruby-keyword kw">then</span>
385:       <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-value str">&quot;unterminated string meets end of file&quot;</span>
386:     <span class="ruby-keyword kw">end</span>
387: 
388:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-identifier">string_buffer</span>.<span class="ruby-identifier">join</span>
389: 
390:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tSTRING_CONTENT</span>
391:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000030">
                    
                    <a name="M000030"></a><b>process_token</b>(command_state)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000030_source')" id="l_M000030_source">show</a>
                        
                    </p>
                    <div id="M000030_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/ruby_lexer.rb, line 1211</span>
1211:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">process_token</span>(<span class="ruby-identifier">command_state</span>)
1212: 
1213:     <span class="ruby-identifier">token</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">matched</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">token</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/^\w/</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/[\!\?](?!=)/</span>)
1214: 
1215:     <span class="ruby-identifier">result</span> = <span class="ruby-keyword kw">nil</span>
1216:     <span class="ruby-identifier">last_state</span> = <span class="ruby-identifier">lex_state</span>
1217: 
1218: 
1219:     <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">token</span>
1220:     <span class="ruby-keyword kw">when</span> <span class="ruby-regexp re">/^\$/</span> <span class="ruby-keyword kw">then</span>
1221:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_state</span>, <span class="ruby-identifier">result</span> = <span class="ruby-identifier">:expr_end</span>, <span class="ruby-identifier">:tGVAR</span>
1222:     <span class="ruby-keyword kw">when</span> <span class="ruby-regexp re">/^@@/</span> <span class="ruby-keyword kw">then</span>
1223:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_state</span>, <span class="ruby-identifier">result</span> = <span class="ruby-identifier">:expr_end</span>, <span class="ruby-identifier">:tCVAR</span>
1224:     <span class="ruby-keyword kw">when</span> <span class="ruby-regexp re">/^@/</span> <span class="ruby-keyword kw">then</span>
1225:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_state</span>, <span class="ruby-identifier">result</span> = <span class="ruby-identifier">:expr_end</span>, <span class="ruby-identifier">:tIVAR</span>
1226:     <span class="ruby-keyword kw">else</span>
1227:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">token</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/[!?]$/</span> <span class="ruby-keyword kw">then</span>
1228:         <span class="ruby-identifier">result</span> = <span class="ruby-identifier">:tFID</span>
1229:       <span class="ruby-keyword kw">else</span>
1230:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:expr_fname</span> <span class="ruby-keyword kw">then</span>
1231:           <span class="ruby-comment cmt"># ident=, not =~ =&gt; == or followed by =&gt;</span>
1232:           <span class="ruby-comment cmt"># TODO test lexing of a=&gt;b vs a==&gt;b</span>
1233:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/=(?:(?![~&gt;=])|(?==&gt;))/</span>) <span class="ruby-keyword kw">then</span>
1234:             <span class="ruby-identifier">result</span> = <span class="ruby-identifier">:tIDENTIFIER</span>
1235:             <span class="ruby-identifier">token</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">matched</span>
1236:           <span class="ruby-keyword kw">end</span>
1237:         <span class="ruby-keyword kw">end</span>
1238: 
1239:         <span class="ruby-identifier">result</span> <span class="ruby-operator">||=</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">token</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/^[A-Z]/</span> <span class="ruby-keyword kw">then</span>
1240:                      <span class="ruby-identifier">:tCONSTANT</span>
1241:                    <span class="ruby-keyword kw">else</span>
1242:                      <span class="ruby-identifier">:tIDENTIFIER</span>
1243:                    <span class="ruby-keyword kw">end</span>
1244:       <span class="ruby-keyword kw">end</span>
1245: 
1246:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:expr_dot</span> <span class="ruby-keyword kw">then</span>
1247:         <span class="ruby-comment cmt"># See if it is a reserved word.</span>
1248:         <span class="ruby-identifier">keyword</span> = <span class="ruby-constant">RubyParser</span><span class="ruby-operator">::</span><span class="ruby-constant">Keyword</span>.<span class="ruby-identifier">keyword</span> <span class="ruby-identifier">token</span>
1249: 
1250:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">keyword</span> <span class="ruby-keyword kw">then</span>
1251:           <span class="ruby-identifier">state</span>           = <span class="ruby-identifier">lex_state</span>
1252:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_state</span>  = <span class="ruby-identifier">keyword</span>.<span class="ruby-identifier">state</span>
1253:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = [<span class="ruby-identifier">token</span>, <span class="ruby-identifier">src</span>.<span class="ruby-identifier">lineno</span>]
1254: 
1255:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">state</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:expr_fname</span> <span class="ruby-keyword kw">then</span>
1256:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-identifier">keyword</span>.<span class="ruby-identifier">name</span>
1257:             <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">keyword</span>.<span class="ruby-identifier">id0</span>
1258:           <span class="ruby-keyword kw">end</span>
1259: 
1260:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">keyword</span>.<span class="ruby-identifier">id0</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:kDO</span> <span class="ruby-keyword kw">then</span>
1261:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">command_start</span> = <span class="ruby-keyword kw">true</span>
1262:             <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:kDO_COND</span>  <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">cond</span>.<span class="ruby-identifier">is_in_state</span>
1263:             <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:kDO_BLOCK</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">cmdarg</span>.<span class="ruby-identifier">is_in_state</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">state</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">:expr_cmdarg</span>
1264:             <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:kDO_BLOCK</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">state</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:expr_endarg</span>
1265:             <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:kDO</span>
1266:           <span class="ruby-keyword kw">end</span>
1267: 
1268:           <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">keyword</span>.<span class="ruby-identifier">id0</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">state</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:expr_beg</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">state</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:expr_value</span>
1269: 
1270:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_state</span> = <span class="ruby-identifier">:expr_beg</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">keyword</span>.<span class="ruby-identifier">id0</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">keyword</span>.<span class="ruby-identifier">id1</span>
1271: 
1272:           <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">keyword</span>.<span class="ruby-identifier">id1</span>
1273:         <span class="ruby-keyword kw">end</span>
1274:       <span class="ruby-keyword kw">end</span>
1275: 
1276:       <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">lex_state</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:expr_beg</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:expr_mid</span> <span class="ruby-operator">||</span>
1277:           <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:expr_dot</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:expr_arg</span> <span class="ruby-operator">||</span>
1278:           <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:expr_cmdarg</span>) <span class="ruby-keyword kw">then</span>
1279:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">command_state</span> <span class="ruby-keyword kw">then</span>
1280:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_state</span> = <span class="ruby-identifier">:expr_cmdarg</span>
1281:         <span class="ruby-keyword kw">else</span>
1282:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_state</span> = <span class="ruby-identifier">:expr_arg</span>
1283:         <span class="ruby-keyword kw">end</span>
1284:       <span class="ruby-keyword kw">else</span>
1285:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_state</span> = <span class="ruby-identifier">:expr_end</span>
1286:       <span class="ruby-keyword kw">end</span>
1287:     <span class="ruby-keyword kw">end</span>
1288: 
1289:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-identifier">token</span>
1290: 
1291: 
1292:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_state</span> = <span class="ruby-identifier">:expr_end</span> <span class="ruby-keyword kw">if</span>
1293:       <span class="ruby-identifier">last_state</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">:expr_dot</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">parser</span>.<span class="ruby-identifier">env</span>[<span class="ruby-identifier">token</span>.<span class="ruby-identifier">to_sym</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">:lvar</span>
1294: 
1295:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">result</span>
1296:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000020">
                    
                    <a name="M000020"></a><b>rb_compile_error</b>(msg)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000020_source')" id="l_M000020_source">show</a>
                        
                    </p>
                    <div id="M000020_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/ruby_lexer.rb, line 393</span>
393:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-identifier">msg</span>
394:     <span class="ruby-identifier">msg</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;. near line #{self.lineno}: #{src.rest[/^.*/].inspect}&quot;</span>
395:     <span class="ruby-identifier">raise</span> <span class="ruby-constant">SyntaxError</span>, <span class="ruby-identifier">msg</span>
396:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000021">
                    
                    <a name="M000021"></a><b>read_escape</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000021_source')" id="l_M000021_source">show</a>
                        
                    </p>
                    <div id="M000021_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/ruby_lexer.rb, line 398</span>
398:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">read_escape</span> <span class="ruby-comment cmt"># 51 lines</span>
399:     <span class="ruby-keyword kw">case</span>
400:     <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\\/</span>) <span class="ruby-keyword kw">then</span>                  <span class="ruby-comment cmt"># Backslash</span>
401:       <span class="ruby-value str">'\\'</span>
402:     <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/n/</span>) <span class="ruby-keyword kw">then</span>                   <span class="ruby-comment cmt"># newline</span>
403:       <span class="ruby-value str">&quot;\n&quot;</span>
404:     <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/t/</span>) <span class="ruby-keyword kw">then</span>                   <span class="ruby-comment cmt"># horizontal tab</span>
405:       <span class="ruby-value str">&quot;\t&quot;</span>
406:     <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/r/</span>) <span class="ruby-keyword kw">then</span>                   <span class="ruby-comment cmt"># carriage-return</span>
407:       <span class="ruby-value str">&quot;\r&quot;</span>
408:     <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/f/</span>) <span class="ruby-keyword kw">then</span>                   <span class="ruby-comment cmt"># form-feed</span>
409:       <span class="ruby-value str">&quot;\f&quot;</span>
410:     <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/v/</span>) <span class="ruby-keyword kw">then</span>                   <span class="ruby-comment cmt"># vertical tab</span>
411:       <span class="ruby-value str">&quot;\13&quot;</span>
412:     <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/a/</span>) <span class="ruby-keyword kw">then</span>                   <span class="ruby-comment cmt"># alarm(bell)</span>
413:       <span class="ruby-value str">&quot;\007&quot;</span>
414:     <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/e/</span>) <span class="ruby-keyword kw">then</span>                   <span class="ruby-comment cmt"># escape</span>
415:       <span class="ruby-value str">&quot;\033&quot;</span>
416:     <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/b/</span>) <span class="ruby-keyword kw">then</span>                   <span class="ruby-comment cmt"># backspace</span>
417:       <span class="ruby-value str">&quot;\010&quot;</span>
418:     <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/s/</span>) <span class="ruby-keyword kw">then</span>                   <span class="ruby-comment cmt"># space</span>
419:       <span class="ruby-value str">&quot; &quot;</span>
420:     <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/[0-7]{1,3}/</span>) <span class="ruby-keyword kw">then</span>          <span class="ruby-comment cmt"># octal constant</span>
421:       <span class="ruby-identifier">src</span>.<span class="ruby-identifier">matched</span>.<span class="ruby-identifier">to_i</span>(<span class="ruby-value">8</span>).<span class="ruby-identifier">chr</span>
422:     <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/x([0-9a-fA-F]{1,2})/</span>) <span class="ruby-keyword kw">then</span> <span class="ruby-comment cmt"># hex constant</span>
423:       <span class="ruby-identifier">src</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">to_i</span>(<span class="ruby-value">16</span>).<span class="ruby-identifier">chr</span>
424:     <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">check</span>(<span class="ruby-regexp re">/M-\\[\\MCc]/</span>) <span class="ruby-keyword kw">then</span>
425:       <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/M-\\/</span>) <span class="ruby-comment cmt"># eat it</span>
426:       <span class="ruby-identifier">c</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">read_escape</span>
427:       <span class="ruby-identifier">c</span>[<span class="ruby-value">0</span>] = (<span class="ruby-identifier">c</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">ord</span> <span class="ruby-operator">|</span> <span class="ruby-value">0x80</span>).<span class="ruby-identifier">chr</span>
428:       <span class="ruby-identifier">c</span>
429:     <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/M-(.)/</span>) <span class="ruby-keyword kw">then</span>
430:       <span class="ruby-identifier">c</span> = <span class="ruby-identifier">src</span>[<span class="ruby-value">1</span>]
431:       <span class="ruby-identifier">c</span>[<span class="ruby-value">0</span>] = (<span class="ruby-identifier">c</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">ord</span> <span class="ruby-operator">|</span> <span class="ruby-value">0x80</span>).<span class="ruby-identifier">chr</span>
432:       <span class="ruby-identifier">c</span>
433:     <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">check</span>(<span class="ruby-regexp re">/(C-|c)\\[\\MCc]/</span>) <span class="ruby-keyword kw">then</span>
434:       <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/(C-|c)\\/</span>) <span class="ruby-comment cmt"># eat it</span>
435:       <span class="ruby-identifier">c</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">read_escape</span>
436:       <span class="ruby-identifier">c</span>[<span class="ruby-value">0</span>] = (<span class="ruby-identifier">c</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">ord</span> <span class="ruby-operator">&amp;</span> <span class="ruby-value">0x9f</span>).<span class="ruby-identifier">chr</span>
437:       <span class="ruby-identifier">c</span>
438:     <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/C-\?|c\?/</span>) <span class="ruby-keyword kw">then</span>
439:       <span class="ruby-value">127</span>.<span class="ruby-identifier">chr</span>
440:     <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/(C-|c)(.)/</span>) <span class="ruby-keyword kw">then</span>
441:       <span class="ruby-identifier">c</span> = <span class="ruby-identifier">src</span>[<span class="ruby-value">2</span>]
442:       <span class="ruby-identifier">c</span>[<span class="ruby-value">0</span>] = (<span class="ruby-identifier">c</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">ord</span> <span class="ruby-operator">&amp;</span> <span class="ruby-value">0x9f</span>).<span class="ruby-identifier">chr</span>
443:       <span class="ruby-identifier">c</span>
444:     <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/[McCx0-9]/</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">eos?</span> <span class="ruby-keyword kw">then</span>
445:       <span class="ruby-identifier">rb_compile_error</span>(<span class="ruby-value str">&quot;Invalid escape character syntax&quot;</span>)
446:     <span class="ruby-keyword kw">else</span>
447:       <span class="ruby-identifier">src</span>.<span class="ruby-identifier">getch</span>
448:     <span class="ruby-keyword kw">end</span>
449:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000022">
                    
                    <a name="M000022"></a><b>regx_options</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000022_source')" id="l_M000022_source">show</a>
                        
                    </p>
                    <div id="M000022_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/ruby_lexer.rb, line 451</span>
451:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">regx_options</span> <span class="ruby-comment cmt"># 15 lines</span>
452:     <span class="ruby-identifier">good</span>, <span class="ruby-identifier">bad</span> = [], []
453: 
454:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/[a-z]+/</span>) <span class="ruby-keyword kw">then</span>
455:       <span class="ruby-identifier">good</span>, <span class="ruby-identifier">bad</span> = <span class="ruby-identifier">src</span>.<span class="ruby-identifier">matched</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp re">//</span>).<span class="ruby-identifier">partition</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span> <span class="ruby-identifier">s</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/^[ixmonesu]$/</span> }
456:     <span class="ruby-keyword kw">end</span>
457: 
458:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">bad</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-keyword kw">then</span>
459:       <span class="ruby-identifier">rb_compile_error</span>(<span class="ruby-value str">&quot;unknown regexp option%s - %s&quot;</span> <span class="ruby-operator">%</span>
460:                        [(<span class="ruby-identifier">bad</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span> <span class="ruby-operator">?</span> <span class="ruby-value str">&quot;s&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-value str">&quot;&quot;</span>), <span class="ruby-identifier">bad</span>.<span class="ruby-identifier">join</span>.<span class="ruby-identifier">inspect</span>])
461:     <span class="ruby-keyword kw">end</span>
462: 
463:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">good</span>.<span class="ruby-identifier">join</span>
464:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000023">
                    
                    <a name="M000023"></a><b>reset</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000023_source')" id="l_M000023_source">show</a>
                        
                    </p>
                    <div id="M000023_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/ruby_lexer.rb, line 466</span>
466:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">reset</span>
467:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">command_start</span> = <span class="ruby-keyword kw">true</span>
468:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_strterm</span>   = <span class="ruby-keyword kw">nil</span>
469:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">token</span>         = <span class="ruby-keyword kw">nil</span>
470:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span>    = <span class="ruby-keyword kw">nil</span>
471: 
472:     <span class="ruby-ivar">@src</span>       = <span class="ruby-keyword kw">nil</span>
473:     <span class="ruby-ivar">@lex_state</span> = <span class="ruby-keyword kw">nil</span>
474:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000024">
                    
                    <a name="M000024"></a><b>src=</b>(src)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000024_source')" id="l_M000024_source">show</a>
                        
                    </p>
                    <div id="M000024_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/ruby_lexer.rb, line 476</span>
476:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">src=</span> <span class="ruby-identifier">src</span>
477:     <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;bad src: #{src.inspect}&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">String</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">src</span>
478:     <span class="ruby-ivar">@src</span> = <span class="ruby-constant">RPStringScanner</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">src</span>)
479:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000025">
                    
                    <a name="M000025"></a><b>tokadd_escape</b>(term)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000025_source')" id="l_M000025_source">show</a>
                        
                    </p>
                    <div id="M000025_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/ruby_lexer.rb, line 481</span>
481:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">tokadd_escape</span> <span class="ruby-identifier">term</span> <span class="ruby-comment cmt"># 20 lines</span>
482:     <span class="ruby-keyword kw">case</span>
483:     <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\\\n/</span>) <span class="ruby-keyword kw">then</span>
484:       <span class="ruby-comment cmt"># just ignore</span>
485:     <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\\([0-7]{1,3}|x[0-9a-fA-F]{1,2})/</span>) <span class="ruby-keyword kw">then</span>
486:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">string_buffer</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">matched</span>
487:     <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\\([MC]-|c)(?=\\)/</span>) <span class="ruby-keyword kw">then</span>
488:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">string_buffer</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">matched</span>
489:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">tokadd_escape</span> <span class="ruby-identifier">term</span>
490:     <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\\([MC]-|c)(.)/</span>) <span class="ruby-keyword kw">then</span>
491:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">string_buffer</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">matched</span>
492:     <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\\[McCx]/</span>) <span class="ruby-keyword kw">then</span>
493:       <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-value str">&quot;Invalid escape character syntax&quot;</span>
494:     <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\\(.)/</span><span class="ruby-identifier">m</span>) <span class="ruby-keyword kw">then</span>
495:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">string_buffer</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">matched</span>
496:     <span class="ruby-keyword kw">else</span>
497:       <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-value str">&quot;Invalid escape character syntax&quot;</span>
498:     <span class="ruby-keyword kw">end</span>
499:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000026">
                    
                    <a name="M000026"></a><b>tokadd_string</b>(func, term, paren)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000026_source')" id="l_M000026_source">show</a>
                        
                    </p>
                    <div id="M000026_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/ruby_lexer.rb, line 501</span>
501:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">tokadd_string</span>(<span class="ruby-identifier">func</span>, <span class="ruby-identifier">term</span>, <span class="ruby-identifier">paren</span>) <span class="ruby-comment cmt"># 105 lines</span>
502:     <span class="ruby-identifier">awords</span> = (<span class="ruby-identifier">func</span> <span class="ruby-operator">&amp;</span> <span class="ruby-constant">STR_FUNC_AWORDS</span>) <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
503:     <span class="ruby-identifier">escape</span> = (<span class="ruby-identifier">func</span> <span class="ruby-operator">&amp;</span> <span class="ruby-constant">STR_FUNC_ESCAPE</span>) <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
504:     <span class="ruby-identifier">expand</span> = (<span class="ruby-identifier">func</span> <span class="ruby-operator">&amp;</span> <span class="ruby-constant">STR_FUNC_EXPAND</span>) <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
505:     <span class="ruby-identifier">regexp</span> = (<span class="ruby-identifier">func</span> <span class="ruby-operator">&amp;</span> <span class="ruby-constant">STR_FUNC_REGEXP</span>) <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
506:     <span class="ruby-identifier">symbol</span> = (<span class="ruby-identifier">func</span> <span class="ruby-operator">&amp;</span> <span class="ruby-constant">STR_FUNC_SYMBOL</span>) <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
507: 
508:     <span class="ruby-identifier">paren_re</span> = <span class="ruby-identifier">paren</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-value">? </span><span class="ruby-keyword kw">nil</span> <span class="ruby-operator">:</span> <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">escape</span>(<span class="ruby-identifier">paren</span>))
509:     <span class="ruby-identifier">term_re</span>  = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">escape</span>(<span class="ruby-identifier">term</span>))
510: 
511:     <span class="ruby-keyword kw">until</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">eos?</span> <span class="ruby-keyword kw">do</span>
512:       <span class="ruby-identifier">c</span> = <span class="ruby-keyword kw">nil</span>
513:       <span class="ruby-identifier">handled</span> = <span class="ruby-keyword kw">true</span>
514:       <span class="ruby-keyword kw">case</span>
515:       <span class="ruby-keyword kw">when</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">nest</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-identifier">term_re</span>) <span class="ruby-keyword kw">then</span>
516:         <span class="ruby-identifier">src</span>.<span class="ruby-identifier">pos</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span>
517:         <span class="ruby-keyword kw">break</span>
518:       <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">paren_re</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-identifier">paren_re</span>) <span class="ruby-keyword kw">then</span>
519:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">nest</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
520:       <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-identifier">term_re</span>) <span class="ruby-keyword kw">then</span>
521:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">nest</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span>
522:       <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">awords</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\s/</span>) <span class="ruby-keyword kw">then</span>
523:         <span class="ruby-identifier">src</span>.<span class="ruby-identifier">pos</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span>
524:         <span class="ruby-keyword kw">break</span>
525:       <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">expand</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/#(?=[\$\@\{])/</span>) <span class="ruby-keyword kw">then</span>
526:         <span class="ruby-identifier">src</span>.<span class="ruby-identifier">pos</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span>
527:         <span class="ruby-keyword kw">break</span>
528:       <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">expand</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/#(?!\n)/</span>) <span class="ruby-keyword kw">then</span>
529:         <span class="ruby-comment cmt"># do nothing</span>
530:       <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">check</span>(<span class="ruby-regexp re">/\\/</span>) <span class="ruby-keyword kw">then</span>
531:         <span class="ruby-keyword kw">case</span>
532:         <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">awords</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\\\n/</span>) <span class="ruby-keyword kw">then</span>
533:           <span class="ruby-identifier">string_buffer</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;\n&quot;</span>
534:           <span class="ruby-keyword kw">next</span>
535:         <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">awords</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\\\s/</span>) <span class="ruby-keyword kw">then</span>
536:           <span class="ruby-identifier">c</span> = <span class="ruby-value str">' '</span>
537:         <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">expand</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\\\n/</span>) <span class="ruby-keyword kw">then</span>
538:           <span class="ruby-keyword kw">next</span>
539:         <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">regexp</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">check</span>(<span class="ruby-regexp re">/\\/</span>) <span class="ruby-keyword kw">then</span>
540:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">tokadd_escape</span> <span class="ruby-identifier">term</span>
541:           <span class="ruby-keyword kw">next</span>
542:         <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">expand</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\\/</span>) <span class="ruby-keyword kw">then</span>
543:           <span class="ruby-identifier">c</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">read_escape</span>
544:         <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\\\n/</span>) <span class="ruby-keyword kw">then</span>
545:           <span class="ruby-comment cmt"># do nothing</span>
546:         <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\\\\/</span>) <span class="ruby-keyword kw">then</span>
547:           <span class="ruby-identifier">string_buffer</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">'\\'</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">escape</span>
548:           <span class="ruby-identifier">c</span> = <span class="ruby-value str">'\\'</span>
549:         <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\\/</span>) <span class="ruby-keyword kw">then</span>
550:           <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-identifier">term_re</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">paren</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-identifier">paren_re</span>) <span class="ruby-keyword kw">then</span>
551:             <span class="ruby-identifier">string_buffer</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;\\&quot;</span>
552:           <span class="ruby-keyword kw">end</span>
553:         <span class="ruby-keyword kw">else</span>
554:           <span class="ruby-identifier">handled</span> = <span class="ruby-keyword kw">false</span>
555:         <span class="ruby-keyword kw">end</span>
556:       <span class="ruby-keyword kw">else</span>
557:         <span class="ruby-identifier">handled</span> = <span class="ruby-keyword kw">false</span>
558:       <span class="ruby-keyword kw">end</span> <span class="ruby-comment cmt"># case</span>
559: 
560:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">handled</span> <span class="ruby-keyword kw">then</span>
561: 
562:         <span class="ruby-identifier">t</span> = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">escape</span> <span class="ruby-identifier">term</span>
563:         <span class="ruby-identifier">x</span> = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">escape</span>(<span class="ruby-identifier">paren</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">paren</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">paren</span> <span class="ruby-operator">!=</span> <span class="ruby-value str">&quot;\000&quot;</span>
564:         <span class="ruby-identifier">re</span> = <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">awords</span> <span class="ruby-keyword kw">then</span>
565:                <span class="ruby-node">/[^#{t}#{x}\#\0\\\n\ ]+|./</span> <span class="ruby-comment cmt"># |. to pick up whatever</span>
566:              <span class="ruby-keyword kw">else</span>
567:                <span class="ruby-node">/[^#{t}#{x}\#\0\\]+|./</span>
568:              <span class="ruby-keyword kw">end</span>
569: 
570:         <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span> <span class="ruby-identifier">re</span>
571:         <span class="ruby-identifier">c</span> = <span class="ruby-identifier">src</span>.<span class="ruby-identifier">matched</span>
572: 
573:         <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-value str">&quot;symbol cannot contain '\\0'&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">symbol</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">c</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/\0/</span>
574:       <span class="ruby-keyword kw">end</span> <span class="ruby-comment cmt"># unless handled</span>
575: 
576:       <span class="ruby-identifier">c</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">matched</span>
577:       <span class="ruby-identifier">string_buffer</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">c</span>
578:     <span class="ruby-keyword kw">end</span> <span class="ruby-comment cmt"># until</span>
579: 
580:     <span class="ruby-identifier">c</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">matched</span>
581:     <span class="ruby-identifier">c</span> = <span class="ruby-constant">RubyLexer</span><span class="ruby-operator">::</span><span class="ruby-constant">EOF</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">eos?</span>
582: 
583: 
584:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">c</span>
585:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000027">
                    
                    <a name="M000027"></a><b>unescape</b>(s)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000027_source')" id="l_M000027_source">show</a>
                        
                    </p>
                    <div id="M000027_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/ruby_lexer.rb, line 587</span>
587:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">unescape</span> <span class="ruby-identifier">s</span>
588: 
589:     <span class="ruby-identifier">r</span> = {
590:       <span class="ruby-value str">&quot;a&quot;</span>    =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;\007&quot;</span>,
591:       <span class="ruby-value str">&quot;b&quot;</span>    =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;\010&quot;</span>,
592:       <span class="ruby-value str">&quot;e&quot;</span>    =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;\033&quot;</span>,
593:       <span class="ruby-value str">&quot;f&quot;</span>    =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;\f&quot;</span>,
594:       <span class="ruby-value str">&quot;n&quot;</span>    =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;\n&quot;</span>,
595:       <span class="ruby-value str">&quot;r&quot;</span>    =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;\r&quot;</span>,
596:       <span class="ruby-value str">&quot;s&quot;</span>    =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot; &quot;</span>,
597:       <span class="ruby-value str">&quot;t&quot;</span>    =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;\t&quot;</span>,
598:       <span class="ruby-value str">&quot;v&quot;</span>    =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;\13&quot;</span>,
599:       <span class="ruby-value str">&quot;\\&quot;</span>   =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'\\'</span>,
600:       <span class="ruby-value str">&quot;\n&quot;</span>   =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;&quot;</span>,
601:       <span class="ruby-value str">&quot;C-\?&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">127</span>.<span class="ruby-identifier">chr</span>,
602:       <span class="ruby-value str">&quot;c\?&quot;</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-value">127</span>.<span class="ruby-identifier">chr</span>,
603:     }[<span class="ruby-identifier">s</span>]
604: 
605:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">r</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">r</span>
606: 
607:     <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">s</span>
608:     <span class="ruby-keyword kw">when</span> <span class="ruby-regexp re">/^[0-7]{1,3}/</span> <span class="ruby-keyword kw">then</span>
609:       <span class="ruby-identifier">$&amp;</span>.<span class="ruby-identifier">to_i</span>(<span class="ruby-value">8</span>).<span class="ruby-identifier">chr</span>
610:     <span class="ruby-keyword kw">when</span> <span class="ruby-regexp re">/^x([0-9a-fA-F]{1,2})/</span> <span class="ruby-keyword kw">then</span>
611:       <span class="ruby-identifier">$1</span>.<span class="ruby-identifier">to_i</span>(<span class="ruby-value">16</span>).<span class="ruby-identifier">chr</span>
612:     <span class="ruby-keyword kw">when</span> <span class="ruby-regexp re">/^M-(.)/</span> <span class="ruby-keyword kw">then</span>
613:       (<span class="ruby-identifier">$1</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">ord</span> <span class="ruby-operator">|</span> <span class="ruby-value">0x80</span>).<span class="ruby-identifier">chr</span>
614:     <span class="ruby-keyword kw">when</span> <span class="ruby-regexp re">/^(C-|c)(.)/</span> <span class="ruby-keyword kw">then</span>
615:       (<span class="ruby-identifier">$2</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">ord</span> <span class="ruby-operator">&amp;</span> <span class="ruby-value">0x9f</span>).<span class="ruby-identifier">chr</span>
616:     <span class="ruby-keyword kw">when</span> <span class="ruby-regexp re">/^[McCx0-9]/</span> <span class="ruby-keyword kw">then</span>
617:       <span class="ruby-identifier">rb_compile_error</span>(<span class="ruby-value str">&quot;Invalid escape character syntax&quot;</span>)
618:     <span class="ruby-keyword kw">else</span>
619:       <span class="ruby-identifier">s</span>
620:     <span class="ruby-keyword kw">end</span>
621:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000028">
                    
                    <a name="M000028"></a><b>warning</b>(s)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000028_source')" id="l_M000028_source">show</a>
                        
                    </p>
                    <div id="M000028_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/ruby_lexer.rb, line 623</span>
623:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">warning</span> <span class="ruby-identifier">s</span>
624:     <span class="ruby-comment cmt"># do nothing for now</span>
625:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000029">
                    
                    <a name="M000029"></a><b>yylex</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Returns the next token. Also sets yy_val is needed.
</p>
<p>
@return Description of the Returned Value
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000029_source')" id="l_M000029_source">show</a>
                        
                    </p>
                    <div id="M000029_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/ruby_lexer.rb, line 632</span>
 632:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">yylex</span> <span class="ruby-comment cmt"># 826 lines</span>
 633: 
 634:     <span class="ruby-identifier">c</span> = <span class="ruby-value str">''</span>
 635:     <span class="ruby-identifier">space_seen</span> = <span class="ruby-keyword kw">false</span>
 636:     <span class="ruby-identifier">command_state</span> = <span class="ruby-keyword kw">false</span>
 637:     <span class="ruby-identifier">src</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">src</span>
 638: 
 639:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">token</span> = <span class="ruby-keyword kw">nil</span>
 640:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-keyword kw">nil</span>
 641: 
 642:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">yylex_string</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">lex_strterm</span>
 643: 
 644:     <span class="ruby-identifier">command_state</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">command_start</span>
 645:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">command_start</span> = <span class="ruby-keyword kw">false</span>
 646: 
 647:     <span class="ruby-identifier">last_state</span> = <span class="ruby-identifier">lex_state</span>
 648: 
 649:     <span class="ruby-identifier">loop</span> <span class="ruby-keyword kw">do</span> <span class="ruby-comment cmt"># START OF CASE</span>
 650:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/[\ \t\r\f\v]/</span>) <span class="ruby-keyword kw">then</span> <span class="ruby-comment cmt"># \s - \n + \v</span>
 651:         <span class="ruby-identifier">space_seen</span> = <span class="ruby-keyword kw">true</span>
 652:         <span class="ruby-keyword kw">next</span>
 653:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">check</span>(<span class="ruby-regexp re">/[^a-zA-Z]/</span>) <span class="ruby-keyword kw">then</span>
 654:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\n|#/</span>) <span class="ruby-keyword kw">then</span>
 655:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lineno</span> = <span class="ruby-keyword kw">nil</span>
 656:           <span class="ruby-identifier">c</span> = <span class="ruby-identifier">src</span>.<span class="ruby-identifier">matched</span>
 657:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">c</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'#'</span> <span class="ruby-keyword kw">then</span>
 658:             <span class="ruby-identifier">src</span>.<span class="ruby-identifier">pos</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span>
 659: 
 660:             <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\s*#.*(\n+|\z)/</span>) <span class="ruby-keyword kw">do</span>
 661:               <span class="ruby-ivar">@comments</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">matched</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/^ +#/</span>, <span class="ruby-value str">'#'</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/^ +$/</span>, <span class="ruby-value str">''</span>)
 662:             <span class="ruby-keyword kw">end</span>
 663: 
 664:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">eos?</span> <span class="ruby-keyword kw">then</span>
 665:               <span class="ruby-keyword kw">return</span> <span class="ruby-constant">RubyLexer</span><span class="ruby-operator">::</span><span class="ruby-constant">EOF</span>
 666:             <span class="ruby-keyword kw">end</span>
 667:           <span class="ruby-keyword kw">end</span>
 668: 
 669:           <span class="ruby-comment cmt"># Replace a string of newlines with a single one</span>
 670:           <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\n+/</span>)
 671: 
 672:           <span class="ruby-keyword kw">if</span> [<span class="ruby-identifier">:expr_beg</span>, <span class="ruby-identifier">:expr_fname</span>,
 673:               <span class="ruby-identifier">:expr_dot</span>, <span class="ruby-identifier">:expr_class</span>].<span class="ruby-identifier">include?</span> <span class="ruby-identifier">lex_state</span> <span class="ruby-keyword kw">then</span>
 674:             <span class="ruby-keyword kw">next</span>
 675:           <span class="ruby-keyword kw">end</span>
 676: 
 677:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">command_start</span> = <span class="ruby-keyword kw">true</span>
 678:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_state</span> = <span class="ruby-identifier">:expr_beg</span>
 679:           <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tNL</span>
 680:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/[\]\)\}]/</span>) <span class="ruby-keyword kw">then</span>
 681:           <span class="ruby-identifier">cond</span>.<span class="ruby-identifier">lexpop</span>
 682:           <span class="ruby-identifier">cmdarg</span>.<span class="ruby-identifier">lexpop</span>
 683:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_state</span> = <span class="ruby-identifier">:expr_end</span>
 684:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-identifier">src</span>.<span class="ruby-identifier">matched</span>
 685:           <span class="ruby-identifier">result</span> = {
 686:             <span class="ruby-value str">&quot;)&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:tRPAREN</span>,
 687:             <span class="ruby-value str">&quot;]&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:tRBRACK</span>,
 688:             <span class="ruby-value str">&quot;}&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:tRCURLY</span>
 689:           }[<span class="ruby-identifier">src</span>.<span class="ruby-identifier">matched</span>]
 690:           <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">result</span>
 691:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\.\.\.?|,|![=~]?/</span>) <span class="ruby-keyword kw">then</span>
 692:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_state</span> = <span class="ruby-identifier">:expr_beg</span>
 693:           <span class="ruby-identifier">tok</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-identifier">src</span>.<span class="ruby-identifier">matched</span>
 694:           <span class="ruby-keyword kw">return</span> <span class="ruby-constant">TOKENS</span>[<span class="ruby-identifier">tok</span>]
 695:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">check</span>(<span class="ruby-regexp re">/\./</span>) <span class="ruby-keyword kw">then</span>
 696:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\.\d/</span>) <span class="ruby-keyword kw">then</span>
 697:             <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-value str">&quot;no .&lt;digit&gt; floating literal anymore put 0 before dot&quot;</span>
 698:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\./</span>) <span class="ruby-keyword kw">then</span>
 699:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_state</span> = <span class="ruby-identifier">:expr_dot</span>
 700:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-value str">&quot;.&quot;</span>
 701:             <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tDOT</span>
 702:           <span class="ruby-keyword kw">end</span>
 703:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\(/</span>) <span class="ruby-keyword kw">then</span>
 704:           <span class="ruby-identifier">result</span> = <span class="ruby-identifier">:tLPAREN2</span>
 705:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">command_start</span> = <span class="ruby-keyword kw">true</span>
 706: 
 707:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:expr_beg</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:expr_mid</span> <span class="ruby-keyword kw">then</span>
 708:             <span class="ruby-identifier">result</span> = <span class="ruby-identifier">:tLPAREN</span>
 709:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">space_seen</span> <span class="ruby-keyword kw">then</span>
 710:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:expr_cmdarg</span> <span class="ruby-keyword kw">then</span>
 711:               <span class="ruby-identifier">result</span> = <span class="ruby-identifier">:tLPAREN_ARG</span>
 712:             <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:expr_arg</span> <span class="ruby-keyword kw">then</span>
 713:               <span class="ruby-identifier">warning</span>(<span class="ruby-value str">&quot;don't put space before argument parentheses&quot;</span>)
 714:               <span class="ruby-identifier">result</span> = <span class="ruby-identifier">:tLPAREN2</span>
 715:             <span class="ruby-keyword kw">end</span>
 716:           <span class="ruby-keyword kw">end</span>
 717: 
 718:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">expr_beg_push</span> <span class="ruby-value str">&quot;(&quot;</span>
 719: 
 720:           <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">result</span>
 721:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">check</span>(<span class="ruby-regexp re">/\=/</span>) <span class="ruby-keyword kw">then</span>
 722:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\=\=\=|\=\=|\=~|\=&gt;|\=(?!begin\b)/</span>) <span class="ruby-keyword kw">then</span>
 723:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">fix_arg_lex_state</span>
 724:             <span class="ruby-identifier">tok</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-identifier">src</span>.<span class="ruby-identifier">matched</span>
 725:             <span class="ruby-keyword kw">return</span> <span class="ruby-constant">TOKENS</span>[<span class="ruby-identifier">tok</span>]
 726:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\=begin(?=\s)/</span>) <span class="ruby-keyword kw">then</span>
 727:             <span class="ruby-comment cmt"># @comments &lt;&lt; '=' &lt;&lt; src.matched</span>
 728:             <span class="ruby-ivar">@comments</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">matched</span>
 729: 
 730:             <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/.*?\n=end( |\t|\f)*[^\n]*(\n|\z)/</span><span class="ruby-identifier">m</span>) <span class="ruby-keyword kw">then</span>
 731:               <span class="ruby-ivar">@comments</span>.<span class="ruby-identifier">clear</span>
 732:               <span class="ruby-identifier">rb_compile_error</span>(<span class="ruby-value str">&quot;embedded document meets end of file&quot;</span>)
 733:             <span class="ruby-keyword kw">end</span>
 734: 
 735:             <span class="ruby-ivar">@comments</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">matched</span>
 736: 
 737:             <span class="ruby-keyword kw">next</span>
 738:           <span class="ruby-keyword kw">else</span>
 739:             <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;you shouldn't be able to get here&quot;</span>
 740:           <span class="ruby-keyword kw">end</span>
 741:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-node">/\&quot;(#{ESC_RE}|#(#{ESC_RE}|[^\{\#\@\$\&quot;\\])|[^\&quot;\\\#])*\&quot;/o</span>) <span class="ruby-keyword kw">then</span>
 742:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-identifier">src</span>.<span class="ruby-identifier">matched</span>[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">-2</span>].<span class="ruby-identifier">gsub</span>(<span class="ruby-constant">ESC_RE</span>) { <span class="ruby-identifier">unescape</span> <span class="ruby-identifier">$1</span> }
 743:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_state</span> = <span class="ruby-identifier">:expr_end</span>
 744:           <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tSTRING</span>
 745:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\&quot;/</span>) <span class="ruby-keyword kw">then</span> <span class="ruby-comment cmt"># FALLBACK</span>
 746:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_strterm</span> = [<span class="ruby-identifier">:strterm</span>, <span class="ruby-constant">STR_DQUOTE</span>, <span class="ruby-value str">'&quot;'</span>, <span class="ruby-value str">&quot;\0&quot;</span>] <span class="ruby-comment cmt"># TODO: question this</span>
 747:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-value str">&quot;\&quot;&quot;</span>
 748:           <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tSTRING_BEG</span>
 749:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\@\@?\w*/</span>) <span class="ruby-keyword kw">then</span>
 750:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">token</span> = <span class="ruby-identifier">src</span>.<span class="ruby-identifier">matched</span>
 751: 
 752:           <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-node">&quot;`#{token}` is not allowed as a variable name&quot;</span> <span class="ruby-keyword kw">if</span>
 753:             <span class="ruby-identifier">token</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/\@\d/</span>
 754: 
 755:           <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">process_token</span>(<span class="ruby-identifier">command_state</span>)
 756:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\:\:/</span>) <span class="ruby-keyword kw">then</span>
 757:           <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">lex_state</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:expr_beg</span> <span class="ruby-operator">||</span>
 758:               <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:expr_mid</span> <span class="ruby-operator">||</span>
 759:               <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:expr_class</span> <span class="ruby-operator">||</span>
 760:               (<span class="ruby-identifier">lex_state</span>.<span class="ruby-identifier">is_argument</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">space_seen</span>)) <span class="ruby-keyword kw">then</span>
 761:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_state</span> = <span class="ruby-identifier">:expr_beg</span>
 762:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-value str">&quot;::&quot;</span>
 763:             <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tCOLON3</span>
 764:           <span class="ruby-keyword kw">end</span>
 765: 
 766:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_state</span> = <span class="ruby-identifier">:expr_dot</span>
 767:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-value str">&quot;::&quot;</span>
 768:           <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tCOLON2</span>
 769:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">:expr_end</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">:expr_endarg</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/:([a-zA-Z_]\w*(?:[?!]|=(?!&gt;))?)/</span>) <span class="ruby-keyword kw">then</span>
 770:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-identifier">src</span>[<span class="ruby-value">1</span>]
 771:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_state</span> = <span class="ruby-identifier">:expr_end</span>
 772:           <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tSYMBOL</span>
 773:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\:/</span>) <span class="ruby-keyword kw">then</span>
 774:           <span class="ruby-comment cmt"># ?: / then / when</span>
 775:           <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">lex_state</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:expr_end</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:expr_endarg</span><span class="ruby-operator">||</span>
 776:               <span class="ruby-identifier">src</span>.<span class="ruby-identifier">check</span>(<span class="ruby-regexp re">/\s/</span>)) <span class="ruby-keyword kw">then</span>
 777:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_state</span> = <span class="ruby-identifier">:expr_beg</span>
 778:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-value str">&quot;:&quot;</span>
 779:             <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tCOLON</span>
 780:           <span class="ruby-keyword kw">end</span>
 781: 
 782:           <span class="ruby-keyword kw">case</span>
 783:           <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\'/</span>) <span class="ruby-keyword kw">then</span>
 784:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_strterm</span> = [<span class="ruby-identifier">:strterm</span>, <span class="ruby-constant">STR_SSYM</span>, <span class="ruby-identifier">src</span>.<span class="ruby-identifier">matched</span>, <span class="ruby-value str">&quot;\0&quot;</span>]
 785:           <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\&quot;/</span>) <span class="ruby-keyword kw">then</span>
 786:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_strterm</span> = [<span class="ruby-identifier">:strterm</span>, <span class="ruby-constant">STR_DSYM</span>, <span class="ruby-identifier">src</span>.<span class="ruby-identifier">matched</span>, <span class="ruby-value str">&quot;\0&quot;</span>]
 787:           <span class="ruby-keyword kw">end</span>
 788: 
 789:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_state</span> = <span class="ruby-identifier">:expr_fname</span>
 790:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-value str">&quot;:&quot;</span>
 791:           <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tSYMBEG</span>
 792:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">check</span>(<span class="ruby-regexp re">/[0-9]/</span>) <span class="ruby-keyword kw">then</span>
 793:           <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">parse_number</span>
 794:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\[/</span>) <span class="ruby-keyword kw">then</span>
 795:           <span class="ruby-identifier">result</span> = <span class="ruby-identifier">src</span>.<span class="ruby-identifier">matched</span>
 796: 
 797:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:expr_fname</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:expr_dot</span> <span class="ruby-keyword kw">then</span>
 798:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_state</span> = <span class="ruby-identifier">:expr_arg</span>
 799:             <span class="ruby-keyword kw">case</span>
 800:             <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\]\=/</span>) <span class="ruby-keyword kw">then</span>
 801:               <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-value str">&quot;[]=&quot;</span>
 802:               <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tASET</span>
 803:             <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\]/</span>) <span class="ruby-keyword kw">then</span>
 804:               <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-value str">&quot;[]&quot;</span>
 805:               <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tAREF</span>
 806:             <span class="ruby-keyword kw">else</span>
 807:               <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-value str">&quot;unexpected '['&quot;</span>
 808:             <span class="ruby-keyword kw">end</span>
 809:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:expr_beg</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:expr_mid</span> <span class="ruby-keyword kw">then</span>
 810:             <span class="ruby-identifier">result</span> = <span class="ruby-identifier">:tLBRACK</span>
 811:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">lex_state</span>.<span class="ruby-identifier">is_argument</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">space_seen</span> <span class="ruby-keyword kw">then</span>
 812:             <span class="ruby-identifier">result</span> = <span class="ruby-identifier">:tLBRACK</span>
 813:           <span class="ruby-keyword kw">end</span>
 814: 
 815:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">expr_beg_push</span> <span class="ruby-value str">&quot;[&quot;</span>
 816: 
 817:           <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">result</span>
 818:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\'(\\.|[^\'])*\'/</span>) <span class="ruby-keyword kw">then</span>
 819:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-identifier">src</span>.<span class="ruby-identifier">matched</span>[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">-2</span>].<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/\\\\/</span>, <span class="ruby-value str">&quot;\\&quot;</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/\\'/</span>, <span class="ruby-value str">&quot;'&quot;</span>)
 820:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_state</span> = <span class="ruby-identifier">:expr_end</span>
 821:           <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tSTRING</span>
 822:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">check</span>(<span class="ruby-regexp re">/\|/</span>) <span class="ruby-keyword kw">then</span>
 823:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\|\|\=/</span>) <span class="ruby-keyword kw">then</span>
 824:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_state</span> = <span class="ruby-identifier">:expr_beg</span>
 825:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-value str">&quot;||&quot;</span>
 826:             <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tOP_ASGN</span>
 827:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\|\|/</span>) <span class="ruby-keyword kw">then</span>
 828:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_state</span> = <span class="ruby-identifier">:expr_beg</span>
 829:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-value str">&quot;||&quot;</span>
 830:             <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tOROP</span>
 831:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\|\=/</span>) <span class="ruby-keyword kw">then</span>
 832:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_state</span> = <span class="ruby-identifier">:expr_beg</span>
 833:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-value str">&quot;|&quot;</span>
 834:             <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tOP_ASGN</span>
 835:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\|/</span>) <span class="ruby-keyword kw">then</span>
 836:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">fix_arg_lex_state</span>
 837:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-value str">&quot;|&quot;</span>
 838:             <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tPIPE</span>
 839:           <span class="ruby-keyword kw">end</span>
 840:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\{/</span>) <span class="ruby-keyword kw">then</span>
 841:           <span class="ruby-identifier">result</span> = <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">lex_state</span>.<span class="ruby-identifier">is_argument</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:expr_end</span> <span class="ruby-keyword kw">then</span>
 842:                      <span class="ruby-identifier">:tLCURLY</span>      <span class="ruby-comment cmt">#  block (primary)</span>
 843:                    <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:expr_endarg</span> <span class="ruby-keyword kw">then</span>
 844:                      <span class="ruby-identifier">:tLBRACE_ARG</span>  <span class="ruby-comment cmt">#  block (expr)</span>
 845:                    <span class="ruby-keyword kw">else</span>
 846:                      <span class="ruby-identifier">:tLBRACE</span>      <span class="ruby-comment cmt">#  hash</span>
 847:                    <span class="ruby-keyword kw">end</span>
 848: 
 849:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">expr_beg_push</span> <span class="ruby-value str">&quot;{&quot;</span>
 850:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">command_start</span> = <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">result</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:tLBRACE</span>
 851: 
 852:           <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">result</span>
 853:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/[+-]/</span>) <span class="ruby-keyword kw">then</span>
 854:           <span class="ruby-identifier">sign</span> = <span class="ruby-identifier">src</span>.<span class="ruby-identifier">matched</span>
 855:           <span class="ruby-identifier">utype</span>, <span class="ruby-identifier">type</span> = <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">sign</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;+&quot;</span> <span class="ruby-keyword kw">then</span>
 856:                           [<span class="ruby-identifier">:tUPLUS</span>, <span class="ruby-identifier">:tPLUS</span>]
 857:                         <span class="ruby-keyword kw">else</span>
 858:                           [<span class="ruby-identifier">:tUMINUS</span>, <span class="ruby-identifier">:tMINUS</span>]
 859:                         <span class="ruby-keyword kw">end</span>
 860: 
 861:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:expr_fname</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:expr_dot</span> <span class="ruby-keyword kw">then</span>
 862:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_state</span> = <span class="ruby-identifier">:expr_arg</span>
 863:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/@/</span>) <span class="ruby-keyword kw">then</span>
 864:               <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-node">&quot;#{sign}@&quot;</span>
 865:               <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">utype</span>
 866:             <span class="ruby-keyword kw">else</span>
 867:               <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-identifier">sign</span>
 868:               <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">type</span>
 869:             <span class="ruby-keyword kw">end</span>
 870:           <span class="ruby-keyword kw">end</span>
 871: 
 872:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\=/</span>) <span class="ruby-keyword kw">then</span>
 873:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_state</span> = <span class="ruby-identifier">:expr_beg</span>
 874:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-identifier">sign</span>
 875:             <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tOP_ASGN</span>
 876:           <span class="ruby-keyword kw">end</span>
 877: 
 878:           <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">lex_state</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:expr_beg</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:expr_mid</span> <span class="ruby-operator">||</span>
 879:               (<span class="ruby-identifier">lex_state</span>.<span class="ruby-identifier">is_argument</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">space_seen</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">src</span>.<span class="ruby-identifier">check</span>(<span class="ruby-regexp re">/\s/</span>))) <span class="ruby-keyword kw">then</span>
 880:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">lex_state</span>.<span class="ruby-identifier">is_argument</span> <span class="ruby-keyword kw">then</span>
 881:               <span class="ruby-identifier">arg_ambiguous</span>
 882:             <span class="ruby-keyword kw">end</span>
 883: 
 884:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_state</span> = <span class="ruby-identifier">:expr_beg</span>
 885:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-identifier">sign</span>
 886: 
 887:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">check</span>(<span class="ruby-regexp re">/\d/</span>) <span class="ruby-keyword kw">then</span>
 888:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">utype</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:tUPLUS</span> <span class="ruby-keyword kw">then</span>
 889:                 <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">parse_number</span>
 890:               <span class="ruby-keyword kw">else</span>
 891:                 <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tUMINUS_NUM</span>
 892:               <span class="ruby-keyword kw">end</span>
 893:             <span class="ruby-keyword kw">end</span>
 894: 
 895:             <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">utype</span>
 896:           <span class="ruby-keyword kw">end</span>
 897: 
 898:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_state</span> = <span class="ruby-identifier">:expr_beg</span>
 899:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-identifier">sign</span>
 900:           <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">type</span>
 901:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">check</span>(<span class="ruby-regexp re">/\*/</span>) <span class="ruby-keyword kw">then</span>
 902:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\*\*=/</span>) <span class="ruby-keyword kw">then</span>
 903:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_state</span> = <span class="ruby-identifier">:expr_beg</span>
 904:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-value str">&quot;**&quot;</span>
 905:             <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tOP_ASGN</span>
 906:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\*\*/</span>) <span class="ruby-keyword kw">then</span>
 907:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-value str">&quot;**&quot;</span>
 908:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">fix_arg_lex_state</span>
 909:             <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tPOW</span>
 910:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\*\=/</span>) <span class="ruby-keyword kw">then</span>
 911:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_state</span> = <span class="ruby-identifier">:expr_beg</span>
 912:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-value str">&quot;*&quot;</span>
 913:             <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tOP_ASGN</span>
 914:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\*/</span>) <span class="ruby-keyword kw">then</span>
 915:             <span class="ruby-identifier">result</span> = <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">lex_state</span>.<span class="ruby-identifier">is_argument</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">space_seen</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">check</span>(<span class="ruby-regexp re">/\S/</span>) <span class="ruby-keyword kw">then</span>
 916:                        <span class="ruby-identifier">warning</span>(<span class="ruby-value str">&quot;`*' interpreted as argument prefix&quot;</span>)
 917:                        <span class="ruby-identifier">:tSTAR</span>
 918:                      <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:expr_beg</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:expr_mid</span> <span class="ruby-keyword kw">then</span>
 919:                        <span class="ruby-identifier">:tSTAR</span>
 920:                      <span class="ruby-keyword kw">else</span>
 921:                        <span class="ruby-identifier">:tSTAR2</span>
 922:                      <span class="ruby-keyword kw">end</span>
 923:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-value str">&quot;*&quot;</span>
 924:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">fix_arg_lex_state</span>
 925: 
 926:             <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">result</span>
 927:           <span class="ruby-keyword kw">end</span>
 928:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">check</span>(<span class="ruby-regexp re">/\&lt;/</span>) <span class="ruby-keyword kw">then</span>
 929:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\&lt;\=\&gt;/</span>) <span class="ruby-keyword kw">then</span>
 930:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">fix_arg_lex_state</span>
 931:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-value str">&quot;&lt;=&gt;&quot;</span>
 932:             <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tCMP</span>
 933:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\&lt;\=/</span>) <span class="ruby-keyword kw">then</span>
 934:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">fix_arg_lex_state</span>
 935:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-value str">&quot;&lt;=&quot;</span>
 936:             <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tLEQ</span>
 937:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\&lt;\&lt;\=/</span>) <span class="ruby-keyword kw">then</span>
 938:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">fix_arg_lex_state</span>
 939:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_state</span> = <span class="ruby-identifier">:expr_beg</span>
 940:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-value str">&quot;\&lt;\&lt;&quot;</span>
 941:             <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tOP_ASGN</span>
 942:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\&lt;\&lt;/</span>) <span class="ruby-keyword kw">then</span>
 943:             <span class="ruby-keyword kw">if</span> (<span class="ruby-operator">!</span> [<span class="ruby-identifier">:expr_end</span>,    <span class="ruby-identifier">:expr_dot</span>,
 944:                    <span class="ruby-identifier">:expr_endarg</span>, <span class="ruby-identifier">:expr_class</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">lex_state</span>) <span class="ruby-operator">&amp;&amp;</span>
 945:                 (<span class="ruby-operator">!</span><span class="ruby-identifier">lex_state</span>.<span class="ruby-identifier">is_argument</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">space_seen</span>)) <span class="ruby-keyword kw">then</span>
 946:               <span class="ruby-identifier">tok</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">heredoc_identifier</span>
 947:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">tok</span> <span class="ruby-keyword kw">then</span>
 948:                 <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">tok</span>
 949:               <span class="ruby-keyword kw">end</span>
 950:             <span class="ruby-keyword kw">end</span>
 951: 
 952:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">fix_arg_lex_state</span>
 953:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-value str">&quot;\&lt;\&lt;&quot;</span>
 954:             <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tLSHFT</span>
 955:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\&lt;/</span>) <span class="ruby-keyword kw">then</span>
 956:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">fix_arg_lex_state</span>
 957:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-value str">&quot;&lt;&quot;</span>
 958:             <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tLT</span>
 959:           <span class="ruby-keyword kw">end</span>
 960:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">check</span>(<span class="ruby-regexp re">/\&gt;/</span>) <span class="ruby-keyword kw">then</span>
 961:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\&gt;\=/</span>) <span class="ruby-keyword kw">then</span>
 962:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">fix_arg_lex_state</span>
 963:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-value str">&quot;&gt;=&quot;</span>
 964:             <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tGEQ</span>
 965:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\&gt;\&gt;=/</span>) <span class="ruby-keyword kw">then</span>
 966:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">fix_arg_lex_state</span>
 967:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_state</span> = <span class="ruby-identifier">:expr_beg</span>
 968:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-value str">&quot;&gt;&gt;&quot;</span>
 969:             <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tOP_ASGN</span>
 970:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\&gt;\&gt;/</span>) <span class="ruby-keyword kw">then</span>
 971:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">fix_arg_lex_state</span>
 972:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-value str">&quot;&gt;&gt;&quot;</span>
 973:             <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tRSHFT</span>
 974:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\&gt;/</span>) <span class="ruby-keyword kw">then</span>
 975:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">fix_arg_lex_state</span>
 976:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-value str">&quot;&gt;&quot;</span>
 977:             <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tGT</span>
 978:           <span class="ruby-keyword kw">end</span>
 979:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\`/</span>) <span class="ruby-keyword kw">then</span>
 980:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-value str">&quot;`&quot;</span>
 981:           <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">lex_state</span>
 982:           <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:expr_fname</span> <span class="ruby-keyword kw">then</span>
 983:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_state</span> = <span class="ruby-identifier">:expr_end</span>
 984:             <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tBACK_REF2</span>
 985:           <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:expr_dot</span> <span class="ruby-keyword kw">then</span>
 986:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_state</span> = <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">command_state</span> <span class="ruby-keyword kw">then</span>
 987:                                <span class="ruby-identifier">:expr_cmdarg</span>
 988:                              <span class="ruby-keyword kw">else</span>
 989:                                <span class="ruby-identifier">:expr_arg</span>
 990:                              <span class="ruby-keyword kw">end</span>
 991:             <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tBACK_REF2</span>
 992:           <span class="ruby-keyword kw">end</span>
 993:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_strterm</span> = [<span class="ruby-identifier">:strterm</span>, <span class="ruby-constant">STR_XQUOTE</span>, <span class="ruby-value str">'`'</span>, <span class="ruby-value str">&quot;\0&quot;</span>]
 994:           <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tXSTRING_BEG</span>
 995:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\?/</span>) <span class="ruby-keyword kw">then</span>
 996:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:expr_end</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:expr_endarg</span> <span class="ruby-keyword kw">then</span>
 997:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_state</span> = <span class="ruby-identifier">:expr_beg</span>
 998:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-value str">&quot;?&quot;</span>
 999:             <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tEH</span>
1000:           <span class="ruby-keyword kw">end</span>
1001: 
1002:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">eos?</span> <span class="ruby-keyword kw">then</span>
1003:             <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-value str">&quot;incomplete character syntax&quot;</span>
1004:           <span class="ruby-keyword kw">end</span>
1005: 
1006:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">check</span>(<span class="ruby-regexp re">/\s|\v/</span>) <span class="ruby-keyword kw">then</span>
1007:             <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">lex_state</span>.<span class="ruby-identifier">is_argument</span> <span class="ruby-keyword kw">then</span>
1008:               <span class="ruby-identifier">c2</span> = { <span class="ruby-value str">&quot; &quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'s'</span>,
1009:                     <span class="ruby-value str">&quot;\n&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'n'</span>,
1010:                     <span class="ruby-value str">&quot;\t&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'t'</span>,
1011:                     <span class="ruby-value str">&quot;\v&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'v'</span>,
1012:                     <span class="ruby-value str">&quot;\r&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'r'</span>,
1013:                     <span class="ruby-value str">&quot;\f&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'f'</span> }[<span class="ruby-identifier">src</span>.<span class="ruby-identifier">matched</span>]
1014: 
1015:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">c2</span> <span class="ruby-keyword kw">then</span>
1016:                 <span class="ruby-identifier">warning</span>(<span class="ruby-value str">&quot;invalid character syntax; use ?\\&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">c2</span>)
1017:               <span class="ruby-keyword kw">end</span>
1018:             <span class="ruby-keyword kw">end</span>
1019: 
1020:             <span class="ruby-comment cmt"># ternary</span>
1021:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_state</span> = <span class="ruby-identifier">:expr_beg</span>
1022:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-value str">&quot;?&quot;</span>
1023:             <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tEH</span>
1024:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">check</span>(<span class="ruby-regexp re">/\w(?=\w)/</span>) <span class="ruby-keyword kw">then</span> <span class="ruby-comment cmt"># ternary, also</span>
1025:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_state</span> = <span class="ruby-identifier">:expr_beg</span>
1026:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-value str">&quot;?&quot;</span>
1027:             <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tEH</span>
1028:           <span class="ruby-keyword kw">end</span>
1029: 
1030:           <span class="ruby-identifier">c</span> = <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\\/</span>) <span class="ruby-keyword kw">then</span>
1031:                 <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">read_escape</span>
1032:               <span class="ruby-keyword kw">else</span>
1033:                 <span class="ruby-identifier">src</span>.<span class="ruby-identifier">getch</span>
1034:               <span class="ruby-keyword kw">end</span>
1035:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_state</span> = <span class="ruby-identifier">:expr_end</span>
1036:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-identifier">c</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">ord</span> <span class="ruby-operator">&amp;</span> <span class="ruby-value">0xff</span>
1037:           <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tINTEGER</span>
1038:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">check</span>(<span class="ruby-regexp re">/\&amp;/</span>) <span class="ruby-keyword kw">then</span>
1039:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\&amp;\&amp;\=/</span>) <span class="ruby-keyword kw">then</span>
1040:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-value str">&quot;&amp;&amp;&quot;</span>
1041:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_state</span> = <span class="ruby-identifier">:expr_beg</span>
1042:             <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tOP_ASGN</span>
1043:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\&amp;\&amp;/</span>) <span class="ruby-keyword kw">then</span>
1044:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_state</span> = <span class="ruby-identifier">:expr_beg</span>
1045:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-value str">&quot;&amp;&amp;&quot;</span>
1046:             <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tANDOP</span>
1047:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\&amp;\=/</span>) <span class="ruby-keyword kw">then</span>
1048:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-value str">&quot;&amp;&quot;</span>
1049:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_state</span> = <span class="ruby-identifier">:expr_beg</span>
1050:             <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tOP_ASGN</span>
1051:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/&amp;/</span>) <span class="ruby-keyword kw">then</span>
1052:             <span class="ruby-identifier">result</span> = <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">lex_state</span>.<span class="ruby-identifier">is_argument</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">space_seen</span> <span class="ruby-operator">&amp;&amp;</span>
1053:                          <span class="ruby-operator">!</span><span class="ruby-identifier">src</span>.<span class="ruby-identifier">check</span>(<span class="ruby-regexp re">/\s/</span>) <span class="ruby-keyword kw">then</span>
1054:                        <span class="ruby-identifier">warning</span>(<span class="ruby-value str">&quot;`&amp;' interpreted as argument prefix&quot;</span>)
1055:                        <span class="ruby-identifier">:tAMPER</span>
1056:                      <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:expr_beg</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:expr_mid</span> <span class="ruby-keyword kw">then</span>
1057:                        <span class="ruby-identifier">:tAMPER</span>
1058:                      <span class="ruby-keyword kw">else</span>
1059:                        <span class="ruby-identifier">:tAMPER2</span>
1060:                      <span class="ruby-keyword kw">end</span>
1061: 
1062:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">fix_arg_lex_state</span>
1063:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-value str">&quot;&amp;&quot;</span>
1064:             <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">result</span>
1065:           <span class="ruby-keyword kw">end</span>
1066:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\//</span>) <span class="ruby-keyword kw">then</span>
1067:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:expr_beg</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:expr_mid</span> <span class="ruby-keyword kw">then</span>
1068:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_strterm</span> = [<span class="ruby-identifier">:strterm</span>, <span class="ruby-constant">STR_REGEXP</span>, <span class="ruby-value str">'/'</span>, <span class="ruby-value str">&quot;\0&quot;</span>]
1069:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-value str">&quot;/&quot;</span>
1070:             <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tREGEXP_BEG</span>
1071:           <span class="ruby-keyword kw">end</span>
1072: 
1073:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\=/</span>) <span class="ruby-keyword kw">then</span>
1074:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-value str">&quot;/&quot;</span>
1075:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_state</span> = <span class="ruby-identifier">:expr_beg</span>
1076:             <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tOP_ASGN</span>
1077:           <span class="ruby-keyword kw">end</span>
1078: 
1079:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">lex_state</span>.<span class="ruby-identifier">is_argument</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">space_seen</span> <span class="ruby-keyword kw">then</span>
1080:             <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\s/</span>) <span class="ruby-keyword kw">then</span>
1081:               <span class="ruby-identifier">arg_ambiguous</span>
1082:               <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_strterm</span> = [<span class="ruby-identifier">:strterm</span>, <span class="ruby-constant">STR_REGEXP</span>, <span class="ruby-value str">'/'</span>, <span class="ruby-value str">&quot;\0&quot;</span>]
1083:               <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-value str">&quot;/&quot;</span>
1084:               <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tREGEXP_BEG</span>
1085:             <span class="ruby-keyword kw">end</span>
1086:           <span class="ruby-keyword kw">end</span>
1087: 
1088:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">fix_arg_lex_state</span>
1089:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-value str">&quot;/&quot;</span>
1090: 
1091:           <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tDIVIDE</span>
1092:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\^=/</span>) <span class="ruby-keyword kw">then</span>
1093:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_state</span> = <span class="ruby-identifier">:expr_beg</span>
1094:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-value str">&quot;^&quot;</span>
1095:           <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tOP_ASGN</span>
1096:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\^/</span>) <span class="ruby-keyword kw">then</span>
1097:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">fix_arg_lex_state</span>
1098:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-value str">&quot;^&quot;</span>
1099:           <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tCARET</span>
1100:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\;/</span>) <span class="ruby-keyword kw">then</span>
1101:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">command_start</span> = <span class="ruby-keyword kw">true</span>
1102:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_state</span> = <span class="ruby-identifier">:expr_beg</span>
1103:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-value str">&quot;;&quot;</span>
1104:           <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tSEMI</span>
1105:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\~/</span>) <span class="ruby-keyword kw">then</span>
1106:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:expr_fname</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:expr_dot</span> <span class="ruby-keyword kw">then</span>
1107:             <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/@/</span>)
1108:           <span class="ruby-keyword kw">end</span>
1109: 
1110:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">fix_arg_lex_state</span>
1111:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-value str">&quot;~&quot;</span>
1112: 
1113:           <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tTILDE</span>
1114:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\\/</span>) <span class="ruby-keyword kw">then</span>
1115:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\n/</span>) <span class="ruby-keyword kw">then</span>
1116:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lineno</span> = <span class="ruby-keyword kw">nil</span>
1117:             <span class="ruby-identifier">space_seen</span> = <span class="ruby-keyword kw">true</span>
1118:             <span class="ruby-keyword kw">next</span>
1119:           <span class="ruby-keyword kw">end</span>
1120:           <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-value str">&quot;bare backslash only allowed before newline&quot;</span>
1121:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\%/</span>) <span class="ruby-keyword kw">then</span>
1122:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:expr_beg</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:expr_mid</span> <span class="ruby-keyword kw">then</span>
1123:             <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">parse_quote</span>
1124:           <span class="ruby-keyword kw">end</span>
1125: 
1126:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\=/</span>) <span class="ruby-keyword kw">then</span>
1127:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_state</span> = <span class="ruby-identifier">:expr_beg</span>
1128:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-value str">&quot;%&quot;</span>
1129:             <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tOP_ASGN</span>
1130:           <span class="ruby-keyword kw">end</span>
1131: 
1132:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">lex_state</span>.<span class="ruby-identifier">is_argument</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">space_seen</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">check</span>(<span class="ruby-regexp re">/\s/</span>) <span class="ruby-keyword kw">then</span>
1133:             <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">parse_quote</span>
1134:           <span class="ruby-keyword kw">end</span>
1135: 
1136:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">fix_arg_lex_state</span>
1137:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-value str">&quot;%&quot;</span>
1138: 
1139:           <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tPERCENT</span>
1140:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">check</span>(<span class="ruby-regexp re">/\$/</span>) <span class="ruby-keyword kw">then</span>
1141:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/(\$_)(\w+)/</span>) <span class="ruby-keyword kw">then</span>
1142:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_state</span> = <span class="ruby-identifier">:expr_end</span>
1143:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">token</span> = <span class="ruby-identifier">src</span>.<span class="ruby-identifier">matched</span>
1144:             <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">process_token</span>(<span class="ruby-identifier">command_state</span>)
1145:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\$_/</span>) <span class="ruby-keyword kw">then</span>
1146:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_state</span> = <span class="ruby-identifier">:expr_end</span>
1147:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">token</span> = <span class="ruby-identifier">src</span>.<span class="ruby-identifier">matched</span>
1148:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-identifier">src</span>.<span class="ruby-identifier">matched</span>
1149:             <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tGVAR</span>
1150:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\$[~*$?!@\/\\;,.=:&lt;&gt;\&quot;]|\$-\w?/</span>) <span class="ruby-keyword kw">then</span>
1151:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_state</span> = <span class="ruby-identifier">:expr_end</span>
1152:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-identifier">src</span>.<span class="ruby-identifier">matched</span>
1153:             <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tGVAR</span>
1154:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\$([\&amp;\`\'\+])/</span>) <span class="ruby-keyword kw">then</span>
1155:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_state</span> = <span class="ruby-identifier">:expr_end</span>
1156:             <span class="ruby-comment cmt"># Explicit reference to these vars as symbols...</span>
1157:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">last_state</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:expr_fname</span> <span class="ruby-keyword kw">then</span>
1158:               <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-identifier">src</span>.<span class="ruby-identifier">matched</span>
1159:               <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tGVAR</span>
1160:             <span class="ruby-keyword kw">else</span>
1161:               <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-identifier">src</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">to_sym</span>
1162:               <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tBACK_REF</span>
1163:             <span class="ruby-keyword kw">end</span>
1164:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\$([1-9]\d*)/</span>) <span class="ruby-keyword kw">then</span>
1165:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_state</span> = <span class="ruby-identifier">:expr_end</span>
1166:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">last_state</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:expr_fname</span> <span class="ruby-keyword kw">then</span>
1167:               <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-identifier">src</span>.<span class="ruby-identifier">matched</span>
1168:               <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tGVAR</span>
1169:             <span class="ruby-keyword kw">else</span>
1170:               <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-identifier">src</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">to_i</span>
1171:               <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">:tNTH_REF</span>
1172:             <span class="ruby-keyword kw">end</span>
1173:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\$0/</span>) <span class="ruby-keyword kw">then</span>
1174:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_state</span> = <span class="ruby-identifier">:expr_end</span>
1175:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">token</span> = <span class="ruby-identifier">src</span>.<span class="ruby-identifier">matched</span>
1176:             <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">process_token</span>(<span class="ruby-identifier">command_state</span>)
1177:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\$\W|\$\z/</span>) <span class="ruby-keyword kw">then</span> <span class="ruby-comment cmt"># TODO: remove?</span>
1178:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_state</span> = <span class="ruby-identifier">:expr_end</span>
1179:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">yacc_value</span> = <span class="ruby-value str">&quot;$&quot;</span>
1180:             <span class="ruby-keyword kw">return</span> <span class="ruby-value str">&quot;$&quot;</span>
1181:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\$\w+/</span>)
1182:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_state</span> = <span class="ruby-identifier">:expr_end</span>
1183:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">token</span> = <span class="ruby-identifier">src</span>.<span class="ruby-identifier">matched</span>
1184:             <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">process_token</span>(<span class="ruby-identifier">command_state</span>)
1185:           <span class="ruby-keyword kw">end</span>
1186:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">check</span>(<span class="ruby-regexp re">/\_/</span>) <span class="ruby-keyword kw">then</span>
1187:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">beginning_of_line?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\__END__(\n|\Z)/</span>) <span class="ruby-keyword kw">then</span>
1188:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lineno</span> = <span class="ruby-keyword kw">nil</span>
1189:             <span class="ruby-keyword kw">return</span> <span class="ruby-constant">RubyLexer</span><span class="ruby-operator">::</span><span class="ruby-constant">EOF</span>
1190:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\_\w*/</span>) <span class="ruby-keyword kw">then</span>
1191:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">token</span> = <span class="ruby-identifier">src</span>.<span class="ruby-identifier">matched</span>
1192:             <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">process_token</span>(<span class="ruby-identifier">command_state</span>)
1193:           <span class="ruby-keyword kw">end</span>
1194:         <span class="ruby-keyword kw">end</span>
1195:       <span class="ruby-keyword kw">end</span> <span class="ruby-comment cmt"># END OF CASE</span>
1196: 
1197:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\004|\032|\000/</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">eos?</span> <span class="ruby-keyword kw">then</span> <span class="ruby-comment cmt"># ^D, ^Z, EOF</span>
1198:         <span class="ruby-keyword kw">return</span> <span class="ruby-constant">RubyLexer</span><span class="ruby-operator">::</span><span class="ruby-constant">EOF</span>
1199:       <span class="ruby-keyword kw">else</span> <span class="ruby-comment cmt"># alpha check</span>
1200:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\W/</span>) <span class="ruby-keyword kw">then</span>
1201:           <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-node">&quot;Invalid char #{src.matched.inspect} in expression&quot;</span>
1202:         <span class="ruby-keyword kw">end</span>
1203:       <span class="ruby-keyword kw">end</span>
1204: 
1205:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">token</span> = <span class="ruby-identifier">src</span>.<span class="ruby-identifier">matched</span> <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">src</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\w+/</span>)
1206: 
1207:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">process_token</span>(<span class="ruby-identifier">command_state</span>)
1208:     <span class="ruby-keyword kw">end</span>
1209:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000031">
                    
                    <a name="M000031"></a><b>yylex_string</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000031_source')" id="l_M000031_source">show</a>
                        
                    </p>
                    <div id="M000031_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/ruby_lexer.rb, line 1298</span>
1298:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">yylex_string</span> <span class="ruby-comment cmt"># 23 lines</span>
1299:     <span class="ruby-identifier">token</span> = <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">lex_strterm</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">:heredoc</span> <span class="ruby-keyword kw">then</span>
1300:               <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">heredoc</span> <span class="ruby-identifier">lex_strterm</span>
1301:             <span class="ruby-keyword kw">else</span>
1302:               <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">parse_string</span> <span class="ruby-identifier">lex_strterm</span>
1303:             <span class="ruby-keyword kw">end</span>
1304: 
1305:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">token</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:tSTRING_END</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">token</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:tREGEXP_END</span> <span class="ruby-keyword kw">then</span>
1306:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lineno</span>      = <span class="ruby-keyword kw">nil</span>
1307:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_strterm</span> = <span class="ruby-keyword kw">nil</span>
1308:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lex_state</span>   = <span class="ruby-identifier">:expr_end</span>
1309:     <span class="ruby-keyword kw">end</span>
1310: 
1311:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">token</span>
1312:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    