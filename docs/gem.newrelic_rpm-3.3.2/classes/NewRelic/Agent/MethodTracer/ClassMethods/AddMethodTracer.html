<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>NewRelic::Agent::MethodTracer::ClassMethods::AddMethodTracer</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../../../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../../../../css/main.css" type="text/css" media="screen" />
    <script src="../../../../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Module</span> 
            NewRelic::Agent::MethodTracer::ClassMethods::AddMethodTracer 
            
        </h1>
        <ul class="files">
            
            <li><a href="../../../../../files/lib/new_relic/agent/method_tracer_rb.html">lib/new_relic/agent/method_tracer.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    
    <div class="description">
        <p>
contains methods refactored out of the add_method_tracer method
</p>

    </div>
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>A</dt>
        <dd>
            <ul>
                
                <li><a href="#M000357">any_unrecognized_keys?</a>,</li>
                
                <li><a href="#M000371">assemble_code_header</a></li>
                
            </ul>
        </dd>
    
        <dt>C</dt>
        <dd>
            <ul>
                
                <li><a href="#M000358">check_for_illegal_keys!</a>,</li>
                
                <li><a href="#M000360">check_for_push_scope_and_metric</a>,</li>
                
                <li><a href="#M000378">code_to_eval</a></li>
                
            </ul>
        </dd>
    
        <dt>D</dt>
        <dd>
            <ul>
                
                <li><a href="#M000363">default_metric_name_code</a></li>
                
            </ul>
        </dd>
    
        <dt>M</dt>
        <dd>
            <ul>
                
                <li><a href="#M000375">method_with_push_scope</a>,</li>
                
                <li><a href="#M000374">method_without_push_scope</a></li>
                
            </ul>
        </dd>
    
        <dt>N</dt>
        <dd>
            <ul>
                
                <li><a href="#M000364">newrelic_method_exists?</a></li>
                
            </ul>
        </dd>
    
        <dt>S</dt>
        <dd>
            <ul>
                
                <li><a href="#M000359">set_deduct_call_time_based_on_metric</a></li>
                
            </ul>
        </dd>
    
        <dt>T</dt>
        <dd>
            <ul>
                
                <li><a href="#M000365">traced_method_exists?</a></li>
                
            </ul>
        </dd>
    
        <dt>U</dt>
        <dd>
            <ul>
                
                <li><a href="#M000356">unrecognized_keys</a></li>
                
            </ul>
        </dd>
    
        <dt>V</dt>
        <dd>
            <ul>
                
                <li><a href="#M000362">validate_options</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    

    

    

    
    <div class="sectiontitle">Constants</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class="attr-name">ALLOWED_KEYS</td>
            <td>=</td>
            <td class="attr-value">[:force, :metric, :push_scope, :deduct_call_time_from_parent, :code_header, :code_footer, :scoped_metric_only].freeze</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">DEFAULT_SETTINGS</td>
            <td>=</td>
            <td class="attr-value">{:push_scope =&gt; true, :metric =&gt; true, :force =&gt; false, :code_header =&gt; &quot;&quot;, :code_footer =&gt; &quot;&quot;, :scoped_metric_only =&gt; false}.freeze</td>
        </tr>
        
        
    </table>
    

    

    
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M000357">
                    
                    <a name="M000357"></a><b>any_unrecognized_keys?</b>(expected, given)
                    
                </div>
                
                <div class="description">
                  <p>
used to verify that the keys passed to <a
href="../ClassMethods.html#M000383">NewRelic::Agent::MethodTracer::ClassMethods#add_method_tracer</a>
are valid. checks the expected list against the list actually provided
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000357_source')" id="l_M000357_source">show</a>
                        
                    </p>
                    <div id="M000357_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/new_relic/agent/method_tracer.rb, line 270</span>
270:           <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">any_unrecognized_keys?</span>(<span class="ruby-identifier">expected</span>, <span class="ruby-identifier">given</span>)
271:             <span class="ruby-identifier">unrecognized_keys</span>(<span class="ruby-identifier">expected</span>, <span class="ruby-identifier">given</span>).<span class="ruby-identifier">any?</span>
272:           <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000371">
                    
                    <a name="M000371"></a><b>assemble_code_header</b>(method_name, metric_name_code, options)
                    
                </div>
                
                <div class="description">
                  <p>
Returns a code snippet to be eval&#8217;d that skips tracing when the agent
is not tracing execution. turns instrumentation into effectively one method
call overhead when the agent is disabled
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000371_source')" id="l_M000371_source">show</a>
                        
                    </p>
                    <div id="M000371_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/new_relic/agent/method_tracer.rb, line 348</span>
348:           <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">assemble_code_header</span>(<span class="ruby-identifier">method_name</span>, <span class="ruby-identifier">metric_name_code</span>, <span class="ruby-identifier">options</span>)
349:             <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:force</span>]
350:               <span class="ruby-node">&quot;return #{_untraced_method_name(method_name, metric_name_code)}(*args, &amp;block) unless NewRelic::Agent.is_execution_traced?\n&quot;</span>
351:             <span class="ruby-keyword kw">end</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:code_header</span>].<span class="ruby-identifier">to_s</span>
352:           <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000358">
                    
                    <a name="M000358"></a><b>check_for_illegal_keys!</b>(options)
                    
                </div>
                
                <div class="description">
                  <p>
raises an error when the <a
href="../ClassMethods.html#M000383">NewRelic::Agent::MethodTracer::ClassMethods#add_method_tracer</a>
method is called with improper keys. This aids in debugging new
instrumentation by failing fast
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000358_source')" id="l_M000358_source">show</a>
                        
                    </p>
                    <div id="M000358_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/new_relic/agent/method_tracer.rb, line 278</span>
278:           <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">check_for_illegal_keys!</span>(<span class="ruby-identifier">options</span>)
279:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">any_unrecognized_keys?</span>(<span class="ruby-constant">ALLOWED_KEYS</span>, <span class="ruby-identifier">options</span>)
280:               <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Unrecognized options in add_method_tracer_call: #{unrecognized_keys(ALLOWED_KEYS, options).join(', ')}&quot;</span>
281:             <span class="ruby-keyword kw">end</span>
282:           <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000360">
                    
                    <a name="M000360"></a><b>check_for_push_scope_and_metric</b>(options)
                    
                </div>
                
                <div class="description">
                  <p>
validity checking - add_method_tracer must receive either push scope or
metric, or else it would record no data. Raises an error if this is the
case
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000360_source')" id="l_M000360_source">show</a>
                        
                    </p>
                    <div id="M000360_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/new_relic/agent/method_tracer.rb, line 297</span>
297:           <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">check_for_push_scope_and_metric</span>(<span class="ruby-identifier">options</span>)
298:             <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:push_scope</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:metric</span>]
299:               <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;Can't add a tracer where push_scope is false and metric is false&quot;</span>
300:             <span class="ruby-keyword kw">end</span>
301:           <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000378">
                    
                    <a name="M000378"></a><b>code_to_eval</b>(method_name, metric_name_code, options)
                    
                </div>
                
                <div class="description">
                  <p>
Decides which code snippet we should be eval&#8217;ing in this context,
based on the options.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000378_source')" id="l_M000378_source">show</a>
                        
                    </p>
                    <div id="M000378_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/new_relic/agent/method_tracer.rb, line 395</span>
395:           <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">code_to_eval</span>(<span class="ruby-identifier">method_name</span>, <span class="ruby-identifier">metric_name_code</span>, <span class="ruby-identifier">options</span>)
396:             <span class="ruby-identifier">options</span> = <span class="ruby-identifier">validate_options</span>(<span class="ruby-identifier">options</span>)
397:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:push_scope</span>]
398:               <span class="ruby-identifier">method_with_push_scope</span>(<span class="ruby-identifier">method_name</span>, <span class="ruby-identifier">metric_name_code</span>, <span class="ruby-identifier">options</span>)
399:             <span class="ruby-keyword kw">else</span>
400:               <span class="ruby-identifier">method_without_push_scope</span>(<span class="ruby-identifier">method_name</span>, <span class="ruby-identifier">metric_name_code</span>, <span class="ruby-identifier">options</span>)
401:             <span class="ruby-keyword kw">end</span>
402:           <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000363">
                    
                    <a name="M000363"></a><b>default_metric_name_code</b>(method_name)
                    
                </div>
                
                <div class="description">
                  <p>
Default to the class where the method is defined.
</p>
<p>
Example:
</p>
<pre>
 Foo.default_metric_name_code('bar') #=&gt; &quot;Custom/#{Foo.name}/bar&quot;
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000363_source')" id="l_M000363_source">show</a>
                        
                    </p>
                    <div id="M000363_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/new_relic/agent/method_tracer.rb, line 321</span>
321:           <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">default_metric_name_code</span>(<span class="ruby-identifier">method_name</span>)
322:             <span class="ruby-node">&quot;Custom/#{self.name}/#{method_name.to_s}&quot;</span>
323:           <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000375">
                    
                    <a name="M000375"></a><b>method_with_push_scope</b>(method_name, metric_name_code, options)
                    
                </div>
                
                <div class="description">
                  <p>
returns an eval-able string that contains the tracing code for a fully
traced metric including scoping
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000375_source')" id="l_M000375_source">show</a>
                        
                    </p>
                    <div id="M000375_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/new_relic/agent/method_tracer.rb, line 376</span>
376:           <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">method_with_push_scope</span>(<span class="ruby-identifier">method_name</span>, <span class="ruby-identifier">metric_name_code</span>, <span class="ruby-identifier">options</span>)
377:             <span class="ruby-identifier">klass</span> = (<span class="ruby-keyword kw">self</span> <span class="ruby-operator">===</span> <span class="ruby-constant">Module</span>) <span class="ruby-operator">?</span> <span class="ruby-value str">&quot;self&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-value str">&quot;self.class&quot;</span>
378: 
379:             <span class="ruby-node">&quot;def #{_traced_method_name(method_name, metric_name_code)}(*args, &amp;block)
380:               #{options[:code_header]}
381:               result = #{klass}.trace_execution_scoped(\&quot;#{metric_name_code}\&quot;,
382:                         :metric =&gt; #{options[:metric]},
383:                         :forced =&gt; #{options[:force]},
384:                         :deduct_call_time_from_parent =&gt; #{options[:deduct_call_time_from_parent]},
385:                         :scoped_metric_only =&gt; #{options[:scoped_metric_only]}) do
386:                 #{_untraced_method_name(method_name, metric_name_code)}(*args, &amp;block)
387:               end
388:               #{options[:code_footer]}
389:               result
390:             end&quot;</span>
391:           <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000374">
                    
                    <a name="M000374"></a><b>method_without_push_scope</b>(method_name, metric_name_code, options)
                    
                </div>
                
                <div class="description">
                  <p>
returns an eval-able string that contains the traced method code used if
the agent is not creating a scope for use in scoped metrics.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000374_source')" id="l_M000374_source">show</a>
                        
                    </p>
                    <div id="M000374_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/new_relic/agent/method_tracer.rb, line 357</span>
357:           <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">method_without_push_scope</span>(<span class="ruby-identifier">method_name</span>, <span class="ruby-identifier">metric_name_code</span>, <span class="ruby-identifier">options</span>)
358:             <span class="ruby-node">&quot;def #{_traced_method_name(method_name, metric_name_code)}(*args, &amp;block)
359:               #{assemble_code_header(method_name, metric_name_code, options)}
360:               t0 = Time.now
361:               stats = NewRelic::Agent.instance.stats_engine.get_stats_no_scope \&quot;#{metric_name_code}\&quot;
362:               begin
363:                 #{&quot;NewRelic::Agent.instance.push_trace_execution_flag(true)\n&quot; if options[:force]}
364:                 #{_untraced_method_name(method_name, metric_name_code)}(*args, &amp;block)\n
365:               ensure
366:                 #{&quot;NewRelic::Agent.instance.pop_trace_execution_flag\n&quot; if options[:force] }
367:                 duration = (Time.now - t0).to_f
368:                 stats.trace_call(duration)
369:                 #{options[:code_footer]}
370:               end
371:             end&quot;</span>
372:           <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000364">
                    
                    <a name="M000364"></a><b>newrelic_method_exists?</b>(method_name)
                    
                </div>
                
                <div class="description">
                  <p>
Checks to see if the method we are attempting to trace actually exists or
not. add_method_tracer can&#8217;t do anything if the method doesn&#8217;t
exist.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000364_source')" id="l_M000364_source">show</a>
                        
                    </p>
                    <div id="M000364_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/new_relic/agent/method_tracer.rb, line 328</span>
328:           <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">newrelic_method_exists?</span>(<span class="ruby-identifier">method_name</span>)
329:             <span class="ruby-identifier">exists</span> = <span class="ruby-identifier">method_defined?</span>(<span class="ruby-identifier">method_name</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">private_method_defined?</span>(<span class="ruby-identifier">method_name</span>)
330:             <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Control</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">log</span>.<span class="ruby-identifier">warn</span>(<span class="ruby-node">&quot;Did not trace #{self.name}##{method_name} because that method does not exist&quot;</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">exists</span>
331:             <span class="ruby-identifier">exists</span>
332:           <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000359">
                    
                    <a name="M000359"></a><b>set_deduct_call_time_based_on_metric</b>(options)
                    
                </div>
                
                <div class="description">
                  <p>
Sets the options for deducting call time from parents. This defaults to
true if we are recording a metric, but can be overridden by the user if
desired.
</p>
<p>
has the effect of not allowing overlapping times, and should generally be
true
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000359_source')" id="l_M000359_source">show</a>
                        
                    </p>
                    <div id="M000359_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/new_relic/agent/method_tracer.rb, line 290</span>
290:           <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set_deduct_call_time_based_on_metric</span>(<span class="ruby-identifier">options</span>)
291:             {<span class="ruby-identifier">:deduct_call_time_from_parent</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-operator">!</span><span class="ruby-operator">!</span><span class="ruby-identifier">options</span>[<span class="ruby-identifier">:metric</span>]}.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">options</span>)
292:           <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000365">
                    
                    <a name="M000365"></a><b>traced_method_exists?</b>(method_name, metric_name_code)
                    
                </div>
                
                <div class="description">
                  <p>
Checks to see if we have already traced a method with a given metric by
checking to see if the traced method exists. Warns the user if methods are
being double-traced to help with debugging custom instrumentation.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000365_source')" id="l_M000365_source">show</a>
                        
                    </p>
                    <div id="M000365_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/new_relic/agent/method_tracer.rb, line 338</span>
338:           <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">traced_method_exists?</span>(<span class="ruby-identifier">method_name</span>, <span class="ruby-identifier">metric_name_code</span>)
339:             <span class="ruby-identifier">exists</span> = <span class="ruby-identifier">method_defined?</span>(<span class="ruby-identifier">_traced_method_name</span>(<span class="ruby-identifier">method_name</span>, <span class="ruby-identifier">metric_name_code</span>))
340:             <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Control</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">log</span>.<span class="ruby-identifier">warn</span>(<span class="ruby-node">&quot;Attempt to trace a method twice with the same metric: Method = #{method_name}, Metric Name = #{metric_name_code}&quot;</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">exists</span>
341:             <span class="ruby-identifier">exists</span>
342:           <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000356">
                    
                    <a name="M000356"></a><b>unrecognized_keys</b>(expected, given)
                    
                </div>
                
                <div class="description">
                  <p>
used to verify that the keys passed to <a
href="../ClassMethods.html#M000383">NewRelic::Agent::MethodTracer::ClassMethods#add_method_tracer</a>
are valid. Returns a list of keys that were unexpected
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000356_source')" id="l_M000356_source">show</a>
                        
                    </p>
                    <div id="M000356_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/new_relic/agent/method_tracer.rb, line 262</span>
262:           <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">unrecognized_keys</span>(<span class="ruby-identifier">expected</span>, <span class="ruby-identifier">given</span>)
263:             <span class="ruby-identifier">given</span>.<span class="ruby-identifier">keys</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">expected</span>
264:           <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000362">
                    
                    <a name="M000362"></a><b>validate_options</b>(options)
                    
                </div>
                
                <div class="description">
                  <p>
Checks the provided options to make sure that they make sense. Raises an
error if the options are incorrect to assist with debugging, so that errors
occur at class construction time rather than instrumentation run time
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000362_source')" id="l_M000362_source">show</a>
                        
                    </p>
                    <div id="M000362_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/new_relic/agent/method_tracer.rb, line 309</span>
309:           <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">validate_options</span>(<span class="ruby-identifier">options</span>)
310:             <span class="ruby-identifier">raise</span> <span class="ruby-constant">TypeError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;provided options must be a Hash&quot;</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">options</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Hash</span>)
311:             <span class="ruby-identifier">check_for_illegal_keys!</span>(<span class="ruby-identifier">options</span>)
312:             <span class="ruby-identifier">options</span> = <span class="ruby-identifier">set_deduct_call_time_based_on_metric</span>(<span class="ruby-constant">DEFAULT_SETTINGS</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">options</span>))
313:             <span class="ruby-identifier">check_for_push_scope_and_metric</span>(<span class="ruby-identifier">options</span>)
314:             <span class="ruby-identifier">options</span>
315:           <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    