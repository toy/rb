<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>Object</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen" />
    <script src="../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Class</span> 
            Object 
            
                <span class="parent">&lt; 
                    
                    <a href="Object.html">Object</a>
                    
                </span>
            
        </h1>
        <ul class="files">
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>B</dt>
        <dd>
            <ul>
                
                <li><a href="#M000434">build_nested_query</a>,</li>
                
                <li><a href="#M000433">build_query</a>,</li>
                
                <li><a href="#M000442">byte_ranges</a>,</li>
                
                <li><a href="#M000440">bytesize</a>,</li>
                
                <li><a href="#M000439">bytesize</a></li>
                
            </ul>
        </dd>
    
        <dt>D</dt>
        <dd>
            <ul>
                
                <li><a href="#M000438">delete_cookie_header!</a></li>
                
            </ul>
        </dd>
    
        <dt>E</dt>
        <dd>
            <ul>
                
                <li><a href="#M000435">escape_html</a></li>
                
            </ul>
        </dd>
    
        <dt>N</dt>
        <dd>
            <ul>
                
                <li><a href="#M000432">normalize_params</a></li>
                
            </ul>
        </dd>
    
        <dt>R</dt>
        <dd>
            <ul>
                
                <li><a href="#M000441">rfc2822</a></li>
                
            </ul>
        </dd>
    
        <dt>S</dt>
        <dd>
            <ul>
                
                <li><a href="#M000436">select_best_encoding</a>,</li>
                
                <li><a href="#M000437">set_cookie_header!</a>,</li>
                
                <li><a href="#M000461">status_code</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    

    

    

    

    

    
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M000434">
                    
                    <a name="M000434"></a><b>build_nested_query</b>(value, prefix = nil)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000434_source')" id="l_M000434_source">show</a>
                        
                    </p>
                    <div id="M000434_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rack/utils.rb, line 160</span>
160:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">build_nested_query</span>(<span class="ruby-identifier">value</span>, <span class="ruby-identifier">prefix</span> = <span class="ruby-keyword kw">nil</span>)
161:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">value</span>
162:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Array</span>
163:         <span class="ruby-identifier">value</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
164:           <span class="ruby-identifier">build_nested_query</span>(<span class="ruby-identifier">v</span>, <span class="ruby-node">&quot;#{prefix}[]&quot;</span>)
165:         }.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;&amp;&quot;</span>)
166:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Hash</span>
167:         <span class="ruby-identifier">value</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
168:           <span class="ruby-identifier">build_nested_query</span>(<span class="ruby-identifier">v</span>, <span class="ruby-identifier">prefix</span> <span class="ruby-value">? </span><span class="ruby-node">&quot;#{prefix}[#{escape(k)}]&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">escape</span>(<span class="ruby-identifier">k</span>))
169:         }.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;&amp;&quot;</span>)
170:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">String</span>
171:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-value str">&quot;value must be a Hash&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">prefix</span>.<span class="ruby-identifier">nil?</span>
172:         <span class="ruby-node">&quot;#{prefix}=#{escape(value)}&quot;</span>
173:       <span class="ruby-keyword kw">else</span>
174:         <span class="ruby-identifier">prefix</span>
175:       <span class="ruby-keyword kw">end</span>
176:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000433">
                    
                    <a name="M000433"></a><b>build_query</b>(params)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000433_source')" id="l_M000433_source">show</a>
                        
                    </p>
                    <div id="M000433_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rack/utils.rb, line 149</span>
149:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">build_query</span>(<span class="ruby-identifier">params</span>)
150:       <span class="ruby-identifier">params</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
151:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">class</span> <span class="ruby-operator">==</span> <span class="ruby-constant">Array</span>
152:           <span class="ruby-identifier">build_query</span>(<span class="ruby-identifier">v</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> [<span class="ruby-identifier">k</span>, <span class="ruby-identifier">x</span>] })
153:         <span class="ruby-keyword kw">else</span>
154:           <span class="ruby-identifier">v</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-value">? </span><span class="ruby-identifier">escape</span>(<span class="ruby-identifier">k</span>) <span class="ruby-operator">:</span> <span class="ruby-node">&quot;#{escape(k)}=#{escape(v)}&quot;</span>
155:         <span class="ruby-keyword kw">end</span>
156:       }.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;&amp;&quot;</span>)
157:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000442">
                    
                    <a name="M000442"></a><b>byte_ranges</b>(env, size)
                    
                </div>
                
                <div class="description">
                  <p>
Parses the &#8220;Range:&#8221; header, if present, into an array of Range
objects. Returns nil if the header is missing or syntactically invalid.
Returns an empty array if none of the ranges are satisfiable.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000442_source')" id="l_M000442_source">show</a>
                        
                    </p>
                    <div id="M000442_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rack/utils.rb, line 324</span>
324:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">byte_ranges</span>(<span class="ruby-identifier">env</span>, <span class="ruby-identifier">size</span>)
325:       <span class="ruby-comment cmt"># See &lt;http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.35&gt;</span>
326:       <span class="ruby-identifier">http_range</span> = <span class="ruby-identifier">env</span>[<span class="ruby-value str">'HTTP_RANGE'</span>]
327:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">http_range</span>
328:       <span class="ruby-identifier">ranges</span> = []
329:       <span class="ruby-identifier">http_range</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp re">/,\s*/</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">range_spec</span><span class="ruby-operator">|</span>
330:         <span class="ruby-identifier">matches</span> = <span class="ruby-identifier">range_spec</span>.<span class="ruby-identifier">match</span>(<span class="ruby-regexp re">/bytes=(\d*)-(\d*)/</span>)
331:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span>  <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">matches</span>
332:         <span class="ruby-identifier">r0</span>,<span class="ruby-identifier">r1</span> = <span class="ruby-identifier">matches</span>[<span class="ruby-value">1</span>], <span class="ruby-identifier">matches</span>[<span class="ruby-value">2</span>]
333:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">r0</span>.<span class="ruby-identifier">empty?</span>
334:           <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span>  <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">r1</span>.<span class="ruby-identifier">empty?</span>
335:           <span class="ruby-comment cmt"># suffix-byte-range-spec, represents trailing suffix of file</span>
336:           <span class="ruby-identifier">r0</span> = [<span class="ruby-identifier">size</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">r1</span>.<span class="ruby-identifier">to_i</span>, <span class="ruby-value">0</span>].<span class="ruby-identifier">max</span>
337:           <span class="ruby-identifier">r1</span> = <span class="ruby-identifier">size</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>
338:         <span class="ruby-keyword kw">else</span>
339:           <span class="ruby-identifier">r0</span> = <span class="ruby-identifier">r0</span>.<span class="ruby-identifier">to_i</span>
340:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">r1</span>.<span class="ruby-identifier">empty?</span>
341:             <span class="ruby-identifier">r1</span> = <span class="ruby-identifier">size</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>
342:           <span class="ruby-keyword kw">else</span>
343:             <span class="ruby-identifier">r1</span> = <span class="ruby-identifier">r1</span>.<span class="ruby-identifier">to_i</span>
344:             <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span>  <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">r1</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">r0</span>  <span class="ruby-comment cmt"># backwards range is syntactically invalid</span>
345:             <span class="ruby-identifier">r1</span> = <span class="ruby-identifier">size</span><span class="ruby-operator">-</span><span class="ruby-value">1</span>  <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">r1</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">size</span>
346:           <span class="ruby-keyword kw">end</span>
347:         <span class="ruby-keyword kw">end</span>
348:         <span class="ruby-identifier">ranges</span> <span class="ruby-operator">&lt;&lt;</span> (<span class="ruby-identifier">r0</span><span class="ruby-operator">..</span><span class="ruby-identifier">r1</span>)  <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">r0</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">r1</span>
349:       <span class="ruby-keyword kw">end</span>
350:       <span class="ruby-identifier">ranges</span>
351:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000440">
                    
                    <a name="M000440"></a><b>bytesize</b>(string)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000440_source')" id="l_M000440_source">show</a>
                        
                    </p>
                    <div id="M000440_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rack/utils.rb, line 299</span>
299:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">bytesize</span>(<span class="ruby-identifier">string</span>)
300:         <span class="ruby-identifier">string</span>.<span class="ruby-identifier">size</span>
301:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000439">
                    
                    <a name="M000439"></a><b>bytesize</b>(string)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000439_source')" id="l_M000439_source">show</a>
                        
                    </p>
                    <div id="M000439_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rack/utils.rb, line 295</span>
295:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">bytesize</span>(<span class="ruby-identifier">string</span>)
296:         <span class="ruby-identifier">string</span>.<span class="ruby-identifier">bytesize</span>
297:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000438">
                    
                    <a name="M000438"></a><b>delete_cookie_header!</b>(header, key, value = {})
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000438_source')" id="l_M000438_source">show</a>
                        
                    </p>
                    <div id="M000438_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rack/utils.rb, line 262</span>
262:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">delete_cookie_header!</span>(<span class="ruby-identifier">header</span>, <span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span> = {})
263:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">header</span>[<span class="ruby-value str">&quot;Set-Cookie&quot;</span>]
264:       <span class="ruby-keyword kw">when</span> <span class="ruby-keyword kw">nil</span>, <span class="ruby-value str">''</span>
265:         <span class="ruby-identifier">cookies</span> = []
266:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">String</span>
267:         <span class="ruby-identifier">cookies</span> = <span class="ruby-identifier">header</span>[<span class="ruby-value str">&quot;Set-Cookie&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;\n&quot;</span>)
268:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Array</span>
269:         <span class="ruby-identifier">cookies</span> = <span class="ruby-identifier">header</span>[<span class="ruby-value str">&quot;Set-Cookie&quot;</span>]
270:       <span class="ruby-keyword kw">end</span>
271: 
272:       <span class="ruby-identifier">cookies</span>.<span class="ruby-identifier">reject!</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">cookie</span><span class="ruby-operator">|</span>
273:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">value</span>[<span class="ruby-identifier">:domain</span>]
274:           <span class="ruby-identifier">cookie</span> <span class="ruby-operator">=~</span> <span class="ruby-node">/\A#{escape(key)}=.*domain=#{value[:domain]}/</span>
275:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">value</span>[<span class="ruby-identifier">:path</span>]
276:           <span class="ruby-identifier">cookie</span> <span class="ruby-operator">=~</span> <span class="ruby-node">/\A#{escape(key)}=.*path=#{value[:path]}/</span>
277:         <span class="ruby-keyword kw">else</span>
278:           <span class="ruby-identifier">cookie</span> <span class="ruby-operator">=~</span> <span class="ruby-node">/\A#{escape(key)}=/</span>
279:         <span class="ruby-keyword kw">end</span>
280:       }
281: 
282:       <span class="ruby-identifier">header</span>[<span class="ruby-value str">&quot;Set-Cookie&quot;</span>] = <span class="ruby-identifier">cookies</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;\n&quot;</span>)
283: 
284:       <span class="ruby-identifier">set_cookie_header!</span>(<span class="ruby-identifier">header</span>, <span class="ruby-identifier">key</span>,
285:                  {<span class="ruby-identifier">:value</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">''</span>, <span class="ruby-identifier">:path</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">:domain</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">nil</span>,
286:                    <span class="ruby-identifier">:expires</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">at</span>(<span class="ruby-value">0</span>) }.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">value</span>))
287: 
288:       <span class="ruby-keyword kw">nil</span>
289:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000435">
                    
                    <a name="M000435"></a><b>escape_html</b>(string)
                    
                </div>
                
                <div class="description">
                  <p>
Escape ampersands, brackets and quotes to their HTML/XML entities.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000435_source')" id="l_M000435_source">show</a>
                        
                    </p>
                    <div id="M000435_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rack/utils.rb, line 196</span>
196:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">escape_html</span>(<span class="ruby-identifier">string</span>)
197:       <span class="ruby-identifier">string</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-constant">ESCAPE_HTML_PATTERN</span>){<span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-constant">ESCAPE_HTML</span>[<span class="ruby-identifier">c</span>] }
198:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000432">
                    
                    <a name="M000432"></a><b>normalize_params</b>(params, name, v = nil)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000432_source')" id="l_M000432_source">show</a>
                        
                    </p>
                    <div id="M000432_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rack/utils.rb, line 117</span>
117:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">normalize_params</span>(<span class="ruby-identifier">params</span>, <span class="ruby-identifier">name</span>, <span class="ruby-identifier">v</span> = <span class="ruby-keyword kw">nil</span>)
118:       <span class="ruby-identifier">name</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">%r(\A[\[\]]*([^\[\]]+)\]*)</span>
119:       <span class="ruby-identifier">k</span> = <span class="ruby-identifier">$1</span> <span class="ruby-operator">||</span> <span class="ruby-value str">''</span>
120:       <span class="ruby-identifier">after</span> = <span class="ruby-identifier">$'</span> <span class="ruby-operator">||</span> <span class="ruby-value str">''</span>
121: 
122:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">k</span>.<span class="ruby-identifier">empty?</span>
123: 
124:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">after</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;&quot;</span>
125:         <span class="ruby-identifier">params</span>[<span class="ruby-identifier">k</span>] = <span class="ruby-identifier">v</span>
126:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">after</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;[]&quot;</span>
127:         <span class="ruby-identifier">params</span>[<span class="ruby-identifier">k</span>] <span class="ruby-operator">||=</span> []
128:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">TypeError</span>, <span class="ruby-node">&quot;expected Array (got #{params[k].class.name}) for param `#{k}'&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">k</span>].<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>)
129:         <span class="ruby-identifier">params</span>[<span class="ruby-identifier">k</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">v</span>
130:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">after</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">%r(^\[\]\[([^\[\]]+)\]$)</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">after</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">%r(^\[\](.+)$)</span>
131:         <span class="ruby-identifier">child_key</span> = <span class="ruby-identifier">$1</span>
132:         <span class="ruby-identifier">params</span>[<span class="ruby-identifier">k</span>] <span class="ruby-operator">||=</span> []
133:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">TypeError</span>, <span class="ruby-node">&quot;expected Array (got #{params[k].class.name}) for param `#{k}'&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">k</span>].<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>)
134:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">k</span>].<span class="ruby-identifier">last</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Hash</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">k</span>].<span class="ruby-identifier">last</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-identifier">child_key</span>)
135:           <span class="ruby-identifier">normalize_params</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">k</span>].<span class="ruby-identifier">last</span>, <span class="ruby-identifier">child_key</span>, <span class="ruby-identifier">v</span>)
136:         <span class="ruby-keyword kw">else</span>
137:           <span class="ruby-identifier">params</span>[<span class="ruby-identifier">k</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">normalize_params</span>({}, <span class="ruby-identifier">child_key</span>, <span class="ruby-identifier">v</span>)
138:         <span class="ruby-keyword kw">end</span>
139:       <span class="ruby-keyword kw">else</span>
140:         <span class="ruby-identifier">params</span>[<span class="ruby-identifier">k</span>] <span class="ruby-operator">||=</span> {}
141:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">TypeError</span>, <span class="ruby-node">&quot;expected Hash (got #{params[k].class.name}) for param `#{k}'&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">k</span>].<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Hash</span>)
142:         <span class="ruby-identifier">params</span>[<span class="ruby-identifier">k</span>] = <span class="ruby-identifier">normalize_params</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">k</span>], <span class="ruby-identifier">after</span>, <span class="ruby-identifier">v</span>)
143:       <span class="ruby-keyword kw">end</span>
144: 
145:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">params</span>
146:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000441">
                    
                    <a name="M000441"></a><b>rfc2822</b>(time)
                    
                </div>
                
                <div class="description">
                  <p>
Modified version of stdlib time.rb Time#rfc2822 to use
&#8217;%d-%b-%Y&#8217; instead of &#8217;% %b %Y&#8217;. It assumes that
the time is in GMT to comply to the RFC 2109.
</p>
<p>
NOTE: I&#8217;m not sure the RFC says it requires GMT, but is ambigous
enough that I&#8217;m certain someone implemented only that option. Do not
use %a and %b from Time.strptime, it would use localized names for weekday
and month.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000441_source')" id="l_M000441_source">show</a>
                        
                    </p>
                    <div id="M000441_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rack/utils.rb, line 314</span>
314:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">rfc2822</span>(<span class="ruby-identifier">time</span>)
315:       <span class="ruby-identifier">wday</span> = <span class="ruby-constant">Time</span><span class="ruby-operator">::</span><span class="ruby-constant">RFC2822_DAY_NAME</span>[<span class="ruby-identifier">time</span>.<span class="ruby-identifier">wday</span>]
316:       <span class="ruby-identifier">mon</span> = <span class="ruby-constant">Time</span><span class="ruby-operator">::</span><span class="ruby-constant">RFC2822_MONTH_NAME</span>[<span class="ruby-identifier">time</span>.<span class="ruby-identifier">mon</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>]
317:       <span class="ruby-identifier">time</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-node">&quot;#{wday}, %d-#{mon}-%Y %H:%M:%S GMT&quot;</span>)
318:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000436">
                    
                    <a name="M000436"></a><b>select_best_encoding</b>(available_encodings, accept_encoding)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000436_source')" id="l_M000436_source">show</a>
                        
                    </p>
                    <div id="M000436_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rack/utils.rb, line 201</span>
201:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">select_best_encoding</span>(<span class="ruby-identifier">available_encodings</span>, <span class="ruby-identifier">accept_encoding</span>)
202:       <span class="ruby-comment cmt"># http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html</span>
203: 
204:       <span class="ruby-identifier">expanded_accept_encoding</span> =
205:         <span class="ruby-identifier">accept_encoding</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">m</span>, <span class="ruby-identifier">q</span><span class="ruby-operator">|</span>
206:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">m</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;*&quot;</span>
207:             (<span class="ruby-identifier">available_encodings</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">accept_encoding</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">m2</span>, <span class="ruby-identifier">_</span><span class="ruby-operator">|</span> <span class="ruby-identifier">m2</span> }).<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">m2</span><span class="ruby-operator">|</span> [<span class="ruby-identifier">m2</span>, <span class="ruby-identifier">q</span>] }
208:           <span class="ruby-keyword kw">else</span>
209:             [[<span class="ruby-identifier">m</span>, <span class="ruby-identifier">q</span>]]
210:           <span class="ruby-keyword kw">end</span>
211:         }.<span class="ruby-identifier">inject</span>([]) { <span class="ruby-operator">|</span><span class="ruby-identifier">mem</span>, <span class="ruby-identifier">list</span><span class="ruby-operator">|</span>
212:           <span class="ruby-identifier">mem</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">list</span>
213:         }
214: 
215:       <span class="ruby-identifier">encoding_candidates</span> = <span class="ruby-identifier">expanded_accept_encoding</span>.<span class="ruby-identifier">sort_by</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">_</span>, <span class="ruby-identifier">q</span><span class="ruby-operator">|</span> <span class="ruby-operator">-</span><span class="ruby-identifier">q</span> }.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">m</span>, <span class="ruby-identifier">_</span><span class="ruby-operator">|</span> <span class="ruby-identifier">m</span> }
216: 
217:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">encoding_candidates</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-value str">&quot;identity&quot;</span>)
218:         <span class="ruby-identifier">encoding_candidates</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value str">&quot;identity&quot;</span>)
219:       <span class="ruby-keyword kw">end</span>
220: 
221:       <span class="ruby-identifier">expanded_accept_encoding</span>.<span class="ruby-identifier">find_all</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">m</span>, <span class="ruby-identifier">q</span><span class="ruby-operator">|</span>
222:         <span class="ruby-identifier">q</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span><span class="ruby-value">.0</span>
223:       }.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">m</span>, <span class="ruby-identifier">_</span><span class="ruby-operator">|</span>
224:         <span class="ruby-identifier">encoding_candidates</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">m</span>)
225:       }
226: 
227:       <span class="ruby-keyword kw">return</span> (<span class="ruby-identifier">encoding_candidates</span> <span class="ruby-operator">&amp;</span> <span class="ruby-identifier">available_encodings</span>)[<span class="ruby-value">0</span>]
228:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000437">
                    
                    <a name="M000437"></a><b>set_cookie_header!</b>(header, key, value)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000437_source')" id="l_M000437_source">show</a>
                        
                    </p>
                    <div id="M000437_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rack/utils.rb, line 231</span>
231:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set_cookie_header!</span>(<span class="ruby-identifier">header</span>, <span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span>)
232:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">value</span>
233:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Hash</span>
234:         <span class="ruby-identifier">domain</span>  = <span class="ruby-value str">&quot;; domain=&quot;</span>  <span class="ruby-operator">+</span> <span class="ruby-identifier">value</span>[<span class="ruby-identifier">:domain</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">value</span>[<span class="ruby-identifier">:domain</span>]
235:         <span class="ruby-identifier">path</span>    = <span class="ruby-value str">&quot;; path=&quot;</span>    <span class="ruby-operator">+</span> <span class="ruby-identifier">value</span>[<span class="ruby-identifier">:path</span>]   <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">value</span>[<span class="ruby-identifier">:path</span>]
236:         <span class="ruby-comment cmt"># According to RFC 2109, we need dashes here.</span>
237:         <span class="ruby-comment cmt"># N.B.: cgi.rb uses spaces...</span>
238:         <span class="ruby-identifier">expires</span> = <span class="ruby-value str">&quot;; expires=&quot;</span> <span class="ruby-operator">+</span>
239:           <span class="ruby-identifier">rfc2822</span>(<span class="ruby-identifier">value</span>[<span class="ruby-identifier">:expires</span>].<span class="ruby-identifier">clone</span>.<span class="ruby-identifier">gmtime</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">value</span>[<span class="ruby-identifier">:expires</span>]
240:         <span class="ruby-identifier">secure</span> = <span class="ruby-value str">&quot;; secure&quot;</span>  <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">value</span>[<span class="ruby-identifier">:secure</span>]
241:         <span class="ruby-identifier">httponly</span> = <span class="ruby-value str">&quot;; HttpOnly&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">value</span>[<span class="ruby-identifier">:httponly</span>]
242:         <span class="ruby-identifier">value</span> = <span class="ruby-identifier">value</span>[<span class="ruby-identifier">:value</span>]
243:       <span class="ruby-keyword kw">end</span>
244:       <span class="ruby-identifier">value</span> = [<span class="ruby-identifier">value</span>] <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">Array</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">value</span>
245:       <span class="ruby-identifier">cookie</span> = <span class="ruby-identifier">escape</span>(<span class="ruby-identifier">key</span>) <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;=&quot;</span> <span class="ruby-operator">+</span>
246:         <span class="ruby-identifier">value</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">escape</span> <span class="ruby-identifier">v</span> }.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;&amp;&quot;</span>) <span class="ruby-operator">+</span>
247:         <span class="ruby-node">&quot;#{domain}#{path}#{expires}#{secure}#{httponly}&quot;</span>
248: 
249:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">header</span>[<span class="ruby-value str">&quot;Set-Cookie&quot;</span>]
250:       <span class="ruby-keyword kw">when</span> <span class="ruby-keyword kw">nil</span>, <span class="ruby-value str">''</span>
251:         <span class="ruby-identifier">header</span>[<span class="ruby-value str">&quot;Set-Cookie&quot;</span>] = <span class="ruby-identifier">cookie</span>
252:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">String</span>
253:         <span class="ruby-identifier">header</span>[<span class="ruby-value str">&quot;Set-Cookie&quot;</span>] = [<span class="ruby-identifier">header</span>[<span class="ruby-value str">&quot;Set-Cookie&quot;</span>], <span class="ruby-identifier">cookie</span>].<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;\n&quot;</span>)
254:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Array</span>
255:         <span class="ruby-identifier">header</span>[<span class="ruby-value str">&quot;Set-Cookie&quot;</span>] = (<span class="ruby-identifier">header</span>[<span class="ruby-value str">&quot;Set-Cookie&quot;</span>] <span class="ruby-operator">+</span> [<span class="ruby-identifier">cookie</span>]).<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;\n&quot;</span>)
256:       <span class="ruby-keyword kw">end</span>
257: 
258:       <span class="ruby-keyword kw">nil</span>
259:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000461">
                    
                    <a name="M000461"></a><b>status_code</b>(status)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000461_source')" id="l_M000461_source">show</a>
                        
                    </p>
                    <div id="M000461_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rack/utils.rb, line 515</span>
515:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">status_code</span>(<span class="ruby-identifier">status</span>)
516:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">status</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Symbol</span>)
517:         <span class="ruby-constant">SYMBOL_TO_STATUS_CODE</span>[<span class="ruby-identifier">status</span>] <span class="ruby-operator">||</span> <span class="ruby-value">500</span>
518:       <span class="ruby-keyword kw">else</span>
519:         <span class="ruby-identifier">status</span>.<span class="ruby-identifier">to_i</span>
520:       <span class="ruby-keyword kw">end</span>
521:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    