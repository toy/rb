<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>Rack::Session::Abstract::ID</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../../../css/main.css" type="text/css" media="screen" />
    <script src="../../../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Class</span> 
            Rack::Session::Abstract::ID 
            
                <span class="parent">&lt; 
                    
                    <a href="../../../Object.html">Object</a>
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../../../files/lib/rack/session/abstract/id_rb.html">lib/rack/session/abstract/id.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    
    <div class="description">
        <p>
<a href="ID.html">ID</a> sets up a basic framework for implementing an id
based sessioning service. Cookies sent to the client for maintaining
sessions will only contain an id reference. Only <a
href="ID.html#M000388">get_session</a> and <a
href="ID.html#M000389">set_session</a> are required to be overwritten.
</p>
<p>
All parameters are optional.
</p>
<ul>
<li>:key determines the name of the cookie, by default it is
&#8216;rack.session&#8216;

</li>
<li>:path, :domain, :expire_after, :secure, and :httponly set the related
cookie options as by Rack::Response#add_cookie

</li>
<li>:skip will not a set a cookie in the response nor update the session state

</li>
<li>:defer will not set a cookie in the response but still update the session
state if it is used with a backend

</li>
<li>:renew (implementation dependent) will prompt the generation of a new
session id, and migration of data to be referenced at the new id. If :defer
is set, it will be overridden and the cookie will be set.

</li>
<li>:sidbits sets the number of bits in length that a generated session id will
be.

</li>
</ul>
<p>
These options can be set on a per request basis, at the location of <a
href="http://'rack.session.options'">env</a>. Additionally the id of the
session can be found within the options hash at the key :id. It is highly
not recommended to change its value.
</p>
<p>
Is <a href="../../../Context.html">Rack::Utils::Context</a> compatible.
</p>
<p>
Not included by default; you must require
&#8216;rack/session/abstract/id&#8217; to use.
</p>

    </div>
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>C</dt>
        <dd>
            <ul>
                
                <li><a href="#M000359">call</a>,</li>
                
                <li><a href="#M000382">commit_session</a>,</li>
                
                <li><a href="#M000368">commit_session?</a>,</li>
                
                <li><a href="#M000360">context</a>,</li>
                
                <li><a href="#M000366">current_session_id</a></li>
                
            </ul>
        </dd>
    
        <dt>D</dt>
        <dd>
            <ul>
                
                <li><a href="#M000392">destroy_session</a></li>
                
            </ul>
        </dd>
    
        <dt>E</dt>
        <dd>
            <ul>
                
                <li><a href="#M000365">extract_session_id</a></li>
                
            </ul>
        </dd>
    
        <dt>F</dt>
        <dd>
            <ul>
                
                <li><a href="#M000375">force_options?</a>,</li>
                
                <li><a href="#M000374">forced_session_update?</a></li>
                
            </ul>
        </dd>
    
        <dt>G</dt>
        <dd>
            <ul>
                
                <li><a href="#M000362">generate_sid</a>,</li>
                
                <li><a href="#M000388">get_session</a></li>
                
            </ul>
        </dd>
    
        <dt>I</dt>
        <dd>
            <ul>
                
                <li><a href="#M000361">initialize_sid</a></li>
                
            </ul>
        </dd>
    
        <dt>L</dt>
        <dd>
            <ul>
                
                <li><a href="#M000364">load_session</a>,</li>
                
                <li><a href="#M000369">loaded_session?</a></li>
                
            </ul>
        </dd>
    
        <dt>N</dt>
        <dd>
            <ul>
                
                <li><a href="#M000358">new</a></li>
                
            </ul>
        </dd>
    
        <dt>P</dt>
        <dd>
            <ul>
                
                <li><a href="#M000363">prepare_session</a></li>
                
            </ul>
        </dd>
    
        <dt>S</dt>
        <dd>
            <ul>
                
                <li><a href="#M000376">security_matches?</a>,</li>
                
                <li><a href="#M000367">session_exists?</a>,</li>
                
                <li><a href="#M000386">set_cookie</a>,</li>
                
                <li><a href="#M000389">set_session</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    

    

    

    
    <div class="sectiontitle">Constants</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class="attr-name">DEFAULT_OPTIONS</td>
            <td>=</td>
            <td class="attr-value">{           :key =&gt;           'rack.session',           :path =&gt;          '/',           :domain =&gt;        nil,           :expire_after =&gt;  nil,           :secure =&gt;        false,           :httponly =&gt;      true,           :defer =&gt;         false,           :renew =&gt;         false,           :sidbits =&gt;       128,           :cookie_only =&gt;   true,           :secure_random =&gt; begin ::SecureRandom rescue false end</td>
        </tr>
        
        
    </table>
    

    
    <div class="sectiontitle">Attributes</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>key</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>default_options</td>
            <td class='attr-desc'></td>
        </tr>
        
    </table>
    

    
            <div class="sectiontitle">Class Public methods</div>
            
            <div class="method">
                <div class="title" id="M000358">
                    
                    <a name="M000358"></a><b>new</b>(app, options={})
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000358_source')" id="l_M000358_source">show</a>
                        
                    </p>
                    <div id="M000358_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rack/session/abstract/id.rb, line 191</span>
191:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">app</span>, <span class="ruby-identifier">options</span>={})
192:           <span class="ruby-ivar">@app</span> = <span class="ruby-identifier">app</span>
193:           <span class="ruby-ivar">@default_options</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span><span class="ruby-operator">::</span><span class="ruby-constant">DEFAULT_OPTIONS</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">options</span>)
194:           <span class="ruby-ivar">@key</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:key</span>] <span class="ruby-operator">||</span> <span class="ruby-value str">&quot;rack.session&quot;</span>
195:           <span class="ruby-ivar">@cookie_only</span> = <span class="ruby-ivar">@default_options</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:cookie_only</span>)
196:           <span class="ruby-identifier">initialize_sid</span>
197:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M000359">
                    
                    <a name="M000359"></a><b>call</b>(env)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000359_source')" id="l_M000359_source">show</a>
                        
                    </p>
                    <div id="M000359_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rack/session/abstract/id.rb, line 199</span>
199:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">call</span>(<span class="ruby-identifier">env</span>)
200:           <span class="ruby-identifier">context</span>(<span class="ruby-identifier">env</span>)
201:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000360">
                    
                    <a name="M000360"></a><b>context</b>(env, app=@app)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000360_source')" id="l_M000360_source">show</a>
                        
                    </p>
                    <div id="M000360_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rack/session/abstract/id.rb, line 203</span>
203:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">context</span>(<span class="ruby-identifier">env</span>, <span class="ruby-identifier">app</span>=<span class="ruby-ivar">@app</span>)
204:           <span class="ruby-identifier">prepare_session</span>(<span class="ruby-identifier">env</span>)
205:           <span class="ruby-identifier">status</span>, <span class="ruby-identifier">headers</span>, <span class="ruby-identifier">body</span> = <span class="ruby-identifier">app</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">env</span>)
206:           <span class="ruby-identifier">commit_session</span>(<span class="ruby-identifier">env</span>, <span class="ruby-identifier">status</span>, <span class="ruby-identifier">headers</span>, <span class="ruby-identifier">body</span>)
207:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Private methods</div>
            
            <div class="method">
                <div class="title" id="M000382">
                    
                    <a name="M000382"></a><b>commit_session</b>(env, status, headers, body)
                    
                </div>
                
                <div class="description">
                  <p>
Acquires the session from the environment and the session id from the
session options and passes them to <a
href="ID.html#M000389">set_session</a>. If successful and the :defer option
is not true, a cookie will be added to the response with the
session&#8217;s id.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000382_source')" id="l_M000382_source">show</a>
                        
                    </p>
                    <div id="M000382_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rack/session/abstract/id.rb, line 307</span>
307:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">commit_session</span>(<span class="ruby-identifier">env</span>, <span class="ruby-identifier">status</span>, <span class="ruby-identifier">headers</span>, <span class="ruby-identifier">body</span>)
308:           <span class="ruby-identifier">session</span> = <span class="ruby-identifier">env</span>[<span class="ruby-value str">'rack.session'</span>]
309:           <span class="ruby-identifier">options</span> = <span class="ruby-identifier">env</span>[<span class="ruby-value str">'rack.session.options'</span>]
310: 
311:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:drop</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:renew</span>]
312:             <span class="ruby-identifier">session_id</span> = <span class="ruby-identifier">destroy_session</span>(<span class="ruby-identifier">env</span>, <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:id</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">generate_sid</span>, <span class="ruby-identifier">options</span>)
313:             <span class="ruby-keyword kw">return</span> [<span class="ruby-identifier">status</span>, <span class="ruby-identifier">headers</span>, <span class="ruby-identifier">body</span>] <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">session_id</span>
314:           <span class="ruby-keyword kw">end</span>
315: 
316:           <span class="ruby-keyword kw">return</span> [<span class="ruby-identifier">status</span>, <span class="ruby-identifier">headers</span>, <span class="ruby-identifier">body</span>] <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">commit_session?</span>(<span class="ruby-identifier">env</span>, <span class="ruby-identifier">session</span>, <span class="ruby-identifier">options</span>)
317: 
318:           <span class="ruby-identifier">session</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">:load!</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">loaded_session?</span>(<span class="ruby-identifier">session</span>)
319:           <span class="ruby-identifier">session</span> = <span class="ruby-identifier">session</span>.<span class="ruby-identifier">to_hash</span>
320:           <span class="ruby-identifier">session_id</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:id</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">generate_sid</span>
321: 
322:           <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">not</span> <span class="ruby-identifier">data</span> = <span class="ruby-identifier">set_session</span>(<span class="ruby-identifier">env</span>, <span class="ruby-identifier">session_id</span>, <span class="ruby-identifier">session</span>, <span class="ruby-identifier">options</span>)
323:             <span class="ruby-identifier">env</span>[<span class="ruby-value str">&quot;rack.errors&quot;</span>].<span class="ruby-identifier">puts</span>(<span class="ruby-node">&quot;Warning! #{self.class.name} failed to save session. Content dropped.&quot;</span>)
324:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:defer</span>] <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">not</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:renew</span>]
325:             <span class="ruby-identifier">env</span>[<span class="ruby-value str">&quot;rack.errors&quot;</span>].<span class="ruby-identifier">puts</span>(<span class="ruby-node">&quot;Defering cookie for #{session_id}&quot;</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">$VERBOSE</span>
326:           <span class="ruby-keyword kw">else</span>
327:             <span class="ruby-identifier">cookie</span> = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>
328:             <span class="ruby-identifier">cookie</span>[<span class="ruby-identifier">:value</span>] = <span class="ruby-identifier">data</span>
329:             <span class="ruby-identifier">cookie</span>[<span class="ruby-identifier">:expires</span>] = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:expire_after</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:expire_after</span>]
330:             <span class="ruby-identifier">set_cookie</span>(<span class="ruby-identifier">env</span>, <span class="ruby-identifier">headers</span>, <span class="ruby-identifier">cookie</span>.<span class="ruby-identifier">merge!</span>(<span class="ruby-identifier">options</span>))
331:           <span class="ruby-keyword kw">end</span>
332: 
333:           [<span class="ruby-identifier">status</span>, <span class="ruby-identifier">headers</span>, <span class="ruby-identifier">body</span>]
334:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000368">
                    
                    <a name="M000368"></a><b>commit_session?</b>(env, session, options)
                    
                </div>
                
                <div class="description">
                  <p>
<a href="../../Session.html">Session</a> should be commited if it was
loaded, any of specific options like :renew, :drop or :expire_after was
given and the security permissions match. Skips if skip is given.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000368_source')" id="l_M000368_source">show</a>
                        
                    </p>
                    <div id="M000368_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rack/session/abstract/id.rb, line 275</span>
275:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">commit_session?</span>(<span class="ruby-identifier">env</span>, <span class="ruby-identifier">session</span>, <span class="ruby-identifier">options</span>)
276:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:skip</span>]
277:             <span class="ruby-keyword kw">false</span>
278:           <span class="ruby-keyword kw">else</span>
279:             <span class="ruby-identifier">has_session</span> = <span class="ruby-identifier">loaded_session?</span>(<span class="ruby-identifier">session</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">forced_session_update?</span>(<span class="ruby-identifier">session</span>, <span class="ruby-identifier">options</span>)
280:             <span class="ruby-identifier">has_session</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">security_matches?</span>(<span class="ruby-identifier">env</span>, <span class="ruby-identifier">options</span>)
281:           <span class="ruby-keyword kw">end</span>
282:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000366">
                    
                    <a name="M000366"></a><b>current_session_id</b>(env)
                    
                </div>
                
                <div class="description">
                  <p>
Returns the current session id from the OptionsHash.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000366_source')" id="l_M000366_source">show</a>
                        
                    </p>
                    <div id="M000366_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rack/session/abstract/id.rb, line 261</span>
261:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">current_session_id</span>(<span class="ruby-identifier">env</span>)
262:           <span class="ruby-identifier">env</span>[<span class="ruby-constant">ENV_SESSION_OPTIONS_KEY</span>][<span class="ruby-identifier">:id</span>]
263:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000392">
                    
                    <a name="M000392"></a><b>destroy_session</b>(env, sid, options)
                    
                </div>
                
                <div class="description">
                  <p>
All thread safety and session destroy proceedures should occur here. Should
return a new session id or nil if options[:drop]
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000392_source')" id="l_M000392_source">show</a>
                        
                    </p>
                    <div id="M000392_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rack/session/abstract/id.rb, line 366</span>
366:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">destroy_session</span>(<span class="ruby-identifier">env</span>, <span class="ruby-identifier">sid</span>, <span class="ruby-identifier">options</span>)
367:           <span class="ruby-identifier">raise</span> <span class="ruby-value str">'#destroy_session not implemented'</span>
368:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000365">
                    
                    <a name="M000365"></a><b>extract_session_id</b>(env)
                    
                </div>
                
                <div class="description">
                  <p>
Extract session id from request object.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000365_source')" id="l_M000365_source">show</a>
                        
                    </p>
                    <div id="M000365_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rack/session/abstract/id.rb, line 252</span>
252:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">extract_session_id</span>(<span class="ruby-identifier">env</span>)
253:           <span class="ruby-identifier">request</span> = <span class="ruby-constant">Rack</span><span class="ruby-operator">::</span><span class="ruby-constant">Request</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">env</span>)
254:           <span class="ruby-identifier">sid</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">cookies</span>[<span class="ruby-ivar">@key</span>]
255:           <span class="ruby-identifier">sid</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">params</span>[<span class="ruby-ivar">@key</span>] <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@cookie_only</span>
256:           <span class="ruby-identifier">sid</span>
257:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000375">
                    
                    <a name="M000375"></a><b>force_options?</b>(options)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000375_source')" id="l_M000375_source">show</a>
                        
                    </p>
                    <div id="M000375_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rack/session/abstract/id.rb, line 292</span>
292:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">force_options?</span>(<span class="ruby-identifier">options</span>)
293:           <span class="ruby-identifier">options</span>.<span class="ruby-identifier">values_at</span>(<span class="ruby-identifier">:renew</span>, <span class="ruby-identifier">:drop</span>, <span class="ruby-identifier">:defer</span>, <span class="ruby-identifier">:expire_after</span>).<span class="ruby-identifier">any?</span>
294:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000374">
                    
                    <a name="M000374"></a><b>forced_session_update?</b>(session, options)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000374_source')" id="l_M000374_source">show</a>
                        
                    </p>
                    <div id="M000374_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rack/session/abstract/id.rb, line 288</span>
288:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">forced_session_update?</span>(<span class="ruby-identifier">session</span>, <span class="ruby-identifier">options</span>)
289:           <span class="ruby-identifier">force_options?</span>(<span class="ruby-identifier">options</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">session</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">session</span>.<span class="ruby-identifier">empty?</span>
290:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000362">
                    
                    <a name="M000362"></a><b>generate_sid</b>(secure = @sid_secure)
                    
                </div>
                
                <div class="description">
                  <p>
Generate a new session id using Ruby rand. The size of the session id is
controlled by the :sidbits option. Monkey patch this to use custom methods
for session id generation.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000362_source')" id="l_M000362_source">show</a>
                        
                    </p>
                    <div id="M000362_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rack/session/abstract/id.rb, line 221</span>
221:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">generate_sid</span>(<span class="ruby-identifier">secure</span> = <span class="ruby-ivar">@sid_secure</span>)
222:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">secure</span>
223:             <span class="ruby-constant">SecureRandom</span>.<span class="ruby-identifier">hex</span>(<span class="ruby-ivar">@sid_length</span>)
224:           <span class="ruby-keyword kw">else</span>
225:             <span class="ruby-node">&quot;%0#{@sid_length}x&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-constant">Kernel</span>.<span class="ruby-identifier">rand</span>(<span class="ruby-value">2</span><span class="ruby-operator">**</span><span class="ruby-ivar">@sidbits</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>)
226:           <span class="ruby-keyword kw">end</span>
227:         <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">NotImplementedError</span>
228:           <span class="ruby-identifier">generate_sid</span>(<span class="ruby-keyword kw">false</span>)
229:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000388">
                    
                    <a name="M000388"></a><b>get_session</b>(env, sid)
                    
                </div>
                
                <div class="description">
                  <p>
All thread safety and session retrival proceedures should occur here.
Should return [session_id, session]. If nil is provided as the session id,
generation of a new valid id should occur within.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000388_source')" id="l_M000388_source">show</a>
                        
                    </p>
                    <div id="M000388_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rack/session/abstract/id.rb, line 351</span>
351:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_session</span>(<span class="ruby-identifier">env</span>, <span class="ruby-identifier">sid</span>)
352:           <span class="ruby-identifier">raise</span> <span class="ruby-value str">'#get_session not implemented.'</span>
353:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000361">
                    
                    <a name="M000361"></a><b>initialize_sid</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000361_source')" id="l_M000361_source">show</a>
                        
                    </p>
                    <div id="M000361_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rack/session/abstract/id.rb, line 211</span>
211:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize_sid</span>
212:           <span class="ruby-ivar">@sidbits</span> = <span class="ruby-ivar">@default_options</span>[<span class="ruby-identifier">:sidbits</span>]
213:           <span class="ruby-ivar">@sid_secure</span> = <span class="ruby-ivar">@default_options</span>[<span class="ruby-identifier">:secure_random</span>]
214:           <span class="ruby-ivar">@sid_length</span> = <span class="ruby-ivar">@sidbits</span> <span class="ruby-operator">/</span> <span class="ruby-value">4</span>
215:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000364">
                    
                    <a name="M000364"></a><b>load_session</b>(env)
                    
                </div>
                
                <div class="description">
                  <p>
Extracts the session id from provided cookies and passes it and the
environment to <a href="ID.html#M000388">get_session</a>.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000364_source')" id="l_M000364_source">show</a>
                        
                    </p>
                    <div id="M000364_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rack/session/abstract/id.rb, line 244</span>
244:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">load_session</span>(<span class="ruby-identifier">env</span>)
245:           <span class="ruby-identifier">sid</span> = <span class="ruby-identifier">current_session_id</span>(<span class="ruby-identifier">env</span>)
246:           <span class="ruby-identifier">sid</span>, <span class="ruby-identifier">session</span> = <span class="ruby-identifier">get_session</span>(<span class="ruby-identifier">env</span>, <span class="ruby-identifier">sid</span>)
247:           [<span class="ruby-identifier">sid</span>, <span class="ruby-identifier">session</span> <span class="ruby-operator">||</span> {}]
248:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000369">
                    
                    <a name="M000369"></a><b>loaded_session?</b>(session)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000369_source')" id="l_M000369_source">show</a>
                        
                    </p>
                    <div id="M000369_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rack/session/abstract/id.rb, line 284</span>
284:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">loaded_session?</span>(<span class="ruby-identifier">session</span>)
285:           <span class="ruby-operator">!</span><span class="ruby-identifier">session</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">SessionHash</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">session</span>.<span class="ruby-identifier">loaded?</span>
286:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000363">
                    
                    <a name="M000363"></a><b>prepare_session</b>(env)
                    
                </div>
                
                <div class="description">
                  <p>
Sets the lazy session at &#8216;rack.session&#8217; and places options and
session metadata into &#8216;rack.session.options&#8217;.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000363_source')" id="l_M000363_source">show</a>
                        
                    </p>
                    <div id="M000363_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rack/session/abstract/id.rb, line 234</span>
234:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">prepare_session</span>(<span class="ruby-identifier">env</span>)
235:           <span class="ruby-identifier">session_was</span>                  = <span class="ruby-identifier">env</span>[<span class="ruby-constant">ENV_SESSION_KEY</span>]
236:           <span class="ruby-identifier">env</span>[<span class="ruby-constant">ENV_SESSION_KEY</span>]         = <span class="ruby-constant">SessionHash</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword kw">self</span>, <span class="ruby-identifier">env</span>)
237:           <span class="ruby-identifier">env</span>[<span class="ruby-constant">ENV_SESSION_OPTIONS_KEY</span>] = <span class="ruby-constant">OptionsHash</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword kw">self</span>, <span class="ruby-identifier">env</span>, <span class="ruby-ivar">@default_options</span>)
238:           <span class="ruby-identifier">env</span>[<span class="ruby-constant">ENV_SESSION_KEY</span>].<span class="ruby-identifier">merge!</span> <span class="ruby-identifier">session_was</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">session_was</span>
239:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000376">
                    
                    <a name="M000376"></a><b>security_matches?</b>(env, options)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000376_source')" id="l_M000376_source">show</a>
                        
                    </p>
                    <div id="M000376_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rack/session/abstract/id.rb, line 296</span>
296:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">security_matches?</span>(<span class="ruby-identifier">env</span>, <span class="ruby-identifier">options</span>)
297:           <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:secure</span>]
298:           <span class="ruby-identifier">request</span> = <span class="ruby-constant">Rack</span><span class="ruby-operator">::</span><span class="ruby-constant">Request</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">env</span>)
299:           <span class="ruby-identifier">request</span>.<span class="ruby-identifier">ssl?</span>
300:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000367">
                    
                    <a name="M000367"></a><b>session_exists?</b>(env)
                    
                </div>
                
                <div class="description">
                  <p>
Check if the session exists or not.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000367_source')" id="l_M000367_source">show</a>
                        
                    </p>
                    <div id="M000367_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rack/session/abstract/id.rb, line 267</span>
267:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">session_exists?</span>(<span class="ruby-identifier">env</span>)
268:           <span class="ruby-identifier">value</span> = <span class="ruby-identifier">current_session_id</span>(<span class="ruby-identifier">env</span>)
269:           <span class="ruby-identifier">value</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">value</span>.<span class="ruby-identifier">empty?</span>
270:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000386">
                    
                    <a name="M000386"></a><b>set_cookie</b>(env, headers, cookie)
                    
                </div>
                
                <div class="description">
                  <p>
Sets the cookie back to the client with session id. We skip the cookie
setting if the value didn&#8217;t change (sid is the same) or expires was
given.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000386_source')" id="l_M000386_source">show</a>
                        
                    </p>
                    <div id="M000386_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rack/session/abstract/id.rb, line 339</span>
339:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set_cookie</span>(<span class="ruby-identifier">env</span>, <span class="ruby-identifier">headers</span>, <span class="ruby-identifier">cookie</span>)
340:           <span class="ruby-identifier">request</span> = <span class="ruby-constant">Rack</span><span class="ruby-operator">::</span><span class="ruby-constant">Request</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">env</span>)
341:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">cookies</span>[<span class="ruby-ivar">@key</span>] <span class="ruby-operator">!=</span> <span class="ruby-identifier">cookie</span>[<span class="ruby-identifier">:value</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">cookie</span>[<span class="ruby-identifier">:expires</span>]
342:             <span class="ruby-constant">Utils</span>.<span class="ruby-identifier">set_cookie_header!</span>(<span class="ruby-identifier">headers</span>, <span class="ruby-ivar">@key</span>, <span class="ruby-identifier">cookie</span>)
343:           <span class="ruby-keyword kw">end</span>
344:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000389">
                    
                    <a name="M000389"></a><b>set_session</b>(env, sid, session, options)
                    
                </div>
                
                <div class="description">
                  <p>
All thread safety and session storage proceedures should occur here. Should
return true or false dependant on whether or not the session was saved or
not.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000389_source')" id="l_M000389_source">show</a>
                        
                    </p>
                    <div id="M000389_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rack/session/abstract/id.rb, line 359</span>
359:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set_session</span>(<span class="ruby-identifier">env</span>, <span class="ruby-identifier">sid</span>, <span class="ruby-identifier">session</span>, <span class="ruby-identifier">options</span>)
360:           <span class="ruby-identifier">raise</span> <span class="ruby-value str">'#set_session not implemented.'</span>
361:         <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    