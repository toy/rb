<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>OmniAuth::Strategies::WindowsLive::WindowsLiveLogin</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../../../css/main.css" type="text/css" media="screen" />
    <script src="../../../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Class</span> 
            OmniAuth::Strategies::WindowsLive::WindowsLiveLogin 
            
                <span class="parent">&lt; 
                    
                    Object
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../../../files/lib/omniauth/strategies/windows_live/windowslivelogin_rb.html">lib/omniauth/strategies/windows_live/windowslivelogin.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    
    <div class="description">
        <p>
Helper methods.
</p>

    </div>
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>A</dt>
        <dd>
            <ul>
                
                <li><a href="#M000033">appid</a>,</li>
                
                <li><a href="#M000030">appid=</a></li>
                
            </ul>
        </dd>
    
        <dt>B</dt>
        <dd>
            <ul>
                
                <li><a href="#M000044">baseurl</a></li>
                
            </ul>
        </dd>
    
        <dt>C</dt>
        <dd>
            <ul>
                
                <li><a href="#M000046">consenturl</a></li>
                
            </ul>
        </dd>
    
        <dt>D</dt>
        <dd>
            <ul>
                
                <li><a href="#M000023">debug</a>,</li>
                
                <li><a href="#M000073">decodeAndValidateToken</a>,</li>
                
                <li><a href="#M000074">decodeToken</a>,</li>
                
                <li><a href="#M000086">derive</a></li>
                
            </ul>
        </dd>
    
        <dt>E</dt>
        <dd>
            <ul>
                
                <li><a href="#M000089">e64</a></li>
                
            </ul>
        </dd>
    
        <dt>F</dt>
        <dd>
            <ul>
                
                <li><a href="#M000024">fatal</a>,</li>
                
                <li><a href="#M000091">fetch</a></li>
                
            </ul>
        </dd>
    
        <dt>G</dt>
        <dd>
            <ul>
                
                <li><a href="#M000078">getAppLoginUrl</a>,</li>
                
                <li><a href="#M000080">getAppRetCode</a>,</li>
                
                <li><a href="#M000079">getAppSecurityToken</a>,</li>
                
                <li><a href="#M000077">getAppVerifier</a>,</li>
                
                <li><a href="#M000056">getClearCookieResponse</a>,</li>
                
                <li><a href="#M000057">getConsentUrl</a>,</li>
                
                <li><a href="#M000047">getLoginUrl</a>,</li>
                
                <li><a href="#M000048">getLogoutUrl</a>,</li>
                
                <li><a href="#M000059">getManageConsentUrl</a>,</li>
                
                <li><a href="#M000058">getRefreshConsentTokenUrl</a>,</li>
                
                <li><a href="#M000083">getTrustedLoginUrl</a>,</li>
                
                <li><a href="#M000084">getTrustedLogoutUrl</a>,</li>
                
                <li><a href="#M000081">getTrustedParams</a>,</li>
                
                <li><a href="#M000082">getTrustedToken</a></li>
                
            </ul>
        </dd>
    
        <dt>I</dt>
        <dd>
            <ul>
                
                <li><a href="#M000027">initFromXml</a></li>
                
            </ul>
        </dd>
    
        <dt>N</dt>
        <dd>
            <ul>
                
                <li><a href="#M000026">new</a></li>
                
            </ul>
        </dd>
    
        <dt>O</dt>
        <dd>
            <ul>
                
                <li><a href="#M000035">oldsecret=</a>,</li>
                
                <li><a href="#M000037">oldsecretexpiry=</a></li>
                
            </ul>
        </dd>
    
        <dt>P</dt>
        <dd>
            <ul>
                
                <li><a href="#M000087">parse</a>,</li>
                
                <li><a href="#M000085">parseSettings</a>,</li>
                
                <li><a href="#M000041">policyurl</a>,</li>
                
                <li><a href="#M000040">policyurl=</a>,</li>
                
                <li><a href="#M000069">processConsent</a>,</li>
                
                <li><a href="#M000070">processConsentToken</a>,</li>
                
                <li><a href="#M000054">processLogin</a>,</li>
                
                <li><a href="#M000055">processToken</a></li>
                
            </ul>
        </dd>
    
        <dt>R</dt>
        <dd>
            <ul>
                
                <li><a href="#M000071">refreshConsentToken</a>,</li>
                
                <li><a href="#M000072">refreshConsentToken2</a>,</li>
                
                <li><a href="#M000043">returnurl</a>,</li>
                
                <li><a href="#M000042">returnurl=</a></li>
                
            </ul>
        </dd>
    
        <dt>S</dt>
        <dd>
            <ul>
                
                <li><a href="#M000034">secret=</a>,</li>
                
                <li><a href="#M000045">secureurl</a>,</li>
                
                <li><a href="#M000039">securityalgorithm</a>,</li>
                
                <li><a href="#M000022">setDebug</a>,</li>
                
                <li><a href="#M000075">signToken</a></li>
                
            </ul>
        </dd>
    
        <dt>T</dt>
        <dd>
            <ul>
                
                <li><a href="#M000088">timestamp</a></li>
                
            </ul>
        </dd>
    
        <dt>U</dt>
        <dd>
            <ul>
                
                <li><a href="#M000090">u64</a></li>
                
            </ul>
        </dd>
    
        <dt>V</dt>
        <dd>
            <ul>
                
                <li><a href="#M000076">validateToken</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    

    

    
    <div class="sectiontitle">Classes and Modules</div>
    <ul>
        
        <li><span class="type">CLASS</span> <a href="WindowsLiveLogin/ConsentToken.html">OmniAuth::Strategies::WindowsLive::WindowsLiveLogin::ConsentToken</a></li>
        
        <li><span class="type">CLASS</span> <a href="WindowsLiveLogin/User.html">OmniAuth::Strategies::WindowsLive::WindowsLiveLogin::User</a></li>
        
    </ul>
    

    

    
    <div class="sectiontitle">Attributes</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>oldsecretexpiry</td>
            <td class='attr-desc'><p>
Gets the old secret key expiry time.
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>securityalgorithm</td>
            <td class='attr-desc'><p>
Sets or gets the version of the security algorithm being used.
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>force_delauth_nonprovisioned</td>
            <td class='attr-desc'><p>
Sets a flag that indicates whether Delegated Authentication is
non-provisioned (i.e. does not use an application ID or secret key).
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>baseurl</td>
            <td class='attr-desc'><p>
Sets or gets the base URL to use for the Windows Live Login server. You
should not have to change this property. Furthermore, we recommend that you
use the Sign In control instead of the URL methods provided here.
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>secureurl</td>
            <td class='attr-desc'><p>
Sets or gets the secure (HTTPS) URL to use for the Windows Live Login
server. You should not have to change this property.
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>consenturl</td>
            <td class='attr-desc'><p>
Sets or gets the Consent Base URL to use for the Windows Live Consent
server. You should not have to use or change this property directly.
</p></td>
        </tr>
        
    </table>
    

    
            <div class="sectiontitle">Class Public methods</div>
            
            <div class="method">
                <div class="title" id="M000027">
                    
                    <a name="M000027"></a><b>initFromXml</b>(settingsFile)
                    
                </div>
                
                <div class="description">
                  <p>
Initialize the <a href="WindowsLiveLogin.html">WindowsLiveLogin</a> module
from a settings file.
</p>
<p>
&#8216;settingsFile&#8217; specifies the location of the XML settings file
that contains the application ID, secret key, and security algorithm. The
file is of the following format:
</p>
<p>
<windowslivelogin>
</p>
<pre>
  &lt;appid&gt;APPID&lt;/appid&gt;
  &lt;secret&gt;SECRET&lt;/secret&gt;
  &lt;securityalgorithm&gt;wsignin1.0&lt;/securityalgorithm&gt;
</pre>
<p>
</windowslivelogin>
</p>
<p>
In a Delegated Authentication scenario, you may also specify
&#8216;returnurl&#8217; and &#8216;policyurl&#8217; in the settings file,
as shown in the Delegated Authentication samples.
</p>
<p>
We recommend that you store the <a
href="WindowsLiveLogin.html">WindowsLiveLogin</a> settings file in an area
on your server that cannot be accessed through the Internet. This file
contains important confidential information.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000027_source')" id="l_M000027_source">show</a>
                        
                    </p>
                    <div id="M000027_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/omniauth/strategies/windows_live/windowslivelogin.rb, line 108</span>
108:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">initFromXml</span>(<span class="ruby-identifier">settingsFile</span>)
109:     <span class="ruby-identifier">o</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">new</span>
110:     <span class="ruby-identifier">settings</span> = <span class="ruby-identifier">o</span>.<span class="ruby-identifier">parseSettings</span>(<span class="ruby-identifier">settingsFile</span>)
111: 
112:     <span class="ruby-identifier">o</span>.<span class="ruby-identifier">setDebug</span>(<span class="ruby-identifier">settings</span>[<span class="ruby-value str">'debug'</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">'true'</span>)
113:     <span class="ruby-identifier">o</span>.<span class="ruby-identifier">force_delauth_nonprovisioned</span> =
114:       (<span class="ruby-identifier">settings</span>[<span class="ruby-value str">'force_delauth_nonprovisioned'</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">'true'</span>)
115: 
116:     <span class="ruby-identifier">o</span>.<span class="ruby-identifier">appid</span> = <span class="ruby-identifier">settings</span>[<span class="ruby-value str">'appid'</span>]
117:     <span class="ruby-identifier">o</span>.<span class="ruby-identifier">secret</span> = <span class="ruby-identifier">settings</span>[<span class="ruby-value str">'secret'</span>]
118:     <span class="ruby-identifier">o</span>.<span class="ruby-identifier">oldsecret</span> = <span class="ruby-identifier">settings</span>[<span class="ruby-value str">'oldsecret'</span>]
119:     <span class="ruby-identifier">o</span>.<span class="ruby-identifier">oldsecretexpiry</span> = <span class="ruby-identifier">settings</span>[<span class="ruby-value str">'oldsecretexpiry'</span>]
120:     <span class="ruby-identifier">o</span>.<span class="ruby-identifier">securityalgorithm</span> = <span class="ruby-identifier">settings</span>[<span class="ruby-value str">'securityalgorithm'</span>]
121:     <span class="ruby-identifier">o</span>.<span class="ruby-identifier">policyurl</span> = <span class="ruby-identifier">settings</span>[<span class="ruby-value str">'policyurl'</span>]
122:     <span class="ruby-identifier">o</span>.<span class="ruby-identifier">returnurl</span> = <span class="ruby-identifier">settings</span>[<span class="ruby-value str">'returnurl'</span>]
123:     <span class="ruby-identifier">o</span>.<span class="ruby-identifier">baseurl</span> = <span class="ruby-identifier">settings</span>[<span class="ruby-value str">'baseurl'</span>]
124:     <span class="ruby-identifier">o</span>.<span class="ruby-identifier">secureurl</span> = <span class="ruby-identifier">settings</span>[<span class="ruby-value str">'secureurl'</span>]
125:     <span class="ruby-identifier">o</span>.<span class="ruby-identifier">consenturl</span> = <span class="ruby-identifier">settings</span>[<span class="ruby-value str">'consenturl'</span>]
126:     <span class="ruby-identifier">o</span>
127:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000026">
                    
                    <a name="M000026"></a><b>new</b>(appid=nil, secret=nil, securityalgorithm=nil, force_delauth_nonprovisioned=nil, policyurl=nil, returnurl=nil)
                    
                </div>
                
                <div class="description">
                  <p>
Initialize the <a href="WindowsLiveLogin.html">WindowsLiveLogin</a> module
with the application ID, secret key, and security algorithm.
</p>
<p>
We recommend that you employ strong measures to protect the secret key. The
secret key should never be exposed to the Web or other users.
</p>
<p>
Be aware that if you do not supply these settings at initialization time,
you may need to set the corresponding properties manually.
</p>
<p>
For Delegated Authentication, you may optionally specify the privacy policy
URL and return URL. If you do not specify these values here, the default
values that you specified when you registered your application will be
used.
</p>
<p>
The &#8216;<a
href="WindowsLiveLogin.html#force_delauth_nonprovisioned">force_delauth_nonprovisioned</a>&#8217;
flag also indicates whether your application is registered for Delegated
Authentication (that is, whether it uses an application ID and secret key).
We recommend that your Delegated Authentication application always be
registered for enhanced security and functionality.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000026_source')" id="l_M000026_source">show</a>
                        
                    </p>
                    <div id="M000026_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/omniauth/strategies/windows_live/windowslivelogin.rb, line 76</span>
76:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">appid</span>=<span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">secret</span>=<span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">securityalgorithm</span>=<span class="ruby-keyword kw">nil</span>,
77:                  <span class="ruby-identifier">force_delauth_nonprovisioned</span>=<span class="ruby-keyword kw">nil</span>,
78:                  <span class="ruby-identifier">policyurl</span>=<span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">returnurl</span>=<span class="ruby-keyword kw">nil</span>)
79:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">force_delauth_nonprovisioned</span> = <span class="ruby-identifier">force_delauth_nonprovisioned</span>
80:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">appid</span> = <span class="ruby-identifier">appid</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">appid</span>
81:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">secret</span> = <span class="ruby-identifier">secret</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">secret</span>
82:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">securityalgorithm</span> = <span class="ruby-identifier">securityalgorithm</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">securityalgorithm</span>
83:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">policyurl</span> = <span class="ruby-identifier">policyurl</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">policyurl</span>
84:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">returnurl</span> = <span class="ruby-identifier">returnurl</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">returnurl</span>
85:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M000033">
                    
                    <a name="M000033"></a><b>appid</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Returns the application ID.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000033_source')" id="l_M000033_source">show</a>
                        
                    </p>
                    <div id="M000033_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/omniauth/strategies/windows_live/windowslivelogin.rb, line 147</span>
147:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">appid</span>
148:     <span class="ruby-keyword kw">if</span> (<span class="ruby-ivar">@appid</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@appid</span>.<span class="ruby-identifier">empty?</span>)
149:       <span class="ruby-identifier">fatal</span>(<span class="ruby-value str">&quot;Error: appid: App ID was not set. Aborting.&quot;</span>)
150:     <span class="ruby-keyword kw">end</span>
151:     <span class="ruby-ivar">@appid</span>
152:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000030">
                    
                    <a name="M000030"></a><b>appid=</b>(appid)
                    
                </div>
                
                <div class="description">
                  <p>
Sets the application ID. Use this method if you did not specify an
application ID at initialization.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000030_source')" id="l_M000030_source">show</a>
                        
                    </p>
                    <div id="M000030_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/omniauth/strategies/windows_live/windowslivelogin.rb, line 133</span>
133:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">appid=</span>(<span class="ruby-identifier">appid</span>)
134:     <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">appid</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">appid</span>.<span class="ruby-identifier">empty?</span>)
135:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">force_delauth_nonprovisioned</span>
136:       <span class="ruby-identifier">fatal</span>(<span class="ruby-value str">&quot;Error: appid: Null application ID.&quot;</span>)
137:     <span class="ruby-keyword kw">end</span>
138:     <span class="ruby-keyword kw">if</span> (<span class="ruby-keyword kw">not</span> <span class="ruby-identifier">appid</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/^\w+$/</span>)
139:       <span class="ruby-identifier">fatal</span>(<span class="ruby-value str">&quot;Error: appid: Application ID must be alpha-numeric: &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">appid</span>)
140:     <span class="ruby-keyword kw">end</span>
141:     <span class="ruby-ivar">@appid</span> = <span class="ruby-identifier">appid</span>
142:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000044">
                    
                    <a name="M000044"></a><b>baseurl</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000044_source')" id="l_M000044_source">show</a>
                        
                    </p>
                    <div id="M000044_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/omniauth/strategies/windows_live/windowslivelogin.rb, line 290</span>
290:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">baseurl</span>
291:     <span class="ruby-keyword kw">if</span>(<span class="ruby-ivar">@baseurl</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@baseurl</span>.<span class="ruby-identifier">empty?</span>)
292:       <span class="ruby-value str">&quot;http://login.live.com/&quot;</span>
293:     <span class="ruby-keyword kw">else</span>
294:       <span class="ruby-ivar">@baseurl</span>
295:     <span class="ruby-keyword kw">end</span>
296:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000046">
                    
                    <a name="M000046"></a><b>consenturl</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000046_source')" id="l_M000046_source">show</a>
                        
                    </p>
                    <div id="M000046_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/omniauth/strategies/windows_live/windowslivelogin.rb, line 318</span>
318:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">consenturl</span>
319:     <span class="ruby-keyword kw">if</span>(<span class="ruby-ivar">@consenturl</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@consenturl</span>.<span class="ruby-identifier">empty?</span>)
320:       <span class="ruby-value str">&quot;https://consent.live.com/&quot;</span>
321:     <span class="ruby-keyword kw">else</span>
322:       <span class="ruby-ivar">@consenturl</span>
323:     <span class="ruby-keyword kw">end</span>
324:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000023">
                    
                    <a name="M000023"></a><b>debug</b>(error)
                    
                </div>
                
                <div class="description">
                  <p>
Stub implementation for logging errors. By default, this function does
nothing if the debug flag has not been set with setDebug. Otherwise, it
tries to log the error message.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000023_source')" id="l_M000023_source">show</a>
                        
                    </p>
                    <div id="M000023_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/omniauth/strategies/windows_live/windowslivelogin.rb, line 38</span>
38:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">debug</span>(<span class="ruby-identifier">error</span>)
39:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@debug</span>
40:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">error</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">error</span>.<span class="ruby-identifier">empty?</span>
41:     <span class="ruby-identifier">warn</span>(<span class="ruby-node">&quot;Windows Live ID Authentication SDK #{error}&quot;</span>)
42:     <span class="ruby-keyword kw">nil</span>
43:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000073">
                    
                    <a name="M000073"></a><b>decodeAndValidateToken</b>(token, cryptkey=@cryptkey, signkey=@signkey, internal_allow_recursion=true)
                    
                </div>
                
                <div class="description">
                  <p>
Decodes and validates the token.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000073_source')" id="l_M000073_source">show</a>
                        
                    </p>
                    <div id="M000073_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/omniauth/strategies/windows_live/windowslivelogin.rb, line 807</span>
807:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">decodeAndValidateToken</span>(<span class="ruby-identifier">token</span>, <span class="ruby-identifier">cryptkey</span>=<span class="ruby-ivar">@cryptkey</span>, <span class="ruby-identifier">signkey</span>=<span class="ruby-ivar">@signkey</span>,
808:                              <span class="ruby-identifier">internal_allow_recursion</span>=<span class="ruby-keyword kw">true</span>)
809:     <span class="ruby-identifier">haveoldsecret</span> = <span class="ruby-keyword kw">false</span>
810:     <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">oldsecretexpiry</span> <span class="ruby-keyword kw">and</span> (<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">oldsecretexpiry</span>.<span class="ruby-identifier">to_i</span>))
811:       <span class="ruby-identifier">haveoldsecret</span> = <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">if</span> (<span class="ruby-ivar">@oldcryptkey</span> <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@oldsignkey</span>)
812:     <span class="ruby-keyword kw">end</span>
813:     <span class="ruby-identifier">haveoldsecret</span> = (<span class="ruby-identifier">haveoldsecret</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">internal_allow_recursion</span>)
814: 
815:     <span class="ruby-identifier">stoken</span> = <span class="ruby-identifier">decodeToken</span>(<span class="ruby-identifier">token</span>, <span class="ruby-identifier">cryptkey</span>)
816:     <span class="ruby-identifier">stoken</span> = <span class="ruby-identifier">validateToken</span>(<span class="ruby-identifier">stoken</span>, <span class="ruby-identifier">signkey</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">stoken</span>
817:     <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">stoken</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">haveoldsecret</span>)
818:       <span class="ruby-identifier">debug</span>(<span class="ruby-value str">&quot;Warning: Failed to validate token with current secret, attempting old secret.&quot;</span>)
819:       <span class="ruby-identifier">stoken</span> = <span class="ruby-identifier">decodeAndValidateToken</span>(<span class="ruby-identifier">token</span>, <span class="ruby-ivar">@oldcryptkey</span>, <span class="ruby-ivar">@oldsignkey</span>, <span class="ruby-keyword kw">false</span>)
820:     <span class="ruby-keyword kw">end</span>
821:     <span class="ruby-identifier">stoken</span>
822:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000074">
                    
                    <a name="M000074"></a><b>decodeToken</b>(token, cryptkey=@cryptkey)
                    
                </div>
                
                <div class="description">
                  <p>
Decodes the given token string; returns undef on failure.
</p>
<p>
First, the string is URL-unescaped and base64 decoded. Second, the IV is
extracted from the first 16 bytes of the string. Finally, the string is
decrypted using the encryption key.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000074_source')" id="l_M000074_source">show</a>
                        
                    </p>
                    <div id="M000074_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/omniauth/strategies/windows_live/windowslivelogin.rb, line 831</span>
831:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">decodeToken</span>(<span class="ruby-identifier">token</span>, <span class="ruby-identifier">cryptkey</span>=<span class="ruby-ivar">@cryptkey</span>)
832:     <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">cryptkey</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">cryptkey</span>.<span class="ruby-identifier">empty?</span>)
833:       <span class="ruby-identifier">fatal</span>(<span class="ruby-value str">&quot;Error: decodeToken: Secret key was not set. Aborting.&quot;</span>)
834:     <span class="ruby-keyword kw">end</span>
835:     <span class="ruby-identifier">token</span> =  <span class="ruby-identifier">u64</span>(<span class="ruby-identifier">token</span>)
836:     <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">token</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">or</span> (<span class="ruby-identifier">token</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-value">16</span>) <span class="ruby-keyword kw">or</span> <span class="ruby-operator">!</span>(<span class="ruby-identifier">token</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">%</span> <span class="ruby-value">16</span>).<span class="ruby-identifier">zero?</span>)
837:       <span class="ruby-identifier">debug</span>(<span class="ruby-value str">&quot;Error: decodeToken: Attempted to decode invalid token.&quot;</span>)
838:       <span class="ruby-keyword kw">return</span>
839:     <span class="ruby-keyword kw">end</span>
840:     <span class="ruby-identifier">iv</span> = <span class="ruby-identifier">token</span>[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">15</span>]
841:     <span class="ruby-identifier">crypted</span> = <span class="ruby-identifier">token</span>[<span class="ruby-value">16</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>]
842:     <span class="ruby-keyword kw">begin</span>
843:       <span class="ruby-identifier">aes128cbc</span> = <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">Cipher</span><span class="ruby-operator">::</span><span class="ruby-constant">AES128</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;CBC&quot;</span>)
844:       <span class="ruby-identifier">aes128cbc</span>.<span class="ruby-identifier">decrypt</span>
845:       <span class="ruby-identifier">aes128cbc</span>.<span class="ruby-identifier">iv</span> = <span class="ruby-identifier">iv</span>
846:       <span class="ruby-identifier">aes128cbc</span>.<span class="ruby-identifier">key</span> = <span class="ruby-identifier">cryptkey</span>
847:       <span class="ruby-identifier">decrypted</span> = <span class="ruby-identifier">aes128cbc</span>.<span class="ruby-identifier">update</span>(<span class="ruby-identifier">crypted</span>) <span class="ruby-operator">+</span> <span class="ruby-identifier">aes128cbc</span>.<span class="ruby-identifier">final</span>
848:     <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
849:       <span class="ruby-identifier">debug</span>(<span class="ruby-node">&quot;Error: decodeToken: Decryption failed: #{token}, #{e}&quot;</span>)
850:       <span class="ruby-keyword kw">return</span>
851:     <span class="ruby-keyword kw">end</span>
852:     <span class="ruby-identifier">decrypted</span>
853:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000086">
                    
                    <a name="M000086"></a><b>derive</b>(secret, prefix)
                    
                </div>
                
                <div class="description">
                  <p>
Derives the key, given the secret key and prefix as described in the Web
Authentication SDK documentation.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000086_source')" id="l_M000086_source">show</a>
                        
                    </p>
                    <div id="M000086_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/omniauth/strategies/windows_live/windowslivelogin.rb, line 1067</span>
1067:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">derive</span>(<span class="ruby-identifier">secret</span>, <span class="ruby-identifier">prefix</span>)
1068:     <span class="ruby-keyword kw">begin</span>
1069:       <span class="ruby-identifier">fatal</span>(<span class="ruby-value str">&quot;Nil/empty secret.&quot;</span>) <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">secret</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">secret</span>.<span class="ruby-identifier">empty?</span>)
1070:       <span class="ruby-identifier">key</span> = <span class="ruby-identifier">prefix</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">secret</span>
1071:       <span class="ruby-identifier">key</span> = <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">Digest</span><span class="ruby-operator">::</span><span class="ruby-constant">SHA256</span>.<span class="ruby-identifier">digest</span>(<span class="ruby-identifier">key</span>)
1072:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">key</span>[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">15</span>]
1073:     <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
1074:       <span class="ruby-identifier">debug</span>(<span class="ruby-node">&quot;Error: derive: #{e}&quot;</span>)
1075:       <span class="ruby-keyword kw">return</span>
1076:     <span class="ruby-keyword kw">end</span>
1077:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000089">
                    
                    <a name="M000089"></a><b>e64</b>(s)
                    
                </div>
                
                <div class="description">
                  <p>
Base64-encodes and URL-escapes a string.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000089_source')" id="l_M000089_source">show</a>
                        
                    </p>
                    <div id="M000089_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/omniauth/strategies/windows_live/windowslivelogin.rb, line 1120</span>
1120:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">e64</span>(<span class="ruby-identifier">s</span>)
1121:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">s</span>
1122:     <span class="ruby-constant">CGI</span>.<span class="ruby-identifier">escape</span> <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">encode64</span>(<span class="ruby-identifier">s</span>)
1123:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000024">
                    
                    <a name="M000024"></a><b>fatal</b>(error)
                    
                </div>
                
                <div class="description">
                  <p>
Stub implementation for handling a fatal error.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000024_source')" id="l_M000024_source">show</a>
                        
                    </p>
                    <div id="M000024_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/omniauth/strategies/windows_live/windowslivelogin.rb, line 48</span>
48:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">fatal</span>(<span class="ruby-identifier">error</span>)
49:     <span class="ruby-identifier">debug</span>(<span class="ruby-identifier">error</span>)
50:     <span class="ruby-identifier">raise</span>(<span class="ruby-identifier">error</span>)
51:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000091">
                    
                    <a name="M000091"></a><b>fetch</b>(url)
                    
                </div>
                
                <div class="description">
                  <p>
Fetches the contents given a URL.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000091_source')" id="l_M000091_source">show</a>
                        
                    </p>
                    <div id="M000091_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/omniauth/strategies/windows_live/windowslivelogin.rb, line 1136</span>
1136:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">fetch</span>(<span class="ruby-identifier">url</span>)
1137:       <span class="ruby-identifier">url</span> = <span class="ruby-constant">URI</span>.<span class="ruby-identifier">parse</span> <span class="ruby-identifier">url</span>
1138:       <span class="ruby-identifier">http</span> = <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">HTTP</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">url</span>.<span class="ruby-identifier">host</span>, <span class="ruby-identifier">url</span>.<span class="ruby-identifier">port</span>)
1139:       <span class="ruby-identifier">http</span>.<span class="ruby-identifier">use_ssl</span> = (<span class="ruby-identifier">url</span>.<span class="ruby-identifier">scheme</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;https&quot;</span>)
1140:       <span class="ruby-identifier">http</span>.<span class="ruby-identifier">request_get</span> <span class="ruby-identifier">url</span>.<span class="ruby-identifier">request_uri</span>
1141:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000078">
                    
                    <a name="M000078"></a><b>getAppLoginUrl</b>(siteid=nil, ip=nil, js=nil)
                    
                </div>
                
                <div class="description">
                  <p>
Returns the URL that is required to retrieve the application security
token.
</p>
<p>
By default, the application security token is generated for the Windows
Live site; a specific Site ID can optionally be specified in
&#8216;siteid&#8217;. The IP address can also optionally be included in
&#8216;ip&#8217;.
</p>
<p>
If &#8216;js&#8217; is nil, a JavaScript Output Notation (JSON) response is
returned in the following format:
</p>
<p>
{&#8220;token&#8221;:&#8221;<value>&#8221;}
</p>
<p>
Otherwise, a JavaScript response is returned. It is assumed that
WLIDResultCallback is a custom function implemented to handle the token
value:
</p>
<p>
WLIDResultCallback(&#8220;<tokenvalue>&#8221;);
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000078_source')" id="l_M000078_source">show</a>
                        
                    </p>
                    <div id="M000078_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/omniauth/strategies/windows_live/windowslivelogin.rb, line 928</span>
928:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">getAppLoginUrl</span>(<span class="ruby-identifier">siteid</span>=<span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">ip</span>=<span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">js</span>=<span class="ruby-keyword kw">nil</span>)
929:     <span class="ruby-identifier">url</span> = <span class="ruby-identifier">secureurl</span> <span class="ruby-operator">+</span> <span class="ruby-node">&quot;wapplogin.srf?app=#{getAppVerifier(ip)}&quot;</span>
930:     <span class="ruby-identifier">url</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;&amp;alg=#{securityalgorithm}&quot;</span>
931:     <span class="ruby-identifier">url</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;&amp;id=#{siteid}&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">siteid</span>
932:     <span class="ruby-identifier">url</span> <span class="ruby-operator">+=</span> <span class="ruby-value str">&quot;&amp;js=1&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">js</span>
933:     <span class="ruby-identifier">url</span>
934:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000080">
                    
                    <a name="M000080"></a><b>getAppRetCode</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Returns a string that can be passed to the getTrustedParams function as the
&#8216;retcode&#8217; parameter. If this is specified as the
&#8216;retcode&#8217;, the application will be used as return URL after it
finishes trusted sign-in.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000080_source')" id="l_M000080_source">show</a>
                        
                    </p>
                    <div id="M000080_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/omniauth/strategies/windows_live/windowslivelogin.rb, line 975</span>
975:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">getAppRetCode</span>
976:     <span class="ruby-node">&quot;appid=#{appid}&quot;</span>
977:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000079">
                    
                    <a name="M000079"></a><b>getAppSecurityToken</b>(siteid=nil, ip=nil)
                    
                </div>
                
                <div class="description">
                  <p>
Retrieves the application security token for application verification from
the application sign-in URL.
</p>
<p>
By default, the application security token will be generated for the
Windows Live site; a specific Site ID can optionally be specified in
&#8216;siteid&#8217;. The IP address can also optionally be included in
&#8216;ip&#8217;.
</p>
<p>
Implementation note: The application security token is downloaded from the
application sign-in URL in JSON format:
</p>
<p>
{&#8220;token&#8221;:&#8221;<value>&#8221;}
</p>
<p>
Therefore we must extract <value> from the string and return it as seen
here.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000079_source')" id="l_M000079_source">show</a>
                        
                    </p>
                    <div id="M000079_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/omniauth/strategies/windows_live/windowslivelogin.rb, line 953</span>
953:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">getAppSecurityToken</span>(<span class="ruby-identifier">siteid</span>=<span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">ip</span>=<span class="ruby-keyword kw">nil</span>)
954:     <span class="ruby-identifier">url</span> = <span class="ruby-identifier">getAppLoginUrl</span>(<span class="ruby-identifier">siteid</span>, <span class="ruby-identifier">ip</span>)
955:     <span class="ruby-keyword kw">begin</span>
956:       <span class="ruby-identifier">ret</span> = <span class="ruby-identifier">fetch</span> <span class="ruby-identifier">url</span>
957:       <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">value</span> <span class="ruby-comment cmt"># raises exception if fetch failed</span>
958:       <span class="ruby-identifier">body</span> = <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">body</span>
959:       <span class="ruby-identifier">body</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\{&quot;token&quot;:&quot;(.*)&quot;\}/</span>){<span class="ruby-operator">|</span><span class="ruby-identifier">match</span><span class="ruby-operator">|</span>
960:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">match</span>
961:       }
962:       <span class="ruby-identifier">debug</span>(<span class="ruby-node">&quot;Error: getAppSecurityToken: Failed to extract token: #{body}&quot;</span>)
963:     <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
964:       <span class="ruby-identifier">debug</span>(<span class="ruby-node">&quot;Error: getAppSecurityToken: Failed to get token: #{e}&quot;</span>)
965:     <span class="ruby-keyword kw">end</span>
966:     <span class="ruby-keyword kw">return</span>
967:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000077">
                    
                    <a name="M000077"></a><b>getAppVerifier</b>(ip=nil)
                    
                </div>
                
                <div class="description">
                  <p>
Generates an application verifier token. An IP address can optionally be
included in the token.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000077_source')" id="l_M000077_source">show</a>
                        
                    </p>
                    <div id="M000077_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/omniauth/strategies/windows_live/windowslivelogin.rb, line 901</span>
901:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">getAppVerifier</span>(<span class="ruby-identifier">ip</span>=<span class="ruby-keyword kw">nil</span>)
902:     <span class="ruby-identifier">token</span> = <span class="ruby-node">&quot;appid=#{appid}&amp;ts=#{timestamp}&quot;</span>
903:     <span class="ruby-identifier">token</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;&amp;ip=#{ip}&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ip</span>
904:     <span class="ruby-identifier">token</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;&amp;sig=#{e64(signToken(token))}&quot;</span>
905:     <span class="ruby-constant">CGI</span>.<span class="ruby-identifier">escape</span> <span class="ruby-identifier">token</span>
906:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000056">
                    
                    <a name="M000056"></a><b>getClearCookieResponse</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Returns an appropriate content type and body response that the application
handler can return to signify a successful sign-out from the application.
</p>
<p>
When a user signs out of Windows Live or a Windows Live application, a
best-effort attempt is made at signing the user out from all other Windows
Live applications the user might be signed in to. This is done by calling
the handler page for each application with &#8216;action&#8217; set to
&#8216;clearcookie&#8217; in the query string. The application handler is
then responsible for clearing any cookies or data associated with the
sign-in. After successfully signing the user out, the handler should return
a GIF (any GIF) image as response to the &#8216;action=clearcookie&#8217;
query.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000056_source')" id="l_M000056_source">show</a>
                        
                    </p>
                    <div id="M000056_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/omniauth/strategies/windows_live/windowslivelogin.rb, line 494</span>
494:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">getClearCookieResponse</span>()
495:     <span class="ruby-identifier">type</span> = <span class="ruby-value str">&quot;image/gif&quot;</span>
496:     <span class="ruby-identifier">content</span> = <span class="ruby-value str">&quot;R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAEALAAAAAABAAEAAAIBTAA7&quot;</span>
497:     <span class="ruby-identifier">content</span> = <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">decode64</span>(<span class="ruby-identifier">content</span>)
498:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">type</span>, <span class="ruby-identifier">content</span>
499:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000057">
                    
                    <a name="M000057"></a><b>getConsentUrl</b>(offers, context=nil, ru=nil, market=nil)
                    
                </div>
                
                <div class="description">
                  <p>
Returns the consent URL to use for Delegated Authentication for the given
comma-delimited list of offers.
</p>
<p>
If you specify it, &#8216;context&#8217; will be returned as-is in the
consent response for site-specific use.
</p>
<p>
The registered/configured return URL can also be overridden by specifying
&#8216;ru&#8217; here.
</p>
<p>
You can change the language in which the consent page is displayed by
specifying a culture ID (For example, &#8216;fr-fr&#8217; or
&#8216;en-us&#8217;) in the &#8216;market&#8217; parameter.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000057_source')" id="l_M000057_source">show</a>
                        
                    </p>
                    <div id="M000057_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/omniauth/strategies/windows_live/windowslivelogin.rb, line 521</span>
521:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">getConsentUrl</span>(<span class="ruby-identifier">offers</span>, <span class="ruby-identifier">context</span>=<span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">ru</span>=<span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">market</span>=<span class="ruby-keyword kw">nil</span>)
522:     <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">offers</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">offers</span>.<span class="ruby-identifier">empty?</span>)
523:       <span class="ruby-identifier">fatal</span>(<span class="ruby-value str">&quot;Error: getConsentUrl: Invalid offers list.&quot;</span>)
524:     <span class="ruby-keyword kw">end</span>
525:     <span class="ruby-identifier">url</span> = <span class="ruby-identifier">consenturl</span> <span class="ruby-operator">+</span> <span class="ruby-node">&quot;Delegation.aspx?ps=#{CGI.escape(offers)}&quot;</span>
526:     <span class="ruby-identifier">url</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;&amp;appctx=#{CGI.escape(context)}&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">context</span>
527:     <span class="ruby-identifier">ru</span> = <span class="ruby-identifier">returnurl</span> <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">ru</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">ru</span>.<span class="ruby-identifier">empty?</span>)
528:     <span class="ruby-identifier">url</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;&amp;ru=#{CGI.escape(ru)}&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ru</span>
529:     <span class="ruby-identifier">pu</span> = <span class="ruby-identifier">policyurl</span>
530:     <span class="ruby-identifier">url</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;&amp;pl=#{CGI.escape(pu)}&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">pu</span>
531:     <span class="ruby-identifier">url</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;&amp;mkt=#{CGI.escape(market)}&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">market</span>
532:     <span class="ruby-identifier">url</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;&amp;app=#{getAppVerifier()}&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">force_delauth_nonprovisioned</span>
533:     <span class="ruby-identifier">url</span>
534:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000047">
                    
                    <a name="M000047"></a><b>getLoginUrl</b>(context=nil, market=nil)
                    
                </div>
                
                <div class="description">
                  <p>
Returns the sign-in URL to use for the Windows Live Login server. We
recommend that you use the Sign In control instead.
</p>
<p>
If you specify it, &#8216;context&#8217; will be returned as-is in the
sign-in response for site-specific use.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000047_source')" id="l_M000047_source">show</a>
                        
                    </p>
                    <div id="M000047_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/omniauth/strategies/windows_live/windowslivelogin.rb, line 338</span>
338:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">getLoginUrl</span>(<span class="ruby-identifier">context</span>=<span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">market</span>=<span class="ruby-keyword kw">nil</span>)
339:     <span class="ruby-identifier">url</span> = <span class="ruby-identifier">baseurl</span> <span class="ruby-operator">+</span> <span class="ruby-node">&quot;wlogin.srf?appid=#{appid}&quot;</span>
340:     <span class="ruby-identifier">url</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;&amp;alg=#{securityalgorithm}&quot;</span>
341:     <span class="ruby-identifier">url</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;&amp;appctx=#{CGI.escape(context)}&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">context</span>
342:     <span class="ruby-identifier">url</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;&amp;mkt=#{CGI.escape(market)}&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">market</span>
343:     <span class="ruby-identifier">url</span>
344:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000048">
                    
                    <a name="M000048"></a><b>getLogoutUrl</b>(market=nil)
                    
                </div>
                
                <div class="description">
                  <p>
Returns the sign-out URL to use for the Windows Live Login server. We
recommend that you use the Sign In control instead.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000048_source')" id="l_M000048_source">show</a>
                        
                    </p>
                    <div id="M000048_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/omniauth/strategies/windows_live/windowslivelogin.rb, line 350</span>
350:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">getLogoutUrl</span>(<span class="ruby-identifier">market</span>=<span class="ruby-keyword kw">nil</span>)
351:     <span class="ruby-identifier">url</span> = <span class="ruby-identifier">baseurl</span> <span class="ruby-operator">+</span> <span class="ruby-node">&quot;logout.srf?appid=#{appid}&quot;</span>
352:     <span class="ruby-identifier">url</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;&amp;mkt=#{CGI.escape(market)}&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">market</span>
353:     <span class="ruby-identifier">url</span>
354:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000059">
                    
                    <a name="M000059"></a><b>getManageConsentUrl</b>(market=nil)
                    
                </div>
                
                <div class="description">
                  <p>
Returns the URL for the consent-management user interface. You can change
the language in which the consent page is displayed by specifying a culture
ID (For example, &#8216;fr-fr&#8217; or &#8216;en-us&#8217;) in the
&#8216;market&#8217; parameter.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000059_source')" id="l_M000059_source">show</a>
                        
                    </p>
                    <div id="M000059_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/omniauth/strategies/windows_live/windowslivelogin.rb, line 563</span>
563:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">getManageConsentUrl</span>(<span class="ruby-identifier">market</span>=<span class="ruby-keyword kw">nil</span>)
564:     <span class="ruby-identifier">url</span> = <span class="ruby-identifier">consenturl</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;ManageConsent.aspx&quot;</span>
565:     <span class="ruby-identifier">url</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;?mkt=#{CGI.escape(market)}&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">market</span>
566:     <span class="ruby-identifier">url</span>
567:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000058">
                    
                    <a name="M000058"></a><b>getRefreshConsentTokenUrl</b>(offers, refreshtoken, ru)
                    
                </div>
                
                <div class="description">
                  <p>
Returns the URL to use to download a new consent token, given the offers
and refresh token. The registered/configured return URL can also be
overridden by specifying &#8216;ru&#8217; here.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000058_source')" id="l_M000058_source">show</a>
                        
                    </p>
                    <div id="M000058_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/omniauth/strategies/windows_live/windowslivelogin.rb, line 542</span>
542:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">getRefreshConsentTokenUrl</span>(<span class="ruby-identifier">offers</span>, <span class="ruby-identifier">refreshtoken</span>, <span class="ruby-identifier">ru</span>)
543:     <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">offers</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">offers</span>.<span class="ruby-identifier">empty?</span>)
544:       <span class="ruby-identifier">fatal</span>(<span class="ruby-value str">&quot;Error: getRefreshConsentTokenUrl: Invalid offers list.&quot;</span>)
545:     <span class="ruby-keyword kw">end</span>
546:     <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">refreshtoken</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">refreshtoken</span>.<span class="ruby-identifier">empty?</span>)
547:       <span class="ruby-identifier">fatal</span>(<span class="ruby-value str">&quot;Error: getRefreshConsentTokenUrl: Invalid refresh token.&quot;</span>)
548:     <span class="ruby-keyword kw">end</span>
549:     <span class="ruby-identifier">url</span> = <span class="ruby-identifier">consenturl</span> <span class="ruby-operator">+</span> <span class="ruby-node">&quot;RefreshToken.aspx?ps=#{CGI.escape(offers)}&quot;</span>
550:     <span class="ruby-identifier">url</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;&amp;reft=#{refreshtoken}&quot;</span>
551:     <span class="ruby-identifier">ru</span> = <span class="ruby-identifier">returnurl</span> <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">ru</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">ru</span>.<span class="ruby-identifier">empty?</span>)
552:     <span class="ruby-identifier">url</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;&amp;ru=#{CGI.escape(ru)}&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ru</span>
553:     <span class="ruby-identifier">url</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;&amp;app=#{getAppVerifier()}&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">force_delauth_nonprovisioned</span>
554:     <span class="ruby-identifier">url</span>
555:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000083">
                    
                    <a name="M000083"></a><b>getTrustedLoginUrl</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Returns the trusted sign-in URL to use for the Windows Live Login server.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000083_source')" id="l_M000083_source">show</a>
                        
                    </p>
                    <div id="M000083_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/omniauth/strategies/windows_live/windowslivelogin.rb, line 1027</span>
1027:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">getTrustedLoginUrl</span>
1028:     <span class="ruby-identifier">secureurl</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;wlogin.srf&quot;</span>
1029:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000084">
                    
                    <a name="M000084"></a><b>getTrustedLogoutUrl</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Returns the trusted sign-out URL to use for the Windows Live Login server.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000084_source')" id="l_M000084_source">show</a>
                        
                    </p>
                    <div id="M000084_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/omniauth/strategies/windows_live/windowslivelogin.rb, line 1035</span>
1035:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">getTrustedLogoutUrl</span>
1036:     <span class="ruby-identifier">secureurl</span> <span class="ruby-operator">+</span> <span class="ruby-node">&quot;logout.srf?appid=#{appid}&quot;</span>
1037:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000081">
                    
                    <a name="M000081"></a><b>getTrustedParams</b>(user, retcode=nil)
                    
                </div>
                
                <div class="description">
                  <p>
Returns a table of key-value pairs that must be posted to the sign-in URL
for trusted sign-in. Use HTTP POST to do this. Be aware that the values in
the table are neither URL nor HTML escaped and may have to be escaped if
you are inserting them in code such as an HTML form.
</p>
<p>
The user to be trusted on the local site is passed in as string
&#8216;user&#8217;.
</p>
<p>
Optionally, &#8216;retcode&#8217; specifies the resource to which
successful sign-in is redirected, such as Windows Live Mail, and is
typically a string in the format &#8216;id=2000&#8217;. If you pass in the
value from getAppRetCode instead, sign-in will be redirected to the
application. Otherwise, an HTTP 200 response is returned.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000081_source')" id="l_M000081_source">show</a>
                        
                    </p>
                    <div id="M000081_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/omniauth/strategies/windows_live/windowslivelogin.rb, line 995</span>
 995:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">getTrustedParams</span>(<span class="ruby-identifier">user</span>, <span class="ruby-identifier">retcode</span>=<span class="ruby-keyword kw">nil</span>)
 996:     <span class="ruby-identifier">token</span> = <span class="ruby-identifier">getTrustedToken</span>(<span class="ruby-identifier">user</span>)
 997:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">token</span>
 998:     <span class="ruby-identifier">token</span> = <span class="ruby-node">%{&lt;wst:RequestSecurityTokenResponse xmlns:wst=&quot;http://schemas.xmlsoap.org/ws/2005/02/trust&quot;&gt;&lt;wst:RequestedSecurityToken&gt;&lt;wsse:BinarySecurityToken xmlns:wsse=&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd&quot;&gt;#{token}&lt;/wsse:BinarySecurityToken&gt;&lt;/wst:RequestedSecurityToken&gt;&lt;wsp:AppliesTo xmlns:wsp=&quot;http://schemas.xmlsoap.org/ws/2004/09/policy&quot;&gt;&lt;wsa:EndpointReference xmlns:wsa=&quot;http://schemas.xmlsoap.org/ws/2004/08/addressing&quot;&gt;&lt;wsa:Address&gt;uri:WindowsLiveID&lt;/wsa:Address&gt;&lt;/wsa:EndpointReference&gt;&lt;/wsp:AppliesTo&gt;&lt;/wst:RequestSecurityTokenResponse&gt;}</span>
 999:     <span class="ruby-identifier">params</span> = {}
1000:     <span class="ruby-identifier">params</span>[<span class="ruby-value str">'wa'</span>] = <span class="ruby-identifier">securityalgorithm</span>
1001:     <span class="ruby-identifier">params</span>[<span class="ruby-value str">'wresult'</span>] = <span class="ruby-identifier">token</span>
1002:     <span class="ruby-identifier">params</span>[<span class="ruby-value str">'wctx'</span>] = <span class="ruby-identifier">retcode</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">retcode</span>
1003:     <span class="ruby-identifier">params</span>
1004:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000082">
                    
                    <a name="M000082"></a><b>getTrustedToken</b>(user)
                    
                </div>
                
                <div class="description">
                  <p>
Returns the trusted sign-in token in the format that is needed by a control
doing trusted sign-in.
</p>
<p>
The user to be trusted on the local site is passed in as string
&#8216;user&#8217;.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000082_source')" id="l_M000082_source">show</a>
                        
                    </p>
                    <div id="M000082_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/omniauth/strategies/windows_live/windowslivelogin.rb, line 1013</span>
1013:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">getTrustedToken</span>(<span class="ruby-identifier">user</span>)
1014:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">empty?</span>
1015:       <span class="ruby-identifier">debug</span>(<span class="ruby-value str">'Error: getTrustedToken: Null user specified.'</span>)
1016:       <span class="ruby-keyword kw">return</span>
1017:     <span class="ruby-keyword kw">end</span>
1018:     <span class="ruby-identifier">token</span> = <span class="ruby-node">&quot;appid=#{appid}&amp;uid=#{CGI.escape(user)}&amp;ts=#{timestamp}&quot;</span>
1019:     <span class="ruby-identifier">token</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;&amp;sig=#{e64(signToken(token))}&quot;</span>
1020:     <span class="ruby-constant">CGI</span>.<span class="ruby-identifier">escape</span> <span class="ruby-identifier">token</span>
1021:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000035">
                    
                    <a name="M000035"></a><b>oldsecret=</b>(secret)
                    
                </div>
                
                <div class="description">
                  <p>
Sets your old secret key.
</p>
<p>
Use this property to set your old secret key if you are in the process of
transitioning to a new secret key. You may need this property because the
Windows Live ID servers can take up to 24 hours to propagate a new secret
key after you have updated your application settings.
</p>
<p>
If an old secret key is specified here and has not expired (as determined
by the oldsecretexpiry setting), it will be used as a fallback if token
decryption fails with the new secret key.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000035_source')" id="l_M000035_source">show</a>
                        
                    </p>
                    <div id="M000035_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/omniauth/strategies/windows_live/windowslivelogin.rb, line 184</span>
184:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">oldsecret=</span>(<span class="ruby-identifier">secret</span>)
185:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">secret</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">secret</span>.<span class="ruby-identifier">empty?</span>)
186:     <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">secret</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">16</span>)
187:       <span class="ruby-identifier">fatal</span>(<span class="ruby-value str">&quot;Error: oldsecret=: Secret must be at least 16 characters.&quot;</span>)
188:     <span class="ruby-keyword kw">end</span>
189:     <span class="ruby-ivar">@oldsignkey</span> = <span class="ruby-identifier">derive</span>(<span class="ruby-identifier">secret</span>, <span class="ruby-value str">&quot;SIGNATURE&quot;</span>)
190:     <span class="ruby-ivar">@oldcryptkey</span> = <span class="ruby-identifier">derive</span>(<span class="ruby-identifier">secret</span>, <span class="ruby-value str">&quot;ENCRYPTION&quot;</span>)
191:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000037">
                    
                    <a name="M000037"></a><b>oldsecretexpiry=</b>(timestamp)
                    
                </div>
                
                <div class="description">
                  <p>
Sets the expiry time for your old secret key.
</p>
<p>
After this time has passed, the old secret key will no longer be used even
if token decryption fails with the new secret key.
</p>
<p>
The old secret expiry time is represented as the number of seconds elapsed
since January 1, 1970.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000037_source')" id="l_M000037_source">show</a>
                        
                    </p>
                    <div id="M000037_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/omniauth/strategies/windows_live/windowslivelogin.rb, line 202</span>
202:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">oldsecretexpiry=</span>(<span class="ruby-identifier">timestamp</span>)
203:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">timestamp</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">timestamp</span>.<span class="ruby-identifier">empty?</span>)
204:     <span class="ruby-identifier">timestamp</span> = <span class="ruby-identifier">timestamp</span>.<span class="ruby-identifier">to_i</span>
205:     <span class="ruby-identifier">fatal</span>(<span class="ruby-node">&quot;Error: oldsecretexpiry=: Invalid timestamp: #{timestamp}&quot;</span>) <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">timestamp</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-value">0</span>)
206:     <span class="ruby-ivar">@oldsecretexpiry</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">at</span> <span class="ruby-identifier">timestamp</span>
207:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000087">
                    
                    <a name="M000087"></a><b>parse</b>(input)
                    
                </div>
                
                <div class="description">
                  <p>
Parses query string and return a table {String=>String}
</p>
<p>
If a table is passed in from CGI.params, we convert it from {String=>[]} to
{String=>String}. I believe Rails uses symbols instead of strings in
general, so we convert from symbols to strings here also.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000087_source')" id="l_M000087_source">show</a>
                        
                    </p>
                    <div id="M000087_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/omniauth/strategies/windows_live/windowslivelogin.rb, line 1088</span>
1088:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">parse</span>(<span class="ruby-identifier">input</span>)
1089:     <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">input</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">input</span>.<span class="ruby-identifier">empty?</span>)
1090:       <span class="ruby-identifier">debug</span>(<span class="ruby-value str">&quot;Error: parse: Nil/empty input.&quot;</span>)
1091:       <span class="ruby-keyword kw">return</span>
1092:     <span class="ruby-keyword kw">end</span>
1093: 
1094:     <span class="ruby-identifier">pairs</span> = {}
1095:     <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">input</span>.<span class="ruby-identifier">class</span> <span class="ruby-operator">==</span> <span class="ruby-constant">String</span>)
1096:       <span class="ruby-identifier">input</span> = <span class="ruby-identifier">input</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">'&amp;'</span>)
1097:       <span class="ruby-identifier">input</span>.<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">pair</span><span class="ruby-operator">|</span>
1098:         <span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span> = <span class="ruby-identifier">pair</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">'='</span>)
1099:         <span class="ruby-identifier">pairs</span>[<span class="ruby-identifier">k</span>] = <span class="ruby-identifier">v</span>
1100:       }
1101:     <span class="ruby-keyword kw">else</span>
1102:       <span class="ruby-identifier">input</span>.<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
1103:         <span class="ruby-identifier">v</span> = <span class="ruby-identifier">v</span>[<span class="ruby-value">0</span>] <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">v</span>.<span class="ruby-identifier">class</span> <span class="ruby-operator">==</span> <span class="ruby-constant">Array</span>)
1104:         <span class="ruby-identifier">pairs</span>[<span class="ruby-identifier">k</span>.<span class="ruby-identifier">to_s</span>] = <span class="ruby-identifier">v</span>.<span class="ruby-identifier">to_s</span>
1105:       }
1106:     <span class="ruby-keyword kw">end</span>
1107:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">pairs</span>
1108:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000085">
                    
                    <a name="M000085"></a><b>parseSettings</b>(settingsFile)
                    
                </div>
                
                <div class="description">
                  <p>
Function to parse the settings file.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000085_source')" id="l_M000085_source">show</a>
                        
                    </p>
                    <div id="M000085_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/omniauth/strategies/windows_live/windowslivelogin.rb, line 1048</span>
1048:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">parseSettings</span>(<span class="ruby-identifier">settingsFile</span>)
1049:     <span class="ruby-identifier">settings</span> = {}
1050:     <span class="ruby-keyword kw">begin</span>
1051:       <span class="ruby-identifier">file</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">settingsFile</span>)
1052:       <span class="ruby-identifier">doc</span> = <span class="ruby-constant">REXML</span><span class="ruby-operator">::</span><span class="ruby-constant">Document</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">file</span>
1053:       <span class="ruby-identifier">root</span> = <span class="ruby-identifier">doc</span>.<span class="ruby-identifier">root</span>
1054:       <span class="ruby-identifier">root</span>.<span class="ruby-identifier">each_element</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">e</span><span class="ruby-operator">|</span>
1055:         <span class="ruby-identifier">settings</span>[<span class="ruby-identifier">e</span>.<span class="ruby-identifier">name</span>] = <span class="ruby-identifier">e</span>.<span class="ruby-identifier">text</span>
1056:       }
1057:     <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
1058:       <span class="ruby-identifier">fatal</span>(<span class="ruby-node">&quot;Error: parseSettings: Error while reading #{settingsFile}: #{e}&quot;</span>)
1059:     <span class="ruby-keyword kw">end</span>
1060:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">settings</span>
1061:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000041">
                    
                    <a name="M000041"></a><b>policyurl</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Gets the privacy policy URL for your site.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000041_source')" id="l_M000041_source">show</a>
                        
                    </p>
                    <div id="M000041_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/omniauth/strategies/windows_live/windowslivelogin.rb, line 249</span>
249:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">policyurl</span>
250:     <span class="ruby-keyword kw">if</span> (<span class="ruby-ivar">@policyurl</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@policyurl</span>.<span class="ruby-identifier">empty?</span>)
251:       <span class="ruby-identifier">debug</span>(<span class="ruby-value str">&quot;Warning: In the initial release of Del Auth, a Policy URL must be configured in the SDK for both provisioned and non-provisioned scenarios.&quot;</span>)
252:       <span class="ruby-identifier">raise</span>(<span class="ruby-value str">&quot;Error: policyurl: Policy URL must be set in a Del Auth non-provisioned scenario. Aborting.&quot;</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">force_delauth_nonprovisioned</span>
253:     <span class="ruby-keyword kw">end</span>
254:     <span class="ruby-ivar">@policyurl</span>
255:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000040">
                    
                    <a name="M000040"></a><b>policyurl=</b>(policyurl)
                    
                </div>
                
                <div class="description">
                  <p>
Sets the privacy policy URL, to which the Windows Live ID consent service
redirects users to view the privacy policy of your Web site for Delegated
Authentication.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000040_source')" id="l_M000040_source">show</a>
                        
                    </p>
                    <div id="M000040_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/omniauth/strategies/windows_live/windowslivelogin.rb, line 239</span>
239:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">policyurl=</span>(<span class="ruby-identifier">policyurl</span>)
240:     <span class="ruby-keyword kw">if</span> ((<span class="ruby-identifier">policyurl</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">policyurl</span>.<span class="ruby-identifier">empty?</span>) <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">force_delauth_nonprovisioned</span>)
241:       <span class="ruby-identifier">fatal</span>(<span class="ruby-value str">&quot;Error: policyurl=: Invalid policy URL specified.&quot;</span>)
242:     <span class="ruby-keyword kw">end</span>
243:     <span class="ruby-ivar">@policyurl</span> = <span class="ruby-identifier">policyurl</span>
244:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000069">
                    
                    <a name="M000069"></a><b>processConsent</b>(query)
                    
                </div>
                
                <div class="description">
                  <p>
Processes the POST response from the Delegated Authentication service after
a user has granted consent. The processConsent function extracts the
consent token string and returns the result of invoking the process<a
href="WindowsLiveLogin/ConsentToken.html">ConsentToken</a> method.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000069_source')" id="l_M000069_source">show</a>
                        
                    </p>
                    <div id="M000069_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/omniauth/strategies/windows_live/windowslivelogin.rb, line 702</span>
702:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">processConsent</span>(<span class="ruby-identifier">query</span>)
703:     <span class="ruby-identifier">query</span> = <span class="ruby-identifier">parse</span> <span class="ruby-identifier">query</span>
704:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">query</span>
705:       <span class="ruby-identifier">debug</span>(<span class="ruby-value str">&quot;Error: processConsent: Failed to parse query.&quot;</span>)
706:       <span class="ruby-keyword kw">return</span>
707:     <span class="ruby-keyword kw">end</span>
708:     <span class="ruby-identifier">action</span> = <span class="ruby-identifier">query</span>[<span class="ruby-value str">'action'</span>]
709:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">action</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'delauth'</span>
710:       <span class="ruby-identifier">debug</span>(<span class="ruby-node">&quot;Warning: processConsent: query action ignored: #{action}.&quot;</span>)
711:       <span class="ruby-keyword kw">return</span>
712:     <span class="ruby-keyword kw">end</span>
713:     <span class="ruby-identifier">responsecode</span> = <span class="ruby-identifier">query</span>[<span class="ruby-value str">'ResponseCode'</span>]
714:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">responsecode</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'RequestApproved'</span>
715:       <span class="ruby-identifier">debug</span>(<span class="ruby-node">&quot;Error: processConsent: Consent was not successfully granted: #{responsecode}&quot;</span>)
716:       <span class="ruby-keyword kw">return</span>
717:     <span class="ruby-keyword kw">end</span>
718:     <span class="ruby-identifier">token</span> = <span class="ruby-identifier">query</span>[<span class="ruby-value str">'ConsentToken'</span>]
719:     <span class="ruby-identifier">context</span> = <span class="ruby-constant">CGI</span>.<span class="ruby-identifier">unescape</span>(<span class="ruby-identifier">query</span>[<span class="ruby-value str">'appctx'</span>]) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">query</span>[<span class="ruby-value str">'appctx'</span>]
720:     <span class="ruby-identifier">processConsentToken</span>(<span class="ruby-identifier">token</span>, <span class="ruby-identifier">context</span>)
721:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000070">
                    
                    <a name="M000070"></a><b>processConsentToken</b>(token, context=nil)
                    
                </div>
                
                <div class="description">
                  <p>
Processes the consent token string that is returned in the POST response by
the Delegated Authentication service after a user has granted consent.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000070_source')" id="l_M000070_source">show</a>
                        
                    </p>
                    <div id="M000070_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/omniauth/strategies/windows_live/windowslivelogin.rb, line 728</span>
728:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">processConsentToken</span>(<span class="ruby-identifier">token</span>, <span class="ruby-identifier">context</span>=<span class="ruby-keyword kw">nil</span>)
729:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">token</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">token</span>.<span class="ruby-identifier">empty?</span>
730:       <span class="ruby-identifier">debug</span>(<span class="ruby-value str">&quot;Error: processConsentToken: Null token.&quot;</span>)
731:       <span class="ruby-keyword kw">return</span>
732:     <span class="ruby-keyword kw">end</span>
733:     <span class="ruby-identifier">decodedtoken</span> = <span class="ruby-identifier">token</span>
734:     <span class="ruby-identifier">parsedtoken</span> = <span class="ruby-identifier">parse</span>(<span class="ruby-constant">CGI</span>.<span class="ruby-identifier">unescape</span>(<span class="ruby-identifier">decodedtoken</span>))
735:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">parsedtoken</span>
736:       <span class="ruby-identifier">debug</span>(<span class="ruby-node">&quot;Error: processConsentToken: Failed to parse token: #{token}&quot;</span>)
737:       <span class="ruby-keyword kw">return</span>
738:     <span class="ruby-keyword kw">end</span>
739:     <span class="ruby-identifier">eact</span> = <span class="ruby-identifier">parsedtoken</span>[<span class="ruby-value str">'eact'</span>]
740:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">eact</span>
741:       <span class="ruby-identifier">decodedtoken</span> = <span class="ruby-identifier">decodeAndValidateToken</span> <span class="ruby-identifier">eact</span>
742:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">decodedtoken</span>
743:         <span class="ruby-identifier">debug</span>(<span class="ruby-node">&quot;Error: processConsentToken: Failed to decode/validate token: #{token}&quot;</span>)
744:         <span class="ruby-keyword kw">return</span>
745:       <span class="ruby-keyword kw">end</span>
746:       <span class="ruby-identifier">parsedtoken</span> = <span class="ruby-identifier">parse</span>(<span class="ruby-identifier">decodedtoken</span>)
747:       <span class="ruby-identifier">decodedtoken</span> = <span class="ruby-constant">CGI</span>.<span class="ruby-identifier">escape</span>(<span class="ruby-identifier">decodedtoken</span>)
748:     <span class="ruby-keyword kw">end</span>
749:     <span class="ruby-keyword kw">begin</span>
750:       <span class="ruby-identifier">consenttoken</span> = <span class="ruby-constant">ConsentToken</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword kw">self</span>,
751:                                       <span class="ruby-identifier">parsedtoken</span>[<span class="ruby-value str">'delt'</span>],
752:                                       <span class="ruby-identifier">parsedtoken</span>[<span class="ruby-value str">'reft'</span>],
753:                                       <span class="ruby-identifier">parsedtoken</span>[<span class="ruby-value str">'skey'</span>],
754:                                       <span class="ruby-identifier">parsedtoken</span>[<span class="ruby-value str">'exp'</span>],
755:                                       <span class="ruby-identifier">parsedtoken</span>[<span class="ruby-value str">'offer'</span>],
756:                                       <span class="ruby-identifier">parsedtoken</span>[<span class="ruby-value str">'lid'</span>],
757:                                       <span class="ruby-identifier">context</span>, <span class="ruby-identifier">decodedtoken</span>, <span class="ruby-identifier">token</span>)
758:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">consenttoken</span>
759:     <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
760:       <span class="ruby-identifier">debug</span>(<span class="ruby-node">&quot;Error: processConsentToken: Contents of token considered invalid: #{e}&quot;</span>)
761:       <span class="ruby-keyword kw">return</span>
762:     <span class="ruby-keyword kw">end</span>
763:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000054">
                    
                    <a name="M000054"></a><b>processLogin</b>(query)
                    
                </div>
                
                <div class="description">
                  <p>
Processes the sign-in response from the Windows Live sign-in server.
</p>
<p>
&#8216;query&#8217; contains the preprocessed POST table, such as that
returned by CGI.params or Rails. (The unprocessed POST string could also be
used here but we do not recommend it).
</p>
<p>
This method returns a <a href="WindowsLiveLogin/User.html">User</a> object
on successful sign-in; otherwise it returns nil.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000054_source')" id="l_M000054_source">show</a>
                        
                    </p>
                    <div id="M000054_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/omniauth/strategies/windows_live/windowslivelogin.rb, line 432</span>
432:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">processLogin</span>(<span class="ruby-identifier">query</span>)
433:     <span class="ruby-identifier">query</span> = <span class="ruby-identifier">parse</span> <span class="ruby-identifier">query</span>
434:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">query</span>
435:       <span class="ruby-identifier">debug</span>(<span class="ruby-value str">&quot;Error: processLogin: Failed to parse query.&quot;</span>)
436:       <span class="ruby-keyword kw">return</span>
437:     <span class="ruby-keyword kw">end</span>
438:     <span class="ruby-identifier">action</span> = <span class="ruby-identifier">query</span>[<span class="ruby-value str">'action'</span>]
439:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">action</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'login'</span>
440:       <span class="ruby-identifier">debug</span>(<span class="ruby-node">&quot;Warning: processLogin: query action ignored: #{action}.&quot;</span>)
441:       <span class="ruby-keyword kw">return</span>
442:     <span class="ruby-keyword kw">end</span>
443:     <span class="ruby-identifier">token</span> = <span class="ruby-identifier">query</span>[<span class="ruby-value str">'stoken'</span>]
444:     <span class="ruby-identifier">context</span> = <span class="ruby-constant">CGI</span>.<span class="ruby-identifier">unescape</span>(<span class="ruby-identifier">query</span>[<span class="ruby-value str">'appctx'</span>]) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">query</span>[<span class="ruby-value str">'appctx'</span>]
445:     <span class="ruby-identifier">processToken</span>(<span class="ruby-identifier">token</span>, <span class="ruby-identifier">context</span>)
446:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000055">
                    
                    <a name="M000055"></a><b>processToken</b>(token, context=nil)
                    
                </div>
                
                <div class="description">
                  <p>
Decodes and validates a Web Authentication token. Returns a <a
href="WindowsLiveLogin/User.html">User</a> object on success. If a context
is passed in, it will be returned as the context field in the <a
href="WindowsLiveLogin/User.html">User</a> object.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000055_source')" id="l_M000055_source">show</a>
                        
                    </p>
                    <div id="M000055_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/omniauth/strategies/windows_live/windowslivelogin.rb, line 453</span>
453:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">processToken</span>(<span class="ruby-identifier">token</span>, <span class="ruby-identifier">context</span>=<span class="ruby-keyword kw">nil</span>)
454:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">token</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">token</span>.<span class="ruby-identifier">empty?</span>
455:       <span class="ruby-identifier">debug</span>(<span class="ruby-value str">&quot;Error: processToken: Null/empty token.&quot;</span>)
456:       <span class="ruby-keyword kw">return</span>
457:     <span class="ruby-keyword kw">end</span>
458:     <span class="ruby-identifier">stoken</span> = <span class="ruby-identifier">decodeAndValidateToken</span> <span class="ruby-identifier">token</span>
459:     <span class="ruby-identifier">stoken</span> = <span class="ruby-identifier">parse</span> <span class="ruby-identifier">stoken</span>
460:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">stoken</span>
461:       <span class="ruby-identifier">debug</span>(<span class="ruby-node">&quot;Error: processToken: Failed to decode/validate token: #{token}&quot;</span>)
462:       <span class="ruby-keyword kw">return</span>
463:     <span class="ruby-keyword kw">end</span>
464:     <span class="ruby-identifier">sappid</span> = <span class="ruby-identifier">stoken</span>[<span class="ruby-value str">'appid'</span>]
465:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">sappid</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">appid</span>
466:       <span class="ruby-identifier">debug</span>(<span class="ruby-node">&quot;Error: processToken: Application ID in token did not match ours: #{sappid}, #{appid}&quot;</span>)
467:       <span class="ruby-keyword kw">return</span>
468:     <span class="ruby-keyword kw">end</span>
469:     <span class="ruby-keyword kw">begin</span>
470:       <span class="ruby-identifier">user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">stoken</span>[<span class="ruby-value str">'ts'</span>], <span class="ruby-identifier">stoken</span>[<span class="ruby-value str">'uid'</span>], <span class="ruby-identifier">stoken</span>[<span class="ruby-value str">'flags'</span>],
471:                       <span class="ruby-identifier">context</span>, <span class="ruby-identifier">token</span>)
472:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">user</span>
473:     <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
474:       <span class="ruby-identifier">debug</span>(<span class="ruby-node">&quot;Error: processToken: Contents of token considered invalid: #{e}&quot;</span>)
475:       <span class="ruby-keyword kw">return</span>
476:     <span class="ruby-keyword kw">end</span>
477:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000071">
                    
                    <a name="M000071"></a><b>refreshConsentToken</b>(consenttoken, ru=nil)
                    
                </div>
                
                <div class="description">
                  <p>
Attempts to obtain a new, refreshed token and return it. The original token
is not modified.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000071_source')" id="l_M000071_source">show</a>
                        
                    </p>
                    <div id="M000071_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/omniauth/strategies/windows_live/windowslivelogin.rb, line 769</span>
769:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">refreshConsentToken</span>(<span class="ruby-identifier">consenttoken</span>, <span class="ruby-identifier">ru</span>=<span class="ruby-keyword kw">nil</span>)
770:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">consenttoken</span>.<span class="ruby-identifier">nil?</span>
771:       <span class="ruby-identifier">debug</span>(<span class="ruby-value str">&quot;Error: refreshConsentToken: Null consent token.&quot;</span>)
772:       <span class="ruby-keyword kw">return</span>
773:     <span class="ruby-keyword kw">end</span>
774:     <span class="ruby-identifier">refreshConsentToken2</span>(<span class="ruby-identifier">consenttoken</span>.<span class="ruby-identifier">offers_string</span>, <span class="ruby-identifier">consenttoken</span>.<span class="ruby-identifier">refreshtoken</span>, <span class="ruby-identifier">ru</span>)
775:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000072">
                    
                    <a name="M000072"></a><b>refreshConsentToken2</b>(offers_string, refreshtoken, ru=nil)
                    
                </div>
                
                <div class="description">
                  <p>
Helper function to obtain a new, refreshed token and return it. The
original token is not modified.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000072_source')" id="l_M000072_source">show</a>
                        
                    </p>
                    <div id="M000072_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/omniauth/strategies/windows_live/windowslivelogin.rb, line 781</span>
781:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">refreshConsentToken2</span>(<span class="ruby-identifier">offers_string</span>, <span class="ruby-identifier">refreshtoken</span>, <span class="ruby-identifier">ru</span>=<span class="ruby-keyword kw">nil</span>)
782:     <span class="ruby-identifier">url</span> = <span class="ruby-keyword kw">nil</span>
783:     <span class="ruby-keyword kw">begin</span>
784:       <span class="ruby-identifier">url</span> = <span class="ruby-identifier">getRefreshConsentTokenUrl</span>(<span class="ruby-identifier">offers_string</span>, <span class="ruby-identifier">refreshtoken</span>, <span class="ruby-identifier">ru</span>)
785:       <span class="ruby-identifier">ret</span> = <span class="ruby-identifier">fetch</span> <span class="ruby-identifier">url</span>
786:       <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">value</span> <span class="ruby-comment cmt"># raises exception if fetch failed</span>
787:       <span class="ruby-identifier">body</span> = <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">body</span>
788:       <span class="ruby-identifier">body</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\{&quot;ConsentToken&quot;:&quot;(.*)&quot;\}/</span>){<span class="ruby-operator">|</span><span class="ruby-identifier">match</span><span class="ruby-operator">|</span>
789:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">processConsentToken</span>(<span class="ruby-node">&quot;#{match}&quot;</span>)
790:       }
791:       <span class="ruby-identifier">debug</span>(<span class="ruby-node">&quot;Error: refreshConsentToken2: Failed to extract token: #{body}&quot;</span>)
792:     <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
793:       <span class="ruby-identifier">debug</span>(<span class="ruby-node">&quot;Error: Failed to refresh consent token: #{e}&quot;</span>)
794:     <span class="ruby-keyword kw">end</span>
795:     <span class="ruby-keyword kw">return</span>
796:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000043">
                    
                    <a name="M000043"></a><b>returnurl</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Returns the return URL of your site.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000043_source')" id="l_M000043_source">show</a>
                        
                    </p>
                    <div id="M000043_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/omniauth/strategies/windows_live/windowslivelogin.rb, line 275</span>
275:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">returnurl</span>
276:     <span class="ruby-keyword kw">if</span> ((<span class="ruby-ivar">@returnurl</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@returnurl</span>.<span class="ruby-identifier">empty?</span>) <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">force_delauth_nonprovisioned</span>)
277:       <span class="ruby-identifier">fatal</span>(<span class="ruby-value str">&quot;Error: returnurl: Return URL must be set in a Del Auth non-provisioned scenario. Aborting.&quot;</span>)
278:     <span class="ruby-keyword kw">end</span>
279:     <span class="ruby-ivar">@returnurl</span>
280:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000042">
                    
                    <a name="M000042"></a><b>returnurl=</b>(returnurl)
                    
                </div>
                
                <div class="description">
                  <p>
Sets the return URL&#8212;the URL on your site to which the consent service
redirects users (along with the action, consent token, and application
context) after they have successfully provided consent information for
Delegated Authentication. This value will override the return URL specified
during registration.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000042_source')" id="l_M000042_source">show</a>
                        
                    </p>
                    <div id="M000042_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/omniauth/strategies/windows_live/windowslivelogin.rb, line 264</span>
264:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">returnurl=</span>(<span class="ruby-identifier">returnurl</span>)
265:     <span class="ruby-keyword kw">if</span> ((<span class="ruby-identifier">returnurl</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">returnurl</span>.<span class="ruby-identifier">empty?</span>) <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">force_delauth_nonprovisioned</span>)
266:       <span class="ruby-identifier">fatal</span>(<span class="ruby-value str">&quot;Error: returnurl=: Invalid return URL specified.&quot;</span>)
267:     <span class="ruby-keyword kw">end</span>
268:     <span class="ruby-ivar">@returnurl</span> = <span class="ruby-identifier">returnurl</span>
269:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000034">
                    
                    <a name="M000034"></a><b>secret=</b>(secret)
                    
                </div>
                
                <div class="description">
                  <p>
Sets your secret key. Use this method if you did not specify a secret key
at initialization.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000034_source')" id="l_M000034_source">show</a>
                        
                    </p>
                    <div id="M000034_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/omniauth/strategies/windows_live/windowslivelogin.rb, line 158</span>
158:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">secret=</span>(<span class="ruby-identifier">secret</span>)
159:     <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">secret</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">secret</span>.<span class="ruby-identifier">empty?</span>)
160:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">force_delauth_nonprovisioned</span>
161:       <span class="ruby-identifier">fatal</span>(<span class="ruby-value str">&quot;Error: secret=: Secret must be non-null.&quot;</span>)
162:     <span class="ruby-keyword kw">end</span>
163:     <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">secret</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">16</span>)
164:       <span class="ruby-identifier">fatal</span>(<span class="ruby-value str">&quot;Error: secret=: Secret must be at least 16 characters.&quot;</span>)
165:     <span class="ruby-keyword kw">end</span>
166:     <span class="ruby-ivar">@signkey</span> = <span class="ruby-identifier">derive</span>(<span class="ruby-identifier">secret</span>, <span class="ruby-value str">&quot;SIGNATURE&quot;</span>)
167:     <span class="ruby-ivar">@cryptkey</span> = <span class="ruby-identifier">derive</span>(<span class="ruby-identifier">secret</span>, <span class="ruby-value str">&quot;ENCRYPTION&quot;</span>)
168:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000045">
                    
                    <a name="M000045"></a><b>secureurl</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000045_source')" id="l_M000045_source">show</a>
                        
                    </p>
                    <div id="M000045_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/omniauth/strategies/windows_live/windowslivelogin.rb, line 304</span>
304:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">secureurl</span>
305:     <span class="ruby-keyword kw">if</span>(<span class="ruby-ivar">@secureurl</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@secureurl</span>.<span class="ruby-identifier">empty?</span>)
306:       <span class="ruby-value str">&quot;https://login.live.com/&quot;</span>
307:     <span class="ruby-keyword kw">else</span>
308:       <span class="ruby-ivar">@secureurl</span>
309:     <span class="ruby-keyword kw">end</span>
310:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000039">
                    
                    <a name="M000039"></a><b>securityalgorithm</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000039_source')" id="l_M000039_source">show</a>
                        
                    </p>
                    <div id="M000039_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/omniauth/strategies/windows_live/windowslivelogin.rb, line 219</span>
219:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">securityalgorithm</span>
220:     <span class="ruby-keyword kw">if</span>(<span class="ruby-ivar">@securityalgorithm</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@securityalgorithm</span>.<span class="ruby-identifier">empty?</span>)
221:       <span class="ruby-value str">&quot;wsignin1.0&quot;</span>
222:     <span class="ruby-keyword kw">else</span>
223:       <span class="ruby-ivar">@securityalgorithm</span>
224:     <span class="ruby-keyword kw">end</span>
225:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000022">
                    
                    <a name="M000022"></a><b>setDebug</b>(flag)
                    
                </div>
                
                <div class="description">
                  <p>
Stub implementation for logging errors. If you want to enable debugging
output using the default mechanism, specify true. By default, debug
information will be printed to the standard error output and should be
visible in the web server logs.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000022_source')" id="l_M000022_source">show</a>
                        
                    </p>
                    <div id="M000022_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/omniauth/strategies/windows_live/windowslivelogin.rb, line 29</span>
29:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">setDebug</span>(<span class="ruby-identifier">flag</span>)
30:     <span class="ruby-ivar">@debug</span> = <span class="ruby-identifier">flag</span>
31:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000075">
                    
                    <a name="M000075"></a><b>signToken</b>(token, signkey=@signkey)
                    
                </div>
                
                <div class="description">
                  <p>
Creates a signature for the given string by using the signature key.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000075_source')" id="l_M000075_source">show</a>
                        
                    </p>
                    <div id="M000075_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/omniauth/strategies/windows_live/windowslivelogin.rb, line 859</span>
859:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">signToken</span>(<span class="ruby-identifier">token</span>, <span class="ruby-identifier">signkey</span>=<span class="ruby-ivar">@signkey</span>)
860:     <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">signkey</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">signkey</span>.<span class="ruby-identifier">empty?</span>)
861:       <span class="ruby-identifier">fatal</span>(<span class="ruby-value str">&quot;Error: signToken: Secret key was not set. Aborting.&quot;</span>)
862:     <span class="ruby-keyword kw">end</span>
863:     <span class="ruby-keyword kw">begin</span>
864:       <span class="ruby-identifier">digest</span> = <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">Digest</span><span class="ruby-operator">::</span><span class="ruby-constant">SHA256</span>.<span class="ruby-identifier">new</span>
865:       <span class="ruby-keyword kw">return</span> <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">HMAC</span>.<span class="ruby-identifier">digest</span>(<span class="ruby-identifier">digest</span>, <span class="ruby-identifier">signkey</span>, <span class="ruby-identifier">token</span>)
866:     <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
867:       <span class="ruby-identifier">debug</span>(<span class="ruby-node">&quot;Error: signToken: Signing failed: #{token}, #{e}&quot;</span>)
868:       <span class="ruby-keyword kw">return</span>
869:     <span class="ruby-keyword kw">end</span>
870:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000088">
                    
                    <a name="M000088"></a><b>timestamp</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Generates a time stamp suitable for the application verifier token.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000088_source')" id="l_M000088_source">show</a>
                        
                    </p>
                    <div id="M000088_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/omniauth/strategies/windows_live/windowslivelogin.rb, line 1113</span>
1113:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">timestamp</span>
1114:     <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">to_i</span>.<span class="ruby-identifier">to_s</span>
1115:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000090">
                    
                    <a name="M000090"></a><b>u64</b>(s)
                    
                </div>
                
                <div class="description">
                  <p>
URL-unescapes and Base64-decodes a string.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000090_source')" id="l_M000090_source">show</a>
                        
                    </p>
                    <div id="M000090_source" class="dyn-source">
                        <pre>      <span class="ruby-comment cmt"># File lib/omniauth/strategies/windows_live/windowslivelogin.rb, line 1128</span>
1128:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">u64</span>(<span class="ruby-identifier">s</span>)
1129:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">s</span>
1130:     <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">decode64</span> <span class="ruby-constant">CGI</span>.<span class="ruby-identifier">unescape</span>(<span class="ruby-identifier">s</span>)
1131:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000076">
                    
                    <a name="M000076"></a><b>validateToken</b>(token, signkey=@signkey)
                    
                </div>
                
                <div class="description">
                  <p>
Extracts the signature from the token and validates it.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000076_source')" id="l_M000076_source">show</a>
                        
                    </p>
                    <div id="M000076_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/omniauth/strategies/windows_live/windowslivelogin.rb, line 875</span>
875:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">validateToken</span>(<span class="ruby-identifier">token</span>, <span class="ruby-identifier">signkey</span>=<span class="ruby-ivar">@signkey</span>)
876:     <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">token</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">token</span>.<span class="ruby-identifier">empty?</span>)
877:       <span class="ruby-identifier">debug</span>(<span class="ruby-value str">&quot;Error: validateToken: Null token.&quot;</span>)
878:       <span class="ruby-keyword kw">return</span>
879:     <span class="ruby-keyword kw">end</span>
880:     <span class="ruby-identifier">body</span>, <span class="ruby-identifier">sig</span> = <span class="ruby-identifier">token</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;&amp;sig=&quot;</span>)
881:     <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">body</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">sig</span>.<span class="ruby-identifier">nil?</span>)
882:       <span class="ruby-identifier">debug</span>(<span class="ruby-node">&quot;Error: validateToken: Invalid token: #{token}&quot;</span>)
883:       <span class="ruby-keyword kw">return</span>
884:     <span class="ruby-keyword kw">end</span>
885:     <span class="ruby-identifier">sig</span> = <span class="ruby-identifier">u64</span>(<span class="ruby-identifier">sig</span>)
886:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">token</span> <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">sig</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">signToken</span>(<span class="ruby-identifier">body</span>, <span class="ruby-identifier">signkey</span>))
887:     <span class="ruby-identifier">debug</span>(<span class="ruby-value str">&quot;Error: validateToken: Signature did not match.&quot;</span>)
888:     <span class="ruby-keyword kw">return</span>
889:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    