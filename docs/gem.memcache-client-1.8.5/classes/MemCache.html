<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>MemCache</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen" />
    <script src="../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Class</span> 
            MemCache 
            
                <span class="parent">&lt; 
                    
                    Object
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../files/lib/memcache/event_machine_rb.html">lib/memcache/event_machine.rb</a></li>
            
            <li><a href="../files/lib/memcache/version_rb.html">lib/memcache/version.rb</a></li>
            
            <li><a href="../files/lib/memcache_rb.html">lib/memcache.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    
    <div class="description">
        <p>
A Ruby client library for memcached.
</p>

    </div>
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>#</dt>
        <dd>
            <ul>
                
                <li><a href="#M000041">[]</a>,</li>
                
                <li><a href="#M000042">[]=</a></li>
                
            </ul>
        </dd>
    
        <dt>A</dt>
        <dd>
            <ul>
                
                <li><a href="#M000023">active?</a>,</li>
                
                <li><a href="#M000033">add</a>,</li>
                
                <li><a href="#M000035">append</a></li>
                
            </ul>
        </dd>
    
        <dt>C</dt>
        <dd>
            <ul>
                
                <li><a href="#M000047">cache_decr</a>,</li>
                
                <li><a href="#M000048">cache_get</a>,</li>
                
                <li><a href="#M000050">cache_get_multi</a>,</li>
                
                <li><a href="#M000051">cache_incr</a>,</li>
                
                <li><a href="#M000032">cas</a>,</li>
                
                <li><a href="#M000060">check_multithread_status!</a>,</li>
                
                <li><a href="#M000058">create_continuum_for</a></li>
                
            </ul>
        </dd>
    
        <dt>D</dt>
        <dd>
            <ul>
                
                <li><a href="#M000026">decr</a>,</li>
                
                <li><a href="#M000037">delete</a></li>
                
            </ul>
        </dd>
    
        <dt>E</dt>
        <dd>
            <ul>
                
                <li><a href="#M000059">entry_count_for</a></li>
                
            </ul>
        </dd>
    
        <dt>F</dt>
        <dd>
            <ul>
                
                <li><a href="#M000028">fetch</a>,</li>
                
                <li><a href="#M000038">flush_all</a></li>
                
            </ul>
        </dd>
    
        <dt>G</dt>
        <dd>
            <ul>
                
                <li><a href="#M000027">get</a>,</li>
                
                <li><a href="#M000029">get_multi</a>,</li>
                
                <li><a href="#M000046">get_server_for_key</a>,</li>
                
                <li><a href="#M000049">gets</a></li>
                
            </ul>
        </dd>
    
        <dt>H</dt>
        <dd>
            <ul>
                
                <li><a href="#M000054">handle_error</a>,</li>
                
                <li><a href="#M000045">hash_for</a></li>
                
            </ul>
        </dd>
    
        <dt>I</dt>
        <dd>
            <ul>
                
                <li><a href="#M000030">incr</a>,</li>
                
                <li><a href="#M000022">inspect</a></li>
                
            </ul>
        </dd>
    
        <dt>K</dt>
        <dd>
            <ul>
                
                <li><a href="#M000044">key_length</a></li>
                
            </ul>
        </dd>
    
        <dt>M</dt>
        <dd>
            <ul>
                
                <li><a href="#M000043">make_cache_key</a></li>
                
            </ul>
        </dd>
    
        <dt>N</dt>
        <dd>
            <ul>
                
                <li><a href="#M000021">new</a>,</li>
                
                <li><a href="#M000055">noreply</a></li>
                
            </ul>
        </dd>
    
        <dt>P</dt>
        <dd>
            <ul>
                
                <li><a href="#M000036">prepend</a></li>
                
            </ul>
        </dd>
    
        <dt>R</dt>
        <dd>
            <ul>
                
                <li><a href="#M000057">raise_on_error_response!</a>,</li>
                
                <li><a href="#M000024">readonly?</a>,</li>
                
                <li><a href="#M000034">replace</a>,</li>
                
                <li><a href="#M000056">request_setup</a>,</li>
                
                <li><a href="#M000039">reset</a></li>
                
            </ul>
        </dd>
    
        <dt>S</dt>
        <dd>
            <ul>
                
                <li><a href="#M000025">servers=</a>,</li>
                
                <li><a href="#M000031">set</a>,</li>
                
                <li><a href="#M000040">stats</a></li>
                
            </ul>
        </dd>
    
        <dt>W</dt>
        <dd>
            <ul>
                
                <li><a href="#M000053">with_server</a>,</li>
                
                <li><a href="#M000052">with_socket_management</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    

    

    
    <div class="sectiontitle">Classes and Modules</div>
    <ul>
        
        <li><span class="type">MODULE</span> <a href="MemCache/EventedServer.html">MemCache::EventedServer</a></li>
        
        <li><span class="type">CLASS</span> <a href="MemCache/BufferedIO.html">MemCache::BufferedIO</a></li>
        
        <li><span class="type">CLASS</span> <a href="MemCache/MemCacheError.html">MemCache::MemCacheError</a></li>
        
        <li><span class="type">CLASS</span> <a href="MemCache/Server.html">MemCache::Server</a></li>
        
    </ul>
    

    
    <div class="sectiontitle">Constants</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class="attr-name">VERSION</td>
            <td>=</td>
            <td class="attr-value">&quot;1.8.5&quot;</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
The version of <a href="MemCache.html">MemCache</a> you are using.
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">DEFAULT_OPTIONS</td>
            <td>=</td>
            <td class="attr-value">{     :namespace    =&gt; nil,     :readonly     =&gt; false,     :multithread  =&gt; true,     :failover     =&gt; true,     :timeout      =&gt; 0.5,     :logger       =&gt; nil,     :no_reply     =&gt; false,     :check_size   =&gt; true,     :autofix_keys =&gt; false,     :namespace_separator =&gt; ':',   }</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
Default options for the cache object.
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">DEFAULT_PORT</td>
            <td>=</td>
            <td class="attr-value">11211</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
Default memcached port.
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">DEFAULT_WEIGHT</td>
            <td>=</td>
            <td class="attr-value">1</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
Default memcached server weight.
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">ONE_MB</td>
            <td>=</td>
            <td class="attr-value">1024 * 1024</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
Add <tt>key</tt> to the cache with value <tt>value</tt> that expires in
<tt>expiry</tt> seconds. If <tt>raw</tt> is true, <tt>value</tt> will not
be Marshalled.
</p>
<p>
Warning: Readers should not call this method in the event of a cache miss;
see <a href="MemCache.html#M000033">MemCache#add</a>.
</p>
</td>
        </tr>
        
        
    </table>
    

    
    <div class="sectiontitle">Attributes</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>namespace</td>
            <td class='attr-desc'><p>
The namespace for this instance
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>multithread</td>
            <td class='attr-desc'><p>
The multithread setting for this instance
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>autofix_keys</td>
            <td class='attr-desc'><p>
Whether to try to fix keys that are too long and will be truncated by using
their SHA1 hash instead. The hash is only used on keys longer than 250
characters, or containing spaces, to avoid impacting performance
unnecesarily.
</p>
<p>
In theory, your code should generate correct keys when calling memcache, so
it&#8217;s your responsibility and you should try to fix this problem at
its source.
</p>
<p>
But if that&#8217;s not possible, enable this option and memcache-client
will give you a hand.
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>servers</td>
            <td class='attr-desc'><p>
The servers this client talks to. Play at your own peril.
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>timeout</td>
            <td class='attr-desc'><p>
Socket timeout limit with this client, defaults to 0.5 sec. Set to nil to
disable timeouts.
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>failover</td>
            <td class='attr-desc'><p>
Should the client try to failover to another server if the first server is
down? Defaults to true.
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>logger</td>
            <td class='attr-desc'><p>
Log debug/info/warn/error to the given Logger, defaults to nil.
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>no_reply</td>
            <td class='attr-desc'><p>
Don&#8217;t send or look for a reply from the memcached server for write
operations. Please note this feature only works in memcached 1.2.5 and
later. Earlier versions will reply with &#8220;ERROR&#8221;.
</p></td>
        </tr>
        
    </table>
    

    
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M000041">
                    
                    <a name="M000041"></a><b>[]</b>(key, raw = false)
                    
                </div>
                
                <div class="description">
                  <p>
Alias for <a href="MemCache.html#M000027">get</a>
</p>

                </div>
                
                
                
            </div>
            
            <div class="method">
                <div class="title" id="M000042">
                    
                    <a name="M000042"></a><b>[]=</b>(key, value)
                    
                </div>
                
                <div class="description">
                  <p>
Shortcut to save a value in the cache. This method does not set an
expiration on the entry. Use set to specify an explicit expiry.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000042_source')" id="l_M000042_source">show</a>
                        
                    </p>
                    <div id="M000042_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/memcache.rb, line 659</span>
659:   <span class="ruby-keyword kw">def</span> <span class="ruby-operator">[]=</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span>)
660:     <span class="ruby-identifier">set</span> <span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span>
661:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000023">
                    
                    <a name="M000023"></a><b>active?</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Returns whether there is at least one active server for the object.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000023_source')" id="l_M000023_source">show</a>
                        
                    </p>
                    <div id="M000023_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/memcache.rb, line 189</span>
189:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">active?</span>
190:     <span class="ruby-keyword kw">not</span> <span class="ruby-ivar">@servers</span>.<span class="ruby-identifier">empty?</span>
191:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000033">
                    
                    <a name="M000033"></a><b>add</b>(key, value, expiry = 0, raw = false)
                    
                </div>
                
                <div class="description">
                  <p>
Add <tt>key</tt> to the cache with value <tt>value</tt> that expires in
<tt>expiry</tt> seconds, but only if <tt>key</tt> does not already exist in
the cache. If <tt>raw</tt> is true, <tt>value</tt> will not be Marshalled.
</p>
<p>
Readers should call this method in the event of a cache miss, not <a
href="MemCache.html#M000031">MemCache#set</a>.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000033_source')" id="l_M000033_source">show</a>
                        
                    </p>
                    <div id="M000033_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/memcache.rb, line 438</span>
438:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span>, <span class="ruby-identifier">expiry</span> = <span class="ruby-value">0</span>, <span class="ruby-identifier">raw</span> = <span class="ruby-keyword kw">false</span>)
439:     <span class="ruby-identifier">raise</span> <span class="ruby-constant">MemCacheError</span>, <span class="ruby-value str">&quot;Update of readonly cache&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@readonly</span>
440:     <span class="ruby-identifier">value</span> = <span class="ruby-constant">Marshal</span>.<span class="ruby-identifier">dump</span> <span class="ruby-identifier">value</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">raw</span>
441:     <span class="ruby-identifier">with_server</span>(<span class="ruby-identifier">key</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">server</span>, <span class="ruby-identifier">cache_key</span><span class="ruby-operator">|</span>
442:       <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">debug</span> { <span class="ruby-node">&quot;add #{key} to #{server}: #{value ? value.to_s.size : 'nil'}&quot;</span> } <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">logger</span>
443:       <span class="ruby-identifier">command</span> = <span class="ruby-node">&quot;add #{cache_key} 0 #{expiry} #{value.to_s.size}#{noreply}\r\n#{value}\r\n&quot;</span>
444: 
445:       <span class="ruby-identifier">with_socket_management</span>(<span class="ruby-identifier">server</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">socket</span><span class="ruby-operator">|</span>
446:         <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">write</span> <span class="ruby-identifier">command</span>
447:         <span class="ruby-keyword kw">break</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@no_reply</span>
448:         <span class="ruby-identifier">result</span> = <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">gets</span>
449:         <span class="ruby-identifier">raise_on_error_response!</span> <span class="ruby-identifier">result</span>
450:         <span class="ruby-identifier">result</span>
451:       <span class="ruby-keyword kw">end</span>
452:     <span class="ruby-keyword kw">end</span>
453:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000035">
                    
                    <a name="M000035"></a><b>append</b>(key, value)
                    
                </div>
                
                <div class="description">
                  <p>
Append - &#8216;add this data to an existing key after existing data&#8217;
Please note the value is always passed to memcached as raw since it
doesn&#8217;t make a lot of sense to concatenate marshalled data together.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000035_source')" id="l_M000035_source">show</a>
                        
                    </p>
                    <div id="M000035_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/memcache.rb, line 480</span>
480:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">append</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span>)
481:     <span class="ruby-identifier">raise</span> <span class="ruby-constant">MemCacheError</span>, <span class="ruby-value str">&quot;Update of readonly cache&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@readonly</span>
482:     <span class="ruby-identifier">with_server</span>(<span class="ruby-identifier">key</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">server</span>, <span class="ruby-identifier">cache_key</span><span class="ruby-operator">|</span>
483:       <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">debug</span> { <span class="ruby-node">&quot;append #{key} to #{server}: #{value ? value.to_s.size : 'nil'}&quot;</span> } <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">logger</span>
484:       <span class="ruby-identifier">command</span> = <span class="ruby-node">&quot;append #{cache_key} 0 0 #{value.to_s.size}#{noreply}\r\n#{value}\r\n&quot;</span>
485: 
486:       <span class="ruby-identifier">with_socket_management</span>(<span class="ruby-identifier">server</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">socket</span><span class="ruby-operator">|</span>
487:         <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">write</span> <span class="ruby-identifier">command</span>
488:         <span class="ruby-keyword kw">break</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@no_reply</span>
489:         <span class="ruby-identifier">result</span> = <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">gets</span>
490:         <span class="ruby-identifier">raise_on_error_response!</span> <span class="ruby-identifier">result</span>
491:         <span class="ruby-identifier">result</span>
492:       <span class="ruby-keyword kw">end</span>
493:     <span class="ruby-keyword kw">end</span>
494:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000032">
                    
                    <a name="M000032"></a><b>cas</b>(key, expiry=0, raw=false)
                    
                </div>
                
                <div class="description">
                  <p>
&#8220;cas&#8221; is a check and set operation which means &#8220;store
this data but only if no one else has updated since I last fetched
it.&#8221; This can be used as a form of optimistic locking.
</p>
<p>
Works in block form like so:
</p>
<pre>
  cache.cas('some-key') do |value|
    value + 1
  end
</pre>
<p>
Returns: <tt>nil</tt> if the value was not found on the memcached server.
<tt>STORED</tt> if the value was updated successfully <tt>EXISTS</tt> if
the value was updated by someone else since last fetch
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000032_source')" id="l_M000032_source">show</a>
                        
                    </p>
                    <div id="M000032_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/memcache.rb, line 401</span>
401:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">cas</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">expiry</span>=<span class="ruby-value">0</span>, <span class="ruby-identifier">raw</span>=<span class="ruby-keyword kw">false</span>)
402:     <span class="ruby-identifier">raise</span> <span class="ruby-constant">MemCacheError</span>, <span class="ruby-value str">&quot;Update of readonly cache&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@readonly</span>
403:     <span class="ruby-identifier">raise</span> <span class="ruby-constant">MemCacheError</span>, <span class="ruby-value str">&quot;A block is required&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">block_given?</span>
404: 
405:     (<span class="ruby-identifier">value</span>, <span class="ruby-identifier">token</span>) = <span class="ruby-identifier">gets</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">raw</span>)
406:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">value</span>
407:     <span class="ruby-identifier">updated</span> = <span class="ruby-keyword kw">yield</span> <span class="ruby-identifier">value</span>
408:     <span class="ruby-identifier">value</span> = <span class="ruby-identifier">raw</span> <span class="ruby-value">? </span><span class="ruby-identifier">updated</span> <span class="ruby-operator">:</span> <span class="ruby-constant">Marshal</span>.<span class="ruby-identifier">dump</span>(<span class="ruby-identifier">updated</span>)
409: 
410:     <span class="ruby-identifier">with_server</span>(<span class="ruby-identifier">key</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">server</span>, <span class="ruby-identifier">cache_key</span><span class="ruby-operator">|</span>
411:       <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">debug</span> { <span class="ruby-node">&quot;cas #{key} to #{server.inspect}: #{value.to_s.size}&quot;</span> } <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">logger</span>
412:       <span class="ruby-identifier">command</span> = <span class="ruby-node">&quot;cas #{cache_key} 0 #{expiry} #{value.to_s.size} #{token}#{noreply}\r\n#{value}\r\n&quot;</span>
413: 
414:       <span class="ruby-identifier">with_socket_management</span>(<span class="ruby-identifier">server</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">socket</span><span class="ruby-operator">|</span>
415:         <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">write</span> <span class="ruby-identifier">command</span>
416:         <span class="ruby-keyword kw">break</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@no_reply</span>
417:         <span class="ruby-identifier">result</span> = <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">gets</span>
418:         <span class="ruby-identifier">raise_on_error_response!</span> <span class="ruby-identifier">result</span>
419: 
420:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">result</span>.<span class="ruby-identifier">nil?</span>
421:           <span class="ruby-identifier">server</span>.<span class="ruby-identifier">close</span>
422:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">MemCacheError</span>, <span class="ruby-node">&quot;lost connection to #{server.host}:#{server.port}&quot;</span>
423:         <span class="ruby-keyword kw">end</span>
424: 
425:         <span class="ruby-identifier">result</span>
426:       <span class="ruby-keyword kw">end</span>
427:     <span class="ruby-keyword kw">end</span>
428:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000026">
                    
                    <a name="M000026"></a><b>decr</b>(key, amount = 1)
                    
                </div>
                
                <div class="description">
                  <p>
Decrements the value for <tt>key</tt> by <tt>amount</tt> and returns the
new value. <tt>key</tt> must already exist. If <tt>key</tt> is not an
integer, it is assumed to be
</p>
<ol>
<li><tt>key</tt> can not be decremented below 0.

</li>
</ol>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000026_source')" id="l_M000026_source">show</a>
                        
                    </p>
                    <div id="M000026_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/memcache.rb, line 232</span>
232:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">decr</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">amount</span> = <span class="ruby-value">1</span>)
233:     <span class="ruby-identifier">raise</span> <span class="ruby-constant">MemCacheError</span>, <span class="ruby-value str">&quot;Update of readonly cache&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@readonly</span>
234:     <span class="ruby-identifier">with_server</span>(<span class="ruby-identifier">key</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">server</span>, <span class="ruby-identifier">cache_key</span><span class="ruby-operator">|</span>
235:       <span class="ruby-identifier">cache_decr</span> <span class="ruby-identifier">server</span>, <span class="ruby-identifier">cache_key</span>, <span class="ruby-identifier">amount</span>
236:     <span class="ruby-keyword kw">end</span>
237:   <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">TypeError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">err</span>
238:     <span class="ruby-identifier">handle_error</span> <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">err</span>
239:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000037">
                    
                    <a name="M000037"></a><b>delete</b>(key, expiry = 0)
                    
                </div>
                
                <div class="description">
                  <p>
Removes <tt>key</tt> from the cache. <tt>expiry</tt> is ignored as it has
been removed from the latest memcached version.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000037_source')" id="l_M000037_source">show</a>
                        
                    </p>
                    <div id="M000037_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/memcache.rb, line 520</span>
520:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">delete</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">expiry</span> = <span class="ruby-value">0</span>)
521:     <span class="ruby-identifier">raise</span> <span class="ruby-constant">MemCacheError</span>, <span class="ruby-value str">&quot;Update of readonly cache&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@readonly</span>
522:     <span class="ruby-identifier">with_server</span>(<span class="ruby-identifier">key</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">server</span>, <span class="ruby-identifier">cache_key</span><span class="ruby-operator">|</span>
523:       <span class="ruby-identifier">with_socket_management</span>(<span class="ruby-identifier">server</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">socket</span><span class="ruby-operator">|</span>
524:         <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">debug</span> { <span class="ruby-node">&quot;delete #{cache_key} on #{server}&quot;</span> } <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">logger</span>
525:         <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">write</span> <span class="ruby-node">&quot;delete #{cache_key}#{noreply}\r\n&quot;</span>
526:         <span class="ruby-keyword kw">break</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@no_reply</span>
527:         <span class="ruby-identifier">result</span> = <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">gets</span>
528:         <span class="ruby-identifier">raise_on_error_response!</span> <span class="ruby-identifier">result</span>
529:         <span class="ruby-identifier">result</span>
530:       <span class="ruby-keyword kw">end</span>
531:     <span class="ruby-keyword kw">end</span>
532:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000028">
                    
                    <a name="M000028"></a><b>fetch</b>(key, expiry = 0, raw = false)
                    
                </div>
                
                <div class="description">
                  <p>
Performs a <tt>get</tt> with the given <tt>key</tt>. If the value does not
exist and a block was given, the block will be called and the result saved
via <tt>add</tt>.
</p>
<p>
If you do not provide a block, using this method is the same as using
<tt>get</tt>.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000028_source')" id="l_M000028_source">show</a>
                        
                    </p>
                    <div id="M000028_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/memcache.rb, line 265</span>
265:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">fetch</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">expiry</span> = <span class="ruby-value">0</span>, <span class="ruby-identifier">raw</span> = <span class="ruby-keyword kw">false</span>)
266:     <span class="ruby-identifier">value</span> = <span class="ruby-identifier">get</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">raw</span>)
267: 
268:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">block_given?</span>
269:       <span class="ruby-identifier">value</span> = <span class="ruby-keyword kw">yield</span>
270:       <span class="ruby-identifier">add</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span>, <span class="ruby-identifier">expiry</span>, <span class="ruby-identifier">raw</span>)
271:     <span class="ruby-keyword kw">end</span>
272: 
273:     <span class="ruby-identifier">value</span>
274:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000038">
                    
                    <a name="M000038"></a><b>flush_all</b>(delay=0)
                    
                </div>
                
                <div class="description">
                  <p>
Flush the cache from all memcache servers. A non-zero value for
<tt>delay</tt> will ensure that the flush is propogated slowly through your
memcached server farm. The Nth server will be flushed N*delay seconds from
now, asynchronously so this method returns quickly. This prevents a huge
database spike due to a total flush all at once.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000038_source')" id="l_M000038_source">show</a>
                        
                    </p>
                    <div id="M000038_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/memcache.rb, line 543</span>
543:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">flush_all</span>(<span class="ruby-identifier">delay</span>=<span class="ruby-value">0</span>)
544:     <span class="ruby-identifier">raise</span> <span class="ruby-constant">MemCacheError</span>, <span class="ruby-value str">'No active servers'</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">active?</span>
545:     <span class="ruby-identifier">raise</span> <span class="ruby-constant">MemCacheError</span>, <span class="ruby-value str">&quot;Update of readonly cache&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@readonly</span>
546: 
547:     <span class="ruby-keyword kw">begin</span>
548:       <span class="ruby-identifier">delay_time</span> = <span class="ruby-value">0</span>
549:       <span class="ruby-ivar">@servers</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">server</span><span class="ruby-operator">|</span>
550:         <span class="ruby-identifier">with_socket_management</span>(<span class="ruby-identifier">server</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">socket</span><span class="ruby-operator">|</span>
551:           <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">debug</span> { <span class="ruby-node">&quot;flush_all #{delay_time} on #{server}&quot;</span> } <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">logger</span>
552:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">delay</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-comment cmt"># older versions of memcached will fail silently otherwise</span>
553:             <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">write</span> <span class="ruby-node">&quot;flush_all#{noreply}\r\n&quot;</span>
554:           <span class="ruby-keyword kw">else</span>
555:             <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">write</span> <span class="ruby-node">&quot;flush_all #{delay_time}#{noreply}\r\n&quot;</span>
556:           <span class="ruby-keyword kw">end</span>
557:           <span class="ruby-keyword kw">break</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@no_reply</span>
558:           <span class="ruby-identifier">result</span> = <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">gets</span>
559:           <span class="ruby-identifier">raise_on_error_response!</span> <span class="ruby-identifier">result</span>
560:           <span class="ruby-identifier">result</span>
561:         <span class="ruby-keyword kw">end</span>
562:         <span class="ruby-identifier">delay_time</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">delay</span>
563:       <span class="ruby-keyword kw">end</span>
564:     <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">IndexError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">err</span>
565:       <span class="ruby-identifier">handle_error</span> <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">err</span>
566:     <span class="ruby-keyword kw">end</span>
567:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000027">
                    
                    <a name="M000027"></a><b>get</b>(key, raw = false)
                    
                </div>
                
                <div class="description">
                  <p>
Retrieves <tt>key</tt> from memcache. If <tt>raw</tt> is false, the value
will be unmarshalled.
</p>

                </div>
                
                
                <div class="aka">
                    This method is also aliased as
                    
                    <a href="MemCache.html#M000041">[]</a>
                    
                </div>
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000027_source')" id="l_M000027_source">show</a>
                        
                    </p>
                    <div id="M000027_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/memcache.rb, line 245</span>
245:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">raw</span> = <span class="ruby-keyword kw">false</span>)
246:     <span class="ruby-identifier">with_server</span>(<span class="ruby-identifier">key</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">server</span>, <span class="ruby-identifier">cache_key</span><span class="ruby-operator">|</span>
247:       <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">debug</span> { <span class="ruby-node">&quot;get #{key} from #{server.inspect}&quot;</span> } <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">logger</span>
248:       <span class="ruby-identifier">value</span> = <span class="ruby-identifier">cache_get</span> <span class="ruby-identifier">server</span>, <span class="ruby-identifier">cache_key</span>
249:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">nil?</span>
250:       <span class="ruby-identifier">value</span> = <span class="ruby-constant">Marshal</span>.<span class="ruby-identifier">load</span> <span class="ruby-identifier">value</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">raw</span>
251:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">value</span>
252:     <span class="ruby-keyword kw">end</span>
253:   <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">TypeError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">err</span>
254:     <span class="ruby-identifier">handle_error</span> <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">err</span>
255:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000029">
                    
                    <a name="M000029"></a><b>get_multi</b>(*keys)
                    
                </div>
                
                <div class="description">
                  <p>
Retrieves multiple values from memcached in parallel, if possible.
</p>
<p>
The memcached protocol supports the ability to retrieve multiple keys in a
single request. Pass in an array of keys to this method and it will:
</p>
<ol>
<li>map the key to the appropriate memcached server

</li>
<li>send a single request to each server that has one or more key values

</li>
</ol>
<p>
Returns a hash of values.
</p>
<pre>
  cache[&quot;a&quot;] = 1
  cache[&quot;b&quot;] = 2
  cache.get_multi &quot;a&quot;, &quot;b&quot; # =&gt; { &quot;a&quot; =&gt; 1, &quot;b&quot; =&gt; 2 }
</pre>
<p>
Note that <a href="MemCache.html#M000029">get_multi</a> assumes the values
are marshalled. You can pass in :raw => true to bypass value marshalling.
</p>
<pre>
  cache.get_multi('a', 'b', ..., :raw =&gt; true)
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000029_source')" id="l_M000029_source">show</a>
                        
                    </p>
                    <div id="M000029_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/memcache.rb, line 297</span>
297:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_multi</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">keys</span>)
298:     <span class="ruby-identifier">raise</span> <span class="ruby-constant">MemCacheError</span>, <span class="ruby-value str">'No active servers'</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">active?</span>
299: 
300:     <span class="ruby-identifier">opts</span> = <span class="ruby-identifier">keys</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Hash</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">keys</span>.<span class="ruby-identifier">pop</span> <span class="ruby-operator">:</span> {}
301: 
302:     <span class="ruby-identifier">keys</span>.<span class="ruby-identifier">flatten!</span>
303:     <span class="ruby-identifier">key_count</span> = <span class="ruby-identifier">keys</span>.<span class="ruby-identifier">length</span>
304:     <span class="ruby-identifier">cache_keys</span> = {}
305:     <span class="ruby-identifier">server_keys</span> = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">h</span>,<span class="ruby-identifier">k</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">k</span>] = [] }
306: 
307:     <span class="ruby-comment cmt"># map keys to servers</span>
308:     <span class="ruby-identifier">keys</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span><span class="ruby-operator">|</span>
309:       <span class="ruby-identifier">server</span>, <span class="ruby-identifier">cache_key</span> = <span class="ruby-identifier">request_setup</span> <span class="ruby-identifier">key</span>
310:       <span class="ruby-identifier">cache_keys</span>[<span class="ruby-identifier">cache_key</span>] = <span class="ruby-identifier">key</span>
311:       <span class="ruby-identifier">server_keys</span>[<span class="ruby-identifier">server</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">cache_key</span>
312:     <span class="ruby-keyword kw">end</span>
313: 
314:     <span class="ruby-identifier">results</span> = {}
315:     <span class="ruby-identifier">raw</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:raw</span>] <span class="ruby-operator">||</span> <span class="ruby-keyword kw">false</span>
316:     <span class="ruby-identifier">server_keys</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">server</span>, <span class="ruby-identifier">keys_for_server</span><span class="ruby-operator">|</span>
317:       <span class="ruby-identifier">keys_for_server_str</span> = <span class="ruby-identifier">keys_for_server</span>.<span class="ruby-identifier">join</span> <span class="ruby-value str">' '</span>
318:       <span class="ruby-keyword kw">begin</span>
319:         <span class="ruby-identifier">values</span> = <span class="ruby-identifier">cache_get_multi</span> <span class="ruby-identifier">server</span>, <span class="ruby-identifier">keys_for_server_str</span>
320:         <span class="ruby-identifier">values</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
321:           <span class="ruby-identifier">results</span>[<span class="ruby-identifier">cache_keys</span>[<span class="ruby-identifier">key</span>]] = <span class="ruby-identifier">raw</span> <span class="ruby-value">? </span><span class="ruby-identifier">value</span> <span class="ruby-operator">:</span> <span class="ruby-constant">Marshal</span>.<span class="ruby-identifier">load</span>(<span class="ruby-identifier">value</span>)
322:         <span class="ruby-keyword kw">end</span>
323:       <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">IndexError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
324:         <span class="ruby-comment cmt"># Ignore this server and try the others</span>
325:         <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">warn</span> { <span class="ruby-node">&quot;Unable to retrieve #{keys_for_server.size} elements from #{server.inspect}: #{e.message}&quot;</span>} <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">logger</span>
326:       <span class="ruby-keyword kw">end</span>
327:     <span class="ruby-keyword kw">end</span>
328: 
329:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">results</span>
330:   <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">TypeError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">err</span>
331:     <span class="ruby-identifier">handle_error</span> <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">err</span>
332:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000030">
                    
                    <a name="M000030"></a><b>incr</b>(key, amount = 1)
                    
                </div>
                
                <div class="description">
                  <p>
Increments the value for <tt>key</tt> by <tt>amount</tt> and returns the
new value. <tt>key</tt> must already exist. If <tt>key</tt> is not an
integer, it is assumed to be 0.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000030_source')" id="l_M000030_source">show</a>
                        
                    </p>
                    <div id="M000030_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/memcache.rb, line 339</span>
339:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">incr</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">amount</span> = <span class="ruby-value">1</span>)
340:     <span class="ruby-identifier">raise</span> <span class="ruby-constant">MemCacheError</span>, <span class="ruby-value str">&quot;Update of readonly cache&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@readonly</span>
341:     <span class="ruby-identifier">with_server</span>(<span class="ruby-identifier">key</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">server</span>, <span class="ruby-identifier">cache_key</span><span class="ruby-operator">|</span>
342:       <span class="ruby-identifier">cache_incr</span> <span class="ruby-identifier">server</span>, <span class="ruby-identifier">cache_key</span>, <span class="ruby-identifier">amount</span>
343:     <span class="ruby-keyword kw">end</span>
344:   <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">TypeError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">err</span>
345:     <span class="ruby-identifier">handle_error</span> <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">err</span>
346:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000022">
                    
                    <a name="M000022"></a><b>inspect</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Returns a string representation of the cache object.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000022_source')" id="l_M000022_source">show</a>
                        
                    </p>
                    <div id="M000022_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/memcache.rb, line 181</span>
181:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">inspect</span>
182:     <span class="ruby-value str">&quot;&lt;MemCache: %d servers, ns: %p, ro: %p&gt;&quot;</span> <span class="ruby-operator">%</span>
183:       [<span class="ruby-ivar">@servers</span>.<span class="ruby-identifier">length</span>, <span class="ruby-ivar">@namespace</span>, <span class="ruby-ivar">@readonly</span>]
184:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000036">
                    
                    <a name="M000036"></a><b>prepend</b>(key, value)
                    
                </div>
                
                <div class="description">
                  <p>
Prepend - &#8216;add this data to an existing key before existing
data&#8217; Please note the value is always passed to memcached as raw
since it doesn&#8217;t make a lot of sense to concatenate marshalled data
together.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000036_source')" id="l_M000036_source">show</a>
                        
                    </p>
                    <div id="M000036_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/memcache.rb, line 500</span>
500:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">prepend</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span>)
501:     <span class="ruby-identifier">raise</span> <span class="ruby-constant">MemCacheError</span>, <span class="ruby-value str">&quot;Update of readonly cache&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@readonly</span>
502:     <span class="ruby-identifier">with_server</span>(<span class="ruby-identifier">key</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">server</span>, <span class="ruby-identifier">cache_key</span><span class="ruby-operator">|</span>
503:       <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">debug</span> { <span class="ruby-node">&quot;prepend #{key} to #{server}: #{value ? value.to_s.size : 'nil'}&quot;</span> } <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">logger</span>
504:       <span class="ruby-identifier">command</span> = <span class="ruby-node">&quot;prepend #{cache_key} 0 0 #{value.to_s.size}#{noreply}\r\n#{value}\r\n&quot;</span>
505: 
506:       <span class="ruby-identifier">with_socket_management</span>(<span class="ruby-identifier">server</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">socket</span><span class="ruby-operator">|</span>
507:         <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">write</span> <span class="ruby-identifier">command</span>
508:         <span class="ruby-keyword kw">break</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@no_reply</span>
509:         <span class="ruby-identifier">result</span> = <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">gets</span>
510:         <span class="ruby-identifier">raise_on_error_response!</span> <span class="ruby-identifier">result</span>
511:         <span class="ruby-identifier">result</span>
512:       <span class="ruby-keyword kw">end</span>
513:     <span class="ruby-keyword kw">end</span>
514:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000024">
                    
                    <a name="M000024"></a><b>readonly?</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Returns whether or not the cache object was created read only.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000024_source')" id="l_M000024_source">show</a>
                        
                    </p>
                    <div id="M000024_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/memcache.rb, line 196</span>
196:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">readonly?</span>
197:     <span class="ruby-ivar">@readonly</span>
198:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000034">
                    
                    <a name="M000034"></a><b>replace</b>(key, value, expiry = 0, raw = false)
                    
                </div>
                
                <div class="description">
                  <p>
Add <tt>key</tt> to the cache with value <tt>value</tt> that expires in
<tt>expiry</tt> seconds, but only if <tt>key</tt> already exists in the
cache. If <tt>raw</tt> is true, <tt>value</tt> will not be Marshalled.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000034_source')" id="l_M000034_source">show</a>
                        
                    </p>
                    <div id="M000034_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/memcache.rb, line 459</span>
459:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">replace</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span>, <span class="ruby-identifier">expiry</span> = <span class="ruby-value">0</span>, <span class="ruby-identifier">raw</span> = <span class="ruby-keyword kw">false</span>)
460:     <span class="ruby-identifier">raise</span> <span class="ruby-constant">MemCacheError</span>, <span class="ruby-value str">&quot;Update of readonly cache&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@readonly</span>
461:     <span class="ruby-identifier">value</span> = <span class="ruby-constant">Marshal</span>.<span class="ruby-identifier">dump</span> <span class="ruby-identifier">value</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">raw</span>
462:     <span class="ruby-identifier">with_server</span>(<span class="ruby-identifier">key</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">server</span>, <span class="ruby-identifier">cache_key</span><span class="ruby-operator">|</span>
463:       <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">debug</span> { <span class="ruby-node">&quot;replace #{key} to #{server}: #{value ? value.to_s.size : 'nil'}&quot;</span> } <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">logger</span>
464:       <span class="ruby-identifier">command</span> = <span class="ruby-node">&quot;replace #{cache_key} 0 #{expiry} #{value.to_s.size}#{noreply}\r\n#{value}\r\n&quot;</span>
465: 
466:       <span class="ruby-identifier">with_socket_management</span>(<span class="ruby-identifier">server</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">socket</span><span class="ruby-operator">|</span>
467:         <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">write</span> <span class="ruby-identifier">command</span>
468:         <span class="ruby-keyword kw">break</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@no_reply</span>
469:         <span class="ruby-identifier">result</span> = <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">gets</span>
470:         <span class="ruby-identifier">raise_on_error_response!</span> <span class="ruby-identifier">result</span>
471:         <span class="ruby-identifier">result</span>
472:       <span class="ruby-keyword kw">end</span>
473:     <span class="ruby-keyword kw">end</span>
474:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000039">
                    
                    <a name="M000039"></a><b>reset</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Reset the connection to all memcache servers. This should be called if
there is a problem with a cache lookup that might have left the connection
in a corrupted state.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000039_source')" id="l_M000039_source">show</a>
                        
                    </p>
                    <div id="M000039_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/memcache.rb, line 574</span>
574:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">reset</span>
575:     <span class="ruby-ivar">@servers</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">server</span><span class="ruby-operator">|</span> <span class="ruby-identifier">server</span>.<span class="ruby-identifier">close</span> }
576:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000025">
                    
                    <a name="M000025"></a><b>servers=</b>(servers)
                    
                </div>
                
                <div class="description">
                  <p>
Set the servers that the requests will be distributed between. Entries can
be either strings of the form &#8220;hostname:port&#8221; or
&#8220;hostname:port:weight&#8221; or <a
href="MemCache/Server.html">MemCache::Server</a> objects.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000025_source')" id="l_M000025_source">show</a>
                        
                    </p>
                    <div id="M000025_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/memcache.rb, line 205</span>
205:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">servers=</span>(<span class="ruby-identifier">servers</span>)
206:     <span class="ruby-comment cmt"># Create the server objects.</span>
207:     <span class="ruby-ivar">@servers</span> = <span class="ruby-constant">Array</span>(<span class="ruby-identifier">servers</span>).<span class="ruby-identifier">collect</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">server</span><span class="ruby-operator">|</span>
208:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">server</span>
209:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">String</span>
210:         <span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>, <span class="ruby-identifier">weight</span> = <span class="ruby-identifier">server</span>.<span class="ruby-identifier">split</span> <span class="ruby-value str">':'</span>, <span class="ruby-value">3</span>
211:         <span class="ruby-identifier">port</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">DEFAULT_PORT</span>
212:         <span class="ruby-identifier">weight</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">DEFAULT_WEIGHT</span>
213:         <span class="ruby-constant">Server</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword kw">self</span>, <span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>, <span class="ruby-identifier">weight</span>
214:       <span class="ruby-keyword kw">else</span>
215:         <span class="ruby-identifier">server</span>
216:       <span class="ruby-keyword kw">end</span>
217:     <span class="ruby-keyword kw">end</span>
218: 
219:     <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">debug</span> { <span class="ruby-node">&quot;Servers now: #{@servers.inspect}&quot;</span> } <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">logger</span>
220: 
221:     <span class="ruby-comment cmt"># There's no point in doing this if there's only one server</span>
222:     <span class="ruby-ivar">@continuum</span> = <span class="ruby-identifier">create_continuum_for</span>(<span class="ruby-ivar">@servers</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@servers</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>
223: 
224:     <span class="ruby-ivar">@servers</span>
225:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000031">
                    
                    <a name="M000031"></a><b>set</b>(key, value, expiry = 0, raw = false)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000031_source')" id="l_M000031_source">show</a>
                        
                    </p>
                    <div id="M000031_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/memcache.rb, line 357</span>
357:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span>, <span class="ruby-identifier">expiry</span> = <span class="ruby-value">0</span>, <span class="ruby-identifier">raw</span> = <span class="ruby-keyword kw">false</span>)
358:     <span class="ruby-identifier">raise</span> <span class="ruby-constant">MemCacheError</span>, <span class="ruby-value str">&quot;Update of readonly cache&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@readonly</span>
359: 
360:     <span class="ruby-identifier">value</span> = <span class="ruby-constant">Marshal</span>.<span class="ruby-identifier">dump</span> <span class="ruby-identifier">value</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">raw</span>
361:     <span class="ruby-identifier">with_server</span>(<span class="ruby-identifier">key</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">server</span>, <span class="ruby-identifier">cache_key</span><span class="ruby-operator">|</span>
362:       <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">debug</span> { <span class="ruby-node">&quot;set #{key} to #{server.inspect}: #{value.to_s.size}&quot;</span> } <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">logger</span>
363: 
364:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@check_size</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-constant">ONE_MB</span>
365:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">MemCacheError</span>, <span class="ruby-value str">&quot;Value too large, memcached can only store 1MB of data per key&quot;</span>
366:       <span class="ruby-keyword kw">end</span>
367: 
368:       <span class="ruby-identifier">command</span> = <span class="ruby-node">&quot;set #{cache_key} 0 #{expiry} #{value.to_s.size}#{noreply}\r\n#{value}\r\n&quot;</span>
369: 
370:       <span class="ruby-identifier">with_socket_management</span>(<span class="ruby-identifier">server</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">socket</span><span class="ruby-operator">|</span>
371:         <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">write</span> <span class="ruby-identifier">command</span>
372:         <span class="ruby-keyword kw">break</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@no_reply</span>
373:         <span class="ruby-identifier">result</span> = <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">gets</span>
374:         <span class="ruby-identifier">raise_on_error_response!</span> <span class="ruby-identifier">result</span>
375: 
376:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">result</span>.<span class="ruby-identifier">nil?</span>
377:           <span class="ruby-identifier">server</span>.<span class="ruby-identifier">close</span>
378:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">MemCacheError</span>, <span class="ruby-node">&quot;lost connection to #{server.host}:#{server.port}&quot;</span>
379:         <span class="ruby-keyword kw">end</span>
380: 
381:         <span class="ruby-identifier">result</span>
382:       <span class="ruby-keyword kw">end</span>
383:     <span class="ruby-keyword kw">end</span>
384:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000040">
                    
                    <a name="M000040"></a><b>stats</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Returns statistics for each memcached server. An explanation of the
statistics can be found in the memcached docs:
</p>
<p>
<a
href="http://code.sixapart.com/svn/memcached/trunk/server/doc/protocol.txt">code.sixapart.com/svn/memcached/trunk/server/doc/protocol.txt</a>
</p>
<p>
Example:
</p>
<pre>
  &gt;&gt; pp CACHE.stats
  {&quot;localhost:11211&quot;=&gt;
    {&quot;bytes&quot;=&gt;4718,
     &quot;pid&quot;=&gt;20188,
     &quot;connection_structures&quot;=&gt;4,
     &quot;time&quot;=&gt;1162278121,
     &quot;pointer_size&quot;=&gt;32,
     &quot;limit_maxbytes&quot;=&gt;67108864,
     &quot;cmd_get&quot;=&gt;14532,
     &quot;version&quot;=&gt;&quot;1.2.0&quot;,
     &quot;bytes_written&quot;=&gt;432583,
     &quot;cmd_set&quot;=&gt;32,
     &quot;get_misses&quot;=&gt;0,
     &quot;total_connections&quot;=&gt;19,
     &quot;curr_connections&quot;=&gt;3,
     &quot;curr_items&quot;=&gt;4,
     &quot;uptime&quot;=&gt;1557,
     &quot;get_hits&quot;=&gt;14532,
     &quot;total_items&quot;=&gt;32,
     &quot;rusage_system&quot;=&gt;0.313952,
     &quot;rusage_user&quot;=&gt;0.119981,
     &quot;bytes_read&quot;=&gt;190619}}
  =&gt; nil
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000040_source')" id="l_M000040_source">show</a>
                        
                    </p>
                    <div id="M000040_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/memcache.rb, line 610</span>
610:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">stats</span>
611:     <span class="ruby-identifier">raise</span> <span class="ruby-constant">MemCacheError</span>, <span class="ruby-value str">&quot;No active servers&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">active?</span>
612:     <span class="ruby-identifier">server_stats</span> = {}
613: 
614:     <span class="ruby-ivar">@servers</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">server</span><span class="ruby-operator">|</span>
615:       <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">server</span>.<span class="ruby-identifier">alive?</span>
616: 
617:       <span class="ruby-identifier">with_socket_management</span>(<span class="ruby-identifier">server</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">socket</span><span class="ruby-operator">|</span>
618:         <span class="ruby-identifier">value</span> = <span class="ruby-keyword kw">nil</span>
619:         <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">write</span> <span class="ruby-value str">&quot;stats\r\n&quot;</span>
620:         <span class="ruby-identifier">stats</span> = {}
621:         <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">line</span> = <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">gets</span> <span class="ruby-keyword kw">do</span>
622:           <span class="ruby-identifier">raise_on_error_response!</span> <span class="ruby-identifier">line</span>
623:           <span class="ruby-keyword kw">break</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">line</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;END\r\n&quot;</span>
624:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">line</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/\ASTAT ([\S]+) ([\w\.\:]+)/</span> <span class="ruby-keyword kw">then</span>
625:             <span class="ruby-identifier">name</span>, <span class="ruby-identifier">value</span> = <span class="ruby-identifier">$1</span>, <span class="ruby-identifier">$2</span>
626:             <span class="ruby-identifier">stats</span>[<span class="ruby-identifier">name</span>] = <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">name</span>
627:                           <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'version'</span>
628:                             <span class="ruby-identifier">value</span>
629:                           <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'rusage_user'</span>, <span class="ruby-value str">'rusage_system'</span> <span class="ruby-keyword kw">then</span>
630:                             <span class="ruby-identifier">seconds</span>, <span class="ruby-identifier">microseconds</span> = <span class="ruby-identifier">value</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp re">/:/</span>, <span class="ruby-value">2</span>)
631:                             <span class="ruby-identifier">microseconds</span> <span class="ruby-operator">||=</span> <span class="ruby-value">0</span>
632:                             <span class="ruby-constant">Float</span>(<span class="ruby-identifier">seconds</span>) <span class="ruby-operator">+</span> (<span class="ruby-constant">Float</span>(<span class="ruby-identifier">microseconds</span>) <span class="ruby-operator">/</span> <span class="ruby-value">1_000_000</span>)
633:                           <span class="ruby-keyword kw">else</span>
634:                             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">value</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/\A\d+\Z/</span> <span class="ruby-keyword kw">then</span>
635:                               <span class="ruby-identifier">value</span>.<span class="ruby-identifier">to_i</span>
636:                             <span class="ruby-keyword kw">else</span>
637:                               <span class="ruby-identifier">value</span>
638:                             <span class="ruby-keyword kw">end</span>
639:                           <span class="ruby-keyword kw">end</span>
640:           <span class="ruby-keyword kw">end</span>
641:         <span class="ruby-keyword kw">end</span>
642:         <span class="ruby-identifier">server_stats</span>[<span class="ruby-node">&quot;#{server.host}:#{server.port}&quot;</span>] = <span class="ruby-identifier">stats</span>
643:       <span class="ruby-keyword kw">end</span>
644:     <span class="ruby-keyword kw">end</span>
645: 
646:     <span class="ruby-identifier">raise</span> <span class="ruby-constant">MemCacheError</span>, <span class="ruby-value str">&quot;No active servers&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">server_stats</span>.<span class="ruby-identifier">empty?</span>
647:     <span class="ruby-identifier">server_stats</span>
648:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Protected methods</div>
            
            <div class="method">
                <div class="title" id="M000047">
                    
                    <a name="M000047"></a><b>cache_decr</b>(server, cache_key, amount)
                    
                </div>
                
                <div class="description">
                  <p>
Performs a raw decr for <tt>cache_key</tt> from <tt>server</tt>. Returns
nil if not found.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000047_source')" id="l_M000047_source">show</a>
                        
                    </p>
                    <div id="M000047_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/memcache.rb, line 724</span>
724:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">cache_decr</span>(<span class="ruby-identifier">server</span>, <span class="ruby-identifier">cache_key</span>, <span class="ruby-identifier">amount</span>)
725:     <span class="ruby-identifier">with_socket_management</span>(<span class="ruby-identifier">server</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">socket</span><span class="ruby-operator">|</span>
726:       <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">write</span> <span class="ruby-node">&quot;decr #{cache_key} #{amount}#{noreply}\r\n&quot;</span>
727:       <span class="ruby-keyword kw">break</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@no_reply</span>
728:       <span class="ruby-identifier">text</span> = <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">gets</span>
729:       <span class="ruby-identifier">raise_on_error_response!</span> <span class="ruby-identifier">text</span>
730:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">text</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;NOT_FOUND\r\n&quot;</span>
731:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">text</span>.<span class="ruby-identifier">to_i</span>
732:     <span class="ruby-keyword kw">end</span>
733:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000048">
                    
                    <a name="M000048"></a><b>cache_get</b>(server, cache_key)
                    
                </div>
                
                <div class="description">
                  <p>
Fetches the raw data for <tt>cache_key</tt> from <tt>server</tt>. Returns
nil on cache miss.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000048_source')" id="l_M000048_source">show</a>
                        
                    </p>
                    <div id="M000048_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/memcache.rb, line 739</span>
739:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">cache_get</span>(<span class="ruby-identifier">server</span>, <span class="ruby-identifier">cache_key</span>)
740:     <span class="ruby-identifier">with_socket_management</span>(<span class="ruby-identifier">server</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">socket</span><span class="ruby-operator">|</span>
741:       <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">write</span> <span class="ruby-node">&quot;get #{cache_key}\r\n&quot;</span>
742:       <span class="ruby-identifier">keyline</span> = <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">gets</span> <span class="ruby-comment cmt"># &quot;VALUE &lt;key&gt; &lt;flags&gt; &lt;bytes&gt;\r\n&quot;</span>
743: 
744:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">keyline</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">then</span>
745:         <span class="ruby-identifier">server</span>.<span class="ruby-identifier">close</span>
746:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">MemCacheError</span>, <span class="ruby-node">&quot;lost connection to #{server.host}:#{server.port}&quot;</span>
747:       <span class="ruby-keyword kw">end</span>
748: 
749:       <span class="ruby-identifier">raise_on_error_response!</span> <span class="ruby-identifier">keyline</span>
750:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">keyline</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;END\r\n&quot;</span>
751: 
752:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">keyline</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/(\d+)\r/</span> <span class="ruby-keyword kw">then</span>
753:         <span class="ruby-identifier">server</span>.<span class="ruby-identifier">close</span>
754:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">MemCacheError</span>, <span class="ruby-node">&quot;unexpected response #{keyline.inspect}&quot;</span>
755:       <span class="ruby-keyword kw">end</span>
756:       <span class="ruby-identifier">value</span> = <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">read</span> <span class="ruby-identifier">$1</span>.<span class="ruby-identifier">to_i</span>
757:       <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">read</span> <span class="ruby-value">2</span> <span class="ruby-comment cmt"># &quot;\r\n&quot;</span>
758:       <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">gets</span>   <span class="ruby-comment cmt"># &quot;END\r\n&quot;</span>
759:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">value</span>
760:     <span class="ruby-keyword kw">end</span>
761:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000050">
                    
                    <a name="M000050"></a><b>cache_get_multi</b>(server, cache_keys)
                    
                </div>
                
                <div class="description">
                  <p>
Fetches <tt>cache_keys</tt> from <tt>server</tt> using a multi-get.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000050_source')" id="l_M000050_source">show</a>
                        
                    </p>
                    <div id="M000050_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/memcache.rb, line 798</span>
798:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">cache_get_multi</span>(<span class="ruby-identifier">server</span>, <span class="ruby-identifier">cache_keys</span>)
799:     <span class="ruby-identifier">with_socket_management</span>(<span class="ruby-identifier">server</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">socket</span><span class="ruby-operator">|</span>
800:       <span class="ruby-identifier">values</span> = {}
801:       <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">write</span> <span class="ruby-node">&quot;get #{cache_keys}\r\n&quot;</span>
802: 
803:       <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">keyline</span> = <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">gets</span> <span class="ruby-keyword kw">do</span>
804:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">values</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">keyline</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;END\r\n&quot;</span>
805:         <span class="ruby-identifier">raise_on_error_response!</span> <span class="ruby-identifier">keyline</span>
806: 
807:         <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">keyline</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/\AVALUE (.+) (.+) (.+)/</span> <span class="ruby-keyword kw">then</span>
808:           <span class="ruby-identifier">server</span>.<span class="ruby-identifier">close</span>
809:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">MemCacheError</span>, <span class="ruby-node">&quot;unexpected response #{keyline.inspect}&quot;</span>
810:         <span class="ruby-keyword kw">end</span>
811: 
812:         <span class="ruby-identifier">key</span>, <span class="ruby-identifier">data_length</span> = <span class="ruby-identifier">$1</span>, <span class="ruby-identifier">$3</span>
813:         <span class="ruby-identifier">values</span>[<span class="ruby-identifier">$1</span>] = <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">read</span> <span class="ruby-identifier">data_length</span>.<span class="ruby-identifier">to_i</span>
814:         <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">read</span>(<span class="ruby-value">2</span>) <span class="ruby-comment cmt"># &quot;\r\n&quot;</span>
815:       <span class="ruby-keyword kw">end</span>
816: 
817:       <span class="ruby-identifier">server</span>.<span class="ruby-identifier">close</span>
818:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">MemCacheError</span>, <span class="ruby-node">&quot;lost connection to #{server.host}:#{server.port}&quot;</span> <span class="ruby-comment cmt"># TODO: retry here too</span>
819:     <span class="ruby-keyword kw">end</span>
820:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000051">
                    
                    <a name="M000051"></a><b>cache_incr</b>(server, cache_key, amount)
                    
                </div>
                
                <div class="description">
                  <p>
Performs a raw incr for <tt>cache_key</tt> from <tt>server</tt>. Returns
nil if not found.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000051_source')" id="l_M000051_source">show</a>
                        
                    </p>
                    <div id="M000051_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/memcache.rb, line 826</span>
826:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">cache_incr</span>(<span class="ruby-identifier">server</span>, <span class="ruby-identifier">cache_key</span>, <span class="ruby-identifier">amount</span>)
827:     <span class="ruby-identifier">with_socket_management</span>(<span class="ruby-identifier">server</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">socket</span><span class="ruby-operator">|</span>
828:       <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">write</span> <span class="ruby-node">&quot;incr #{cache_key} #{amount}#{noreply}\r\n&quot;</span>
829:       <span class="ruby-keyword kw">break</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@no_reply</span>
830:       <span class="ruby-identifier">text</span> = <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">gets</span>
831:       <span class="ruby-identifier">raise_on_error_response!</span> <span class="ruby-identifier">text</span>
832:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">text</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;NOT_FOUND\r\n&quot;</span>
833:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">text</span>.<span class="ruby-identifier">to_i</span>
834:     <span class="ruby-keyword kw">end</span>
835:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000060">
                    
                    <a name="M000060"></a><b>check_multithread_status!</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000060_source')" id="l_M000060_source">show</a>
                        
                    </p>
                    <div id="M000060_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/memcache.rb, line 949</span>
949:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">check_multithread_status!</span>
950:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@multithread</span>
951:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@evented</span>
952: 
953:     <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span>[<span class="ruby-identifier">:memcache_client</span>] <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">object_id</span>
954:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">MemCacheError</span>, <span class="ruby-value str">&quot;You are accessing this memcache-client instance from multiple threads but have not enabled multithread support.\nNormally:  MemCache.new(['localhost:11211'], :multithread =&gt; true)\nIn Rails:  config.cache_store = [:mem_cache_store, 'localhost:11211', { :multithread =&gt; true }]\n&quot;</span>
955:     <span class="ruby-keyword kw">end</span>
956:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000058">
                    
                    <a name="M000058"></a><b>create_continuum_for</b>(servers)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000058_source')" id="l_M000058_source">show</a>
                        
                    </p>
                    <div id="M000058_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/memcache.rb, line 930</span>
930:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create_continuum_for</span>(<span class="ruby-identifier">servers</span>)
931:     <span class="ruby-identifier">total_weight</span> = <span class="ruby-identifier">servers</span>.<span class="ruby-identifier">inject</span>(<span class="ruby-value">0</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">memo</span>, <span class="ruby-identifier">srv</span><span class="ruby-operator">|</span> <span class="ruby-identifier">memo</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">srv</span>.<span class="ruby-identifier">weight</span> }
932:     <span class="ruby-identifier">continuum</span> = []
933: 
934:     <span class="ruby-identifier">servers</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">server</span><span class="ruby-operator">|</span>
935:       <span class="ruby-identifier">entry_count_for</span>(<span class="ruby-identifier">server</span>, <span class="ruby-identifier">servers</span>.<span class="ruby-identifier">size</span>, <span class="ruby-identifier">total_weight</span>).<span class="ruby-identifier">times</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">idx</span><span class="ruby-operator">|</span>
936:         <span class="ruby-identifier">hash</span> = <span class="ruby-constant">Digest</span><span class="ruby-operator">::</span><span class="ruby-constant">SHA1</span>.<span class="ruby-identifier">hexdigest</span>(<span class="ruby-node">&quot;#{server.host}:#{server.port}:#{idx}&quot;</span>)
937:         <span class="ruby-identifier">value</span> = <span class="ruby-constant">Integer</span>(<span class="ruby-node">&quot;0x#{hash[0..7]}&quot;</span>)
938:         <span class="ruby-identifier">continuum</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Continuum</span><span class="ruby-operator">::</span><span class="ruby-constant">Entry</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">value</span>, <span class="ruby-identifier">server</span>)
939:       <span class="ruby-keyword kw">end</span>
940:     <span class="ruby-keyword kw">end</span>
941: 
942:     <span class="ruby-identifier">continuum</span>.<span class="ruby-identifier">sort</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">a</span>, <span class="ruby-identifier">b</span><span class="ruby-operator">|</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">value</span> <span class="ruby-operator">&lt;=&gt;</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">value</span> }
943:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000059">
                    
                    <a name="M000059"></a><b>entry_count_for</b>(server, total_servers, total_weight)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000059_source')" id="l_M000059_source">show</a>
                        
                    </p>
                    <div id="M000059_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/memcache.rb, line 945</span>
945:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">entry_count_for</span>(<span class="ruby-identifier">server</span>, <span class="ruby-identifier">total_servers</span>, <span class="ruby-identifier">total_weight</span>)
946:     ((<span class="ruby-identifier">total_servers</span> <span class="ruby-operator">*</span> <span class="ruby-constant">Continuum</span><span class="ruby-operator">::</span><span class="ruby-constant">POINTS_PER_SERVER</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">server</span>.<span class="ruby-identifier">weight</span>) <span class="ruby-operator">/</span> <span class="ruby-constant">Float</span>(<span class="ruby-identifier">total_weight</span>)).<span class="ruby-identifier">floor</span>
947:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000046">
                    
                    <a name="M000046"></a><b>get_server_for_key</b>(key, options = {})
                    
                </div>
                
                <div class="description">
                  <p>
Pick a server to handle the request based on a hash of the key.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000046_source')" id="l_M000046_source">show</a>
                        
                    </p>
                    <div id="M000046_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/memcache.rb, line 699</span>
699:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_server_for_key</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">options</span> = {})
700:     <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-node">&quot;illegal character in key #{key.inspect}&quot;</span> <span class="ruby-keyword kw">if</span>
701:       <span class="ruby-identifier">key</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/\s/</span>
702:     <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-value str">&quot;key cannot be blank&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">key</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">key</span>.<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
703:     <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-node">&quot;key too long #{key.inspect}&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">key</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">250</span>
704:     <span class="ruby-identifier">raise</span> <span class="ruby-constant">MemCacheError</span>, <span class="ruby-value str">&quot;No servers available&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@servers</span>.<span class="ruby-identifier">empty?</span>
705:     <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@servers</span>.<span class="ruby-identifier">first</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@servers</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span>
706: 
707:     <span class="ruby-identifier">hkey</span> = <span class="ruby-identifier">hash_for</span>(<span class="ruby-identifier">key</span>)
708: 
709:     <span class="ruby-value">20</span>.<span class="ruby-identifier">times</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">try</span><span class="ruby-operator">|</span>
710:       <span class="ruby-identifier">entryidx</span> = <span class="ruby-constant">Continuum</span>.<span class="ruby-identifier">binary_search</span>(<span class="ruby-ivar">@continuum</span>, <span class="ruby-identifier">hkey</span>)
711:       <span class="ruby-identifier">server</span> = <span class="ruby-ivar">@continuum</span>[<span class="ruby-identifier">entryidx</span>].<span class="ruby-identifier">server</span>
712:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">server</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">server</span>.<span class="ruby-identifier">alive?</span>
713:       <span class="ruby-keyword kw">break</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">failover</span>
714:       <span class="ruby-identifier">hkey</span> = <span class="ruby-identifier">hash_for</span> <span class="ruby-node">&quot;#{try}#{key}&quot;</span>
715:     <span class="ruby-keyword kw">end</span>
716: 
717:     <span class="ruby-identifier">raise</span> <span class="ruby-constant">MemCacheError</span>, <span class="ruby-value str">&quot;No servers available&quot;</span>
718:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000049">
                    
                    <a name="M000049"></a><b>gets</b>(key, raw = false)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000049_source')" id="l_M000049_source">show</a>
                        
                    </p>
                    <div id="M000049_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/memcache.rb, line 763</span>
763:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">gets</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">raw</span> = <span class="ruby-keyword kw">false</span>)
764:     <span class="ruby-identifier">with_server</span>(<span class="ruby-identifier">key</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">server</span>, <span class="ruby-identifier">cache_key</span><span class="ruby-operator">|</span>
765:       <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">debug</span> { <span class="ruby-node">&quot;gets #{key} from #{server.inspect}&quot;</span> } <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">logger</span>
766:       <span class="ruby-identifier">result</span> = <span class="ruby-identifier">with_socket_management</span>(<span class="ruby-identifier">server</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">socket</span><span class="ruby-operator">|</span>
767:         <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">write</span> <span class="ruby-node">&quot;gets #{cache_key}\r\n&quot;</span>
768:         <span class="ruby-identifier">keyline</span> = <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">gets</span> <span class="ruby-comment cmt"># &quot;VALUE &lt;key&gt; &lt;flags&gt; &lt;bytes&gt; &lt;cas token&gt;\r\n&quot;</span>
769: 
770:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">keyline</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">then</span>
771:           <span class="ruby-identifier">server</span>.<span class="ruby-identifier">close</span>
772:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">MemCacheError</span>, <span class="ruby-node">&quot;lost connection to #{server.host}:#{server.port}&quot;</span>
773:         <span class="ruby-keyword kw">end</span>
774: 
775:         <span class="ruby-identifier">raise_on_error_response!</span> <span class="ruby-identifier">keyline</span>
776:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">keyline</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;END\r\n&quot;</span>
777: 
778:         <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">keyline</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/(\d+) (\w+)\r/</span> <span class="ruby-keyword kw">then</span>
779:           <span class="ruby-identifier">server</span>.<span class="ruby-identifier">close</span>
780:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">MemCacheError</span>, <span class="ruby-node">&quot;unexpected response #{keyline.inspect}&quot;</span>
781:         <span class="ruby-keyword kw">end</span>
782:         <span class="ruby-identifier">value</span> = <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">read</span> <span class="ruby-identifier">$1</span>.<span class="ruby-identifier">to_i</span>
783:         <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">read</span> <span class="ruby-value">2</span> <span class="ruby-comment cmt"># &quot;\r\n&quot;</span>
784:         <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">gets</span>   <span class="ruby-comment cmt"># &quot;END\r\n&quot;</span>
785:         [<span class="ruby-identifier">value</span>, <span class="ruby-identifier">$2</span>]
786:       <span class="ruby-keyword kw">end</span>
787:       <span class="ruby-identifier">result</span>[<span class="ruby-value">0</span>] = <span class="ruby-constant">Marshal</span>.<span class="ruby-identifier">load</span> <span class="ruby-identifier">result</span>[<span class="ruby-value">0</span>] <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">raw</span>
788:       <span class="ruby-identifier">result</span>
789:     <span class="ruby-keyword kw">end</span>
790:   <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">TypeError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">err</span>
791:     <span class="ruby-identifier">handle_error</span> <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">err</span>
792:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000054">
                    
                    <a name="M000054"></a><b>handle_error</b>(server, error)
                    
                </div>
                
                <div class="description">
                  <p>
Handles <tt>error</tt> from <tt>server</tt>.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000054_source')" id="l_M000054_source">show</a>
                        
                    </p>
                    <div id="M000054_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/memcache.rb, line 901</span>
901:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">handle_error</span>(<span class="ruby-identifier">server</span>, <span class="ruby-identifier">error</span>)
902:     <span class="ruby-identifier">raise</span> <span class="ruby-identifier">error</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">error</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">MemCacheError</span>)
903:     <span class="ruby-identifier">server</span>.<span class="ruby-identifier">close</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">server</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">server</span>.<span class="ruby-identifier">status</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;CONNECTED&quot;</span>
904:     <span class="ruby-identifier">new_error</span> = <span class="ruby-constant">MemCacheError</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">error</span>.<span class="ruby-identifier">message</span>
905:     <span class="ruby-identifier">new_error</span>.<span class="ruby-identifier">set_backtrace</span> <span class="ruby-identifier">error</span>.<span class="ruby-identifier">backtrace</span>
906:     <span class="ruby-identifier">raise</span> <span class="ruby-identifier">new_error</span>
907:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000045">
                    
                    <a name="M000045"></a><b>hash_for</b>(key)
                    
                </div>
                
                <div class="description">
                  <p>
Returns an interoperable hash value for <tt>key</tt>. (I think, docs are
sketchy for down servers).
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000045_source')" id="l_M000045_source">show</a>
                        
                    </p>
                    <div id="M000045_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/memcache.rb, line 692</span>
692:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">hash_for</span>(<span class="ruby-identifier">key</span>)
693:     <span class="ruby-constant">Zlib</span>.<span class="ruby-identifier">crc32</span>(<span class="ruby-identifier">key</span>)
694:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000044">
                    
                    <a name="M000044"></a><b>key_length</b>(key)
                    
                </div>
                
                <div class="description">
                  <p>
Calculate length of the key, including the namespace and
namespace-separator.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000044_source')" id="l_M000044_source">show</a>
                        
                    </p>
                    <div id="M000044_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/memcache.rb, line 684</span>
684:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">key_length</span>(<span class="ruby-identifier">key</span>)
685:     <span class="ruby-identifier">key</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">+</span> (<span class="ruby-identifier">namespace</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-value">? </span><span class="ruby-value">0</span> <span class="ruby-operator">:</span> ( <span class="ruby-identifier">namespace</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">+</span> (<span class="ruby-ivar">@namespace_separator</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-value">? </span><span class="ruby-value">0</span> <span class="ruby-operator">:</span> <span class="ruby-ivar">@namespace_separator</span>.<span class="ruby-identifier">length</span>) ) )
686:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000043">
                    
                    <a name="M000043"></a><b>make_cache_key</b>(key)
                    
                </div>
                
                <div class="description">
                  <p>
Create a key for the cache, incorporating the namespace qualifier if
requested.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000043_source')" id="l_M000043_source">show</a>
                        
                    </p>
                    <div id="M000043_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/memcache.rb, line 669</span>
669:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">make_cache_key</span>(<span class="ruby-identifier">key</span>)
670:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@autofix_keys</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">key</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/\s/</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">key_length</span>(<span class="ruby-identifier">key</span>) <span class="ruby-operator">&gt;</span> <span class="ruby-value">250</span>)
671:       <span class="ruby-identifier">key</span> = <span class="ruby-node">&quot;#{Digest::SHA1.hexdigest(key)}-autofixed&quot;</span>
672:     <span class="ruby-keyword kw">end</span>
673: 
674:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">namespace</span>.<span class="ruby-identifier">nil?</span>
675:       <span class="ruby-identifier">key</span>
676:     <span class="ruby-keyword kw">else</span>
677:       <span class="ruby-node">&quot;#{@namespace}#{@namespace_separator}#{key}&quot;</span>
678:     <span class="ruby-keyword kw">end</span>
679:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000055">
                    
                    <a name="M000055"></a><b>noreply</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000055_source')" id="l_M000055_source">show</a>
                        
                    </p>
                    <div id="M000055_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/memcache.rb, line 909</span>
909:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">noreply</span>
910:     <span class="ruby-ivar">@no_reply</span> <span class="ruby-operator">?</span> <span class="ruby-value str">' noreply'</span> <span class="ruby-operator">:</span> <span class="ruby-value str">''</span>
911:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000057">
                    
                    <a name="M000057"></a><b>raise_on_error_response!</b>(response)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000057_source')" id="l_M000057_source">show</a>
                        
                    </p>
                    <div id="M000057_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/memcache.rb, line 924</span>
924:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">raise_on_error_response!</span>(<span class="ruby-identifier">response</span>)
925:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">response</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/\A(?:CLIENT_|SERVER_)?ERROR(.*)/</span>
926:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">MemCacheError</span>, <span class="ruby-identifier">$1</span>.<span class="ruby-identifier">strip</span>
927:     <span class="ruby-keyword kw">end</span>
928:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000056">
                    
                    <a name="M000056"></a><b>request_setup</b>(key)
                    
                </div>
                
                <div class="description">
                  <p>
Performs setup for making a request with <tt>key</tt> from memcached.
Returns the server to fetch the key from and the complete key to use.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000056_source')" id="l_M000056_source">show</a>
                        
                    </p>
                    <div id="M000056_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/memcache.rb, line 917</span>
917:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">request_setup</span>(<span class="ruby-identifier">key</span>)
918:     <span class="ruby-identifier">raise</span> <span class="ruby-constant">MemCacheError</span>, <span class="ruby-value str">'No active servers'</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">active?</span>
919:     <span class="ruby-identifier">cache_key</span> = <span class="ruby-identifier">make_cache_key</span> <span class="ruby-identifier">key</span>
920:     <span class="ruby-identifier">server</span> = <span class="ruby-identifier">get_server_for_key</span> <span class="ruby-identifier">cache_key</span>
921:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">server</span>, <span class="ruby-identifier">cache_key</span>
922:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000053">
                    
                    <a name="M000053"></a><b>with_server</b>(key)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000053_source')" id="l_M000053_source">show</a>
                        
                    </p>
                    <div id="M000053_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/memcache.rb, line 882</span>
882:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">with_server</span>(<span class="ruby-identifier">key</span>)
883:     <span class="ruby-identifier">retried</span> = <span class="ruby-keyword kw">false</span>
884:     <span class="ruby-keyword kw">begin</span>
885:       <span class="ruby-identifier">server</span>, <span class="ruby-identifier">cache_key</span> = <span class="ruby-identifier">request_setup</span>(<span class="ruby-identifier">key</span>)
886:       <span class="ruby-keyword kw">yield</span> <span class="ruby-identifier">server</span>, <span class="ruby-identifier">cache_key</span>
887:     <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">IndexError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
888:       <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">warn</span> { <span class="ruby-node">&quot;Server failed: #{e.class.name}: #{e.message}&quot;</span> } <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">logger</span>
889:       <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">retried</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@servers</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>
890:         <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span> { <span class="ruby-node">&quot;Connection to server #{server.inspect} DIED! Retrying operation...&quot;</span> } <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">logger</span>
891:         <span class="ruby-identifier">retried</span> = <span class="ruby-keyword kw">true</span>
892:         <span class="ruby-keyword kw">retry</span>
893:       <span class="ruby-keyword kw">end</span>
894:       <span class="ruby-identifier">handle_error</span>(<span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">e</span>)
895:     <span class="ruby-keyword kw">end</span>
896:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000052">
                    
                    <a name="M000052"></a><b>with_socket_management</b>(server, &amp;block)
                    
                </div>
                
                <div class="description">
                  <p>
Gets or creates a socket connected to the given server, and yields it to
the block, wrapped in a mutex synchronization if @multithread is true.
</p>
<p>
If a socket error (SocketError, SystemCallError, IOError) or protocol error
(<a href="MemCache/MemCacheError.html">MemCacheError</a>) is raised by the
block, closes the socket, attempts to connect again, and retries the block
(once). If an error is again raised, reraises it as <a
href="MemCache/MemCacheError.html">MemCacheError</a>.
</p>
<p>
If unable to connect to the server (or if in the reconnect wait period),
raises <a href="MemCache/MemCacheError.html">MemCacheError</a>. Note that
the socket connect code marks a server dead for a timeout period, so
retrying does not apply to connection attempt failures (but does still
apply to unexpectedly lost connections etc.).
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000052_source')" id="l_M000052_source">show</a>
                        
                    </p>
                    <div id="M000052_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/memcache.rb, line 851</span>
851:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">with_socket_management</span>(<span class="ruby-identifier">server</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
852:     <span class="ruby-identifier">check_multithread_status!</span>
853: 
854:     <span class="ruby-ivar">@mutex</span>.<span class="ruby-identifier">lock</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@multithread</span>
855:     <span class="ruby-identifier">retried</span> = <span class="ruby-keyword kw">false</span>
856: 
857:     <span class="ruby-keyword kw">begin</span>
858:       <span class="ruby-identifier">socket</span> = <span class="ruby-identifier">server</span>.<span class="ruby-identifier">socket</span>
859: 
860:       <span class="ruby-comment cmt"># Raise an IndexError to show this server is out of whack. If were inside</span>
861:       <span class="ruby-comment cmt"># a with_server block, we'll catch it and attempt to restart the operation.</span>
862: 
863:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">IndexError</span>, <span class="ruby-node">&quot;No connection to server (#{server.status})&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">nil?</span>
864: 
865:       <span class="ruby-identifier">block</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">socket</span>)
866: 
867:     <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">SocketError</span>, <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">EAGAIN</span>, <span class="ruby-constant">Timeout</span><span class="ruby-operator">::</span><span class="ruby-constant">Error</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">err</span>
868:       <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">warn</span> { <span class="ruby-node">&quot;Socket failure: #{err.message}&quot;</span> } <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">logger</span>
869:       <span class="ruby-identifier">server</span>.<span class="ruby-identifier">mark_dead</span>(<span class="ruby-identifier">err</span>)
870:       <span class="ruby-identifier">handle_error</span>(<span class="ruby-identifier">server</span>, <span class="ruby-identifier">err</span>)
871: 
872:     <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">MemCacheError</span>, <span class="ruby-constant">SystemCallError</span>, <span class="ruby-constant">IOError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">err</span>
873:       <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">warn</span> { <span class="ruby-node">&quot;Generic failure: #{err.class.name}: #{err.message}&quot;</span> } <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">logger</span>
874:       <span class="ruby-identifier">handle_error</span>(<span class="ruby-identifier">server</span>, <span class="ruby-identifier">err</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">retried</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">nil?</span>
875:       <span class="ruby-identifier">retried</span> = <span class="ruby-keyword kw">true</span>
876:       <span class="ruby-keyword kw">retry</span>
877:     <span class="ruby-keyword kw">end</span>
878:   <span class="ruby-keyword kw">ensure</span>
879:     <span class="ruby-ivar">@mutex</span>.<span class="ruby-identifier">unlock</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@multithread</span>
880:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Class Public methods</div>
            
            <div class="method">
                <div class="title" id="M000021">
                    
                    <a name="M000021"></a><b>new</b>(*args)
                    
                </div>
                
                <div class="description">
                  <p>
Accepts a list of <tt>servers</tt> and a list of <tt>opts</tt>.
<tt>servers</tt> may be omitted. See <tt>servers=</tt> for acceptable
server list arguments.
</p>
<p>
Valid options for <tt>opts</tt> are:
</p>
<pre>
  [:namespace]    Prepends this value to all keys added or retrieved.
  [:readonly]     Raises an exception on cache writes when true.
  [:multithread]  Wraps cache access in a Mutex for thread safety. Defaults to true.
  [:failover]     Should the client try to failover to another server if the
                  first server is down?  Defaults to true.
  [:timeout]      Time to use as the socket read timeout.  Defaults to 0.5 sec,
                  set to nil to disable timeouts.
  [:logger]       Logger to use for info/debug output, defaults to nil
  [:no_reply]     Don't bother looking for a reply for write operations (i.e. they
                  become 'fire and forget'), memcached 1.2.5 and later only, speeds up
                  set/add/delete/incr/decr significantly.
  [:check_size]   Raises a MemCacheError if the value to be set is greater than 1 MB, which
                  is the maximum key size for the standard memcached server.  Defaults to true.
  [:autofix_keys] If a key is longer than 250 characters or contains spaces,
                  use an SHA1 hash instead, to prevent collisions on truncated keys.
</pre>
<p>
Other options are ignored.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000021_source')" id="l_M000021_source">show</a>
                        
                    </p>
                    <div id="M000021_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/memcache.rb, line 136</span>
136:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
137:     <span class="ruby-identifier">servers</span> = []
138:     <span class="ruby-identifier">opts</span> = {}
139: 
140:     <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">length</span>
141:     <span class="ruby-keyword kw">when</span> <span class="ruby-value">0</span> <span class="ruby-keyword kw">then</span> <span class="ruby-comment cmt"># NOP</span>
142:     <span class="ruby-keyword kw">when</span> <span class="ruby-value">1</span> <span class="ruby-keyword kw">then</span>
143:       <span class="ruby-identifier">arg</span> = <span class="ruby-identifier">args</span>.<span class="ruby-identifier">shift</span>
144:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">arg</span>
145:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Hash</span>   <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">opts</span> = <span class="ruby-identifier">arg</span>
146:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Array</span>  <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">servers</span> = <span class="ruby-identifier">arg</span>
147:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">String</span> <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">servers</span> = [<span class="ruby-identifier">arg</span>]
148:       <span class="ruby-keyword kw">else</span> <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-value str">'first argument must be Array, Hash or String'</span>
149:       <span class="ruby-keyword kw">end</span>
150:     <span class="ruby-keyword kw">when</span> <span class="ruby-value">2</span> <span class="ruby-keyword kw">then</span>
151:       <span class="ruby-identifier">servers</span>, <span class="ruby-identifier">opts</span> = <span class="ruby-identifier">args</span>
152:     <span class="ruby-keyword kw">else</span>
153:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-node">&quot;wrong number of arguments (#{args.length} for 2)&quot;</span>
154:     <span class="ruby-keyword kw">end</span>
155: 
156:     <span class="ruby-ivar">@evented</span> = <span class="ruby-keyword kw">defined?</span>(<span class="ruby-constant">EM</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-constant">EM</span>.<span class="ruby-identifier">reactor_running?</span>
157:     <span class="ruby-identifier">opts</span> = <span class="ruby-constant">DEFAULT_OPTIONS</span>.<span class="ruby-identifier">merge</span> <span class="ruby-identifier">opts</span>
158:     <span class="ruby-ivar">@namespace</span>    = <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:namespace</span>]
159:     <span class="ruby-ivar">@readonly</span>     = <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:readonly</span>]
160:     <span class="ruby-ivar">@multithread</span>  = <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:multithread</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@evented</span>
161:     <span class="ruby-ivar">@autofix_keys</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:autofix_keys</span>]
162:     <span class="ruby-ivar">@timeout</span>      = <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:timeout</span>]
163:     <span class="ruby-ivar">@failover</span>     = <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:failover</span>]
164:     <span class="ruby-ivar">@logger</span>       = <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:logger</span>]
165:     <span class="ruby-ivar">@no_reply</span>     = <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:no_reply</span>]
166:     <span class="ruby-ivar">@check_size</span>   = <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:check_size</span>]
167:     <span class="ruby-ivar">@namespace_separator</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:namespace_separator</span>]
168:     <span class="ruby-ivar">@mutex</span>        = <span class="ruby-constant">Mutex</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@multithread</span>
169: 
170:     <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span> { <span class="ruby-node">&quot;memcache-client #{VERSION} #{Array(servers).inspect}&quot;</span> } <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">logger</span>
171: 
172:     <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span>[<span class="ruby-identifier">:memcache_client</span>] = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">object_id</span> <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@multithread</span>
173:     
174: 
175:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">servers</span> = <span class="ruby-identifier">servers</span>
176:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    